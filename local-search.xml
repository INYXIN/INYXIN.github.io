<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>21.åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨</title>
    <link href="/post/87f453c3-c442-4726-a077-dc248516c603/"/>
    <url>/post/87f453c3-c442-4726-a077-dc248516c603/</url>
    
    <content type="html"><![CDATA[<h3 id="21-åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨"><a href="#21-åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨" class="headerlink" title="21.åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨"></a>21.åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨</h3><p><code>hexo template generate by typora plugin templater</code></p><h4 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h4><p>å°†ä¸¤ä¸ªå‡åºé“¾è¡¨åˆå¹¶ä¸ºä¸€ä¸ªæ–°çš„ <strong>å‡åº</strong> é“¾è¡¨å¹¶è¿”å›ã€‚æ–°é“¾è¡¨æ˜¯é€šè¿‡æ‹¼æ¥ç»™å®šçš„ä¸¤ä¸ªé“¾è¡¨çš„æ‰€æœ‰èŠ‚ç‚¹ç»„æˆçš„ã€‚ </p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><p><img src="merge_ex1.jpg" alt="img"></p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs inform7">è¾“å…¥ï¼šl1 = <span class="hljs-comment">[1,2,4]</span>, l2 = <span class="hljs-comment">[1,3,4]</span><br>è¾“å‡ºï¼š<span class="hljs-comment">[1,1,2,3,4,4]</span><br></code></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs inform7">è¾“å…¥ï¼šl1 = <span class="hljs-comment">[]</span>, l2 = <span class="hljs-comment">[]</span><br>è¾“å‡ºï¼š<span class="hljs-comment">[]</span><br></code></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs inform7">è¾“å…¥ï¼šl1 = <span class="hljs-comment">[]</span>, l2 = <span class="hljs-comment">[0]</span><br>è¾“å‡ºï¼š<span class="hljs-comment">[0]</span><br></code></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li>ä¸¤ä¸ªé“¾è¡¨çš„èŠ‚ç‚¹æ•°ç›®èŒƒå›´æ˜¯ <code>[0, 50]</code></li><li><code>-100 &lt;= Node.val &lt;= 100</code></li><li><code>l1</code> å’Œ <code>l2</code> å‡æŒ‰ <strong>éé€’å‡é¡ºåº</strong> æ’åˆ—</li></ul><h4 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Definition for singly-linked list.</span><br><span class="hljs-comment"> * public class ListNode &#123;</span><br><span class="hljs-comment"> *     int val;</span><br><span class="hljs-comment"> *     ListNode next;</span><br><span class="hljs-comment"> *     ListNode() &#123;&#125;</span><br><span class="hljs-comment"> *     ListNode(int val) &#123; this.val = val; &#125;</span><br><span class="hljs-comment"> *     ListNode(int val, ListNode next) &#123; this.val = val; this.next = next; &#125;</span><br><span class="hljs-comment"> * &#125;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br>    <span class="hljs-keyword">public</span> ListNode <span class="hljs-title function_">mergeTwoLists</span><span class="hljs-params">(ListNode list1, ListNode list2)</span> &#123;<br>        <span class="hljs-keyword">if</span>(list1 == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> list2;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(list2 == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> list1;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(list1.val &lt; list2.val)&#123;<br>            list1.next = mergeTwoLists(list1.next,list2);<br>            <span class="hljs-keyword">return</span> list1;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            list2.next = mergeTwoLists(list2.next,list1);<br>            <span class="hljs-keyword">return</span> list2;<br>        &#125;<br>        <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
      <category>Leetcode</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Leetcode</tag>
      
      <tag>ç®€å•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>11.ç››æœ€å¤šæ°´çš„å®¹å™¨</title>
    <link href="/post/0b95425c-86c8-43f6-bec0-8dc6fee1f81d/"/>
    <url>/post/0b95425c-86c8-43f6-bec0-8dc6fee1f81d/</url>
    
    <content type="html"><![CDATA[<h3 id="11-ç››æœ€å¤šæ°´çš„å®¹å™¨"><a href="#11-ç››æœ€å¤šæ°´çš„å®¹å™¨" class="headerlink" title="11.ç››æœ€å¤šæ°´çš„å®¹å™¨"></a>11.ç››æœ€å¤šæ°´çš„å®¹å™¨</h3><p><code>hexo template generate by typora plugin templater</code></p><h4 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h4><p><a href="https://leetcode.cn/problems/container-with-most-water/">11. ç››æœ€å¤šæ°´çš„å®¹å™¨</a></p><p>å·²è§£ç­”</p><p>ä¸­ç­‰</p><p>ç›¸å…³æ ‡ç­¾</p><p>ç›¸å…³ä¼ä¸š</p><p>æç¤º</p><p>ç»™å®šä¸€ä¸ªé•¿åº¦ä¸º <code>n</code> çš„æ•´æ•°æ•°ç»„ <code>height</code> ã€‚æœ‰ <code>n</code> æ¡å‚çº¿ï¼Œç¬¬ <code>i</code> æ¡çº¿çš„ä¸¤ä¸ªç«¯ç‚¹æ˜¯ <code>(i, 0)</code> å’Œ <code>(i, height[i])</code> ã€‚</p><p>æ‰¾å‡ºå…¶ä¸­çš„ä¸¤æ¡çº¿ï¼Œä½¿å¾—å®ƒä»¬ä¸ <code>x</code> è½´å…±åŒæ„æˆçš„å®¹å™¨å¯ä»¥å®¹çº³æœ€å¤šçš„æ°´ã€‚</p><p>è¿”å›å®¹å™¨å¯ä»¥å‚¨å­˜çš„æœ€å¤§æ°´é‡ã€‚</p><p><strong>è¯´æ˜ï¼š</strong>ä½ ä¸èƒ½å€¾æ–œå®¹å™¨ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><p><img src="question_11.jpg" alt="img"></p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dns">è¾“å…¥ï¼š[<span class="hljs-number">1,8,6,2</span>,<span class="hljs-number">5,4,8,3</span>,<span class="hljs-number">7</span>]<br>è¾“å‡ºï¼š<span class="hljs-number">49</span> <br>è§£é‡Šï¼šå›¾ä¸­å‚ç›´çº¿ä»£è¡¨è¾“å…¥æ•°ç»„ [<span class="hljs-number">1,8,6,2</span>,<span class="hljs-number">5,4,8,3</span>,<span class="hljs-number">7</span>]ã€‚åœ¨æ­¤æƒ…å†µä¸‹ï¼Œå®¹å™¨èƒ½å¤Ÿå®¹çº³æ°´ï¼ˆè¡¨ç¤ºä¸ºè“è‰²éƒ¨åˆ†ï¼‰çš„æœ€å¤§å€¼ä¸º <span class="hljs-number">49</span>ã€‚<br></code></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arduino">è¾“å…¥ï¼šheight = [<span class="hljs-number">1</span>,<span class="hljs-number">1</span>]<br>è¾“å‡ºï¼š<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li><code>n == height.length</code></li><li><code>2 &lt;= n &lt;= 105</code></li><li><code>0 &lt;= height[i] &lt;= 104</code></li></ul><h4 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">maxArea</span><span class="hljs-params">(<span class="hljs-type">int</span>[] height)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">left</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">right</span> <span class="hljs-operator">=</span> height.length - <span class="hljs-number">1</span>;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">maxArea</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">while</span>(left &lt; right)&#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">h</span> <span class="hljs-operator">=</span> Math.min(height[left],height[right]);<br>            <span class="hljs-type">int</span> <span class="hljs-variable">w</span> <span class="hljs-operator">=</span> right - left; <br>            <span class="hljs-type">int</span> <span class="hljs-variable">area</span> <span class="hljs-operator">=</span> w * h;<br>            maxArea = Math.max( area , maxArea );<br>            <span class="hljs-keyword">if</span>(height[left] &gt; height[right])&#123;<br>                right --;<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                left ++;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> maxArea ;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
      <category>Leetcode</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Leetcode</tag>
      
      <tag>ä¸­ç­‰</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>283.ç§»åŠ¨é›¶</title>
    <link href="/post/b84f669b-c519-4d45-8c66-79b36535b924/"/>
    <url>/post/b84f669b-c519-4d45-8c66-79b36535b924/</url>
    
    <content type="html"><![CDATA[<h3 id="283-ç§»åŠ¨é›¶"><a href="#283-ç§»åŠ¨é›¶" class="headerlink" title="283.ç§»åŠ¨é›¶"></a>283.ç§»åŠ¨é›¶</h3><p><code>hexo template generate by typora plugin templater</code></p><h4 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h4><p><a href="https://leetcode.cn/problems/move-zeroes/">283. ç§»åŠ¨é›¶</a></p><p>ç®€å•</p><p>ç›¸å…³æ ‡ç­¾</p><p>ç›¸å…³ä¼ä¸š</p><p>æç¤º</p><p>ç»™å®šä¸€ä¸ªæ•°ç»„ <code>nums</code>ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°å°†æ‰€æœ‰ <code>0</code> ç§»åŠ¨åˆ°æ•°ç»„çš„æœ«å°¾ï¼ŒåŒæ—¶ä¿æŒéé›¶å…ƒç´ çš„ç›¸å¯¹é¡ºåºã€‚</p><p><strong>è¯·æ³¨æ„</strong> ï¼Œå¿…é¡»åœ¨ä¸å¤åˆ¶æ•°ç»„çš„æƒ…å†µä¸‹åŸåœ°å¯¹æ•°ç»„è¿›è¡Œæ“ä½œã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs accesslog">è¾“å…¥: nums = <span class="hljs-string">[0,1,0,3,12]</span><br>è¾“å‡º: <span class="hljs-string">[1,3,12,0,0]</span><br></code></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2:</strong></p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs inform7">è¾“å…¥: nums = <span class="hljs-comment">[0]</span><br>è¾“å‡º: <span class="hljs-comment">[0]</span><br></code></pre></td></tr></table></figure><p><strong>æç¤º</strong>:</p><ul><li><code>1 &lt;= nums.length &lt;= 104</code></li><li><code>-231 &lt;= nums[i] &lt;= 231 - 1</code></li></ul><p><strong>è¿›é˜¶ï¼š</strong>ä½ èƒ½å°½é‡å‡å°‘å®Œæˆçš„æ“ä½œæ¬¡æ•°å—ï¼Ÿ</p><h4 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">moveZeroes</span><span class="hljs-params">(<span class="hljs-type">int</span>[] nums)</span> &#123;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
      <category>Leetcode</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Leetcode</tag>
      
      <tag>ç®€å•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaæ•æ„Ÿè¯è¿‡æ»¤</title>
    <link href="/post/3285f0d6-d3c2-459a-9463-117ce411ad8a/"/>
    <url>/post/3285f0d6-d3c2-459a-9463-117ce411ad8a/</url>
    
    <content type="html"><![CDATA[<h3 id="Javaæ•æ„Ÿè¯è¿‡æ»¤"><a href="#Javaæ•æ„Ÿè¯è¿‡æ»¤" class="headerlink" title="Javaæ•æ„Ÿè¯è¿‡æ»¤"></a>Javaæ•æ„Ÿè¯è¿‡æ»¤</h3><p><code>hexo template generate by typora plugin templater</code></p><p><a href="https://github.com/houbb/sensitive-word?tab=readme-ov-file">houbb&#x2F;sensitive-word: ğŸ‘®â€â™‚ï¸The sensitive word tool for java.(æ•æ„Ÿè¯&#x2F;è¿ç¦è¯&#x2F;è¿æ³•è¯&#x2F;è„è¯ã€‚åŸºäº DFA ç®—æ³•å®ç°çš„é«˜æ€§èƒ½ java æ•æ„Ÿè¯è¿‡æ»¤å·¥å…·æ¡†æ¶ã€‚è¯·å‹¿å‘å¸ƒæ¶‰åŠæ”¿æ²»ã€å¹¿å‘Šã€è¥é”€ã€ç¿»å¢™ã€è¿åå›½å®¶æ³•å¾‹æ³•è§„ç­‰å†…å®¹ã€‚é«˜æ€§èƒ½æ•æ„Ÿè¯æ£€æµ‹è¿‡æ»¤ç»„ä»¶ï¼Œé™„å¸¦ç¹ä½“ç®€ä½“äº’æ¢ï¼Œæ”¯æŒå…¨è§’åŠè§’äº’æ¢ï¼Œæ±‰å­—è½¬æ‹¼éŸ³ï¼Œæ¨¡ç³Šæœç´¢ç­‰åŠŸèƒ½ã€‚) (github.com)</a></p><h1 id="sensitive-word"><a href="#sensitive-word" class="headerlink" title="sensitive-word"></a>sensitive-word</h1><p><a href="https://github.com/houbb/sensitive-word">sensitive-word</a> åŸºäº DFA ç®—æ³•å®ç°çš„é«˜æ€§èƒ½æ•æ„Ÿè¯å·¥å…·ã€‚</p><blockquote><p><a href="https://houbb.github.io/opensource/sensitive-word">åœ¨çº¿ä½“éªŒ</a></p></blockquote><p>å¦‚æœæœ‰ä¸€äº›ç–‘éš¾æ‚ç—‡ï¼Œå¯ä»¥åŠ å…¥ï¼š<a href="https://mp.weixin.qq.com/s/rkSvXxiiLGjl3S-ZOZCr0Q">æŠ€æœ¯äº¤æµç¾¤</a></p><p><a href="https://github.com/houbb/sensitive-word-admin">sensitive-word-admin</a> æ˜¯å¯¹åº”çš„æ§å°çš„åº”ç”¨ï¼Œç›®å‰åŠŸèƒ½å¤„äºåˆæœŸå¼€å‘ä¸­ï¼ŒMVP ç‰ˆæœ¬å¯ç”¨ã€‚</p><h2 id="åˆ›ä½œç›®çš„"><a href="#åˆ›ä½œç›®çš„" class="headerlink" title="åˆ›ä½œç›®çš„"></a>åˆ›ä½œç›®çš„</h2><p>å®ç°ä¸€æ¬¾å¥½ç”¨æ•æ„Ÿè¯å·¥å…·ã€‚</p><p>åŸºäº DFA ç®—æ³•å®ç°ï¼Œç›®å‰æ•æ„Ÿè¯åº“å†…å®¹æ”¶å½• 6W+ï¼ˆæºæ–‡ä»¶ 18W+ï¼Œç»è¿‡ä¸€æ¬¡åˆ å‡ï¼‰ã€‚</p><p>åæœŸå°†è¿›è¡ŒæŒç»­ä¼˜åŒ–å’Œè¡¥å……æ•æ„Ÿè¯åº“ï¼Œå¹¶è¿›ä¸€æ­¥æå‡ç®—æ³•çš„æ€§èƒ½ã€‚</p><p>å¸Œæœ›å¯ä»¥ç»†åŒ–æ•æ„Ÿè¯çš„åˆ†ç±»ï¼Œæ„Ÿè§‰å·¥ä½œé‡æ¯”è¾ƒå¤§ï¼Œæš‚æ—¶æ²¡æœ‰è¿›è¡Œã€‚</p><h2 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h2><ul><li>6W+ è¯åº“ï¼Œä¸”ä¸æ–­ä¼˜åŒ–æ›´æ–°</li><li>åŸºäº fluent-api å®ç°ï¼Œä½¿ç”¨ä¼˜é›…ç®€æ´</li><li><a href="https://github.com/houbb/sensitive-word#benchmark">åŸºäº DFA ç®—æ³•ï¼Œæ€§èƒ½ä¸º 7W+ QPSï¼Œåº”ç”¨æ— æ„Ÿ</a></li><li><a href="https://github.com/houbb/sensitive-word#%E6%A0%B8%E5%BF%83%E6%96%B9%E6%B3%95">æ”¯æŒæ•æ„Ÿè¯çš„åˆ¤æ–­ã€è¿”å›ã€è„±æ•ç­‰å¸¸è§æ“ä½œ</a></li><li><a href="https://github.com/houbb/sensitive-word#%E6%9B%B4%E5%A4%9A%E7%89%B9%E6%80%A7">æ”¯æŒå¸¸è§çš„æ ¼å¼è½¬æ¢</a></li></ul><p>å…¨è§’åŠè§’äº’æ¢ã€è‹±æ–‡å¤§å°å†™äº’æ¢ã€æ•°å­—å¸¸è§å½¢å¼çš„äº’æ¢ã€ä¸­æ–‡ç¹ç®€ä½“äº’æ¢ã€è‹±æ–‡å¸¸è§å½¢å¼çš„äº’æ¢ã€å¿½ç•¥é‡å¤è¯ç­‰</p><ul><li><a href="https://github.com/houbb/sensitive-word#%E6%9B%B4%E5%A4%9A%E6%A3%80%E6%B5%8B%E7%AD%96%E7%95%A5">æ”¯æŒæ•æ„Ÿè¯æ£€æµ‹ã€é‚®ç®±æ£€æµ‹ã€æ•°å­—æ£€æµ‹ã€ç½‘å€æ£€æµ‹ã€IPV4ç­‰</a></li><li><a href="https://github.com/houbb/sensitive-word#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9B%BF%E6%8D%A2%E7%AD%96%E7%95%A5">æ”¯æŒè‡ªå®šä¹‰æ›¿æ¢ç­–ç•¥</a></li><li><a href="https://github.com/houbb/sensitive-word#%E9%85%8D%E7%BD%AE%E4%BD%BF%E7%94%A8">æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰æ•æ„Ÿè¯å’Œç™½åå•</a></li><li><a href="https://github.com/houbb/sensitive-word#%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD%E7%94%A8%E6%88%B7%E8%87%AA%E5%AE%9A%E4%B9%89">æ”¯æŒæ•°æ®çš„æ•°æ®åŠ¨æ€æ›´æ–°ï¼ˆç”¨æˆ·è‡ªå®šä¹‰ï¼‰ï¼Œå®æ—¶ç”Ÿæ•ˆ</a></li><li><a href="https://github.com/houbb/sensitive-word#%E6%95%8F%E6%84%9F%E8%AF%8D%E6%A0%87%E7%AD%BE">æ”¯æŒæ•æ„Ÿè¯çš„æ ‡ç­¾æ¥å£</a></li><li><a href="https://github.com/houbb/sensitive-word#%E5%BF%BD%E7%95%A5%E5%AD%97%E7%AC%A6">æ”¯æŒè·³è¿‡ä¸€äº›ç‰¹æ®Šå­—ç¬¦ï¼Œè®©åŒ¹é…æ›´çµæ´»</a></li></ul><h2 id="å˜æ›´æ—¥å¿—"><a href="#å˜æ›´æ—¥å¿—" class="headerlink" title="å˜æ›´æ—¥å¿—"></a>å˜æ›´æ—¥å¿—</h2><p><a href="https://github.com/houbb/sensitive-word/blob/master/CHANGE_LOG.md">CHANGE_LOG.md</a></p><h3 id="V0-17-0"><a href="#V0-17-0" class="headerlink" title="V0.17.0"></a>V0.17.0</h3><ul><li>æ”¯æŒ ipv4</li></ul><h3 id="V0-18-0"><a href="#V0-18-0" class="headerlink" title="V0.18.0"></a>V0.18.0</h3><ul><li>ä¼˜åŒ– URL æ£€æµ‹ï¼Œé™ä½è¯¯åˆ¤ç‡</li></ul><h2 id="æ›´å¤šèµ„æ–™"><a href="#æ›´å¤šèµ„æ–™" class="headerlink" title="æ›´å¤šèµ„æ–™"></a>æ›´å¤šèµ„æ–™</h2><h3 id="æ•æ„Ÿè¯æ§å°"><a href="#æ•æ„Ÿè¯æ§å°" class="headerlink" title="æ•æ„Ÿè¯æ§å°"></a>æ•æ„Ÿè¯æ§å°</h3><p>æœ‰æ—¶å€™æ•æ„Ÿè¯æœ‰ä¸€ä¸ªæ§å°ï¼Œé…ç½®èµ·æ¥ä¼šæ›´åŠ çµæ´»æ–¹ä¾¿ã€‚</p><blockquote><p><a href="https://mp.weixin.qq.com/s/rQo75cfMU_OEbTJa0JGMGg">java å¦‚ä½•å®ç°å¼€ç®±å³ç”¨çš„æ•æ„Ÿè¯æ§å°æœåŠ¡ï¼Ÿ</a></p></blockquote><h3 id="æ•æ„Ÿè¯æ ‡ç­¾æ–‡ä»¶"><a href="#æ•æ„Ÿè¯æ ‡ç­¾æ–‡ä»¶" class="headerlink" title="æ•æ„Ÿè¯æ ‡ç­¾æ–‡ä»¶"></a>æ•æ„Ÿè¯æ ‡ç­¾æ–‡ä»¶</h3><p>æ¢³ç†äº†å¤§é‡çš„æ•æ„Ÿè¯æ ‡ç­¾æ–‡ä»¶ï¼Œå¯ä»¥è®©æˆ‘ä»¬çš„æ•æ„Ÿè¯æ›´åŠ æ–¹ä¾¿ã€‚</p><p>è¿™ä¸¤ä¸ªèµ„æ–™é˜…è¯»å¯åœ¨ä¸‹æ–¹æ–‡ç« è·å–ï¼š</p><blockquote><p><a href="https://mp.weixin.qq.com/s/m40ZnR6YF6WgPrArUSZ_0g">v0.11.0-æ•æ„Ÿè¯æ–°ç‰¹æ€§åŠå¯¹åº”æ ‡ç­¾æ–‡ä»¶</a></p></blockquote><h1 id="å¿«é€Ÿå¼€å§‹"><a href="#å¿«é€Ÿå¼€å§‹" class="headerlink" title="å¿«é€Ÿå¼€å§‹"></a>å¿«é€Ÿå¼€å§‹</h1><h2 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h2><ul><li>JDK1.8+</li><li>Maven 3.x+</li></ul><h2 id="Maven-å¼•å…¥"><a href="#Maven-å¼•å…¥" class="headerlink" title="Maven å¼•å…¥"></a>Maven å¼•å…¥</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.github.houbb<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>sensitive-word<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.18.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="æ ¸å¿ƒæ–¹æ³•"><a href="#æ ¸å¿ƒæ–¹æ³•" class="headerlink" title="æ ¸å¿ƒæ–¹æ³•"></a>æ ¸å¿ƒæ–¹æ³•</h2><p><code>SensitiveWordHelper</code> ä½œä¸ºæ•æ„Ÿè¯çš„å·¥å…·ç±»ï¼Œæ ¸å¿ƒæ–¹æ³•å¦‚ä¸‹ï¼š</p><table><thead><tr><th>æ–¹æ³•</th><th>å‚æ•°</th><th>è¿”å›å€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>contains(String)</td><td>å¾…éªŒè¯çš„å­—ç¬¦ä¸²</td><td>å¸ƒå°”å€¼</td><td>éªŒè¯å­—ç¬¦ä¸²æ˜¯å¦åŒ…å«æ•æ„Ÿè¯</td></tr><tr><td>replace(String, ISensitiveWordReplace)</td><td>ä½¿ç”¨æŒ‡å®šçš„æ›¿æ¢ç­–ç•¥æ›¿æ¢æ•æ„Ÿè¯</td><td>å­—ç¬¦ä¸²</td><td>è¿”å›è„±æ•åçš„å­—ç¬¦ä¸²</td></tr><tr><td>replace(String, char)</td><td>ä½¿ç”¨æŒ‡å®šçš„ char æ›¿æ¢æ•æ„Ÿè¯</td><td>å­—ç¬¦ä¸²</td><td>è¿”å›è„±æ•åçš„å­—ç¬¦ä¸²</td></tr><tr><td>replace(String)</td><td>ä½¿ç”¨ <code>*</code> æ›¿æ¢æ•æ„Ÿè¯</td><td>å­—ç¬¦ä¸²</td><td>è¿”å›è„±æ•åçš„å­—ç¬¦ä¸²</td></tr><tr><td>findAll(String)</td><td>å¾…éªŒè¯çš„å­—ç¬¦ä¸²</td><td>å­—ç¬¦ä¸²åˆ—è¡¨</td><td>è¿”å›å­—ç¬¦ä¸²ä¸­æ‰€æœ‰æ•æ„Ÿè¯</td></tr><tr><td>findFirst(String)</td><td>å¾…éªŒè¯çš„å­—ç¬¦ä¸²</td><td>å­—ç¬¦ä¸²</td><td>è¿”å›å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªæ•æ„Ÿè¯</td></tr><tr><td>findAll(String, IWordResultHandler)</td><td>IWordResultHandler ç»“æœå¤„ç†ç±»</td><td>å­—ç¬¦ä¸²åˆ—è¡¨</td><td>è¿”å›å­—ç¬¦ä¸²ä¸­æ‰€æœ‰æ•æ„Ÿè¯</td></tr><tr><td>findFirst(String, IWordResultHandler)</td><td>IWordResultHandler ç»“æœå¤„ç†ç±»</td><td>å­—ç¬¦ä¸²</td><td>è¿”å›å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªæ•æ„Ÿè¯</td></tr><tr><td>tags(String)</td><td>è·å–æ•æ„Ÿè¯çš„æ ‡ç­¾</td><td>æ•æ„Ÿè¯å­—ç¬¦ä¸²</td><td>è¿”å›æ•æ„Ÿè¯çš„æ ‡ç­¾åˆ—è¡¨</td></tr></tbody></table><h3 id="åˆ¤æ–­æ˜¯å¦åŒ…å«æ•æ„Ÿè¯"><a href="#åˆ¤æ–­æ˜¯å¦åŒ…å«æ•æ„Ÿè¯" class="headerlink" title="åˆ¤æ–­æ˜¯å¦åŒ…å«æ•æ„Ÿè¯"></a>åˆ¤æ–­æ˜¯å¦åŒ…å«æ•æ„Ÿè¯</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;äº”æ˜Ÿçº¢æ——è¿é£é£˜æ‰¬ï¼Œæ¯›ä¸»å¸­çš„ç”»åƒå±¹ç«‹åœ¨å¤©å®‰é—¨å‰ã€‚&quot;</span>;<br><br>Assert.assertTrue(SensitiveWordHelper.contains(text));<br></code></pre></td></tr></table></figure><h3 id="è¿”å›ç¬¬ä¸€ä¸ªæ•æ„Ÿè¯"><a href="#è¿”å›ç¬¬ä¸€ä¸ªæ•æ„Ÿè¯" class="headerlink" title="è¿”å›ç¬¬ä¸€ä¸ªæ•æ„Ÿè¯"></a>è¿”å›ç¬¬ä¸€ä¸ªæ•æ„Ÿè¯</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;äº”æ˜Ÿçº¢æ——è¿é£é£˜æ‰¬ï¼Œæ¯›ä¸»å¸­çš„ç”»åƒå±¹ç«‹åœ¨å¤©å®‰é—¨å‰ã€‚&quot;</span>;<br><br><span class="hljs-type">String</span> <span class="hljs-variable">word</span> <span class="hljs-operator">=</span> SensitiveWordHelper.findFirst(text);<br>Assert.assertEquals(<span class="hljs-string">&quot;äº”æ˜Ÿçº¢æ——&quot;</span>, word);<br></code></pre></td></tr></table></figure><p>SensitiveWordHelper.findFirst(text) ç­‰ä»·äºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">word</span> <span class="hljs-operator">=</span> SensitiveWordHelper.findFirst(text, WordResultHandlers.word());<br></code></pre></td></tr></table></figure><h3 id="è¿”å›æ‰€æœ‰æ•æ„Ÿè¯"><a href="#è¿”å›æ‰€æœ‰æ•æ„Ÿè¯" class="headerlink" title="è¿”å›æ‰€æœ‰æ•æ„Ÿè¯"></a>è¿”å›æ‰€æœ‰æ•æ„Ÿè¯</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;äº”æ˜Ÿçº¢æ——è¿é£é£˜æ‰¬ï¼Œæ¯›ä¸»å¸­çš„ç”»åƒå±¹ç«‹åœ¨å¤©å®‰é—¨å‰ã€‚&quot;</span>;<br><br>List&lt;String&gt; wordList = SensitiveWordHelper.findAll(text);<br>Assert.assertEquals(<span class="hljs-string">&quot;[äº”æ˜Ÿçº¢æ——, æ¯›ä¸»å¸­, å¤©å®‰é—¨]&quot;</span>, wordList.toString());<br></code></pre></td></tr></table></figure><p>è¿”å›æ‰€æœ‰æ•æ„Ÿè¯ç”¨æ³•ä¸Šç±»ä¼¼äº SensitiveWordHelper.findFirst()ï¼ŒåŒæ ·ä¹Ÿæ”¯æŒæŒ‡å®šç»“æœå¤„ç†ç±»ã€‚</p><p>SensitiveWordHelper.findAll(text) ç­‰ä»·äºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;String&gt; wordList = SensitiveWordHelper.findAll(text, WordResultHandlers.word());<br></code></pre></td></tr></table></figure><p>WordResultHandlers.raw() å¯ä»¥ä¿ç•™å¯¹åº”çš„ä¸‹æ ‡ä¿¡æ¯ã€ç±»åˆ«ä¿¡æ¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;äº”æ˜Ÿçº¢æ——è¿é£é£˜æ‰¬ï¼Œæ¯›ä¸»å¸­çš„ç”»åƒå±¹ç«‹åœ¨å¤©å®‰é—¨å‰ã€‚&quot;</span>;<br><br><span class="hljs-comment">// é»˜è®¤æ•æ„Ÿè¯æ ‡ç­¾ä¸ºç©º</span><br>List&lt;WordTagsDto&gt; wordList1 = SensitiveWordHelper.findAll(text, WordResultHandlers.wordTags());<br>Assert.assertEquals(<span class="hljs-string">&quot;[WordTagsDto&#123;word=&#x27;äº”æ˜Ÿçº¢æ——&#x27;, tags=[]&#125;, WordTagsDto&#123;word=&#x27;æ¯›ä¸»å¸­&#x27;, tags=[]&#125;, WordTagsDto&#123;word=&#x27;å¤©å®‰é—¨&#x27;, tags=[]&#125;]&quot;</span>, wordList1.toString());<br></code></pre></td></tr></table></figure><h3 id="é»˜è®¤çš„æ›¿æ¢ç­–ç•¥"><a href="#é»˜è®¤çš„æ›¿æ¢ç­–ç•¥" class="headerlink" title="é»˜è®¤çš„æ›¿æ¢ç­–ç•¥"></a>é»˜è®¤çš„æ›¿æ¢ç­–ç•¥</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;äº”æ˜Ÿçº¢æ——è¿é£é£˜æ‰¬ï¼Œæ¯›ä¸»å¸­çš„ç”»åƒå±¹ç«‹åœ¨å¤©å®‰é—¨å‰ã€‚&quot;</span>;<br><span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> SensitiveWordHelper.replace(text);<br>Assert.assertEquals(<span class="hljs-string">&quot;****è¿é£é£˜æ‰¬ï¼Œ***çš„ç”»åƒå±¹ç«‹åœ¨***å‰ã€‚&quot;</span>, result);<br></code></pre></td></tr></table></figure><h3 id="æŒ‡å®šæ›¿æ¢çš„å†…å®¹"><a href="#æŒ‡å®šæ›¿æ¢çš„å†…å®¹" class="headerlink" title="æŒ‡å®šæ›¿æ¢çš„å†…å®¹"></a>æŒ‡å®šæ›¿æ¢çš„å†…å®¹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;äº”æ˜Ÿçº¢æ——è¿é£é£˜æ‰¬ï¼Œæ¯›ä¸»å¸­çš„ç”»åƒå±¹ç«‹åœ¨å¤©å®‰é—¨å‰ã€‚&quot;</span>;<br><span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> SensitiveWordHelper.replace(text, <span class="hljs-string">&#x27;0&#x27;</span>);<br>Assert.assertEquals(<span class="hljs-string">&quot;0000è¿é£é£˜æ‰¬ï¼Œ000çš„ç”»åƒå±¹ç«‹åœ¨000å‰ã€‚&quot;</span>, result);<br></code></pre></td></tr></table></figure><h3 id="è‡ªå®šä¹‰æ›¿æ¢ç­–ç•¥"><a href="#è‡ªå®šä¹‰æ›¿æ¢ç­–ç•¥" class="headerlink" title="è‡ªå®šä¹‰æ›¿æ¢ç­–ç•¥"></a>è‡ªå®šä¹‰æ›¿æ¢ç­–ç•¥</h3><p>V0.2.0 æ”¯æŒè¯¥ç‰¹æ€§ã€‚</p><p>åœºæ™¯è¯´æ˜ï¼šæœ‰æ—¶å€™æˆ‘ä»¬å¸Œæœ›ä¸åŒçš„æ•æ„Ÿè¯æœ‰ä¸åŒçš„æ›¿æ¢ç»“æœã€‚æ¯”å¦‚ã€æ¸¸æˆã€‘æ›¿æ¢ä¸ºã€ç”µå­ç«æŠ€ã€‘ï¼Œã€å¤±ä¸šã€‘æ›¿æ¢ä¸ºã€çµæ´»å°±ä¸šã€‘ã€‚</p><p>è¯šç„¶ï¼Œæå‰ä½¿ç”¨å­—ç¬¦ä¸²çš„æ­£åˆ™æ›¿æ¢ä¹Ÿå¯ä»¥ï¼Œä¸è¿‡æ€§èƒ½ä¸€èˆ¬ã€‚</p><p>ä½¿ç”¨ä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è‡ªå®šæ›¿æ¢ç­–ç•¥</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@since</span> 0.2.0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">defineReplaceTest</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;äº”æ˜Ÿçº¢æ——è¿é£é£˜æ‰¬ï¼Œæ¯›ä¸»å¸­çš„ç”»åƒå±¹ç«‹åœ¨å¤©å®‰é—¨å‰ã€‚&quot;</span>;<br><br>    <span class="hljs-type">ISensitiveWordReplace</span> <span class="hljs-variable">replace</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MySensitiveWordReplace</span>();<br>    <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> SensitiveWordHelper.replace(text, replace);<br><br>    Assert.assertEquals(<span class="hljs-string">&quot;å›½å®¶æ——å¸œè¿é£é£˜æ‰¬ï¼Œæ•™å‘˜çš„ç”»åƒå±¹ç«‹åœ¨***å‰ã€‚&quot;</span>, result);<br>&#125;<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ <code>MySensitiveWordReplace</code> æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„æ›¿æ¢ç­–ç•¥ï¼Œå®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyWordReplace</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IWordReplace</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">replace</span><span class="hljs-params">(StringBuilder stringBuilder, <span class="hljs-keyword">final</span> <span class="hljs-type">char</span>[] rawChars, IWordResult wordResult, IWordContext wordContext)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">sensitiveWord</span> <span class="hljs-operator">=</span> InnerWordCharUtils.getString(rawChars, wordResult);<br>        <span class="hljs-comment">// è‡ªå®šä¹‰ä¸åŒçš„æ•æ„Ÿè¯æ›¿æ¢ç­–ç•¥ï¼Œå¯ä»¥ä»æ•°æ®åº“ç­‰åœ°æ–¹è¯»å–</span><br>        <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;äº”æ˜Ÿçº¢æ——&quot;</span>.equals(sensitiveWord)) &#123;<br>            stringBuilder.append(<span class="hljs-string">&quot;å›½å®¶æ——å¸œ&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;æ¯›ä¸»å¸­&quot;</span>.equals(sensitiveWord)) &#123;<br>            stringBuilder.append(<span class="hljs-string">&quot;æ•™å‘˜&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// å…¶ä»–é»˜è®¤ä½¿ç”¨ * ä»£æ›¿</span><br>            <span class="hljs-type">int</span> <span class="hljs-variable">wordLength</span> <span class="hljs-operator">=</span> wordResult.endIndex() - wordResult.startIndex();<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; wordLength; i++) &#123;<br>                stringBuilder.append(<span class="hljs-string">&#x27;*&#x27;</span>);<br>            &#125;<br>        &#125;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬é’ˆå¯¹å…¶ä¸­çš„éƒ¨åˆ†è¯åšå›ºå®šæ˜ å°„å¤„ç†ï¼Œå…¶ä»–çš„é»˜è®¤è½¬æ¢ä¸º <code>*</code>ã€‚</p><h2 id="IWordResultHandler-ç»“æœå¤„ç†ç±»"><a href="#IWordResultHandler-ç»“æœå¤„ç†ç±»" class="headerlink" title="IWordResultHandler ç»“æœå¤„ç†ç±»"></a>IWordResultHandler ç»“æœå¤„ç†ç±»</h2><p>IWordResultHandler å¯ä»¥å¯¹æ•æ„Ÿè¯çš„ç»“æœè¿›è¡Œå¤„ç†ï¼Œå…è®¸ç”¨æˆ·è‡ªå®šä¹‰ã€‚</p><p>å†…ç½®å®ç°è§ <code>WordResultHandlers</code> å·¥å…·ç±»ï¼š</p><ul><li>WordResultHandlers.word()</li></ul><p>åªä¿ç•™æ•æ„Ÿè¯å•è¯æœ¬èº«ã€‚</p><ul><li>WordResultHandlers.raw()</li></ul><p>ä¿ç•™æ•æ„Ÿè¯ç›¸å…³ä¿¡æ¯ï¼ŒåŒ…å«æ•æ„Ÿè¯çš„å¼€å§‹å’Œç»“æŸä¸‹æ ‡ã€‚</p><ul><li>WordResultHandlers.wordTags()</li></ul><p>åŒæ—¶ä¿ç•™å•è¯ï¼Œå’Œå¯¹åº”çš„è¯æ ‡ç­¾ä¿¡æ¯ã€‚</p><h3 id="ä½¿ç”¨å®ä¾‹"><a href="#ä½¿ç”¨å®ä¾‹" class="headerlink" title="ä½¿ç”¨å®ä¾‹"></a>ä½¿ç”¨å®ä¾‹</h3><p>æ‰€æœ‰æµ‹è¯•æ¡ˆä¾‹å‚è§ <a href="https://github.com/houbb/sensitive-word/blob/master/src/test/java/com/github/houbb/sensitive/word/core/SensitiveWordHelperTest.java">SensitiveWordHelperTest</a></p><p>1ï¼‰åŸºæœ¬ä¾‹å­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;äº”æ˜Ÿçº¢æ——è¿é£é£˜æ‰¬ï¼Œæ¯›ä¸»å¸­çš„ç”»åƒå±¹ç«‹åœ¨å¤©å®‰é—¨å‰ã€‚&quot;</span>;<br><br>List&lt;String&gt; wordList = SensitiveWordHelper.findAll(text);<br>Assert.assertEquals(<span class="hljs-string">&quot;[äº”æ˜Ÿçº¢æ——, æ¯›ä¸»å¸­, å¤©å®‰é—¨]&quot;</span>, wordList.toString());<br>List&lt;String&gt; wordList2 = SensitiveWordHelper.findAll(text, WordResultHandlers.word());<br>Assert.assertEquals(<span class="hljs-string">&quot;[äº”æ˜Ÿçº¢æ——, æ¯›ä¸»å¸­, å¤©å®‰é—¨]&quot;</span>, wordList2.toString());<br><br>List&lt;IWordResult&gt; wordList3 = SensitiveWordHelper.findAll(text, WordResultHandlers.raw());<br>Assert.assertEquals(<span class="hljs-string">&quot;[WordResult&#123;startIndex=0, endIndex=4&#125;, WordResult&#123;startIndex=9, endIndex=12&#125;, WordResult&#123;startIndex=18, endIndex=21&#125;]&quot;</span>, wordList3.toString());<br></code></pre></td></tr></table></figure><ol><li>wordTags ä¾‹å­</li></ol><p>æˆ‘ä»¬åœ¨ <code>dict_tag_test.txt</code> æ–‡ä»¶ä¸­æŒ‡å®šå¯¹åº”è¯çš„æ ‡ç­¾ä¿¡æ¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;äº”æ˜Ÿçº¢æ——è¿é£é£˜æ‰¬ï¼Œæ¯›ä¸»å¸­çš„ç”»åƒå±¹ç«‹åœ¨å¤©å®‰é—¨å‰ã€‚&quot;</span>;<br><br><span class="hljs-comment">// é»˜è®¤æ•æ„Ÿè¯æ ‡ç­¾ä¸ºç©º</span><br>List&lt;WordTagsDto&gt; wordList1 = SensitiveWordHelper.findAll(text, WordResultHandlers.wordTags());<br>Assert.assertEquals(<span class="hljs-string">&quot;[WordTagsDto&#123;word=&#x27;äº”æ˜Ÿçº¢æ——&#x27;, tags=[]&#125;, WordTagsDto&#123;word=&#x27;æ¯›ä¸»å¸­&#x27;, tags=[]&#125;, WordTagsDto&#123;word=&#x27;å¤©å®‰é—¨&#x27;, tags=[]&#125;]&quot;</span>, wordList1.toString());<br><br>List&lt;WordTagsDto&gt; wordList2 = SensitiveWordBs.newInstance()<br>        .wordTag(WordTags.file(<span class="hljs-string">&quot;dict_tag_test.txt&quot;</span>))<br>        .init()<br>        .findAll(text, WordResultHandlers.wordTags());<br>Assert.assertEquals(<span class="hljs-string">&quot;[WordTagsDto&#123;word=&#x27;äº”æ˜Ÿçº¢æ——&#x27;, tags=[æ”¿æ²», å›½å®¶]&#125;, WordTagsDto&#123;word=&#x27;æ¯›ä¸»å¸­&#x27;, tags=[æ”¿æ²», ä¼Ÿäºº, å›½å®¶]&#125;, WordTagsDto&#123;word=&#x27;å¤©å®‰é—¨&#x27;, tags=[æ”¿æ²», å›½å®¶, åœ°å€]&#125;]&quot;</span>, wordList2.toString());<br></code></pre></td></tr></table></figure><h1 id="æ›´å¤šç‰¹æ€§"><a href="#æ›´å¤šç‰¹æ€§" class="headerlink" title="æ›´å¤šç‰¹æ€§"></a>æ›´å¤šç‰¹æ€§</h1><p>åç»­çš„è¯¸å¤šç‰¹æ€§ï¼Œä¸»è¦æ˜¯é’ˆå¯¹å„ç§é’ˆå¯¹å„ç§æƒ…å†µçš„å¤„ç†ï¼Œå°½å¯èƒ½çš„æå‡æ•æ„Ÿè¯å‘½ä¸­ç‡ã€‚</p><p>è¿™æ˜¯ä¸€åœºæ¼«é•¿çš„æ”»é˜²ä¹‹æˆ˜ã€‚</p><h2 id="æ ·å¼å¤„ç†"><a href="#æ ·å¼å¤„ç†" class="headerlink" title="æ ·å¼å¤„ç†"></a>æ ·å¼å¤„ç†</h2><h3 id="å¿½ç•¥å¤§å°å†™"><a href="#å¿½ç•¥å¤§å°å†™" class="headerlink" title="å¿½ç•¥å¤§å°å†™"></a>å¿½ç•¥å¤§å°å†™</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;fuCK the bad words.&quot;</span>;<br><br><span class="hljs-type">String</span> <span class="hljs-variable">word</span> <span class="hljs-operator">=</span> SensitiveWordHelper.findFirst(text);<br>Assert.assertEquals(<span class="hljs-string">&quot;fuCK&quot;</span>, word);<br></code></pre></td></tr></table></figure><h3 id="å¿½ç•¥åŠè§’åœ†è§’"><a href="#å¿½ç•¥åŠè§’åœ†è§’" class="headerlink" title="å¿½ç•¥åŠè§’åœ†è§’"></a>å¿½ç•¥åŠè§’åœ†è§’</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;ï½†ï½•ï½ƒï½‹ the bad words.&quot;</span>;<br><br><span class="hljs-type">String</span> <span class="hljs-variable">word</span> <span class="hljs-operator">=</span> SensitiveWordHelper.findFirst(text);<br>Assert.assertEquals(<span class="hljs-string">&quot;ï½†ï½•ï½ƒï½‹&quot;</span>, word);<br></code></pre></td></tr></table></figure><h3 id="å¿½ç•¥æ•°å­—çš„å†™æ³•"><a href="#å¿½ç•¥æ•°å­—çš„å†™æ³•" class="headerlink" title="å¿½ç•¥æ•°å­—çš„å†™æ³•"></a>å¿½ç•¥æ•°å­—çš„å†™æ³•</h3><p>è¿™é‡Œå®ç°äº†æ•°å­—å¸¸è§å½¢å¼çš„è½¬æ¢ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;è¿™ä¸ªæ˜¯æˆ‘çš„å¾®ä¿¡ï¼š9â“¿äºŒè‚†â¹â‚ˆâ‘¢â‘¸â’‹âƒãˆ¤ãŠ„&quot;</span>;<br><br>List&lt;String&gt; wordList = SensitiveWordBs.newInstance().enableNumCheck(<span class="hljs-literal">true</span>).init().findAll(text);<br>Assert.assertEquals(<span class="hljs-string">&quot;[9â“¿äºŒè‚†â¹â‚ˆâ‘¢â‘¸â’‹âƒãˆ¤ãŠ„]&quot;</span>, wordList.toString());<br></code></pre></td></tr></table></figure><h3 id="å¿½ç•¥ç¹ç®€ä½“"><a href="#å¿½ç•¥ç¹ç®€ä½“" class="headerlink" title="å¿½ç•¥ç¹ç®€ä½“"></a>å¿½ç•¥ç¹ç®€ä½“</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;æˆ‘çˆ±æˆ‘çš„ç¥–å›½å’Œäº”æ˜Ÿç´…æ——ã€‚&quot;</span>;<br><br>List&lt;String&gt; wordList = SensitiveWordHelper.findAll(text);<br>Assert.assertEquals(<span class="hljs-string">&quot;[äº”æ˜Ÿç´…æ——]&quot;</span>, wordList.toString());<br></code></pre></td></tr></table></figure><h3 id="å¿½ç•¥è‹±æ–‡çš„ä¹¦å†™æ ¼å¼"><a href="#å¿½ç•¥è‹±æ–‡çš„ä¹¦å†™æ ¼å¼" class="headerlink" title="å¿½ç•¥è‹±æ–‡çš„ä¹¦å†™æ ¼å¼"></a>å¿½ç•¥è‹±æ–‡çš„ä¹¦å†™æ ¼å¼</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;â’»â“¤câ’¦ the bad words&quot;</span>;<br><br>List&lt;String&gt; wordList = SensitiveWordHelper.findAll(text);<br>Assert.assertEquals(<span class="hljs-string">&quot;[â’»â“¤câ’¦]&quot;</span>, wordList.toString());<br></code></pre></td></tr></table></figure><h3 id="å¿½ç•¥é‡å¤è¯"><a href="#å¿½ç•¥é‡å¤è¯" class="headerlink" title="å¿½ç•¥é‡å¤è¯"></a>å¿½ç•¥é‡å¤è¯</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;â’»â’»â’»fâ“¤uâ“¤â’°câ“’â’¦ the bad words&quot;</span>;<br><br>List&lt;String&gt; wordList = SensitiveWordBs.newInstance()<br>        .ignoreRepeat(<span class="hljs-literal">true</span>)<br>        .init()<br>        .findAll(text);<br>Assert.assertEquals(<span class="hljs-string">&quot;[â’»â’»â’»fâ“¤uâ“¤â’°câ“’â’¦]&quot;</span>, wordList.toString());<br></code></pre></td></tr></table></figure><h2 id="æ›´å¤šæ£€æµ‹ç­–ç•¥"><a href="#æ›´å¤šæ£€æµ‹ç­–ç•¥" class="headerlink" title="æ›´å¤šæ£€æµ‹ç­–ç•¥"></a>æ›´å¤šæ£€æµ‹ç­–ç•¥</h2><h3 id="é‚®ç®±æ£€æµ‹"><a href="#é‚®ç®±æ£€æµ‹" class="headerlink" title="é‚®ç®±æ£€æµ‹"></a>é‚®ç®±æ£€æµ‹</h3><p>é‚®ç®±ç­‰ä¸ªäººä¿¡æ¯ï¼Œé»˜è®¤æœªå¯ç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;æ¥¼ä¸»å¥½äººï¼Œé‚®ç®± sensitiveword@xx.com&quot;</span>;<br>List&lt;String&gt; wordList = SensitiveWordBs.newInstance().enableEmailCheck(<span class="hljs-literal">true</span>).init().findAll(text);<br>Assert.assertEquals(<span class="hljs-string">&quot;[sensitiveword@xx.com]&quot;</span>, wordList.toString());<br></code></pre></td></tr></table></figure><h3 id="è¿ç»­æ•°å­—æ£€æµ‹"><a href="#è¿ç»­æ•°å­—æ£€æµ‹" class="headerlink" title="è¿ç»­æ•°å­—æ£€æµ‹"></a>è¿ç»­æ•°å­—æ£€æµ‹</h3><p>ä¸€èˆ¬ç”¨äºè¿‡æ»¤æ‰‹æœºå·&#x2F;QQç­‰å¹¿å‘Šä¿¡æ¯ï¼Œé»˜è®¤æœªå¯ç”¨ã€‚</p><p>V0.2.1 ä¹‹åï¼Œæ”¯æŒé€šè¿‡ <code>numCheckLen(é•¿åº¦)</code> è‡ªå®šä¹‰æ£€æµ‹çš„é•¿åº¦ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;ä½ æ‡‚å¾—ï¼š12345678&quot;</span>;<br><br><span class="hljs-comment">// é»˜è®¤æ£€æµ‹ 8 ä½</span><br>List&lt;String&gt; wordList = SensitiveWordBs.newInstance()<br>.enableNumCheck(<span class="hljs-literal">true</span>)<br>.init().findAll(text);<br>Assert.assertEquals(<span class="hljs-string">&quot;[12345678]&quot;</span>, wordList.toString());<br><br><span class="hljs-comment">// æŒ‡å®šæ•°å­—çš„é•¿åº¦ï¼Œé¿å…è¯¯æ€</span><br>List&lt;String&gt; wordList2 = SensitiveWordBs.newInstance()<br>.enableNumCheck(<span class="hljs-literal">true</span>)<br>.numCheckLen(<span class="hljs-number">9</span>)<br>.init()<br>.findAll(text);<br>Assert.assertEquals(<span class="hljs-string">&quot;[]&quot;</span>, wordList2.toString());<br>```java<br><br><br><br>### ç½‘å€æ£€æµ‹<br><br><br><br>ç”¨äºè¿‡æ»¤å¸¸è§çš„ç½‘å€ä¿¡æ¯ï¼Œé»˜è®¤æœªå¯ç”¨ã€‚<br><br>v0<span class="hljs-number">.18</span><span class="hljs-number">.0</span> ä¼˜åŒ– URL æ£€æµ‹ï¼Œæ›´åŠ ä¸¥æ ¼ï¼Œé™ä½è¯¯åˆ¤ç‡<br><br>```java<br><span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;ç‚¹å‡»é“¾æ¥ https://www.baidu.com æŸ¥çœ‹ç­”æ¡ˆ&quot;</span>;<br><span class="hljs-keyword">final</span> <span class="hljs-type">SensitiveWordBs</span> <span class="hljs-variable">sensitiveWordBs</span> <span class="hljs-operator">=</span> SensitiveWordBs.newInstance().enableUrlCheck(<span class="hljs-literal">true</span>).init();<br>List&lt;String&gt; wordList = sensitiveWordBs.findAll(text);<br>Assert.assertEquals(<span class="hljs-string">&quot;[https://www.baidu.com]&quot;</span>, wordList.toString());<br>Assert.assertEquals(<span class="hljs-string">&quot;ç‚¹å‡»é“¾æ¥ ********************* æŸ¥çœ‹ç­”æ¡ˆ&quot;</span>, sensitiveWordBs.replace(text));<br></code></pre></td></tr></table></figure><h3 id="IPV4-æ£€æµ‹"><a href="#IPV4-æ£€æµ‹" class="headerlink" title="IPV4 æ£€æµ‹"></a>IPV4 æ£€æµ‹</h3><p>v0.17.0 æ”¯æŒ</p><p>é¿å…ç”¨æˆ·é€šè¿‡ ip ç»•è¿‡ç½‘å€æ£€æµ‹ç­‰ï¼Œé»˜è®¤æœªå¯ç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;ä¸ªäººç½‘ç«™ï¼Œå¦‚æœç½‘å€æ‰“ä¸å¼€å¯ä»¥è®¿é—® 127.0.0.1ã€‚&quot;</span>;<br><span class="hljs-keyword">final</span> <span class="hljs-type">SensitiveWordBs</span> <span class="hljs-variable">sensitiveWordBs</span> <span class="hljs-operator">=</span> SensitiveWordBs.newInstance().enableIpv4Check(<span class="hljs-literal">true</span>).init();<br>List&lt;String&gt; wordList = sensitiveWordBs.findAll(text);<br>Assert.assertEquals(<span class="hljs-string">&quot;[127.0.0.1]&quot;</span>, wordList.toString());<br></code></pre></td></tr></table></figure><h1 id="å¼•å¯¼ç±»ç‰¹æ€§é…ç½®"><a href="#å¼•å¯¼ç±»ç‰¹æ€§é…ç½®" class="headerlink" title="å¼•å¯¼ç±»ç‰¹æ€§é…ç½®"></a>å¼•å¯¼ç±»ç‰¹æ€§é…ç½®</h1><h2 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h2><p>ä¸Šé¢çš„ç‰¹æ€§é»˜è®¤éƒ½æ˜¯å¼€å¯çš„ï¼Œæœ‰æ—¶ä¸šåŠ¡éœ€è¦çµæ´»å®šä¹‰ç›¸å…³çš„é…ç½®ç‰¹æ€§ã€‚</p><p>æ‰€ä»¥ v0.0.14 å¼€æ”¾äº†å±æ€§é…ç½®ã€‚</p><h2 id="é…ç½®æ–¹æ³•"><a href="#é…ç½®æ–¹æ³•" class="headerlink" title="é…ç½®æ–¹æ³•"></a>é…ç½®æ–¹æ³•</h2><p>ä¸ºäº†è®©ä½¿ç”¨æ›´åŠ ä¼˜é›…ï¼Œç»Ÿä¸€ä½¿ç”¨ fluent-api çš„æ–¹å¼å®šä¹‰ã€‚</p><p>ç”¨æˆ·å¯ä»¥ä½¿ç”¨ <code>SensitiveWordBs</code> è¿›è¡Œå¦‚ä¸‹å®šä¹‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">SensitiveWordBs</span> <span class="hljs-variable">wordBs</span> <span class="hljs-operator">=</span> SensitiveWordBs.newInstance()<br>        .ignoreCase(<span class="hljs-literal">true</span>)<br>        .ignoreWidth(<span class="hljs-literal">true</span>)<br>        .ignoreNumStyle(<span class="hljs-literal">true</span>)<br>        .ignoreChineseStyle(<span class="hljs-literal">true</span>)<br>        .ignoreEnglishStyle(<span class="hljs-literal">true</span>)<br>        .ignoreRepeat(<span class="hljs-literal">false</span>)<br>        .enableNumCheck(<span class="hljs-literal">false</span>)<br>        .enableEmailCheck(<span class="hljs-literal">false</span>)<br>        .enableUrlCheck(<span class="hljs-literal">false</span>)<br>        .enableIpv4Check(<span class="hljs-literal">false</span>)<br>        .enableWordCheck(<span class="hljs-literal">true</span>)<br>        .numCheckLen(<span class="hljs-number">8</span>)<br>        .wordTag(WordTags.none())<br>        .charIgnore(SensitiveWordCharIgnores.defaults())<br>        .wordResultCondition(WordResultConditions.alwaysTrue())<br>        .init();<br><br><span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;äº”æ˜Ÿçº¢æ——è¿é£é£˜æ‰¬ï¼Œæ¯›ä¸»å¸­çš„ç”»åƒå±¹ç«‹åœ¨å¤©å®‰é—¨å‰ã€‚&quot;</span>;<br>Assert.assertTrue(wordBs.contains(text));<br></code></pre></td></tr></table></figure><h2 id="é…ç½®è¯´æ˜"><a href="#é…ç½®è¯´æ˜" class="headerlink" title="é…ç½®è¯´æ˜"></a>é…ç½®è¯´æ˜</h2><p>å…¶ä¸­å„é¡¹é…ç½®çš„è¯´æ˜å¦‚ä¸‹ï¼š</p><table><thead><tr><th>åºå·</th><th>æ–¹æ³•</th><th>è¯´æ˜</th><th>é»˜è®¤å€¼</th></tr></thead><tbody><tr><td>1</td><td>ignoreCase</td><td>å¿½ç•¥å¤§å°å†™</td><td>true</td></tr><tr><td>2</td><td>ignoreWidth</td><td>å¿½ç•¥åŠè§’åœ†è§’</td><td>true</td></tr><tr><td>3</td><td>ignoreNumStyle</td><td>å¿½ç•¥æ•°å­—çš„å†™æ³•</td><td>true</td></tr><tr><td>4</td><td>ignoreChineseStyle</td><td>å¿½ç•¥ä¸­æ–‡çš„ä¹¦å†™æ ¼å¼</td><td>true</td></tr><tr><td>5</td><td>ignoreEnglishStyle</td><td>å¿½ç•¥è‹±æ–‡çš„ä¹¦å†™æ ¼å¼</td><td>true</td></tr><tr><td>6</td><td>ignoreRepeat</td><td>å¿½ç•¥é‡å¤è¯</td><td>false</td></tr><tr><td>7</td><td>enableNumCheck</td><td>æ˜¯å¦å¯ç”¨æ•°å­—æ£€æµ‹ã€‚</td><td>false</td></tr><tr><td>8</td><td>enableEmailCheck</td><td>æ˜¯æœ‰å¯ç”¨é‚®ç®±æ£€æµ‹</td><td>false</td></tr><tr><td>9</td><td>enableUrlCheck</td><td>æ˜¯å¦å¯ç”¨é“¾æ¥æ£€æµ‹</td><td>false</td></tr><tr><td>10</td><td>enableIpv4Check</td><td>æ˜¯å¦å¯ç”¨IPv4æ£€æµ‹</td><td>false</td></tr><tr><td>11</td><td>enableWordCheck</td><td>æ˜¯å¦å¯ç”¨æ•æ„Ÿå•è¯æ£€æµ‹</td><td>true</td></tr><tr><td>12</td><td>numCheckLen</td><td>æ•°å­—æ£€æµ‹ï¼Œè‡ªå®šä¹‰æŒ‡å®šé•¿åº¦ã€‚</td><td>8</td></tr><tr><td>13</td><td>wordTag</td><td>è¯å¯¹åº”çš„æ ‡ç­¾</td><td>none</td></tr><tr><td>14</td><td>charIgnore</td><td>å¿½ç•¥çš„å­—ç¬¦</td><td>none</td></tr><tr><td>15</td><td>wordResultCondition</td><td>é’ˆå¯¹åŒ¹é…çš„æ•æ„Ÿè¯é¢å¤–åŠ å·¥ï¼Œæ¯”å¦‚å¯ä»¥é™åˆ¶è‹±æ–‡å•è¯å¿…é¡»å…¨åŒ¹é…</td><td>æ’ä¸ºçœŸ</td></tr></tbody></table><h2 id="å†…å­˜èµ„æºçš„é‡Šæ”¾"><a href="#å†…å­˜èµ„æºçš„é‡Šæ”¾" class="headerlink" title="å†…å­˜èµ„æºçš„é‡Šæ”¾"></a>å†…å­˜èµ„æºçš„é‡Šæ”¾</h2><p>v0.16.1 å¼€å§‹æ”¯æŒï¼Œæœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦é‡Šæ”¾å†…å­˜ï¼Œå¯ä»¥å¦‚ä¸‹ï¼š</p><blockquote><p><a href="https://github.com/houbb/sensitive-word/issues/53">å…³äºå†…å­˜å›æ”¶é—®é¢˜</a></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">SensitiveWordBs</span> <span class="hljs-variable">wordBs</span> <span class="hljs-operator">=</span> SensitiveWordBs.newInstance()<br>                .init();<br><span class="hljs-comment">// åç»­å› ä¸ºä¸€äº›åŸå› ç§»é™¤äº†å¯¹åº”ä¿¡æ¯ï¼Œå¸Œæœ›é‡Šæ”¾å†…å­˜ã€‚</span><br>wordBs.destroy();<br></code></pre></td></tr></table></figure><h1 id="wordResultCondition-é’ˆå¯¹åŒ¹é…è¯è¿›ä¸€æ­¥åˆ¤æ–­"><a href="#wordResultCondition-é’ˆå¯¹åŒ¹é…è¯è¿›ä¸€æ­¥åˆ¤æ–­" class="headerlink" title="wordResultCondition-é’ˆå¯¹åŒ¹é…è¯è¿›ä¸€æ­¥åˆ¤æ–­"></a>wordResultCondition-é’ˆå¯¹åŒ¹é…è¯è¿›ä¸€æ­¥åˆ¤æ–­</h1><h2 id="è¯´æ˜-1"><a href="#è¯´æ˜-1" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h2><p>æ”¯æŒç‰ˆæœ¬ï¼šv0.13.0</p><p>æœ‰æ—¶å€™æˆ‘ä»¬å¯èƒ½å¸Œæœ›å¯¹åŒ¹é…çš„æ•æ„Ÿè¯è¿›ä¸€æ­¥é™åˆ¶ï¼Œæ¯”å¦‚è™½ç„¶æˆ‘ä»¬å®šä¹‰äº†ã€avã€‘ä½œä¸ºæ•æ„Ÿè¯ï¼Œä½†æ˜¯ä¸å¸Œæœ›ã€haveã€‘è¢«åŒ¹é…ã€‚</p><p>å°±å¯ä»¥è‡ªå®šä¹‰å®ç° wordResultCondition æ¥å£ï¼Œå®ç°è‡ªå·±çš„ç­–ç•¥ã€‚</p><p>ç³»ç»Ÿå†…ç½®çš„ç­–ç•¥åœ¨ <code>WordResultConditions#alwaysTrue()</code> æ’ä¸ºçœŸï¼Œ<code>WordResultConditions#englishWordMatch()</code> åˆ™è¦æ±‚è‹±æ–‡å¿…é¡»å…¨è¯åŒ¹é…ã€‚</p><h2 id="å…¥é—¨ä¾‹å­"><a href="#å…¥é—¨ä¾‹å­" class="headerlink" title="å…¥é—¨ä¾‹å­"></a>å…¥é—¨ä¾‹å­</h2><p>åŸå§‹çš„é»˜è®¤æƒ…å†µï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;I have a nice dayã€‚&quot;</span>;<br><br>List&lt;String&gt; wordList = SensitiveWordBs.newInstance()<br>        .wordDeny(<span class="hljs-keyword">new</span> <span class="hljs-title class_">IWordDeny</span>() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title function_">deny</span><span class="hljs-params">()</span> &#123;<br>                <span class="hljs-keyword">return</span> Collections.singletonList(<span class="hljs-string">&quot;av&quot;</span>);<br>            &#125;<br>        &#125;)<br>        .wordResultCondition(WordResultConditions.alwaysTrue())<br>        .init()<br>        .findAll(text);<br>Assert.assertEquals(<span class="hljs-string">&quot;[av]&quot;</span>, wordList.toString());<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥æŒ‡å®šä¸ºè‹±æ–‡å¿…é¡»å…¨è¯åŒ¹é…ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;I have a nice dayã€‚&quot;</span>;<br><br>List&lt;String&gt; wordList = SensitiveWordBs.newInstance()<br>        .wordDeny(<span class="hljs-keyword">new</span> <span class="hljs-title class_">IWordDeny</span>() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title function_">deny</span><span class="hljs-params">()</span> &#123;<br>                <span class="hljs-keyword">return</span> Collections.singletonList(<span class="hljs-string">&quot;av&quot;</span>);<br>            &#125;<br>        &#125;)<br>        .wordResultCondition(WordResultConditions.englishWordMatch())<br>        .init()<br>        .findAll(text);<br>Assert.assertEquals(<span class="hljs-string">&quot;[]&quot;</span>, wordList.toString());<br></code></pre></td></tr></table></figure><p>å½“ç„¶å¯ä»¥æ ¹æ®éœ€è¦å®ç°æ›´åŠ å¤æ‚çš„ç­–ç•¥ã€‚</p><h1 id="å¿½ç•¥å­—ç¬¦"><a href="#å¿½ç•¥å­—ç¬¦" class="headerlink" title="å¿½ç•¥å­—ç¬¦"></a>å¿½ç•¥å­—ç¬¦</h1><h2 id="è¯´æ˜-2"><a href="#è¯´æ˜-2" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h2><p>æˆ‘ä»¬çš„æ•æ„Ÿè¯ä¸€èˆ¬éƒ½æ˜¯æ¯”è¾ƒè¿ç»­çš„ï¼Œæ¯”å¦‚ã€å‚»å¸½ã€‘</p><p>é‚£å°±æœ‰å¤§èªæ˜å‘ç°ï¼Œå¯ä»¥åœ¨ä¸­é—´åŠ ä¸€äº›å­—ç¬¦ï¼Œæ¯”å¦‚ã€å‚»!@#$å¸½ã€‘è·³è¿‡æ£€æµ‹ï¼Œä½†æ˜¯éª‚äººç­‰æ”»å‡»åŠ›ä¸å‡ã€‚</p><p>é‚£ä¹ˆï¼Œå¦‚ä½•åº”å¯¹è¿™äº›ç±»ä¼¼çš„åœºæ™¯å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å¯ä»¥æŒ‡å®šç‰¹æ®Šå­—ç¬¦çš„è·³è¿‡é›†åˆï¼Œå¿½ç•¥æ‰è¿™äº›æ— æ„ä¹‰çš„å­—ç¬¦å³å¯ã€‚</p><p>v0.11.0 å¼€å§‹æ”¯æŒ</p><h2 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h2><p>å…¶ä¸­ charIgnore å¯¹åº”çš„å­—ç¬¦ç­–ç•¥ï¼Œç”¨æˆ·å¯ä»¥è‡ªè¡Œçµæ´»å®šä¹‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;å‚»@å†’ï¼Œç‹—+ä¸œè¥¿&quot;</span>;<br><br><span class="hljs-comment">//é»˜è®¤å› ä¸ºæœ‰ç‰¹æ®Šå­—ç¬¦åˆ†å‰²ï¼Œæ— æ³•è¯†åˆ«</span><br>List&lt;String&gt; wordList = SensitiveWordBs.newInstance().init().findAll(text);<br>Assert.assertEquals(<span class="hljs-string">&quot;[]&quot;</span>, wordList.toString());<br><br><span class="hljs-comment">// æŒ‡å®šå¿½ç•¥çš„å­—ç¬¦ç­–ç•¥ï¼Œå¯è‡ªè¡Œå®ç°ã€‚</span><br>List&lt;String&gt; wordList2 = SensitiveWordBs.newInstance()<br>        .charIgnore(SensitiveWordCharIgnores.specialChars())<br>        .init()<br>        .findAll(text);<br><br>Assert.assertEquals(<span class="hljs-string">&quot;[å‚»@å†’, ç‹—+ä¸œè¥¿]&quot;</span>, wordList2.toString());<br></code></pre></td></tr></table></figure><h1 id="æ•æ„Ÿè¯æ ‡ç­¾"><a href="#æ•æ„Ÿè¯æ ‡ç­¾" class="headerlink" title="æ•æ„Ÿè¯æ ‡ç­¾"></a>æ•æ„Ÿè¯æ ‡ç­¾</h1><h2 id="è¯´æ˜-3"><a href="#è¯´æ˜-3" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h2><p>æœ‰æ—¶å€™æˆ‘ä»¬å¸Œæœ›å¯¹æ•æ„Ÿè¯åŠ ä¸€ä¸ªåˆ†ç±»æ ‡ç­¾ï¼šæ¯”å¦‚ç¤¾æƒ…ã€æš´&#x2F;åŠ›ç­‰ç­‰ã€‚</p><p>è¿™æ ·åç»­å¯ä»¥æŒ‰ç…§æ ‡ç­¾ç­‰è¿›è¡Œæ›´å¤šç‰¹æ€§æ“ä½œï¼Œæ¯”å¦‚åªå¤„ç†æŸä¸€ç±»çš„æ ‡ç­¾ã€‚</p><p>æ”¯æŒç‰ˆæœ¬ï¼šv0.10.0</p><h2 id="å…¥é—¨ä¾‹å­-1"><a href="#å…¥é—¨ä¾‹å­-1" class="headerlink" title="å…¥é—¨ä¾‹å­"></a>å…¥é—¨ä¾‹å­</h2><h3 id="æ¥å£"><a href="#æ¥å£" class="headerlink" title="æ¥å£"></a>æ¥å£</h3><p>è¿™é‡Œåªæ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ¥å£ï¼Œç”¨æˆ·å¯ä»¥è‡ªè¡Œå®šä¹‰å®ç°ã€‚æ¯”å¦‚ä»æ•°æ®åº“æŸ¥è¯¢ç­‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IWordTag</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æŸ¥è¯¢æ ‡ç­¾åˆ—è¡¨</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> word è„è¯</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> ç»“æœ</span><br><span class="hljs-comment">     */</span><br>    Set&lt;String&gt; <span class="hljs-title function_">getTag</span><span class="hljs-params">(String word)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><p>æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ dict æ ‡ç­¾æ–‡ä»¶ï¼Œé€šè¿‡ WordTags.file() åˆ›å»ºä¸€ä¸ª WordTag å®ç°ã€‚</p><ul><li>dict_tag_test.txt</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">äº”æ˜Ÿçº¢æ—— æ”¿æ²»,å›½å®¶<br></code></pre></td></tr></table></figure><p>æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">æ•æ„Ÿè¯ tag1,tag2<br></code></pre></td></tr></table></figure><h3 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h3><p>å…·ä½“çš„æ•ˆæœå¦‚ä¸‹ï¼Œåœ¨å¼•å¯¼ç±»è®¾ç½®ä¸€ä¸‹å³å¯ã€‚</p><p>é»˜è®¤çš„ wordTag æ˜¯ç©ºçš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">filePath</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;dict_tag_test.txt&quot;</span>;<br><span class="hljs-type">IWordTag</span> <span class="hljs-variable">wordTag</span> <span class="hljs-operator">=</span> WordTags.file(filePath);<br><br><span class="hljs-type">SensitiveWordBs</span> <span class="hljs-variable">sensitiveWordBs</span> <span class="hljs-operator">=</span> SensitiveWordBs.newInstance()<br>        .wordTag(wordTag)<br>        .init();<br><br>Assert.assertEquals(<span class="hljs-string">&quot;[æ”¿æ²», å›½å®¶]&quot;</span>, sensitiveWordBs.tags(<span class="hljs-string">&quot;äº”æ˜Ÿçº¢æ——&quot;</span>).toString());;<br></code></pre></td></tr></table></figure><p>åç»­ä¼šè€ƒè™‘å¼•å…¥ä¸€ä¸ªå†…ç½®çš„æ ‡ç­¾æ–‡ä»¶ç­–ç•¥ã€‚</p><h3 id="æ•æ„Ÿè¯æ ‡ç­¾æ–‡ä»¶-1"><a href="#æ•æ„Ÿè¯æ ‡ç­¾æ–‡ä»¶-1" class="headerlink" title="æ•æ„Ÿè¯æ ‡ç­¾æ–‡ä»¶"></a>æ•æ„Ÿè¯æ ‡ç­¾æ–‡ä»¶</h3><p>æ¢³ç†äº†å¤§é‡çš„æ•æ„Ÿè¯æ ‡ç­¾æ–‡ä»¶ï¼Œå¯ä»¥è®©æˆ‘ä»¬çš„æ•æ„Ÿè¯æ›´åŠ æ–¹ä¾¿ã€‚</p><p>è¿™ä¸¤ä¸ªèµ„æ–™é˜…è¯»å¯åœ¨ä¸‹æ–¹æ–‡ç« è·å–ï¼š</p><blockquote><p><a href="https://mp.weixin.qq.com/s/m40ZnR6YF6WgPrArUSZ_0g">v0.11.0-æ•æ„Ÿè¯æ–°ç‰¹æ€§åŠå¯¹åº”æ ‡ç­¾æ–‡ä»¶</a></p></blockquote><h1 id="åŠ¨æ€åŠ è½½ï¼ˆç”¨æˆ·è‡ªå®šä¹‰ï¼‰"><a href="#åŠ¨æ€åŠ è½½ï¼ˆç”¨æˆ·è‡ªå®šä¹‰ï¼‰" class="headerlink" title="åŠ¨æ€åŠ è½½ï¼ˆç”¨æˆ·è‡ªå®šä¹‰ï¼‰"></a>åŠ¨æ€åŠ è½½ï¼ˆç”¨æˆ·è‡ªå®šä¹‰ï¼‰</h1><h2 id="æƒ…æ™¯è¯´æ˜"><a href="#æƒ…æ™¯è¯´æ˜" class="headerlink" title="æƒ…æ™¯è¯´æ˜"></a>æƒ…æ™¯è¯´æ˜</h2><p>æœ‰æ—¶å€™æˆ‘ä»¬å¸Œæœ›å°†æ•æ„Ÿè¯çš„åŠ è½½è®¾è®¡æˆåŠ¨æ€çš„ï¼Œæ¯”å¦‚æ§å°ä¿®æ”¹ï¼Œç„¶åå¯ä»¥å®æ—¶ç”Ÿæ•ˆã€‚</p><p>v0.0.13 æ”¯æŒäº†è¿™ç§ç‰¹æ€§ã€‚</p><h2 id="æ¥å£è¯´æ˜"><a href="#æ¥å£è¯´æ˜" class="headerlink" title="æ¥å£è¯´æ˜"></a>æ¥å£è¯´æ˜</h2><p>ä¸ºäº†å®ç°è¿™ä¸ªç‰¹æ€§ï¼Œå¹¶ä¸”å…¼å®¹ä»¥å‰çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªæ¥å£ã€‚</p><h3 id="IWordDeny"><a href="#IWordDeny" class="headerlink" title="IWordDeny"></a>IWordDeny</h3><p>æ¥å£å¦‚ä¸‹ï¼Œå¯ä»¥è‡ªå®šä¹‰è‡ªå·±çš„å®ç°ã€‚</p><p>è¿”å›çš„åˆ—è¡¨ï¼Œè¡¨ç¤ºè¿™ä¸ªè¯æ˜¯ä¸€ä¸ªæ•æ„Ÿè¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ‹’ç»å‡ºç°çš„æ•°æ®-è¿”å›çš„å†…å®¹è¢«å½“åšæ˜¯æ•æ„Ÿè¯</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> binbin.hou</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@since</span> 0.0.13</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IWordDeny</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è·å–ç»“æœ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> ç»“æœ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@since</span> 0.0.13</span><br><span class="hljs-comment">     */</span><br>    List&lt;String&gt; <span class="hljs-title function_">deny</span><span class="hljs-params">()</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>æ¯”å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyWordDeny</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IWordDeny</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title function_">deny</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> Arrays.asList(<span class="hljs-string">&quot;æˆ‘çš„è‡ªå®šä¹‰æ•æ„Ÿè¯&quot;</span>);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="IWordAllow"><a href="#IWordAllow" class="headerlink" title="IWordAllow"></a>IWordAllow</h3><p>æ¥å£å¦‚ä¸‹ï¼Œå¯ä»¥è‡ªå®šä¹‰è‡ªå·±çš„å®ç°ã€‚</p><p>è¿”å›çš„åˆ—è¡¨ï¼Œè¡¨ç¤ºè¿™ä¸ªè¯ä¸æ˜¯ä¸€ä¸ªæ•æ„Ÿè¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å…è®¸çš„å†…å®¹-è¿”å›çš„å†…å®¹ä¸è¢«å½“åšæ•æ„Ÿè¯</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> binbin.hou</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@since</span> 0.0.13</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IWordAllow</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è·å–ç»“æœ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> ç»“æœ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@since</span> 0.0.13</span><br><span class="hljs-comment">     */</span><br>    List&lt;String&gt; <span class="hljs-title function_">allow</span><span class="hljs-params">()</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyWordAllow</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IWordAllow</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title function_">allow</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> Arrays.asList(<span class="hljs-string">&quot;äº”æ˜Ÿçº¢æ——&quot;</span>);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="é…ç½®ä½¿ç”¨"><a href="#é…ç½®ä½¿ç”¨" class="headerlink" title="é…ç½®ä½¿ç”¨"></a>é…ç½®ä½¿ç”¨</h2><p><strong>æ¥å£è‡ªå®šä¹‰ä¹‹åï¼Œå½“ç„¶éœ€è¦æŒ‡å®šæ‰èƒ½ç”Ÿæ•ˆã€‚</strong></p><p>ä¸ºäº†è®©ä½¿ç”¨æ›´åŠ ä¼˜é›…ï¼Œæˆ‘ä»¬è®¾è®¡äº†å¼•å¯¼ç±» <code>SensitiveWordBs</code>ã€‚</p><p>å¯ä»¥é€šè¿‡ wordDeny() æŒ‡å®šæ•æ„Ÿè¯ï¼ŒwordAllow() æŒ‡å®šéæ•æ„Ÿè¯ï¼Œé€šè¿‡ init() åˆå§‹åŒ–æ•æ„Ÿè¯å­—å…¸ã€‚</p><h3 id="ç³»ç»Ÿçš„é»˜è®¤é…ç½®"><a href="#ç³»ç»Ÿçš„é»˜è®¤é…ç½®" class="headerlink" title="ç³»ç»Ÿçš„é»˜è®¤é…ç½®"></a>ç³»ç»Ÿçš„é»˜è®¤é…ç½®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">SensitiveWordBs</span> <span class="hljs-variable">wordBs</span> <span class="hljs-operator">=</span> SensitiveWordBs.newInstance()<br>        .wordDeny(WordDenys.defaults())<br>        .wordAllow(WordAllows.defaults())<br>        .init();<br><br><span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;äº”æ˜Ÿçº¢æ——è¿é£é£˜æ‰¬ï¼Œæ¯›ä¸»å¸­çš„ç”»åƒå±¹ç«‹åœ¨å¤©å®‰é—¨å‰ã€‚&quot;</span>;<br>Assert.assertTrue(wordBs.contains(text));<br></code></pre></td></tr></table></figure><p>å¤‡æ³¨ï¼šinit() å¯¹äºæ•æ„Ÿè¯ DFA çš„æ„å»ºæ˜¯æ¯”è¾ƒè€—æ—¶çš„ï¼Œä¸€èˆ¬å»ºè®®åœ¨åº”ç”¨åˆå§‹åŒ–çš„æ—¶å€™<strong>åªåˆå§‹åŒ–ä¸€æ¬¡</strong>ã€‚è€Œä¸æ˜¯é‡å¤åˆå§‹åŒ–ï¼</p><h3 id="æŒ‡å®šè‡ªå·±çš„å®ç°"><a href="#æŒ‡å®šè‡ªå·±çš„å®ç°" class="headerlink" title="æŒ‡å®šè‡ªå·±çš„å®ç°"></a>æŒ‡å®šè‡ªå·±çš„å®ç°</h3><p>æˆ‘ä»¬å¯ä»¥æµ‹è¯•ä¸€ä¸‹è‡ªå®šä¹‰çš„å®ç°ï¼Œå¦‚ä¸‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•ï¼Œæˆ‘çš„è‡ªå®šä¹‰æ•æ„Ÿè¯ã€‚&quot;</span>;<br><br><span class="hljs-type">SensitiveWordBs</span> <span class="hljs-variable">wordBs</span> <span class="hljs-operator">=</span> SensitiveWordBs.newInstance()<br>        .wordDeny(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyWordDeny</span>())<br>        .wordAllow(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyWordAllow</span>())<br>        .init();<br><br>Assert.assertEquals(<span class="hljs-string">&quot;[æˆ‘çš„è‡ªå®šä¹‰æ•æ„Ÿè¯]&quot;</span>, wordBs.findAll(text).toString());<br></code></pre></td></tr></table></figure><p>è¿™é‡Œåªæœ‰ <code>æˆ‘çš„è‡ªå®šä¹‰æ•æ„Ÿè¯</code> æ˜¯æ•æ„Ÿè¯ï¼Œè€Œ <code>æµ‹è¯•</code> ä¸æ˜¯æ•æ„Ÿè¯ã€‚</p><p>å½“ç„¶ï¼Œè¿™é‡Œæ˜¯å…¨éƒ¨ä½¿ç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„å®ç°ï¼Œä¸€èˆ¬å»ºè®®ä½¿ç”¨ç³»ç»Ÿçš„é»˜è®¤é…ç½®+è‡ªå®šä¹‰é…ç½®ã€‚</p><p>å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼ã€‚</p><h3 id="åŒæ—¶é…ç½®å¤šä¸ª"><a href="#åŒæ—¶é…ç½®å¤šä¸ª" class="headerlink" title="åŒæ—¶é…ç½®å¤šä¸ª"></a>åŒæ—¶é…ç½®å¤šä¸ª</h3><ul><li>å¤šä¸ªæ•æ„Ÿè¯</li></ul><p><code>WordDenys.chains()</code> æ–¹æ³•ï¼Œå°†å¤šä¸ªå®ç°åˆå¹¶ä¸ºåŒä¸€ä¸ª IWordDenyã€‚</p><ul><li>å¤šä¸ªç™½åå•</li></ul><p><code>WordAllows.chains()</code> æ–¹æ³•ï¼Œå°†å¤šä¸ªå®ç°åˆå¹¶ä¸ºåŒä¸€ä¸ª IWordAllowã€‚</p><p>ä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•ã€‚æˆ‘çš„è‡ªå®šä¹‰æ•æ„Ÿè¯ã€‚&quot;</span>;<br><br><span class="hljs-type">IWordDeny</span> <span class="hljs-variable">wordDeny</span> <span class="hljs-operator">=</span> WordDenys.chains(WordDenys.defaults(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyWordDeny</span>());<br><span class="hljs-type">IWordAllow</span> <span class="hljs-variable">wordAllow</span> <span class="hljs-operator">=</span> WordAllows.chains(WordAllows.defaults(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyWordAllow</span>());<br><br><span class="hljs-type">SensitiveWordBs</span> <span class="hljs-variable">wordBs</span> <span class="hljs-operator">=</span> SensitiveWordBs.newInstance()<br>        .wordDeny(wordDeny)<br>        .wordAllow(wordAllow)<br>        .init();<br><br>Assert.assertEquals(<span class="hljs-string">&quot;[æˆ‘çš„è‡ªå®šä¹‰æ•æ„Ÿè¯]&quot;</span>, wordBs.findAll(text).toString());<br></code></pre></td></tr></table></figure><p>è¿™é‡Œéƒ½æ˜¯åŒæ—¶ä½¿ç”¨äº†ç³»ç»Ÿé»˜è®¤é…ç½®ï¼Œå’Œè‡ªå®šä¹‰çš„é…ç½®ã€‚</p><p>æ³¨æ„ï¼š<strong>æˆ‘ä»¬åˆå§‹åŒ–äº†æ–°çš„ wordBsï¼Œé‚£ä¹ˆç”¨æ–°çš„ wordBs å»åˆ¤æ–­ã€‚è€Œä¸æ˜¯ç”¨ä»¥å‰çš„ <code>SensitiveWordHelper</code> å·¥å…·æ–¹æ³•ï¼Œå·¥å…·æ–¹æ³•é…ç½®æ˜¯é»˜è®¤çš„ï¼</strong></p><h1 id="spring-æ•´åˆ"><a href="#spring-æ•´åˆ" class="headerlink" title="spring æ•´åˆ"></a>spring æ•´åˆ</h1><h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>å®é™…ä½¿ç”¨ä¸­ï¼Œæ¯”å¦‚å¯ä»¥åœ¨é¡µé¢é…ç½®ä¿®æ”¹ï¼Œç„¶åå®æ—¶ç”Ÿæ•ˆã€‚</p><p>æ•°æ®å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªä¼ªä»£ç çš„ä¾‹å­ï¼Œå¯ä»¥å‚è€ƒ <a href="https://github.com/houbb/sensitive-word/blob/master/src/test/java/com/github/houbb/sensitive/word/spring/SpringSensitiveWordConfig.java">SpringSensitiveWordConfig.java</a></p><p>è¦æ±‚ï¼Œç‰ˆæœ¬ v0.0.15 åŠå…¶ä»¥ä¸Šã€‚</p><h2 id="è‡ªå®šä¹‰æ•°æ®æº"><a href="#è‡ªå®šä¹‰æ•°æ®æº" class="headerlink" title="è‡ªå®šä¹‰æ•°æ®æº"></a>è‡ªå®šä¹‰æ•°æ®æº</h2><p>ç®€åŒ–ä¼ªä»£ç å¦‚ä¸‹ï¼Œæ•°æ®çš„æºå¤´ä¸ºæ•°æ®åº“ã€‚</p><p>MyDdWordAllow å’Œ MyDdWordDeny æ˜¯åŸºäºæ•°æ®åº“ä¸ºæºå¤´çš„è‡ªå®šä¹‰å®ç°ç±»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringSensitiveWordConfig</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> MyDdWordAllow myDdWordAllow;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> MyDdWordDeny myDdWordDeny;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åˆå§‹åŒ–å¼•å¯¼ç±»</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> åˆå§‹åŒ–å¼•å¯¼ç±»</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@since</span> 1.0.0</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> SensitiveWordBs <span class="hljs-title function_">sensitiveWordBs</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">SensitiveWordBs</span> <span class="hljs-variable">sensitiveWordBs</span> <span class="hljs-operator">=</span> SensitiveWordBs.newInstance()<br>                .wordAllow(WordAllows.chains(WordAllows.defaults(), myDdWordAllow))<br>                .wordDeny(myDdWordDeny)<br>                <span class="hljs-comment">// å„ç§å…¶ä»–é…ç½®</span><br>                .init();<br><br>        <span class="hljs-keyword">return</span> sensitiveWordBs;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>æ•æ„Ÿè¯åº“çš„åˆå§‹åŒ–è¾ƒä¸ºè€—æ—¶ï¼Œå»ºè®®ç¨‹åºå¯åŠ¨æ—¶åšä¸€æ¬¡ init åˆå§‹åŒ–ã€‚</p><h2 id="åŠ¨æ€å˜æ›´"><a href="#åŠ¨æ€å˜æ›´" class="headerlink" title="åŠ¨æ€å˜æ›´"></a>åŠ¨æ€å˜æ›´</h2><p>ä¸ºäº†ä¿è¯æ•æ„Ÿè¯ä¿®æ”¹å¯ä»¥å®æ—¶ç”Ÿæ•ˆä¸”ä¿è¯æ¥å£çš„å°½å¯èƒ½ç®€åŒ–ï¼Œæ­¤å¤„æ²¡æœ‰æ–°å¢ add&#x2F;remove çš„æ–¹æ³•ã€‚</p><p>è€Œæ˜¯åœ¨è°ƒç”¨ <code>sensitiveWordBs.init()</code> çš„æ—¶å€™ï¼Œæ ¹æ® IWordDeny+IWordAllow é‡æ–°æ„å»ºæ•æ„Ÿè¯åº“ã€‚</p><p>å› ä¸ºåˆå§‹åŒ–å¯èƒ½è€—æ—¶è¾ƒé•¿ï¼ˆç§’çº§åˆ«ï¼‰ï¼Œæ‰€æœ‰ä¼˜åŒ–ä¸º init æœªå®Œæˆæ—¶<strong>ä¸å½±å“æ—§çš„è¯åº“åŠŸèƒ½ï¼Œå®Œæˆåä»¥æ–°çš„ä¸ºå‡†</strong>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SensitiveWordService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> SensitiveWordBs sensitiveWordBs;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ›´æ–°è¯åº“</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * æ¯æ¬¡æ•°æ®åº“çš„ä¿¡æ¯å‘ç”Ÿå˜åŒ–ä¹‹åï¼Œé¦–å…ˆè°ƒç”¨æ›´æ–°æ•°æ®åº“æ•æ„Ÿè¯åº“çš„æ–¹æ³•ã€‚</span><br><span class="hljs-comment">     * å¦‚æœéœ€è¦ç”Ÿæ•ˆï¼Œåˆ™è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * è¯´æ˜ï¼šé‡æ–°åˆå§‹åŒ–ä¸å½±å“æ—§çš„æ–¹æ³•ä½¿ç”¨ã€‚åˆå§‹åŒ–å®Œæˆåï¼Œä¼šä»¥æ–°çš„ä¸ºå‡†ã€‚</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">refresh</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// æ¯æ¬¡æ•°æ®åº“çš„ä¿¡æ¯å‘ç”Ÿå˜åŒ–ä¹‹åï¼Œé¦–å…ˆè°ƒç”¨æ›´æ–°æ•°æ®åº“æ•æ„Ÿè¯åº“çš„æ–¹æ³•ï¼Œç„¶åè°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚</span><br>        sensitiveWordBs.init();<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚ä¸Šï¼Œä½ å¯ä»¥åœ¨æ•°æ®åº“è¯åº“å‘ç”Ÿå˜æ›´æ—¶ï¼Œéœ€è¦è¯åº“ç”Ÿæ•ˆï¼Œä¸»åŠ¨è§¦å‘ä¸€æ¬¡åˆå§‹åŒ– <code>sensitiveWordBs.init();</code>ã€‚</p><p>å…¶ä»–ä½¿ç”¨ä¿æŒä¸å˜ï¼Œæ— éœ€é‡å¯åº”ç”¨ã€‚</p><h1 id="Benchmark"><a href="#Benchmark" class="headerlink" title="Benchmark"></a>Benchmark</h1><p>V0.6.0 ä»¥åï¼Œæ·»åŠ å¯¹åº”çš„ benchmark æµ‹è¯•ã€‚</p><blockquote><p><a href="https://github.com/houbb/sensitive-word/blob/master/src/test/java/com/github/houbb/sensitive/word/benchmark/BenchmarkTimesTest.java">BenchmarkTimesTest</a></p></blockquote><h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><p>æµ‹è¯•ç¯å¢ƒä¸ºæ™®é€šçš„ç¬”è®°æœ¬:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">å¤„ç†å™¨12th Gen <span class="hljs-title function_">Intel</span><span class="hljs-params">(R)</span> Core(TM) i7-1260P   <span class="hljs-number">2.10</span> GHz<br>æœºå¸¦ RAM<span class="hljs-number">16.0</span> GB (<span class="hljs-number">15.7</span> GB å¯ç”¨)<br>ç³»ç»Ÿç±»å‹<span class="hljs-number">64</span> ä½æ“ä½œç³»ç»Ÿ, åŸºäº x64 çš„å¤„ç†å™¨<br></code></pre></td></tr></table></figure><p>ps: ä¸åŒç¯å¢ƒä¼šæœ‰å·®å¼‚ï¼Œä½†æ˜¯æ¯”ä¾‹åŸºæœ¬ç¨³å®šã€‚</p><h2 id="æµ‹è¯•æ•ˆæœè®°å½•"><a href="#æµ‹è¯•æ•ˆæœè®°å½•" class="headerlink" title="æµ‹è¯•æ•ˆæœè®°å½•"></a>æµ‹è¯•æ•ˆæœè®°å½•</h2><p>æµ‹è¯•æ•°æ®ï¼š100+ å­—ç¬¦ä¸²ï¼Œå¾ªç¯ 10W æ¬¡ã€‚</p><table><thead><tr><th>åºå·</th><th>åœºæ™¯</th><th>è€—æ—¶</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>1</td><td>åªåšæ•æ„Ÿè¯ï¼Œæ— ä»»ä½•æ ¼å¼è½¬æ¢</td><td>1470msï¼Œçº¦ 7.2W QPS</td><td>è¿½æ±‚æè‡´æ€§èƒ½ï¼Œå¯ä»¥è¿™æ ·é…ç½®</td></tr><tr><td>2</td><td>åªåšæ•æ„Ÿè¯ï¼Œæ”¯æŒå…¨éƒ¨æ ¼å¼è½¬æ¢</td><td>2744msï¼Œçº¦ 3.7W QPS</td><td>æ»¡è¶³å¤§éƒ¨åˆ†åœºæ™¯</td></tr></tbody></table><h1 id="STAR"><a href="#STAR" class="headerlink" title="STAR"></a>STAR</h1><h1 id="åæœŸ-road-map"><a href="#åæœŸ-road-map" class="headerlink" title="åæœŸ road-map"></a>åæœŸ road-map</h1><ul><li>ç§»é™¤å•ä¸ªæ±‰å­—çš„æ•æ„Ÿè¯ï¼Œåœ¨ä¸­å›½ï¼Œè¦æŠŠè¯ç»„å½“åšä¸€æ¬¡è¯ï¼Œé™ä½è¯¯åˆ¤ç‡ã€‚</li><li>æ”¯æŒå•ä¸ªçš„æ•æ„Ÿè¯å˜åŒ–ï¼Ÿ</li></ul><p>removeã€addã€edit?</p><ul><li>æ•æ„Ÿè¯æ ‡ç­¾æ¥å£æ”¯æŒ</li><li>æ•æ„Ÿè¯å¤„ç†æ—¶æ ‡ç­¾æ”¯æŒ</li><li>wordData çš„å†…å­˜å ç”¨å¯¹æ¯” + ä¼˜åŒ–</li><li>ç”¨æˆ·æŒ‡å®šè‡ªå®šä¹‰çš„è¯ç»„ï¼ŒåŒæ—¶å…è®¸æŒ‡å®šè¯ç»„çš„ç»„åˆè·å–ï¼Œæ›´åŠ çµæ´»</li></ul><p>FormatCombine&#x2F;CheckCombine&#x2F;AllowDenyCombine ç»„åˆç­–ç•¥ï¼Œå…è®¸ç”¨æˆ·è‡ªå®šä¹‰ã€‚</p><ul><li>word check ç­–ç•¥çš„ä¼˜åŒ–ï¼Œç»Ÿä¸€éå†+è½¬æ¢</li><li>æ·»åŠ  ThreadLocal ç­‰æ€§èƒ½ä¼˜åŒ–</li></ul><h1 id="æ‹“å±•é˜…è¯»"><a href="#æ‹“å±•é˜…è¯»" class="headerlink" title="æ‹“å±•é˜…è¯»"></a>æ‹“å±•é˜…è¯»</h1><h1 id="æ•æ„Ÿè¯ç³»åˆ—"><a href="#æ•æ„Ÿè¯ç³»åˆ—" class="headerlink" title="æ•æ„Ÿè¯ç³»åˆ—"></a>æ•æ„Ÿè¯ç³»åˆ—</h1><p><a href="https://mp.weixin.qq.com/s/7wSy0PuJLTudEo9gTY5s5w">sensitive-word-admin æ•æ„Ÿè¯æ§å° v1.2.0 ç‰ˆæœ¬å¼€æº</a></p><p><a href="https://mp.weixin.qq.com/s/4wia8SlQQbLV5_OHplaWvg">sensitive-word-admin v1.3.0 å‘å¸ƒ å¦‚ä½•æ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²ï¼Ÿ</a></p><p><a href="https://houbb.github.io/2020/01/07/sensitive-word-00-overview">01-å¼€æºæ•æ„Ÿè¯å·¥å…·å…¥é—¨ä½¿ç”¨</a></p><p><a href="https://houbb.github.io/2020/01/07/sensitive-word-01-intro">02-å¦‚ä½•å®ç°ä¸€ä¸ªæ•æ„Ÿè¯å·¥å…·ï¼Ÿè¿ç¦è¯å®ç°æ€è·¯æ¢³ç†</a></p><p><a href="https://houbb.github.io/2020/01/07/sensitive-word-02-stopword">03-æ•æ„Ÿè¯ä¹‹ StopWord åœæ­¢è¯ä¼˜åŒ–ä¸ç‰¹æ®Šç¬¦å·</a></p><p><a href="https://houbb.github.io/2020/01/07/sensitive-word-03-slim">04-æ•æ„Ÿè¯ä¹‹å­—å…¸ç˜¦èº«</a></p><p><a href="https://houbb.github.io/2020/01/07/sensitive-word-04-dfa">05-æ•æ„Ÿè¯ä¹‹ DFA ç®—æ³•(Trie Tree ç®—æ³•)è¯¦è§£</a></p><p><a href="https://houbb.github.io/2020/01/07/sensitive-word-05-ignore-char">06-æ•æ„Ÿè¯(è„è¯) å¦‚ä½•å¿½ç•¥æ— æ„ä¹‰çš„å­—ç¬¦ï¼Ÿè¾¾åˆ°æ›´å¥½çš„è¿‡æ»¤æ•ˆæœ</a></p><p><a href="https://juejin.cn/post/7308782855941292058?searchId=20231209140414C082B3CCF1E7B2316EF9">v0.10.0-è„è¯åˆ†ç±»æ ‡ç­¾åˆæ­¥æ”¯æŒ</a></p><p><a href="https://mp.weixin.qq.com/s/m40ZnR6YF6WgPrArUSZ_0g">v0.11.0-æ•æ„Ÿè¯æ–°ç‰¹æ€§ï¼šå¿½ç•¥æ— æ„ä¹‰çš„å­—ç¬¦ï¼Œè¯æ ‡ç­¾å­—å…¸</a></p><p><a href="https://mp.weixin.qq.com/s/-wa-if7uAy2jWsZC13C0cQ">v0.12.0-æ•æ„Ÿè¯&#x2F;è„è¯è¯æ ‡ç­¾èƒ½åŠ›è¿›ä¸€æ­¥å¢å¼º</a></p><p><a href="https://mp.weixin.qq.com/s/DXv5OUyOs0y2dAq8nFWJ9A">v0.13.0-æ•æ„Ÿè¯ç‰¹æ€§ç‰ˆæœ¬å‘å¸ƒ æ”¯æŒè‹±æ–‡å•è¯å…¨è¯åŒ¹é…</a></p><p><a href="https://mp.weixin.qq.com/s/zbeJR-OkWjxashtjiopnMA">v0.16.1-æ•æ„Ÿè¯æ–°ç‰¹æ€§ä¹‹å­—å…¸å†…å­˜èµ„æºé‡Šæ”¾</a></p><h1 id="NLP-å¼€æºçŸ©é˜µ"><a href="#NLP-å¼€æºçŸ©é˜µ" class="headerlink" title="NLP å¼€æºçŸ©é˜µ"></a>NLP å¼€æºçŸ©é˜µ</h1><p><a href="https://github.com/houbb/pinyin">pinyin æ±‰å­—è½¬æ‹¼éŸ³</a></p><p><a href="https://github.com/houbb/pinyin2hanzi">pinyin2hanzi æ‹¼éŸ³è½¬æ±‰å­—</a></p><p><a href="https://github.com/houbb/segment">segment é«˜æ€§èƒ½ä¸­æ–‡åˆ†è¯</a></p><p><a href="https://github.com/houbb/opencc4j">opencc4j ä¸­æ–‡ç¹ç®€ä½“è½¬æ¢</a></p><p><a href="https://github.com/houbb/nlp-hanzi-similar">nlp-hanzi-similar æ±‰å­—ç›¸ä¼¼åº¦</a></p><p><a href="https://github.com/houbb/word-checker">word-checker æ‹¼å†™æ£€æµ‹</a></p><p><a href="https://github.com/houbb/sensitive-word">sensitive-word æ•æ„Ÿè¯</a></p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MapStruct</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2. ä¸¤æ•°ç›¸åŠ </title>
    <link href="/post/9eec8197-ca95-4af8-ac8b-ff12d282b4fe/"/>
    <url>/post/9eec8197-ca95-4af8-ac8b-ff12d282b4fe/</url>
    
    <content type="html"><![CDATA[<h3 id="2-ä¸¤æ•°ç›¸åŠ "><a href="#2-ä¸¤æ•°ç›¸åŠ " class="headerlink" title="2. ä¸¤æ•°ç›¸åŠ "></a>2. ä¸¤æ•°ç›¸åŠ </h3><p><code>hexo template generate by typora plugin templater</code></p><h4 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h4><p><a href="https://leetcode.cn/problems/add-two-numbers/">2. ä¸¤æ•°ç›¸åŠ </a></p><p>å·²è§£ç­”</p><p>ä¸­ç­‰</p><p>ç›¸å…³æ ‡ç­¾</p><p>ç›¸å…³ä¼ä¸š</p><p>ç»™ä½ ä¸¤ä¸ª <strong>éç©º</strong> çš„é“¾è¡¨ï¼Œè¡¨ç¤ºä¸¤ä¸ªéè´Ÿçš„æ•´æ•°ã€‚å®ƒä»¬æ¯ä½æ•°å­—éƒ½æ˜¯æŒ‰ç…§ <strong>é€†åº</strong> çš„æ–¹å¼å­˜å‚¨çš„ï¼Œå¹¶ä¸”æ¯ä¸ªèŠ‚ç‚¹åªèƒ½å­˜å‚¨ <strong>ä¸€ä½</strong> æ•°å­—ã€‚</p><p>è¯·ä½ å°†ä¸¤ä¸ªæ•°ç›¸åŠ ï¼Œå¹¶ä»¥ç›¸åŒå½¢å¼è¿”å›ä¸€ä¸ªè¡¨ç¤ºå’Œçš„é“¾è¡¨ã€‚</p><p>ä½ å¯ä»¥å‡è®¾é™¤äº†æ•°å­— 0 ä¹‹å¤–ï¼Œè¿™ä¸¤ä¸ªæ•°éƒ½ä¸ä¼šä»¥ 0 å¼€å¤´ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><p><img src="addtwonumber1.jpg" alt="img"></p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs inform7">è¾“å…¥ï¼šl1 = <span class="hljs-comment">[2,4,3]</span>, l2 = <span class="hljs-comment">[5,6,4]</span><br>è¾“å‡ºï¼š<span class="hljs-comment">[7,0,8]</span><br>è§£é‡Šï¼š342 + 465 = 807.<br></code></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs inform7">è¾“å…¥ï¼šl1 = <span class="hljs-comment">[0]</span>, l2 = <span class="hljs-comment">[0]</span><br>è¾“å‡ºï¼š<span class="hljs-comment">[0]</span><br></code></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dns">è¾“å…¥ï¼šl1 = [<span class="hljs-number">9,9,9,9</span>,<span class="hljs-number">9</span>,<span class="hljs-number">9</span>,<span class="hljs-number">9</span>], l2 = [<span class="hljs-number">9,9,9,9</span>]<br>è¾“å‡ºï¼š[<span class="hljs-number">8,9,9,9</span>,<span class="hljs-number">0,0,0,1</span>]<br></code></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li>æ¯ä¸ªé“¾è¡¨ä¸­çš„èŠ‚ç‚¹æ•°åœ¨èŒƒå›´ <code>[1, 100]</code> å†…</li><li><code>0 &lt;= Node.val &lt;= 9</code></li><li>é¢˜ç›®æ•°æ®ä¿è¯åˆ—è¡¨è¡¨ç¤ºçš„æ•°å­—ä¸å«å‰å¯¼é›¶</li></ul><h4 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Definition for singly-linked list.</span><br><span class="hljs-comment"> * public class ListNode &#123;</span><br><span class="hljs-comment"> *     int val;</span><br><span class="hljs-comment"> *     ListNode next;</span><br><span class="hljs-comment"> *     ListNode() &#123;&#125;</span><br><span class="hljs-comment"> *     ListNode(int val) &#123; this.val = val; &#125;</span><br><span class="hljs-comment"> *     ListNode(int val, ListNode next) &#123; this.val = val; this.next = next; &#125;</span><br><span class="hljs-comment"> * &#125;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br>    <span class="hljs-keyword">public</span> ListNode <span class="hljs-title function_">addTwoNumbers</span><span class="hljs-params">(ListNode l1, ListNode l2)</span> &#123;<br>        <span class="hljs-type">ListNode</span> <span class="hljs-variable">head</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-type">ListNode</span> <span class="hljs-variable">node</span> <span class="hljs-operator">=</span><span class="hljs-literal">null</span>;<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">isHead</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">next</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">while</span> (l1 !=<span class="hljs-literal">null</span> || l2!=<span class="hljs-literal">null</span>)&#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">bit</span> <span class="hljs-operator">=</span> next;<br>            <span class="hljs-keyword">if</span> (l1 == <span class="hljs-literal">null</span>) bit += l2.val;<br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (l2 == <span class="hljs-literal">null</span>) bit += l1.val;<br>            <span class="hljs-keyword">else</span>  bit = bit+ l1.val + l2.val; <br><br>            <span class="hljs-keyword">if</span>( bit &gt;= <span class="hljs-number">10</span> )&#123;<br>                bit = bit - <span class="hljs-number">10</span>;<br>                next = <span class="hljs-number">1</span>;<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                next = <span class="hljs-number">0</span>;<br>            &#125;<br><br>            <span class="hljs-keyword">if</span>(node !=<span class="hljs-literal">null</span>)&#123;<br>                node.next = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListNode</span>(bit);<br>                node = node.next;<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                node = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListNode</span>(bit);<br>                head = node;<br>            <br>            &#125;<br>            <span class="hljs-keyword">if</span>( l1!=<span class="hljs-literal">null</span>)l1 = l1.next;   <br>            <span class="hljs-keyword">if</span>( l2!=<span class="hljs-literal">null</span>)l2 = l2.next;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (next &gt; <span class="hljs-number">0</span>)&#123;<br>            node.next = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListNode</span>(<span class="hljs-number">1</span>);<br>        &#125;<br>       <br>        <span class="hljs-keyword">return</span> head;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
      <category>Leetcode</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Leetcode</tag>
      
      <tag>Hot100</tag>
      
      <tag>ä¸­ç­‰</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>141. ç¯å½¢é“¾è¡¨</title>
    <link href="/post/710e0573-50b2-4c97-a15d-c9d03e13c213/"/>
    <url>/post/710e0573-50b2-4c97-a15d-c9d03e13c213/</url>
    
    <content type="html"><![CDATA[<h3 id="141-ç¯å½¢é“¾è¡¨"><a href="#141-ç¯å½¢é“¾è¡¨" class="headerlink" title="141. ç¯å½¢é“¾è¡¨"></a>141. ç¯å½¢é“¾è¡¨</h3><p><code>hexo template generate by typora plugin templater</code></p><h4 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h4><p><a href="https://leetcode.cn/problems/linked-list-cycle/">141. ç¯å½¢é“¾è¡¨</a></p><p>å·²è§£ç­”</p><p>ç®€å•</p><p>ç›¸å…³æ ‡ç­¾</p><p>ç›¸å…³ä¼ä¸š</p><p>ç»™ä½ ä¸€ä¸ªé“¾è¡¨çš„å¤´èŠ‚ç‚¹ <code>head</code> ï¼Œåˆ¤æ–­é“¾è¡¨ä¸­æ˜¯å¦æœ‰ç¯ã€‚</p><p>å¦‚æœé“¾è¡¨ä¸­æœ‰æŸä¸ªèŠ‚ç‚¹ï¼Œå¯ä»¥é€šè¿‡è¿ç»­è·Ÿè¸ª <code>next</code> æŒ‡é’ˆå†æ¬¡åˆ°è¾¾ï¼Œåˆ™é“¾è¡¨ä¸­å­˜åœ¨ç¯ã€‚ ä¸ºäº†è¡¨ç¤ºç»™å®šé“¾è¡¨ä¸­çš„ç¯ï¼Œè¯„æµ‹ç³»ç»Ÿå†…éƒ¨ä½¿ç”¨æ•´æ•° <code>pos</code> æ¥è¡¨ç¤ºé“¾è¡¨å°¾è¿æ¥åˆ°é“¾è¡¨ä¸­çš„ä½ç½®ï¼ˆç´¢å¼•ä» 0 å¼€å§‹ï¼‰ã€‚<strong>æ³¨æ„ï¼š<code>pos</code> ä¸ä½œä¸ºå‚æ•°è¿›è¡Œä¼ é€’</strong> ã€‚ä»…ä»…æ˜¯ä¸ºäº†æ ‡è¯†é“¾è¡¨çš„å®é™…æƒ…å†µã€‚</p><p><em>å¦‚æœé“¾è¡¨ä¸­å­˜åœ¨ç¯</em> ï¼Œåˆ™è¿”å› <code>true</code> ã€‚ å¦åˆ™ï¼Œè¿”å› <code>false</code> ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><p><img src="circularlinkedlist.png" alt="img"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">è¾“å…¥ï¼š<span class="hljs-built_in">head</span> = [3,2,0,-4], pos = 1<br>è¾“å‡ºï¼š<span class="hljs-literal">true</span><br>è§£é‡Šï¼šé“¾è¡¨ä¸­æœ‰ä¸€ä¸ªç¯ï¼Œå…¶å°¾éƒ¨è¿æ¥åˆ°ç¬¬äºŒä¸ªèŠ‚ç‚¹ã€‚<br></code></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><p><img src="circularlinkedlist_test2.png" alt="img"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">è¾“å…¥ï¼š<span class="hljs-built_in">head</span> = [1,2], pos = 0<br>è¾“å‡ºï¼š<span class="hljs-literal">true</span><br>è§£é‡Šï¼šé“¾è¡¨ä¸­æœ‰ä¸€ä¸ªç¯ï¼Œå…¶å°¾éƒ¨è¿æ¥åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚<br></code></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><p><img src="circularlinkedlist_test3.png" alt="img"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">è¾“å…¥ï¼š<span class="hljs-built_in">head</span> = [1], pos = -1<br>è¾“å‡ºï¼š<span class="hljs-literal">false</span><br>è§£é‡Šï¼šé“¾è¡¨ä¸­æ²¡æœ‰ç¯ã€‚<br></code></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li>é“¾è¡¨ä¸­èŠ‚ç‚¹çš„æ•°ç›®èŒƒå›´æ˜¯ <code>[0, 104]</code></li><li><code>-105 &lt;= Node.val &lt;= 105</code></li><li><code>pos</code> ä¸º <code>-1</code> æˆ–è€…é“¾è¡¨ä¸­çš„ä¸€ä¸ª <strong>æœ‰æ•ˆç´¢å¼•</strong> ã€‚</li></ul><p><strong>è¿›é˜¶ï¼š</strong>ä½ èƒ½ç”¨ <code>O(1)</code>ï¼ˆå³ï¼Œå¸¸é‡ï¼‰å†…å­˜è§£å†³æ­¤é—®é¢˜å—ï¼Ÿ</p><h4 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Definition for singly-linked list.</span><br><span class="hljs-comment"> * class ListNode &#123;</span><br><span class="hljs-comment"> *     int val;</span><br><span class="hljs-comment"> *     ListNode next;</span><br><span class="hljs-comment"> *     ListNode(int x) &#123;</span><br><span class="hljs-comment"> *         val = x;</span><br><span class="hljs-comment"> *         next = null;</span><br><span class="hljs-comment"> *     &#125;</span><br><span class="hljs-comment"> * &#125;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasCycle</span><span class="hljs-params">(ListNode head)</span> &#123;<br>      HashSet&lt;ListNode&gt; nodes =  <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;ListNode&gt;();<br>      <span class="hljs-keyword">while</span>(head!=<span class="hljs-literal">null</span>)&#123;<br>        <span class="hljs-keyword">if</span>(nodes.contains(head))&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>        nodes.add(head);<br>        head=head.next;<br>      &#125;<br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
      <category>Leetcode</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Leetcode</tag>
      
      <tag>ç®€å•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>160. ç›¸äº¤é“¾è¡¨</title>
    <link href="/post/eb57e18d-7299-48fe-bafd-1e5e7926831d/"/>
    <url>/post/eb57e18d-7299-48fe-bafd-1e5e7926831d/</url>
    
    <content type="html"><![CDATA[<h3 id="160-ç›¸äº¤é“¾è¡¨"><a href="#160-ç›¸äº¤é“¾è¡¨" class="headerlink" title="160. ç›¸äº¤é“¾è¡¨"></a>160. ç›¸äº¤é“¾è¡¨</h3><p><code>hexo template generate by typora plugin templater</code></p><h4 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h4><p><a href="https://leetcode.cn/problems/intersection-of-two-linked-lists/">160. ç›¸äº¤é“¾è¡¨</a></p><p>ç®€å•</p><p>ç›¸å…³æ ‡ç­¾</p><p>ç›¸å…³ä¼ä¸š</p><p>ç»™ä½ ä¸¤ä¸ªå•é“¾è¡¨çš„å¤´èŠ‚ç‚¹ <code>headA</code> å’Œ <code>headB</code> ï¼Œè¯·ä½ æ‰¾å‡ºå¹¶è¿”å›ä¸¤ä¸ªå•é“¾è¡¨ç›¸äº¤çš„èµ·å§‹èŠ‚ç‚¹ã€‚å¦‚æœä¸¤ä¸ªé“¾è¡¨ä¸å­˜åœ¨ç›¸äº¤èŠ‚ç‚¹ï¼Œè¿”å› <code>null</code> ã€‚</p><p>å›¾ç¤ºä¸¤ä¸ªé“¾è¡¨åœ¨èŠ‚ç‚¹ <code>c1</code> å¼€å§‹ç›¸äº¤<strong>ï¼š</strong></p><p><a href="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2018/12/14/160_statement.png"><img src="160.%E7%9B%B8%E4%BA%A4%E9%93%BE%E8%A1%A8/160_statement.png" alt="img"></a></p><p>é¢˜ç›®æ•°æ® <strong>ä¿è¯</strong> æ•´ä¸ªé“¾å¼ç»“æ„ä¸­ä¸å­˜åœ¨ç¯ã€‚</p><p><strong>æ³¨æ„</strong>ï¼Œå‡½æ•°è¿”å›ç»“æœåï¼Œé“¾è¡¨å¿…é¡» <strong>ä¿æŒå…¶åŸå§‹ç»“æ„</strong> ã€‚</p><p><strong>è‡ªå®šä¹‰è¯„æµ‹ï¼š</strong></p><p><strong>è¯„æµ‹ç³»ç»Ÿ</strong> çš„è¾“å…¥å¦‚ä¸‹ï¼ˆä½ è®¾è®¡çš„ç¨‹åº <strong>ä¸é€‚ç”¨</strong> æ­¤è¾“å…¥ï¼‰ï¼š</p><ul><li><code>intersectVal</code> - ç›¸äº¤çš„èµ·å§‹èŠ‚ç‚¹çš„å€¼ã€‚å¦‚æœä¸å­˜åœ¨ç›¸äº¤èŠ‚ç‚¹ï¼Œè¿™ä¸€å€¼ä¸º <code>0</code></li><li><code>listA</code> - ç¬¬ä¸€ä¸ªé“¾è¡¨</li><li><code>listB</code> - ç¬¬äºŒä¸ªé“¾è¡¨</li><li><code>skipA</code> - åœ¨ <code>listA</code> ä¸­ï¼ˆä»å¤´èŠ‚ç‚¹å¼€å§‹ï¼‰è·³åˆ°äº¤å‰èŠ‚ç‚¹çš„èŠ‚ç‚¹æ•°</li><li><code>skipB</code> - åœ¨ <code>listB</code> ä¸­ï¼ˆä»å¤´èŠ‚ç‚¹å¼€å§‹ï¼‰è·³åˆ°äº¤å‰èŠ‚ç‚¹çš„èŠ‚ç‚¹æ•°</li></ul><p>è¯„æµ‹ç³»ç»Ÿå°†æ ¹æ®è¿™äº›è¾“å…¥åˆ›å»ºé“¾å¼æ•°æ®ç»“æ„ï¼Œå¹¶å°†ä¸¤ä¸ªå¤´èŠ‚ç‚¹ <code>headA</code> å’Œ <code>headB</code> ä¼ é€’ç»™ä½ çš„ç¨‹åºã€‚å¦‚æœç¨‹åºèƒ½å¤Ÿæ­£ç¡®è¿”å›ç›¸äº¤èŠ‚ç‚¹ï¼Œé‚£ä¹ˆä½ çš„è§£å†³æ–¹æ¡ˆå°†è¢« <strong>è§†ä½œæ­£ç¡®ç­”æ¡ˆ</strong> ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><p><a href="https://assets.leetcode.com/uploads/2018/12/13/160_example_1.png"><img src="160.%E7%9B%B8%E4%BA%A4%E9%93%BE%E8%A1%A8/160_example_1_1.png" alt="img"></a></p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs dns">è¾“å…¥ï¼šintersectVal = <span class="hljs-number">8</span>, listA = [<span class="hljs-number">4,1,8,4</span>,<span class="hljs-number">5</span>], listB = [<span class="hljs-number">5,6,1,8</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>], skipA = <span class="hljs-number">2</span>, skipB = <span class="hljs-number">3</span><br>è¾“å‡ºï¼šIntersected at &#x27;<span class="hljs-number">8</span>&#x27;<br>è§£é‡Šï¼šç›¸äº¤èŠ‚ç‚¹çš„å€¼ä¸º <span class="hljs-number">8</span> ï¼ˆæ³¨æ„ï¼Œå¦‚æœä¸¤ä¸ªé“¾è¡¨ç›¸äº¤åˆ™ä¸èƒ½ä¸º <span class="hljs-number">0</span>ï¼‰ã€‚<br>ä»å„è‡ªçš„è¡¨å¤´å¼€å§‹ç®—èµ·ï¼Œé“¾è¡¨ <span class="hljs-keyword">A</span> ä¸º [<span class="hljs-number">4,1,8,4</span>,<span class="hljs-number">5</span>]ï¼Œé“¾è¡¨ B ä¸º [<span class="hljs-number">5,6,1,8</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>]ã€‚<br>åœ¨ <span class="hljs-keyword">A</span> ä¸­ï¼Œç›¸äº¤èŠ‚ç‚¹å‰æœ‰ <span class="hljs-number">2</span> ä¸ªèŠ‚ç‚¹ï¼›åœ¨ B ä¸­ï¼Œç›¸äº¤èŠ‚ç‚¹å‰æœ‰ <span class="hljs-number">3</span> ä¸ªèŠ‚ç‚¹ã€‚<br>â€” è¯·æ³¨æ„ç›¸äº¤èŠ‚ç‚¹çš„å€¼ä¸ä¸º <span class="hljs-number">1</span>ï¼Œå› ä¸ºåœ¨é“¾è¡¨ <span class="hljs-keyword">A</span> å’Œé“¾è¡¨ B ä¹‹ä¸­å€¼ä¸º <span class="hljs-number">1</span> çš„èŠ‚ç‚¹ (<span class="hljs-keyword">A</span> ä¸­ç¬¬äºŒä¸ªèŠ‚ç‚¹å’Œ B ä¸­ç¬¬ä¸‰ä¸ªèŠ‚ç‚¹) æ˜¯ä¸åŒçš„èŠ‚ç‚¹ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒä»¬åœ¨å†…å­˜ä¸­æŒ‡å‘ä¸¤ä¸ªä¸åŒçš„ä½ç½®ï¼Œè€Œé“¾è¡¨ <span class="hljs-keyword">A</span> å’Œé“¾è¡¨ B ä¸­å€¼ä¸º <span class="hljs-number">8</span> çš„èŠ‚ç‚¹ (<span class="hljs-keyword">A</span> ä¸­ç¬¬ä¸‰ä¸ªèŠ‚ç‚¹ï¼ŒB ä¸­ç¬¬å››ä¸ªèŠ‚ç‚¹) åœ¨å†…å­˜ä¸­æŒ‡å‘ç›¸åŒçš„ä½ç½®ã€‚<br></code></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><p><a href="https://assets.leetcode.com/uploads/2018/12/13/160_example_2.png"><img src="160.%E7%9B%B8%E4%BA%A4%E9%93%BE%E8%A1%A8/160_example_2.png" alt="img"></a></p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs prolog">è¾“å…¥ï¼šintersectVal = <span class="hljs-number">2</span>, listA = [<span class="hljs-number">1</span>,<span class="hljs-number">9</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">4</span>], listB = [<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">4</span>], skipA = <span class="hljs-number">3</span>, skipB = <span class="hljs-number">1</span><br>è¾“å‡ºï¼š<span class="hljs-symbol">Intersected</span> at <span class="hljs-string">&#x27;2&#x27;</span><br>è§£é‡Šï¼šç›¸äº¤èŠ‚ç‚¹çš„å€¼ä¸º <span class="hljs-number">2</span> ï¼ˆæ³¨æ„ï¼Œå¦‚æœä¸¤ä¸ªé“¾è¡¨ç›¸äº¤åˆ™ä¸èƒ½ä¸º <span class="hljs-number">0</span>ï¼‰ã€‚<br>ä»å„è‡ªçš„è¡¨å¤´å¼€å§‹ç®—èµ·ï¼Œé“¾è¡¨ <span class="hljs-symbol">A</span> ä¸º [<span class="hljs-number">1</span>,<span class="hljs-number">9</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">4</span>]ï¼Œé“¾è¡¨ <span class="hljs-symbol">B</span> ä¸º [<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">4</span>]ã€‚<br>åœ¨ <span class="hljs-symbol">A</span> ä¸­ï¼Œç›¸äº¤èŠ‚ç‚¹å‰æœ‰ <span class="hljs-number">3</span> ä¸ªèŠ‚ç‚¹ï¼›åœ¨ <span class="hljs-symbol">B</span> ä¸­ï¼Œç›¸äº¤èŠ‚ç‚¹å‰æœ‰ <span class="hljs-number">1</span> ä¸ªèŠ‚ç‚¹ã€‚<br></code></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><p><a href="https://assets.leetcode.com/uploads/2018/12/13/160_example_3.png"><img src="160.%E7%9B%B8%E4%BA%A4%E9%93%BE%E8%A1%A8/160_example_3.png" alt="img"></a></p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">è¾“å…¥ï¼š<span class="hljs-built_in">int</span>ersectVal = <span class="hljs-number">0</span>, listA = [<span class="hljs-number">2</span>,<span class="hljs-number">6</span>,<span class="hljs-number">4</span>], listB = [<span class="hljs-number">1</span>,<span class="hljs-number">5</span>], skipA = <span class="hljs-number">3</span>, skipB = <span class="hljs-number">2</span><br>è¾“å‡ºï¼š<span class="hljs-literal">null</span><br>è§£é‡Šï¼šä»å„è‡ªçš„è¡¨å¤´å¼€å§‹ç®—èµ·ï¼Œé“¾è¡¨ A ä¸º [<span class="hljs-number">2</span>,<span class="hljs-number">6</span>,<span class="hljs-number">4</span>]ï¼Œé“¾è¡¨ B ä¸º [<span class="hljs-number">1</span>,<span class="hljs-number">5</span>]ã€‚<br>ç”±äºè¿™ä¸¤ä¸ªé“¾è¡¨ä¸ç›¸äº¤ï¼Œæ‰€ä»¥ <span class="hljs-built_in">int</span>ersectVal å¿…é¡»ä¸º <span class="hljs-number">0</span>ï¼Œè€Œ skipA å’Œ skipB å¯ä»¥æ˜¯ä»»æ„å€¼ã€‚<br>è¿™ä¸¤ä¸ªé“¾è¡¨ä¸ç›¸äº¤ï¼Œå› æ­¤è¿”å› <span class="hljs-literal">null</span> ã€‚<br></code></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li><code>listA</code> ä¸­èŠ‚ç‚¹æ•°ç›®ä¸º <code>m</code></li><li><code>listB</code> ä¸­èŠ‚ç‚¹æ•°ç›®ä¸º <code>n</code></li><li><code>1 &lt;= m, n &lt;= 3 * 104</code></li><li><code>1 &lt;= Node.val &lt;= 105</code></li><li><code>0 &lt;= skipA &lt;= m</code></li><li><code>0 &lt;= skipB &lt;= n</code></li><li>å¦‚æœ <code>listA</code> å’Œ <code>listB</code> æ²¡æœ‰äº¤ç‚¹ï¼Œ<code>intersectVal</code> ä¸º <code>0</code></li><li>å¦‚æœ <code>listA</code> å’Œ <code>listB</code> æœ‰äº¤ç‚¹ï¼Œ<code>intersectVal == listA[skipA] == listB[skipB]</code></li></ul><p><strong>è¿›é˜¶ï¼š</strong>ä½ èƒ½å¦è®¾è®¡ä¸€ä¸ªæ—¶é—´å¤æ‚åº¦ <code>O(m + n)</code> ã€ä»…ç”¨ <code>O(1)</code> å†…å­˜çš„è§£å†³æ–¹æ¡ˆï¼Ÿ</p><h4 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Definition for singly-linked list.</span><br><span class="hljs-comment"> * public class ListNode &#123;</span><br><span class="hljs-comment"> *     int val;</span><br><span class="hljs-comment"> *     ListNode next;</span><br><span class="hljs-comment"> *     ListNode(int x) &#123;</span><br><span class="hljs-comment"> *         val = x;</span><br><span class="hljs-comment"> *         next = null;</span><br><span class="hljs-comment"> *     &#125;</span><br><span class="hljs-comment"> * &#125;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br>    <span class="hljs-keyword">public</span> ListNode <span class="hljs-title function_">getIntersectionNode</span><span class="hljs-params">(ListNode headA, ListNode headB)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">lengthA</span> <span class="hljs-operator">=</span> getLength(headA);<br>        <span class="hljs-type">int</span> <span class="hljs-variable">lengthB</span> <span class="hljs-operator">=</span> getLength(headB);<br>        <span class="hljs-type">int</span> <span class="hljs-variable">diff</span> <span class="hljs-operator">=</span>  lengthA - lengthB;<br>    <br>        <span class="hljs-keyword">if</span>(diff&gt;<span class="hljs-number">0</span>)&#123;<br>           headA = step(headA,diff);<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>           headB = step(headB,-diff);<br>        &#125;<br>        <span class="hljs-keyword">while</span>(headA!=<span class="hljs-literal">null</span> &amp;&amp; headB!=<span class="hljs-literal">null</span>)&#123;<br>            <span class="hljs-keyword">if</span>(headA == headB)&#123;<br>                <span class="hljs-keyword">return</span> headA;<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                headA=headA.next;<br>                headB=headB.next;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br><br>        <br>    &#125;<br>    <span class="hljs-comment">//è®¡ç®—é“¾è¡¨é•¿åº¦</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getLength</span><span class="hljs-params">(ListNode node)</span>&#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">length</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">while</span>(node != <span class="hljs-literal">null</span>)&#123;<br>            length++;<br>            node=node.next;<br>        &#125;<br>        <span class="hljs-keyword">return</span> length;<br>    &#125;<br>    <span class="hljs-comment">//é“¾è¡¨</span><br>    <span class="hljs-keyword">public</span> ListNode <span class="hljs-title function_">step</span><span class="hljs-params">(ListNode node, <span class="hljs-type">int</span> index)</span>&#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;index;i++)&#123;<br>            <span class="hljs-keyword">if</span>(node == <span class="hljs-literal">null</span>)&#123;<span class="hljs-keyword">break</span>;&#125;<br>            node=node.next;<br>        &#125;<br>        <span class="hljs-keyword">return</span> node;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
      <category>Leetcode</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Leetcode</tag>
      
      <tag>ç®€å•</tag>
      
      <tag>Hot100</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>1. ä¸¤æ•°ä¹‹å’Œ</title>
    <link href="/post/7621490a-4678-4469-b294-dd6e080e1491/"/>
    <url>/post/7621490a-4678-4469-b294-dd6e080e1491/</url>
    
    <content type="html"><![CDATA[<h3 id="1-ä¸¤æ•°ä¹‹å’Œ"><a href="#1-ä¸¤æ•°ä¹‹å’Œ" class="headerlink" title="1. ä¸¤æ•°ä¹‹å’Œ"></a>1. ä¸¤æ•°ä¹‹å’Œ</h3><p><code>hexo template generate by typora plugin templater</code></p><h4 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h4><p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>nums</code> å’Œä¸€ä¸ªæ•´æ•°ç›®æ ‡å€¼ <code>target</code>ï¼Œè¯·ä½ åœ¨è¯¥æ•°ç»„ä¸­æ‰¾å‡º <strong>å’Œä¸ºç›®æ ‡å€¼</strong> <em><code>target</code></em> çš„é‚£ <strong>ä¸¤ä¸ª</strong> æ•´æ•°ï¼Œå¹¶è¿”å›å®ƒä»¬çš„æ•°ç»„ä¸‹æ ‡ã€‚</p><p>ä½ å¯ä»¥å‡è®¾æ¯ç§è¾“å…¥åªä¼šå¯¹åº”ä¸€ä¸ªç­”æ¡ˆã€‚ä½†æ˜¯ï¼Œæ•°ç»„ä¸­åŒä¸€ä¸ªå…ƒç´ åœ¨ç­”æ¡ˆé‡Œä¸èƒ½é‡å¤å‡ºç°ã€‚</p><p>ä½ å¯ä»¥æŒ‰ä»»æ„é¡ºåºè¿”å›ç­”æ¡ˆã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs inform7">è¾“å…¥ï¼šnums = <span class="hljs-comment">[2,7,11,15]</span>, target = 9<br>è¾“å‡ºï¼š<span class="hljs-comment">[0,1]</span><br>è§£é‡Šï¼šå› ä¸º nums<span class="hljs-comment">[0]</span> + nums<span class="hljs-comment">[1]</span> == 9 ï¼Œè¿”å› <span class="hljs-comment">[0, 1]</span> ã€‚<br></code></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs inform7">è¾“å…¥ï¼šnums = <span class="hljs-comment">[3,2,4]</span>, target = 6<br>è¾“å‡ºï¼š<span class="hljs-comment">[1,2]</span><br></code></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs inform7">è¾“å…¥ï¼šnums = <span class="hljs-comment">[3,3]</span>, target = 6<br>è¾“å‡ºï¼š<span class="hljs-comment">[0,1]</span><br></code></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li><code>2 &lt;= nums.length &lt;= 104</code></li><li><code>-109 &lt;= nums[i] &lt;= 109</code></li><li><code>-109 &lt;= target &lt;= 109</code></li><li><strong>åªä¼šå­˜åœ¨ä¸€ä¸ªæœ‰æ•ˆç­”æ¡ˆ</strong></li><li><strong>è¿›é˜¶ï¼š</strong>ä½ å¯ä»¥æƒ³å‡ºä¸€ä¸ªæ—¶é—´å¤æ‚åº¦å°äº <code>O(n2)</code> çš„ç®—æ³•å—ï¼Ÿ</li></ul><h4 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span>[] twoSum(<span class="hljs-type">int</span>[] nums, <span class="hljs-type">int</span> target) &#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; a&lt;nums.length-<span class="hljs-number">1</span>;a++)&#123;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span>a+<span class="hljs-number">1</span> ;b&lt;nums.length;b++)&#123;<br>                <span class="hljs-keyword">if</span>(nums[a] + nums[b] == target)&#123;<br>                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[]&#123; a, b &#125;;<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[]&#123;&#125;;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="è¿›é˜¶"><a href="#è¿›é˜¶" class="headerlink" title="è¿›é˜¶"></a>è¿›é˜¶</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span>[] twoSum(<span class="hljs-type">int</span>[] nums, <span class="hljs-type">int</span> target) &#123;<br>        HashMap&lt;Integer,Integer&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;Integer,Integer&gt;();<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;nums.length;i++)&#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">num</span> <span class="hljs-operator">=</span> target - nums[i]; <br>            <span class="hljs-type">Integer</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> map.get(num);<br>            <span class="hljs-keyword">if</span> ( index != <span class="hljs-literal">null</span> )&#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[]&#123;i, index&#125;;<br>            &#125;<br>            map.put(nums[i] , i);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[]&#123;&#125;;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
      <category>Leetcode</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Leetcode</tag>
      
      <tag>ç®€å•</tag>
      
      <tag>Hot100</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Redisæ•°æ®åº“</title>
    <link href="/post/391f27be-4063-4463-8247-5a836059d100/"/>
    <url>/post/391f27be-4063-4463-8247-5a836059d100/</url>
    
    <content type="html"><![CDATA[<h3 id="Redisæ•°æ®åº“"><a href="#Redisæ•°æ®åº“" class="headerlink" title="Redisæ•°æ®åº“"></a>Redisæ•°æ®åº“</h3><p><code>hexo template generate by typora plugin templater</code></p><p><img src="po12HL4Gjl8QOIE.jpg" alt="ç‚¹å‡»æŸ¥çœ‹æºç½‘é¡µ"></p><h1 id="Redisæ•°æ®åº“-1"><a href="#Redisæ•°æ®åº“-1" class="headerlink" title="Redisæ•°æ®åº“"></a>Redisæ•°æ®åº“</h1><p><strong>çµé­‚æ‹·é—®ï¼š</strong> ä¸æ˜¯å­¦äº†MySQLå—ï¼Œå­˜æ•°æ®ä¹Ÿèƒ½å­˜äº†å•Šï¼Œåˆå­¦ä¸€ä¸ªæ•°æ®åº“å¹²å˜›ï¼Ÿ</p><p>åœ¨å‰é¢æˆ‘ä»¬å­¦ä¹ äº†MySQLæ•°æ®åº“ï¼Œå®ƒæ˜¯ä¸€ç§ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨MySQLæ¥æ›´å¥½åœ°ç®¡ç†å’Œç»„ç»‡æˆ‘ä»¬çš„æ•°æ®ï¼Œè™½ç„¶åœ¨å°å‹Webåº”ç”¨ä¸‹ï¼Œåªéœ€è¦ä¸€ä¸ªMySQL+Mybatisè‡ªå¸¦çš„ç¼“å­˜ç³»ç»Ÿå°±å¯ä»¥èƒœä»»å¤§éƒ¨åˆ†çš„æ•°æ®å­˜å‚¨å·¥ä½œã€‚ä½†æ˜¯MySQLçš„ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå®ƒçš„æ•°æ®å§‹ç»ˆæ˜¯å­˜å‚¨åœ¨ç¡¬ç›˜ä¸Šçš„ï¼Œå¯¹äºæˆ‘ä»¬çš„ç”¨æˆ·ä¿¡æ¯è¿™ç§ä¸éœ€è¦ç»å¸¸å‘ç”Ÿä¿®æ”¹çš„å†…å®¹ï¼Œä½¿ç”¨MySQLå­˜å‚¨ç¡®å®å¯ä»¥ï¼Œä½†æ˜¯å¦‚æœæ˜¯å¿«é€Ÿæ›´æ–°æˆ–æ˜¯é¢‘ç¹ä½¿ç”¨çš„æ•°æ®ï¼Œæ¯”å¦‚å¾®åšçƒ­æœã€åŒåä¸€ç§’æ€ï¼Œè¿™äº›æ•°æ®ä¸ä»…è¦æ±‚æœåŠ¡å™¨éœ€è¦æä¾›æ›´é«˜çš„å“åº”é€Ÿåº¦ï¼Œè€Œä¸”è¿˜éœ€è¦é¢å¯¹çŸ­æ—¶é—´å†…ä¸Šç™¾ä¸‡ç”šè‡³ä¸Šåƒä¸‡æ¬¡è®¿é—®ï¼Œè€ŒMySQLçš„ç£ç›˜IOè¯»å†™æ€§èƒ½å®Œå…¨ä¸èƒ½æ»¡è¶³ä¸Šé¢çš„éœ€æ±‚ï¼Œèƒ½å¤Ÿæ»¡è¶³ä¸Šè¿°éœ€æ±‚çš„åªæœ‰å†…å­˜ï¼Œå› ä¸ºé€Ÿåº¦è¿œé«˜äºç£ç›˜IOã€‚</p><p>å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å¯»æ‰¾ä¸€ç§æ›´å¥½çš„è§£å†³æ–¹æ¡ˆï¼Œæ¥å­˜å‚¨ä¸Šè¿°è¿™ç±»ç‰¹æ®Šæ•°æ®ï¼Œå¼¥è¡¥MySQLçš„ä¸è¶³ï¼Œä»¥åº”å¯¹å¤§æ•°æ®æ—¶ä»£çš„é‡é‡è€ƒéªŒã€‚</p><h2 id="NoSQLæ¦‚è®º"><a href="#NoSQLæ¦‚è®º" class="headerlink" title="NoSQLæ¦‚è®º"></a>NoSQLæ¦‚è®º</h2><p>NoSQLå…¨ç§°æ˜¯Not Only SQLï¼ˆä¸ä»…ä»…æ˜¯SQLï¼‰å®ƒæ˜¯ä¸€ç§éå…³ç³»å‹æ•°æ®åº“ï¼Œç›¸æ¯”ä¼ ç»ŸSQLå…³ç³»å‹æ•°æ®åº“ï¼Œå®ƒï¼š</p><ul><li>ä¸ä¿è¯å…³ç³»æ•°æ®çš„ACIDç‰¹æ€§</li><li>å¹¶ä¸éµå¾ªSQLæ ‡å‡†</li><li>æ¶ˆé™¤æ•°æ®ä¹‹é—´å…³è”æ€§</li></ul><p>ä¹ä¸€çœ‹ï¼Œè¿™ç©æ„ä¸æ¯”MySQLåƒåœ¾ï¼Ÿæˆ‘ä»¬å†æ¥çœ‹çœ‹å®ƒçš„ä¼˜åŠ¿ï¼š</p><ul><li>è¿œè¶…ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“çš„æ€§èƒ½</li><li>éå¸¸æ˜“äºæ‰©å±•</li><li>æ•°æ®æ¨¡å‹æ›´åŠ çµæ´»</li><li>é«˜å¯ç”¨</li></ul><p>è¿™æ ·ï¼ŒNoSQLçš„ä¼˜åŠ¿ä¸€ä¸‹å°±å‡ºæ¥äº†ï¼Œè¿™ä¸å°±æ˜¯æˆ‘ä»¬æ­£è¦å¯»æ‰¾çš„é«˜å¹¶å‘æµ·é‡æ•°æ®çš„è§£å†³æ–¹æ¡ˆå—ï¼</p><p>NoSQLæ•°æ®åº“åˆ†ä¸ºä»¥ä¸‹å‡ ç§ï¼š</p><ul><li><strong>é”®å€¼å­˜å‚¨æ•°æ®åº“ï¼š</strong> æ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯ä»¥é”®å€¼æ–¹å¼å­˜å‚¨çš„ï¼Œç±»ä¼¼äºæˆ‘ä»¬ä¹‹å‰å­¦è¿‡çš„HashMapï¼Œä½¿ç”¨èµ·æ¥éå¸¸ç®€å•æ–¹ä¾¿ï¼Œæ€§èƒ½ä¹Ÿéå¸¸é«˜ã€‚</li><li><strong>åˆ—å­˜å‚¨æ•°æ®åº“ï¼š</strong> è¿™éƒ¨åˆ†æ•°æ®åº“é€šå¸¸æ˜¯ç”¨æ¥åº”å¯¹åˆ†å¸ƒå¼å­˜å‚¨çš„æµ·é‡æ•°æ®ã€‚é”®ä»ç„¶å­˜åœ¨ï¼Œä½†æ˜¯å®ƒä»¬çš„ç‰¹ç‚¹æ˜¯æŒ‡å‘äº†å¤šä¸ªåˆ—ã€‚</li><li><strong>æ–‡æ¡£å‹æ•°æ®åº“ï¼š</strong> å®ƒæ˜¯ä»¥ä¸€ç§ç‰¹å®šçš„æ–‡æ¡£æ ¼å¼å­˜å‚¨æ•°æ®ï¼Œæ¯”å¦‚JSONæ ¼å¼ï¼Œåœ¨å¤„ç†ç½‘é¡µç­‰å¤æ‚æ•°æ®æ—¶ï¼Œæ–‡æ¡£å‹æ•°æ®åº“æ¯”ä¼ ç»Ÿé”®å€¼æ•°æ®åº“çš„æŸ¥è¯¢æ•ˆç‡æ›´é«˜ã€‚</li><li><strong>å›¾å½¢æ•°æ®åº“ï¼š</strong> åˆ©ç”¨ç±»ä¼¼äºå›¾çš„æ•°æ®ç»“æ„å­˜å‚¨æ•°æ®ï¼Œç»“åˆå›¾ç›¸å…³ç®—æ³•å®ç°é«˜é€Ÿè®¿é—®ã€‚</li></ul><p>å…¶ä¸­æˆ‘ä»¬è¦å­¦ä¹ çš„Redisæ•°æ®åº“ï¼Œå°±æ˜¯ä¸€ä¸ªå¼€æºçš„<strong>é”®å€¼å­˜å‚¨æ•°æ®åº“</strong>ï¼Œæ‰€æœ‰çš„æ•°æ®å…¨éƒ¨å­˜æ”¾åœ¨å†…å­˜ä¸­ï¼Œå®ƒçš„æ€§èƒ½å¤§å¤§é«˜äºç£ç›˜IOï¼Œå¹¶ä¸”å®ƒä¹Ÿå¯ä»¥æ”¯æŒæ•°æ®æŒä¹…åŒ–ï¼Œä»–è¿˜æ”¯æŒæ¨ªå‘æ‰©å±•ã€ä¸»ä»å¤åˆ¶ç­‰ã€‚</p><p>å®é™…ç”Ÿäº§ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šé…åˆä½¿ç”¨Rediså’ŒMySQLä»¥å‘æŒ¥å®ƒä»¬å„è‡ªçš„ä¼˜åŠ¿ï¼Œå–é•¿è¡¥çŸ­ã€‚</p><h2 id="Rediså®‰è£…å’Œéƒ¨ç½²"><a href="#Rediså®‰è£…å’Œéƒ¨ç½²" class="headerlink" title="Rediså®‰è£…å’Œéƒ¨ç½²"></a>Rediså®‰è£…å’Œéƒ¨ç½²</h2><p>æˆ‘ä»¬è¿™é‡Œè¿˜æ˜¯ä½¿ç”¨Windowså®‰è£…RedisæœåŠ¡å™¨ï¼Œä½†æ˜¯å®˜æ–¹æŒ‡å®šæ˜¯å®‰è£…åˆ°LinuxæœåŠ¡å™¨ä¸Šï¼Œæˆ‘ä»¬åé¢å­¦ä¹ äº†Linuxä¹‹åï¼Œå†æ¥å®‰è£…åˆ°LinuxæœåŠ¡å™¨ä¸Šã€‚ç”±äºå®˜æ–¹å¹¶æ²¡æœ‰æä¾›Windowsç‰ˆæœ¬çš„å®‰è£…åŒ…ï¼Œæˆ‘ä»¬éœ€è¦å¦å¤–å¯»æ‰¾ï¼š</p><ul><li>å®˜ç½‘åœ°å€ï¼š<a href="https://redis.io/">https://redis.io</a></li><li>GitHub Windowsç‰ˆæœ¬ç»´æŠ¤åœ°å€ï¼š<a href="https://github.com/tporadowski/redis/releases">https://github.com/tporadowski/redis/releases</a></li></ul><hr><h2 id="åŸºæœ¬æ“ä½œ"><a href="#åŸºæœ¬æ“ä½œ" class="headerlink" title="åŸºæœ¬æ“ä½œ"></a>åŸºæœ¬æ“ä½œ</h2><p>åœ¨æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨MySQLæ—¶ï¼Œæˆ‘ä»¬éœ€è¦å…ˆåœ¨æ•°æ®åº“ä¸­åˆ›å»ºä¸€å¼ è¡¨ï¼Œå¹¶å®šä¹‰å¥½è¡¨çš„æ¯ä¸ªå­—æ®µå†…å®¹ï¼Œæœ€åå†é€šè¿‡<code>insert</code>è¯­å¥å‘è¡¨ä¸­æ·»åŠ æ•°æ®ï¼Œè€ŒRediså¹¶ä¸å…·æœ‰MySQLé‚£æ ·çš„ä¸¥æ ¼çš„è¡¨ç»“æ„ï¼ŒRedisæ˜¯ä¸€ä¸ªé”®å€¼æ•°æ®åº“ï¼Œå› æ­¤ï¼Œå¯ä»¥åƒMapä¸€æ ·çš„æ“ä½œæ–¹å¼ï¼Œé€šè¿‡é”®å€¼å¯¹å‘Redisæ•°æ®åº“ä¸­æ·»åŠ æ•°æ®ï¼ˆæ“ä½œèµ·æ¥ç±»ä¼¼äºå‘ä¸€ä¸ªHashMapä¸­å­˜æ”¾æ•°æ®ï¼‰</p><p>åœ¨Redisä¸‹ï¼Œæ•°æ®åº“æ˜¯ç”±ä¸€ä¸ªæ•´æ•°ç´¢å¼•æ ‡è¯†ï¼Œè€Œä¸æ˜¯ç”±ä¸€ä¸ªæ•°æ®åº“åç§°ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¿æ¥Redisæ•°æ®åº“ä¹‹åï¼Œä¼šä½¿ç”¨0å·æ•°æ®åº“ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡Redisé…ç½®æ–‡ä»¶ä¸­çš„å‚æ•°æ¥ä¿®æ”¹æ•°æ®åº“æ€»æ•°ï¼Œé»˜è®¤ä¸º16ä¸ªã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>select</code>è¯­å¥è¿›è¡Œåˆ‡æ¢ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> åºå·;<br></code></pre></td></tr></table></figure><h3 id="æ•°æ®æ“ä½œ"><a href="#æ•°æ®æ“ä½œ" class="headerlink" title="æ•°æ®æ“ä½œ"></a>æ•°æ®æ“ä½œ</h3><p>æˆ‘ä»¬æ¥çœ‹çœ‹ï¼Œå¦‚ä½•å‘Redisæ•°æ®åº“ä¸­æ·»åŠ æ•°æ®ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">set</span> <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span><span class="hljs-keyword">value</span><span class="hljs-operator">&gt;</span><br><span class="hljs-comment">-- ä¸€æ¬¡æ€§å¤šä¸ª</span><br>mset [<span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span><span class="hljs-keyword">value</span><span class="hljs-operator">&gt;</span>]...<br></code></pre></td></tr></table></figure><p>æ‰€æœ‰å­˜å…¥çš„æ•°æ®é»˜è®¤ä¼šä»¥<strong>å­—ç¬¦ä¸²</strong>çš„å½¢å¼ä¿å­˜ï¼Œé”®å€¼å…·æœ‰ä¸€å®šçš„å‘½åè§„èŒƒï¼Œä»¥æ–¹ä¾¿æˆ‘ä»¬å¯ä»¥å¿«é€Ÿå®šä½æˆ‘ä»¬çš„æ•°æ®å±äºå“ªä¸€ä¸ªéƒ¨åˆ†ï¼Œæ¯”å¦‚ç”¨æˆ·çš„æ•°æ®ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- ä½¿ç”¨å†’å·æ¥è¿›è¡Œæ¿å—åˆ†å‰²ï¼Œæ¯”å¦‚ä¸‹é¢è¡¨ç¤ºç”¨æˆ·XXXçš„ä¿¡æ¯ä¸­çš„nameå±æ€§ï¼Œå€¼ä¸ºlbw</span><br><span class="hljs-keyword">set</span> <span class="hljs-keyword">user</span>:info:ç”¨æˆ·ID:name lbw<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡é”®å€¼è·å–å­˜å…¥çš„å€¼ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">get</span> <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><br></code></pre></td></tr></table></figure><p>ä½ ä»¥ä¸ºRediså°±ä»…ä»…åªæ˜¯å­˜å–ä¸ªæ•°æ®å—ï¼Ÿå®ƒè¿˜æ”¯æŒæ•°æ®çš„è¿‡æœŸæ—¶é—´è®¾å®šï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">set</span> <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span><span class="hljs-keyword">value</span><span class="hljs-operator">&gt;</span> EX ç§’<br><span class="hljs-keyword">set</span> <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span><span class="hljs-keyword">value</span><span class="hljs-operator">&gt;</span> PX æ¯«ç§’<br></code></pre></td></tr></table></figure><p>å½“æ•°æ®åˆ°è¾¾æŒ‡å®šæ—¶é—´æ—¶ï¼Œä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥å•ç‹¬ä¸ºå…¶ä»–çš„é”®å€¼å¯¹è®¾ç½®è¿‡æœŸæ—¶é—´ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">expire <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span> ç§’<br></code></pre></td></tr></table></figure><p>é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ¥æŸ¥è¯¢æŸä¸ªé”®å€¼å¯¹çš„è¿‡æœŸæ—¶é—´è¿˜å‰©å¤šå°‘ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">ttl <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><br><span class="hljs-comment">-- æ¯«ç§’æ˜¾ç¤º</span><br>pttl <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><br><span class="hljs-comment">-- è½¬æ¢ä¸ºæ°¸ä¹…</span><br>persist <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆå½“æˆ‘ä»¬æƒ³ç›´æ¥åˆ é™¤è¿™ä¸ªæ•°æ®æ—¶å‘¢ï¼Ÿç›´æ¥ä½¿ç”¨ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">del <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span>...<br></code></pre></td></tr></table></figure><p>åˆ é™¤å‘½ä»¤å¯ä»¥åŒæ—¶æ‹¼æ¥å¤šä¸ªé”®å€¼ä¸€èµ·åˆ é™¤ã€‚</p><p>å½“æˆ‘ä»¬æƒ³è¦æŸ¥çœ‹æ•°æ®åº“ä¸­æ‰€æœ‰çš„é”®å€¼æ—¶ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">keys <span class="hljs-operator">*</span><br></code></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥æŸ¥è¯¢æŸä¸ªé”®æ˜¯å¦å­˜åœ¨ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">exists</span> <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span>...<br></code></pre></td></tr></table></figure><p>è¿˜å¯ä»¥éšæœºæ‹¿ä¸€ä¸ªé”®ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">randomkey<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥å°†ä¸€ä¸ªæ•°æ®åº“ä¸­çš„å†…å®¹ç§»åŠ¨åˆ°å¦ä¸€ä¸ªæ•°æ®åº“ä¸­ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">move <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span> æ•°æ®åº“åºå·<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹ä¸€ä¸ªé”®ä¸ºå¦ä¸€ä¸ªé”®ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">rename <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>æ–°çš„åç§°<span class="hljs-operator">&gt;</span><br><span class="hljs-comment">-- ä¸‹é¢è¿™ä¸ªä¼šæ£€æŸ¥æ–°çš„åç§°æ˜¯å¦å·²ç»å­˜åœ¨</span><br>renamex <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>æ–°çš„åç§°<span class="hljs-operator">&gt;</span><br></code></pre></td></tr></table></figure><p>å¦‚æœå­˜æ”¾çš„æ•°æ®æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¯¹å…¶è¿›è¡Œè‡ªå¢è‡ªå‡æ“ä½œï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- ç­‰ä»·äºa = a + 1</span><br>incr <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><br><span class="hljs-comment">-- ç­‰ä»·äºa = a + b</span><br>incrby <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span> b<br><span class="hljs-comment">-- ç­‰ä»·äºa = a - 1</span><br>decr <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><br></code></pre></td></tr></table></figure><p>æœ€åå°±æ˜¯æŸ¥çœ‹å€¼çš„æ•°æ®ç±»å‹ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">type <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><br></code></pre></td></tr></table></figure><p>Redisæ•°æ®åº“ä¹Ÿæ”¯æŒå¤šç§æ•°æ®ç±»å‹ï¼Œä½†æ˜¯å®ƒæ›´åå‘äºæˆ‘ä»¬åœ¨Javaä¸­è®¤è¯†çš„é‚£äº›æ•°æ®ç±»å‹ã€‚</p><h2 id="æ•°æ®ç±»å‹ä»‹ç»"><a href="#æ•°æ®ç±»å‹ä»‹ç»" class="headerlink" title="æ•°æ®ç±»å‹ä»‹ç»"></a>æ•°æ®ç±»å‹ä»‹ç»</h2><p>ä¸€ä¸ªé”®å€¼å¯¹é™¤äº†å­˜å‚¨ä¸€ä¸ªStringç±»å‹çš„å€¼ä»¥å¤–ï¼Œè¿˜æ”¯æŒå¤šç§å¸¸ç”¨çš„æ•°æ®ç±»å‹ã€‚</p><h3 id="Hash"><a href="#Hash" class="headerlink" title="Hash"></a>Hash</h3><p>è¿™ç§ç±»å‹æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªHashMapï¼Œä¹Ÿå°±æ˜¯åµŒå¥—äº†ä¸€ä¸ªHashMapç½¢äº†ï¼Œåœ¨Javaä¸­å°±åƒè¿™æ ·ï¼š</p><p>â€‹                              </p><p>â€‹        java        å¤åˆ¶ä»£ç       </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">#Redisé»˜è®¤å­˜Stringç±»ä¼¼äºè¿™æ ·ï¼š<br>Map&lt;String, String&gt; hash = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>#Rediså­˜Hashç±»å‹çš„æ•°æ®ç±»ä¼¼äºè¿™æ ·ï¼š<br>Map&lt;String, Map&lt;String, String&gt;&gt; hash = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br></code></pre></td></tr></table></figure><p>å®ƒæ¯”è¾ƒé€‚åˆå­˜å‚¨ç±»è¿™æ ·çš„æ•°æ®ï¼Œç”±äºå€¼æœ¬èº«åˆæ˜¯ä¸€ä¸ªMapï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨æ­¤Mapä¸­æ”¾å…¥ç±»çš„å„ç§å±æ€§å’Œå€¼ï¼Œä»¥å®ç°ä¸€ä¸ªHashæ•°æ®ç±»å‹å­˜å‚¨ä¸€ä¸ªç±»çš„æ•°æ®ã€‚</p><p>æˆ‘ä»¬å¯ä»¥åƒè¿™æ ·æ¥æ·»åŠ ä¸€ä¸ªHashç±»å‹çš„æ•°æ®ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">hset <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span> [<span class="hljs-operator">&lt;</span>å­—æ®µ<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>å€¼<span class="hljs-operator">&gt;</span>]...<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥ç›´æ¥è·å–ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">hget <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>å­—æ®µ<span class="hljs-operator">&gt;</span><br><span class="hljs-comment">-- å¦‚æœæƒ³è¦ä¸€æ¬¡æ€§è·å–æ‰€æœ‰çš„å­—æ®µå’Œå€¼</span><br>hgetall <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><br></code></pre></td></tr></table></figure><p>åŒæ ·çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ¤æ–­æŸä¸ªå­—æ®µæ˜¯å¦å­˜åœ¨ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">hexists <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>å­—æ®µ<span class="hljs-operator">&gt;</span><br></code></pre></td></tr></table></figure><p>åˆ é™¤Hashä¸­çš„æŸä¸ªå­—æ®µï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">hdel <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å‘ç°ï¼Œåœ¨æ“ä½œä¸€ä¸ªHashæ—¶ï¼Œå®é™…ä¸Šå°±æ˜¯æˆ‘ä»¬æ™®é€šæ“ä½œå‘½ä»¤å‰é¢æ·»åŠ ä¸€ä¸ª<code>h</code>ï¼Œè¿™æ ·å°±èƒ½ä»¥åŒæ ·çš„æ–¹å¼å»æ“ä½œHashé‡Œé¢å­˜æ”¾çš„é”®å€¼å¯¹äº†ï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€åˆ—å‡ºæ‰€æœ‰çš„æ“ä½œäº†ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹å‡ ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„ã€‚</p><p>æˆ‘ä»¬ç°åœ¨æƒ³è¦çŸ¥é“Hashä¸­ä¸€å…±å­˜äº†å¤šå°‘ä¸ªé”®å€¼å¯¹ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">hlen <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸€æ¬¡æ€§è·å–æ‰€æœ‰å­—æ®µçš„å€¼ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">hvals <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><br></code></pre></td></tr></table></figure><p>å”¯ä¸€éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒHashä¸­åªèƒ½å­˜æ”¾å­—ç¬¦ä¸²å€¼ï¼Œä¸å…è®¸å‡ºç°åµŒå¥—çš„çš„æƒ…å†µã€‚</p><h3 id="List"><a href="#List" class="headerlink" title="List"></a>List</h3><p>æˆ‘ä»¬æ¥ç€æ¥çœ‹Listç±»å‹ï¼Œå®é™…ä¸Šè¿™ä¸ªçŒœéƒ½çŸ¥é“ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œè€Œåˆ—è¡¨ä¸­å­˜æ”¾ä¸€ç³»åˆ—çš„å­—ç¬¦ä¸²ï¼Œå®ƒæ”¯æŒéšæœºè®¿é—®ï¼Œæ”¯æŒåŒç«¯æ“ä½œï¼Œå°±åƒæˆ‘ä»¬ä½¿ç”¨Javaä¸­çš„LinkedListä¸€æ ·ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ç›´æ¥å‘ä¸€ä¸ªå·²å­˜åœ¨æˆ–æ˜¯ä¸å­˜åœ¨çš„Listä¸­æ·»åŠ æ•°æ®ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- å‘åˆ—è¡¨å¤´éƒ¨æ·»åŠ å…ƒç´ </span><br>lpush <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>element<span class="hljs-operator">&gt;</span>...<br><span class="hljs-comment">-- å‘åˆ—è¡¨å°¾éƒ¨æ·»åŠ å…ƒç´ </span><br>rpush <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>element<span class="hljs-operator">&gt;</span>...<br><span class="hljs-comment">-- åœ¨æŒ‡å®šå…ƒç´ å‰é¢/åé¢æ’å…¥å…ƒç´ </span><br>linsert <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span> before<span class="hljs-operator">/</span>after <span class="hljs-operator">&lt;</span>æŒ‡å®šå…ƒç´ <span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>element<span class="hljs-operator">&gt;</span><br></code></pre></td></tr></table></figure><p>åŒæ ·çš„ï¼Œè·å–å…ƒç´ ä¹Ÿéå¸¸ç®€å•ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- æ ¹æ®ä¸‹æ ‡è·å–å…ƒç´ </span><br>lindex <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>ä¸‹æ ‡<span class="hljs-operator">&gt;</span><br><span class="hljs-comment">-- è·å–å¹¶ç§»é™¤å¤´éƒ¨å…ƒç´ </span><br>lpop <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><br><span class="hljs-comment">-- è·å–å¹¶ç§»é™¤å°¾éƒ¨å…ƒç´ </span><br>rpop <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><br><span class="hljs-comment">-- è·å–æŒ‡å®šèŒƒå›´å†…çš„</span><br>lrange <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">start</span> stop<br></code></pre></td></tr></table></figure><p>æ³¨æ„ä¸‹æ ‡å¯ä»¥ä½¿ç”¨è´Ÿæ•°æ¥è¡¨ç¤ºä»ååˆ°å‰æ•°çš„æ•°å­—ï¼ˆPythonï¼šæè¿™å„¿æŠ„å‘¢æ˜¯å§ï¼‰:</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- è·å–åˆ—è¡¨aä¸­çš„å…¨éƒ¨å…ƒç´ </span><br>lrange a <span class="hljs-number">0</span> <span class="hljs-number">-1</span><br></code></pre></td></tr></table></figure><p>æ²¡æƒ³åˆ°å§ï¼Œpushå’Œpopè¿˜èƒ½è¿ç€ç”¨å‘¢ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- ä»å‰ä¸€ä¸ªæ•°ç»„çš„æœ€åå–ä¸€ä¸ªæ•°å‡ºæ¥æ”¾åˆ°å¦ä¸€ä¸ªæ•°ç»„çš„å¤´éƒ¨ï¼Œå¹¶è¿”å›å…ƒç´ </span><br>rpoplpush å½“å‰æ•°ç»„ ç›®æ ‡æ•°ç»„<br></code></pre></td></tr></table></figure><p>å®ƒè¿˜æ”¯æŒé˜»å¡æ“ä½œï¼Œç±»ä¼¼äºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼Œæ¯”å¦‚æˆ‘ä»¬æƒ³è¦ç­‰å¾…åˆ—è¡¨ä¸­æœ‰äº†æ•°æ®åå†è¿›è¡Œpopæ“ä½œï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- å¦‚æœåˆ—è¡¨ä¸­æ²¡æœ‰å…ƒç´ ï¼Œé‚£ä¹ˆå°±ç­‰å¾…ï¼Œå¦‚æœæŒ‡å®šæ—¶é—´ï¼ˆç§’ï¼‰å†…è¢«æ·»åŠ äº†æ•°æ®ï¼Œé‚£ä¹ˆå°±æ‰§è¡Œpopæ“ä½œï¼Œå¦‚æœè¶…æ—¶å°±ä½œåºŸï¼Œæ”¯æŒåŒæ—¶ç­‰å¾…å¤šä¸ªåˆ—è¡¨ï¼Œåªè¦å…¶ä¸­ä¸€ä¸ªåˆ—è¡¨æœ‰å…ƒç´ äº†ï¼Œé‚£ä¹ˆå°±èƒ½æ‰§è¡Œ</span><br>blpop <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span>... timeout<br></code></pre></td></tr></table></figure><h3 id="Setå’ŒSortedSet"><a href="#Setå’ŒSortedSet" class="headerlink" title="Setå’ŒSortedSet"></a>Setå’ŒSortedSet</h3><p>Seté›†åˆå…¶å®å°±åƒJavaä¸­çš„HashSetä¸€æ ·ï¼ˆæˆ‘ä»¬åœ¨JavaSEä¸­å·²ç»è®²è§£è¿‡äº†ï¼ŒHashSetæœ¬è´¨ä¸Šå°±æ˜¯åˆ©ç”¨äº†ä¸€ä¸ªHashMapï¼Œä½†æ˜¯Valueéƒ½æ˜¯å›ºå®šå¯¹è±¡ï¼Œä»…ä»…æ˜¯Keyä¸åŒï¼‰å®ƒä¸å…è®¸å‡ºç°é‡å¤å…ƒç´ ï¼Œä¸æ”¯æŒéšæœºè®¿é—®ï¼Œä½†æ˜¯èƒ½å¤Ÿåˆ©ç”¨Hashè¡¨æä¾›æé«˜çš„æŸ¥æ‰¾æ•ˆç‡ã€‚</p><p>å‘Setä¸­æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå€¼ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">sadd <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span><span class="hljs-keyword">value</span><span class="hljs-operator">&gt;</span>...<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹Seté›†åˆä¸­æœ‰å¤šå°‘ä¸ªå€¼ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">scard <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><br></code></pre></td></tr></table></figure><p>åˆ¤æ–­é›†åˆä¸­æ˜¯å¦åŒ…å«ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- æ˜¯å¦åŒ…å«æŒ‡å®šå€¼</span><br>sismember <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span><span class="hljs-keyword">value</span><span class="hljs-operator">&gt;</span><br><span class="hljs-comment">-- åˆ—å‡ºæ‰€æœ‰å€¼</span><br>smembers <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><br></code></pre></td></tr></table></figure><p>é›†åˆä¹‹é—´çš„è¿ç®—ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- é›†åˆä¹‹é—´çš„å·®é›†</span><br>sdiff <span class="hljs-operator">&lt;</span>key1<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>key2<span class="hljs-operator">&gt;</span><br><span class="hljs-comment">-- é›†åˆä¹‹é—´çš„äº¤é›†</span><br>sinter <span class="hljs-operator">&lt;</span>key1<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>key2<span class="hljs-operator">&gt;</span><br><span class="hljs-comment">-- æ±‚å¹¶é›†</span><br>sunion <span class="hljs-operator">&lt;</span>key1<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>key2<span class="hljs-operator">&gt;</span><br><span class="hljs-comment">-- å°†é›†åˆä¹‹é—´çš„å·®é›†å­˜åˆ°ç›®æ ‡é›†åˆä¸­</span><br>sdiffstore ç›®æ ‡ <span class="hljs-operator">&lt;</span>key1<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>key2<span class="hljs-operator">&gt;</span><br><span class="hljs-comment">-- åŒä¸Š</span><br>sinterstore ç›®æ ‡ <span class="hljs-operator">&lt;</span>key1<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>key2<span class="hljs-operator">&gt;</span><br><span class="hljs-comment">-- åŒä¸Š</span><br>sunionstore ç›®æ ‡ <span class="hljs-operator">&lt;</span>key1<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>key2<span class="hljs-operator">&gt;</span><br></code></pre></td></tr></table></figure><p>ç§»åŠ¨æŒ‡å®šå€¼åˆ°å¦ä¸€ä¸ªé›†åˆä¸­ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">smove <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span> ç›®æ ‡ <span class="hljs-keyword">value</span> <br></code></pre></td></tr></table></figure><p>ç§»é™¤æ“ä½œï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- éšæœºç§»é™¤ä¸€ä¸ªå¹¸è¿å„¿</span><br>spop <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><br><span class="hljs-comment">-- ç§»é™¤æŒ‡å®š</span><br>srem <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span><span class="hljs-keyword">value</span><span class="hljs-operator">&gt;</span>...<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆå¦‚æœæˆ‘ä»¬è¦æ±‚Seté›†åˆä¸­çš„æ•°æ®æŒ‰ç…§æˆ‘ä»¬æŒ‡å®šçš„é¡ºåºè¿›è¡Œæ’åˆ—æ€ä¹ˆåŠå‘¢ï¼Ÿè¿™æ—¶å°±å¯ä»¥ä½¿ç”¨SortedSetï¼Œå®ƒæ”¯æŒæˆ‘ä»¬ä¸ºæ¯ä¸ªå€¼è®¾å®šä¸€ä¸ªåˆ†æ•°ï¼Œåˆ†æ•°çš„å¤§å°å†³å®šäº†å€¼çš„ä½ç½®ï¼Œæ‰€ä»¥å®ƒæ˜¯æœ‰åºçš„ã€‚</p><p>æˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ªå¸¦åˆ†æ•°çš„å€¼ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">zadd <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span> [<span class="hljs-operator">&lt;</span><span class="hljs-keyword">value</span><span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>score<span class="hljs-operator">&gt;</span>]...<br></code></pre></td></tr></table></figure><p>åŒæ ·çš„ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- æŸ¥è¯¢æœ‰å¤šå°‘ä¸ªå€¼</span><br>zcard <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span><br><span class="hljs-comment">-- ç§»é™¤</span><br>zrem <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span><span class="hljs-keyword">value</span><span class="hljs-operator">&gt;</span>...<br><span class="hljs-comment">-- è·å–åŒºé—´å†…çš„æ‰€æœ‰</span><br>zrange <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">start</span> stop<br></code></pre></td></tr></table></figure><p>ç”±äºæ‰€æœ‰çš„å€¼éƒ½æœ‰ä¸€ä¸ªåˆ†æ•°ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ ¹æ®åˆ†æ•°æ®µæ¥è·å–ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- é€šè¿‡åˆ†æ•°æ®µæŸ¥çœ‹</span><br>zrangebyscore <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">start</span> stop [withscores] [limit]<br><span class="hljs-comment">-- ç»Ÿè®¡åˆ†æ•°æ®µå†…çš„æ•°é‡</span><br>zcount <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span>  <span class="hljs-keyword">start</span> stop<br><span class="hljs-comment">-- æ ¹æ®åˆ†æ•°è·å–æŒ‡å®šå€¼çš„æ’å</span><br>zrank <span class="hljs-operator">&lt;</span>key<span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span><span class="hljs-keyword">value</span><span class="hljs-operator">&gt;</span><br></code></pre></td></tr></table></figure><p><a href="https://www.jianshu.com/p/32b9fe8c20e1">https://www.jianshu.com/p/32b9fe8c20e1</a></p><p>æœ‰å…³Bitmapã€HyperLogLogå’ŒGeospatialç­‰æ•°æ®ç±»å‹ï¼Œè¿™é‡Œæš‚æ—¶ä¸åšä»‹ç»ï¼Œæ„Ÿå…´è¶£å¯ä»¥è‡ªè¡Œäº†è§£ã€‚</p><hr><h2 id="æŒä¹…åŒ–"><a href="#æŒä¹…åŒ–" class="headerlink" title="æŒä¹…åŒ–"></a>æŒä¹…åŒ–</h2><p>æˆ‘ä»¬çŸ¥é“ï¼ŒRedisæ•°æ®åº“ä¸­çš„æ•°æ®éƒ½æ˜¯å­˜æ”¾åœ¨å†…å­˜ä¸­ï¼Œè™½ç„¶å¾ˆé«˜æ•ˆï¼Œä½†æ˜¯è¿™æ ·å­˜åœ¨ä¸€ä¸ªéå¸¸ä¸¥é‡çš„é—®é¢˜ï¼Œå¦‚æœçªç„¶åœç”µï¼Œé‚£æˆ‘ä»¬çš„æ•°æ®ä¸å°±å…¨éƒ¨ä¸¢å¤±äº†å—ï¼Ÿå®ƒä¸åƒç¡¬ç›˜ä¸Šçš„æ•°æ®ï¼Œæ–­ç”µä¾ç„¶èƒ½å¤Ÿä¿å­˜ã€‚</p><p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦æŒä¹…åŒ–ï¼Œæˆ‘ä»¬éœ€è¦å°†æˆ‘ä»¬çš„æ•°æ®å¤‡ä»½åˆ°ç¡¬ç›˜ä¸Šï¼Œé˜²æ­¢æ–­ç”µæˆ–æ˜¯æœºå™¨æ•…éšœå¯¼è‡´çš„æ•°æ®ä¸¢å¤±ã€‚</p><p>æŒä¹…åŒ–çš„å®ç°æ–¹å¼æœ‰ä¸¤ç§æ–¹æ¡ˆï¼šä¸€ç§æ˜¯ç›´æ¥ä¿å­˜å½“å‰<strong>å·²ç»å­˜å‚¨çš„æ•°æ®</strong>ï¼Œç›¸å½“äºå¤åˆ¶å†…å­˜ä¸­çš„æ•°æ®åˆ°ç¡¬ç›˜ä¸Šï¼Œéœ€è¦æ¢å¤æ•°æ®æ—¶ç›´æ¥è¯»å–å³å¯ï¼›è¿˜æœ‰ä¸€ç§å°±æ˜¯ä¿å­˜æˆ‘ä»¬å­˜æ”¾æ•°æ®çš„<strong>æ‰€æœ‰è¿‡ç¨‹</strong>ï¼Œéœ€è¦æ¢å¤æ•°æ®æ—¶ï¼Œåªéœ€è¦å°†æ•´ä¸ªè¿‡ç¨‹å®Œæ•´åœ°é‡æ¼”ä¸€éå°±èƒ½ä¿è¯ä¸ä¹‹å‰æ•°æ®åº“ä¸­çš„å†…å®¹ä¸€è‡´ã€‚</p><h3 id="RDB"><a href="#RDB" class="headerlink" title="RDB"></a>RDB</h3><p>RDBå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„ç¬¬ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œé‚£ä¹ˆå¦‚ä½•å°†æ•°æ®ä¿å­˜åˆ°æœ¬åœ°å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‘½ä»¤ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">save<br><span class="hljs-comment">-- æ³¨æ„ä¸Šé¢è¿™ä¸ªå‘½ä»¤æ˜¯ç›´æ¥ä¿å­˜ï¼Œä¼šå ç”¨ä¸€å®šçš„æ—¶é—´ï¼Œä¹Ÿå¯ä»¥å•ç‹¬å¼€ä¸€ä¸ªå­è¿›ç¨‹åå°æ‰§è¡Œä¿å­˜</span><br>bgsave<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œåï¼Œä¼šåœ¨æœåŠ¡ç«¯ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªdump.rdbæ–‡ä»¶ï¼Œè€Œè¿™ä¸ªæ–‡ä»¶ä¸­å°±ä¿å­˜äº†å†…å­˜ä¸­å­˜æ”¾çš„æ•°æ®ï¼Œå½“æœåŠ¡å™¨é‡å¯åï¼Œä¼šè‡ªåŠ¨åŠ è½½é‡Œé¢çš„å†…å®¹åˆ°å¯¹åº”æ•°æ®åº“ä¸­ã€‚ä¿å­˜åæˆ‘ä»¬å¯ä»¥å…³é—­æœåŠ¡å™¨ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">shutdown<br></code></pre></td></tr></table></figure><p>é‡å¯åå¯ä»¥çœ‹åˆ°æ•°æ®ä¾ç„¶å­˜åœ¨ã€‚</p><p><img src="VK3k7EAZDT1fjIo.jpg" alt="ç‚¹å‡»æŸ¥çœ‹å›¾ç‰‡æ¥æº"></p><p>è™½ç„¶è¿™ç§æ–¹å¼éå¸¸æ–¹ä¾¿ï¼Œä½†æ˜¯ç”±äºä¼šå®Œæ•´å¤åˆ¶æ‰€æœ‰çš„æ•°æ®ï¼Œå¦‚æœæ•°æ®åº“ä¸­çš„æ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œé‚£ä¹ˆå¤åˆ¶ä¸€æ¬¡å¯èƒ½å°±éœ€è¦èŠ±è´¹å¤§é‡çš„æ—¶é—´ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ¯éš”ä¸€æ®µæ—¶é—´è‡ªåŠ¨è¿›è¡Œä¿å­˜ï¼›è¿˜æœ‰å°±æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬åŸºæœ¬ä¸Šéƒ½æ˜¯åœ¨è¿›è¡Œè¯»æ“ä½œï¼Œè€Œæ²¡æœ‰è¿›è¡Œå†™æ“ä½œï¼Œå®é™…ä¸Šåªéœ€è¦å¶å°”ä¿å­˜ä¸€æ¬¡å³å¯ï¼Œå› ä¸ºæ•°æ®å‡ ä¹æ²¡æœ‰æ€ä¹ˆå˜åŒ–ï¼Œå¯èƒ½ä¸¤æ¬¡ä¿å­˜çš„éƒ½æ˜¯ä¸€æ ·çš„æ•°æ®ã€‚</p><p>æˆ‘ä»¬å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®è‡ªåŠ¨ä¿å­˜ï¼Œå¹¶è®¾å®šåœ¨ä¸€æ®µæ—¶é—´å†…å†™å…¥å¤šå°‘æ•°æ®æ—¶ï¼Œæ‰§è¡Œä¸€æ¬¡ä¿å­˜æ“ä½œï¼š</p><p>â€‹                              </p><p>â€‹                å¤åˆ¶ä»£ç       </p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">save</span> <span class="hljs-number">300</span> <span class="hljs-number">10</span> # <span class="hljs-number">300</span>ç§’ï¼ˆ<span class="hljs-number">5</span>åˆ†é’Ÿï¼‰å†…æœ‰<span class="hljs-number">10</span>ä¸ªå†™å…¥<br><span class="hljs-attribute">save</span> <span class="hljs-number">60</span> <span class="hljs-number">10000</span> # <span class="hljs-number">60</span>ç§’ï¼ˆ<span class="hljs-number">1</span>åˆ†é’Ÿï¼‰å†…æœ‰<span class="hljs-number">10000</span>ä¸ªå†™å…¥<br></code></pre></td></tr></table></figure><p>é…ç½®çš„saveä½¿ç”¨çš„éƒ½æ˜¯bgsaveåå°æ‰§è¡Œã€‚</p><h3 id="AOF"><a href="#AOF" class="headerlink" title="AOF"></a>AOF</h3><p>è™½ç„¶RDBèƒ½å¤Ÿå¾ˆå¥½åœ°è§£å†³æ•°æ®æŒä¹…åŒ–é—®é¢˜ï¼Œä½†æ˜¯å®ƒçš„ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼šæ¯æ¬¡éƒ½éœ€è¦å»å®Œæ•´åœ°ä¿å­˜æ•´ä¸ªæ•°æ®åº“ä¸­çš„æ•°æ®ï¼ŒåŒæ—¶åå°ä¿å­˜è¿‡ç¨‹ä¸­ä¹Ÿä¼šäº§ç”Ÿé¢å¤–çš„å†…å­˜å¼€é”€ï¼Œæœ€ä¸¥é‡çš„æ˜¯å®ƒå¹¶ä¸æ˜¯å®æ—¶ä¿å­˜çš„ï¼Œå¦‚æœåœ¨è‡ªåŠ¨ä¿å­˜è§¦å‘ä¹‹å‰æœåŠ¡å™¨å´©æºƒï¼Œé‚£ä¹ˆä¾ç„¶ä¼šå¯¼è‡´å°‘é‡æ•°æ®çš„ä¸¢å¤±ã€‚</p><p>è€ŒAOFå°±æ˜¯å¦ä¸€ç§æ–¹å¼ï¼Œå®ƒä¼šä»¥æ—¥å¿—çš„å½¢å¼å°†æˆ‘ä»¬æ¯æ¬¡æ‰§è¡Œçš„å‘½ä»¤éƒ½è¿›è¡Œä¿å­˜ï¼ŒæœåŠ¡å™¨é‡å¯æ—¶ä¼šå°†æ‰€æœ‰å‘½ä»¤ä¾æ¬¡æ‰§è¡Œï¼Œé€šè¿‡è¿™ç§é‡æ¼”çš„æ–¹å¼å°†æ•°æ®æ¢å¤ï¼Œè¿™æ ·å°±èƒ½å¾ˆå¥½è§£å†³å®æ—¶æ€§å­˜å‚¨é—®é¢˜ã€‚</p><p><img src="JYiOHBdtT7jC98R.jpg" alt="rdbå’ŒaofåŒºåˆ«"></p><p>ä½†æ˜¯ï¼Œæˆ‘ä»¬å¤šä¹…å†™ä¸€æ¬¡æ—¥å¿—å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥è‡ªå·±é…ç½®ä¿å­˜ç­–ç•¥ï¼Œæœ‰ä¸‰ç§ç­–ç•¥ï¼š</p><ul><li>alwaysï¼šæ¯æ¬¡æ‰§è¡Œå†™æ“ä½œéƒ½ä¼šä¿å­˜ä¸€æ¬¡</li><li>everysecï¼šæ¯ç§’ä¿å­˜ä¸€æ¬¡ï¼ˆé»˜è®¤é…ç½®ï¼‰ï¼Œè¿™æ ·å°±ç®—ä¸¢å¤±æ•°æ®ä¹Ÿåªä¼šä¸¢ä¸€ç§’ä»¥å†…çš„æ•°æ®</li><li>noï¼šçœ‹ç³»ç»Ÿå¿ƒæƒ…ä¿å­˜</li></ul><p>å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"># æ³¨æ„å¾—æ”¹æˆä¹Ÿæ˜¯<br>appendonly yes<br><br># appendfsync always<br>appendfsync everysec<br># appendfsync <span class="hljs-keyword">no</span><br></code></pre></td></tr></table></figure><p>é‡å¯æœåŠ¡å™¨åï¼Œå¯ä»¥çœ‹åˆ°æœåŠ¡å™¨ç›®å½•ä¸‹å¤šäº†ä¸€ä¸ª<code>appendonly.aof</code>æ–‡ä»¶ï¼Œå­˜å‚¨çš„å°±æ˜¯æˆ‘ä»¬æ‰§è¡Œçš„å‘½ä»¤ã€‚</p><p>AOFçš„ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œæ¯æ¬¡æœåŠ¡å™¨å¯åŠ¨éƒ½éœ€è¦è¿›è¡Œè¿‡ç¨‹é‡æ¼”ï¼Œç›¸æ¯”RDBæ›´åŠ è€—è´¹æ—¶é—´ï¼Œå¹¶ä¸”éšç€æˆ‘ä»¬çš„æ“ä½œå˜å¤šï¼Œä¸æ–­ç´¯è®¡ï¼Œå¯èƒ½åˆ°æœ€åæˆ‘ä»¬çš„aofæ–‡ä»¶ä¼šå˜å¾—æ— æ¯”å·¨å¤§ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ”¹è¿›æ–¹æ¡ˆæ¥ä¼˜åŒ–è¿™äº›é—®é¢˜ã€‚</p><p>Redisæœ‰ä¸€ä¸ªAOFé‡å†™æœºåˆ¶è¿›è¡Œä¼˜åŒ–ï¼Œæ¯”å¦‚æˆ‘ä»¬æ‰§è¡Œäº†è¿™æ ·çš„è¯­å¥ï¼š</p><p>â€‹                              </p><p>â€‹                å¤åˆ¶ä»£ç       </p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">lpush</span> test <span class="hljs-number">666</span><br><span class="hljs-attribute">lpush</span> test <span class="hljs-number">777</span><br><span class="hljs-attribute">lpush</span> test <span class="hljs-number">888</span><br></code></pre></td></tr></table></figure><p>å®é™…ä¸Šç”¨ä¸€æ¡è¯­å¥ä¹Ÿå¯ä»¥å®ç°ï¼š</p><p>â€‹                              </p><p>â€‹                å¤åˆ¶ä»£ç       </p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">lpush</span> test <span class="hljs-number">666</span> <span class="hljs-number">777</span> <span class="hljs-number">888</span><br></code></pre></td></tr></table></figure><p>æ­£æ˜¯å¦‚æ­¤ï¼Œåªè¦æˆ‘ä»¬èƒ½å¤Ÿä¿è¯æœ€ç»ˆçš„é‡æ¼”ç»“æœå’ŒåŸæœ‰è¯­å¥çš„ç»“æœä¸€è‡´ï¼Œæ— è®ºè¯­å¥å¦‚ä½•ä¿®æ”¹éƒ½å¯ä»¥ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼å°†å¤šæ¡è¯­å¥è¿›è¡Œå‹ç¼©ã€‚</p><p>æˆ‘ä»¬å¯ä»¥è¾“å…¥å‘½ä»¤æ¥æ‰‹åŠ¨æ‰§è¡Œé‡å†™æ“ä½œï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">bgrewriteaof<br></code></pre></td></tr></table></figure><p>æˆ–æ˜¯åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®è‡ªåŠ¨é‡å†™ï¼š</p><p>â€‹                              </p><p>â€‹                å¤åˆ¶ä»£ç       </p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># ç™¾åˆ†æ¯”è®¡ç®—ï¼Œè¿™é‡Œä¸å¤šä»‹ç»</span><br><span class="hljs-attribute">auto</span>-aof-rewrite-percentage <span class="hljs-number">100</span><br><span class="hljs-comment"># å½“è¾¾åˆ°è¿™ä¸ªå¤§å°æ—¶ï¼Œè§¦å‘è‡ªåŠ¨é‡å†™</span><br><span class="hljs-attribute">auto</span>-aof-rewrite-min-size <span class="hljs-number">64</span>mb<br></code></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†ä¸¤ç§æŒä¹…åŒ–æ–¹æ¡ˆçš„ä»‹ç»ï¼Œæœ€åæˆ‘ä»¬å†æ¥è¿›è¡Œä¸€ä¸‹æ€»ç»“ï¼š</p><ul><li>AOFï¼š<ul><li>ä¼˜ç‚¹ï¼šå­˜å‚¨é€Ÿåº¦å¿«ã€æ¶ˆè€—èµ„æºå°‘ã€æ”¯æŒå®æ—¶å­˜å‚¨</li><li>ç¼ºç‚¹ï¼šåŠ è½½é€Ÿåº¦æ…¢ã€æ•°æ®ä½“ç§¯å¤§</li></ul></li><li>RDBï¼š<ul><li>ä¼˜ç‚¹ï¼šåŠ è½½é€Ÿåº¦å¿«ã€æ•°æ®ä½“ç§¯å°</li><li>ç¼ºç‚¹ï¼šå­˜å‚¨é€Ÿåº¦æ…¢å¤§é‡æ¶ˆè€—èµ„æºã€ä¼šå‘ç”Ÿæ•°æ®ä¸¢å¤±</li></ul></li></ul><hr><h2 id="äº‹åŠ¡å’Œé”æœºåˆ¶"><a href="#äº‹åŠ¡å’Œé”æœºåˆ¶" class="headerlink" title="äº‹åŠ¡å’Œé”æœºåˆ¶"></a>äº‹åŠ¡å’Œé”æœºåˆ¶</h2><p>å’ŒMySQLä¸€æ ·ï¼Œåœ¨Redisä¸­ä¹Ÿæœ‰äº‹åŠ¡æœºåˆ¶ï¼Œå½“æˆ‘ä»¬éœ€è¦ä¿è¯å¤šæ¡å‘½ä»¤ä¸€æ¬¡æ€§å®Œæ•´æ‰§è¡Œè€Œä¸­é€”ä¸å—åˆ°å…¶ä»–å‘½ä»¤å¹²æ‰°æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨äº‹åŠ¡æœºåˆ¶ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‘½ä»¤æ¥ç›´æ¥å¼€å¯äº‹åŠ¡ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">multi<br></code></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬è¾“å…¥å®Œæ‰€æœ‰è¦æ‰§è¡Œçš„å‘½ä»¤æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤æ¥ç«‹å³æ‰§è¡Œäº‹åŠ¡ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">exec</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸­é€”å–æ¶ˆäº‹åŠ¡ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">discard<br></code></pre></td></tr></table></figure><p>å®é™…ä¸Šæ•´ä¸ªäº‹åŠ¡æ˜¯åˆ›å»ºäº†ä¸€ä¸ªå‘½ä»¤é˜Ÿåˆ—ï¼Œå®ƒä¸åƒMySQLé‚£ç§åœ¨äº‹åŠ¡ä¸­ä¹Ÿèƒ½å•ç‹¬å¾—åˆ°ç»“æœï¼Œè€Œæ˜¯æˆ‘ä»¬æå‰å°†æ‰€æœ‰çš„å‘½ä»¤è£…åœ¨é˜Ÿåˆ—ä¸­ï¼Œä½†æ˜¯å¹¶ä¸ä¼šæ‰§è¡Œï¼Œè€Œæ˜¯ç­‰æˆ‘ä»¬æäº¤äº‹åŠ¡çš„æ—¶å€™å†ç»Ÿä¸€æ‰§è¡Œã€‚</p><h3 id="é”"><a href="#é”" class="headerlink" title="é”"></a>é”</h3><p>åˆæåˆ°é”äº†ï¼Œå®é™…ä¸Šè¿™ä¸ªæ¦‚å¿µå¯¹æˆ‘ä»¬æ¥è¯´å·²ç»ä¸ç®—æ˜¯é™Œç”Ÿäº†ã€‚å®é™…ä¸Šåœ¨Redisä¸­ä¹Ÿä¼šå‡ºç°å¤šä¸ªå‘½ä»¤åŒæ—¶ç«äº‰åŒä¸€ä¸ªæ•°æ®çš„æƒ…å†µï¼Œæ¯”å¦‚ç°åœ¨æœ‰ä¸¤æ¡å‘½ä»¤åŒæ—¶æ‰§è¡Œï¼Œä»–ä»¬éƒ½è¦å»ä¿®æ”¹açš„å€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±åªèƒ½åŠ¨ç”¨é”æœºåˆ¶æ¥ä¿è¯åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªå‘½ä»¤æ“ä½œã€‚</p><p>è™½ç„¶Redisä¸­ä¹Ÿæœ‰é”æœºåˆ¶ï¼Œä½†æ˜¯å®ƒæ˜¯ä¸€ç§ä¹è§‚é”ï¼Œä¸åŒäºMySQLï¼Œæˆ‘ä»¬åœ¨MySQLä¸­è®¤è¯†çš„é”æ˜¯æ‚²è§‚é”ï¼Œé‚£ä¹ˆä»€ä¹ˆæ˜¯ä¹è§‚é”ä»€ä¹ˆæ˜¯æ‚²è§‚é”å‘¢ï¼Ÿ</p><ul><li>æ‚²è§‚é”ï¼šæ—¶åˆ»è®¤ä¸ºåˆ«äººä¼šæ¥æŠ¢å èµ„æºï¼Œç¦æ­¢ä¸€åˆ‡å¤–æ¥è®¿é—®ï¼Œç›´åˆ°é‡Šæ”¾é”ï¼Œå…·æœ‰å¼ºçƒˆçš„æ’ä»–æ€§è´¨ã€‚</li><li>ä¹è§‚é”ï¼šå¹¶ä¸è®¤ä¸ºä¼šæœ‰äººæ¥æŠ¢å èµ„æºï¼Œæ‰€ä»¥ä¼šç›´æ¥å¯¹æ•°æ®è¿›è¡Œæ“ä½œï¼Œåœ¨æ“ä½œæ—¶å†å»éªŒè¯æ˜¯å¦æœ‰å…¶ä»–äººæŠ¢å èµ„æºã€‚</li></ul><p>Redisä¸­å¯ä»¥ä½¿ç”¨watchæ¥ç›‘è§†ä¸€ä¸ªç›®æ ‡ï¼Œå¦‚æœæ‰§è¡Œäº‹åŠ¡ä¹‹å‰è¢«ç›‘è§†ç›®æ ‡å‘ç”Ÿäº†ä¿®æ”¹ï¼Œåˆ™å–æ¶ˆæœ¬æ¬¡äº‹åŠ¡ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">watch<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥å¼€ä¸¤ä¸ªå®¢æˆ·ç«¯è¿›è¡Œæµ‹è¯•ã€‚</p><p>å–æ¶ˆç›‘è§†å¯ä»¥ä½¿ç”¨ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">unwatch<br></code></pre></td></tr></table></figure><p>è‡³æ­¤ï¼ŒRedisçš„åŸºç¡€å†…å®¹å°±è®²è§£å®Œæ¯•äº†ï¼Œåœ¨ä¹‹åçš„SpringCloudé˜¶æ®µï¼Œæˆ‘ä»¬è¿˜ä¼šå»è®²è§£é›†ç¾¤ç›¸å…³çš„çŸ¥è¯†ï¼ŒåŒ…æ‹¬ä¸»ä»å¤åˆ¶ã€å“¨å…µæ¨¡å¼ç­‰ã€‚</p><hr><h2 id="ä½¿ç”¨Javaä¸Redisäº¤äº’"><a href="#ä½¿ç”¨Javaä¸Redisäº¤äº’" class="headerlink" title="ä½¿ç”¨Javaä¸Redisäº¤äº’"></a>ä½¿ç”¨Javaä¸Redisäº¤äº’</h2><p>æ—¢ç„¶äº†è§£äº†å¦‚ä½•é€šè¿‡å‘½ä»¤çª—å£æ“ä½œRedisæ•°æ®åº“ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•ä½¿ç”¨Javaæ¥æ“ä½œå‘¢ï¼Ÿ</p><p>è¿™é‡Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨åˆ°Jedisæ¡†æ¶ï¼Œå®ƒèƒ½å¤Ÿå®ç°Javaä¸Redisæ•°æ®åº“çš„äº¤äº’ï¼Œä¾èµ–ï¼š</p><p>â€‹                              </p><p>â€‹        xml        å¤åˆ¶ä»£ç       </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>redis.clients<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jedis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="åŸºæœ¬æ“ä½œ-1"><a href="#åŸºæœ¬æ“ä½œ-1" class="headerlink" title="åŸºæœ¬æ“ä½œ"></a>åŸºæœ¬æ“ä½œ</h3><p>æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•è¿æ¥Redisæ•°æ®åº“ï¼Œéå¸¸ç®€å•ï¼Œåªéœ€è¦åˆ›å»ºä¸€ä¸ªå¯¹è±¡å³å¯ï¼š</p><p>â€‹                              </p><p>â€‹        java        å¤åˆ¶ä»£ç       </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-comment">//åˆ›å»ºJediså¯¹è±¡</span><br>    <span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-number">6379</span>);<br>  <br>  <span class="hljs-comment">//ä½¿ç”¨ä¹‹åå…³é—­è¿æ¥</span><br>  jedis.close();<br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡Jediså¯¹è±¡ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥è°ƒç”¨å‘½ä»¤çš„åŒåæ–¹æ³•æ¥æ‰§è¡ŒRediså‘½ä»¤äº†ï¼Œæ¯”å¦‚ï¼š</p><p>â€‹                              </p><p>â€‹        java        å¤åˆ¶ä»£ç       </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-comment">//ç›´æ¥ä½¿ç”¨try-with-resouseï¼Œçœå»close</span><br>    <span class="hljs-keyword">try</span>(<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">&quot;192.168.10.3&quot;</span>, <span class="hljs-number">6379</span>))&#123;<br>        jedis.set(<span class="hljs-string">&quot;test&quot;</span>, <span class="hljs-string">&quot;lbwnb&quot;</span>);   <span class="hljs-comment">//ç­‰åŒäº set test lbwnb å‘½ä»¤</span><br>        System.out.println(jedis.get(<span class="hljs-string">&quot;test&quot;</span>));  <span class="hljs-comment">//ç­‰åŒäº get test å‘½ä»¤</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>Hashç±»å‹çš„æ•°æ®ä¹Ÿæ˜¯è¿™æ ·ï¼š</p><p>â€‹                              </p><p>â€‹        java        å¤åˆ¶ä»£ç       </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-keyword">try</span>(<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">&quot;192.168.10.3&quot;</span>, <span class="hljs-number">6379</span>))&#123;<br>        jedis.hset(<span class="hljs-string">&quot;hhh&quot;</span>, <span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;sxc&quot;</span>);   <span class="hljs-comment">//ç­‰åŒäº hset hhh name sxc</span><br>        jedis.hset(<span class="hljs-string">&quot;hhh&quot;</span>, <span class="hljs-string">&quot;sex&quot;</span>, <span class="hljs-string">&quot;19&quot;</span>);    <span class="hljs-comment">//ç­‰åŒäº hset hhh age 19</span><br>        jedis.hgetAll(<span class="hljs-string">&quot;hhh&quot;</span>).forEach((k, v) -&gt; System.out.println(k+<span class="hljs-string">&quot;: &quot;</span>+v));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥ç€æ¥çœ‹çœ‹åˆ—è¡¨æ“ä½œï¼š</p><p>â€‹                              </p><p>â€‹        java        å¤åˆ¶ä»£ç       </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-keyword">try</span>(<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">&quot;192.168.10.3&quot;</span>, <span class="hljs-number">6379</span>))&#123;<br>        jedis.lpush(<span class="hljs-string">&quot;mylist&quot;</span>, <span class="hljs-string">&quot;111&quot;</span>, <span class="hljs-string">&quot;222&quot;</span>, <span class="hljs-string">&quot;333&quot;</span>);  <span class="hljs-comment">//ç­‰åŒäº lpush mylist 111 222 333 å‘½ä»¤</span><br>        jedis.lrange(<span class="hljs-string">&quot;mylist&quot;</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>)<br>                .forEach(System.out::println);    <span class="hljs-comment">//ç­‰åŒäº lrange mylist 0 -1</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å®é™…ä¸Šæˆ‘ä»¬åªéœ€è¦æŒ‰ç…§å¯¹åº”çš„æ“ä½œå»è°ƒç”¨åŒåæ–¹æ³•å³å¯ï¼Œæ‰€æœ‰çš„ç±»å‹å°è£…Jediså·²ç»å¸®åŠ©æˆ‘ä»¬å®Œæˆäº†ã€‚</p><h3 id="SpringBootæ•´åˆRedis"><a href="#SpringBootæ•´åˆRedis" class="headerlink" title="SpringBootæ•´åˆRedis"></a>SpringBootæ•´åˆRedis</h3><p>æˆ‘ä»¬æ¥ç€æ¥çœ‹å¦‚ä½•åœ¨SpringBooté¡¹ç›®ä¸­æ•´åˆRedisæ“ä½œæ¡†æ¶ï¼Œåªéœ€è¦ä¸€ä¸ªstarterå³å¯ï¼Œä½†æ˜¯å®ƒåº•å±‚æ²¡æœ‰ç”¨Jedisï¼Œè€Œæ˜¯Lettuceï¼š</p><p>â€‹                              </p><p>â€‹        xml        å¤åˆ¶ä»£ç       </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>starteræä¾›çš„é»˜è®¤é…ç½®ä¼šå»è¿æ¥æœ¬åœ°çš„RedisæœåŠ¡å™¨ï¼Œå¹¶ä½¿ç”¨0å·æ•°æ®åº“ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨è¿›è¡Œä¿®æ”¹ï¼š</p><p>â€‹                              </p><p>â€‹        yaml        å¤åˆ¶ä»£ç       </p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">redis:</span><br>  <span class="hljs-comment">#RedisæœåŠ¡å™¨åœ°å€</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.3</span><br>    <span class="hljs-comment">#ç«¯å£</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span><br>    <span class="hljs-comment">#ä½¿ç”¨å‡ å·æ•°æ®åº“</span><br>    <span class="hljs-attr">database:</span> <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>starterå·²ç»ç»™æˆ‘ä»¬æä¾›äº†ä¸¤ä¸ªé»˜è®¤çš„æ¨¡æ¿ç±»ï¼š</p><p>â€‹                              </p><p>â€‹        java        å¤åˆ¶ä»£ç       </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration(</span><br><span class="hljs-meta">    proxyBeanMethods = false</span><br><span class="hljs-meta">)</span><br><span class="hljs-meta">@ConditionalOnClass(&#123;RedisOperations.class&#125;)</span><br><span class="hljs-meta">@EnableConfigurationProperties(&#123;RedisProperties.class&#125;)</span><br><span class="hljs-meta">@Import(&#123;LettuceConnectionConfiguration.class, JedisConnectionConfiguration.class&#125;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisAutoConfiguration</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RedisAutoConfiguration</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-meta">@ConditionalOnMissingBean(</span><br><span class="hljs-meta">        name = &#123;&quot;redisTemplate&quot;&#125;</span><br><span class="hljs-meta">    )</span><br>    <span class="hljs-meta">@ConditionalOnSingleCandidate(RedisConnectionFactory.class)</span><br>    <span class="hljs-keyword">public</span> RedisTemplate&lt;Object, Object&gt; <span class="hljs-title function_">redisTemplate</span><span class="hljs-params">(RedisConnectionFactory redisConnectionFactory)</span> &#123;<br>        RedisTemplate&lt;Object, Object&gt; template = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedisTemplate</span>();<br>        template.setConnectionFactory(redisConnectionFactory);<br>        <span class="hljs-keyword">return</span> template;<br>    &#125;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-meta">@ConditionalOnMissingBean</span><br>    <span class="hljs-meta">@ConditionalOnSingleCandidate(RedisConnectionFactory.class)</span><br>    <span class="hljs-keyword">public</span> StringRedisTemplate <span class="hljs-title function_">stringRedisTemplate</span><span class="hljs-params">(RedisConnectionFactory redisConnectionFactory)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRedisTemplate</span>(redisConnectionFactory);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆå¦‚ä½•å»ä½¿ç”¨è¿™ä¸¤ä¸ªæ¨¡æ¿ç±»å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ç›´æ¥æ³¨å…¥<code>StringRedisTemplate</code>æ¥ä½¿ç”¨æ¨¡æ¿ï¼š</p><p>â€‹                              </p><p>â€‹        java        å¤åˆ¶ä»£ç       </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringBootTestApplicationTests</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    StringRedisTemplate template;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">contextLoads</span><span class="hljs-params">()</span> &#123;<br>        ValueOperations&lt;String, String&gt; operations = template.opsForValue();<br>        operations.set(<span class="hljs-string">&quot;c&quot;</span>, <span class="hljs-string">&quot;xxxxx&quot;</span>);   <span class="hljs-comment">//è®¾ç½®å€¼</span><br>        System.out.println(operations.get(<span class="hljs-string">&quot;c&quot;</span>));   <span class="hljs-comment">//è·å–å€¼</span><br>      <br>        template.delete(<span class="hljs-string">&quot;c&quot;</span>);    <span class="hljs-comment">//åˆ é™¤é”®</span><br>        System.out.println(template.hasKey(<span class="hljs-string">&quot;c&quot;</span>));   <span class="hljs-comment">//åˆ¤æ–­æ˜¯å¦åŒ…å«é”®</span><br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>å®é™…ä¸Šæ‰€æœ‰çš„å€¼çš„æ“ä½œéƒ½è¢«å°è£…åˆ°äº†<code>ValueOperations</code>å¯¹è±¡ä¸­ï¼Œè€Œæ™®é€šçš„é”®æ“ä½œç›´æ¥é€šè¿‡æ¨¡æ¿å¯¹è±¡å°±å¯ä»¥ä½¿ç”¨äº†ï¼Œå¤§è‡´ä½¿ç”¨æ–¹å¼å…¶å®å’ŒJedisä¸€è‡´ã€‚</p><p>æˆ‘ä»¬æ¥ç€æ¥çœ‹çœ‹äº‹åŠ¡æ“ä½œï¼Œç”±äºSpringæ²¡æœ‰ä¸“é—¨çš„Redisäº‹åŠ¡ç®¡ç†å™¨ï¼Œæ‰€ä»¥åªèƒ½å€Ÿç”¨JDBCæä¾›çš„ï¼Œåªä¸è¿‡æ— æ‰€è°“ï¼Œæ­£å¸¸æƒ…å†µä¸‹åæ­£æˆ‘ä»¬ä¹Ÿè¦ç”¨åˆ°è¿™ç©æ„ï¼š</p><p>â€‹                              </p><p>â€‹        xml        å¤åˆ¶ä»£ç       </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>â€‹                              </p><p>â€‹        java        å¤åˆ¶ä»£ç       </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisService</span> &#123;<br><br>    <span class="hljs-meta">@Resource</span><br>    StringRedisTemplate template;<br><br>    <span class="hljs-meta">@PostConstruct</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span>&#123;<br>        template.setEnableTransactionSupport(<span class="hljs-literal">true</span>);   <span class="hljs-comment">//éœ€è¦å¼€å¯äº‹åŠ¡</span><br>    &#125;<br><br>    <span class="hljs-meta">@Transactional</span>    <span class="hljs-comment">//éœ€è¦æ·»åŠ æ­¤æ³¨è§£</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span>&#123;<br>        template.multi();<br>        template.opsForValue().set(<span class="hljs-string">&quot;d&quot;</span>, <span class="hljs-string">&quot;xxxxx&quot;</span>);<br>        template.exec();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿˜å¯ä»¥ä¸ºRedisTemplateå¯¹è±¡é…ç½®ä¸€ä¸ªSerializeræ¥å®ç°å¯¹è±¡çš„JSONå­˜å‚¨ï¼š</p><p>â€‹                              </p><p>â€‹        java        å¤åˆ¶ä»£ç       </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">contextLoad2</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">//æ³¨æ„Studentéœ€è¦å®ç°åºåˆ—åŒ–æ¥å£æ‰èƒ½å­˜å…¥Redis</span><br>    template.opsForValue().set(<span class="hljs-string">&quot;student&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>());<br>    System.out.println(template.opsForValue().get(<span class="hljs-string">&quot;student&quot;</span>));<br>&#125;<br></code></pre></td></tr></table></figure><hr><h2 id="ä½¿ç”¨Redisåšç¼“å­˜"><a href="#ä½¿ç”¨Redisåšç¼“å­˜" class="headerlink" title="ä½¿ç”¨Redisåšç¼“å­˜"></a>ä½¿ç”¨Redisåšç¼“å­˜</h2><p>æˆ‘ä»¬å¯ä»¥è½»æ¾åœ°ä½¿ç”¨Redisæ¥å®ç°ä¸€äº›æ¡†æ¶çš„ç¼“å­˜å’Œå…¶ä»–å­˜å‚¨ã€‚</p><h3 id="MybatisäºŒçº§ç¼“å­˜"><a href="#MybatisäºŒçº§ç¼“å­˜" class="headerlink" title="MybatisäºŒçº§ç¼“å­˜"></a>MybatisäºŒçº§ç¼“å­˜</h3><p>è¿˜è®°å¾—æˆ‘ä»¬åœ¨å­¦ä¹ Mybatisè®²è§£çš„ç¼“å­˜æœºåˆ¶å—ï¼Œæˆ‘ä»¬å½“æ—¶ä»‹ç»äº†äºŒçº§ç¼“å­˜ï¼Œå®ƒæ˜¯Mapperçº§åˆ«çš„ç¼“å­˜ï¼Œèƒ½å¤Ÿä½œç”¨ä¸æ‰€æœ‰ä¼šè¯ã€‚ä½†æ˜¯å½“æ—¶æˆ‘ä»¬æå‡ºäº†ä¸€ä¸ªé—®é¢˜ï¼Œç”±äºMybatisçš„é»˜è®¤äºŒçº§ç¼“å­˜åªèƒ½æ˜¯å•æœºçš„ï¼Œå¦‚æœå­˜åœ¨å¤šå°æœåŠ¡å™¨è®¿é—®åŒä¸€ä¸ªæ•°æ®åº“ï¼Œå®é™…ä¸ŠäºŒçº§ç¼“å­˜åªä¼šåœ¨å„è‡ªçš„æœåŠ¡å™¨ä¸Šç”Ÿæ•ˆï¼Œä½†æ˜¯æˆ‘ä»¬å¸Œæœ›çš„æ˜¯å¤šå°æœåŠ¡å™¨éƒ½èƒ½ä½¿ç”¨åŒä¸€ä¸ªäºŒçº§ç¼“å­˜ï¼Œè¿™æ ·å°±ä¸ä¼šé€ æˆè¿‡å¤šçš„èµ„æºæµªè´¹ã€‚</p><p><img src="JKDHFTiCr2t5Oj9.jpg" alt="img"></p><p>æˆ‘ä»¬å¯ä»¥å°†Redisä½œä¸ºMybatisçš„äºŒçº§ç¼“å­˜ï¼Œè¿™æ ·å°±èƒ½å®ç°å¤šå°æœåŠ¡å™¨ä½¿ç”¨åŒä¸€ä¸ªäºŒçº§ç¼“å­˜ï¼Œå› ä¸ºå®ƒä»¬åªéœ€è¦è¿æ¥åŒä¸€ä¸ªRedisæœåŠ¡å™¨å³å¯ï¼Œæ‰€æœ‰çš„ç¼“å­˜æ•°æ®å…¨éƒ¨å­˜å‚¨åœ¨RedisæœåŠ¡å™¨ä¸Šã€‚æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨å®ç°Mybatisæä¾›çš„Cacheæ¥å£ï¼Œè¿™é‡Œæˆ‘ä»¬ç®€å•ç¼–å†™ä¸€ä¸‹ï¼š</p><p>â€‹                              </p><p>â€‹        java        å¤åˆ¶ä»£ç       </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//å®ç°Mybatisçš„Cacheæ¥å£</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisMybatisCache</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Cache</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String id;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> RedisTemplate&lt;Object, Object&gt; template;<br><br>   <span class="hljs-comment">//æ³¨æ„æ„é€ æ–¹æ³•å¿…é¡»å¸¦ä¸€ä¸ªStringç±»å‹çš„å‚æ•°æ¥æ”¶id</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RedisMybatisCache</span><span class="hljs-params">(String id)</span>&#123;<br>        <span class="hljs-built_in">this</span>.id = id;<br>    &#125;<br><br>  <span class="hljs-comment">//åˆå§‹åŒ–æ—¶é€šè¿‡é…ç½®ç±»å°†RedisTemplateç»™è¿‡æ¥</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setTemplate</span><span class="hljs-params">(RedisTemplate&lt;Object, Object&gt; template)</span> &#123;<br>        RedisMybatisCache.template = template;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> id;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">putObject</span><span class="hljs-params">(Object o, Object o1)</span> &#123;<br>      <span class="hljs-comment">//è¿™é‡Œç›´æ¥å‘Redisæ•°æ®åº“ä¸­ä¸¢æ•°æ®å³å¯ï¼Œoå°±æ˜¯Keyï¼Œo1å°±æ˜¯Valueï¼Œ60ç§’ä¸ºè¿‡æœŸæ—¶é—´</span><br>        template.opsForValue().set(o, o1, <span class="hljs-number">60</span>, TimeUnit.SECONDS);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getObject</span><span class="hljs-params">(Object o)</span> &#123;<br>      <span class="hljs-comment">//è¿™é‡Œæ ¹æ®Keyç›´æ¥ä»Redisæ•°æ®åº“ä¸­è·å–å€¼å³å¯</span><br>        <span class="hljs-keyword">return</span> template.opsForValue().get(o);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">removeObject</span><span class="hljs-params">(Object o)</span> &#123;<br>      <span class="hljs-comment">//æ ¹æ®Keyåˆ é™¤</span><br>        <span class="hljs-keyword">return</span> template.delete(o);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">clear</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">//ç”±äºtemplateä¸­æ²¡å°è£…æ¸…é™¤æ“ä½œï¼Œåªèƒ½é€šè¿‡connectionæ¥æ‰§è¡Œ</span><br>template.execute((RedisCallback&lt;Void&gt;) connection -&gt; &#123;<br>          <span class="hljs-comment">//é€šè¿‡connectionå¯¹è±¡æ‰§è¡Œæ¸…ç©ºæ“ä½œ</span><br>            connection.flushDb();<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getSize</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">//è¿™é‡Œä¹Ÿæ˜¯ä½¿ç”¨connectionå¯¹è±¡æ¥è·å–å½“å‰çš„Keyæ•°é‡</span><br>        <span class="hljs-keyword">return</span> template.execute(RedisServerCommands::dbSize).intValue();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç¼“å­˜ç±»ç¼–å†™å®Œæˆåï¼Œæˆ‘ä»¬æ¥ç€æ¥ç¼–å†™é…ç½®ç±»ï¼š</p><p>â€‹                              </p><p>â€‹        java        å¤åˆ¶ä»£ç       </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainConfiguration</span> &#123;<br>    <span class="hljs-meta">@Resource</span><br>    RedisTemplate&lt;Object, Object&gt; template;<br><br>    <span class="hljs-meta">@PostConstruct</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span>&#123;<br>      <span class="hljs-comment">//æŠŠRedisTemplateç»™åˆ°RedisMybatisCache</span><br>        RedisMybatisCache.setTemplate(template);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æœ€åæˆ‘ä»¬åœ¨Mapperä¸Šå¯ç”¨æ­¤ç¼“å­˜å³å¯ï¼š</p><p>â€‹                              </p><p>â€‹        java        å¤åˆ¶ä»£ç       </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//åªéœ€è¦ä¿®æ”¹ç¼“å­˜å®ç°ç±»implementationä¸ºæˆ‘ä»¬çš„RedisMybatisCacheå³å¯</span><br><span class="hljs-meta">@CacheNamespace(implementation = RedisMybatisCache.class)</span><br><span class="hljs-meta">@Mapper</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">MainMapper</span> &#123;<br><br>    <span class="hljs-meta">@Select(&quot;select name from student where sid = 1&quot;)</span><br>    String <span class="hljs-title function_">getSid</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>æœ€åæˆ‘ä»¬æä¾›ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹æ¥æŸ¥çœ‹å½“å‰çš„äºŒçº§ç¼“å­˜æ˜¯å¦ç”Ÿæ•ˆï¼š</p><p>â€‹                              </p><p>â€‹        java        å¤åˆ¶ä»£ç       </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringBootTestApplicationTests</span> &#123;<br><br><br>    <span class="hljs-meta">@Resource</span><br>    MainMapper mapper;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">contextLoads</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(mapper.getSid());<br>        System.out.println(mapper.getSid());<br>        System.out.println(mapper.getSid());<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰‹åŠ¨ä½¿ç”¨å®¢æˆ·ç«¯æŸ¥çœ‹Redisæ•°æ®åº“ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»æœ‰ä¸€æ¡Mybatisç”Ÿæˆçš„ç¼“å­˜æ•°æ®äº†ã€‚</p><h3 id="TokenæŒä¹…åŒ–å­˜å‚¨"><a href="#TokenæŒä¹…åŒ–å­˜å‚¨" class="headerlink" title="TokenæŒä¹…åŒ–å­˜å‚¨"></a>TokenæŒä¹…åŒ–å­˜å‚¨</h3><p>æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨SpringSecurityæ—¶ï¼Œremember-meçš„Tokenæ˜¯æ”¯æŒæŒä¹…åŒ–å­˜å‚¨çš„ï¼Œè€Œæˆ‘ä»¬å½“æ—¶æ˜¯å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œé‚£ä¹ˆTokenä¿¡æ¯èƒ½å¦å­˜å‚¨åœ¨ç¼“å­˜ä¸­å‘¢ï¼Œå½“ç„¶ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨å®ç°ä¸€ä¸ªï¼š</p><p>â€‹                              </p><p>â€‹        java        å¤åˆ¶ä»£ç       </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//å®ç°PersistentTokenRepositoryæ¥å£</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisTokenRepository</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">PersistentTokenRepository</span> &#123;<br>  <span class="hljs-comment">//Keyåç§°å‰ç¼€ï¼Œç”¨äºåŒºåˆ†</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">REMEMBER_ME_KEY</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;spring:security:rememberMe:&quot;</span>;<br>    <span class="hljs-meta">@Resource</span><br>    RedisTemplate&lt;Object, Object&gt; template;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createNewToken</span><span class="hljs-params">(PersistentRememberMeToken token)</span> &#123;<br>      <span class="hljs-comment">//è¿™é‡Œè¦æ”¾ä¸¤ä¸ªï¼Œä¸€ä¸ªå­˜seriesId-&gt;Tokenï¼Œä¸€ä¸ªå­˜username-&gt;seriesIdï¼Œå› ä¸ºåˆ é™¤æ—¶æ˜¯é€šè¿‡usernameåˆ é™¤</span><br>        template.opsForValue().set(REMEMBER_ME_KEY+<span class="hljs-string">&quot;username:&quot;</span>+token.getUsername(), token.getSeries());<br>        template.expire(REMEMBER_ME_KEY+<span class="hljs-string">&quot;username:&quot;</span>+token.getUsername(), <span class="hljs-number">1</span>, TimeUnit.DAYS);<br>        <span class="hljs-built_in">this</span>.setToken(token);<br>    &#125;<br><br>  <span class="hljs-comment">//å…ˆè·å–ï¼Œç„¶åä¿®æ”¹åˆ›å»ºä¸€ä¸ªæ–°çš„ï¼Œå†æ”¾å…¥</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateToken</span><span class="hljs-params">(String series, String tokenValue, Date lastUsed)</span> &#123;<br>        <span class="hljs-type">PersistentRememberMeToken</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.getToken(series);<br>        <span class="hljs-keyword">if</span>(token != <span class="hljs-literal">null</span>)<br>           <span class="hljs-built_in">this</span>.setToken(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PersistentRememberMeToken</span>(token.getUsername(), series, tokenValue, lastUsed));<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> PersistentRememberMeToken <span class="hljs-title function_">getTokenForSeries</span><span class="hljs-params">(String seriesId)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.getToken(seriesId);<br>    &#125;<br><br>  <span class="hljs-comment">//é€šè¿‡usernameæ‰¾seriesIdç›´æ¥åˆ é™¤è¿™ä¸¤ä¸ª</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeUserTokens</span><span class="hljs-params">(String username)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">series</span> <span class="hljs-operator">=</span> (String) template.opsForValue().get(REMEMBER_ME_KEY+<span class="hljs-string">&quot;username:&quot;</span>+username);<br>        template.delete(REMEMBER_ME_KEY+series);<br>        template.delete(REMEMBER_ME_KEY+<span class="hljs-string">&quot;username:&quot;</span>+username);<br>    &#125;<br><br>  <br>  <span class="hljs-comment">//ç”±äºPersistentRememberMeTokenæ²¡å®ç°åºåˆ—åŒ–æ¥å£ï¼Œè¿™é‡Œåªèƒ½ç”¨Hashæ¥å­˜å‚¨äº†ï¼Œæ‰€ä»¥å•ç‹¬ç¼–å†™ä¸€ä¸ªsetå’Œgetæ“ä½œ</span><br>    <span class="hljs-keyword">private</span> PersistentRememberMeToken <span class="hljs-title function_">getToken</span><span class="hljs-params">(String series)</span>&#123;<br>        Map&lt;Object, Object&gt; map = template.opsForHash().entries(REMEMBER_ME_KEY+series);<br>        <span class="hljs-keyword">if</span>(map.isEmpty()) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PersistentRememberMeToken</span>(<br>                (String) map.get(<span class="hljs-string">&quot;username&quot;</span>),<br>                (String) map.get(<span class="hljs-string">&quot;series&quot;</span>),<br>                (String) map.get(<span class="hljs-string">&quot;tokenValue&quot;</span>),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(Long.parseLong((String) map.get(<span class="hljs-string">&quot;date&quot;</span>))));<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setToken</span><span class="hljs-params">(PersistentRememberMeToken token)</span>&#123;<br>        Map&lt;String, String&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        map.put(<span class="hljs-string">&quot;username&quot;</span>, token.getUsername());<br>        map.put(<span class="hljs-string">&quot;series&quot;</span>, token.getSeries());<br>        map.put(<span class="hljs-string">&quot;tokenValue&quot;</span>, token.getTokenValue());<br>        map.put(<span class="hljs-string">&quot;date&quot;</span>, <span class="hljs-string">&quot;&quot;</span>+token.getDate().getTime());<br>        template.opsForHash().putAll(REMEMBER_ME_KEY+token.getSeries(), map);<br>        template.expire(REMEMBER_ME_KEY+token.getSeries(), <span class="hljs-number">1</span>, TimeUnit.DAYS);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ç€æŠŠéªŒè¯Serviceå®ç°äº†ï¼š</p><p>â€‹                              </p><p>â€‹        java        å¤åˆ¶ä»£ç       </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AuthService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserDetailsService</span> &#123;<br><br>    <span class="hljs-meta">@Resource</span><br>    UserMapper mapper;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> UserDetails <span class="hljs-title function_">loadUserByUsername</span><span class="hljs-params">(String username)</span> <span class="hljs-keyword">throws</span> UsernameNotFoundException &#123;<br>        <span class="hljs-type">Account</span> <span class="hljs-variable">account</span> <span class="hljs-operator">=</span> mapper.getAccountByUsername(username);<br>        <span class="hljs-keyword">if</span>(account == <span class="hljs-literal">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UsernameNotFoundException</span>(<span class="hljs-string">&quot;&quot;</span>);<br>        <span class="hljs-keyword">return</span> User<br>                .withUsername(username)<br>                .password(account.getPassword())<br>                .roles(account.getRole())<br>                .build();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>Mapperä¹Ÿå®‰æ’ä¸Šï¼š</p><p>â€‹                              </p><p>â€‹        java        å¤åˆ¶ä»£ç       </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Account</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-type">int</span> id;<br>    String username;<br>    String password;<br>    String role;<br>&#125;<br></code></pre></td></tr></table></figure><p>â€‹                              </p><p>â€‹        java        å¤åˆ¶ä»£ç       </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@CacheNamespace(implementation = MybatisRedisCache.class)</span><br><span class="hljs-meta">@Mapper</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> &#123;<br><br>    <span class="hljs-meta">@Select(&quot;select * from users where username = #&#123;username&#125;&quot;)</span><br>    Account <span class="hljs-title function_">getAccountByUsername</span><span class="hljs-params">(String username)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>æœ€åé…ç½®æ–‡ä»¶é…ä¸€æ³¢ï¼š</p><p>â€‹                              </p><p>â€‹        java        å¤åˆ¶ä»£ç       </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    http<br>            .authorizeRequests()<br>            .anyRequest().authenticated()<br>            .and()<br>            .formLogin()<br>            .and()<br>            .rememberMe()<br>            .tokenRepository(repository);<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    auth<br>            .userDetailsService(service)<br>            .passwordEncoder(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BCryptPasswordEncoder</span>());<br>&#125;<br></code></pre></td></tr></table></figure><p>OKï¼Œå¯åŠ¨æœåŠ¡å™¨éªŒè¯ä¸€ä¸‹å§ã€‚</p><hr><h2 id="ä¸‰å¤§ç¼“å­˜é—®é¢˜"><a href="#ä¸‰å¤§ç¼“å­˜é—®é¢˜" class="headerlink" title="ä¸‰å¤§ç¼“å­˜é—®é¢˜"></a>ä¸‰å¤§ç¼“å­˜é—®é¢˜</h2><p><strong>æ³¨æ„ï¼š</strong> è¿™éƒ¨åˆ†å†…å®¹ä½œä¸ºé€‰å­¦å†…å®¹ã€‚</p><p>è™½ç„¶æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç¼“å­˜æ¥å¤§å¹…åº¦æå‡æˆ‘ä»¬ç¨‹åºçš„æ•°æ®è·å–æ•ˆç‡ï¼Œä½†æ˜¯ä½¿ç”¨ç¼“å­˜ä¹Ÿå­˜åœ¨ç€ä¸€äº›æ½œåœ¨çš„é—®é¢˜ã€‚</p><h3 id="ç¼“å­˜ç©¿é€"><a href="#ç¼“å­˜ç©¿é€" class="headerlink" title="ç¼“å­˜ç©¿é€"></a>ç¼“å­˜ç©¿é€</h3><p><img src="fSDgVrZj2ozKuPG.jpg" alt="img"></p><p>å½“æˆ‘ä»¬å»æŸ¥è¯¢ä¸€ä¸ªä¸€å®šä¸å­˜åœ¨çš„æ•°æ®ï¼Œæ¯”å¦‚Mybatisåœ¨ç¼“å­˜æ˜¯æœªå‘½ä¸­çš„æƒ…å†µä¸‹éœ€è¦ä»æ•°æ®åº“æŸ¥è¯¢ï¼ŒæŸ¥ä¸åˆ°æ•°æ®åˆ™ä¸å†™å…¥ç¼“å­˜ï¼Œè¿™å°†å¯¼è‡´è¿™ä¸ªä¸å­˜åœ¨çš„æ•°æ®æ¯æ¬¡è¯·æ±‚éƒ½è¦åˆ°æ•°æ®åº“å»æŸ¥è¯¢ï¼Œé€ æˆç¼“å­˜ç©¿é€ã€‚</p><p>è¿™æ˜¾ç„¶æ˜¯å¾ˆæµªè´¹èµ„æºçš„ï¼Œæˆ‘ä»¬å¸Œæœ›çš„æ˜¯ï¼Œå¦‚æœè¿™ä¸ªæ•°æ®ä¸å­˜åœ¨ï¼Œä¸ºä»€ä¹ˆç¼“å­˜è¿™ä¸€å±‚ä¸ç›´æ¥è¿”å›ç©ºå‘¢ï¼Œè¿™æ—¶å°±ä¸å¿…å†å»æŸ¥æ•°æ®åº“äº†ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œç¼“å­˜ä¸å»æŸ¥æ•°æ®åº“æ€ä¹ˆçŸ¥é“æ•°æ®åº“é‡Œé¢åˆ°åº•æœ‰æ²¡æœ‰è¿™ä¸ªæ•°æ®å‘¢ï¼Ÿ</p><p>è¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨æ¥è¿›è¡Œåˆ¤æ–­ã€‚ä»€ä¹ˆæ˜¯å¸ƒéš†è¿‡æ»¤å™¨ï¼Ÿï¼ˆå½“ç„¶ä¸æ˜¯æ‰“è¾…åŠ©çš„é‚£ä¸ªå¸ƒéš†ï¼Œåªä¸è¿‡ä¹ŸæŒºåƒï¼Œè¾…åŠ©å¸ƒéš†ä¹Ÿæ˜¯æŒ¡å­å¼¹çš„ï¼‰</p><p><img src="vWaLugBJMT3zIDC.jpg" alt="ç‚¹å‡»æŸ¥çœ‹å›¾ç‰‡æ¥æº"></p><p>ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨ï¼Œèƒ½å¤Ÿå‘Šè¯‰ä½ æŸæ ·ä¸œè¥¿ä¸€å®šä¸å­˜åœ¨æˆ–æ˜¯æŸæ ·ä¸œè¥¿å¯èƒ½å­˜åœ¨ã€‚</p><p>å¸ƒéš†è¿‡æ»¤å™¨æœ¬è´¨æ˜¯ä¸€ä¸ªå­˜æ”¾äºŒè¿›åˆ¶ä½çš„bitæ•°ç»„ï¼Œå¦‚æœæˆ‘ä»¬è¦æ·»åŠ ä¸€ä¸ªå€¼åˆ°å¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨Nä¸ªä¸åŒçš„å“ˆå¸Œå‡½æ•°æ¥ç”ŸæˆNä¸ªå“ˆå¸Œå€¼ï¼Œå¹¶å¯¹æ¯ä¸ªç”Ÿæˆçš„å“ˆå¸Œå€¼æŒ‡å‘çš„bitä½ç½®1ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä¸€å…±æ·»åŠ äº†ä¸‰ä¸ªå€¼abcã€‚</p><p>æ¥ç€æˆ‘ä»¬ç»™ä¸€ä¸ªdï¼Œé‚£ä¹ˆè¿™æ—¶å°±å¯ä»¥è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœè¯´dè®¡ç®—çš„Nä¸ªå“ˆå¸Œå€¼çš„ä½ç½®ä¸Šéƒ½æ˜¯1ï¼Œé‚£ä¹ˆå°±è¯´æ˜då¯èƒ½å­˜åœ¨ï¼›è¿™æ—¶å€™åˆæ¥äº†ä¸ªeï¼Œè®¡ç®—åæˆ‘ä»¬å‘ç°æœ‰ä¸€ä¸ªä½ç½®ä¸Šçš„å€¼æ˜¯0ï¼Œè¿™æ—¶å°±å¯ä»¥ç›´æ¥æ–­å®šeä¸€å®šä¸å­˜åœ¨ã€‚</p><h3 id="ç¼“å­˜å‡»ç©¿"><a href="#ç¼“å­˜å‡»ç©¿" class="headerlink" title="ç¼“å­˜å‡»ç©¿"></a>ç¼“å­˜å‡»ç©¿</h3><p><img src="6ut3ClgQrWUfKy2.jpg" alt="img"></p><p>æŸä¸ª Key å±äºçƒ­ç‚¹æ•°æ®ï¼Œè®¿é—®éå¸¸é¢‘ç¹ï¼ŒåŒä¸€æ—¶é—´å¾ˆå¤šäººéƒ½åœ¨è®¿é—®ï¼Œåœ¨è¿™ä¸ªKeyå¤±æ•ˆçš„ç¬é—´ï¼Œå¤§é‡çš„è¯·æ±‚åˆ°æ¥ï¼Œè¿™æ—¶å‘ç°ç¼“å­˜ä¸­æ²¡æœ‰æ•°æ®ï¼Œå°±å…¨éƒ½ç›´æ¥è¯·æ±‚æ•°æ®åº“ï¼Œç›¸å½“äºå‡»ç©¿äº†ç¼“å­˜å±éšœï¼Œç›´æ¥æ”»å‡»æ•´ä¸ªç³»ç»Ÿæ ¸å¿ƒã€‚</p><p>è¿™ç§æƒ…å†µä¸‹ï¼Œæœ€å¥½çš„è§£å†³åŠæ³•å°±æ˜¯ä¸è®©Keyé‚£ä¹ˆå¿«è¿‡æœŸï¼Œå¦‚æœä¸€ä¸ªKeyå¤„äºé«˜é¢‘è®¿é—®ï¼Œé‚£ä¹ˆå¯ä»¥é€‚å½“åœ°å»¶é•¿è¿‡æœŸæ—¶é—´ã€‚</p><h3 id="ç¼“å­˜é›ªå´©"><a href="#ç¼“å­˜é›ªå´©" class="headerlink" title="ç¼“å­˜é›ªå´©"></a>ç¼“å­˜é›ªå´©</h3><p><img src="BwncOXbRU4WFgkV.jpg" alt="img"></p><p>å½“ä½ çš„RedisæœåŠ¡å™¨ç‚¸äº†æˆ–æ˜¯å¤§é‡çš„Keyåœ¨åŒä¸€æ—¶é—´è¿‡æœŸï¼Œè¿™æ—¶ç›¸å½“äºç¼“å­˜ç›´æ¥GGäº†ï¼Œé‚£ä¹ˆå¦‚æœè¿™æ—¶åˆæœ‰å¾ˆå¤šçš„è¯·æ±‚æ¥è®¿é—®ä¸åŒçš„æ•°æ®ï¼ŒåŒä¸€æ—¶é—´å†…ç¼“å­˜æœåŠ¡å™¨å°±å¾—å‘æ•°æ®åº“å¤§é‡å‘èµ·è¯·æ±‚æ¥é‡æ–°å»ºç«‹ç¼“å­˜ï¼Œå¾ˆå®¹æ˜“æŠŠæ•°æ®åº“ä¹ŸæGGã€‚</p><p>è§£å†³è¿™ç§é—®é¢˜æœ€å¥½çš„åŠæ³•å°±æ˜¯è®¾ç½®é«˜å¯ç”¨ï¼Œä¹Ÿå°±æ˜¯æ­å»ºRedisé›†ç¾¤ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é‡‡å–ä¸€äº›æœåŠ¡ç†”æ–­é™çº§æœºåˆ¶ï¼Œè¿™äº›å†…å®¹æˆ‘ä»¬ä¼šåœ¨SpringCloudé˜¶æ®µå†è¿›è¡Œæ¢è®¨ã€‚</p><p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</p><p>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºæŸç çŸ¥è¯†åº“ç‰ˆæƒæ‰€æœ‰ï¼Œç¦æ­¢ä¸€åˆ‡æœªç»æˆæƒçš„è½¬è½½ã€å‘å¸ƒã€å‡ºå”®ç­‰è¡Œä¸ºï¼Œè¿è€…å°†è¢«è¿½ç©¶æ³•å¾‹è´£ä»»ã€‚</p><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://www.itbaima.cn/document/jjlolj5igvttvyhv">https://www.itbaima.cn/document/jjlolj5igvttvyhv</a></p>]]></content>
    
    
    <categories>
      
      <category>åç«¯</category>
      
      <category>ä¸­é—´ä»¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ•°æ®åº“</tag>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQLé«˜çº§</title>
    <link href="/post/bd155093-7287-4a33-ab3f-6f114eadc1bd/"/>
    <url>/post/bd155093-7287-4a33-ab3f-6f114eadc1bd/</url>
    
    <content type="html"><![CDATA[<h3 id="MySQLé«˜çº§"><a href="#MySQLé«˜çº§" class="headerlink" title="MySQLé«˜çº§"></a>MySQLé«˜çº§</h3><p><code>hexo template generate by typora plugin templater</code></p><h1 id="MySQLé«˜çº§-1"><a href="#MySQLé«˜çº§-1" class="headerlink" title="MySQLé«˜çº§"></a>MySQLé«˜çº§</h1><p>åœ¨JavaWebé˜¶æ®µï¼Œæˆ‘ä»¬åˆæ­¥è®¤è¯†äº†MySQLæ•°æ®åº“ï¼ŒåŒ…æ‹¬ä¸€äº›åŸºæœ¬æ“ä½œï¼Œæ¯”å¦‚åˆ›å»ºæ•°æ®åº“ã€è¡¨ã€è§¦å‘å™¨ï¼Œä»¥åŠæœ€åŸºæœ¬çš„å¢åˆ æ”¹æŸ¥ã€äº‹åŠ¡ç­‰æ“ä½œã€‚è€Œåœ¨æ­¤é˜¶æ®µï¼Œæˆ‘ä»¬å°†ç»§ç»­æ·±å…¥å­¦ä¹ MySQLï¼Œäº†è§£å®ƒçš„æ›´å¤šé«˜çº§ç©æ³•ï¼Œä¹Ÿç›¸å½“äºè¿›è¡Œå¤ä¹ ã€‚</p><h2 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h2><p>å…¶å®å‡½æ•°æˆ‘ä»¬åœ¨ä¹‹å‰å·²ç»æ¥è§¦åˆ°ä¸€éƒ¨åˆ†äº†ï¼Œåœ¨JavaWebé˜¶æ®µï¼Œæˆ‘ä»¬äº†è§£äº†èšé›†å‡½æ•°ï¼Œèšé›†å‡½æ•°ä¸€èˆ¬ç”¨ä½œç»Ÿè®¡ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>count([distinct]*)    ç»Ÿè®¡æ‰€æœ‰çš„è¡Œæ•°ï¼ˆdistinctè¡¨ç¤ºå»é‡å†ç»Ÿè®¡ï¼Œä¸‹åŒï¼‰</li><li>count([distinct]åˆ—å)    ç»Ÿè®¡æŸåˆ—çš„å€¼æ€»å’Œ</li><li>sum([distinct]åˆ—å)    æ±‚ä¸€åˆ—çš„å’Œï¼ˆæ³¨æ„å¿…é¡»æ˜¯æ•°å­—ç±»å‹çš„ï¼‰</li><li>avg([distinct]åˆ—å)    æ±‚ä¸€åˆ—çš„å¹³å‡å€¼ï¼ˆæ³¨æ„å¿…é¡»æ˜¯æ•°å­—ç±»å‹ï¼‰</li><li>max([distinct]åˆ—å)    æ±‚ä¸€åˆ—çš„æœ€å¤§å€¼</li><li>min([distinct]åˆ—å)    æ±‚ä¸€åˆ—çš„æœ€å°å€¼</li></ul><p>æ¯”å¦‚æˆ‘ä»¬éœ€è¦è®¡ç®—æŸä¸ªè¡¨ä¸€å…±æœ‰å¤šå°‘è¡Œï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> student<br></code></pre></td></tr></table></figure><p>é€šè¿‡ä½¿ç”¨COUNTèšé›†å‡½æ•°ï¼Œå°±å¯ä»¥å¿«é€Ÿç»Ÿè®¡å¹¶å¾—åˆ°ç»“æœï¼Œæ¯”å¦‚æˆ‘ä»¬æƒ³è®¡ç®—æŸä¸€åˆ—ä¸Šæ‰€æœ‰æ•°å­—çš„å’Œï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">SUM</span>(sid) <span class="hljs-keyword">FROM</span> student<br></code></pre></td></tr></table></figure><p>é€šè¿‡SUMèšé›†å‡½æ•°ï¼Œå°±å¯ä»¥å¿«é€Ÿè®¡ç®—æ¯ä¸€åˆ—çš„å’Œï¼Œå®é™…ä¸Šè¿™äº›å‡½æ•°éƒ½æ˜¯ç”±ç³»ç»Ÿæä¾›çš„å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</p><p>æœ¬ç‰ˆå—æˆ‘ä»¬ä¼šè¯¦ç»†ä»‹ç»å„ç±»ç³»ç»Ÿå‡½æ•°ä»¥åŠå¦‚ä½•ç¼–å†™è‡ªå®šä¹‰å‡½æ•°ã€‚</p><h3 id="ç³»ç»Ÿå‡½æ•°"><a href="#ç³»ç»Ÿå‡½æ•°" class="headerlink" title="ç³»ç»Ÿå‡½æ•°"></a>ç³»ç»Ÿå‡½æ•°</h3><p>ç³»ç»Ÿä¸ºæˆ‘ä»¬æä¾›çš„å‡½æ•°ä¹Ÿæ˜¯éå¸¸å®ç”¨çš„ï¼Œæˆ‘ä»¬å°†ä¼šåˆ†ä¸ºå‡ ä¸ªç±»å‹è¿›è¡Œè®²è§£ã€‚</p><h4 id="å­—ç¬¦ä¸²å‡½æ•°"><a href="#å­—ç¬¦ä¸²å‡½æ•°" class="headerlink" title="å­—ç¬¦ä¸²å‡½æ•°"></a>å­—ç¬¦ä¸²å‡½æ•°</h4><p>å¤„ç†å­—ç¬¦ä¸²æ˜¯ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²å‡½æ•°æ¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿå¤„ç†å­—ç¬¦ä¸²ï¼Œå…¶ä¸­å¸¸ç”¨æ¯”å¦‚ç”¨äºå­—ç¬¦ä¸²åˆ†å‰²çš„å‡½æ•°æœ‰ï¼š</p><ul><li>substring(å­—ç¬¦ä¸², èµ·å§‹ä½ç½®, ç»“æŸä½ç½®)     åŒJavaä¸­Stringç±»çš„substringä¸€è‡´ï¼Œä½†æ˜¯æ³¨æ„ä¸‹æ ‡æ˜¯ä»1å¼€å§‹ï¼Œä¸‹åŒ</li><li>left(å­—ç¬¦ä¸², é•¿åº¦)     ä»æœ€å·¦è¾¹å‘å³æˆªå–å­—ç¬¦ä¸²</li><li>right(å­—ç¬¦ä¸², é•¿åº¦)     ä»æœ€å³è¾¹å‘å·¦æˆªå–å­—ç¬¦ä¸²</li></ul><p>æ¯”å¦‚æˆ‘ä»¬åªæƒ³è·å–æ‰€æœ‰å­¦ç”Ÿå§“åçš„ç¬¬äºŒä¸ªå­—ï¼Œé‚£ä¹ˆå¯ä»¥åƒè¿™æ ·å†™ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">SUBSTRING</span>(name, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>) <span class="hljs-keyword">FROM</span> student<br></code></pre></td></tr></table></figure><p>æ¯”å¦‚æˆ‘ä»¬æƒ³è·å–æ‰€æœ‰å­¦ç”Ÿå§“åçš„ç¬¬ä¸€ä¸ªå­—ï¼Œå¯ä»¥åƒè¿™æ ·å†™ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">LEFT</span>(name, <span class="hljs-number">1</span>) <span class="hljs-keyword">FROM</span> student<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨å­—ç¬¦ä¸²å‡½æ•°æ¥å¿«é€Ÿå°†æ‰€æœ‰çš„å­—æ¯è½¬æ¢ä¸ºå¤§å†™å­—æ¯æˆ–æ˜¯å¿«é€Ÿè½¬æ¢ä¸ºå°å†™å­—æ¯ï¼š</p><ul><li>upper(å­—ç¬¦ä¸²)     å­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰å­—æ¯è½¬æ¢ä¸ºå¤§å†™å­—æ¯</li><li>lower(å­—ç¬¦ä¸²)     å­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰å­—æ¯è½¬æ¢ä¸ºå°å†™å­—æ¯</li></ul><p>æ¯”å¦‚æˆ‘ä»¬å¸Œæœ›å°†ä¸€ä¸ªå­—ç¬¦ä¸²æ‰€æœ‰å­—ç¬¦ä¸“ä¸ºå¤§å†™ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">UPPER</span>(<span class="hljs-string">&#x27;abcdefg&#x27;</span>)<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åƒJavaä¸­é‚£æ ·ç›´æ¥å¯¹å­—ç¬¦ä¸²ä¸­çš„å†…å®¹è¿›è¡Œæ›¿æ¢ï¼š</p><ul><li>replace(å­—ç¬¦ä¸², åŸæ–‡, æ›¿æ¢æ–‡)      åŒJavaä¸­Stringçš„replaceæ•ˆæœ</li></ul><p>æ¯”å¦‚ç°åœ¨æˆ‘ä»¬å¸Œæœ›å°†æŸ¥è¯¢åˆ°çš„æ‰€æœ‰åŒå­¦çš„åç§°ä¸­çš„<code>å°</code>å…¨éƒ¨æ›¿æ¢<code>å¤§</code>ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> REPLACE(`name`, <span class="hljs-string">&#x27;å°&#x27;</span>, <span class="hljs-string">&#x27;å¤§&#x27;</span>) <span class="hljs-keyword">FROM</span> student<br></code></pre></td></tr></table></figure><p>å­—ç¬¦ä¸²ä¹Ÿæ”¯æŒè¿›è¡Œæ‹¼æ¥ï¼Œç³»ç»Ÿæä¾›äº†å­—ç¬¦ä¸²çš„æ‹¼æ¥å‡½æ•°ï¼š</p><ul><li>concat(å­—ç¬¦ä¸²1, å­—ç¬¦ä¸²2)   è¿æ¥ä¸¤ä¸ªå­—ç¬¦ä¸²</li></ul><p>æ¯”å¦‚æˆ‘ä»¬å¸Œæœ›å°†æŸ¥è¯¢åˆ°çš„æ‰€æœ‰åŒå­¦çš„åç§°æœ€åéƒ½æ·»åŠ ä¸€ä¸ª<code>å­</code>å­—ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> concat(name, <span class="hljs-string">&#x27;å­&#x27;</span>) <span class="hljs-keyword">FROM</span> student<br></code></pre></td></tr></table></figure><p>æœ€åå°±æ˜¯è®¡ç®—å­—ç¬¦ä¸²çš„é•¿åº¦ï¼š</p><ul><li>length(å­—ç¬¦ä¸²)    è·å–å­—ç¬¦ä¸²é•¿åº¦ï¼ˆæ³¨æ„å¦‚æœä½¿ç”¨çš„æ˜¯UTF-8ç¼–ç æ ¼å¼ï¼Œé‚£ä¹ˆä¸€ä¸ªæ±‰å­—å 3å­—èŠ‚ï¼Œæ•°å­—å’Œå­—æ¯å ä¸€ä¸ªå­—èŠ‚ï¼‰</li></ul><p>æ¯”å¦‚æˆ‘ä»¬è¦è·å–æ‰€æœ‰äººåå­—çš„é•¿åº¦ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> LENGTH(`name`) <span class="hljs-keyword">FROM</span> student<br></code></pre></td></tr></table></figure><h4 id="æ—¥æœŸå‡½æ•°"><a href="#æ—¥æœŸå‡½æ•°" class="headerlink" title="æ—¥æœŸå‡½æ•°"></a>æ—¥æœŸå‡½æ•°</h4><p>MySQLæä¾›çš„æ—¥æœŸå‡½æ•°ä¹Ÿéå¸¸å®ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥å¿«é€Ÿå¯¹æ—¥æœŸè¿›è¡Œæ“ä½œï¼Œæ¯”å¦‚æˆ‘ä»¬æƒ³è¦å¿«é€Ÿå°†æ—¥æœŸæ·»åŠ Nå¤©ï¼Œå°±å¯ä»¥ä½¿ç”¨ï¼š</p><ul><li>date_add(æ—¥æœŸ, interval å¢é‡ å•ä½)</li></ul><p>æ¯”å¦‚æˆ‘ä»¬å¸Œæœ›è®©2022-1-1å‘å5å¤©ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> DATE_ADD(<span class="hljs-string">&#x27;2022-1-1&#x27;</span>,<span class="hljs-type">INTERVAL</span> <span class="hljs-number">5</span> <span class="hljs-keyword">day</span>)<br></code></pre></td></tr></table></figure><p>åŒç†ï¼Œå‘å‰1å¹´ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> DATE_ADD(<span class="hljs-string">&#x27;2022-1-1&#x27;</span>,<span class="hljs-type">INTERVAL</span> <span class="hljs-number">-1</span> <span class="hljs-keyword">year</span>)<br></code></pre></td></tr></table></figure><p>å•ä½æœ‰ï¼šyearï¼ˆå¹´ï¼‰ã€monthï¼ˆæœˆï¼‰ã€dayï¼ˆæ—¥ï¼‰ã€hourï¼ˆå°æ—¶ï¼‰ã€minuteï¼ˆåˆ†é’Ÿï¼‰ã€secondï¼ˆç§’ï¼‰</p><p>æˆ‘ä»¬è¿˜å¯ä»¥å¿«é€Ÿè®¡ç®—æ—¥æœŸçš„é—´éš”å¤©æ•°ï¼š</p><ul><li>datediff(æ—¥æœŸ1, æ—¥æœŸ2)</li></ul><p>æ¯”å¦‚æˆ‘ä»¬æƒ³è®¡ç®—2022å¹´çš„2æœˆæœ‰å¤šå°‘å¤©ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> DATEDIFF(<span class="hljs-string">&#x27;2022-3-1&#x27;</span>,<span class="hljs-string">&#x27;2022-2-1&#x27;</span>)<br></code></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬æƒ³å¿«é€Ÿè·å–å½“å‰æ—¶é—´çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨è¿™äº›ï¼š</p><ul><li>curdate()     å½“å‰çš„æ—¥æœŸ</li><li>curtime()     å½“å‰çš„æ—¶é—´</li><li>now()    å½“å‰çš„æ—¥æœŸ+æ—¶é—´</li></ul><p>æ­¤å‡½æ•°ä¹‹å‰æˆ‘ä»¬åœ¨ç¼–å†™å®æˆ˜é¡¹ç›®çš„æ—¶å€™å·²ç»ä½¿ç”¨è¿‡äº†ï¼Œè¿™é‡Œå°±ä¸æ¼”ç¤ºäº†ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥å•ç‹¬è·å–æ—¶é—´ä¸­çš„æŸä¸ªå€¼ï¼š</p><ul><li>day(æ—¥æœŸ)    è·å–æ—¥æœŸæ˜¯å‡ å·</li><li>month(æ—¥æœŸ)   è·å–æ—¥æœŸæ˜¯å‡ æœˆ</li><li>year(æ—¥æœŸ)      è·å–æ—¥æœŸæ˜¯å“ªä¸€å¹´</li></ul><p>æ¯”å¦‚æˆ‘ä»¬æƒ³è·å–ä»Šå¤©æ˜¯å‡ å·ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DAY</span>(NOW())<br></code></pre></td></tr></table></figure><h4 id="æ•°å­¦å‡½æ•°"><a href="#æ•°å­¦å‡½æ•°" class="headerlink" title="æ•°å­¦å‡½æ•°"></a>æ•°å­¦å‡½æ•°</h4><p>æ•°å­¦å‡½æ•°æ¯”è¾ƒå¸¸è§„ï¼ŒåŸºæœ¬ä¸Javaçš„Mathå·¥å…·ç±»ä¸€è‡´ï¼Œè¿™é‡Œåˆ—å‡ºå³å¯ï¼Œå„ä½å¯ä»¥è‡ªè¡Œå°è¯•ï¼š</p><ul><li>abs(x)   æ±‚xçš„ç»å¯¹å€¼</li><li>ceiling(x)   xå‘ä¸Šå–æ•´</li><li>floor(x)  xå‘ä¸‹å–æ•´</li><li>round(x, ç²¾åº¦)  xå–å››èˆäº”å…¥ï¼Œéµå¾ªå°æ•°ç‚¹ç²¾åº¦</li><li>exp(x)   eçš„xæ¬¡æ–¹</li><li>rand()   0-1ä¹‹é—´çš„éšæœºæ•°</li><li>log(x)    xçš„å¯¹æ•°</li><li>pi()     Ï€</li><li>power(x, n)    xçš„næ¬¡æ–¹</li><li>sqrt(x)     xçš„å¹³æ–¹æ ¹</li><li>sin(x)  cos(x)   tan(x)     ä¸‰è§’å‡½æ•°ï¼ˆè²Œä¼¼æ²¡æœ‰arctanè¿™ç±»åå‡½æ•°ï¼Ÿï¼‰</li></ul><h4 id="ç±»å‹è½¬æ¢å‡½æ•°"><a href="#ç±»å‹è½¬æ¢å‡½æ•°" class="headerlink" title="ç±»å‹è½¬æ¢å‡½æ•°"></a>ç±»å‹è½¬æ¢å‡½æ•°</h4><p>MySQLçš„ç±»å‹è½¬æ¢ä¹Ÿåˆ†ä¸ºéšå¼ç±»å‹è½¬æ¢å’Œæ˜¾ç¤ºç±»å‹è½¬æ¢ï¼Œé¦–å…ˆæˆ‘ä»¬æ¥çœ‹çœ‹éšå¼ç±»å‹è½¬æ¢ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span><span class="hljs-operator">+</span><span class="hljs-string">&#x27;2&#x27;</span><br></code></pre></td></tr></table></figure><p>è™½ç„¶è¿™å¥ä¸­æ—¢åŒ…å«äº†æ•°å­—å’Œå­—ç¬¦ï¼Œä½†æ˜¯å­—ç¬¦ä¸²ä¼šè¢«è¿›è¡Œéšå¼è½¬æ¢ï¼ˆæ³¨æ„è¿™é‡Œå¹¶ä¸æ˜¯æŒ‰ç…§å­—ç¬¦çš„ASCIIç è½¬æ¢ï¼Œè€Œæ˜¯å†™çš„å¤šå°‘è¡¨ç¤ºå¤šå°‘ï¼‰æ‰€ä»¥æœ€åå¾—åˆ°çš„å°±æ˜¯1+2çš„ç»“æœä¸º3</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> CONCAT(<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;2&#x27;</span>)<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå› ä¸ºéœ€è¦ä¼ å…¥å­—ç¬¦ä¸²ç±»å‹çš„æ•°æ®ï¼Œä½†æ˜¯æˆ‘ä»¬ç»™çš„æ˜¯1è¿™ä¸ªæ•°å­—ï¼Œå› æ­¤è¿™é‡Œä¹Ÿä¼šå‘ç”Ÿéšå¼ç±»å‹è½¬æ¢ï¼Œ1ä¼šè¢«ç›´æ¥è½¬æ¢ä¸ºå­—ç¬¦ä¸²çš„â€™1â€™ï¼Œæ‰€ä»¥è¿™é‡Œå¾—åˆ°çš„ç»“æœæ˜¯â€™12â€™</p><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦ä½¿ç”¨å¼ºåˆ¶ç±»å‹è½¬æ¢æ¥å°†å¾—åˆ°çš„æ•°æ®è½¬æ¢æˆæˆ‘ä»¬éœ€è¦çš„æ•°æ®ç±»å‹ï¼Œè¿™æ—¶å°±éœ€è¦ç”¨åˆ°ç±»å‹è½¬æ¢å‡½æ•°äº†ï¼ŒMySQLæä¾›äº†ï¼š</p><ul><li>cast(æ•°æ®   as æ•°æ®ç±»å‹)</li></ul><p>æ•°æ®ç±»å‹æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p><ul><li>BINARY[(N)] ï¼šäºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼Œè½¬æ¢åé•¿åº¦å°äºNä¸ªå­—èŠ‚</li><li>CHAR[(N)] ï¼šå­—ç¬¦ä¸²ï¼Œè½¬æ¢åé•¿åº¦å°äºNä¸ªå­—ç¬¦</li><li>DATE ï¼šæ—¥æœŸ</li><li>DATETIME ï¼šæ—¥æœŸæ—¶é—´</li><li>DECIMAL[(M[,N])] ï¼šæµ®ç‚¹æ•°ï¼ŒMä¸ºæ•°å­—æ€»ä½æ•°(åŒ…æ‹¬æ•´æ•°éƒ¨åˆ†å’Œå°æ•°éƒ¨åˆ†)ï¼ŒNä¸ºå°æ•°ç‚¹åçš„ä½æ•°</li><li>SIGNED [INTEGER] ï¼šæœ‰ç¬¦å·æ•´æ•°</li><li>TIME ï¼šæ—¶é—´</li><li>UNSIGNED [INTEGER] ï¼šæ— ç¬¦å·æ•´æ•°</li></ul><p>æ¯”å¦‚æˆ‘ä»¬ç°åœ¨éœ€è¦å°†ä¸€ä¸ªæµ®ç‚¹æ•°è½¬æ¢ä¸ºä¸€ä¸ªæ•´æ•°ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">CAST</span>(pi() <span class="hljs-keyword">AS</span> SIGNED)<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿˜å¯ä»¥å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—ï¼Œä¼šè‡ªåŠ¨è¿›è¡Œæ‰«æï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ä¸€æ—¦é‡åˆ°éæ•°å­—çš„å­—ç¬¦ï¼Œä¼šåœæ­¢æ‰«æï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">CAST</span>(<span class="hljs-string">&#x27;123abc456&#x27;</span> <span class="hljs-keyword">as</span> SIGNED)<br></code></pre></td></tr></table></figure><p>é™¤äº†castä»¥å¤–è¿˜æœ‰convertå‡½æ•°ï¼ŒåŠŸèƒ½æ¯”è¾ƒç›¸ä¼¼ï¼Œè¿™é‡Œå°±ä¸åšè®²è§£äº†ã€‚</p><h4 id="æµç¨‹æ§åˆ¶å‡½æ•°"><a href="#æµç¨‹æ§åˆ¶å‡½æ•°" class="headerlink" title="æµç¨‹æ§åˆ¶å‡½æ•°"></a>æµç¨‹æ§åˆ¶å‡½æ•°</h4><p>MySQLè¿˜ä¸ºæˆ‘ä»¬æä¾›äº†å¾ˆå¤šçš„é€»è¾‘åˆ¤æ–­å‡½æ•°ï¼Œæ¯”å¦‚ï¼š</p><ul><li>if(æ¡ä»¶è¡¨è¾¾å¼, ç»“æœ1, ç»“æœ2)    ä¸Javaä¸­çš„ä¸‰ç›®è¿ç®—ç¬¦ä¸€è‡´ a &gt; b ? â€œAAAâ€ : â€œBBBâ€</li><li>ifnull(å€¼1, å€¼2)     å¦‚æœå€¼1ä¸ºNULLåˆ™è¿”å›å€¼2ï¼Œå¦åˆ™è¿”å›å€¼1</li><li>nullif(å€¼1, å€¼2)     å¦‚æœå€¼1ä¸å€¼2ç›¸ç­‰ï¼Œé‚£ä¹ˆè¿”å›NULL</li><li>isnull(å€¼)      åˆ¤æ–­å€¼æ˜¯å¦ä¸ºNULL</li></ul><p>æ¯”å¦‚ç°åœ¨æˆ‘ä»¬æƒ³åˆ¤æ–­ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> IF(<span class="hljs-number">1</span> <span class="hljs-operator">&lt;</span> <span class="hljs-number">0</span>,<span class="hljs-string">&#x27;lbwnb&#x27;</span>,<span class="hljs-string">&#x27;yyds&#x27;</span>)<br></code></pre></td></tr></table></figure><p>é€šè¿‡åˆ¤æ–­å‡½æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾ˆæ–¹ä¾¿åœ°è¿›è¡Œä¸€äº›æ¡ä»¶åˆ¤æ–­æ“ä½œã€‚</p><p>é™¤äº†IFæ¡ä»¶åˆ¤æ–­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ç±»ä¼¼Switchä¸€æ ·çš„è¯­å¥å®Œæˆå¤šåˆ†æ”¯ç»“æ„ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <br><span class="hljs-keyword">CASE</span> <span class="hljs-number">2</span><br><span class="hljs-keyword">WHEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">THEN</span><br><span class="hljs-number">10</span><br><span class="hljs-keyword">ELSE</span><br><span class="hljs-number">5</span><br><span class="hljs-keyword">END</span>;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†è‡ªå®šä¹‰çš„åˆ¤æ–­æ¡ä»¶æ”¾å…¥Whenä¹‹åï¼Œå®ƒç±»ä¼¼äºelse-ifï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <br><span class="hljs-keyword">CASE</span><br><span class="hljs-keyword">WHEN</span> <span class="hljs-number">3</span><span class="hljs-operator">&gt;</span><span class="hljs-number">5</span> <span class="hljs-keyword">THEN</span><br><span class="hljs-number">10</span><br><span class="hljs-keyword">WHEN</span> <span class="hljs-number">0</span><span class="hljs-operator">&lt;</span><span class="hljs-number">1</span> <span class="hljs-keyword">THEN</span><br><span class="hljs-number">11</span><br><span class="hljs-keyword">ELSE</span><br><span class="hljs-number">5</span><br><span class="hljs-keyword">END</span>;<br></code></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€ä¸ªç±»ä¼¼äºJavaä¸­çš„Thread.sleepçš„å‡½æ•°ï¼Œä»¥ç§’ä¸ºå•ä½ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> sleep(<span class="hljs-number">10</span>);<br></code></pre></td></tr></table></figure><p>æœ‰å…³MySQL8.0æ–°å¢çš„çª—å£å‡½æ•°è¿™é‡Œæš‚æ—¶ä¸åšä»‹ç»ã€‚</p><h3 id="è‡ªå®šä¹‰å‡½æ•°"><a href="#è‡ªå®šä¹‰å‡½æ•°" class="headerlink" title="è‡ªå®šä¹‰å‡½æ•°"></a>è‡ªå®šä¹‰å‡½æ•°</h3><p>é™¤äº†ä½¿ç”¨ç³»ç»Ÿä¸ºæˆ‘ä»¬æä¾›çš„å‡½æ•°ä»¥å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰å‡½æ•°ï¼Œå¹¶ä½¿ç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„å‡½æ•°è¿›è¡Œæ•°æ®å¤„ç†ï¼Œå”¯ä¸€æ¯”è¾ƒéº»çƒ¦çš„å°±æ˜¯å‡½æ•°å®šä¹‰åä¸èƒ½ä¿®æ”¹ï¼Œåªèƒ½åˆ äº†é‡æ–°å†™ã€‚</p><h4 id="åŸºæœ¬è¯­æ³•"><a href="#åŸºæœ¬è¯­æ³•" class="headerlink" title="åŸºæœ¬è¯­æ³•"></a>åŸºæœ¬è¯­æ³•</h4><p>MySQLçš„å‡½æ•°ä¸Javaä¸­çš„æ–¹æ³•ç±»ä¼¼ï¼Œä¹Ÿå¯ä»¥æ·»åŠ å‚æ•°å’Œè¿”å›å€¼ï¼Œå¯ä»¥é€šè¿‡<code>CREATE FUNCTION</code>åˆ›å»ºå‡½æ•°ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">FUNCTION</span> test() <span class="hljs-keyword">RETURNS</span> <span class="hljs-type">INT</span><br><span class="hljs-keyword">BEGIN</span><br><span class="hljs-keyword">RETURN</span> <span class="hljs-number">666</span>;<br><span class="hljs-keyword">END</span><br></code></pre></td></tr></table></figure><p>å®šä¹‰å‡½æ•°çš„æ ¼å¼ä¸ºï¼š</p><ul><li>create function å‡½æ•°åç§°([å‚æ•°åˆ—è¡¨]) returns è¿”å›å€¼ç±»å‹</li><li>begin å’Œ end ä¹‹é—´å†™å‡½æ•°çš„å…¶ä»–é€»è¾‘ï¼Œbeginå’Œendå°±ç›¸å½“äºJavaä¸­çš„èŠ±æ‹¬å·<code>&#123;  ...  &#125;</code></li><li>returnåç´§è·Ÿè¿”å›çš„ç»“æœ</li></ul><p>æ·»åŠ å‚æ•°ä¹Ÿå¾ˆç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨å‡½æ•°åç§°æ‹¬å·ä¸­æ·»åŠ å³å¯ï¼Œæ³¨æ„ç±»å‹éœ€è¦å†™åœ¨å‚æ•°åç§°åé¢ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">FUNCTION</span> test(i <span class="hljs-type">INT</span>) <span class="hljs-keyword">RETURNS</span> <span class="hljs-type">INT</span><br><span class="hljs-keyword">BEGIN</span><br><span class="hljs-keyword">RETURN</span> i <span class="hljs-operator">*</span> i;<br><span class="hljs-keyword">END</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥åœ¨BEGINå’ŒRETURNä¹‹é—´ç¼–å†™ä¸€äº›å…¶ä»–çš„é€»è¾‘ï¼Œæ¯”å¦‚æˆ‘ä»¬æƒ³è¦å®šä¹‰ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œå¹¶ä¸ºå…¶èµ‹å€¼ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">BEGIN</span><br><span class="hljs-keyword">DECLARE</span> a <span class="hljs-type">INT</span>;<br><span class="hljs-keyword">SET</span> a <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<br><span class="hljs-keyword">RETURN</span> i <span class="hljs-operator">*</span> i <span class="hljs-operator">*</span> a;<br><span class="hljs-keyword">END</span><br></code></pre></td></tr></table></figure><p>å®šä¹‰å±€éƒ¨å˜é‡çš„æ ¼å¼ä¸ºï¼š</p><ul><li>declare å˜é‡åç§° å˜é‡ç±»å‹ [, â€¦]</li><li>declare å˜é‡åç§° å˜é‡ç±»å‹ default é»˜è®¤å€¼</li></ul><p>ä¸ºå˜é‡èµ‹å€¼çš„æ ¼å¼ä¸ºï¼š</p><ul><li>set å˜é‡åç§° &#x3D; å€¼</li></ul><p>æˆ‘ä»¬è¿˜å¯ä»¥åœ¨å‡½æ•°å†…éƒ¨ä½¿ç”¨<code>select</code>è¯­å¥ï¼Œå®ƒå¯ä»¥ç›´æ¥ä»è¡¨ä¸­è¯»å–æ•°æ®ï¼Œå¹¶å¯ä»¥ç»“åˆintoå…³é”®å­—å°†æŸ¥è¯¢ç»“æœèµ‹å€¼ç»™å˜é‡ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">BEGIN</span><br><span class="hljs-keyword">DECLARE</span> a <span class="hljs-type">INT</span>;<br><span class="hljs-comment">-- select into from è¯­å¥</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">INTO</span> a <span class="hljs-keyword">FROM</span> student;<br><span class="hljs-keyword">RETURN</span> a;<br><span class="hljs-keyword">END</span><br></code></pre></td></tr></table></figure><h4 id="æµç¨‹æ§åˆ¶"><a href="#æµç¨‹æ§åˆ¶" class="headerlink" title="æµç¨‹æ§åˆ¶"></a>æµç¨‹æ§åˆ¶</h4><p>æ¥ç€æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨æµç¨‹æ§åˆ¶è¯­å¥ï¼Œå…¶ä¸­æœ€å…³é”®çš„å°±æ˜¯IFåˆ¤æ–­è¯­å¥ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">BEGIN</span><br><span class="hljs-keyword">DECLARE</span> a <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">10</span>;<br>IF a <span class="hljs-operator">&gt;</span> <span class="hljs-number">10</span> <span class="hljs-keyword">THEN</span><br><span class="hljs-keyword">RETURN</span> <span class="hljs-number">1</span>;<br><span class="hljs-keyword">ELSE</span><br><span class="hljs-keyword">RETURN</span> <span class="hljs-number">2</span>;<br><span class="hljs-keyword">END</span> IF;<br><span class="hljs-keyword">END</span><br></code></pre></td></tr></table></figure><p>IFåˆ†æ”¯è¯­å¥çš„æ ¼å¼ä¸ºï¼š</p><ul><li>if åˆ¤æ–­æ¡ä»¶ then  â€¦ else if åˆ¤æ–­æ¡ä»¶ then â€¦. else â€¦ end if;</li></ul><p>æˆ‘ä»¬å¯ä»¥ç»“åˆ<code>exists</code>å…³é”®å­—æ¥åˆ¤æ–­æ˜¯å¦ä¸ºNULLï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">BEGIN</span><br><span class="hljs-keyword">DECLARE</span> a <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>;<br><span class="hljs-comment">-- IF EXISTS(SELECT * FROM student WHERE sid = 100) THEN</span><br>IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span>(<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> sid <span class="hljs-operator">=</span> <span class="hljs-number">100</span>) <span class="hljs-keyword">THEN</span><br><span class="hljs-keyword">SET</span> a <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<br><span class="hljs-keyword">END</span> IF;<br><span class="hljs-keyword">RETURN</span> a;<br><span class="hljs-keyword">END</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨å‡½æ•°ä¸­ä½¿ç”¨switchè¯­å¥ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">BEGIN</span><br><span class="hljs-keyword">DECLARE</span> a <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">10</span>;<br><span class="hljs-keyword">CASE</span> a<br><span class="hljs-keyword">WHEN</span> <span class="hljs-number">10</span> <span class="hljs-keyword">THEN</span><br><span class="hljs-keyword">RETURN</span> <span class="hljs-number">2</span>;<br><span class="hljs-keyword">ELSE</span><br><span class="hljs-keyword">RETURN</span> <span class="hljs-number">1</span>;<br><span class="hljs-keyword">END</span> <span class="hljs-keyword">CASE</span>;<br><span class="hljs-keyword">END</span><br></code></pre></td></tr></table></figure><p>SWITCHåˆ†æ”¯è¯­å¥çš„æ ¼å¼ä¸ºï¼š</p><ul><li>case å˜é‡ when å…·ä½“å€¼æˆ–æ˜¯å¸ƒå°”è¡¨è¾¾å¼ then â€¦ when * then â€¦ else â€¦ end case;</li></ul><p>ä¸Javaä¸åŒçš„æ˜¯ï¼Œå®ƒæ”¯æŒä½¿ç”¨å¸ƒå°”è¡¨è¾¾å¼ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">BEGIN</span><br><span class="hljs-keyword">DECLARE</span> a <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">10</span>;<br><span class="hljs-keyword">CASE</span><br><span class="hljs-keyword">WHEN</span> <span class="hljs-number">1</span> <span class="hljs-operator">&lt;</span> <span class="hljs-number">5</span> <span class="hljs-keyword">THEN</span><br><span class="hljs-keyword">SET</span> a <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;<br><span class="hljs-keyword">ELSE</span><br><span class="hljs-keyword">SET</span> a <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<br><span class="hljs-keyword">END</span> <span class="hljs-keyword">CASE</span>;<br><span class="hljs-keyword">RETURN</span> a;<br><span class="hljs-keyword">END</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ä»¥ç±»ä¼¼äºelseifçš„å½¢å¼è¿›è¡Œåˆ¤æ–­ï¼Œå…¶å®å’Œä¸Šé¢ç›´æ¥ä½¿ç”¨æ˜¯ä¸€æ ·çš„ã€‚</p><p>æˆ‘ä»¬æ¥ç€æ¥çœ‹å¾ªç¯è¯­å¥ï¼ŒMySQLæä¾›äº†ä¸‰ç§å¾ªç¯è¯­å¥ï¼Œå…¶ä¸­ç¬¬ä¸€ç§æ˜¯WHILEè¯­å¥ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">BEGIN</span><br><span class="hljs-keyword">DECLARE</span> a <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">10</span>;<br>WHILE a <span class="hljs-operator">&lt;</span> <span class="hljs-number">11</span> DO<br><span class="hljs-keyword">SET</span> a <span class="hljs-operator">=</span> a <span class="hljs-operator">+</span> <span class="hljs-number">1</span>;<br><span class="hljs-keyword">END</span> WHILE;<br><span class="hljs-keyword">RETURN</span> a;<br><span class="hljs-keyword">END</span><br></code></pre></td></tr></table></figure><p>æ ¼å¼ä¸ºï¼š</p><ul><li>while å¾ªç¯æ¡ä»¶ do â€¦  end while;</li></ul><p>æˆ‘ä»¬æ¥ç€æ¥çœ‹ç¬¬äºŒç§å¾ªç¯è¯­å¥ï¼ŒLOOPå¾ªç¯ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">BEGIN</span><br><span class="hljs-keyword">DECLARE</span> a <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">10</span>;<br>lp1: LOOP<br>  <span class="hljs-keyword">SET</span> a <span class="hljs-operator">=</span> a <span class="hljs-operator">-</span> <span class="hljs-number">1</span>;<br>IF a <span class="hljs-operator">=</span> <span class="hljs-number">0</span> <span class="hljs-keyword">THEN</span><br>LEAVE lp1; <br><span class="hljs-keyword">END</span> IF; <br><span class="hljs-keyword">END</span> LOOP lp1;<br><span class="hljs-keyword">RETURN</span> a;<br><span class="hljs-keyword">END</span><br></code></pre></td></tr></table></figure><p>ç›¸æ¯”whileè¯­å¥ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>LEAVE</code>ç²¾å‡†æ§åˆ¶ç»“æŸå“ªä¸ªå¾ªç¯ï¼Œæœ‰ç‚¹ç±»ä¼¼äºgotoè¯­å¥ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">BEGIN</span><br><span class="hljs-keyword">DECLARE</span> a <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>;<br>lp1: LOOP<br>  lp2: LOOP<br><span class="hljs-keyword">SET</span> a <span class="hljs-operator">=</span> a <span class="hljs-operator">+</span> <span class="hljs-number">1</span>;<br>IF a <span class="hljs-operator">&gt;</span> <span class="hljs-number">5</span> <span class="hljs-keyword">THEN</span><br>LEAVE lp1; <br><span class="hljs-keyword">END</span> IF; <br><span class="hljs-keyword">END</span> LOOP lp2;<br><span class="hljs-keyword">END</span> LOOP lp1;<br><span class="hljs-keyword">RETURN</span> a;<br><span class="hljs-keyword">END</span><br></code></pre></td></tr></table></figure><p>ç±»ä¼¼äºJavaä¸­çš„gotoå†™æ³•ï¼ˆåœ¨JavaSEé˜¶æ®µå·²ç»è®²è§£è¿‡ï¼‰ï¼š</p><p>â€‹                              </p><p>â€‹        java        å¤åˆ¶ä»£ç       </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    lp1: <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>)&#123;<br>        lp2: <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>)&#123;<br>            a++;<br>            <span class="hljs-keyword">if</span>(a &gt; <span class="hljs-number">5</span>) <span class="hljs-keyword">break</span> lp1;<br>        &#125;<br>    &#125;<br>    System.out.println(a);<br>&#125;<br></code></pre></td></tr></table></figure><p>å®ƒçš„è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p><ul><li>å¾ªç¯åç§° loop â€¦(å¯ä»¥æ’å…¥leaveè¯­å¥ç»“æŸ) end loop å¾ªç¯åç§°;</li></ul><p>æ¥ç€æˆ‘ä»¬æ¥çœ‹æœ€åä¸€ç§å¾ªç¯è¯­å¥ï¼Œrepeatè¯­å¥ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">BEGIN</span><br><span class="hljs-keyword">DECLARE</span> a <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>;<br>REPEAT<br><span class="hljs-keyword">SET</span> a <span class="hljs-operator">=</span> a <span class="hljs-operator">+</span> <span class="hljs-number">1</span>;<br>UNTIL a <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span> <span class="hljs-keyword">END</span> REPEAT;<br><span class="hljs-keyword">RETURN</span> a;<br><span class="hljs-keyword">END</span><br></code></pre></td></tr></table></figure><p>å®ƒç±»ä¼¼äºJavaä¸­çš„do-whileå¾ªç¯è¯­å¥ï¼Œå®ƒä¼šå…ˆå»æ‰§è¡Œé‡Œé¢çš„å†…å®¹ï¼Œå†è¿›è¡Œåˆ¤æ–­ï¼Œæ ¼å¼ä¸ºï¼š</p><ul><li>repeat â€¦ until ç»“æŸå¾ªç¯æ¡ä»¶ end repeat;</li></ul><h4 id="å…¨å±€å˜é‡"><a href="#å…¨å±€å˜é‡" class="headerlink" title="å…¨å±€å˜é‡"></a>å…¨å±€å˜é‡</h4><p>æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨ä¸€æ¬¡ä¼šè¯ä¸­ç›´æ¥å®šä¹‰å˜é‡å¹¶ä½¿ç”¨ï¼Œè¿™æ—¶å®ƒå¹¶ä¸æ˜¯ä½äºå‡½æ•°å†…çš„ï¼Œè¿™å°±æ˜¯å…¨å±€å˜é‡ï¼Œå®ƒæ— éœ€é¢„å…ˆå®šä¹‰ï¼Œç›´æ¥ä½¿ç”¨å³å¯ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">set</span> <span class="hljs-variable">@x</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥å°†å…¨å±€å˜é‡ä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> test(<span class="hljs-variable">@x</span>);<br></code></pre></td></tr></table></figure><p>é™¤äº†æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„å…¨éƒ¨å˜é‡ä»¥å¤–ï¼Œç³»ç»Ÿé»˜è®¤ä¹Ÿæœ‰å¾ˆå¤šçš„å˜é‡ï¼Œå› æ­¤æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„å˜é‡ç§°ä¸ºç”¨æˆ·å˜é‡ï¼Œç³»ç»Ÿé»˜è®¤å˜é‡ç§°ä¸ºç³»ç»Ÿå˜é‡ã€‚æŸ¥çœ‹ç³»ç»Ÿå˜é‡çš„å‘½ä»¤ä¸ºï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">show</span> <span class="hljs-keyword">GLOBAL</span> VARIABLES<br></code></pre></td></tr></table></figure><hr><h2 id="å­˜å‚¨è¿‡ç¨‹"><a href="#å­˜å‚¨è¿‡ç¨‹" class="headerlink" title="å­˜å‚¨è¿‡ç¨‹"></a>å­˜å‚¨è¿‡ç¨‹</h2><p>å­˜å‚¨è¿‡ç¨‹æ˜¯ä¸€ä¸ªåŒ…æ‹¬å¤šæ¡SQLè¯­å¥çš„é›†åˆï¼Œä¸“ç”¨äºç‰¹å®šè¡¨çš„ç‰¹å®šæ“ä½œï¼Œæ¯”å¦‚æˆ‘ä»¬ä¹‹å‰å®æˆ˜é¡¹ç›®ä¸­çš„åˆ›å»ºç”¨æˆ·ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦ä¸€æ¬¡æ€§ä¸ºä¸¤å¼ è¡¨æ·»åŠ æ•°æ®ï¼Œä½†æ˜¯å¦‚æœä¸ä½¿ç”¨Javaï¼Œè€Œæ˜¯æ¯æ¬¡éƒ½å»ä½¿ç”¨SQLå‘½ä»¤æ¥å®Œæˆï¼Œå°±éœ€è¦æ‰‹åŠ¨æ•²ä¸¤æ¬¡å‘½ä»¤ï¼Œéå¸¸éº»çƒ¦ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æå‰å°†è¿™äº›æ“ä½œå®šä¹‰å¥½ï¼Œé¢„ç•™å‡ºéœ€è¦å¡«å†™æ•°æ®çš„ä½ç½®ï¼Œä¸‹æ¬¡è¾“å…¥å‚æ•°ç›´æ¥è°ƒç”¨å³å¯ã€‚</p><p>è¿™é‡Œå¾ˆå®¹æ˜“ä¸å‡½æ•°ææ··æ·†ï¼Œå­˜å‚¨è¿‡ç¨‹ä¹Ÿæ˜¯æ‰§è¡Œå¤šæ¡SQLè¯­å¥ï¼Œä½†æ˜¯å®ƒä»¬çš„å‡ºå‘ç‚¹ä¸ä¸€æ ·ï¼Œå‡½æ•°æ˜¯ä¸“ç”¨äºè¿›è¡Œæ•°æ®å¤„ç†ï¼Œå¹¶å°†ç»“æœè¿”å›ç»™è°ƒç”¨è€…ï¼Œå®ƒæ›´å¤šæƒ…å†µä¸‹æ˜¯ä¸€æ¡SQLè¯­å¥çš„å‚ä¸è€…ï¼Œæ— æ³•ç›´æ¥è¿è¡Œï¼Œå¹¶ä¸”ä¸æ¶‰åŠæŸä¸ªç‰¹å®šè¡¨ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> student;<br></code></pre></td></tr></table></figure><p>è€Œå­˜å‚¨è¿‡ç¨‹æ˜¯å¤šæ¡SQLè¯­å¥çš„æ‰§è¡Œè€…ï¼Œè¿™æ˜¯å®ƒä»¬çš„æœ¬è´¨åŒºåˆ«ã€‚</p><p>å®šä¹‰å­˜å‚¨è¿‡ç¨‹ä¸å®šä¹‰å‡½æ•°æä¸ºç›¸ä¼¼ï¼Œå®ƒä¹Ÿå¯ä»¥åŒ…å«å‚æ•°ï¼Œå‡½æ•°ä¸­ä½¿ç”¨çš„è¯­å¥è¿™é‡Œä¹Ÿèƒ½ä½¿ç”¨ï¼Œä½†æ˜¯å®ƒæ²¡æœ‰è¿”å›å€¼ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> lbwnb(`name` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>), pwd <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>))<br><span class="hljs-keyword">BEGIN</span><br>  <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> users(username, `password`) <span class="hljs-keyword">VALUES</span>(`name`, pwd);<br><span class="hljs-keyword">END</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥åœ¨å­˜å‚¨è¿‡ç¨‹ä¸­ç¼–å†™å¤šæ¡SQLè¯­å¥ï¼Œä½†æ˜¯æ³¨æ„ï¼ŒMySQLçš„å­˜å‚¨è¿‡ç¨‹ä¸å…·æœ‰åŸå­æ€§ï¼Œå½“å‡ºç°é”™è¯¯æ—¶ï¼Œå¹¶ä¸ä¼šå›æ»šä¹‹å‰çš„æ“ä½œï¼Œå› æ­¤éœ€è¦æˆ‘ä»¬è‡ªå·±æ¥ç¼–å†™äº‹åŠ¡ä¿è¯åŸå­æ€§ã€‚</p><p>æ¥ç€æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CALL</span> lbwnb(<span class="hljs-string">&#x27;111&#x27;</span>, <span class="hljs-string">&#x27;2222&#x27;</span>)<br></code></pre></td></tr></table></figure><p>é€šè¿‡ä½¿ç”¨<code>call</code>æ¥æ‰§è¡Œä¸€ä¸ªå­˜å‚¨è¿‡ç¨‹ï¼Œå¦‚æœå­˜å‚¨è¿‡ç¨‹æœ‰å‚æ•°ï¼Œé‚£ä¹ˆè¿˜éœ€è¦å¡«å†™å‚æ•°ã€‚</p><p>æ¯”å¦‚ç°åœ¨æˆ‘ä»¬æƒ³è¦å®ç°æŸ¥è¯¢ç”¨æˆ·è¡¨ï¼Œå¦‚æœåŒ…å«ç”¨æˆ·<code>test</code>é‚£ä¹ˆå°±åˆ é™¤ç”¨æˆ·ï¼Œå¦‚æœä¸åŒ…å«ï¼Œå°±æ·»åŠ ç”¨æˆ·ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> `lbwnb`()<br><span class="hljs-keyword">BEGIN</span><br>IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span>(<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> username <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;test&#x27;</span>) <span class="hljs-keyword">THEN</span><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> users(username, `password`) <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">&#x27;test&#x27;</span>, <span class="hljs-string">&#x27;123456&#x27;</span>);<br><span class="hljs-keyword">ELSE</span><br><span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> username <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;test&#x27;</span>;<br><span class="hljs-keyword">END</span> IF;<br><span class="hljs-keyword">END</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œå…¶å®åªéœ€è¦ä¸€ä¸ªç®€å•çš„IFåˆ¤æ–­å³å¯å®ç°ã€‚</p><p>é‚£ä¹ˆå¦‚æœæˆ‘ä»¬å¸Œæœ›éå†ä¸€ä¸ªSELECTè¯­å¥æŸ¥è¯¢çš„ç»“æœå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¸¸æ ‡æ¥å®Œæˆï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">BEGIN</span><br><span class="hljs-keyword">DECLARE</span> id <span class="hljs-type">INT</span>;<br><span class="hljs-keyword">DECLARE</span> `name` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>);<br><span class="hljs-keyword">DECLARE</span> sex <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">5</span>);<br><span class="hljs-keyword">DECLARE</span> cur <span class="hljs-keyword">CURSOR</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> student;<br><span class="hljs-keyword">OPEN</span> cur;<br>WHILE <span class="hljs-literal">TRUE</span> DO<br><span class="hljs-keyword">FETCH</span> cur <span class="hljs-keyword">INTO</span> id, `name`, sex;<br><span class="hljs-keyword">SELECT</span> id, `name`, sex;<br><span class="hljs-keyword">END</span> WHILE;<br><span class="hljs-keyword">CLOSE</span> cur;<br><span class="hljs-keyword">END</span><br></code></pre></td></tr></table></figure><p>æ¸¸æ ‡çš„ä½¿ç”¨åˆ†ä¸º4ä¸ªæ­¥éª¤ï¼š</p><ul><li>DECLARE æ¸¸æ ‡åç§° CURSOR FOR æŸ¥è¯¢ç»“æœ   -  å®šä¹‰æ¸¸æ ‡</li><li>OPEN cur     -   å¼€å¯æ¸¸æ ‡</li><li>FETCH æ¸¸æ ‡åç§° INTO å­˜å‚¨ç»“æœçš„å˜é‡    -    ä»é¡¶éƒ¨å¼€å§‹ï¼Œæ¯æ‰§è¡Œä¸€æ¬¡ï¼Œå‘ä¸‹ç§»åŠ¨ï¼Œå¦‚æœå·²ç»åœ¨æœ€åº•éƒ¨ï¼Œåˆ™è§¦å‘å¼‚å¸¸</li><li>CLOSE cur    -   å…³é—­æ¸¸æ ‡</li></ul><p>æˆ‘ä»¬è¿™é‡Œåˆ©ç”¨äº†ä¸€ä¸ªwhileå¾ªç¯æ¥å¤šæ¬¡é€šè¿‡æ¸¸æ ‡è·å–æŸ¥è¯¢ç»“æœï¼Œä½†æ˜¯æœ€åæ˜¯å› ä¸ºå‡ºç°å¼‚å¸¸æ‰é€€å‡ºçš„ï¼Œè¿™æ ·ä¼šå¯¼è‡´ä¹‹åçš„ä»£ç å°±æ— æ³•ç»§ç»­æ­£å¸¸è¿è¡Œäº†ã€‚</p><p>æˆ‘ä»¬æ¥ç€æ¥çœ‹å¦‚ä½•å¤„ç†å¼‚å¸¸ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">BEGIN</span><br><span class="hljs-keyword">DECLARE</span> id <span class="hljs-type">INT</span>;<br><span class="hljs-keyword">DECLARE</span> `name` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>);<br><span class="hljs-keyword">DECLARE</span> sex <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">5</span>);<br><span class="hljs-keyword">DECLARE</span> score <span class="hljs-type">INT</span>;<br><span class="hljs-keyword">DECLARE</span> a <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>;<br><span class="hljs-keyword">DECLARE</span> cur <span class="hljs-keyword">CURSOR</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> student;<br><span class="hljs-comment">-- å¿…é¡»åœ¨æ¸¸æ ‡å®šä¹‰ä¹‹åç¼–å†™</span><br><span class="hljs-keyword">DECLARE</span> CONTINUE HANDLER <span class="hljs-keyword">FOR</span> <span class="hljs-number">1329</span> <span class="hljs-keyword">SET</span> a <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><span class="hljs-keyword">OPEN</span> cur;<br>WHILE a <span class="hljs-operator">=</span> <span class="hljs-number">0</span> DO<br><span class="hljs-keyword">FETCH</span> cur <span class="hljs-keyword">INTO</span> id, `name`, sex, score;<br><span class="hljs-keyword">SELECT</span> id, `name`, sex, score;<br><span class="hljs-keyword">END</span> WHILE;<br><span class="hljs-keyword">CLOSE</span> cur;<br><span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span>;<br><span class="hljs-keyword">END</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥å£°æ˜ä¸€ä¸ªå¼‚å¸¸å¤„ç†å™¨ï¼ˆå¥æŸ„ï¼‰ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><ul><li>declear (continue&#x2F;exit) handler for å¼‚å¸¸åç§°(ID) åšç‚¹ä»€ä¹ˆ</li></ul><p>æˆ‘ä»¬è¿˜å¯ä»¥é™å®šå­˜å‚¨è¿‡ç¨‹çš„å‚æ•°ä¼ é€’ï¼Œæ¯”å¦‚æˆ‘ä»¬åªå¸Œæœ›ç”¨æˆ·ç»™æˆ‘ä»¬ä¸€ä¸ªå‚æ•°ç”¨äºæ¥æ”¶æ•°æ®ï¼Œè€Œä¸æ˜¯å€¼ä¼ é€’ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶è®¾å®šä¸ºOUTç±»å‹ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> `lbwnb`(<span class="hljs-keyword">OUT</span> a <span class="hljs-type">INT</span>)<br><span class="hljs-keyword">BEGIN</span><br><span class="hljs-keyword">SELECT</span> a;<br><span class="hljs-keyword">SET</span> a <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;<br><span class="hljs-keyword">END</span><br></code></pre></td></tr></table></figure><p>æ‰€æœ‰çš„å‚æ•°é»˜è®¤ä¸º<code>IN</code>ç±»å‹ï¼Œä¹Ÿå°±æ˜¯åªèƒ½ä½œä¸ºä¼ å…¥å‚æ•°ï¼Œæ— æ³•ä¸ºå…¶èµ‹å€¼ï¼Œè€Œè¿™é‡Œè®²å‚æ•°è®¾å®šä¸º<code>OUT</code>ç±»å‹ï¼Œé‚£ä¹ˆå‚æ•°æ— æ³•å°†å€¼ä¼ å…¥ï¼Œè€Œåªèƒ½è¢«èµ‹å€¼ã€‚</p><p>å¦‚æœæˆ‘ä»¬æ—¢å¸Œæœ›å‚æ•°å¯ä»¥ä¼ å…¥ä¹Ÿå¯ä»¥è¢«é‡æ–°èµ‹å€¼ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶ä¿®æ”¹ä¸º<code>INOUT</code>ç±»å‹ã€‚</p><hr><h2 id="å­˜å‚¨å¼•æ“"><a href="#å­˜å‚¨å¼•æ“" class="headerlink" title="å­˜å‚¨å¼•æ“"></a>å­˜å‚¨å¼•æ“</h2><p>å­˜å‚¨å¼•æ“å°±åƒæˆ‘ä»¬ç”µè„‘ä¸­çš„CPUï¼Œå®ƒæ˜¯æ•´ä¸ªMySQLæœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œæ•°æ®åº“ä¸­çš„æ•°æ®å¦‚ä½•å­˜å‚¨ï¼Œæ•°æ®åº“èƒ½å¤Ÿæ”¯æŒå“ªäº›åŠŸèƒ½ï¼Œæˆ‘ä»¬çš„å¢åˆ æ”¹æŸ¥è¯·æ±‚å¦‚ä½•æ‰§è¡Œï¼Œéƒ½æ˜¯ç”±å­˜å‚¨å¼•æ“æ¥å†³å®šçš„ã€‚</p><p>æˆ‘ä»¬å¯ä»¥å¤§è‡´äº†è§£ä¸€ä¸‹ä»¥ä¸‹ä¸‰ç§å­˜å‚¨å¼•æ“ï¼š</p><ul><li><strong>MyISAMï¼š</strong> MySQL5.5ä¹‹å‰çš„é»˜è®¤å­˜å‚¨å¼•æ“ï¼Œåœ¨æ’å…¥å’ŒæŸ¥è¯¢çš„æƒ…å†µä¸‹æ€§èƒ½å¾ˆé«˜ï¼Œä½†æ˜¯å®ƒä¸æ”¯æŒäº‹åŠ¡ï¼Œåªèƒ½æ·»åŠ è¡¨çº§é”ã€‚</li><li><strong>InnoDBï¼š</strong> MySQL5.5ä¹‹åçš„é»˜è®¤å­˜å‚¨å¼•æ“ï¼Œå®ƒæ”¯æŒACIDäº‹åŠ¡ã€è¡Œçº§é”ã€å¤–é”®ï¼Œä½†æ˜¯æ€§èƒ½æ¯”ä¸è¿‡MyISAMï¼Œæ›´åŠ æ¶ˆè€—èµ„æºã€‚</li><li><strong>Memoryï¼š</strong> æ•°æ®éƒ½å­˜æ”¾åœ¨å†…å­˜ä¸­ï¼Œæ•°æ®åº“é‡å¯æˆ–å‘ç”Ÿå´©æºƒï¼Œè¡¨ä¸­çš„æ•°æ®éƒ½å°†æ¶ˆå¤±ã€‚</li></ul><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥æŸ¥çœ‹MySQLæ”¯æŒçš„å­˜å‚¨å¼•æ“ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">show</span> engines;<br></code></pre></td></tr></table></figure><p>åœ¨åˆ›å»ºè¡¨æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸ºè¡¨æŒ‡å®šå…¶å­˜å‚¨å¼•æ“ã€‚</p><p>æˆ‘ä»¬è¿˜å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹é»˜è®¤çš„å­˜å‚¨å¼•æ“ï¼Œåœ¨Windows 11ç³»ç»Ÿä¸‹ï¼ŒMySQLçš„é…ç½®æ–‡ä»¶é»˜è®¤æ”¾åœ¨<code>C:\ProgramData\MySQL\MySQL Server 5.7</code>ä¸­ï¼Œæ³¨æ„ProgramDataæ˜¯ä¸ªéšè—æ–‡ä»¶å¤¹ã€‚</p><hr><h2 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h2><p><strong>æ³¨æ„ï¼š</strong> æœ¬å°èŠ‚ä¼šæ¶‰åŠ<code>æ•°æ®ç»“æ„ä¸ç®—æ³•</code>ç›¸å…³çŸ¥è¯†ã€‚</p><p>ç´¢å¼•å°±å¥½åƒæˆ‘ä»¬ä¹¦çš„ç›®å½•ï¼Œæ¯æœ¬ä¹¦éƒ½æœ‰ä¸€ä¸ªç›®å½•ç”¨äºæˆ‘ä»¬å¿«é€Ÿå®šä½æˆ‘ä»¬æƒ³è¦çš„å†…å®¹åœ¨å“ªä¸€é¡µï¼Œç´¢å¼•ä¹Ÿæ˜¯ï¼Œé€šè¿‡å»ºç«‹ç´¢å¼•ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ ¹æ®ç´¢å¼•æ¥å¿«é€Ÿæ‰¾åˆ°æƒ³è¦çš„ä¸€æ¡è®°å½•ï¼Œå¤§å¤§æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</p><p>æœ¬ç‰ˆå—æˆ‘ä»¬ä¼šè¯¦ç»†ä»‹ç»ç´¢å¼•çš„å‡ ç§ç±»å‹ï¼Œä»¥åŠç´¢å¼•çš„åº•å±‚å­˜å‚¨åŸç†ã€‚</p><h3 id="å•åˆ—ç´¢å¼•"><a href="#å•åˆ—ç´¢å¼•" class="headerlink" title="å•åˆ—ç´¢å¼•"></a>å•åˆ—ç´¢å¼•</h3><p>å•åˆ—ç´¢å¼•åªé’ˆå¯¹äºæŸä¸€åˆ—æ•°æ®åˆ›å»ºç´¢å¼•ï¼Œå•åˆ—ç´¢å¼•æœ‰ä»¥ä¸‹å‡ ç§ç±»å‹ï¼š</p><ul><li><strong>NORMALï¼š</strong> æ™®é€šçš„ç´¢å¼•ç±»å‹ï¼Œå®Œå®Œå…¨å…¨ç›¸å½“äºä¸€æœ¬ä¹¦çš„ç›®å½•ã€‚</li><li><strong>UNIQUEï¼š</strong> å”¯ä¸€ç´¢å¼•ï¼Œæˆ‘ä»¬ä¹‹å‰å·²ç»ç”¨è¿‡äº†ï¼Œä¸€æ—¦å»ºç«‹å”¯ä¸€ç´¢å¼•ï¼Œé‚£ä¹ˆæ•´ä¸ªåˆ—ä¸­å°†ä¸å…è®¸å‡ºç°é‡å¤æ•°æ®ã€‚æ¯ä¸ªè¡¨çš„ä¸»é”®åˆ—ï¼Œéƒ½æœ‰ä¸€ä¸ªç‰¹æ®Šçš„å”¯ä¸€ç´¢å¼•ï¼Œå«åšPrimary Keyï¼Œå®ƒä¸ä»…ä»…è¦æ±‚ä¸å…è®¸å‡ºç°é‡å¤ï¼Œè¿˜è¦æ±‚ä¸èƒ½ä¸ºNULLï¼Œå®ƒè¿˜å¯ä»¥è‡ªåŠ¨é€’å¢ã€‚æ¯å¼ è¡¨å¯ä»¥æœ‰å¤šä¸ªå”¯ä¸€ç´¢å¼•ï¼Œä½†æ˜¯åªèƒ½æœ‰ä¸€ä¸ªPrimaryç´¢å¼•ã€‚</li><li><strong>SPATIALï¼š</strong> ç©ºé—´ç´¢å¼•ï¼Œç©ºé—´ç´¢å¼•æ˜¯å¯¹ç©ºé—´æ•°æ®ç±»å‹çš„å­—æ®µå»ºç«‹çš„ç´¢å¼•ï¼ŒMYSQLä¸­çš„ç©ºé—´æ•°æ®ç±»å‹æœ‰4ç§ï¼Œåˆ†åˆ«æ˜¯GEOMETRYã€POINTã€LINESTRINGã€POLYGONï¼Œä¸æ˜¯å¾ˆå¸¸ç”¨ï¼Œè¿™é‡Œä¸åšä»‹ç»ã€‚</li><li><strong>FULLTEXTï¼š</strong> å…¨æ–‡ç´¢å¼•ï¼ˆMySQL 5.6 ä¹‹åInnoDBæ‰æ”¯æŒï¼‰ï¼Œå®ƒæ˜¯æ¨¡ç³ŠåŒ¹é…çš„ä¸€ç§æ›´å¥½çš„è§£å†³æ–¹æ¡ˆï¼Œå®ƒçš„æ•ˆç‡è¦æ¯”ä½¿ç”¨<code>like %</code>æ›´é«˜ï¼Œå¹¶ä¸”å®ƒè¿˜æ”¯æŒå¤šç§åŒ¹é…æ–¹å¼ï¼Œçµæ´»æ€§ä¹Ÿæ›´åŠ å¼ºå¤§ã€‚åªæœ‰å­—æ®µçš„æ•°æ®ç±»å‹ä¸º charã€varcharã€text åŠå…¶ç³»åˆ—æ‰å¯ä»¥å»ºå…¨æ–‡ç´¢å¼•ã€‚</li></ul><p>æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨å…¨æ–‡ç´¢å¼•ï¼Œé¦–å…ˆåˆ›å»ºä¸€å¼ ç”¨äºæµ‹è¯•å…¨æ–‡ç´¢å¼•çš„è¡¨ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> articles (<br>  id <span class="hljs-type">INT</span> UNSIGNED AUTO_INCREMENT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">PRIMARY</span> KEY,<br>  title <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">200</span>),<br>  body TEXT,<br>  FULLTEXT (body));<br></code></pre></td></tr></table></figure><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> articles <span class="hljs-keyword">VALUES</span><br>(<span class="hljs-keyword">NULL</span>,<span class="hljs-string">&#x27;MySQL Tutorial&#x27;</span>, <span class="hljs-string">&#x27;DBMS stands for DataBase ...&#x27;</span>),<br>(<span class="hljs-keyword">NULL</span>,<span class="hljs-string">&#x27;How To Use MySQL Efficiently&#x27;</span>, <span class="hljs-string">&#x27;After you went through a ...&#x27;</span>),<br>(<span class="hljs-keyword">NULL</span>,<span class="hljs-string">&#x27;Optimising MySQL&#x27;</span>,<span class="hljs-string">&#x27;In this tutorial we will show ...&#x27;</span>),<br>(<span class="hljs-keyword">NULL</span>,<span class="hljs-string">&#x27;1001 MySQL Tricks&#x27;</span>,<span class="hljs-string">&#x27;1. Never run mysqld as root. 2. ...&#x27;</span>),<br>(<span class="hljs-keyword">NULL</span>,<span class="hljs-string">&#x27;MySQL vs. YourSQL&#x27;</span>, <span class="hljs-string">&#x27;In the following database comparison ...&#x27;</span>),<br>(<span class="hljs-keyword">NULL</span>,<span class="hljs-string">&#x27;MySQL Security&#x27;</span>, <span class="hljs-string">&#x27;When configured properly, MySQL ...&#x27;</span>);<br></code></pre></td></tr></table></figure><p>æœ€åæˆ‘ä»¬ä½¿ç”¨å…¨æ–‡ç´¢å¼•è¿›è¡Œæ¨¡ç³ŠåŒ¹é…ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> articles <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">MATCH</span> (body) AGAINST (<span class="hljs-string">&#x27;database&#x27;</span>);<br></code></pre></td></tr></table></figure><p>æ³¨æ„å…¨æ–‡ç´¢å¼•å¦‚ä½•å®šä¹‰å­—æ®µçš„ï¼Œmatchä¸­å°±å¿…é¡»æ˜¯å“ªäº›å­—æ®µï¼Œagainstä¸­å®šä¹‰éœ€è¦æ¨¡ç³ŠåŒ¹é…çš„å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬ç”¨ä½œæŸ¥æ‰¾çš„å­—ç¬¦ä¸²å®é™…ä¸Šæ˜¯è¢«åˆ†è¯ä¹‹åçš„ç»“æœï¼Œå¦‚æœè¿›è¡Œæ¨¡ç³ŠåŒ¹é…çš„ä¸æ˜¯ä¸€ä¸ªè¯è¯­ï¼Œé‚£ä¹ˆä¼šæŸ¥æ‰¾å¤±è´¥ï¼Œä½†æ˜¯å®ƒçš„æ•ˆç‡è¿œé«˜äºä»¥ä¸‹è¿™ç§å†™æ³•ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> articles <span class="hljs-keyword">WHERE</span> body <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;%database%&#x27;</span>;<br></code></pre></td></tr></table></figure><h3 id="ç»„åˆç´¢å¼•"><a href="#ç»„åˆç´¢å¼•" class="headerlink" title="ç»„åˆç´¢å¼•"></a>ç»„åˆç´¢å¼•</h3><p>ç»„åˆç´¢å¼•å®é™…ä¸Šå°±æ˜¯å°†å¤šè¡Œæ†ç»‘åœ¨ä¸€èµ·ï¼Œä½œä¸ºä¸€ä¸ªç´¢å¼•ï¼Œå®ƒåŒæ ·æ”¯æŒä»¥ä¸Šå‡ ç§ç´¢å¼•ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Navicatä¸­è¿›è¡Œæ¼”ç¤ºã€‚</p><p>æ³¨æ„ç»„åˆç´¢å¼•åœ¨è¿›è¡ŒåŒ¹é…æ—¶ï¼Œéµå¾ªæœ€å·¦åŸåˆ™ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>explain</code>è¯­å¥ï¼ˆå®ƒå¯ä»¥ç”¨äºåˆ†æselectè¯­å¥çš„æ‰§è¡Œè®¡åˆ’ï¼Œä¹Ÿå°±æ˜¯MySQLåˆ°åº•æ˜¯å¦‚ä½•åœ¨æ‰§è¡ŒæŸæ¡selectè¯­å¥çš„ï¼‰æ¥åˆ†ææŸ¥è¯¢è¯­å¥åˆ°åº•æœ‰æ²¡æœ‰é€šè¿‡ç´¢å¼•è¿›è¡ŒåŒ¹é…ã€‚</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> student <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;å°ç‹&#x27;</span>;<br></code></pre></td></tr></table></figure><p>å¾—åˆ°çš„ç»“æœå¦‚ä¸‹ï¼š</p><ul><li>select_typeï¼šæŸ¥è¯¢ç±»å‹ï¼Œä¸Šé¢çš„å°±æ˜¯ç®€å•æŸ¥è¯¢ï¼ˆSIMPLEï¼‰</li><li>tableï¼šæŸ¥è¯¢çš„è¡¨</li><li>typeï¼šMySQLå†³å®šå¦‚ä½•æŸ¥æ‰¾å¯¹åº”çš„è®°å½•ï¼Œæ•ˆç‡ä»é«˜åˆ°ä½ï¼šsystem &gt; const &gt; eq_ref &gt; ref &gt; range &gt; index &gt; all</li><li>possible_keysï¼šæ‰§è¡ŒæŸ¥è¯¢æ—¶å¯èƒ½ä¼šç”¨åˆ°çš„ç´¢å¼•</li><li>keyï¼šå®é™…ä½¿ç”¨çš„ç´¢å¼•</li><li>key_lenï¼šMysqlåœ¨ç´¢å¼•é‡Œä½¿ç”¨çš„å­—èŠ‚æ•°ï¼Œå­—æ®µçš„æœ€å¤§å¯èƒ½é•¿åº¦</li><li>rowsï¼šæ‰«æçš„è¡Œæ•°</li><li>extraï¼šé™„åŠ è¯´æ˜</li></ul><h3 id="ç´¢å¼•åº•å±‚åŸç†"><a href="#ç´¢å¼•åº•å±‚åŸç†" class="headerlink" title="ç´¢å¼•åº•å±‚åŸç†"></a>ç´¢å¼•åº•å±‚åŸç†</h3><p>åœ¨äº†è§£å®Œäº†ç´¢å¼•çš„ç±»å‹ä¹‹åï¼Œæˆ‘ä»¬æ¥ç€æ¥çœ‹çœ‹ç´¢å¼•æ˜¯å¦‚ä½•å®ç°çš„ã€‚</p><p>æ—¢ç„¶æˆ‘ä»¬è¦é€šè¿‡ç´¢å¼•æ¥å¿«é€ŸæŸ¥æ‰¾å†…å®¹ï¼Œé‚£ä¹ˆå¦‚ä½•è®¾è®¡ç´¢å¼•å°±æ˜¯æˆ‘ä»¬çš„é‡ç‚¹å†…å®¹ï¼Œå› ä¸ºç´¢å¼•æ˜¯å­˜å‚¨åœ¨ç¡¬ç›˜ä¸Šçš„ï¼Œè·Ÿæˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„HashMapä¹‹ç±»çš„ä¸åŒï¼Œå®ƒä»¬éƒ½æ˜¯åœ¨å†…å­˜ä¸­çš„ï¼Œä½†æ˜¯ç¡¬ç›˜çš„è¯»å–é€Ÿåº¦è¿œå°äºå†…å­˜çš„é€Ÿåº¦ï¼Œæ¯ä¸€æ¬¡IOæ“ä½œéƒ½ä¼šè€—è´¹å¤§é‡çš„æ—¶é—´ï¼Œæˆ‘ä»¬ä¹Ÿä¸å¯èƒ½æŠŠæ•´ä¸ªç£ç›˜ä¸Šçš„ç´¢å¼•å…¨éƒ¨å¯¼å…¥å†…å­˜ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦è€ƒè™‘å°½å¯èƒ½å¤šçš„å‡å°‘IOæ¬¡æ•°ï¼Œç´¢å¼•çš„å®ç°å¯ä»¥ä¾é ä¸¤ç§æ•°æ®ç»“æ„ï¼Œä¸€ç§æ˜¯æˆ‘ä»¬åœ¨JavaSEé˜¶æ®µå·²ç»å­¦ä¹ è¿‡çš„Hashè¡¨ï¼Œè¿˜æœ‰ä¸€ç§å°±æ˜¯B-Treeã€‚</p><p>æˆ‘ä»¬é¦–å…ˆæ¥çœ‹çœ‹å“ˆå¸Œè¡¨ï¼Œå®é™…ä¸Šå°±æ˜¯è®¡ç®—Hashå€¼æ¥å¿«é€Ÿå®šä½ï¼š</p><p><img src="RLDXtxjmAhP5ZGY.jpg" alt="ç‚¹å‡»æŸ¥çœ‹æºç½‘é¡µ"></p><p>é€šè¿‡å¯¹Keyè¿›è¡Œæ•£åˆ—å€¼è®¡ç®—ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å¾—åˆ°å¯¹åº”æ•°æ®çš„å­˜æ”¾ä½ç½®ï¼Œå®ƒçš„æŸ¥è¯¢æ•ˆç‡èƒ½å¤Ÿè¾¾åˆ°O(1)ï¼Œä½†æ˜¯å®ƒä¹Ÿå­˜åœ¨ä¸€å®šçš„ç¼ºé™·ï¼š</p><ul><li>Hashç´¢å¼•ä»…ä»…èƒ½æ»¡è¶³â€œ&#x3D;â€ï¼Œâ€œinâ€æŸ¥è¯¢æ¡ä»¶ï¼Œä¸èƒ½ä½¿ç”¨èŒƒå›´æŸ¥è¯¢ã€‚</li><li>Hashç¢°æ’é—®é¢˜ã€‚</li><li>ä¸èƒ½ç”¨éƒ¨åˆ†ç´¢å¼•é”®æ¥æœç´¢ï¼Œå› ä¸ºç»„åˆç´¢å¼•åœ¨è®¡ç®—å“ˆå¸Œå€¼çš„æ—¶å€™æ˜¯ä¸€èµ·è®¡ç®—çš„ã€‚</li></ul><p>é‚£ä¹ˆï¼Œæ—¢ç„¶è¦è§£å†³è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬è¿˜æœ‰ä¸€ç§æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨ç±»ä¼¼äºäºŒå‰æ ‘é‚£æ ·çš„æ•°æ®ç»“æ„æ¥å­˜å‚¨ç´¢å¼•ï¼Œä½†æ˜¯è¿™æ ·ç›¸æ¯”ä½¿ç”¨Hashç´¢å¼•ï¼Œä¼šç‰ºç‰²ä¸€å®šçš„è¯»å–é€Ÿåº¦ã€‚</p><p>ä½†æ˜¯è¿™é‡Œå¹¶æ²¡æœ‰ä½¿ç”¨äºŒå‰æ ‘ï¼Œè€Œæ˜¯ä½¿ç”¨äº†BTreeï¼Œå®ƒæ˜¯ä¸“é—¨ä¸ºç£ç›˜æ•°æ®è¯»å–è®¾è®¡çš„ä¸€ç§åº¦ä¸ºnçš„æŸ¥æ‰¾æ ‘ï¼š</p><ul><li>æ ‘ä¸­æ¯ä¸ªç»“ç‚¹æœ€å¤šå«æœ‰mä¸ªå­©å­ï¼ˆm &gt;&#x3D; 2ï¼‰</li><li>é™¤æ ¹ç»“ç‚¹å’Œå¶å­ç»“ç‚¹å¤–ï¼Œå…¶å®ƒæ¯ä¸ªç»“ç‚¹è‡³å°‘æœ‰[ceil(m &#x2F; 2)]ä¸ªå­©å­ã€‚</li><li>è‹¥æ ¹ç»“ç‚¹ä¸æ˜¯å¶å­ç»“ç‚¹ï¼Œåˆ™è‡³å°‘æœ‰2ä¸ªå­©å­ã€‚</li><li>æ‰€æœ‰å¶å­ç»“ç‚¹éƒ½å‡ºç°åœ¨åŒä¸€å±‚ã€‚</li><li>æ¯ä¸ªéç»ˆç«¯ç»“ç‚¹ä¸­åŒ…å«æœ‰nä¸ªé”®å€¼ä¿¡æ¯ï¼š (P1ï¼ŒK1ï¼ŒP2ï¼ŒK2ï¼ŒP3ï¼Œâ€¦â€¦ï¼ŒKnï¼ŒPn+1)ã€‚å…¶ä¸­ï¼š<ol><li>Ki (i&#x3D;1â€¦n)ä¸ºé”®å€¼ï¼Œä¸”é”®å€¼æŒ‰é¡ºåºå‡åºæ’åºK(i-1)&lt; Kiã€‚</li><li>Piä¸ºæŒ‡å‘å­æ ‘æ ¹çš„ç»“ç‚¹ï¼Œä¸”æŒ‡é’ˆP(i)æŒ‡å‘çš„å­æ ‘ä¸­æ‰€æœ‰ç»“ç‚¹çš„é”®å€¼å‡å°äºKiï¼Œä½†éƒ½å¤§äºK(i-1)ã€‚</li><li>é”®å€¼çš„ä¸ªæ•°nå¿…é¡»æ»¡è¶³ï¼š [ceil(m &#x2F; 2)-1] &lt;&#x3D; n &lt;&#x3D; m-1ã€‚</li></ol></li></ul><p><img src="9o2vKsAf1pdSRQh.jpg" alt="img"></p><p>æ¯”å¦‚ç°åœ¨æˆ‘ä»¬è¦å¯¹é”®å€¼ä¸º<strong>10</strong>çš„è®°å½•è¿›è¡ŒæŸ¥æ‰¾ï¼Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li>è¯»å–æ ¹èŠ‚ç‚¹æ•°æ®ï¼ˆç›®å‰è¿›è¡Œäº†ä¸€æ¬¡IOæ“ä½œï¼‰</li><li>æ ¹æ®æ ¹èŠ‚ç‚¹æ•°æ®è¿›è¡Œåˆ¤æ–­å¾—åˆ°10&lt;17ï¼Œå› ä¸ºP1æŒ‡å‘çš„å­æ ‘ä¸­æ‰€æœ‰å€¼éƒ½æ˜¯å°äº17çš„ï¼Œæ‰€ä»¥è¿™æ—¶æˆ‘ä»¬å°†P1æŒ‡å‘çš„èŠ‚ç‚¹è¯»å–ï¼ˆç›®å‰è¿›è¡Œäº†ä¸¤æ¬¡IOæ“ä½œï¼‰</li><li>å†æ¬¡è¿›è¡Œåˆ¤æ–­ï¼Œå¾—åˆ°8&lt;10&lt;12ï¼Œå› ä¸ºP2æŒ‡å‘çš„å­æ ‘ä¸­æ‰€æœ‰çš„å€¼éƒ½æ˜¯å°äº12å¤§äº8çš„ï¼Œæ‰€ä»¥è¿™æ—¶è¯»å–P2æŒ‡å‘çš„èŠ‚ç‚¹ï¼ˆç›®å‰è¿›è¡Œäº†ä¸‰æ¬¡IOæ“ä½œï¼‰</li><li>æˆåŠŸæ‰¾åˆ°ã€‚</li></ol><p>æˆ‘ä»¬æ¥ç€æ¥çœ‹ï¼Œè™½ç„¶BTreeèƒ½å¤Ÿå¾ˆå¥½åœ°åˆ©ç”¨äºŒå‰æŸ¥æ‰¾æ ‘çš„æ€æƒ³å¤§å¹…åº¦å‡å°‘æŸ¥æ‰¾æ¬¡æ•°ï¼Œä½†æ˜¯å®ƒçš„æŸ¥æ‰¾æ•ˆç‡è¿˜æ˜¯å¾ˆä½ï¼Œå› æ­¤å®ƒçš„ä¼˜åŒ–ç‰ˆæœ¬B+Treeè¯ç”Ÿäº†ï¼Œå®ƒæ‹¥æœ‰æ›´ç¨³å®šçš„æŸ¥è¯¢æ•ˆç‡å’Œæ›´ä½çš„IOè¯»å–æ¬¡æ•°ï¼š</p><p><img src="AmeW1GO8SpMjwPt.jpg" alt="img"></p><p>æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå®ƒå’ŒBTreeæœ‰ä¸€å®šçš„åŒºåˆ«ï¼š</p><ul><li>æœ‰næ£µå­æ ‘çš„ç»“ç‚¹ä¸­å«æœ‰nä¸ªé”®å€¼ï¼ŒBTreeåªæœ‰n-1ä¸ªã€‚</li><li>æ‰€æœ‰çš„é”®å€¼ä¿¡æ¯åªåœ¨å¶å­èŠ‚ç‚¹ä¸­åŒ…å«ï¼Œéå¶å­èŠ‚ç‚¹ä»…ä»…ä¿å­˜å­èŠ‚ç‚¹çš„æœ€å°ï¼ˆæˆ–æœ€å¤§ï¼‰å€¼ï¼Œå’ŒæŒ‡å‘å¶å­èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œè¿™æ ·ç›¸æ¯”BTreeæ¯ä¸€ä¸ªèŠ‚ç‚¹åœ¨ç¡¬ç›˜ä¸­å­˜æ”¾äº†æ›´å°‘çš„å†…å®¹ï¼ˆæ²¡æœ‰é”®å€¼ä¿¡æ¯äº†ï¼‰</li><li>æ‰€æœ‰å¶å­èŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªæ ¹æ®å¤§å°é¡ºåºæŒ‡å‘ä¸‹ä¸€ä¸ªå¶å­èŠ‚ç‚¹çš„æŒ‡é’ˆQï¼Œæœ¬è´¨ä¸Šæ•°æ®å°±æ˜¯ä¸€ä¸ªé“¾è¡¨ã€‚</li></ul><p>è¿™æ ·ï¼Œè¯»å–IOçš„æ—¶é—´ç›¸æ¯”BTreeå°±å‡å°‘äº†å¾ˆå¤šï¼Œå¹¶ä¸”æŸ¥è¯¢ä»»ä½•é”®å€¼ä¿¡æ¯éƒ½éœ€è¦å®Œæ•´åœ°èµ°åˆ°å¶å­èŠ‚ç‚¹ï¼Œä¿è¯äº†æŸ¥è¯¢çš„IOè¯»å–æ¬¡æ•°ä¸€è‡´ã€‚å› æ­¤MySQLé»˜è®¤é€‰æ‹©B+Treeä½œä¸ºç´¢å¼•çš„å­˜å‚¨æ•°æ®ç»“æ„ã€‚</p><p>è¿™æ˜¯MyISAMå­˜å‚¨å¼•æ“ä¸‹çš„B+Treeå®ç°ï¼š</p><p><img src="q346VZgTy9EO5HF.jpg" alt="img"></p><p>è¿™æ˜¯InnoDBå­˜å‚¨å¼•æ“ä¸‹çš„B+Treeå®ç°ï¼š</p><p><img src="p6BTltjD7YE1K9s.jpg" alt="img"></p><p><img src="Jpi1nPND3Wa4bHc.jpg" alt="img"></p><p>InnoDBä¸MyISAMå®ç°çš„ä¸åŒä¹‹å¤„ï¼š</p><ul><li>æ•°æ®æœ¬èº«å°±æ˜¯ç´¢å¼•çš„ä¸€éƒ¨åˆ†ï¼ˆæ‰€ä»¥è¿™é‡Œå»ºè®®ä¸»é”®ä½¿ç”¨è‡ªå¢ï¼‰</li><li>éä¸»é”®ç´¢å¼•çš„æ•°æ®å®é™…ä¸Šå­˜å‚¨çš„æ˜¯å¯¹åº”è®°å½•çš„ä¸»é”®å€¼ï¼ˆå› æ­¤InnoDBå¿…é¡»æœ‰ä¸»é”®ï¼Œè‹¥æ²¡æœ‰ä¹Ÿä¼šè‡ªåŠ¨æŸ¥æ‰¾æ›¿ä»£ï¼‰</li></ul><hr><h2 id="é”æœºåˆ¶"><a href="#é”æœºåˆ¶" class="headerlink" title="é”æœºåˆ¶"></a>é”æœºåˆ¶</h2><p>åœ¨JavaSEçš„å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬åœ¨å¤šçº¿ç¨‹æ¿å—é¦–æ¬¡ç”¨åˆ°äº†é”æœºåˆ¶ï¼Œå½“æˆ‘ä»¬å¯¹æŸä¸ªæ–¹æ³•æˆ–æ˜¯æŸä¸ªä»£ç å—åŠ é”åï¼Œé™¤éé”çš„æŒæœ‰è€…é‡Šæ”¾å½“å‰çš„é”ï¼Œå¦åˆ™å…¶ä»–çº¿ç¨‹æ— æ³•è¿›å…¥æ­¤æ–¹æ³•æˆ–æ˜¯ä»£ç å—ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨é”æœºåˆ¶æ¥ä¿è¯å¤šçº¿ç¨‹ä¹‹é—´çš„å®‰å…¨æ€§ã€‚</p><p>åœ¨MySQLä¸­ï¼Œå°±å¾ˆå®¹æ˜“å‡ºç°å¤šçº¿ç¨‹åŒæ—¶æ“ä½œè¡¨ä¸­æ•°æ®çš„æƒ…å†µï¼Œå¦‚æœè¦é¿å…æ½œåœ¨çš„å¹¶å‘é—®é¢˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¹‹å‰è®²è§£çš„äº‹åŠ¡éš”ç¦»çº§åˆ«æ¥å¤„ç†ï¼Œè€Œäº‹åŠ¡éš”ç¦»ä¸­åˆ©ç”¨äº†é”æœºåˆ¶ã€‚</p><ul><li>è¯»æœªæäº¤(Read Uncommitted)ï¼šèƒ½å¤Ÿè¯»å–åˆ°å…¶ä»–äº‹åŠ¡ä¸­æœªæäº¤çš„å†…å®¹ï¼Œå­˜åœ¨è„è¯»é—®é¢˜ã€‚</li><li>è¯»å·²æäº¤(Read Committed RC)ï¼šåªèƒ½è¯»å–å…¶ä»–äº‹åŠ¡å·²ç»æäº¤çš„å†…å®¹ï¼Œå­˜åœ¨ä¸å¯é‡å¤è¯»é—®é¢˜ã€‚</li><li>å¯é‡å¤è¯»(Repeated Read RR)ï¼šåœ¨è¯»å–æŸè¡Œåä¸å…è®¸å…¶ä»–äº‹åŠ¡æ“ä½œæ­¤è¡Œï¼Œç›´åˆ°äº‹åŠ¡ç»“æŸï¼Œä½†æ˜¯ä¾ç„¶å­˜åœ¨å¹»è¯»é—®é¢˜ã€‚</li><li>ä¸²è¡Œè¯»(Serializable)ï¼šä¸€ä¸ªäº‹åŠ¡çš„å¼€å§‹å¿…é¡»ç­‰å¾…å¦ä¸€ä¸ªäº‹åŠ¡çš„å®Œæˆã€‚</li></ul><p>æˆ‘ä»¬å¯ä»¥åˆ‡æ¢éš”ç¦»çº§åˆ«åˆ†åˆ«æ¼”ç¤ºä¸€ä¸‹ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">set</span> session transaction isolation level read uncommitted;<br></code></pre></td></tr></table></figure><p>åœ¨RRçº§åˆ«ä¸‹ï¼ŒMySQLåœ¨ä¸€å®šç¨‹åº¦ä¸Šè§£å†³äº†å¹»è¯»é—®é¢˜ï¼š</p><ul><li>åœ¨å¿«ç…§è¯»ï¼ˆä¸åŠ é”ï¼‰è¯»æƒ…å†µä¸‹ï¼Œmysqlé€šè¿‡mvccæ¥é¿å…å¹»è¯»ã€‚</li><li>åœ¨å½“å‰è¯»ï¼ˆåŠ é”ï¼‰è¯»æƒ…å†µä¸‹ï¼Œmysqlé€šè¿‡next-keyæ¥é¿å…å¹»è¯»ã€‚</li></ul><blockquote><p>**<code>MVCC</code>**ï¼Œå…¨ç§° <code>Multi-Version Concurrency Control</code> ï¼Œå³å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ã€‚MVCC æ˜¯ä¸€ç§å¹¶å‘æ§åˆ¶çš„æ–¹æ³•ï¼Œä¸€èˆ¬åœ¨æ•°æ®åº“ç®¡ç†ç³»ç»Ÿä¸­ï¼Œå®ç°å¯¹æ•°æ®åº“çš„å¹¶å‘è®¿é—®ï¼Œåœ¨ç¼–ç¨‹è¯­è¨€ä¸­å®ç°äº‹åŠ¡å†…å­˜ã€‚</p></blockquote><h3 id="è¯»é”å’Œå†™é”"><a href="#è¯»é”å’Œå†™é”" class="headerlink" title="è¯»é”å’Œå†™é”"></a>è¯»é”å’Œå†™é”</h3><p>ä»å¯¹æ•°æ®çš„æ“ä½œç±»å‹ä¸Šæ¥è¯´ï¼Œé”åˆ†ä¸ºè¯»é”å’Œå†™é”ï¼š</p><ul><li><strong>è¯»é”ï¼š</strong> ä¹Ÿå«å…±äº«é”ï¼Œå½“ä¸€ä¸ªäº‹åŠ¡æ·»åŠ äº†è¯»é”åï¼Œå…¶ä»–çš„äº‹åŠ¡ä¹Ÿå¯ä»¥æ·»åŠ è¯»é”æˆ–æ˜¯è¯»å–æ•°æ®ï¼Œä½†æ˜¯ä¸èƒ½è¿›è¡Œå†™æ“ä½œï¼Œåªèƒ½ç­‰åˆ°æ‰€æœ‰çš„è¯»é”å…¨éƒ¨é‡Šæ”¾ã€‚</li><li><strong>å†™é”ï¼š</strong> ä¹Ÿå«æ’ä»–é”ï¼Œå½“ä¸€ä¸ªäº‹åŠ¡æ·»åŠ äº†å†™é”åï¼Œå…¶ä»–äº‹åŠ¡ä¸èƒ½è¯»ä¸èƒ½å†™ä¹Ÿä¸èƒ½æ·»åŠ ä»»ä½•é”ï¼Œåªèƒ½ç­‰å¾…å½“å‰äº‹åŠ¡é‡Šæ”¾é”ã€‚</li></ul><h3 id="å…¨å±€é”ã€è¡¨é”å’Œè¡Œé”"><a href="#å…¨å±€é”ã€è¡¨é”å’Œè¡Œé”" class="headerlink" title="å…¨å±€é”ã€è¡¨é”å’Œè¡Œé”"></a>å…¨å±€é”ã€è¡¨é”å’Œè¡Œé”</h3><p>ä»é”çš„ä½œç”¨èŒƒå›´ä¸Šåˆ’åˆ†ï¼Œåˆ†ä¸ºå…¨å±€é”ã€è¡¨é”å’Œè¡Œé”ï¼š</p><ul><li><strong>å…¨å±€é”ï¼š</strong> é”ä½œç”¨äºå…¨å±€ï¼Œæ•´ä¸ªæ•°æ®åº“çš„æ‰€æœ‰æ“ä½œå…¨éƒ¨å—åˆ°é”é™åˆ¶ã€‚</li><li><strong>è¡¨é”ï¼š</strong> é”ä½œç”¨äºæ•´ä¸ªè¡¨ï¼Œæ‰€æœ‰å¯¹è¡¨çš„æ“ä½œéƒ½ä¼šæ”¶åˆ°é”é™åˆ¶ã€‚</li><li><strong>è¡Œé”ï¼š</strong> é”ä½œç”¨äºè¡¨ä¸­çš„æŸä¸€è¡Œï¼Œåªä¼šé€šè¿‡é”é™åˆ¶å¯¹æŸä¸€è¡Œçš„æ“ä½œï¼ˆä»…InnoDBæ”¯æŒï¼‰</li></ul><h4 id="å…¨å±€é”"><a href="#å…¨å±€é”" class="headerlink" title="å…¨å±€é”"></a>å…¨å±€é”</h4><p>æˆ‘ä»¬é¦–å…ˆæ¥çœ‹å…¨å±€é”ï¼Œå®ƒä½œç”¨äºæ•´ä¸ªæ•°æ®åº“ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥å¼€å¯è¯»å…¨å±€é”ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">flush tables <span class="hljs-keyword">with</span> read lock;<br></code></pre></td></tr></table></figure><p>å¼€å¯åï¼Œæ•´ä¸ªæ•°æ®åº“è¢«ä¸Šè¯»é”ï¼Œæˆ‘ä»¬åªèƒ½å»è¯»å–æ•°æ®ï¼Œä½†æ˜¯ä¸å…è®¸è¿›è¡Œå†™æ“ä½œï¼ˆåŒ…æ‹¬æ›´æ–°ã€æ’å…¥ã€åˆ é™¤ç­‰ï¼‰ä¸€æ—¦æ‰§è¡Œå†™æ“ä½œï¼Œä¼šè¢«é˜»å¡ï¼Œç›´åˆ°é”è¢«é‡Šæ”¾ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥è§£é”ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">unlock tables;<br></code></pre></td></tr></table></figure><p>é™¤äº†æ‰‹åŠ¨é‡Šæ”¾é”ä¹‹å¤–ï¼Œå½“æˆ‘ä»¬çš„ä¼šè¯ç»“æŸåï¼Œé”ä¹Ÿä¼šè¢«è‡ªåŠ¨é‡Šæ”¾ã€‚</p><h4 id="è¡¨é”"><a href="#è¡¨é”" class="headerlink" title="è¡¨é”"></a>è¡¨é”</h4><p>è¡¨é”ä½œç”¨äºæŸä¸€å¼ è¡¨ï¼Œä¹Ÿæ˜¯MyISAMå’ŒInnoDBå­˜å‚¨å¼•æ“æ”¯æŒçš„æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥ä¸ºè¡¨æ·»åŠ é”ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">lock <span class="hljs-keyword">table</span> è¡¨åç§° read<span class="hljs-operator">/</span>write;<br></code></pre></td></tr></table></figure><p>åœ¨æˆ‘ä»¬ä¸ºè¡¨æ·»åŠ å†™é”åï¼Œæˆ‘ä»¬å‘ç°å…¶ä»–åœ°æ–¹æ˜¯æ— æ³•è®¿é—®æ­¤è¡¨çš„ï¼Œä¸€å¾‹éƒ½è¢«é˜»å¡ã€‚</p><h4 id="è¡Œé”"><a href="#è¡Œé”" class="headerlink" title="è¡Œé”"></a>è¡Œé”</h4><p>è¡¨é”çš„ä½œç”¨èŒƒå›´å¤ªå¹¿äº†ï¼Œå¦‚æœæˆ‘ä»¬ä»…ä»…åªæ˜¯å¯¹æŸä¸€è¡Œè¿›è¡Œæ“ä½œï¼Œé‚£ä¹ˆå¤§å¯ä¸å¿…å¯¹æ•´ä¸ªè¡¨è¿›è¡ŒåŠ é”ï¼Œå› æ­¤<code>InnoDB</code>æ”¯æŒäº†è¡Œé”ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥å¯¹æŸä¸€è¡Œè¿›è¡ŒåŠ é”ï¼š</p><p>â€‹                              </p><p>â€‹        sql        å¤åˆ¶ä»£ç       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- æ·»åŠ è¯»é”ï¼ˆå…±äº«é”ï¼‰</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> ... lock <span class="hljs-keyword">in</span> share mode;<br><span class="hljs-comment">-- æ·»åŠ å†™é”ï¼ˆæ’ä»–é”ï¼‰</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> ... <span class="hljs-keyword">for</span> <span class="hljs-keyword">update</span>;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨InnoDBçš„æƒ…å†µä¸‹ï¼Œåœ¨æ‰§è¡Œæ›´æ–°ã€åˆ é™¤ã€æ’å…¥æ“ä½œæ—¶ï¼Œæ•°æ®åº“ä¹Ÿä¼šè‡ªåŠ¨ä¸ºæ‰€æ¶‰åŠçš„è¡Œæ·»åŠ å†™é”ï¼ˆæ’ä»–é”ï¼‰ï¼Œç›´åˆ°äº‹åŠ¡æäº¤æ—¶ï¼Œæ‰ä¼šé‡Šæ”¾é”ï¼Œæ‰§è¡Œæ™®é€šçš„æŸ¥è¯¢æ“ä½œæ—¶ï¼Œä¸ä¼šæ·»åŠ ä»»ä½•é”ã€‚ä½¿ç”¨MyISAMçš„æƒ…å†µä¸‹ï¼Œåœ¨æ‰§è¡Œæ›´æ–°ã€åˆ é™¤ã€æ’å…¥æ“ä½œæ—¶ï¼Œæ•°æ®åº“ä¼šå¯¹æ¶‰åŠçš„è¡¨æ·»åŠ å†™é”ï¼Œåœ¨æ‰§è¡ŒæŸ¥è¯¢æ“ä½œæ—¶ï¼Œæ•°æ®åº“ä¼šå¯¹æ¶‰åŠçš„è¡¨æ·»åŠ è¯»é”ã€‚</p><p><strong>æé—®ï¼š</strong> å½“æˆ‘ä»¬ä¸ä½¿ç”¨idè¿›è¡Œé€‰æ‹©ï¼Œè¡Œé”ä¼šå‘ç”Ÿä»€ä¹ˆå˜åŒ–ï¼Ÿï¼ˆè¡Œé”å‡çº§ï¼‰</p><h3 id="è®°å½•é”ã€é—´éš™é”å’Œä¸´é”®é”"><a href="#è®°å½•é”ã€é—´éš™é”å’Œä¸´é”®é”" class="headerlink" title="è®°å½•é”ã€é—´éš™é”å’Œä¸´é”®é”"></a>è®°å½•é”ã€é—´éš™é”å’Œä¸´é”®é”</h3><p>æˆ‘ä»¬çŸ¥é“InnoDBæ”¯æŒä½¿ç”¨è¡Œé”ï¼Œä½†æ˜¯è¡Œé”æ¯”è¾ƒå¤æ‚ï¼Œå®ƒå¯ä»¥ç»§ç»­åˆ†ä¸ºå¤šä¸ªç±»å‹ã€‚</p><h4 id="è®°å½•é”"><a href="#è®°å½•é”" class="headerlink" title="è®°å½•é”"></a>è®°å½•é”</h4><p>ï¼ˆRecord Locksï¼‰è®°å½•é”, ä»…ä»…é”ä½ç´¢å¼•è®°å½•çš„ä¸€è¡Œï¼Œåœ¨å•æ¡ç´¢å¼•è®°å½•ä¸ŠåŠ é”ã€‚Record locké”ä½çš„æ°¸è¿œæ˜¯ç´¢å¼•ï¼Œè€Œéè®°å½•æœ¬èº«ï¼Œå³ä½¿è¯¥è¡¨ä¸Šæ²¡æœ‰ä»»ä½•ç´¢å¼•ï¼Œé‚£ä¹ˆinnodbä¼šåœ¨åå°åˆ›å»ºä¸€ä¸ªéšè—çš„èšé›†ä¸»é”®ç´¢å¼•ï¼Œé‚£ä¹ˆé”ä½çš„å°±æ˜¯è¿™ä¸ªéšè—çš„èšé›†ä¸»é”®ç´¢å¼•ã€‚æ‰€ä»¥è¯´å½“ä¸€æ¡sqlæ²¡æœ‰èµ°ä»»ä½•ç´¢å¼•æ—¶ï¼Œé‚£ä¹ˆå°†ä¼šåœ¨æ¯ä¸€æ¡èšåˆç´¢å¼•åé¢åŠ å†™é”ï¼Œè¿™ä¸ªç±»ä¼¼äºè¡¨é”ï¼Œä½†åŸç†ä¸Šå’Œè¡¨é”åº”è¯¥æ˜¯å®Œå…¨ä¸åŒçš„ã€‚</p><h4 id="é—´éš™é”"><a href="#é—´éš™é”" class="headerlink" title="é—´éš™é”"></a>é—´éš™é”</h4><p>ï¼ˆGap Locksï¼‰ä»…ä»…é”ä½ä¸€ä¸ªç´¢å¼•åŒºé—´ï¼ˆå¼€åŒºé—´ï¼Œä¸åŒ…æ‹¬åŒç«¯ç«¯ç‚¹ï¼‰ã€‚åœ¨ç´¢å¼•è®°å½•ä¹‹é—´çš„é—´éš™ä¸­åŠ é”ï¼Œæˆ–è€…æ˜¯åœ¨æŸä¸€æ¡ç´¢å¼•è®°å½•ä¹‹å‰æˆ–è€…ä¹‹ååŠ é”ï¼Œå¹¶ä¸åŒ…æ‹¬è¯¥ç´¢å¼•è®°å½•æœ¬èº«ã€‚æ¯”å¦‚åœ¨ 1ã€2ä¸­ï¼Œé—´éš™é”çš„å¯èƒ½å€¼æœ‰ (-âˆ, 1)ï¼Œ(1, 2)ï¼Œ(2, +âˆ)ï¼Œé—´éš™é”å¯ç”¨äºé˜²æ­¢å¹»è¯»ï¼Œä¿è¯ç´¢å¼•é—´çš„ä¸ä¼šè¢«æ’å…¥æ•°æ®ã€‚</p><h4 id="ä¸´é”®é”"><a href="#ä¸´é”®é”" class="headerlink" title="ä¸´é”®é”"></a>ä¸´é”®é”</h4><p>ï¼ˆNext-Key Locksï¼‰Record lock + Gap lockï¼Œå·¦å¼€å³é—­åŒºé—´ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>InnoDB</code>æ­£æ˜¯ä½¿ç”¨Next-key Locksæ¥é”å®šè®°å½•ï¼ˆå¦‚select â€¦ for updateè¯­å¥ï¼‰å®ƒè¿˜ä¼šæ ¹æ®åœºæ™¯è¿›è¡Œçµæ´»å˜æ¢ï¼š</p><table><thead><tr><th align="left">åœºæ™¯</th><th>è½¬æ¢</th></tr></thead><tbody><tr><td align="left">ä½¿ç”¨å”¯ä¸€ç´¢å¼•è¿›è¡Œç²¾ç¡®åŒ¹é…ï¼Œä½†è¡¨ä¸­ä¸å­˜åœ¨è®°å½•</td><td>è‡ªåŠ¨è½¬æ¢ä¸º Gap Locks</td></tr><tr><td align="left">ä½¿ç”¨å”¯ä¸€ç´¢å¼•è¿›è¡Œç²¾ç¡®åŒ¹é…ï¼Œä¸”è¡¨ä¸­å­˜åœ¨è®°å½•</td><td>è‡ªåŠ¨è½¬æ¢ä¸º Record Locks</td></tr><tr><td align="left">ä½¿ç”¨éå”¯ä¸€ç´¢å¼•è¿›è¡Œç²¾ç¡®åŒ¹é…</td><td>ä¸è½¬æ¢</td></tr><tr><td align="left">ä½¿ç”¨å”¯ä¸€ç´¢å¼•è¿›è¡ŒèŒƒå›´åŒ¹é…</td><td>ä¸è½¬æ¢ï¼Œä½†æ˜¯åªé”ä¸Šç•Œï¼Œä¸é”ä¸‹ç•Œ</td></tr></tbody></table><p><a href="https://zhuanlan.zhihu.com/p/48269420">https://zhuanlan.zhihu.com/p/48269420</a></p><p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</p><p>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºæŸç çŸ¥è¯†åº“ç‰ˆæƒæ‰€æœ‰ï¼Œç¦æ­¢ä¸€åˆ‡æœªç»æˆæƒçš„è½¬è½½ã€å‘å¸ƒã€å‡ºå”®ç­‰è¡Œä¸ºï¼Œè¿è€…å°†è¢«è¿½ç©¶æ³•å¾‹è´£ä»»ã€‚</p><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://www.itbaima.cn/document/vkpmw9wbej21nei6">https://www.itbaima.cn/document/vkpmw9wbej21nei6</a></p>]]></content>
    
    
    <categories>
      
      <category>åç«¯</category>
      
      <category>ä¸­é—´ä»¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Mysql</tag>
      
      <tag>æ•°æ®åº“</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Docker å®¹å™¨æŠ€æœ¯</title>
    <link href="/post/4fd66ff9-ef1e-4a91-912a-4271ef291763/"/>
    <url>/post/4fd66ff9-ef1e-4a91-912a-4271ef291763/</url>
    
    <content type="html"><![CDATA[<h3 id="Docker-å®¹å™¨æŠ€æœ¯"><a href="#Docker-å®¹å™¨æŠ€æœ¯" class="headerlink" title="Docker å®¹å™¨æŠ€æœ¯"></a>Docker å®¹å™¨æŠ€æœ¯</h3><p><code>hexo template generate by typora plugin templater</code></p><p><img src="docker-1720456734236-247.jpg" alt="Docker å®¹å™¨æŠ€æœ¯"></p><h1 id="Dockerå®¹å™¨æŠ€æœ¯"><a href="#Dockerå®¹å™¨æŠ€æœ¯" class="headerlink" title="Dockerå®¹å™¨æŠ€æœ¯"></a>Dockerå®¹å™¨æŠ€æœ¯</h1><p>Dockeræ˜¯ä¸€é—¨å¹³å°çº§åˆ«çš„æŠ€æœ¯ï¼Œæ¶‰åŠçš„èŒƒå›´å¾ˆå¹¿ï¼Œæ‰€ä»¥ï¼Œåœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿ä½ å®Œæˆï¼š<strong>Java SpringBoot ç¯‡</strong>ï¼ˆæ¨èå®ŒæˆSpringCloudç¯‡å†æ¥ï¼‰è§†é¢‘æ•™ç¨‹åŠä¹‹å‰å…¨éƒ¨è·¯çº¿ï¼Œå¦åˆ™å­¦ä¹ ä¼šéå¸¸åƒåŠ›ï¼Œå¦å¤–æ¨èé¢å¤–æŒæ¡ï¼šã€Šè®¡ç®—æœºç½‘ç»œã€‹ã€ã€Šæ“ä½œç³»ç»Ÿã€‹ç›¸å…³çŸ¥è¯†ã€‚å­¦ä¸€æ ·ä¸œè¥¿ä¸èƒ½å®Œå…¨é è®°å¿†æ¥å®Œæˆï¼Œè€Œæ˜¯éœ€è¦ç»“åˆè‡ªå·±æ‰€å­¦çš„åŸºç¡€çŸ¥è¯†åŠ ä»¥ç†è§£ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå•å‡­è®°å¿†èƒ½å¤ŸæŒæ¡çš„ä¸œè¥¿å¾€å¾€æ˜¯æœ€å»‰ä»·çš„ã€‚</p><p><strong>Dockerå®˜ç½‘ï¼š</strong> <a href="https://www.docker.com/">https://www.docker.com</a></p><p><strong>è¯¾å‰å‡†å¤‡ï¼š</strong> é…ç½®2C2Gä»¥ä¸ŠLinuxæœåŠ¡å™¨ä¸€å°ï¼Œäº‘æœåŠ¡å™¨ã€è™šæ‹Ÿæœºå‡å¯ã€‚</p><h2 id="å®¹å™¨æŠ€æœ¯å…¥é—¨"><a href="#å®¹å™¨æŠ€æœ¯å…¥é—¨" class="headerlink" title="å®¹å™¨æŠ€æœ¯å…¥é—¨"></a>å®¹å™¨æŠ€æœ¯å…¥é—¨</h2><p>éšç€æ—¶ä»£çš„å‘å±•ï¼ŒDockerä¹Ÿé€æ¸èµ°ä¸Šäº†å†å²èˆå°ï¼Œæ›¾ç»æˆ‘ä»¬æƒ³è¦å®‰è£…ä¸€å¥—ç¯å¢ƒï¼Œéœ€è¦èŠ±è´¹ä¸€ä¸‹åˆç”šè‡³ä¸€æ•´å¤©æ¥é…ç½®å’Œå®‰è£…å„ä¸ªéƒ¨åˆ†ï¼ˆæ¯”å¦‚è¿è¡Œæˆ‘ä»¬è‡ªå·±çš„SpringBootåº”ç”¨ç¨‹åºï¼Œå¯èƒ½éœ€è¦å®‰è£…æ•°æ®åº“ã€å®‰è£…Redisã€å®‰è£…MQç­‰ï¼Œå„ç§å„æ ·çš„ç¯å¢ƒå…‰æ˜¯å®‰è£…å°±è¦èŠ±è´¹å¾ˆå¤šæ—¶é—´ï¼ŒçœŸçš„æ˜¯æå¾—å¿ƒæ€çˆ†ç‚¸ï¼‰ï¼Œè€Œæœ‰äº†Dockerä¹‹åï¼Œæˆ‘ä»¬çš„ç¨‹åºå’Œç¯å¢ƒéƒ¨ç½²å°±å˜å¾—éå¸¸ç®€å•äº†ï¼Œæˆ‘ä»¬åªéœ€è¦å°†è¿™äº›ç¯å¢ƒä¸€èµ·æ‰“åŒ…æˆä¸€ä¸ªé•œåƒã€‚è€Œåˆ°æœåŠ¡å™¨ä¸Šéƒ¨ç½²æ—¶ï¼Œå¯ä»¥ç›´æ¥ä¸‹è½½é•œåƒå®ç°ä¸€é”®éƒ¨ç½²ï¼Œæ˜¯ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Ÿ</p><p>åŒ…æ‹¬æˆ‘ä»¬åœ¨å­¦ä¹ SpringCloudéœ€è¦é…ç½®çš„å„ç§ç»„ä»¶ï¼Œå¯èƒ½åœ¨è‡ªå·±ç”µè„‘çš„ç¯å¢ƒä¸­è¿è¡Œä¼šé‡åˆ°å„ç§å„æ ·çš„é—®é¢˜ï¼ˆå¯èƒ½ç”±äºç”µè„‘ä¸Šå„ç§ç¯å¢ƒæ²¡é…ç½®ï¼Œå¯¼è‡´æ— æ³•è¿è¡Œï¼‰ï¼Œè€Œç°åœ¨åªéœ€è¦ä¸‹è½½é•œåƒå°±èƒ½ç›´æ¥è¿è¡Œï¼Œæ‰€æœ‰çš„ç¯å¢ƒå…¨éƒ¨åœ¨é•œåƒä¸­é…ç½®å®Œæˆï¼Œå¼€ç®±å³ç”¨ã€‚</p><p>çœŸçš„æœ‰è¿™ä¹ˆç¥å¥‡å—ï¼Ÿæˆ‘ä»¬æ¥è¯•è¯•çœ‹ã€‚</p><h3 id="ç¯å¢ƒå®‰è£…å’Œéƒ¨ç½²"><a href="#ç¯å¢ƒå®‰è£…å’Œéƒ¨ç½²" class="headerlink" title="ç¯å¢ƒå®‰è£…å’Œéƒ¨ç½²"></a>ç¯å¢ƒå®‰è£…å’Œéƒ¨ç½²</h3><p>é¦–å…ˆæˆ‘ä»¬è¿˜æ˜¯å…ˆå°†Dockerç¯å¢ƒæ­å»ºå¥½ï¼ˆå»ºè®®å’Œæˆ‘åŒä¸€ä¸ªç¯å¢ƒï¼Œä¸ç„¶å‡ºäº†é—®é¢˜åªèƒ½è‡ªå·±æƒ³åŠæ³•äº†ï¼‰ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ï¼š</p><ul><li>Ubuntu 22.04 æ“ä½œç³»ç»Ÿ</li></ul><p>Dockeråˆ†ä¸ºå…è´¹çš„CEï¼ˆCommunity Editionï¼‰ç¤¾åŒºç‰ˆæœ¬å’ŒEEï¼ˆEnterprise Editionï¼‰ä¼ä¸šçº§ä»˜è´¹ç‰ˆæœ¬ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œé€‰æ‹©docker-ceè¿›è¡Œå®‰è£…ã€‚å®˜æ–¹å®‰è£…æ–‡æ¡£ï¼š<a href="https://docs.docker.com/engine/install/ubuntu/">https://docs.docker.com/engine/install/ubuntu/</a></p><p>é¦–å…ˆå®‰è£…ä¸€äº›å·¥å…·ï¼š</p><p>â€‹                              </p><p>â€‹        sh        å¤åˆ¶ä»£ç       </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo apt-get install ca-certificates curl gnupg lsb-release<br></code></pre></td></tr></table></figure><p>ä¸è¿‡åœ¨Ubuntu22.04å·²ç»é»˜è®¤å®‰è£…å¥½äº†ã€‚æ¥ç€å®‰è£…å®˜æ–¹çš„GPG keyï¼š</p><p>â€‹                              </p><p>â€‹        sh        å¤åˆ¶ä»£ç       </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo <span class="hljs-built_in">mkdir</span> -p /etc/apt/keyrings<br><br>curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg<br></code></pre></td></tr></table></figure><p>æœ€åå°†Dockerçš„åº“æ·»åŠ åˆ°aptèµ„æºåˆ—è¡¨ä¸­ï¼š</p><p>â€‹                              </p><p>â€‹        sh        å¤åˆ¶ä»£ç       </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;deb [arch=<span class="hljs-subst">$(dpkg --print-architecture)</span> signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu <span class="hljs-subst">$(lsb_release -cs)</span> stable&quot;</span> | sudo <span class="hljs-built_in">tee</span> /etc/apt/sources.list.d/docker.list &gt; /dev/null<br></code></pre></td></tr></table></figure><p>æ¥ç€æˆ‘ä»¬æ›´æ–°ä¸€æ¬¡aptï¼š</p><p>â€‹                              </p><p>â€‹        sh        å¤åˆ¶ä»£ç       </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo apt update<br></code></pre></td></tr></table></figure><p>æœ€åå®‰è£…Docker CEç‰ˆæœ¬ï¼š</p><p>â€‹                              </p><p>â€‹        sh        å¤åˆ¶ä»£ç       </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo apt install docker-ce<br></code></pre></td></tr></table></figure><p>ç­‰å¾…å®‰è£…å®Œæˆå°±å¯ä»¥äº†ï¼š</p><p><img src="D1GXAQdUsgmTawq.jpg" alt="image-20220630161240162"></p><p><img src="oI26yQiqhABN3UP.jpg" alt="image-20220630161341541"></p><p>å¯ä»¥çœ‹åˆ°å®‰è£…æˆåŠŸåç‰ˆæœ¬æ˜¯20.10.17ï¼Œå½“ç„¶å¯èƒ½ä½ ä»¬å®‰è£…çš„æ—¶å€™å°±æ˜¯æ›´æ–°çš„ç‰ˆæœ¬äº†ã€‚æœ€åæˆ‘ä»¬å°†å½“å‰ç”¨æˆ·æ·»åŠ åˆ°dockerç”¨æˆ·ç»„ä¸­ï¼Œä¸ç„¶æ¯æ¬¡ä½¿ç”¨dockerå‘½ä»¤éƒ½éœ€è¦sudoæ‰§è¡Œï¼Œå¾ˆéº»çƒ¦ï¼š</p><p>â€‹                              </p><p>â€‹        sh        å¤åˆ¶ä»£ç       </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo usermod -aG docker &lt;ç”¨æˆ·å&gt;<br></code></pre></td></tr></table></figure><p>é…ç½®å¥½åï¼Œæˆ‘ä»¬å…ˆé€€å‡ºSSHç»ˆç«¯ï¼Œç„¶åé‡æ–°è¿æ¥å°±å¯ä»¥ç”Ÿæ•ˆäº†ã€‚</p><p>è¿™æ ·æˆ‘ä»¬Docker çš„å­¦ä¹ ç¯å¢ƒå°±é…ç½®å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬å°±å°è¯•é€šè¿‡Dockeræ¥éƒ¨ç½²ä¸€ä¸ªNginxæœåŠ¡å™¨è¯•è¯•çœ‹ï¼Œä½¿ç”¨å¾ˆç®€å•ï¼Œåªéœ€è¦ä¸€ä¸ªå‘½ä»¤å°±å¯ä»¥äº†ï¼ˆå½“ç„¶ç°åœ¨çœ‹ä¸æ‡‚æ²¡å…³ç³»ï¼Œæˆ‘ä»¬åé¢ä¼šç»†å—¦ï¼‰ï¼š</p><p>â€‹                              </p><p>â€‹        sh        å¤åˆ¶ä»£ç       </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo docker run -d -p 80:80 nginx<br></code></pre></td></tr></table></figure><p><img src="sPVpLI9bXlzdKeO.jpg" alt="image-20220630165259663"></p><p>é¦–é€‰å®ƒä¼šä»é•œåƒä»“åº“ä¸­ä¸‹è½½å¯¹åº”çš„é•œåƒï¼Œå›½å†…è®¿é—®é€Ÿåº¦è¿˜è¡Œï¼Œä¸éœ€è¦å•ç‹¬é…ç½®é•œåƒæºã€‚æ¥ç€ä¸‹è½½å®Œæˆåï¼Œå°±ä¼šåœ¨åå°è¿è¡Œäº†ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æµè§ˆå™¨è®¿é—®è¯•è¯•çœ‹ï¼š</p><p><img src="fP5TsQnqUbmXoaA.jpg" alt="image-20220630165430159"></p><p><img src="lPZYrUn2D1gNjx8.jpg" alt="image-20220630165440751"></p><p>å¯ä»¥çœ‹åˆ°ï¼ŒNginxæœåŠ¡å™¨å·²ç»æˆåŠŸéƒ¨ç½²äº†ï¼Œä½†æ˜¯å®é™…ä¸Šæˆ‘ä»¬å¹¶æ²¡æœ‰åœ¨Ubuntuä¸­å®‰è£…Nginxï¼Œè€Œæ˜¯é€šè¿‡Dockerè¿è¡Œçš„é•œåƒæ¥è¿›è¡ŒæœåŠ¡å™¨æ­å»ºçš„ï¼Œæ˜¯ä¸æ˜¯æ„Ÿè§‰ç©æ³•æŒºæ–°å¥‡çš„ã€‚é™¤äº†Nginxè¿™ç§ç®€å•çš„åº”ç”¨ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡Dockeræ¥éƒ¨ç½²å¤æ‚åº”ç”¨ï¼Œä¹‹åæˆ‘ä»¬éƒ½ä¼šä¸€ä¸€è¿›è¡Œè®²è§£çš„ã€‚</p><h3 id="ä»è™šæ‹Ÿæœºåˆ°å®¹å™¨"><a href="#ä»è™šæ‹Ÿæœºåˆ°å®¹å™¨" class="headerlink" title="ä»è™šæ‹Ÿæœºåˆ°å®¹å™¨"></a>ä»è™šæ‹Ÿæœºåˆ°å®¹å™¨</h3><p>å‰é¢æˆ‘ä»¬æˆåŠŸå®‰è£…äº†Dockerå­¦ä¹ ç¯å¢ƒï¼Œä»¥åŠæµ…å°äº†ä¸€ä¸‹Dockerä¸ºæˆ‘ä»¬å¸¦æ¥çš„åº”ç”¨å¿«é€Ÿéƒ¨ç½²ã€‚åœ¨æ­£å¼è¿›å…¥å­¦ä¹ ä¹‹å‰ï¼Œæˆ‘ä»¬å°±å…ˆä»Dockerçš„å‘å±•å¼€å§‹è¯´èµ·ã€‚</p><p>åœ¨Dockerå‡ºç°ä¹‹å‰ï¼Œè™šæ‹ŸåŒ–æŠ€æœ¯å¯ä»¥è¯´æ˜¯å æ®äº†ä¸»å¯¼åœ°ä½ã€‚é¦–å…ˆæˆ‘ä»¬æ¥è°ˆè°ˆä¸ºä»€ä¹ˆä¼šå‡ºç°è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œæˆ‘ä»¬çŸ¥é“åœ¨ä¼ä¸šä¸­æœåŠ¡å™¨å¯ä»¥è¯´æ˜¯å¿…ä¸å¯å°‘çš„ä¸€ç§ç¡¬ä»¶è®¾æ–½äº†ï¼ŒæœåŠ¡å™¨ä¹Ÿæ˜¯ç”µè„‘ï¼Œä½†æ˜¯ä¸åƒæˆ‘ä»¬çš„å®¶ç”¨ç”µè„‘ï¼ŒæœåŠ¡å™¨çš„é…ç½®æ˜¯éå¸¸é«˜çš„ï¼Œæˆ‘ä»¬å®¶ç”¨ç”µè„‘çš„CPUå¯èƒ½æœ€é«˜é…ä¹Ÿå°±20æ ¸äº†ï¼Œå†…å­˜å¾ˆå°‘æœ‰è¶…è¿‡128Gçš„ç”µè„‘ï¼Œ64Gå†…å­˜çš„å®¶ç”¨ç”µè„‘å¯ä»¥ç®—å¥¢ä¾ˆäº†ã€‚è€ŒæœåŠ¡å™¨ä¸ä¸€æ ·ï¼ŒæœåŠ¡å™¨çº§åˆ«çš„CPUåŠ¨è¾„12æ ¸ï¼Œç”šè‡³æœåŠ¡å™¨è¿˜èƒ½åŒæ—¶å®‰è£…å¤šå—CPUï¼Œèƒ½ç›´æ¥å †åˆ°å¥½å‡ åæ ¸ï¼š</p><p><img src="DPxA9MsZ3WGl62X.jpg" alt="image-20220630171220207"></p><p>æˆ‘ä»¬å®¶ç”¨çº§CPUä¸€èˆ¬æ˜¯AMDçš„é”é¾™ç³»åˆ—å’ŒIntelçš„é…·ç¿ç³»åˆ—ï¼ˆæ¯”å¦‚i3 i5 i7 i9ï¼‰ï¼Œè€ŒæœåŠ¡å™¨CPUä¸€èˆ¬æ˜¯Intelçš„å¿—å¼ºï¼ˆXenoï¼‰ç³»åˆ—ï¼Œè¿™ç§CPUçš„ç‰¹ç‚¹å°±æ˜¯æ ¸å¿ƒæ•°éå¸¸å¤šï¼š</p><p><img src="cKlhRZ9Sw1Q4uEX.jpg" alt="image-20220630172135408"></p><p>å¹¶ä¸”æœåŠ¡å™¨CPUç›¸æ¯”å®¶ç”¨CPUçš„åŠŸè€—ä¹Ÿä¼šæ›´å¤§ï¼Œå› æ­¤æœåŠ¡å™¨CPUçš„å‘çƒ­é‡éå¸¸é«˜ï¼Œå¦‚æœä½ æœ‰å¹¸å»è¿‡æœºæˆ¿ï¼Œä½ ä¼šå¬è§æ•£çƒ­é£æ‰‡çŒ›çƒˆè½¬åŠ¨çš„å£°éŸ³ï¼ˆä½†æ˜¯æœåŠ¡å™¨CPUçš„é¢‘ç‡æ²¡æœ‰å®¶ç”¨çº§CPUé«˜ï¼Œä¸€èˆ¬å¤§å‹æ¸¸æˆè¦æ±‚çš„æ˜¯é«˜é¢‘ç‡è€Œä¸æ˜¯æ ¸å¿ƒæ•°ï¼Œè€Œä¸”åŠŸè€—ä¹Ÿæ¯”è¾ƒå¤§ï¼Œæ‰€ä»¥å¹¶ä¸é€‚åˆåšå®¶ç”¨ç”µè„‘ï¼Œæ‰€ä»¥ä»¥ååœ¨ç½‘ä¸Šä¹°å°å¼æœºï¼Œçœ‹åˆ°ä»€ä¹ˆâ€œi9çº§â€CPUåƒä¸‡åˆ«ä¹°ï¼Œæ˜¯è¿™äº›é»‘å¿ƒå•†å®¶æŠŠå›½å¤–æœåŠ¡å™¨ä¸Šæ·˜æ±°ä¸‹æ¥çš„æœåŠ¡å™¨CPUï¼ˆæ´‹åƒåœ¾ï¼‰è£…æˆç”µè„‘å–ç»™ä½ ï¼Œæ‰€ä»¥ä¼šå¾ˆä¾¿å®œï¼ŒåŒæ—¶æ ¸å¿ƒæ•°åˆèƒ½åª²ç¾i9ï¼Œæ‰€ä»¥è¿˜æ˜¯ä¸€åˆ†é’±ä¸€åˆ†è´§å®åœ¨ï¼‰</p><p>æœåŠ¡å™¨æ— è®ºæ˜¯CPUèµ„æºè¿˜æ˜¯å†…å­˜èµ„æºéƒ½è¿œè¶…å®¶ç”¨ç”µè„‘ï¼Œè€Œæˆ‘ä»¬ç¼–å†™çš„Javaåç«¯é¡¹ç›®ï¼Œæœ€åéƒ½ä¼šè¿è¡Œåœ¨è¿™äº›æœåŠ¡å™¨ä¸Šï¼Œä¸è¿‡æœ‰ä¸€ä¸ªé—®é¢˜ï¼ŒæœåŠ¡å™¨æ—¢ç„¶æœ‰è¿™ä¹ˆä¸°å¯Œçš„ç¡¬ä»¶èµ„æºï¼Œå°±è·‘å’±ä»¬è¿™ä¸€ä¸ªå°Javaåç«¯ï¼Œæ˜¯ä¸æ˜¯æœ‰ç‚¹æ ¸å¼¹ç‚¸èšŠå­çš„æ„Ÿè§‰äº†ï¼Ÿå¯èƒ½é¡¶å¤šå°±ç”¨äº†æœåŠ¡å™¨5%çš„ç¡¬ä»¶èµ„æºï¼ŒæœåŠ¡å™¨è¿™ä¹ˆç‰›å°±è¿è¡Œä¸ªè¿™ä¹Ÿå¤ªæµªè´¹äº†å§ã€‚</p><p>æ‰€ä»¥ï¼Œä¸ºäº†è§£å†³è¿™ç§èµ„æºåˆ©ç”¨ç‡åªæœ‰5%-15%çš„æƒ…å†µï¼Œå’±ä»¬èƒ½ä¸èƒ½æƒ³ä¸ªåŠæ³•ï¼ŒæŠŠè¿™ä¸€å°æœåŠ¡å™¨åˆ†æˆå¤šä¸ªå°æœåŠ¡å™¨ä½¿ç”¨ï¼Œæ¯ä¸ªå°æœåŠ¡å™¨åªåˆ†é…ä¸€éƒ¨åˆ†çš„èµ„æºï¼Œæ¯”å¦‚åˆ†ä¸€ä¸ªå°æœåŠ¡å™¨å‡ºå»ï¼Œåªç»™2ä¸ªCPUæ ¸å¿ƒå’Œ4Gå†…å­˜ã€‚ä½†æ˜¯ç”±äºè®¾è®¡ä¸Šçš„é—®é¢˜ï¼Œæˆ‘ä»¬çš„ç”µè„‘åªèƒ½åŒæ—¶è¿è¡Œä¸€ä¸ªæ“ä½œç³»ç»Ÿï¼Œé‚£ä¹ˆæ€ä¹ˆåŠå‘¢ï¼Ÿæ­¤æ—¶è™šæ‹ŸåŒ–æŠ€æœ¯å°±å¼€å§‹å…´èµ·äº†ã€‚</p><p>è™šæ‹ŸåŒ–ä½¿ç”¨è½¯ä»¶æ¥æ¨¡æ‹Ÿç¡¬ä»¶å¹¶åˆ›å»ºè™šæ‹Ÿè®¡ç®—æœºç³»ç»Ÿã€‚è¿™æ ·ä¸€æ¥ï¼Œä¼ä¸šä¾¿å¯ä»¥åœ¨å•å°æœåŠ¡å™¨ä¸Šè¿è¡Œå¤šä¸ªè™šæ‹Ÿç³»ç»Ÿï¼Œä¹Ÿå°±æ˜¯è¿è¡Œå¤šä¸ªæ“ä½œç³»ç»Ÿå’Œåº”ç”¨ï¼Œè€Œè¿™å¯ä»¥å®ç°è§„æ¨¡ç»æµä»¥åŠæé«˜æ•ˆç›Šã€‚æ¯”å¦‚æˆ‘ä»¬ç”µè„‘ä¸Šç»å¸¸ä½¿ç”¨çš„VMwareå°±æ˜¯ä¸€ç§æ°‘ç”¨çº§è™šæ‹ŸåŒ–è½¯ä»¶ï¼š</p><p><img src="St3hfELQHNdRZmA.jpg" alt="image-20220630173915254"></p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨VMwareæ¥åˆ›å»ºè™šæ‹Ÿæœºï¼Œè¿™äº›è™šæ‹Ÿæœºå®é™…ä¸Šéƒ½æ˜¯åŸºäºæˆ‘ä»¬å½“å‰ç³»ç»Ÿä¸Šçš„VMwareè½¯ä»¶æ¥è¿è¡Œçš„ï¼Œå½“ç„¶VMwareä¹Ÿæœ‰æœåŠ¡å™¨ä¸“ç”¨çš„è™šæ‹ŸåŒ–è½¯ä»¶ï¼Œæœ‰äº†è™šæ‹ŸåŒ–ä¹‹åï¼Œæˆ‘ä»¬çš„æœåŠ¡å™¨å°±åƒè¿™æ ·ï¼š</p><p><img src="BmnC1xETQM4uRHO.jpg" alt="image-20220630174945749"></p><p>ç›¸å½“äºé€šè¿‡è™šæ‹Ÿæœºæ¨¡æ‹Ÿäº†å¾ˆå¤šæ¥ç”µè„‘å‡ºæ¥ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨åˆ’åˆ†å‡ºæ¥çš„å¤šå°è™šæ‹Ÿæœºä¸Šåˆ†åˆ«å®‰è£…ç³»ç»Ÿå’Œéƒ¨ç½²æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºäº†ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥è‡ªç”±åˆ†é…ç¡¬ä»¶èµ„æºï¼Œåˆç†åœ°ä½¿ç”¨ã€‚ä¸€èˆ¬åœ¨ä¼ä¸šä¸­ï¼Œä¸åŒçš„åº”ç”¨ç¨‹åºå¯èƒ½ä¼šè¢«åˆ†åˆ«éƒ¨ç½²åˆ°å„ä¸ªæœåŠ¡å™¨ä¸Šï¼Œéš”ç¦»å¼€æ¥ï¼Œæ­¤æ—¶ä½¿ç”¨è™šæ‹Ÿæœºå°±éå¸¸é€‚åˆã€‚</p><p>å®é™…ä¸Šæˆ‘ä»¬åœ¨ä»€ä¹ˆè…¾è®¯äº‘ã€é˜¿é‡Œäº‘ç§Ÿçš„äº‘æœåŠ¡å™¨ï¼Œéƒ½æ˜¯ç»è¿‡è™šæ‹ŸåŒ–æŠ€æœ¯åˆ’åˆ†å‡ºæ¥çš„è™šæ‹Ÿæœºè€Œå·²ã€‚</p><p>é‚£ä¹ˆï¼Œæ—¢ç„¶è™šæ‹Ÿæœºéƒ½è¿™ä¹ˆæ–¹ä¾¿äº†ï¼Œå®¹å™¨åˆæ˜¯æ€ä¹ˆæ€å‡ºä¸€æ¡è¡€è·¯çš„å‘¢ï¼Ÿæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ä»€ä¹ˆæ˜¯å®¹å™¨ã€‚</p><p>å®¹å™¨å’Œè™šæ‹Ÿæœºæ¯”è¾ƒç±»ä¼¼ï¼Œéƒ½å¯ä»¥ä¸ºåº”ç”¨æä¾›å°è£…å’Œéš”ç¦»ï¼Œéƒ½æ˜¯è½¯ä»¶ï¼Œä½†æ˜¯å®¹å™¨ä¸­çš„åº”ç”¨è¿è¡Œæ˜¯å¯„æ‰˜äºå®¿ä¸»æ“ä½œç³»ç»Ÿçš„ï¼Œå®é™…ä¸Šä¾ç„¶æ˜¯åœ¨ç›´æ¥ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„èµ„æºï¼Œå½“ç„¶åº”ç”¨ç¨‹åºä¹‹é—´ç¯å¢ƒä¾ç„¶æ˜¯éš”ç¦»çš„ï¼Œè€Œè™šæ‹Ÿæœºåˆ™æ˜¯å®Œå…¨æ¨¡æ‹Ÿä¸€å°çœŸæ­£çš„ç”µè„‘å‡ºæ¥ï¼Œç›´æ¥å°±æ˜¯ä¸¤å°ä¸åŒçš„ç”µè„‘ã€‚</p><p><img src="31GZSh5DE9Vilet.jpg" alt="image-20220630181037698"></p><p>å› æ­¤å®¹å™¨ç›¸æ¯”è™šæ‹Ÿæœºå°±ç®€å•å¤šäº†ï¼Œå¹¶ä¸”å¯åŠ¨é€Ÿåº¦ä¹Ÿä¼šå¿«å¾ˆå¤šï¼Œå¼€é”€å°äº†ä¸å°‘ã€‚</p><p>ä¸è¿‡å®¹å™¨ç«çš„æ ¹æœ¬åŸå› è¿˜æ˜¯å®ƒçš„é›†è£…ç®±æ€æƒ³ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœæˆ‘ä»¬è¦å†™ä¸€ä¸ªæ¯”å¦‚è®ºå›ã€ç”µå•†è¿™ç±»çš„Javaé¡¹ç›®ï¼Œé‚£ä¹ˆæ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€ç¼“å­˜è¿™ç±»ä¸­é—´ä»¶æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œå› æ­¤æˆ‘ä»¬å¦‚æœæƒ³è¦å°†ä¸€ä¸ªæœåŠ¡éƒ¨ç½²åˆ°æœåŠ¡å™¨ï¼Œé‚£ä¹ˆå®é™…ä¸Šè¿˜è¦æå‰å‡†å¤‡å¥½å„ç§å„æ ·çš„ç¯å¢ƒï¼Œå…ˆå®‰è£…å¥½MySQLã€Redisã€RabbitMQç­‰åº”ç”¨ï¼Œé…ç½®å¥½äº†ç¯å¢ƒï¼Œå†å°†æˆ‘ä»¬çš„Javaåº”ç”¨ç¨‹åºå¯åŠ¨ï¼Œæ•´ä¸ªæµç¨‹ä¸‹æ¥ï¼Œå…‰æ˜¯é…ç½®ç¯å¢ƒå°±è¦æµªè´¹å¤§é‡çš„æ—¶é—´ï¼Œå¦‚æœæ˜¯å¤§å‹çš„åˆ†å¸ƒå¼é¡¹ç›®ï¼Œå¯èƒ½è¦éƒ¨ç½²å¾ˆå¤šå°æœºå™¨ï¼Œé‚£å²‚ä¸æ˜¯æˆ‘ä»¬å¾—ä¸€ä¸ªä¸€ä¸ªæ¥ï¼Ÿé¡¹ç›®ä¸Šä¸ªçº¿å°±è¦èŠ±å‡ å¤©æ—¶é—´ï¼Œæ˜¾ç„¶æ˜¯å¾ˆè’å”çš„ã€‚</p><p>è€Œå®¹å™¨å¯ä»¥æ‰“åŒ…æ•´ä¸ªç¯å¢ƒï¼Œæ¯”è¾ƒMySQLã€Redisç­‰ä»¥åŠæˆ‘ä»¬çš„Javaåº”ç”¨ç¨‹åºï¼Œå¯ä»¥è¢«ä¸€èµ·æ‰“åŒ…ä¸ºä¸€ä¸ªé•œåƒï¼Œå½“æˆ‘ä»¬éœ€è¦éƒ¨ç½²æœåŠ¡æ—¶ï¼Œåªéœ€è¦åƒæˆ‘ä»¬ä¹‹å‰é‚£æ ·ï¼Œç›´æ¥ä¸‹è½½é•œåƒè¿è¡Œå³å¯ï¼Œä¸éœ€è¦å†è¿›è¡Œé¢å¤–çš„é…ç½®äº†ï¼Œæ•´ä¸ªé•œåƒä¸­ç¯å¢ƒæ˜¯å·²ç»é…ç½®å¥½çš„çŠ¶æ€ï¼Œå¼€ç®±å³ç”¨ã€‚</p><p><img src="NTnU8iSj51CspFw.jpg" alt="image-20220630182136717"></p><p>è€Œæˆ‘ä»¬è¦é‡ç‚¹ä»‹ç»çš„å°±æ˜¯Dockeräº†ï¼Œå¯ä»¥çœ‹åˆ°å®ƒçš„å›¾æ ‡å°±æ˜¯ä¸€åªé²¸é±¼ï¼Œé²¸é±¼çš„ä¸Šé¢æ˜¯å¾ˆå¤šä¸ªé›†è£…ç®±ï¼Œæ¯ä¸ªé›†è£…ç®±å°±æ˜¯æˆ‘ä»¬çš„æ•´ä¸ªç¯å¢ƒ+åº”ç”¨ç¨‹åºï¼ŒDockerå¯ä»¥å°†ä»»ä½•åº”ç”¨åŠå…¶ä¾èµ–æ‰“åŒ…ä¸ºä¸€ä¸ªè½»é‡çº§ï¼Œå¯ç§»æ¤ï¼Œè‡ªåŒ…å«çš„å®¹å™¨ï¼Œå®¹å™¨å¯ä»¥è¿è¡Œåœ¨å‡ ä¹æ‰€æœ‰çš„æ“ä½œç³»ç»Ÿä¸Šã€‚</p><h3 id="å®¹å™¨å·¥ä½œæœºåˆ¶ç®€è¿°"><a href="#å®¹å™¨å·¥ä½œæœºåˆ¶ç®€è¿°" class="headerlink" title="å®¹å™¨å·¥ä½œæœºåˆ¶ç®€è¿°"></a>å®¹å™¨å·¥ä½œæœºåˆ¶ç®€è¿°</h3><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹Dockerçš„æ•´ä½“æ¶æ„ï¼š</p><p><img src="PeaxwNQXkiYSlUv.jpg" alt="image-20220630184857540"></p><p>å®é™…ä¸Šåˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>Docker å®¢æˆ·ç«¯ï¼šä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„dockerå‘½ä»¤ï¼Œéƒ½æ˜¯åœ¨å®¢æˆ·ç«¯ä¸Šæ‰§è¡Œçš„ï¼Œæ“ä½œä¼šå‘é€åˆ°æœåŠ¡ç«¯ä¸Šå¤„ç†ã€‚</li><li>Docker æœåŠ¡ç«¯ï¼šæœåŠ¡ç«¯å°±æ˜¯å¯åŠ¨å®¹å™¨çš„ä¸»ä½“äº†ï¼Œä¸€èˆ¬æ˜¯ä½œä¸ºæœåŠ¡åœ¨åå°è¿è¡Œï¼Œæ”¯æŒè¿œç¨‹è¿æ¥ã€‚</li><li>Registryï¼šæ˜¯å­˜æ”¾Dockeré•œåƒçš„ä»“åº“ï¼Œè·ŸMavenä¸€æ ·ï¼Œä¹Ÿå¯ä»¥åˆ†å…¬æœ‰å’Œç§æœ‰ä»“åº“ï¼Œé•œåƒå¯ä»¥ä»ä»“åº“ä¸‹è½½åˆ°æœ¬åœ°å­˜æ”¾ã€‚</li></ul><p>å½“æˆ‘ä»¬éœ€è¦åœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²ä¸€ä¸ªå·²ç»æ‰“åŒ…å¥½çš„åº”ç”¨å’Œç¯å¢ƒï¼Œæˆ‘ä»¬åªéœ€è¦ä¸‹è½½æ‰“åŒ…å¥½çš„é•œåƒå°±å¯ä»¥äº†ï¼Œæˆ‘ä»¬å‰é¢æ‰§è¡Œäº†ï¼š</p><p>â€‹                              </p><p>â€‹        sh        å¤åˆ¶ä»£ç       </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo docker run -d -p 80:80 nginx<br></code></pre></td></tr></table></figure><p>å®é™…ä¸Šè¿™ä¸ªå‘½ä»¤è¾“å…¥ä¹‹åï¼š</p><ol><li>Dockerå®¢æˆ·ç«¯å°†æ“ä½œå‘é€ç»™æœåŠ¡ç«¯ï¼Œå‘Šè¯‰æœåŠ¡ç«¯æˆ‘ä»¬è¦è¿è¡Œnginxè¿™ä¸ªé•œåƒã€‚</li><li>DockeræœåŠ¡ç«¯å…ˆçœ‹çœ‹æœ¬åœ°æœ‰æ²¡æœ‰è¿™ä¸ªé•œåƒï¼Œå‘ç°æ²¡æœ‰ã€‚</li><li>æ¥ç€åªèƒ½ä»å…¬å…±ä»“åº“Docker Hubå»æŸ¥æ‰¾ä¸‹è½½é•œåƒäº†ã€‚</li><li>ä¸‹è½½å®Œæˆï¼Œé•œåƒæˆåŠŸä¿å­˜åˆ°æœ¬åœ°ã€‚</li><li>DockeræœåŠ¡ç«¯åŠ è½½Nginxé•œåƒï¼Œå¯åŠ¨å®¹å™¨å¼€å§‹æ­£å¸¸è¿è¡Œï¼ˆæ³¨æ„å®¹å™¨å’Œå…¶ä»–å®¹å™¨ä¹‹é—´ï¼Œå’Œå¤–éƒ¨ä¹‹é—´ï¼Œéƒ½æ˜¯éš”ç¦»çš„ï¼Œäº’ä¸å½±å“ï¼‰</li></ol><p>æ‰€ä»¥ï¼Œæ•´ä¸ªæµç¨‹ä¸­ï¼ŒDockerå°±åƒæ˜¯ä¸€æœè¿è¾“èˆ¹ï¼Œé•œåƒå°±åƒæ˜¯é›†è£…ç®±ï¼Œé€šè¿‡è¿è¾“èˆ¹å°†ä¸–ç•Œå„åœ°çš„è´§ç‰©é€å¾€æˆ‘ä»¬çš„æ¸¯å£ï¼Œè´§ç‰©åˆ°è¾¾æ¸¯å£åï¼ŒDockerå¹¶ä¸å…³å¿ƒé›†è£…ç®±é‡Œé¢çš„æ˜¯ä»€ä¹ˆï¼Œåªéœ€è¦åˆ›å»ºå®¹å™¨å¼€ç®±å³ç”¨å°±å¯ä»¥äº†ã€‚ç›¸æ¯”æˆ‘ä»¬ä¼ ç»Ÿçš„æ‰‹åŠ¨å®‰è£…é…ç½®ç¯å¢ƒï¼Œä¸çŸ¥é“æ–¹ä¾¿äº†å‡ ä¸ªå±‚æ¬¡ã€‚</p><p>ä¸è¿‡å®¹å™¨ä¾ç„¶æ˜¯å¯„æ‰˜äºå®¿ä¸»ä¸»æœºçš„è¿è¡Œçš„ï¼Œæ‰€ä»¥ä¸€èˆ¬åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œéƒ½æ˜¯é€šè¿‡è™šæ‹ŸåŒ–å…ˆåˆ›å»ºå¤šå°ä¸»æœºï¼Œç„¶åå†åˆ°å„ä¸ªè™šæ‹Ÿæœºä¸­éƒ¨ç½²Dockerï¼Œè¿™æ ·çš„è¯ï¼Œè¿ç»´æ•ˆç‡å°±å¤§å¤§æå‡äº†ã€‚</p><p>ä»ä¸‹ä¸€ç« å¼€å§‹ï¼Œæˆ‘ä»¬å°±æ­£å¼åœ°æ¥å­¦ä¹ ä¸€ä¸‹Dockerçš„å„ç§æ“ä½œã€‚</p><hr><h2 id="å®¹å™¨ä¸é•œåƒ"><a href="#å®¹å™¨ä¸é•œåƒ" class="headerlink" title="å®¹å™¨ä¸é•œåƒ"></a>å®¹å™¨ä¸é•œåƒ</h2><p>è¦å¯åŠ¨å®¹å™¨æœ€å…³é”®çš„å°±æ˜¯é•œåƒï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹é•œåƒç›¸å…³çš„ä»‹ç»ã€‚</p><h3 id="åˆè¯†å®¹å™¨é•œåƒ"><a href="#åˆè¯†å®¹å™¨é•œåƒ" class="headerlink" title="åˆè¯†å®¹å™¨é•œåƒ"></a>åˆè¯†å®¹å™¨é•œåƒ</h3><p>é¦–å…ˆæˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹é•œåƒçš„ç›¸å…³æ“ä½œï¼Œæ¯”å¦‚ç°åœ¨æˆ‘ä»¬å¸Œæœ›æŠŠæŸä¸ªé•œåƒä»ä»“åº“ä¸‹è½½åˆ°æœ¬åœ°ï¼Œè¿™é‡Œä½¿ç”¨å®˜æ–¹çš„hello-worldé•œåƒï¼š</p><p>â€‹                              </p><p>â€‹        sh        å¤åˆ¶ä»£ç       </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker pull hello-world<br></code></pre></td></tr></table></figure><p>åªéœ€è¦è¾“å…¥<code>pull</code>å‘½ä»¤ï¼Œå°±å¯ä»¥ç›´æ¥ä¸‹è½½åˆ°æŒ‡å®šçš„é•œåƒäº†ï¼š</p><p><img src="tZ4S2HYvNKr7qiD.jpg" alt="image-20220701111043417"></p><p>å¯ä»¥çœ‹åˆ°å¯¹ä¸Šé¢ä¸€è¡Œæœ‰ä¸€å¥Using default tagï¼Œå®é™…ä¸Šä¸€ä¸ªé•œåƒçš„åç§°æ˜¯ç”±ä¸¤éƒ¨åˆ†ç»„æˆçš„ï¼Œä¸€ä¸ªæ˜¯<code>repository</code>ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯<code>tag</code>ï¼Œä¸€èˆ¬æƒ…å†µä¸‹çº¦å®š<code>repository</code>å°±æ˜¯é•œåƒåç§°ï¼Œ<code>tag</code>ä½œä¸ºç‰ˆæœ¬ï¼Œé»˜è®¤ä¸ºlatestï¼Œè¡¨ç¤ºæœ€æ–°ç‰ˆæœ¬ã€‚æ‰€ä»¥æŒ‡å®šç‰ˆæœ¬è¿è¡Œçš„è¯ï¼š</p><p>â€‹                              </p><p>â€‹        sh        å¤åˆ¶ä»£ç       </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker pull åç§°:ç‰ˆæœ¬<br></code></pre></td></tr></table></figure><p>ä¹‹åä¸ºäº†æ•™å­¦æ–¹ä¾¿ï¼Œæˆ‘ä»¬å°±ç›´æ¥ä½¿ç”¨é»˜è®¤çš„tagï¼Œä¸å»æŒ‡å®šç‰ˆæœ¬äº†ã€‚</p><p>é•œåƒä¸‹è½½ä¹‹åä¼šå­˜æ”¾åœ¨æœ¬åœ°ï¼Œè¦å¯åŠ¨è¿™ä¸ªé•œåƒçš„å®¹å™¨ï¼Œå®é™…ä¸Šå°±åƒæˆ‘ä»¬ä¹‹å‰é‚£æ ·ï¼Œè¾“å…¥<code>run</code>å‘½ä»¤å°±å¯ä»¥äº†ï¼š</p><p>â€‹                              </p><p>â€‹        sh        å¤åˆ¶ä»£ç       </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run hello-world<br></code></pre></td></tr></table></figure><p>å½“ç„¶å¦‚æœä»…ä»…æ˜¯åªæƒ³åˆ›å»ºè€Œä¸æƒ³é©¬ä¸Šè¿è¡Œçš„è¯ï¼Œå¯ä»¥ä½¿ç”¨<code>create</code>å‘½ä»¤ï¼š</p><p>â€‹                              </p><p>â€‹        sh        å¤åˆ¶ä»£ç       </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker create hello-world<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æˆåŠŸå¯åŠ¨äº†ï¼š</p><p><img src="Brl4cnK8WsjP7LV.jpg" alt="image-20220701111314331"></p><p>å¯åŠ¨ä¹‹åï¼Œä¼šä½¿ç”¨å½“å‰é•œåƒè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªå®¹å™¨ï¼Œæˆ‘ä»¬å¯ä»¥è¾“å…¥<code>ps</code>å‘½ä»¤æ¥æŸ¥çœ‹å½“å‰å®¹å™¨çš„å®¹å™¨åˆ—è¡¨ï¼š</p><p>â€‹                              </p><p>â€‹                å¤åˆ¶ä»£ç       </p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">docker ps -<span class="hljs-selector-tag">a</span><br></code></pre></td></tr></table></figure><p>æ³¨æ„åé¢è¦åŠ ä¸€ä¸ª<code>-a</code>è¡¨ç¤ºæŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼ˆå…¶ä»–é€‰é¡¹å¯ä»¥ä½¿ç”¨-hæŸ¥çœ‹ï¼‰ï¼Œå¦‚æœä¸åŠ çš„è¯ï¼Œåªä¼šæ˜¾ç¤ºå½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼Œè€ŒHelloWorldæ˜¯ä¸€æ¬¡æ€§çš„ä¸æ˜¯Nginxé‚£æ ·çš„å¸¸é©»ç¨‹åºï¼Œæ‰€ä»¥å®¹å™¨å¯åŠ¨æ‰“å°äº†ä¸Šé¢çš„å†…å®¹ä¹‹åï¼Œå®¹å™¨å°±åœæ­¢è¿è¡Œäº†ï¼š</p><p><img src="zMN3TPR7aHu5YGb.jpg" alt="image-20220701111840091"></p><p>å¯ä»¥çœ‹åˆ°å®¹å™¨åˆ—è¡¨ä¸­æœ‰æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„hello-worldä»¥åŠæˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„nginxï¼ˆæ³¨æ„åŒä¸€ä¸ªé•œåƒå¯ä»¥åˆ›å»ºå¤šä¸ªå®¹å™¨ï¼‰ï¼Œæ¯ä¸ªå®¹å™¨éƒ½æœ‰ä¸€ä¸ªéšæœºç”Ÿæˆçš„å®¹å™¨IDå†™åœ¨æœ€å‰é¢ï¼Œåé¢æ˜¯å®¹å™¨çš„åˆ›å»ºæ—¶é—´ä»¥åŠå½“å‰çš„è¿è¡ŒçŠ¶æ€ï¼Œæœ€åä¸€åˆ—æ˜¯å®¹å™¨çš„åç§°ï¼Œåœ¨åˆ›å»ºå®¹å™¨æ—¶ï¼Œåç§°å¯ä»¥ç”±æˆ‘ä»¬æŒ‡å®šä¹Ÿå¯ä»¥è‡ªåŠ¨ç”Ÿæˆï¼Œè¿™é‡Œå°±æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ã€‚</p><p>æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨æŒ‡å®šåç§°å¯åŠ¨ï¼Œåœ¨ä½¿ç”¨<code>run</code>å‘½ä»¤æ—¶ï¼Œæ·»åŠ <code>--name</code>å‚æ•°å³å¯ï¼š</p><p>â€‹                              </p><p>â€‹        sh        å¤åˆ¶ä»£ç       </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run --name=lbwnb hello-world<br></code></pre></td></tr></table></figure><p><img src="qOblnhr5CJiIBG6.jpg" alt="image-20220701125951980"></p><p>æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨å¼€å¯å¤„äºåœæ­¢çŠ¶æ€çš„å®¹å™¨ï¼š</p><p>â€‹                              </p><p>â€‹        sh        å¤åˆ¶ä»£ç       </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker start &lt;å®¹å™¨åç§°/å®¹å™¨ID&gt;<br></code></pre></td></tr></table></figure><p>æ³¨æ„å¯åŠ¨çš„å¯¹è±¡æˆ‘ä»¬è¦å¡«å†™å®¹å™¨çš„IDæˆ–æ˜¯å®¹å™¨çš„åç§°æ‰å¯ä»¥ï¼Œå®¹å™¨IDæ¯”è¾ƒé•¿ï¼Œå¯ä»¥ä¸å†™å…¨åªå†™ä¸€åŠï¼Œä½†æ˜¯ä½ è¦ä¿è¯ä½ è¾“å…¥çš„ä¸å®Œå…¨å®¹å™¨IDæ˜¯å”¯ä¸€çš„ã€‚</p><p><img src="XfFORtqhK9lcBi7.jpg" alt="image-20220701124845982"></p><p>å¦‚æœæƒ³è¦åœæ­¢å®¹å™¨ç›´æ¥è¾“å…¥<code>stop</code>å‘½ä»¤å°±å¯ä»¥äº†ï¼š</p><p>â€‹                              </p><p>â€‹        sh        å¤åˆ¶ä»£ç       </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker stop &lt;å®¹å™¨åç§°/å®¹å™¨ID&gt;<br></code></pre></td></tr></table></figure><p>æˆ–æ˜¯é‡å¯ï¼š</p><p>â€‹                              </p><p>â€‹        sh        å¤åˆ¶ä»£ç       </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker restart &lt;å®¹å™¨åç§°/å®¹å™¨ID&gt;<br></code></pre></td></tr></table></figure><p><img src="Q2tor6KRIeUEhO4.jpg" alt="image-20220701125025173"></p><p>å¦‚æœæˆ‘ä»¬ä¸éœ€è¦ä½¿ç”¨å®¹å™¨äº†ï¼Œé‚£ä¹ˆå¯ä»¥å°†å®¹å™¨åˆ é™¤ï¼Œä½†æ˜¯æ³¨æ„åªæœ‰å®¹å™¨å¤„äºéè¿è¡ŒçŠ¶æ€æ—¶æ‰å¯ä»¥åˆ é™¤ï¼š</p><p>â€‹                              </p><p>â€‹        sh        å¤åˆ¶ä»£ç       </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker <span class="hljs-built_in">rm</span> &lt;å®¹å™¨åç§°/å®¹å™¨ID&gt;<br></code></pre></td></tr></table></figure><p>å½“ç„¶å¦‚æœæˆ‘ä»¬å¸Œæœ›å®¹å™¨åœ¨åœæ­¢åè‡ªåŠ¨åˆ é™¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œæ—¶æ·»åŠ <code>--rm</code>å‚æ•°ï¼š</p><p>â€‹                              </p><p>â€‹        sh        å¤åˆ¶ä»£ç       </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run --<span class="hljs-built_in">rm</span> é•œåƒåç§°<br></code></pre></td></tr></table></figure><p><img src="3MlPUpjoV1Qg8DX.jpg" alt="image-20220701125108834"></p><p>åˆ é™¤åï¼Œå®¹å™¨å°†ä¸å¤å­˜åœ¨ï¼Œå½“æ²¡æœ‰ä»»ä½•å…³äºnginxçš„å®¹å™¨ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥åˆ é™¤nginxçš„æœ¬åœ°é•œåƒï¼š</p><p><img src="bmHqND36yCUBPVj.jpg" alt="image-20220701125204728"></p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>images</code>å‘½ä»¤æ¥æ£€æŸ¥ä¸€ä¸‹å½“å‰æœ¬åœ°æœ‰é‚£äº›é•œåƒï¼š</p><p>â€‹                              </p><p>â€‹        sh        å¤åˆ¶ä»£ç       </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker images<br></code></pre></td></tr></table></figure><p><img src="fEscbGJXw4e7YFK.jpg" alt="image-20220701125514145"></p><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº†Dockerçš„ç®€å•ä½¿ç”¨ï¼Œåœ¨åé¢çš„å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬è¿˜ä¼šç»§ç»­è®¤è¯†æ›´å¤šçš„ç©æ³•ã€‚</p><h3 id="é•œåƒç»“æ„ä»‹ç»"><a href="#é•œåƒç»“æ„ä»‹ç»" class="headerlink" title="é•œåƒç»“æ„ä»‹ç»"></a>é•œåƒç»“æ„ä»‹ç»</h3><p>å‰é¢æˆ‘ä»¬äº†è§£äº†Dockerçš„ç›¸å…³åŸºæœ¬æ“ä½œï¼Œå®é™…ä¸Šå®¹å™¨çš„åŸºçŸ³å°±æ˜¯é•œåƒï¼Œæœ‰äº†é•œåƒæ‰èƒ½åˆ›å»ºå¯¹åº”çš„å®¹å™¨å®ä¾‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å…ˆä»é•œåƒçš„åŸºæœ¬ç»“æ„å¼€å§‹è¯´èµ·ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹é•œåƒåˆ°åº•æ˜¯ä¸ªä»€ä¹ˆæ ·çš„å­˜åœ¨ã€‚</p><p>æˆ‘ä»¬åœ¨æ‰“åŒ…é¡¹ç›®æ—¶ï¼Œå®é™…ä¸Šå¾€å¾€éœ€è¦ä¸€ä¸ªåŸºæœ¬çš„æ“ä½œç³»ç»Ÿç¯å¢ƒï¼Œè¿™æ ·æˆ‘ä»¬æ‰å¯ä»¥åœ¨è¿™ä¸ªæ“ä½œç³»ç»Ÿä¸Šå®‰è£…å„ç§ä¾èµ–è½¯ä»¶ï¼Œæ¯”å¦‚æ•°æ®åº“ã€ç¼“å­˜ç­‰ï¼Œåƒè¿™ç§åŸºæœ¬çš„ç³»ç»Ÿé•œåƒï¼Œæˆ‘ä»¬ç§°ä¸ºbaseé•œåƒï¼Œæˆ‘ä»¬çš„é¡¹ç›®ä¹‹åéƒ½ä¼šåŸºäºbaseé•œåƒè¿›è¡Œæ‰“åŒ…ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä¸éœ€è¦baseé•œåƒï¼Œä»…ä»…æ˜¯åŸºäºå½“å‰æ“ä½œç³»ç»Ÿå»æ‰§è¡Œç®€å•çš„å‘½ä»¤ï¼Œæ¯”å¦‚æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„hello-worldå°±æ˜¯ã€‚</p><p>ä¸€èˆ¬baseé•œåƒå°±æ˜¯å„ä¸ªLinuxæ“ä½œç³»ç»Ÿçš„å‘è¡Œç‰ˆï¼Œæ¯”å¦‚æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨çš„Ubuntuï¼Œè¿˜æœ‰CentOSã€Kaliç­‰ç­‰ã€‚è¿™é‡Œæˆ‘ä»¬å°±ä¸‹è½½ä¸€ä¸‹CentOSçš„baseé•œåƒï¼š</p><p>â€‹                              </p><p>â€‹        sh        å¤åˆ¶ä»£ç       </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker pull centos<br></code></pre></td></tr></table></figure><p><img src="oFKxiMzA3fs2aIl.jpg" alt="image-20220701132622893"></p><p>å¯ä»¥çœ‹åˆ°ï¼ŒCentOSçš„baseé•œåƒå°±å·²ç»ä¸‹è½½å®Œæˆï¼Œä¸åƒæˆ‘ä»¬ä½¿ç”¨å®Œæ•´ç³»ç»Ÿä¸€æ ·ï¼Œbaseé•œåƒçš„CentOSçœå»äº†å†…æ ¸ï¼Œæ‰€ä»¥å¤§å°åªæœ‰272Mï¼Œè¿™é‡Œéœ€è¦è§£é‡Šä¸€ä¸‹baseé•œåƒçš„æœºåˆ¶ï¼š</p><p><img src="dvmqAjKHkucbLFh.jpg" alt="image-20220701133111829"></p><p>Linuxæ“ä½œä½“ç³»ç”±å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´ç»„æˆï¼Œå…¶ä¸­å†…æ ¸ç©ºé—´å°±æ˜¯æ•´ä¸ªLinuxç³»ç»Ÿçš„æ ¸å¿ƒï¼ŒLinuxå¯åŠ¨åé¦–å…ˆä¼šåŠ <code>bootfs</code>æ–‡ä»¶ç³»ç»Ÿï¼ŒåŠ è½½å®Œæˆåä¼šè‡ªåŠ¨å¸è½½æ‰ï¼Œä¹‹åä¼šåŠ è½½ç”¨æˆ·ç©ºé—´çš„æ–‡ä»¶ç³»ç»Ÿï¼Œè¿™ä¸€å±‚æ˜¯æˆ‘ä»¬è‡ªå·±å¯ä»¥è¿›è¡Œæ“ä½œçš„éƒ¨åˆ†ï¼š</p><ul><li>bootfsåŒ…å«äº†BootLoaderå’ŒLinuxå†…æ ¸ï¼Œç”¨æˆ·æ˜¯ä¸èƒ½å¯¹è¿™å±‚ä½œä»»ä½•ä¿®æ”¹çš„ï¼Œåœ¨å†…æ ¸å¯åŠ¨ä¹‹åï¼Œbootfsä¼šè‡ªåŠ¨å¸è½½ã€‚</li><li>rootfsåˆ™åŒ…å«äº†ç³»ç»Ÿä¸Šçš„å¸¸è§çš„ç›®å½•ç»“æ„ï¼ŒåŒ…æ‹¬<code>/dev</code>ã€<code> /proc</code>ã€ <code>/bin</code>ç­‰ç­‰ä»¥åŠä¸€äº›åŸºæœ¬çš„æ–‡ä»¶å’Œå‘½ä»¤ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¿›å…¥ç³»ç»Ÿä¹‹åèƒ½å¤Ÿæ“ä½œçš„æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼ŒåŒ…æ‹¬æˆ‘ä»¬åœ¨Ubuntuä¸‹ä½¿ç”¨çš„aptå’ŒCentOSä¸‹ä½¿ç”¨çš„yumï¼Œéƒ½æ˜¯ç”¨æˆ·ç©ºé—´ä¸Šçš„ã€‚</li></ul><p>baseé•œåƒåº•å±‚ä¼šç›´æ¥ä½¿ç”¨å®¿ä¸»ä¸»æœºçš„å†…æ ¸ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ çš„Ubuntuå†…æ ¸ç‰ˆæœ¬æ˜¯å¤šå°‘ï¼Œé‚£ä¹ˆbaseé•œåƒä¸­çš„CentOSå†…æ ¸ç‰ˆæœ¬å°±æ˜¯å¤šå°‘ï¼Œè€Œrootfsåˆ™å¯ä»¥åœ¨ä¸åŒçš„å®¹å™¨ä¸­è¿è¡Œå¤šç§ä¸åŒçš„ç‰ˆæœ¬ã€‚æ‰€ä»¥ï¼Œbaseé•œåƒå®é™…ä¸Šåªæœ‰CentOSçš„rootfsï¼Œå› æ­¤åªæœ‰300Må¤§å°å·¦å³ï¼Œå½“ç„¶ï¼ŒCentOSé‡Œé¢åŒ…å«å¤šç§åŸºç¡€çš„è½¯ä»¶ï¼Œè¿˜æ˜¯æ¯”è¾ƒè‡ƒè‚¿çš„ï¼Œè€ŒæŸäº›æ“ä½œç³»ç»Ÿçš„baseé•œåƒç”šè‡³éƒ½ä¸åˆ°10Mã€‚</p><p>ä½¿ç”¨<code>uname</code>å‘½ä»¤å¯ä»¥æŸ¥çœ‹å½“å‰å†…æ ¸ç‰ˆæœ¬ï¼š</p><p><img src="mZjupCUktL7Ab2R.jpg" alt="image-20220701135056123"></p><p>å› æ­¤ï¼ŒDockerèƒ½å¤ŸåŒæ—¶æ¨¡æ‹Ÿå¤šç§Linuxæ“ä½œç³»ç»Ÿç¯å¢ƒï¼Œå°±ä¸è¶³ä¸ºå¥‡äº†ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•å¯åŠ¨ä¸€ä¸‹åˆšåˆšä¸‹è½½çš„baseé•œåƒï¼š</p><p>â€‹                              </p><p>â€‹        sh        å¤åˆ¶ä»£ç       </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run -it centos<br></code></pre></td></tr></table></figure><p>æ³¨æ„è¿™é‡Œéœ€è¦æ·»åŠ <code>-it</code>å‚æ•°è¿›è¡Œå¯åŠ¨ï¼Œå…¶ä¸­<code>-i</code>è¡¨ç¤ºåœ¨å®¹å™¨ä¸Šæ‰“å¼€ä¸€ä¸ªæ ‡å‡†çš„è¾“å…¥æ¥å£ï¼Œ<code>-t</code>è¡¨ç¤ºåˆ†é…ä¸€ä¸ªä¼ªttyè®¾å¤‡ï¼Œå¯ä»¥æ”¯æŒç»ˆç«¯ç™»å½•ï¼Œä¸€èˆ¬è¿™ä¸¤ä¸ªæ˜¯ä¸€èµ·ä½¿ç”¨ï¼Œå¦åˆ™baseå®¹å™¨å¯åŠ¨åå°±è‡ªåŠ¨åœæ­¢äº†ã€‚</p><p><img src="13BYcCWHsDMrwvq.jpg" alt="image-20220701135834325"></p><p>å¯ä»¥çœ‹åˆ°ä½¿ç”¨lså‘½ä»¤èƒ½å¤ŸæŸ¥çœ‹æ‰€æœ‰æ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œä¸è¿‡å¾ˆå¤šå‘½ä»¤éƒ½æ²¡æœ‰ï¼Œè¿clearéƒ½æ²¡æœ‰ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å†…æ ¸ç‰ˆæœ¬ï¼š</p><p><img src="PtGwRWfXlTh67qm.jpg" alt="image-20220701140018095"></p><p>å¯ä»¥çœ‹åˆ°å†…æ ¸ç‰ˆæœ¬æ˜¯ä¸€æ ·çš„ï¼ˆè¿™ä¹Ÿæ˜¯ç¼ºç‚¹æ‰€åœ¨ï¼Œå¦‚æœè½¯ä»¶å¯¹å†…æ ¸ç‰ˆæœ¬æœ‰è¦æ±‚çš„è¯ï¼Œé‚£ä¹ˆæ­¤æ—¶ä½¿ç”¨Dockerå°±ç›´æ¥å¯„äº†ï¼‰ï¼Œæˆ‘ä»¬è¾“å…¥<code>exit</code>å°±å¯ä»¥é€€å‡ºå®¹å™¨ç»ˆç«¯äº†ï¼Œå¯ä»¥çœ‹åˆ°é€€å‡ºåå®¹å™¨ä¹Ÿåœæ­¢äº†ï¼š</p><p><img src="u5MQnWVihlbkyx1.jpg" alt="image-20220701140225415"></p><p>å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥å†æ¬¡å¯åŠ¨ï¼Œæ³¨æ„å¯åŠ¨çš„æ—¶å€™è¦åŠ ä¸Š<code>-i</code>æ‰èƒ½è¿›å…¥åˆ°å®¹å™¨è¿›è¡Œäº¤äº’ï¼Œå¦åˆ™ä¼šåœ¨åå°è¿è¡Œï¼š</p><p><img src="QCsY5EyGSja6Khl.jpg" alt="image-20220701140706977"></p><p>åŸºäºbaseé•œåƒï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨è¿™åŸºç¡€ä¸Šå®‰è£…å„ç§å„æ ·çš„è½¯ä»¶çš„äº†ï¼Œå‡ ä¹æ‰€æœ‰çš„é•œåƒéƒ½æ˜¯é€šè¿‡åœ¨baseé•œåƒçš„åŸºç¡€ä¸Šå®‰è£…å’Œé…ç½®éœ€è¦çš„è½¯ä»¶æ„å»ºå‡ºæ¥çš„ï¼š</p><p><img src="SDwEqz2b7lA9nJa.jpg" alt="image-20220701143105247"></p><p>æ¯å®‰è£…ä¸€ä¸ªè½¯ä»¶ï¼Œå°±åœ¨baseé•œåƒä¸Šä¸€å±‚å±‚å åŠ ä¸Šå»ï¼Œé‡‡ç”¨çš„æ˜¯ä¸€ç§åˆ†å±‚çš„ç»“æ„ï¼Œè¿™æ ·å¤šä¸ªå®¹å™¨éƒ½å¯ä»¥å°†è¿™äº›ä¸åŒçš„å±‚æ¬¡è‡ªç”±æ‹¼è£…ï¼Œæ¯”å¦‚ç°åœ¨å¥½å‡ ä¸ªå®¹å™¨éƒ½éœ€è¦ä½¿ç”¨CentOSçš„baseé•œåƒï¼Œè€Œä¸Šé¢è¿è¡Œçš„è½¯ä»¶ä¸åŒï¼Œæ­¤æ—¶åˆ†å±‚ç»“æ„å°±å¾ˆçˆ½äº†ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æœ¬åœ°ä¿å­˜ä¸€ä»½baseé•œåƒï¼Œå°±å¯ä»¥ç»™å¤šä¸ªä¸åŒçš„å®¹å™¨æ‹¼è£…ä½¿ç”¨ï¼Œæ˜¯ä¸æ˜¯æ„Ÿè§‰å¾ˆçµæ´»ï¼Ÿ</p><p>æˆ‘ä»¬çœ‹åˆ°é™¤äº†è¿™äº›è½¯ä»¶ä¹‹å¤–ï¼Œæœ€ä¸Šå±‚è¿˜æœ‰ä¸€ä¸ªå¯å†™å®¹å™¨å±‚ï¼Œè¿™ä¸ªæ˜¯å¹²å˜›çš„å‘¢ï¼Œä¸ºä»€ä¹ˆè¦æ”¾åœ¨æœ€ä¸Šé¢ï¼Ÿ</p><p>æˆ‘ä»¬çŸ¥é“ï¼Œæ‰€æœ‰çš„é•œåƒä¼šå èµ·æ¥ç»„æˆä¸€ä¸ªç»Ÿä¸€çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå¦‚æœä¸åŒå±‚ä¸­å­˜åœ¨ç›¸åŒä½ç½®çš„æ–‡ä»¶ï¼Œé‚£ä¹ˆä¸Šå±‚çš„ä¼šè¦†ç›–æ‰ä¸‹å±‚çš„æ–‡ä»¶ï¼Œæœ€ç»ˆæˆ‘ä»¬çœ‹åˆ°çš„æ˜¯ä¸€ä¸ªå åŠ ä¹‹åçš„æ–‡ä»¶ç³»ç»Ÿã€‚å½“æˆ‘ä»¬éœ€è¦ä¿®æ”¹å®¹å™¨ä¸­çš„æ–‡ä»¶æ—¶ï¼Œå®é™…ä¸Šå¹¶ä¸ä¼šå¯¹é•œåƒè¿›è¡Œç›´æ¥ä¿®æ”¹ï¼Œè€Œæ˜¯åœ¨æœ€é¡¶ä¸Šçš„å®¹å™¨å±‚ï¼ˆæœ€ä¸Šé¢ä¸€èˆ¬ç§°ä¸ºå®¹å™¨å±‚ï¼Œä¸‹é¢éƒ½æ˜¯é•œåƒå±‚ï¼‰è¿›è¡Œä¿®æ”¹ï¼Œä¸ä¼šå½±å“åˆ°ä¸‹é¢çš„é•œåƒï¼Œå¦åˆ™é•œåƒå°±å¾ˆéš¾å®ç°å¤šä¸ªå®¹å™¨å…±äº«äº†ã€‚æ‰€ä»¥å„ä¸ªæ“ä½œå¦‚ä¸‹ï¼š</p><ul><li>æ–‡ä»¶è¯»å–ï¼šè¦è¯»å–ä¸€ä¸ªæ–‡ä»¶ï¼ŒDockerä¼šæœ€ä¸Šå±‚å¾€ä¸‹ä¾æ¬¡å¯»æ‰¾ï¼Œæ‰¾åˆ°ååˆ™æ‰“å¼€æ–‡ä»¶ã€‚</li><li>æ–‡ä»¶åˆ›å»ºå’Œä¿®æ”¹ï¼šåˆ›å»ºæ–°æ–‡ä»¶ä¼šç›´æ¥æ·»åŠ åˆ°å®¹å™¨å±‚ä¸­ï¼Œä¿®æ”¹æ–‡ä»¶ä¼šä»ä¸Šå¾€ä¸‹ä¾æ¬¡å¯»æ‰¾å„ä¸ªé•œåƒä¸­çš„æ–‡ä»¶ï¼Œå¦‚æœæ‰¾åˆ°ï¼Œåˆ™å°†å…¶å¤åˆ¶åˆ°å®¹å™¨å±‚ï¼Œå†è¿›è¡Œä¿®æ”¹ã€‚</li><li>åˆ é™¤æ–‡ä»¶ï¼šåˆ é™¤æ–‡ä»¶ä¹Ÿä¼šä»ä¸Šå¾€ä¸‹ä¾æ¬¡å¯»æ‰¾å„ä¸ªé•œåƒä¸­çš„æ–‡ä»¶ï¼Œä¸€æ—¦æ‰¾åˆ°ï¼Œå¹¶ä¸ä¼šç›´æ¥åˆ é™¤é•œåƒä¸­çš„æ–‡ä»¶ï¼Œè€Œæ˜¯åœ¨å®¹å™¨å±‚æ ‡è®°è¿™ä¸ªåˆ é™¤æ“ä½œã€‚</li></ul><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯¹æ•´ä¸ªå®¹å™¨å†…çš„æ–‡ä»¶è¿›è¡Œçš„æ“ä½œï¼Œå‡ ä¹éƒ½æ˜¯åœ¨æœ€ä¸Šé¢çš„å®¹å™¨å±‚è¿›è¡Œçš„ï¼Œæˆ‘ä»¬æ˜¯æ— æ³•å¹²æ¶‰åˆ°ä¸‹é¢æ‰€æœ‰çš„é•œåƒå±‚æ–‡ä»¶çš„ï¼Œè¿™æ ·å°±å¾ˆå¥½åœ°ä¿æŠ¤äº†é•œåƒçš„å®Œæ•´æ€§ï¼Œæ‰èƒ½å®ç°å¤šä¸ªå®¹å™¨å…±äº«ä½¿ç”¨ã€‚</p><h3 id="æ„å»ºé•œåƒ"><a href="#æ„å»ºé•œåƒ" class="headerlink" title="æ„å»ºé•œåƒ"></a>æ„å»ºé•œåƒ</h3><p>å‰é¢æˆ‘ä»¬å·²ç»äº†è§£äº†Dockeré•œåƒçš„ç»“æ„ï¼Œå®é™…ä¸Šæ‰€æœ‰å¸¸ç”¨çš„åº”ç”¨ç¨‹åºéƒ½æœ‰å¯¹åº”çš„é•œåƒï¼Œæˆ‘ä»¬åªéœ€è¦ä¸‹è½½è¿™äº›é•œåƒç„¶åå°±å¯ä»¥ä½¿ç”¨äº†ï¼Œè€Œä¸éœ€è¦è‡ªå·±å»æ‰‹åŠ¨å®‰è£…ï¼Œé¡¶å¤šéœ€è¦è¿›è¡Œä¸€äº›ç‰¹åˆ«çš„é…ç½®ã€‚å½“ç„¶è¦æ˜¯é‡åˆ°æŸäº›å†·é—¨çš„åº”ç”¨ï¼Œå¯èƒ½æ²¡æœ‰æä¾›é•œåƒï¼Œè¿™æ—¶å°±è¦æˆ‘ä»¬æ‰‹åŠ¨å»å®‰è£…ï¼Œæ¥ç€æˆ‘ä»¬å°±æ¥çœ‹çœ‹å¦‚ä½•æ„å»ºæˆ‘ä»¬è‡ªå·±çš„Dockeré•œåƒã€‚æ„å»ºé•œåƒæœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯ä½¿ç”¨<code>commit</code>å‘½ä»¤æ¥å®Œæˆï¼Œè¿˜æœ‰ä¸€ç§æ˜¯ä½¿ç”¨Dockerfileæ¥å®Œæˆï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ç¬¬ä¸€ç§ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬å°±åšä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œæ¯”å¦‚æˆ‘ä»¬ç°åœ¨æƒ³è¦åœ¨Ubuntuçš„baseé•œåƒä¸­å®‰è£…Javaç¯å¢ƒï¼Œå¹¶å°†å…¶æ‰“åŒ…ä¸ºæ–°çš„é•œåƒï¼ˆè¿™ä¸ªæ–°çš„é•œåƒå°±æ˜¯ä¸€ä¸ªåŒ…å«Javaç¯å¢ƒçš„Ubuntuç³»ç»Ÿé•œåƒï¼‰</p><p>å’±ä»¬å…ˆå¯åŠ¨Ubuntué•œåƒï¼Œç„¶åä½¿ç”¨<code>yum</code>å‘½ä»¤ï¼ˆè·Ÿaptæ¯”è¾ƒç±»ä¼¼ï¼‰æ¥å®‰è£…Javaç¯å¢ƒï¼Œé¦–å…ˆæ˜¯<code>run</code>å‘½ä»¤ï¼š</p><p>â€‹                              </p><p>â€‹        sh        å¤åˆ¶ä»£ç       </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker pull ubuntu<br></code></pre></td></tr></table></figure><p><img src="tP5rhQuqfpxcRHL.jpg" alt="image-20220701151405640"></p><p>æ¥ç€å¯åŠ¨ï¼š</p><p><img src="l86G4dK71UwcZPi.jpg" alt="image-20220701151433520"></p><p>ç›´æ¥ä½¿ç”¨aptå‘½ä»¤æ¥å®‰è£…Javaç¯å¢ƒï¼Œåœ¨è¿™ä¹‹å‰å…ˆæ›´æ–°ä¸€ä¸‹ï¼Œå› ä¸ºæ˜¯æœ€å°å®‰è£…æ‰€ä»¥æœ¬åœ°æ²¡æœ‰ä»»ä½•è½¯ä»¶åŒ…ï¼š</p><p><img src="RAzQr7P8C9aJwxK.jpg" alt="image-20220701151600847"></p><p>æ¥ç€è¾“å…¥ï¼š</p><p>â€‹                              </p><p>â€‹        sh        å¤åˆ¶ä»£ç       </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">apt install openjdk-8-jdk<br></code></pre></td></tr></table></figure><p>ç­‰å¾…å®‰è£…å®Œæˆï¼š</p><p><img src="Fezitl7PDb19BL4.jpg" alt="image-20220701152018041"></p><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†å¯¹Javaç¯å¢ƒçš„å®‰è£…äº†ï¼Œæ¥ç€æˆ‘ä»¬å°±å¯ä»¥é€€å‡ºè¿™ä¸ªé•œåƒç„¶åå°†å…¶æ„å»ºä¸ºæ–°çš„é•œåƒï¼š</p><p><img src="LAIx5GYCJhsbmSo.jpg" alt="image-20220701152130041"></p><p>ä½¿ç”¨<code>commit</code>å‘½ä»¤å¯ä»¥å°†å®¹å™¨ä¿å­˜ä¸ºæ–°çš„é•œåƒï¼š</p><p>â€‹                              </p><p>â€‹        sh        å¤åˆ¶ä»£ç       </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker commit å®¹å™¨åç§°/ID æ–°çš„é•œåƒåç§°<br></code></pre></td></tr></table></figure><p><img src="sbWLlEoMj2ZPcUV.jpg" alt="image-20220701152302171"></p><p><img src="3q4juA8vOJew9W6.jpg" alt="image-20220701152418060"></p><p>å¯ä»¥çœ‹åˆ°å®‰è£…äº†è½¯ä»¶ä¹‹åçš„é•œåƒå¤§å°æ¯”æˆ‘ä»¬åŸæœ‰çš„å¤§å°å¤§å¾—å¤šï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è¿™ä¸ªé•œåƒæ¥ç›´æ¥å¯åŠ¨ä¸€ä¸ªå¸¦Javaç¯å¢ƒçš„Ubuntuæ“ä½œç³»ç»Ÿå®¹å™¨äº†ã€‚ä¸è¿‡è¿™ç§æ–¹å¼è™½ç„¶è‡ªå®šä¹‰åº¦å¾ˆé«˜ï¼Œä½†æ˜¯Dockerå®˜æ–¹å¹¶ä¸æ¨èï¼Œè¿™æ ·çš„è¯ä½¿ç”¨è€…å¹¶ä¸çŸ¥é“é•œåƒæ˜¯å¦‚ä½•æ„å»ºå‡ºæ¥çš„ï¼Œæ˜¯å¦é‡Œé¢å¸¦äº†åé—¨éƒ½ä¸çŸ¥é“ï¼Œå¹¶ä¸”è¿™æ ·å»æ„å»ºæ•ˆç‡å¤ªä½äº†ï¼Œå¦‚æœè¦åŒæ—¶æ„å»ºå¤šç§æ“ä½œç³»ç»Ÿçš„é•œåƒå²‚ä¸æ˜¯è¦ä¸€ä¸ªä¸€ä¸ªå»æ•²ï¼Ÿæˆ‘ä»¬ä½œä¸ºæ™®é€šç”¨æˆ·å®é™…ä¸Šé‡‡ç”¨Dokcerfileçš„æ–¹å¼ä¼šæ›´å¥½ä¸€äº›ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨Dockerfileçš„å½¢å¼åˆ›å»ºä¸€ä¸ªå¸¦Javaç¯å¢ƒçš„Ubuntuç³»ç»Ÿé•œåƒã€‚é¦–å…ˆç›´æ¥æ–°å»ºä¸€ä¸ªåä¸º<code>Dockerfile</code>çš„æ–‡ä»¶ï¼š</p><p>â€‹                              </p><p>â€‹        sh        å¤åˆ¶ä»£ç       </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">touch</span> Dockerfile<br></code></pre></td></tr></table></figure><p>æ¥ç€æˆ‘ä»¬æ¥è¿›è¡Œç¼–è¾‘ï¼Œ<code>Dockerfile</code>å†…éƒ¨éœ€è¦æˆ‘ä»¬ç¼–å†™å¤šç§æŒ‡ä»¤æ¥å‘Šè¯‰Dockeræˆ‘ä»¬çš„é•œåƒçš„ç›¸å…³ä¿¡æ¯ï¼š</p><p>â€‹                              </p><p>â€‹        dockerfile        å¤åˆ¶ä»£ç       </p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> &lt;åŸºç¡€é•œåƒ&gt;<br></code></pre></td></tr></table></figure><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦ä½¿ç”¨FROMæŒ‡ä»¤æ¥é€‰æ‹©å½“å‰é•œåƒçš„åŸºç¡€é•œåƒï¼ˆå¿…é¡»ä»¥è¿™ä¸ªæŒ‡ä»¤å¼€å§‹ï¼‰ï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨<code>ubuntu</code>ä½œä¸ºåŸºç¡€é•œåƒå³å¯ï¼Œå½“ç„¶å¦‚æœä¸éœ€è¦ä»»ä½•åŸºç¡€é•œåƒçš„è¯ï¼Œç›´æ¥ä½¿ç”¨<code>scratch</code>è¡¨ç¤ºä»é›¶å¼€å§‹æ„å»ºï¼Œè¿™é‡Œå°±ä¸æ¼”ç¤ºäº†ã€‚</p><p>åŸºç¡€é•œåƒè®¾å®šå®Œæˆä¹‹åï¼Œæˆ‘ä»¬å°±éœ€è¦åœ¨å®¹å™¨ä¸­è¿è¡Œå‘½ä»¤æ¥å®‰è£…Javaç¯å¢ƒäº†ï¼Œè¿™é‡Œéœ€è¦ä½¿ç”¨<code>RUN</code>æŒ‡ä»¤ï¼š</p><p>â€‹                              </p><p>â€‹        dockerfile        å¤åˆ¶ä»£ç       </p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">RUN</span><span class="language-bash"> apt update</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> apt install -y openjdk-8-jdk</span><br></code></pre></td></tr></table></figure><p>æ¯æ¡æŒ‡ä»¤æ‰§è¡Œä¹‹åï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„é•œåƒå±‚ã€‚</p><p>OKï¼Œç°åœ¨æˆ‘ä»¬çš„Dockerfileå°±ç¼–å†™å®Œæˆäº†ï¼Œåªéœ€è¦å®Œæˆä¸€æ¬¡æ„å»ºå³å¯ï¼š</p><p>â€‹                              </p><p>â€‹        sh        å¤åˆ¶ä»£ç       </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker build -t &lt;é•œåƒåç§°&gt; &lt;æ„å»ºç›®å½•&gt;<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œåï¼ŒDockerä¼šåœ¨æ„å»ºç›®å½•ä¸­å¯»æ‰¾Dockerfileæ–‡ä»¶ï¼Œç„¶åå¼€å§‹ä¾æ¬¡æ‰§è¡ŒDockerfileä¸­çš„æŒ‡ä»¤ï¼š</p><p><img src="g6RFwA5t4EsdvnY.jpg" alt="image-20220701155443170"></p><p>æ„å»ºè¿‡ç¨‹çš„æ¯ä¸€æ­¥éƒ½éå¸¸æ¸…æ™°åœ°åˆ—å‡ºæ¥äº†ï¼Œä¸€å…±ä¸‰æ¡æŒ‡ä»¤å¯¹åº”ä¸‰æ­¥ä¾æ¬¡è¿›è¡Œï¼Œæˆ‘ä»¬ç¨å¾®ç­‰å¾…ä¸€æ®µæ—¶é—´è¿›è¡Œå®‰è£…ï¼Œå®‰è£…è¿‡ç¨‹ä¸­æ‰€ä»¥çš„æ—¥å¿—ä¿¡æ¯ä¼šç›´æ¥æ‰“å°åˆ°æ§åˆ¶å°ï¼ˆæ³¨æ„Dockeré•œåƒæ„å»ºæœ‰ç¼“å­˜æœºåˆ¶ï¼Œå°±ç®—ä½ ç°åœ¨ä¸­é€”é€€å‡ºäº†ï¼Œç„¶åé‡æ–°è¿›è¡Œæ„å»ºï¼Œä¹Ÿä¼šç›´æ¥å°†ä¹‹å‰å·²ç»æ„å»ºå¥½çš„æ¯ä¸€å±‚é•œåƒï¼Œç›´æ¥æ‹¿æ¥ç”¨ï¼Œé™¤éä¿®æ”¹äº†Dockerfileæ–‡ä»¶é‡æ–°æ„å»ºï¼Œåªè¦æŸä¸€å±‚å‘ç”Ÿå˜åŒ–å…¶ä¸Šå±‚çš„æ„å»ºç¼“å­˜éƒ½ä¼šå¤±æ•ˆï¼Œå½“ç„¶åŒ…æ‹¬<code>pull</code>æ—¶ä¹Ÿä¼šæœ‰ç±»ä¼¼çš„æœºåˆ¶ï¼‰</p><p><img src="foLHIZScQ1KVbvC.jpg" alt="image-20220701155812315"></p><p>æœ€åæˆåŠŸå®‰è£…ï¼Œä¼šå‡ºç°åœ¨æœ¬åœ°ï¼š</p><p><img src="95ueUgyaTcrz6Mi.jpg" alt="image-20220701155847721"></p><p>å¯ä»¥çœ‹åˆ°å®‰è£…å‡ºæ¥çš„å¤§å°è·Ÿæˆ‘ä»¬ä¹‹å‰çš„æ˜¯ä¸€æ ·çš„ï¼Œå› ä¸ºåšçš„äº‹æƒ…æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>history</code>å‘½ä»¤æ¥æŸ¥çœ‹æ„å»ºå†å²ï¼š</p><p><img src="GYyHFcjSKJwvWi6.jpg" alt="image-20220701160128689"></p><p>å¯ä»¥çœ‹åˆ°æœ€ä¸Šé¢ä¸¤å±‚æ˜¯æˆ‘ä»¬é€šè¿‡ä½¿ç”¨aptå‘½ä»¤ç”Ÿæˆçš„å†…å®¹ï¼Œå°±ç›´æ¥ä½œä¸ºå½“å‰é•œåƒä¸­çš„ä¸¤å±‚é•œåƒï¼Œæ¯å±‚é•œåƒéƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„IDï¼Œä¸åŒçš„é•œåƒå¤§å°ä¹Ÿä¸ä¸€æ ·ã€‚è€Œæˆ‘ä»¬æ‰‹åŠ¨é€šè¿‡<code>commit</code>å‘½ä»¤æ¥ç”Ÿæˆçš„é•œåƒæ²¡æœ‰è¿™ä¸ªè®°å½•ï¼š</p><p><img src="qWUeSF3aKrvwJ8p.jpg" alt="image-20220701160406891"></p><p>å¦‚æœé‡åˆ°é•œåƒIDä¸ºmissingçš„ä¸€èˆ¬æ˜¯ä»Docker Hubä¸­ä¸‹è½½çš„é•œåƒä¼šæœ‰è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯é—®é¢˜ä¸å¤§ã€‚ç”¨æˆ‘ä»¬è‡ªå·±æ„å»ºçš„é•œåƒæ¥åˆ›å»ºå®¹å™¨å°±å¯ä»¥ç›´æ¥ä½“éªŒå¸¦Javaç¯å¢ƒçš„å®¹å™¨äº†ï¼š</p><p><img src="STmdFvBIbN4VAl1.jpg" alt="image-20220701161546279"></p><p>æœ‰å…³Dockerfileçš„å…¶ä»–å‘½ä»¤ï¼Œæˆ‘ä»¬è¿˜ä¼šåœ¨åç»­çš„å­¦ä¹ ä¸­é€æ­¥è®¤è¯†ã€‚</p><h3 id="å‘å¸ƒé•œåƒåˆ°è¿œç¨‹ä»“åº“"><a href="#å‘å¸ƒé•œåƒåˆ°è¿œç¨‹ä»“åº“" class="headerlink" title="å‘å¸ƒé•œåƒåˆ°è¿œç¨‹ä»“åº“"></a>å‘å¸ƒé•œåƒåˆ°è¿œç¨‹ä»“åº“</h3><p>å‰é¢æˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•æ„å»ºä¸€ä¸ªDockeré•œåƒï¼Œæˆ‘ä»¬å¯ä»¥å°†è‡ªå·±çš„é•œåƒå‘å¸ƒåˆ°Docker Hubä¸­ï¼Œå°±åƒGitè¿œç¨‹ä»“åº“ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥å°†è‡ªå·±çš„é•œåƒä¸Šä¼ åˆ°è¿™é‡Œï¼š<a href="https://hub.docker.com/repositories%EF%BC%8C%E6%B2%A1%E6%9C%89%E8%B4%A6%E5%8F%B7%E7%9A%84%E5%85%88%E5%8E%BB%E8%BF%9B%E8%A1%8C%E6%B3%A8%E5%86%8C%E3%80%82">https://hub.docker.com/repositoriesï¼Œæ²¡æœ‰è´¦å·çš„å…ˆå»è¿›è¡Œæ³¨å†Œã€‚</a></p><p><img src="3T8xJLgER4cWuQq.jpg" alt="image-20220701164609666"></p><p>ç‚¹å‡»å³ä¸Šè§’çš„åˆ›å»ºä»“åº“ï¼Œç„¶åå¡«å†™ä¿¡æ¯ï¼š</p><p><img src="SkCKJmU6Rw2lfzP.jpg" alt="image-20220701164939268"></p><p>åˆ›å»ºå®Œæˆåï¼Œæˆ‘ä»¬å°±æœ‰äº†ä¸€ä¸ªå…¬å…±çš„é•œåƒä»“åº“ï¼Œæˆ‘ä»¬å¯ä»¥å°†æœ¬åœ°çš„é•œåƒä¸Šä¼ äº†ï¼Œä¸Šä¼ ä¹‹å‰æˆ‘ä»¬éœ€è¦å°†é•œåƒåç§°ä¿®æ”¹å¾—è§„èŒƒä¸€ç‚¹ï¼Œè¿™é‡Œä½¿ç”¨<code>tag</code>å‘½ä»¤æ¥é‡æ–°æ‰“æ ‡ç­¾ï¼š</p><p>â€‹                              </p><p>â€‹        sh        å¤åˆ¶ä»£ç       </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker tag ubuntu-java-file:latest ç”¨æˆ·å/ä»“åº“åç§°:ç‰ˆæœ¬<br></code></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬å°†ç‰ˆæœ¬æ”¹æˆ1.0ç‰ˆæœ¬å§ï¼Œä¸ç”¨é»˜è®¤çš„latestäº†ã€‚</p><p><img src="chAPS2DFW5q7GkE.jpg" alt="image-20220701165231001"></p><p>ä¿®æ”¹å®Œæˆåï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æœ¬åœ°é•œåƒï¼Œåç§°å°±æ˜¯æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„äº†ã€‚æ¥ç€æˆ‘ä»¬éœ€åœ¨æœ¬åœ°ç™»å½•ä¸€ä¸‹ï¼š</p><p><img src="T3YC4pfaLEo85Oz.jpg" alt="image-20220701165446859"></p><p>ç™»å½•æˆåŠŸåæˆ‘ä»¬å°±å¯ä»¥ä¸Šä¼ äº†ï¼š</p><p>â€‹                              </p><p>â€‹        sh        å¤åˆ¶ä»£ç       </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker push nagocoler/ubuntu-java:1.0<br></code></pre></td></tr></table></figure><p><img src="CXoBhpZUl79aDRQ.jpg" alt="image-20220701165744647"></p><p>å“ˆå“ˆï¼Œ500Mçš„ä¸œè¥¿ä¼ ä¸Šå»ï¼Œè¿˜æ˜¯æœ‰ç‚¹å‹åŠ›çš„ï¼Œå¦‚æœå®åœ¨å¤ªæ…¢å„ä½å¯ä»¥é‡æ–°åšä¸€ä¸ªç®€å•ç‚¹çš„é•œåƒã€‚ä¸Šä¼ å®Œæˆåï¼Œæ‰“å¼€ä»“åº“ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»æœ‰ä¸€ä¸ª1.0ç‰ˆæœ¬äº†ï¼š</p><p><img src="3UD9y8frEIX1JY6.jpg" alt="image-20220701165920060"></p><p><img src="9sVSjcGCo5mTu61.jpg" alt="image-20220701170053250"></p><p>æ³¨æ„å…¬å…±ä»“åº“æ˜¯å¯ä»¥è¢«æœç´¢å’Œä¸‹è½½çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡ŒæŠŠæœ¬åœ°çš„é•œåƒå…¨éƒ¨åˆ æ‰ï¼Œå»ä¸‹è½½æˆ‘ä»¬åˆšåˆšä¸Šä¼ å¥½çš„é•œåƒã€‚è¿™é‡Œæˆ‘ä»¬å…ˆæœç´¢ä¸€ä¸‹ï¼Œæœç´¢ä½¿ç”¨<code>search</code>å‘½ä»¤å³å¯ï¼š</p><p>â€‹                              </p><p>â€‹        sh        å¤åˆ¶ä»£ç       </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker search nagocoler/ubuntu-java<br></code></pre></td></tr></table></figure><p><img src="SIUpBOzN5vsiydn.jpg" alt="image-20220701170253126"></p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨pullå‘½ä»¤å°†å…¶ä¸‹è½½ä¸‹æ¥ï¼š</p><p>â€‹                              </p><p>â€‹        sh        å¤åˆ¶ä»£ç       </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker pull nagocoler/ubuntu-java:1.0<br></code></pre></td></tr></table></figure><p><img src="uXBk3WPsDM4aZKo.jpg" alt="image-20220701171148334"></p><p>ä¸Šä¼ ä¹‹åçš„é•œåƒæ˜¯è¢«å‹ç¼©è¿‡çš„ï¼Œæ‰€ä»¥ä¸‹è½½çš„å†…å®¹å°±æ¯”è¾ƒå°‘ä¸€äº›ã€‚è¿è¡Œè¯•è¯•çœ‹ï¼š</p><p><img src="RJVdstMnxjSYFoW.jpg" alt="image-20220701171253440"></p><p>å½“ç„¶å„ä½ä¹Ÿå¯ä»¥è®©è‡ªå·±çš„åŒå­¦æˆ–æ˜¯åœ¨å…¶ä»–æœºå™¨ä¸Šå°è¯•ä¸‹è½½è‡ªå·±çš„é•œåƒï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯éƒ½å¯ä»¥æ­£å¸¸è¿è¡Œã€‚</p><p>Docker Hubä¹Ÿå¯ä»¥è‡ªè¡Œæ­å»ºç§æœï¼Œä½†æ˜¯è¿™é‡Œå°±ä¸å¤šåšä»‹ç»äº†ï¼Œè‡³æ­¤ï¼Œæœ‰å…³å®¹å™¨å’Œé•œåƒçš„ä¸€äº›åŸºæœ¬æ“ä½œå°±è®²è§£å¾—å·®ä¸å¤šäº†ã€‚</p><p> å‰å¾€ä¸‹ä¸€éƒ¨åˆ†ç»§ç»­é˜…è¯»ï¼Œå½“å‰ä½äº 1 &#x2F; 3 åˆ†æ®µ</p><p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</p><p>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºæŸç çŸ¥è¯†åº“ç‰ˆæƒæ‰€æœ‰ï¼Œç¦æ­¢ä¸€åˆ‡æœªç»æˆæƒçš„è½¬è½½ã€å‘å¸ƒã€å‡ºå”®ç­‰è¡Œä¸ºï¼Œè¿è€…å°†è¢«è¿½ç©¶æ³•å¾‹è´£ä»»ã€‚</p><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://www.itbaima.cn/document/zj9uvg0sp3b0sok8">https://www.itbaima.cn/document/zj9uvg0sp3b0sok8</a></p>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è®¾è®¡æ¨¡å¼-è¡Œä¸ºå‹</title>
    <link href="/post/1c1b547d-7703-4fbf-a6ac-730f751693e2/"/>
    <url>/post/1c1b547d-7703-4fbf-a6ac-730f751693e2/</url>
    
    <content type="html"><![CDATA[<h3 id="è®¾è®¡æ¨¡å¼-è¡Œä¸ºå‹"><a href="#è®¾è®¡æ¨¡å¼-è¡Œä¸ºå‹" class="headerlink" title="è®¾è®¡æ¨¡å¼-è¡Œä¸ºå‹"></a>è®¾è®¡æ¨¡å¼-è¡Œä¸ºå‹</h3><p><code>hexo template generate by typora plugin templater</code></p><p><img src="CratwlYFIfVnH7q-1720456464219-241.jpg" alt="image-20230301112135747"></p><h1 id="è®¾è®¡æ¨¡å¼ï¼ˆè¡Œä¸ºå‹ï¼‰"><a href="#è®¾è®¡æ¨¡å¼ï¼ˆè¡Œä¸ºå‹ï¼‰" class="headerlink" title="è®¾è®¡æ¨¡å¼ï¼ˆè¡Œä¸ºå‹ï¼‰"></a>è®¾è®¡æ¨¡å¼ï¼ˆè¡Œä¸ºå‹ï¼‰</h1><p>å‰é¢æˆ‘ä»¬å·²ç»å­¦ä¹ äº†12ç§è®¾è®¡æ¨¡å¼ï¼Œåˆ†ä¸ºä¸¤ç±»ï¼š</p><ul><li>åˆ›å»ºå‹ï¼šå…³æ³¨å¯¹è±¡åˆ›å»º</li><li>ç»“æ„å‹ï¼šå…³æ³¨ç±»å’Œå¯¹è±¡çš„ç»“æ„ç»„ç»‡</li></ul><p>æˆ‘ä»¬æ¥ç€æ¥çœ‹æœ€åä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œä¹Ÿæ˜¯æœ€å¤šçš„ä¸€ç§ï¼Œè¡Œä¸ºå‹è®¾è®¡æ¨¡å¼å…³æ³¨ç³»ç»Ÿä¸­å¯¹è±¡ä¹‹é—´çš„äº¤äº’ï¼Œç ”ç©¶ç³»ç»Ÿåœ¨è¿è¡Œæ—¶å¯¹è±¡ä¹‹é—´çš„ç›¸äº’é€šä¿¡ä¸åä½œï¼Œè¿›ä¸€æ­¥æ˜ç¡®å¯¹è±¡çš„èŒè´£ã€‚</p><h2 id="è§£é‡Šå™¨æ¨¡å¼"><a href="#è§£é‡Šå™¨æ¨¡å¼" class="headerlink" title="è§£é‡Šå™¨æ¨¡å¼"></a>è§£é‡Šå™¨æ¨¡å¼</h2><p>è¿™ç§æ¨¡å¼çš„ä½¿ç”¨åœºæ™¯è¾ƒå°‘ï¼Œå¾ˆå°‘ä½¿ç”¨çš„ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œè¿™é‡Œæä¸€ä¸‹å°±è¡Œã€‚</p><p>è§£é‡Šå™¨é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¯¹æˆ‘ä»¬çš„è¯­è¨€è¿›è¡Œè§£é‡Šï¼Œæ ¹æ®ä¸åŒçš„è¯­ä¹‰æ¥åšä¸åŒçš„äº‹æƒ…ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨SEä¸­å­¦ä¹ çš„åŒæ ˆè®¡ç®—å™¨ï¼Œæ­£æ˜¯æ ¹æ®æˆ‘ä»¬è¾“å…¥çš„ç®—å¼ï¼Œå»è¿›è¡Œè§£æï¼Œå¹¶æ ¹æ®ä¸åŒçš„è¿ç®—ç¬¦æ¥ä¸æ–­è¿›è¡Œè®¡ç®—ã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬è¾“å…¥ï¼š1+2*3</p><p>é‚£ä¹ˆè®¡ç®—å™¨å°±ä¼šè¿›è¡Œè§£æç„¶åæ ¹æ®è¯­ä¹‰ä¼˜å…ˆè®¡ç®—2*3çš„ç»“æœç„¶ååœ¨è®¡ç®—1+6æœ€åå¾—åˆ°7ï¼Œè¯¦ç»†å®ç°è¯·å‚è€ƒJavaSEç¯‡åŒæ ˆè®¡ç®—å™¨å®ç°ã€‚</p><h2 id="æ¨¡æ¿æ–¹æ³•æ¨¡å¼"><a href="#æ¨¡æ¿æ–¹æ³•æ¨¡å¼" class="headerlink" title="æ¨¡æ¿æ–¹æ³•æ¨¡å¼"></a>æ¨¡æ¿æ–¹æ³•æ¨¡å¼</h2><p>æ¨¡æ¿æ–¹æ³•æ¨¡å¼æˆ‘ä»¬ä¹‹å‰ä¹Ÿè§åˆ°è¿‡è®¸å¤šï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ä»€ä¹ˆæ˜¯æ¨¡æ¿æ–¹æ³•ã€‚</p><p>æœ‰äº›æ—¶å€™ï¼Œæˆ‘ä»¬çš„ä¸šåŠ¡å¯èƒ½éœ€è¦ç»å†å¾ˆå¤šä¸ªæ­¥éª¤æ¥å®Œæˆï¼Œæ¯”å¦‚æˆ‘ä»¬ç”Ÿç—…äº†åœ¨åŒ»é™¢çœ‹ç—…ï¼Œé¦–å…ˆæ˜¯å»é—¨è¯ŠæŒ‚å·ï¼Œç„¶åç­‰å¾…å«å·ï¼Œç„¶åæ˜¯å»æ‰¾åŒ»ç”Ÿçœ‹ç—…ï¼Œç¡®å®šç—…å› åï¼Œå°±æ ¹æ®åŒ»ç”Ÿçš„å¤„æ–¹å»å‰å°å¼€è¯ï¼Œæœ€åä»˜é’±ã€‚è¿™ä¸€æ•´å¥—æµç¨‹çœ‹ä¼¼æ˜¯è§„è§„çŸ©çŸ©çš„ï¼Œä½†æ˜¯åœ¨è¿™å…¶ä¸­ï¼ŒæŸäº›æ­¥éª¤å¹¶ä¸æ˜¯ç¡®å®šçš„ï¼Œæ¯”å¦‚åŒ»ç”Ÿçœ‹ç—…è¿™ä¸€æ­¥ï¼Œç”±äºä¸åŒçš„ç—…å› ï¼Œå¯èƒ½ä¼šè¿›è¡Œä¸åŒçš„å¤„ç†ï¼Œæœ€åå¼€å‡ºæ¥çš„è¯æ–¹ä¹Ÿä¼šä¸åŒï¼Œæ‰€ä»¥ï¼Œæ•´å¥—æµç¨‹ä¸­ï¼Œæœ‰äº›æ“ä½œæ˜¯å›ºå®šçš„ï¼Œæœ‰äº›æ“ä½œå¯èƒ½éœ€è¦æ ¹æ®å…·ä½“æƒ…å†µè€Œå®šã€‚</p><p><img src="PjOsmFXyI2Cl3pU.jpg" alt="image-20230301112153648"></p><p>åœ¨æˆ‘ä»¬çš„ç¨‹åºä¸­ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå¯èƒ½æŸäº›æ“ä½œæ˜¯å›ºå®šçš„ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥åœ¨ç±»ä¸­å¯¹åº”æ–¹æ³•è¿›è¡Œç¼–å†™ï¼Œä½†æ˜¯å¯èƒ½æŸäº›æ“ä½œéœ€è¦è§†æƒ…å†µè€Œå®šï¼Œç”±ä¸åŒçš„å­ç±»å®ç°æ¥å†³å®šï¼Œè¿™æ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦è®©è¿™äº›æ“ä½œç”±å­ç±»æ¥å»¶è¿Ÿå®ç°äº†ã€‚ç°åœ¨æˆ‘ä»¬å°±éœ€è¦ç”¨åˆ°æ¨¡æ¿æ–¹æ³•æ¨¡å¼ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥å†™ä¸ªä¾‹å­ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æŠ½è±¡è¯Šæ–­æ–¹æ³•ï¼Œå› ä¸ºç°åœ¨åªçŸ¥é“æŒ‚å·å’Œçœ‹åŒ»ç”Ÿæ˜¯å›ºå®šæ¨¡å¼ï¼Œå‰©ä¸‹çš„å¼€å¤„æ–¹å’Œæ‹¿è¯éƒ½æ˜¯ä¸ç¡®å®šçš„</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AbstractDiagnosis</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;ä»Šå¤©å¤´å¥½æ™•ï¼Œä¸æƒ³èµ·åºŠï¼Œå¼€æ‘†ï¼Œå…ˆè·Ÿå…¬å¸è¯·ä¸ªå‡&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;å»åŒ»é™¢çœ‹ç—…äº†~&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;1 &gt;&gt; å…ˆæŒ‚å·&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;2 &gt;&gt; ç­‰å¾…å«å·&quot;</span>);<br>        <span class="hljs-comment">//ç”±äºç°åœ¨ä¸çŸ¥é“è¯¥å¼€ä»€ä¹ˆå¤„æ–¹ï¼Œæ‰€ä»¥åªèƒ½å…ˆå®šä¹‰ä¸€ä¸‹è¡Œä¸ºï¼Œç„¶åå…·ä½“ç”±å­ç±»å®ç°</span><br>      <span class="hljs-comment">//å¤§è‡´çš„æµç¨‹å…ˆå®šä¹‰å¥½å°±è¡Œ</span><br>        <span class="hljs-built_in">this</span>.prescribe();<br>        <span class="hljs-built_in">this</span>.medicine();  <span class="hljs-comment">//å¼€è¯åŒç†</span><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">prescribe</span><span class="hljs-params">()</span>;   <span class="hljs-comment">//å¼€å¤„æ–¹æ“ä½œæ ¹æ®å…·ä½“ç—…ç—‡å†³å®šäº†</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">medicine</span><span class="hljs-params">()</span>;   <span class="hljs-comment">//æ‹¿è¯ä¹Ÿæ˜¯æ ¹æ®å…·ä½“çš„å¤„æ–¹å»æ‹¿</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬å®šä¹‰å¥½äº†æŠ½è±¡æ–¹æ³•ï¼Œåªæ˜¯å°†å…·ä½“çš„æµç¨‹å…ˆå®šä¹‰å‡ºæ¥äº†ï¼Œä½†æ˜¯éƒ¨åˆ†æ–¹æ³•éœ€è¦æ ¹æ®å®ç°å†³å®šï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ„Ÿå†’ç›¸å…³çš„å…·ä½“å®ç°å­ç±»</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ColdDiagnosis</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractDiagnosis</span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">prescribe</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;3 &gt;&gt; ä¸€çœ¼ä¸çœŸï¼Œé‰´å®šä¸ºå‡ï¼Œä½ è¿™ä¸æ˜¯æ„Ÿå†’ï¼Œçº¯ç²¹æ˜¯æƒ³æ‘†çƒ‚&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">medicine</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;4 &gt;&gt; å¼€ç‚¹å¤´å­¢å›å»åƒå§&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±æœ‰äº†ä¸€ä¸ªå…·ä½“çš„å®ç°ç±»ï¼Œå¹¶ä¸”ç”±äºçœ‹ç—…çš„é€»è¾‘å·²ç»ç”±çˆ¶ç±»å®šä¹‰å¥½äº†ï¼Œæ‰€ä»¥å­ç±»åªéœ€è¦å®ç°éœ€è¦å®ç°çš„éƒ¨åˆ†å³å¯ï¼Œè¿™æ ·æˆ‘ä»¬å°±å®ç°äº†ç®€å•çš„æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">AbstractDiagnosis</span> <span class="hljs-variable">diagnosis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ColdDiagnosis</span>();<br>    diagnosis.test();<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="IVyz42i1brvUWfl.jpg" alt="image-20230301112206668"></p><p>æœ€åæˆ‘ä»¬æ¥çœ‹çœ‹åœ¨JUCä¸­è®²è§£AQSæºç å®ç°ä¸­å‡ºç°çš„ä»£ç ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">release</span><span class="hljs-params">(<span class="hljs-type">int</span> arg)</span> &#123;    <span class="hljs-comment">//AQSçš„é”é‡Šæ”¾æ“ä½œ</span><br>    <span class="hljs-keyword">if</span> (tryRelease(arg)) &#123;   <span class="hljs-comment">//å¯ä»¥çœ‹åˆ°è¿™é‡Œè°ƒç”¨äº†tryReleaseæ–¹æ³•ï¼Œä½†æ˜¯æ­¤æ–¹æ³•å¹¶ä¸æ˜¯åœ¨AQSå®ç°çš„ï¼Œè€Œæ˜¯ä¸åŒçš„é”è‡ªè¡Œå®ç°ï¼Œå› ä¸ºAQSä¹Ÿä¸çŸ¥é“ä½ è¿™ç§ç±»å‹çš„é”åˆ°åº•è¯¥æ€ä¹ˆå»è§£é”</span><br>        <span class="hljs-type">Node</span> <span class="hljs-variable">h</span> <span class="hljs-operator">=</span> head;<br>        <span class="hljs-keyword">if</span> (h != <span class="hljs-literal">null</span> &amp;&amp; h.waitStatus != <span class="hljs-number">0</span>)<br>            unparkSuccessor(h);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br><br><span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryRelease</span><span class="hljs-params">(<span class="hljs-type">int</span> arg)</span> &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>();   <span class="hljs-comment">//AQSä¸­ä¸æ”¯æŒï¼Œéœ€è¦å»¶è¿Ÿåˆ°å…·ä½“çš„å­ç±»å»å®ç°</span><br>&#125;<br></code></pre></td></tr></table></figure><p>æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼Œå®é™…ä¸Šéƒ¨åˆ†åŠŸèƒ½çš„å®ç°æ˜¯åœ¨å­ç±»å®Œæˆçš„ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryRelease</span><span class="hljs-params">(<span class="hljs-type">int</span> releases)</span> &#123;   <br>  <span class="hljs-comment">//ReentrantLockä¸­çš„AQS Syncå®ç°ç±»ï¼Œå¯¹tryReleaseæ–¹æ³•è¿›è¡Œäº†å…·ä½“å®ç°</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> getState() - releases;<br>    <span class="hljs-keyword">if</span> (Thread.currentThread() != getExclusiveOwnerThread())<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalMonitorStateException</span>();<br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">free</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">if</span> (c == <span class="hljs-number">0</span>) &#123;<br>        free = <span class="hljs-literal">true</span>;<br>        setExclusiveOwnerThread(<span class="hljs-literal">null</span>);<br>    &#125;<br>    setState(c);<br>    <span class="hljs-keyword">return</span> free;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ˜¯ä¸æ˜¯ç°åœ¨æ„Ÿè§‰ï¼Œè¿™ç§å±‚å±‚å¥—å¨ƒçš„å†™æ³•ï¼Œå¥½åƒå¹¶ä¸æ˜¯è¿™äº›å¤§ä½¬æ•…æ„ä¸ºäº†è£…é€¼æ‰è¿™æ ·å†™çš„ï¼Œè€Œæ˜¯çœŸçš„åœ¨éµå®ˆè§„èŒƒç¼–å†™ï¼Œè®©ä»£ç æ›´æ˜“æ‡‚ä¸€äº›ï¼Œç”šè‡³ä½ ç°åœ¨å†å›å»æ¨ä¸€éä¼šå‘ç°æ€è·¯éå¸¸æ¸…æ™°ã€‚å½“ç„¶ï¼Œé™¤äº†è¿™é‡Œä¹‹å¤–ï¼Œè¿˜æœ‰å¾ˆå¤šæ¡†æ¶éƒ½ä½¿ç”¨äº†æ¨¡æ¿æ–¹æ³•æ¨¡å¼æ¥è®¾è®¡ç±»ç»“æ„ï¼Œè¿˜è¯·å„ä½å°ä¼™ä¼´è‡ªè¡Œæ¢ç´¢ã€‚</p><h2 id="è´£ä»»é“¾æ¨¡å¼"><a href="#è´£ä»»é“¾æ¨¡å¼" class="headerlink" title="è´£ä»»é“¾æ¨¡å¼"></a>è´£ä»»é“¾æ¨¡å¼</h2><p>è´£ä»»é“¾æ¨¡å¼ä¹Ÿéå¸¸å¥½ç†è§£ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„é’‰é’‰å®¡æ‰¹ï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€æ¡æµæ°´çº¿ä¸€æ ·çš„æ“ä½œï¼Œç”±ä½ å‘èµ·ç”³è¯·ï¼Œç„¶åç»è¿‡å¤šä¸ªéƒ¨é—¨ä¸»ç®¡å®¡æ‰¹ï¼Œæœ€åæ‰èƒ½é€šè¿‡ï¼Œæ‰€ä»¥ä½ çš„ç”³è¯·è¡¨ç›¸å½“äºæ˜¯åœ¨ä¸€æ¡è´£ä»»é“¾ä¸Šä¼ é€’ã€‚å½“ç„¶é™¤äº†è¿™æ ·çš„ç›´çº¿å‹è´£ä»»é“¾ä¹‹å¤–ï¼Œè¿˜æœ‰ç¯å½¢ã€æ ‘å½¢ç­‰ã€‚</p><p><img src="l4C6SmDYKb2QeTi.jpg" alt="image-20230301112223069"></p><p>å®é™…ä¸Šæˆ‘ä»¬ä¹‹å‰ä¹Ÿé‡åˆ°è¿‡å¾ˆå¤šç§è´£ä»»é“¾ï¼Œæ¯”å¦‚JavaWebä¸­å­¦ä¹ çš„Filterè¿‡æ»¤å™¨ï¼Œæ­£æ˜¯é‡‡ç”¨çš„è´£ä»»é“¾æ¨¡å¼ï¼Œé€šè¿‡å°†è¯·æ±‚ä¸€çº§ä¸€çº§ä¸æ–­å‘ä¸‹ä¼ é€’ï¼Œæ¥å¯¹æˆ‘ä»¬æ‰€éœ€è¦çš„è¯·æ±‚è¿›è¡Œè¿‡æ»¤å’Œå¤„ç†ã€‚</p><p><img src="gO5IUmS17tQouAh.jpg" alt="image-20230301112235576"></p><p>è¿™é‡Œæˆ‘ä»¬å°±ä½¿ç”¨è´£ä»»é“¾æ¨¡å¼æ¥æ¨¡æ‹Ÿä¸€ä¸ªç®€å•çš„é¢è¯•è¿‡ç¨‹ï¼Œæˆ‘ä»¬é¢è¯•ä¹Ÿæ˜¯ä¸€é¢äºŒé¢ä¸‰é¢è¿™æ ·èµ°çš„æµç¨‹ï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆè®¾è®¡ä¸€ä¸‹è´£ä»»é“¾ä¸Šçš„å„ä¸ªå¤„ç†å™¨ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Handler</span> &#123;<br><br>    <span class="hljs-keyword">protected</span> Handler successor;    <span class="hljs-comment">//è¿™é‡Œæˆ‘ä»¬å°±è®¾è®¡è´£ä»»é“¾ä»¥å•é“¾è¡¨å½¢å¼å­˜åœ¨ï¼Œè¿™é‡Œå­˜æ”¾åç»§èŠ‚ç‚¹</span><br><br>    <span class="hljs-keyword">public</span> Handler <span class="hljs-title function_">connect</span><span class="hljs-params">(Handler successor)</span>&#123;     <span class="hljs-comment">//æ‹¼æ¥åç»­èŠ‚ç‚¹</span><br>        <span class="hljs-built_in">this</span>.successor = successor;<br>        <span class="hljs-keyword">return</span> successor;  <span class="hljs-comment">//è¿™é‡Œè¿”å›åç»§èŠ‚ç‚¹ï¼Œæ–¹ä¾¿æˆ‘ä»¬ä¸€ä¼šé“¾å¼è°ƒç”¨</span><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-built_in">this</span>.doHandle();   <span class="hljs-comment">//ç”±ä¸åŒçš„å­ç±»å®ç°å…·ä½“å¤„ç†è¿‡ç¨‹</span><br>        Optional<br>                .ofNullable(successor)<br>                .ifPresent(Handler::handle);    <span class="hljs-comment">//è´£ä»»é“¾ä¸Šå¦‚æœè¿˜æœ‰åç»§èŠ‚ç‚¹ï¼Œå°±ç»§ç»­å‘ä¸‹ä¼ é€’</span><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doHandle</span><span class="hljs-params">()</span>;   <span class="hljs-comment">//ç»“åˆä¸ŠèŠ‚è¯¾å­¦ä¹ çš„æ¨¡æ¿æ–¹æ³•ï¼Œäº¤ç»™å­ç±»å®ç°</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å› ä¸ºé¢è¯•æœ‰å¾ˆå¤šè½®ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œåˆ›å»ºå‡ ä¸ªå¤„ç†å™¨çš„å®ç°ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FirstHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Handler</span>&#123;   <span class="hljs-comment">//ç”¨äºä¸€é¢çš„å¤„ç†å™¨</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doHandle</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;============= ç™½é©¬ç¨‹åºå‘˜ä¸€é¢ ==========&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;1. è°ˆè°ˆä½ å¯¹staticå…³é”®å­—çš„ç†è§£ï¼Ÿ&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;2. å†…éƒ¨ç±»å¯ä»¥è°ƒç”¨å¤–éƒ¨çš„æ•°æ®å—ï¼Ÿå¦‚æœæ˜¯é™æ€çš„å‘¢ï¼Ÿ&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;3. hashCode()æ–¹æ³•æ˜¯æ‰€æœ‰çš„ç±»éƒ½æœ‰å—ï¼Ÿé»˜è®¤è¿”å›çš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;ä»¥ä¸Šé—®é¢˜ä¼šçš„ï¼Œå¯ä»¥ä¾æ¬¡æ‰“åœ¨è¯„è®ºåŒº&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecondHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Handler</span>&#123;  <span class="hljs-comment">//äºŒé¢</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doHandle</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;============= ç™½é©¬ç¨‹åºå‘˜äºŒé¢ ==========&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;1. å¦‚æœæˆ‘ä»¬è‡ªå·±åˆ›å»ºä¸€ä¸ªjava.langåŒ…å¹¶ä¸”ç¼–å†™ä¸€ä¸ªStringç±»ï¼Œèƒ½å¦å®ç°è¦†ç›–JDKé»˜è®¤çš„ï¼Ÿ&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;2. HashMapçš„è´Ÿè½½å› å­æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿå˜åŒ–è§„å¾‹æ˜¯ä»€ä¹ˆï¼Ÿ&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;3. çº¿ç¨‹æ± çš„è¿ä½œæœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿ&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;4. ReentrantLockå…¬å¹³é”å’Œéå…¬å¹³é”çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;ä»¥ä¸Šé—®é¢˜ä¼šçš„ï¼Œå¯ä»¥ä¾æ¬¡æ‰“åœ¨è¯„è®ºåŒº&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThirdHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Handler</span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doHandle</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;============= ç™½é©¬ç¨‹åºå‘˜ä¸‰é¢ ==========&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;1. synchronizedå…³é”®å­—äº†è§£å—ï¼Ÿå¦‚ä½•ä½¿ç”¨ï¼Ÿåº•å±‚æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;2. IOå’ŒNIOçš„åŒºåˆ«åœ¨å“ªé‡Œï¼ŸNIOä¸‰å¤§æ ¸å¿ƒç»„ä»¶ï¼Ÿ&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;3. TCPæ¡æ‰‹å’ŒæŒ¥æ‰‹æµç¨‹ï¼Ÿå°‘ä¸€æ¬¡æ¡æ‰‹å¯ä»¥å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;4. æ“ä½œç³»ç»Ÿä¸­PCBæ˜¯åšä»€ä¹ˆçš„ï¼Ÿè¿è¡Œæœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿ&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;ä»¥ä¸Šé—®é¢˜ä¼šçš„ï¼Œå¯ä»¥ä¾æ¬¡æ‰“åœ¨è¯„è®ºåŒº&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬å°±ç¼–å†™å¥½äº†æ¯ä¸€è½®çš„é¢è¯•æµç¨‹ï¼Œç°åœ¨æˆ‘ä»¬å°±å¯ä»¥æ„å»ºä¸€ä¸ªè´£ä»»é“¾äº†ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">Handler</span> <span class="hljs-variable">handler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FirstHandler</span>();  <span class="hljs-comment">//ä¸€é¢é¦–å½“å…¶å†²</span><br>    handler<br>            .connect(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SecondHandler</span>())   <span class="hljs-comment">//ç»§ç»­è¿æ¥äºŒé¢å’Œä¸‰é¢</span><br>            .connect(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ThirdHandler</span>());<br>    handler.handle();   <span class="hljs-comment">//å¼€å§‹é¢è¯•</span><br>&#125; <br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æœ€åç»“æœä¹Ÿæ˜¯æŒ‰ç…§æˆ‘ä»¬çš„è´£ä»»é“¾æ¥è¿›è¡Œçš„ã€‚</p><h2 id="å‘½ä»¤æ¨¡å¼"><a href="#å‘½ä»¤æ¨¡å¼" class="headerlink" title="å‘½ä»¤æ¨¡å¼"></a>å‘½ä»¤æ¨¡å¼</h2><p>å¤§å®¶æœ‰æ²¡æœ‰å‘ç°ç°åœ¨çš„å®¶ç”µéƒ½åœ¨è¶‹å‘äºæ™ºèƒ½åŒ–ï¼Œé€šè¿‡ä¸€ä¸ªä¸­å¤®æ§åˆ¶å™¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹å®¶é‡Œçš„å¾ˆå¤šç”µå™¨è¿›è¡Œæ§åˆ¶ï¼Œæ¯”å¦‚å›½å†…åšçš„æ¯”è¾ƒå¥½çš„å°ç±³æ™ºèƒ½å®¶å±…ç³»åˆ—ï¼Œè¿˜æœ‰Appleçš„HomeKitç­‰ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ä¸€ä¸ªç»ˆç«¯ä¸Šè¿›è¡Œæ“ä½œï¼Œå°±å¯ä»¥éšä¾¿æ§åˆ¶å®¶é‡Œçš„ç”µå™¨ã€‚</p><p><img src="SuaYPFW4kojctM6.jpg" alt="image-20230301112308454"></p><p>æ¯”å¦‚ç°åœ¨æˆ‘ä»¬æœ‰å¾ˆå¤šçš„ç±»ï¼Œå½©ç”µã€å†°ç®±ã€ç©ºè°ƒã€æ´—è¡£æœºã€çƒ­æ°´å™¨ç­‰ï¼Œæ—¢ç„¶ç°åœ¨æˆ‘ä»¬è¦é€šè¿‡ä¸€ä¸ªé¥æ§å™¨å»æ§åˆ¶ä»–ä»¬ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦å°†æ§åˆ¶è¿™äº›ç”µå™¨çš„æŒ‡ä»¤éƒ½ç»™è®¾è®¡å¥½æ‰è¡Œï¼Œå¹¶ä¸”è¿˜ä¸èƒ½æœ‰å¤ªå¼ºçš„å…³è”æ€§ã€‚</p><p>æ‰€æœ‰çš„ç”µå™¨è‚¯å®šéœ€è¦é€šè¿‡è“ç‰™æˆ–æ˜¯çº¢å¤–çº¿æ¥å—é¥æ§å™¨å‘é€çš„è¯·æ±‚ï¼Œæ‰€ä»¥æ‰€æœ‰çš„ç”µå™¨éƒ½æ˜¯æ¥æ”¶è€…ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Receiver</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">action</span><span class="hljs-params">()</span>;   <span class="hljs-comment">//å…·ä½“è¡Œä¸ºï¼Œè¿™é‡Œå°±å†™ä¸€ä¸ªç®—äº†</span><br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ç€æˆ‘ä»¬è¦æ§åˆ¶è¿™äº›ç”µå™¨ï¼Œé‚£ä¹ˆè‚¯å®šéœ€è¦ä¸€ä¸ªæŒ‡ä»¤æ‰èƒ½æ§åˆ¶ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Command</span> &#123;   <span class="hljs-comment">//æŒ‡ä»¤æŠ½è±¡ï¼Œä¸åŒçš„ç”µå™¨æœ‰æŒ‡ä»¤</span><br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Receiver receiver;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-title function_">Command</span><span class="hljs-params">(Receiver receiver)</span>&#123;   <span class="hljs-comment">//æŒ‡å®šæ­¤å‘½ä»¤å¯¹åº”çš„ç”µå™¨ï¼ˆæ¥å—è€…ï¼‰</span><br>        <span class="hljs-built_in">this</span>.receiver = receiver;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">()</span> &#123;<br>        receiver.action();   <span class="hljs-comment">//æ‰§è¡Œå‘½ä»¤ï¼Œå®é™…ä¸Šå°±æ˜¯è®©æ¥æ”¶è€…å¼€å§‹å¹²æ´»</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æœ€åæˆ‘ä»¬æ¥å®‰æ’ä¸€ä¸ªé¥æ§å™¨ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Controller</span> &#123;   <span class="hljs-comment">//é¥æ§å™¨åªéœ€è¦æŠŠæˆ‘ä»¬çš„æŒ‡ä»¤å‘å‡ºå»å°±è¡Œäº†</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">call</span><span class="hljs-params">(Command command)</span>&#123;<br>        command.execute();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¯”å¦‚ç°åœ¨æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç©ºè°ƒï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä½œä¸ºæˆ‘ä»¬å‘½ä»¤çš„æ¥æ”¶è€…ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AirConditioner</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Receiver</span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">action</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;ç©ºè°ƒå·²å¼€å¯ï¼Œå‘¼å‘¼å‘¼&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¼€å¯ç©ºè°ƒçš„å‘½ä»¤ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OpenCommand</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Command</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">OpenCommand</span><span class="hljs-params">(AirConditioner airConditioner)</span> &#123;<br>        <span class="hljs-built_in">super</span>(airConditioner);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æœ€åæˆ‘ä»¬åªéœ€è¦é€šè¿‡é¥æ§å™¨å‘é€å‡ºå»å°±å¯ä»¥äº†ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">AirConditioner</span> <span class="hljs-variable">airConditioner</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AirConditioner</span>();   <span class="hljs-comment">//å…ˆåˆ›å»ºä¸€ä¸ªç©ºè°ƒ</span><br>    Controller.call(<span class="hljs-keyword">new</span> <span class="hljs-title class_">OpenCommand</span>(airConditioner));   <span class="hljs-comment">//ç›´æ¥é€šè¿‡é¥æ§å™¨æ¥å‘é€ç©ºè°ƒå¼€å¯å‘½ä»¤</span><br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œé¥æ§å™¨è¿™ä¸ªè§’è‰²å¹¶ä¸éœ€è¦çŸ¥é“å…·ä½“ä¼šæ‰§è¡Œä»€ä¹ˆï¼Œåªéœ€è¦å‘é€å‘½ä»¤å³å¯ï¼Œé¥æ§å™¨å’Œç”µå™¨çš„å…³è”æ€§å°±ä¸å†é‚£ä¹ˆå¼ºäº†ã€‚</p><h2 id="è¿­ä»£å™¨æ¨¡å¼"><a href="#è¿­ä»£å™¨æ¨¡å¼" class="headerlink" title="è¿­ä»£å™¨æ¨¡å¼"></a>è¿­ä»£å™¨æ¨¡å¼</h2><p>è¿­ä»£å™¨æˆ‘ä»¬åœ¨JavaSEç¯‡å°±å·²ç»è®²è§£è¿‡äº†ï¼Œè¿­ä»£å™¨å¯ä»¥è¯´æ˜¯æˆ‘ä»¬å­¦ä¹ Javaè¯­è¨€çš„åŸºç¡€ï¼Œæ²¡æœ‰è¿­ä»£å™¨ï¼Œé›†åˆç±»çš„éå†å°±æˆäº†é—®é¢˜ï¼Œæ­£æ˜¯å› ä¸ºæœ‰è¿­ä»£å™¨çš„å­˜åœ¨ï¼Œæˆ‘ä»¬æ‰èƒ½æ›´åŠ ä¼˜é›…çš„ä½¿ç”¨foreachè¯­æ³•ã€‚</p><p>å›é¡¾æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨è¿­ä»£å™¨çš„åœºæ™¯ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    List&lt;String&gt; list = Arrays.asList(<span class="hljs-string">&quot;AAA&quot;</span>, <span class="hljs-string">&quot;BBB&quot;</span>, <span class="hljs-string">&quot;CCC&quot;</span>);<br>    <span class="hljs-keyword">for</span> (String s : list) &#123;   <span class="hljs-comment">//ä½¿ç”¨foreachè¯­æ³•ç³–è¿›è¡Œè¿­ä»£ï¼Œä¾æ¬¡è·å–æ¯ä¸€ä¸ªå…ƒç´ </span><br>        System.out.println(s);   <span class="hljs-comment">//æ‰“å°ä¸€ä¸‹</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç¼–è¯‘ä¹‹åçš„ä»£ç å¦‚ä¸‹ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    List&lt;String&gt; list = Arrays.asList(<span class="hljs-string">&quot;AAA&quot;</span>, <span class="hljs-string">&quot;BBB&quot;</span>, <span class="hljs-string">&quot;CCC&quot;</span>);<br>    <span class="hljs-type">Iterator</span> <span class="hljs-variable">var2</span> <span class="hljs-operator">=</span> list.iterator();   <span class="hljs-comment">//å®é™…ä¸Šè¿™é‡Œæœ¬è´¨æ˜¯é€šè¿‡Listç”Ÿæˆçš„è¿­ä»£å™¨æ¥éå†æˆ‘ä»¬æ¯ä¸ªå…ƒç´ çš„</span><br><br>    <span class="hljs-keyword">while</span>(var2.hasNext()) &#123;   <span class="hljs-comment">//åˆ¤æ–­æ˜¯å¦è¿˜æœ‰å…ƒç´ å¯ä»¥è¿­ä»£ï¼Œæ²¡æœ‰å°±false</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> (String)var2.next();   <span class="hljs-comment">//é€šè¿‡nextæ–¹æ³•å¾—åˆ°ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œæ¯è°ƒç”¨ä¸€æ¬¡ï¼Œè¿­ä»£å™¨ä¼šå‘åç§»åŠ¨ä¸€ä½</span><br>        System.out.println(s);    <span class="hljs-comment">//æ‰“å°ä¸€ä¸‹</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨è¿­ä»£å™¨å¯¹Listè¿›è¡Œéå†æ—¶ï¼Œå®é™…ä¸Šå°±åƒä¸€ä¸ªæŒ‡å‘åˆ—è¡¨å¤´éƒ¨çš„æŒ‡é’ˆï¼Œæˆ‘ä»¬é€šè¿‡ä¸æ–­å‘åç§»åŠ¨æŒ‡é’ˆæ¥ä¾æ¬¡è·å–æ‰€æŒ‡å‘çš„å…ƒç´ ï¼š</p><p><img src="RjZSDFcPm4q7odM.jpg" alt="image-20230301112320947"></p><p><img src="B7P3OlIQz8wgTAR.jpg" alt="image-20230301112329551"></p><p>è¿™é‡Œï¼Œæˆ‘ä»¬ä¾ç…§JDKæä¾›çš„è¿­ä»£å™¨æ¥å£ï¼ˆJDKå·²ç»ä¸ºæˆ‘ä»¬å®šä¹‰å¥½äº†ä¸€ä¸ªè¿­ä»£å™¨çš„å…·ä½“ç›¸å…³æ“ä½œï¼‰ï¼Œä¹Ÿæ¥è®¾è®¡ä¸€ä¸ªè¿­ä»£å™¨ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ArrayCollection</span>&lt;T&gt; &#123;    <span class="hljs-comment">//é¦–å…ˆè®¾è®¡ä¸€ä¸ªç®€å•çš„æ•°ç»„é›†åˆï¼Œä¸€ä¼šæˆ‘ä»¬å°±è¿­ä»£æ­¤é›†åˆå†…çš„å…ƒç´ </span><br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> T[] array;   <span class="hljs-comment">//åº•å±‚ä½¿ç”¨ä¸€ä¸ªæ•°ç»„æ¥å­˜æ”¾æ•°æ®</span><br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">ArrayCollection</span><span class="hljs-params">(T[] array)</span>&#123;   <span class="hljs-comment">//privateæ‰ï¼Œè‡ªå·±ç”¨</span><br>        <span class="hljs-built_in">this</span>.array = array;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; ArrayCollection&lt;T&gt; <span class="hljs-title function_">of</span><span class="hljs-params">(T[] array)</span>&#123;   <span class="hljs-comment">//å¼€ä¸ªé™æ€æ–¹æ³•ç›´æ¥å§æ•°ç»„è½¬æ¢æˆArrayCollectionï¼Œå…¶å®å’Œç›´æ¥newä¸€æ ·ï¼Œä½†æ˜¯è¿™æ ·å†™å¥½çœ‹ä¸€ç‚¹</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayCollection</span>&lt;&gt;(array);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥å°†æ•°æ®å­˜æ”¾åœ¨æ­¤é›†åˆä¸­äº†ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    String[] arr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;AAA&quot;</span>, <span class="hljs-string">&quot;BBB&quot;</span>, <span class="hljs-string">&quot;CCC&quot;</span>, <span class="hljs-string">&quot;DDD&quot;</span>&#125;;<br>    ArrayCollection&lt;String&gt; collection = ArrayCollection.of(arr);<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ç€æˆ‘ä»¬å°±å¯ä»¥æ¥å®ç°è¿­ä»£å™¨æ¥å£äº†ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ArrayCollection</span>&lt;T&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Iterable</span>&lt;T&gt;&#123;   <span class="hljs-comment">//å®ç°Iterableæ¥å£è¡¨ç¤ºæ­¤ç±»æ˜¯æ”¯æŒè¿­ä»£çš„</span><br><br>    ...<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Iterator&lt;T&gt; <span class="hljs-title function_">iterator</span><span class="hljs-params">()</span> &#123;    <span class="hljs-comment">//éœ€è¦å®ç°iteratoræ–¹æ³•ï¼Œæ­¤æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼Œç”¨äºè¿­ä»£æˆ‘ä»¬é›†åˆä¸­çš„å…ƒç´ </span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayIterator</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ArrayIterator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Iterator</span>&lt;T&gt; &#123;   <span class="hljs-comment">//è¿™é‡Œå®ç°ä¸€ä¸ªï¼Œæ³¨æ„åˆ«ç”¨é™æ€ï¼Œéœ€è¦ä½¿ç”¨å¯¹è±¡ä¸­å­˜æ”¾çš„æ•°ç»„</span><br>        <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">cur</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;   <span class="hljs-comment">//è¿™é‡Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªæŒ‡é’ˆè¡¨ç¤ºå½“å‰çš„è¿­ä»£ä½ç½®</span><br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasNext</span><span class="hljs-params">()</span> &#123;     <span class="hljs-comment">//åˆ¤æ–­æ˜¯å¦è¿˜æœ‰ä¸‹ä¸€ä¸ªå…ƒç´ </span><br>            <span class="hljs-keyword">return</span> cur &lt; array.length;   <span class="hljs-comment">//å¦‚æœæŒ‡é’ˆå¤§äºæˆ–ç­‰äºæ•°ç»„æœ€å¤§é•¿åº¦ï¼Œå°±ä¸èƒ½å†ç»§ç»­äº†</span><br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> T <span class="hljs-title function_">next</span><span class="hljs-params">()</span> &#123;   <span class="hljs-comment">//è¿”å›å½“å‰æŒ‡é’ˆä½ç½®çš„å…ƒç´ å¹¶å‘åç§»åŠ¨ä¸€ä½</span><br>            <span class="hljs-keyword">return</span> array[cur++];   <span class="hljs-comment">//æ­£å¸¸è¿”å›å¯¹åº”ä½ç½®çš„å…ƒç´ ï¼Œå¹¶å°†æŒ‡é’ˆè‡ªå¢</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ç€ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹æˆ‘ä»¬è‡ªå·±ç¼–å†™çš„ä¸€ä¸ªç®€å•é›†åˆç±»è¿›è¡Œè¿­ä»£äº†ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    String[] arr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;AAA&quot;</span>, <span class="hljs-string">&quot;BBB&quot;</span>, <span class="hljs-string">&quot;CCC&quot;</span>, <span class="hljs-string">&quot;DDD&quot;</span>&#125;;<br>    ArrayCollection&lt;String&gt; collection = ArrayCollection.of(arr);<br>    <span class="hljs-keyword">for</span> (String s : collection) &#123;    <span class="hljs-comment">//å¯ä»¥ç›´æ¥ä½¿ç”¨foreachè¯­æ³•ç³–ï¼Œå½“ç„¶æœ€åè¿˜æ˜¯ä¼šå˜æˆè¿­ä»£å™¨è°ƒç”¨</span><br>        System.out.println(s);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æœ€åç¼–è¯‘å‡ºæ¥çš„æ ·å­ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    String[] arr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;AAA&quot;</span>, <span class="hljs-string">&quot;BBB&quot;</span>, <span class="hljs-string">&quot;CCC&quot;</span>, <span class="hljs-string">&quot;DDD&quot;</span>&#125;;<br>    ArrayCollection&lt;String&gt; collection = ArrayCollection.of(arr);<br>    <span class="hljs-type">Iterator</span> <span class="hljs-variable">var3</span> <span class="hljs-operator">=</span> collection.iterator();   <span class="hljs-comment">//é¦–å…ˆè·å–è¿­ä»£å™¨ï¼Œå®é™…ä¸Šå°±æ˜¯è°ƒç”¨æˆ‘ä»¬å®ç°çš„iteratoræ–¹æ³•</span><br><br>    <span class="hljs-keyword">while</span>(var3.hasNext()) &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> (String)var3.next();   <span class="hljs-comment">//ç›´æ¥ä½¿ç”¨next()æ–¹æ³•ä¸æ–­å‘ä¸‹è·å–</span><br>        System.out.println(s);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬å°±å®ç°äº†ä¸€ä¸ªè¿­ä»£å™¨æ¥éå†æˆ‘ä»¬çš„å…ƒç´ ã€‚</p><h2 id="ä¸­ä»‹è€…æ¨¡å¼"><a href="#ä¸­ä»‹è€…æ¨¡å¼" class="headerlink" title="ä¸­ä»‹è€…æ¨¡å¼"></a>ä¸­ä»‹è€…æ¨¡å¼</h2><p>åœ¨æ—©æœŸï¼Œæˆ‘ä»¬æƒ³è¦å’Œåˆ«äººè¿›è¡Œè¯­éŸ³èŠå¤©ï¼Œä¸€èˆ¬éƒ½æ˜¯é€šè¿‡ç”µè¯çš„æ–¹å¼ï¼Œæˆ‘ä»¬é€šè¿‡æ‹¨æ‰“ä»–äººçš„ç”µè¯å·ç ï¼Œæ¥å»ºç«‹ä¼šè¯ï¼Œä¸è¿‡è¿™æ ·æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæ¯”å¦‚æˆ‘ç°åœ¨æƒ³è¦é€šçŸ¥é€šçŸ¥3ä¸ªäººæŸä»¶äº‹æƒ…ï¼Œé‚£ä¹ˆæˆ‘å°±å¾—ä¾æ¬¡ç»™ä¸‰ä¸ªäººæ‰“ç”µè¯ï¼Œç”šè‡³è¿˜ä¼šé‡åˆ°ä¸€ç§æƒ…å†µï¼Œå°±æ˜¯æˆ‘ä»¬æ²¡æœ‰æŸä¸ªäººçš„ç”µè¯å·ç ï¼Œä½†æ˜¯å…¶ä»–äººæœ‰ï¼Œè¿™æ—¶è¿˜éœ€è¦å‘ŠçŸ¥è¿™ä¸ªäººå¹¶è¿›è¡Œè½¬å‘Šï¼Œå°±å¾ˆéº»çƒ¦ã€‚</p><p><img src="UoChEBnujTDMGpF.jpg" alt="image-20230301112503997"></p><p>ä½†æ˜¯ç°åœ¨æˆ‘ä»¬æœ‰äº†Facetimeã€æœ‰äº†å¾®ä¿¡ï¼Œæˆ‘ä»¬å¯ä»¥åŒæ—¶è®©å¤šä¸ªäººå‚ä¸åˆ°ç¾¤é€šè¯ä¸­è¿›è¡Œç¾¤èŠï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸éœ€è¦ä¸€ä¸ªä¸€ä¸ªå•ç‹¬è¿›è¡Œé€šè¯æˆ–æ˜¯è½¬è¾¾äº†ã€‚å®é™…ä¸Šæ­£æ˜¯ä¾é äº†ä¸€ä¸ªä¸­é—´å•†ç»™æˆ‘ä»¬æä¾›äº†è¿›è¡Œç¾¤ä½“é€šè¯çš„å¹³å°ï¼Œæˆ‘ä»¬æ‰èƒ½å®ç°æ­¤åŠŸèƒ½ï¼Œè€Œè¿™ä¸ªå¹³å°å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªä¸­é—´äººã€‚åˆæ¯”å¦‚æˆ‘ä»¬æƒ³è¦å»å¤–é¢ç§Ÿæˆ¿ï¼Œä½†æ˜¯æˆ‘ä»¬æ€ä¹ˆçŸ¥é“å“ªé‡Œæœ‰å¯ä»¥ç§Ÿçš„æˆ¿å­å‘¢ï¼Ÿäºæ˜¯æˆ‘ä»¬å°±ä¼šä¸Šå„å¤§ç§Ÿæˆ¿APPä¸Šå»æ‰¾æˆ¿æºï¼ŒåŒæ ·çš„ï¼Œå¦‚æœæˆ‘ä»¬ç°åœ¨æœ‰æˆ¿å­éœ€è¦å‡ºç§Ÿï¼Œæˆ‘ä»¬ä¹Ÿä¸çŸ¥é“è°ä¼šæƒ³è¦ç§Ÿæˆ¿å­ï¼ŒåŒæ ·çš„æˆ‘ä»¬ä¹Ÿä¼šæŠŠæˆ¿å­æŒ‚åœ¨ç§Ÿæˆ¿APPä¸Šå±•ç¤ºï¼Œè€Œå½“æˆ‘ä»¬å»ç§Ÿæˆ¿æ—¶æˆ–æ˜¯å‡ºç§Ÿæ—¶ï¼Œå°±ä¼šæœ‰ä¸€ä¸ªç§°ä¸ºä¸­ä»‹çš„äººæ¥è·Ÿæˆ‘ä»¬å¯¹æ¥ï¼Œå®é™…ä¸Šä¹Ÿæ˜¯ä¸€ç§ä¸­ä»‹çš„æ¨¡å¼ã€‚</p><p>åœ¨æˆ‘ä»¬çš„ç¨‹åºä¸­ï¼Œå¯èƒ½ä¹Ÿä¼šå‡ºç°å¾ˆå¤šçš„å¯¹è±¡ï¼Œä½†æ˜¯è¿™äº›å¯¹è±¡ä¹‹é—´çš„ç›¸äº’è°ƒç”¨å…³ç³»é”™ç»¼å¤æ‚ï¼Œå¯èƒ½ä¸€ä¸ªå¯¹è±¡è¦åšä»€ä¹ˆäº‹æƒ…å°±å¾—è”ç³»å¥½å‡ ä¸ªå¯¹è±¡ï¼š</p><p><img src="Pobq2ZB1dyExNs9.jpg" alt="image-20230301112515239"></p><p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬åœ¨è¿™ä¸­é—´æä¸€ä¸ªä¸­é—´äººï¼š</p><p><img src="fru13VTnkDS2y4v.jpg" alt="image-20230301112526146"></p><p>è¿™æ ·å½“æˆ‘ä»¬è¦è”ç³»å…¶ä»–äººæ—¶ï¼Œä¸€å¾‹æ‰¾ä¸­ä»‹å°±å¯ä»¥äº†ï¼Œä¸­ä»‹å­˜å‚¨äº†æ‰€æœ‰äººçš„è”ç³»æ–¹å¼ï¼Œè¿™æ ·å°±ä¸ä¼šåƒä¸Šé¢ä¸€æ ·ä¹±æˆä¸€å›¢äº†ã€‚è¿™é‡Œæˆ‘ä»¬å°±ä»¥æˆ¿äº§ä¸­ä»‹çš„ä¾‹å­æ¥ç¼–å†™ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Mediator</span> &#123;   <span class="hljs-comment">//æˆ¿äº§ä¸­ä»‹</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, User&gt; userMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();   <span class="hljs-comment">//åœ¨å‡ºå”®çš„æˆ¿å­éœ€è¦å­˜å‚¨ä¸€ä¸‹</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">register</span><span class="hljs-params">(String address, User user)</span>&#123;   <span class="hljs-comment">//å‡ºå”®æˆ¿å±‹çš„äººï¼Œéœ€è¦å‘Šè¯‰ä¸­ä»‹ä»–çš„æˆ¿å±‹åœ¨å“ªé‡Œ</span><br>        userMap.put(address, user);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">find</span><span class="hljs-params">(String address)</span>&#123;   <span class="hljs-comment">//é€šè¿‡æ­¤æ–¹æ³•æ¥çœ‹çœ‹æœ‰æ²¡æœ‰å¯¹åº”çš„æˆ¿æº</span><br>        <span class="hljs-keyword">return</span> userMap.get(address);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ç€å°±æ˜¯ç”¨æˆ·äº†ï¼Œç”¨æˆ·æœ‰ä¸¤ç§è§’è‰²ï¼Œä¸€ç§æ˜¯ç§Ÿæˆ¿ï¼Œä¸€ç§æ˜¯å‡ºç§Ÿï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;   <span class="hljs-comment">//ç”¨æˆ·å¯ä»¥æ˜¯å‡ºå”®æˆ¿å±‹çš„ä¸€æ–¹ï¼Œä¹Ÿå¯ä»¥æ˜¯å¯»æ‰¾æˆ¿å±‹çš„ä¸€æ–¹</span><br>    String name;<br>    String tel;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">(String name, String tel)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.tel = tel;<br>    &#125;<br>  <br>    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">find</span><span class="hljs-params">(String address, Mediator mediator)</span>&#123;   <span class="hljs-comment">//æ‰¾æˆ¿å­çš„è¯ï¼Œéœ€è¦ä¸€ä¸ªä¸­ä»‹å’Œä½ å…·ä½“æƒ³æ‰¾çš„åœ°æ–¹</span><br>        <span class="hljs-keyword">return</span> mediator.find(address);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name+<span class="hljs-string">&quot; (ç”µè¯ï¼š&quot;</span>+tel+<span class="hljs-string">&quot;)&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">User</span> <span class="hljs-variable">user0</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;åˆ˜å¥³å£«&quot;</span>, <span class="hljs-string">&quot;10086&quot;</span>);   <span class="hljs-comment">//å‡ºç§Ÿäºº</span><br>    <span class="hljs-type">User</span> <span class="hljs-variable">user1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;æå…ˆç”Ÿ&quot;</span>, <span class="hljs-string">&quot;10010&quot;</span>);   <span class="hljs-comment">//æ‰¾æˆ¿äºº</span><br>    <span class="hljs-type">Mediator</span> <span class="hljs-variable">mediator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Mediator</span>();   <span class="hljs-comment">//æˆ‘æ˜¯é»‘å¿ƒä¸­ä»‹</span><br><br>    mediator.register(<span class="hljs-string">&quot;æˆéƒ½å¸‚æ­¦ä¾¯åŒºå¤©åºœäº”è¡—ç™½é©¬ç¨‹åºå‘˜&quot;</span>, user0);   <span class="hljs-comment">//å…ˆæŠŠæˆ¿å­ç»™ä¸­ä»‹æŒ‚ä¸Šå»</span><br><br>    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> user1.find(<span class="hljs-string">&quot;æˆéƒ½å¸‚æ­¦ä¾¯åŒºå¤©åºœäº”è¡—ä¸‹ç¡…è°·&quot;</span>, mediator);  <span class="hljs-comment">//å¼€å§‹æ‰¾æˆ¿å­</span><br>    <span class="hljs-keyword">if</span>(user == <span class="hljs-literal">null</span>) System.out.println(<span class="hljs-string">&quot;æ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„æˆ¿æº&quot;</span>);<br><br>    user = user1.find(<span class="hljs-string">&quot;æˆéƒ½å¸‚æ­¦ä¾¯åŒºå¤©åºœäº”è¡—ç™½é©¬ç¨‹åºå‘˜&quot;</span>, mediator);  <span class="hljs-comment">//å¼€å§‹æ‰¾æˆ¿å­</span><br>    System.out.println(user);   <span class="hljs-comment">//æˆåŠŸæ‰¾åˆ°å¯¹åº”æˆ¿æº</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸­ä»‹è€…æ¨¡å¼ä¼˜åŒ–äº†åŸæœ‰çš„å¤æ‚å¤šå¯¹å¤šå…³ç³»ï¼Œè€Œæ˜¯å°†å…¶ç®€åŒ–ä¸ºä¸€å¯¹å¤šçš„å…³ç³»ï¼Œæ›´å®¹æ˜“ç†è§£ä¸€äº›ã€‚</p><h2 id="å¤‡å¿˜å½•æ¨¡å¼"><a href="#å¤‡å¿˜å½•æ¨¡å¼" class="headerlink" title="å¤‡å¿˜å½•æ¨¡å¼"></a>å¤‡å¿˜å½•æ¨¡å¼</h2><blockquote><p>2021å¹´10æœˆ1æ—¥ä¸‹åˆï¼Œæ²³å—é©»é©¬åº—çš„ä¸€å13å²å¥³ä¸­å­¦ç”Ÿï¼Œå› å’ŒåŒå­¦å‘ç”Ÿä¸æ„‰å¿«å–ä¸‹åŠç“¶ç™¾è‰æ¯ã€‚</p><p>10æœˆ5æ—¥ï¼ŒæŠ¢æ•‘å››å¤©æƒ…å†µæ¶åŒ–ï¼Œå®¶å±æ³£ä¸æˆå£°ç§°â€œè‚ºéƒ¨ä¸€ä¸ªå°æ—¶ä¸€å˜â€ã€‚</p><p>10æœˆ6æ—¥ä¸‹åˆï¼Œæ®æ­¦è­¦æ²³å—çœæ€»é˜ŸåŒ»é™¢æ¶ˆæ¯ï¼Œâ€œç›®å‰å¥³å­©ä»åœ¨åŒ»é™¢æ•‘æ²»ã€‚â€</p></blockquote><p>å–ä¸‹ç™¾è‰æ¯ï¼Œä¼šç»™ä½ åæ‚”çš„æ—¶é—´ï¼Œä½†æ˜¯ä¸ä¼šç»™ä½ åæ‚”çš„æœºä¼šï¼ˆç™¾è‰æ¯å«æœ‰å‰§æ¯’ç‰©è´¨ï¼Œä¼šç›´æ¥å¯¼è‡´è‚ºéƒ¨çº¤ç»´åŒ–ï¼Œè¿™æ˜¯ä¸å¯é€†çš„ï¼Œä¸€èˆ¬æ­»äº¡è¿‡ç¨‹åœ¨ä¸€å‘¨å·¦å³ï¼Œå³ä½¿å®¶é‡ŒèŠ±äº†å†å¤šçš„é’±ï¼Œæ¥å—äº†å†å¤šçš„æ²»ç–—ï¼Œä¹Ÿæ— æ³•é€†è½¬è¿™ä¸€è¿‡ç¨‹ï¼‰ç›¸ä¿¡å¦‚æœå†ç»™è¿™ä½å°å¥³å­©ä¸€æ¬¡æœºä¼šï¼Œå›åˆ°æ‹¿èµ·ç™¾è‰æ¯çš„é‚£ä¸€åˆ»ï¼Œä¸€å®šä¸ä¼šå†å†²åŠ¨åœ°å–ä¸‹äº†å§ã€‚</p><p><img src="PnkvjD7GORWNCaZ.jpg" alt="image-20230301112608808"></p><p>å¤‡å¿˜å½•æ¨¡å¼ï¼Œå°±ä¸ºæˆ‘ä»¬çš„è½¯ä»¶æä¾›äº†ä¸€ä¸ªå¯å›æº¯çš„æ—¶é—´èŠ‚ç‚¹ï¼Œå¯èƒ½æˆ‘ä»¬ç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­æŸä¸€æ­¥å‡ºç°äº†é”™è¯¯ï¼Œè¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥å›åˆ°ä¹‹å‰çš„æŸä¸ªè¢«ä¿å­˜çš„èŠ‚ç‚¹ä¸Šé‡æ–°æ¥è¿‡ï¼ˆå°±åƒè‰¾å…‹çš„å¤§æ‹›ï¼‰ï¼Œæˆ‘ä»¬å¹³æ—¶ç¼–è¾‘æ–‡æœ¬çš„æ—¶å€™ï¼Œå½“æˆ‘ä»¬ç¼–è¾‘å‡ºç°é”™è¯¯æ—¶ï¼Œå°±éœ€è¦æ’¤å›ï¼Œè€Œæˆ‘ä»¬åªéœ€è¦æŒ‰ä¸‹<code>Ctrl+Z</code>å°±å¯ä»¥å›åˆ°ä¸Šä¸€æ­¥ï¼Œè¿™æ ·å°±å¤§å¤§æ–¹ä¾¿äº†æˆ‘ä»¬çš„æ–‡æœ¬ç¼–è¾‘ã€‚</p><p>å…¶å®å¤‡å¿˜å½•æ¨¡å¼ä¹Ÿå¯ä»¥åº”ç”¨åˆ°æˆ‘ä»¬çš„ç¨‹åºä¸­ï¼Œå¦‚æœä½ å­¦ä¹ è¿‡å®‰å“å¼€å‘ï¼Œå®‰å“ç¨‹åºåœ¨å¾ˆå¤šæƒ…å†µä¸‹éƒ½ä¼šé‡æ–°åŠ è½½<code>Activity</code>ï¼Œå®é™…ä¸Šå®‰å“ä¸­<code>Activity</code>çš„<code>onSaveInstanceState</code>å’Œ<code>onRestoreInstanceState</code>å°±æ˜¯ç”¨åˆ°äº†å¤‡å¿˜å½•æ¨¡å¼ï¼Œåˆ†åˆ«ç”¨äºä¿å­˜å’Œæ¢å¤ï¼Œè¿™æ ·å°±ç®—é‡æ–°åŠ è½½ä¹Ÿå¯ä»¥æ¢å¤åˆ°ä¹‹å‰çš„çŠ¶æ€ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬å°±æ¨¡æ‹Ÿä¸€ä¸‹å¯¹è±¡çš„çŠ¶æ€ä¿å­˜ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> &#123;<br>    <span class="hljs-keyword">private</span> String currentWork;   <span class="hljs-comment">//å½“å‰æ­£åœ¨åšçš„äº‹æƒ…</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> percentage;   <span class="hljs-comment">//å½“å‰çš„å·¥ä½œå®Œæˆç™¾åˆ†æ¯”</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">work</span><span class="hljs-params">(String currentWork)</span> &#123;<br>        <span class="hljs-built_in">this</span>.currentWork = currentWork;<br>        <span class="hljs-built_in">this</span>.percentage = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Random</span>().nextInt(<span class="hljs-number">100</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;æˆ‘ç°åœ¨æ­£åœ¨åšï¼š&quot;</span>+currentWork+<span class="hljs-string">&quot; (è¿›åº¦ï¼š&quot;</span>+percentage+<span class="hljs-string">&quot;%)&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ç€æˆ‘ä»¬éœ€è¦ä¿å­˜å®ƒåœ¨æŸä¸€æ—¶åˆ»çš„çŠ¶æ€ï¼Œæˆ‘ä»¬æ¥ç¼–å†™ä¸€ä¸ªçŠ¶æ€ä¿å­˜ç±»ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">State</span> &#123;<br>    <span class="hljs-keyword">final</span> String currentWork;<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> percentage;<br><br>    State(String currentWork, <span class="hljs-type">int</span> percentage) &#123;   <span class="hljs-comment">//ä»…å¼€æ”¾ç»™åŒä¸€ä¸ªåŒ…ä¸‹çš„Studentç±»ä½¿ç”¨</span><br>        <span class="hljs-built_in">this</span>.currentWork = currentWork;<br>        <span class="hljs-built_in">this</span>.percentage = percentage;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ç€æˆ‘ä»¬æ¥å°†çŠ¶æ€çš„ä¿å­˜å’Œæ¢å¤æ“ä½œéƒ½å®ç°ä¸€ä¸‹ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> &#123;<br>    ...<br><br>    <span class="hljs-keyword">public</span> State <span class="hljs-title function_">save</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">State</span>(currentWork, percentage);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">restore</span><span class="hljs-params">(State state)</span>&#123;<br>        <span class="hljs-built_in">this</span>.currentWork = state.currentWork;<br>        <span class="hljs-built_in">this</span>.percentage = state.percentage;<br>    &#125;<br><br>    ...<br>&#125;<br></code></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹å§ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>();<br>    student.work(<span class="hljs-string">&quot;å­¦Java&quot;</span>);   <span class="hljs-comment">//å¼€å§‹å­¦Java</span><br>    System.out.println(student);<br><br>    <span class="hljs-type">State</span> <span class="hljs-variable">savedState</span> <span class="hljs-operator">=</span> student.save();   <span class="hljs-comment">//ä¿å­˜ä¸€ä¸‹å½“å‰çš„çŠ¶æ€</span><br><br>    student.work(<span class="hljs-string">&quot;æ‰“ç”µåŠ¨&quot;</span>);   <span class="hljs-comment">//åˆšæ‰“å¼€Bç«™æ’­æ”¾è§†é¢‘ï¼Œå­¦ä¸€åŠå¼€å§‹æ‘†çƒ‚äº†</span><br>    System.out.println(student);<br><br>    student.restore(savedState);   <span class="hljs-comment">//ä¸¤çº§åè½¬ï¼å›åˆ°ä¸Šä¸€ä¸ªä¿å­˜çš„çŠ¶æ€</span><br>    System.out.println(student);   <span class="hljs-comment">//å›åˆ°å­¦Javaçš„çŠ¶æ€</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶åœ¨å­¦ä¹ Javaçš„è¿‡ç¨‹ä¸­ï¼Œä¸­é€”æ‘†çƒ‚äº†ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥æ—¶å…‰å€’æµï¼Œå›åˆ°è¿˜æ²¡å¼€å§‹æ‘†çƒ‚çš„æ—¶å€™ï¼Œç»§ç»­å­¦ä¹ Javaï¼š</p><p><img src="ohGTRiEMYAay3zB.jpg" alt="image-20230301112626822"></p><p>ä¸è¿‡å¤‡å¿˜å½•æ¨¡å¼ä¸ºäº†å»ä¿å­˜å¯¹è±¡çš„çŠ¶æ€ï¼Œä¼šå ç”¨å¤§é‡çš„èµ„æºï¼Œå°¤å…¶æ˜¯é‚£ç§å±æ€§å¾ˆå¤šçš„å¯¹è±¡ï¼Œæˆ‘ä»¬éœ€è¦åˆç†çš„ä½¿ç”¨æ‰èƒ½ä¿è¯ç¨‹åºç¨³å®šè¿è¡Œã€‚</p><h2 id="è§‚å¯Ÿè€…æ¨¡å¼"><a href="#è§‚å¯Ÿè€…æ¨¡å¼" class="headerlink" title="è§‚å¯Ÿè€…æ¨¡å¼"></a>è§‚å¯Ÿè€…æ¨¡å¼</h2><p>ç‰µä¸€å‘è€ŒåŠ¨å…¨èº«ï¼Œä¸€å¹…æœ‰åºæ‘†æ”¾çš„å¤šç±³è¯ºéª¨ç‰Œï¼Œåœ¨æˆ‘ä»¬æ¨åˆ°ç¬¬ä¸€ä¸ªéª¨ç‰Œæ—¶ï¼Œåé¢çš„éª¨ç‰Œä¼šä¸æ–­åœ°è¢«ä¸Šä¸€ä¸ªéª¨ç‰Œæ¨å€’ï¼š</p><p><img src="vZBkdeXEQrcTagV.jpg" alt="image-20230301112702467"></p><p>åœ¨Javaä¸­ï¼Œä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜ï¼Œå¯èƒ½å°±ä¼šå½±å“åˆ°å…¶ä»–çš„å¯¹è±¡ï¼Œä¸ä¹‹ç›¸å…³çš„å¯¹è±¡å¯èƒ½ä¹Ÿä¼šè”åŠ¨çš„è¿›è¡Œæ”¹å˜ã€‚è¿˜æœ‰æˆ‘ä»¬ä¹‹å‰é‡åˆ°è¿‡çš„ç›‘å¬å™¨æœºåˆ¶ï¼Œå½“å…·ä½“çš„äº‹ä»¶è§¦å‘æ—¶ï¼Œæˆ‘ä»¬åœ¨ä¸€å¼€å§‹åˆ›å»ºçš„ç›‘å¬å™¨å°±å¯ä»¥æ‰§è¡Œç›¸å…³çš„é€»è¾‘ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼æ¥å®ç°è¿™æ ·çš„åŠŸèƒ½ï¼Œå½“å¯¹è±¡å‘ç”Ÿæ”¹å˜æ—¶ï¼Œè§‚å¯Ÿè€…èƒ½å¤Ÿç«‹å³è§‚å¯Ÿåˆ°å¹¶è¿›è¡Œä¸€äº›è”åŠ¨æ“ä½œï¼Œæˆ‘ä»¬å…ˆå®šä¹‰ä¸€ä¸ªè§‚å¯Ÿè€…æ¥å£ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Observer</span> &#123;   <span class="hljs-comment">//è§‚å¯Ÿè€…æ¥å£</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">()</span>;   <span class="hljs-comment">//å½“å¯¹è±¡æœ‰æ›´æ–°æ—¶ï¼Œä¼šå›è°ƒæ­¤æ–¹æ³•</span><br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ç€æˆ‘ä»¬æ¥å†™ä¸€ä¸ªæ”¯æŒè§‚å¯Ÿè€…çš„å®ä½“ç±»ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Subject</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Set&lt;Observer&gt; observerSet = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">observe</span><span class="hljs-params">(Observer observer)</span> &#123;   <span class="hljs-comment">//æ·»åŠ è§‚å¯Ÿè€…</span><br>        observerSet.add(observer);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">modify</span><span class="hljs-params">()</span> &#123;   <span class="hljs-comment">//æ¨¡æ‹Ÿå¯¹è±¡è¿›è¡Œä¿®æ”¹</span><br>        observerSet.forEach(Observer::update);   <span class="hljs-comment">//å½“å¯¹è±¡å‘ç”Ÿä¿®æ”¹æ—¶ï¼Œä¼šé€šçŸ¥æ‰€æœ‰çš„è§‚å¯Ÿè€…ï¼Œå¹¶è¿›è¡Œæ–¹æ³•å›è°ƒ</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ç€æˆ‘ä»¬å°±å¯ä»¥æµ‹è¯•ä¸€ä¸‹äº†ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">Subject</span> <span class="hljs-variable">subject</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Subject</span>();<br>    subject.observe(() -&gt; System.out.println(<span class="hljs-string">&quot;æˆ‘æ˜¯ä¸€å·è§‚å¯Ÿè€…ï¼&quot;</span>));<br>    subject.observe(() -&gt; System.out.println(<span class="hljs-string">&quot;æˆ‘æ˜¯äºŒå·è§‚å¯Ÿè€…ï¼&quot;</span>));<br>    subject.modify();<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±ç®€å•å®ç°äº†ä¸€ä¸‹è§‚å¯Ÿè€…æ¨¡å¼ï¼Œå½“ç„¶JDKä¹Ÿä¸ºæˆ‘ä»¬æä¾›äº†å®ç°è§‚å¯Ÿè€…æ¨¡å¼ç›¸å…³çš„æ¥å£ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.Observable;    <span class="hljs-comment">//java.utilåŒ…ä¸‹æä¾›çš„è§‚å¯Ÿè€…æŠ½è±¡ç±»</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Subject</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Observable</span> &#123;   <span class="hljs-comment">//ç»§æ‰¿æ­¤æŠ½è±¡ç±»è¡¨ç¤ºæ”¯æŒè§‚å¯Ÿè€…</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">modify</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;å¯¹å¯¹è±¡è¿›è¡Œä¿®æ”¹ï¼&quot;</span>);<br>        <span class="hljs-built_in">this</span>.setChanged();    <span class="hljs-comment">//å½“å¯¹å¯¹è±¡ä¿®æ”¹åï¼Œéœ€è¦setChangedæ¥è®¾å®šä¸ºå·²ä¿®æ”¹çŠ¶æ€</span><br>        <span class="hljs-built_in">this</span>.notifyObservers(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());   <span class="hljs-comment">//ä½¿ç”¨notifyObserversæ–¹æ³•æ¥é€šçŸ¥æ‰€æœ‰çš„è§‚å¯Ÿè€…</span><br>      <span class="hljs-comment">//æ³¨æ„åªæœ‰å·²ä¿®æ”¹çŠ¶æ€ä¸‹é€šçŸ¥è§‚å¯Ÿè€…æ‰ä¼šæœ‰æ•ˆï¼Œå¹¶ä¸”å¯ä»¥ç»™è§‚å¯Ÿè€…ä¼ é€’å‚æ•°ï¼Œè¿™é‡Œä¼ é€’äº†ä¸€ä¸ªæ—¶é—´å¯¹è±¡</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹å§ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">Subject</span> <span class="hljs-variable">subject</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Subject</span>();<br>    subject.addObserver((o, arg) -&gt; System.out.println(<span class="hljs-string">&quot;ç›‘å¬åˆ°å˜åŒ–ï¼Œå¹¶å¾—åˆ°å‚æ•°ï¼š&quot;</span>+arg));  <br>  <span class="hljs-comment">//æ³¨æ„è¿™é‡Œçš„Observeræ˜¯java.utilåŒ…ä¸‹æä¾›çš„</span><br>    subject.modify();   <span class="hljs-comment">//è¿›è¡Œä¿®æ”¹æ“ä½œ</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="çŠ¶æ€æ¨¡å¼"><a href="#çŠ¶æ€æ¨¡å¼" class="headerlink" title="çŠ¶æ€æ¨¡å¼"></a>çŠ¶æ€æ¨¡å¼</h2><p>åœ¨æ ‡å‡†å¤§æ°”å‹ä¸‹ï¼Œæ°´åœ¨0åº¦æ—¶ä¼šç»“å†°å˜æˆå›ºæ€ï¼Œåœ¨0-100åº¦ä¹‹é—´æ—¶ï¼Œä¼šå‘ˆç°æ¶²æ€ï¼Œ100åº¦ä»¥ä¸Šä¼šå˜æˆæ°”æ€ï¼Œæ°´è¿™ç§ç‰©è´¨åœ¨ä¸åŒçš„æ¸©åº¦ä¸‹å‘ˆç°å‡ºä¸åŒçš„çŠ¶æ€ï¼Œè€Œæˆ‘ä»¬çš„å¯¹è±¡ï¼Œå¯èƒ½ä¹Ÿä¼šåƒè¿™æ ·å­˜åœ¨å¾ˆå¤šç§çŠ¶æ€ï¼Œç”šè‡³åœ¨ä¸åŒçš„çŠ¶æ€ä¸‹ä¼šæœ‰ä¸åŒçš„è¡Œä¸ºï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡çŠ¶æ€æ¨¡å¼æ¥å®ç°ã€‚</p><p><img src="gyAHTPpVQ2c5Y3E.jpg" alt="image-20230301112716993"></p><p>æˆ‘ä»¬æ¥è®¾è®¡ä¸€ä¸ªå­¦ç”Ÿç±»ï¼Œç„¶åå­¦ç”Ÿçš„å­¦ä¹ æ–¹æ³•ä¼šæ ¹æ®çŠ¶æ€ä¸åŒè€Œå‘ç”Ÿæ”¹å˜ï¼Œæˆ‘ä»¬å…ˆè®¾è®¡ä¸€ä¸ªçŠ¶æ€æšä¸¾ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">State</span> &#123;   <span class="hljs-comment">//çŠ¶æ€ç›´æ¥ä½¿ç”¨æšä¸¾å®šä¹‰</span><br>    NORMAL, LAZY<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ç€æˆ‘ä»¬æ¥ç¼–å†™ä¸€ä¸ªå­¦ç”Ÿç±»ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> &#123;<br><br>    <span class="hljs-keyword">private</span> State state;   <span class="hljs-comment">//ä½¿ç”¨ä¸€ä¸ªæˆå‘˜æ¥å­˜å‚¨çŠ¶æ€</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setState</span><span class="hljs-params">(State state)</span> &#123;<br>        <span class="hljs-built_in">this</span>.state = state;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">study</span><span class="hljs-params">()</span>&#123;  <br>        <span class="hljs-keyword">switch</span> (state) &#123;   <span class="hljs-comment">//æ ¹æ®ä¸åŒçš„çŠ¶æ€ï¼Œå­¦ä¹ æ–¹æ³•ä¼šæœ‰ä¸åŒçš„ç»“æœ</span><br>            <span class="hljs-keyword">case</span> LAZY:<br>                System.out.println(<span class="hljs-string">&quot;åªè¦æˆ‘ä¸åŠªåŠ›ï¼Œè€æ¿å°±åˆ«æƒ³è¿‡ä¸Šæƒ³è¦çš„ç”Ÿæ´»ï¼Œå¼€æ‘†ï¼&quot;</span>);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> NORMAL:<br>                System.out.println(<span class="hljs-string">&quot;æ‹¼æç™¾å¤©ï¼Œæˆ‘è¦ä¸Šæ¸…åå¤§å­¦ï¼&quot;</span>);<br>                <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥çœ‹çœ‹ï¼Œåœ¨ä¸åŒçš„çŠ¶æ€ä¸‹ï¼Œæ˜¯å¦å­¦ä¹ ä¼šå‡ºç°ä¸åŒçš„æ•ˆæœï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>();<br>    student.setState(State.NORMAL);   <span class="hljs-comment">//å…ˆæ­£å¸¸æ¨¡å¼</span><br>    student.study();<br><br>    student.setState(State.LAZY);   <span class="hljs-comment">//å¼€å¯æ‘†çƒ‚æ¨¡å¼</span><br>    student.study();<br>&#125;<br></code></pre></td></tr></table></figure><p>çŠ¶æ€æ¨¡å¼æ›´åŠ å¼ºè°ƒå½“å‰çš„å¯¹è±¡æ‰€å¤„çš„çŠ¶æ€ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®å¯¹è±¡ä¸åŒçš„çŠ¶æ€å†³å®šå…¶ä»–çš„å¤„ç†é€»è¾‘ã€‚</p><h2 id="ç­–ç•¥æ¨¡å¼"><a href="#ç­–ç•¥æ¨¡å¼" class="headerlink" title="ç­–ç•¥æ¨¡å¼"></a>ç­–ç•¥æ¨¡å¼</h2><p>å¯¹é¢å¡å…¹å…‹æ‰“é‡è¢«å¼€äº†ï¼Œæˆ‘ä»¬æ˜¯å»æ‰“å°é¾™è¿˜æ˜¯æ‰“å¤§é¾™å‘¢ï¼Ÿè¿™å°±è¦çœ‹æˆ‘ä»¬å›¢é˜Ÿè¿™ä¸€å±€çš„æ‰“æ³•ç­–ç•¥äº†ã€‚</p><p><img src="3WAha1ZeQUTHvCi.jpg" alt="image-20230301112727567"></p><p>æˆ‘ä»¬å¯ä»¥ä¸ºå¯¹è±¡è®¾å®šä¸€ç§ç­–ç•¥ï¼Œè¿™æ ·å¯¹è±¡ä¹‹åçš„è¡Œä¸ºå°±ä¼šæŒ‰ç…§æˆ‘ä»¬åœ¨ä¸€å¼€å§‹æŒ‡å®šçš„ç­–ç•¥è€Œå†³å®šäº†ï¼Œçœ‹èµ·æ¥å’Œå‰é¢çš„çŠ¶æ€æ¨¡å¼å¾ˆåƒï¼Œä½†æ˜¯ï¼Œå®ƒä¸çŠ¶æ€æ¨¡å¼çš„åŒºåˆ«åœ¨äºï¼Œè¿™ç§è½¬æ¢æ˜¯â€œä¸»åŠ¨â€çš„ï¼Œæ˜¯ç”±æˆ‘ä»¬å»æŒ‡å®šï¼Œè€ŒçŠ¶æ€æ¨¡å¼ï¼Œå¯èƒ½æ˜¯åœ¨è¿è¡Œè¿‡ç¨‹ä¸­è‡ªåŠ¨åˆ‡æ¢çš„ã€‚</p><p>å…¶å®ç­–ç•¥æ¨¡å¼æˆ‘ä»¬ä¹‹å‰ä¹Ÿé‡åˆ°è¿‡ï¼Œæ¯”å¦‚çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">ThreadPoolExecutor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">10</span>,<br>            TimeUnit.SECONDS, <span class="hljs-keyword">new</span> <span class="hljs-title class_">SynchronousQueue</span>&lt;&gt;(),  <span class="hljs-comment">//è¿™é‡Œä¸ç»™æ’é˜Ÿ</span><br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>.AbortPolicy());   <span class="hljs-comment">//å½“çº¿ç¨‹æ± æ— æ³•å†ç»§ç»­åˆ›å»ºæ–°ä»»åŠ¡æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªç”±å†³å®šä½¿ç”¨ä»€ä¹ˆæ‹’ç»ç­–ç•¥</span><br><br>    <span class="hljs-type">Runnable</span> <span class="hljs-variable">runnable</span> <span class="hljs-operator">=</span> () -&gt; &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            TimeUnit.SECONDS.sleep(<span class="hljs-number">60</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125;<br>    &#125;;<br>    <br>    executor.execute(runnable);   <span class="hljs-comment">//è¿ç»­æäº¤ä¸¤æ¬¡ä»»åŠ¡ï¼Œè‚¯å®šå¡ä¸ä¸‹ï¼Œè¿™æ—¶å°±å¾—èµ°æ‹’ç»äº†</span><br>    executor.execute(runnable);<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å¦‚æœä½¿ç”¨AbortPolicyï¼Œé‚£ä¹ˆå°±æ˜¯ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼š</p><p><img src="j3NdO1tzHfBDAn7.jpg" alt="image-20230301112805739"></p><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–çš„ç­–ç•¥ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">ThreadPoolExecutor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">10</span>,<br>            TimeUnit.SECONDS, <span class="hljs-keyword">new</span> <span class="hljs-title class_">SynchronousQueue</span>&lt;&gt;(),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>.DiscardOldestPolicy());   <span class="hljs-comment">//ä½¿ç”¨DiscardOldestPolicyç­–ç•¥ä»é˜Ÿåˆ—ä¸­ä¸¢å¼ƒ</span><br></code></pre></td></tr></table></figure><p>è¿™ç§ç­–ç•¥å°±ä¼šä»ç­‰å¾…é˜Ÿåˆ—ä¸­è¸¢å‡ºä¸€ä¸ªä¹‹å‰çš„ï¼Œä¸è¿‡æˆ‘ä»¬è¿™é‡Œçš„ç­‰å¾…é˜Ÿåˆ—æ˜¯æ²¡æœ‰å®¹é‡çš„é‚£ç§ï¼Œæ‰€ä»¥ä¼šç›´æ¥ç‚¸æ‰ï¼š</p><p><img src="di5A9acmTXOuv2V.jpg" alt="image-20230301112814947"></p><p>è‡³äºå…·ä½“åŸå› ï¼Œå¯ä»¥å›å»çœ‹çœ‹JUCç¯‡è§†é¢‘æ•™ç¨‹ã€‚</p><p>å†æ¯”å¦‚æˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ªæ’åºç±»ï¼Œä½†æ˜¯æ ¹æ®ä¸åŒçš„ç­–ç•¥ï¼Œä¼šä½¿ç”¨ä¸åŒçš„æ’åºæ–¹æ¡ˆï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Strategy</span> &#123;   <span class="hljs-comment">//ç­–ç•¥æ¥å£ï¼Œä¸åŒçš„ç­–ç•¥å®ç°ä¹Ÿä¸åŒ</span><br><br>    <span class="hljs-type">Strategy</span> <span class="hljs-variable">SINGLE</span> <span class="hljs-operator">=</span> Arrays::sort;   <span class="hljs-comment">//å•çº¿ç¨‹æ’åºæ–¹æ¡ˆ</span><br>    <span class="hljs-type">Strategy</span> <span class="hljs-variable">PARALLEL</span> <span class="hljs-operator">=</span> Arrays::parallelSort;   <span class="hljs-comment">//å¹¶è¡Œæ’åºæ–¹æ¡ˆ</span><br>    <br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">sort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] array)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªæ’åºç±»ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Sorter</span> &#123;<br><br>    <span class="hljs-keyword">private</span> Strategy strategy;   <span class="hljs-comment">//ç­–ç•¥</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setStrategy</span><span class="hljs-params">(Strategy strategy)</span> &#123;<br>        <span class="hljs-built_in">this</span>.strategy = strategy;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] array)</span>&#123;<br>        strategy.sort(array);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥æŒ‡å®šä¸åŒçš„ç­–ç•¥è¿›è¡Œæ’åºäº†ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">Sorter</span> <span class="hljs-variable">sorter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Sorter</span>();<br>    sorter.setStrategy(Strategy.PARALLEL);    <span class="hljs-comment">//æŒ‡å®šä¸ºå¹¶è¡Œæ’åºæ–¹æ¡ˆ</span><br>    <br>    sorter.sort(<span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[]&#123;<span class="hljs-number">9</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">3</span>, <span class="hljs-number">7</span>&#125;);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="è®¿é—®è€…æ¨¡å¼"><a href="#è®¿é—®è€…æ¨¡å¼" class="headerlink" title="è®¿é—®è€…æ¨¡å¼"></a>è®¿é—®è€…æ¨¡å¼</h2><p>å…¬å›­ä¸­å­˜åœ¨å¤šä¸ªæ™¯ç‚¹ï¼Œä¹Ÿå­˜åœ¨å¤šä¸ªæ¸¸å®¢ï¼Œä¸åŒçš„æ¸¸å®¢å¯¹åŒä¸€ä¸ªæ™¯ç‚¹çš„è¯„ä»·å¯èƒ½ä¸åŒï¼›åŒ»é™¢åŒ»ç”Ÿå¼€çš„å¤„æ–¹å•ä¸­åŒ…å«å¤šç§è¯å…ƒç´ ï¼ŒæŸ»çœ‹å®ƒçš„åˆ’ä»·å‘˜å’Œè¯æˆ¿å·¥ä½œäººå‘˜å¯¹å®ƒçš„å¤„ç†æ–¹å¼ä¹Ÿä¸åŒï¼Œåˆ’ä»·å‘˜æ ¹æ®å¤„æ–¹å•ä¸Šé¢çš„è¯å“åå’Œæ•°é‡è¿›è¡Œåˆ’ä»·ï¼Œè¯æˆ¿å·¥ä½œäººå‘˜æ ¹æ®å¤„æ–¹å•çš„å†…å®¹è¿›è¡ŒæŠ“è¯ï¼Œç›¸å¯¹äºå¤„æ–¹å•æ¥è¯´ï¼Œåˆ’ä»·å‘˜å’Œè¯æˆ¿å·¥ä½œäººå‘˜å°±æ˜¯å®ƒçš„è®¿é—®è€…ï¼Œä¸è¿‡è®¿é—®è€…çš„è®¿é—®æ–¹å¼å¯èƒ½ä¼šä¸åŒã€‚</p><p><img src="Iws7kQE8Z6MCfNp.jpg" alt="image-20230301112827540"></p><p>åœ¨æˆ‘ä»¬çš„Javaç¨‹åºä¸­ï¼Œä¹Ÿå¯èƒ½ä¼šå‡ºç°è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è®¿é—®è€…æ¨¡å¼æ¥è¿›è¡Œè®¾è®¡ã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬æ—¥ä»¥ç»§å¤œåœ°åŠªåŠ›ï¼Œç»ˆäºåœ¨æŸæŸæ¯”èµ›èµ¢å¾—äº†å† å†›ï¼Œè€Œä¸åŒçš„äººå¯¹äºè¿™åˆ†è£èª‰ï¼Œå´æœ‰ç€ä¸åŒçš„ååº”ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Prize</span> &#123;   <span class="hljs-comment">//å¥–</span><br>    String name;   <span class="hljs-comment">//æ¯”èµ›åç§°</span><br>    String level;    <span class="hljs-comment">//ç­‰çº§</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Prize</span><span class="hljs-params">(String name, String level)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.level = level;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getLevel</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> level;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬é¦–å…ˆå®šä¹‰ä¸€ä¸ªè®¿é—®è€…æ¥å£ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Visitor</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">visit</span><span class="hljs-params">(Prize prize)</span>;   <span class="hljs-comment">//visitæ–¹æ³•æ¥è®¿é—®æˆ‘ä»¬çš„å¥–é¡¹</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åå°±æ˜¯è®¿é—®è€…ç›¸å…³çš„å®ç°äº†ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Teacher</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Visitor</span> &#123;   <span class="hljs-comment">//æŒ‡å¯¼è€å¸ˆä½œä¸ºä¸€ä¸ªè®¿é—®è€…</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">visit</span><span class="hljs-params">(Prize prize)</span> &#123;   <span class="hljs-comment">//å®ƒåªå…³å¿ƒä½ å¾—äº†ä»€ä¹ˆå¥–ä»¥åŠæ˜¯å‡ ç­‰å¥–ï¼Œè¿™ä¹Ÿå…³ä¹è€å¸ˆçš„è£èª‰</span><br>        System.out.println(<span class="hljs-string">&quot;ä½ å¾—å¥–æ˜¯ä»€ä¹ˆå¥–ï¼Ÿ&quot;</span>+prize.name);<br>        System.out.println(<span class="hljs-string">&quot;ä½ å¾—äº†å‡ ç­‰å¥–ï¼Ÿ&quot;</span>+prize.level);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Boss</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Visitor</span>&#123;    <span class="hljs-comment">//ä½ çš„å…¬å¸è€æ¿ä½œä¸ºä¸€ä¸ªè®¿é—®è€…</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">visit</span><span class="hljs-params">(Prize prize)</span> &#123;   <span class="hljs-comment">//ä½ çš„è€æ¿åªå…³å¿ƒè¿™äº›èƒ½ä¸èƒ½ä¸ºå…¬å¸å¸¦æ¥ä»€ä¹ˆæ•ˆç›Šï¼Œå¥–æœ¬èº«å¹¶ä¸é‡è¦</span><br>        System.out.println(<span class="hljs-string">&quot;ä½ çš„å¥–é¡¹å¤§ä¹ˆï¼Œèƒ½å¤Ÿä¸ºå…¬å¸å¸¦æ¥ä»€ä¹ˆæ•ˆç›Šä¹ˆï¼Ÿ&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;è¿˜ä¸å¦‚è€è€å®å®åŠ ç­ç»™æˆ‘å¤šå¹²å¹²ï¼Œåˆ«å»æè¿™äº›æ²¡ç”¨çš„&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Classmate</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Visitor</span>&#123;   <span class="hljs-comment">//ä½ çš„åŒå­¦ä¹Ÿå¯ä»¥ä½œä¸ºä¸€ä¸ªè®¿é—®è€…</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">visit</span><span class="hljs-params">(Prize prize)</span> &#123;   <span class="hljs-comment">//ä½ çš„åŒå­¦ä¹Ÿå…³å¿ƒä½ å¾—äº†ä»€ä¹ˆå¥–ï¼Œä¸è¿‡æ˜¯å› ä¸ºä½ æ˜¯ä»–çš„å¥–å­¦é‡‘ç«äº‰å¯¹æ‰‹ï¼Œä»–å…¶å®å¹¶ä¸å¸Œæœ›ä½ å¾—å¥–</span><br>        System.out.println(<span class="hljs-string">&quot;ä½ å¾—äº†&quot;</span>+prize.name+<span class="hljs-string">&quot;å¥–å•Šï¼Œè¿˜å¯ä»¥&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;ä¸è¿‡è¿™ä¸ªå¥–æ²¡ä»€ä¹ˆå«é‡‘é‡ï¼Œä¸‹æ¬¡åˆ«å»äº†&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Family</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Visitor</span>&#123;    <span class="hljs-comment">//ä½ çš„å®¶äººä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªè®¿é—®è€…</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">visit</span><span class="hljs-params">(Prize prize)</span> &#123;   <span class="hljs-comment">//ä½ çš„å®¶äººå¹¶ä¸æ˜¯æœ€å…³å¿ƒä½ å¾—äº†ä»€ä¹ˆå¥–ï¼Œè€Œæ˜¯å…ˆå…³å¿ƒä½ è‡ªå·±ç„¶åæ‰æ˜¯å¥–é¡¹ï¼Œä»–ä»¬æ‰æ˜¯çœŸæ­£å¸Œæœ›ä½ å¥½çš„äººã€‚è¿™ä¸ªä¸–ç•Œå¾ˆæ®‹é…·ï¼Œå¯èƒ½ä½ ä¼šè¢«æ¬ºè´Ÿå¾—éä½“é³ä¼¤ï¼Œå¯èƒ½ä½ ä¼šè§‰å¾—æ´»ç€å¦‚æ­¤è‰°éš¾ï¼Œä½†æ˜¯ä½ çš„èƒŒåè‡³å°‘è¿˜æœ‰çˆ±ä½ çš„äººï¼Œä¸ºäº†ä»–ä»¬ï¼Œæ€èƒ½å°±æ­¤é©»è¶³ã€‚</span><br>        System.out.println(<span class="hljs-string">&quot;å­©å­ï¼Œè¾›è‹¦äº†ï¼Œæœ‰æ²¡æœ‰å¥½å¥½ç…§é¡¾è‡ªå·±å•Š&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;ä½ å¾—äº†ä»€ä¹ˆå¥–å•Šï¼Ÿ&quot;</span>+prize.name+<span class="hljs-string">&quot;ï¼Œå¾ˆä¸é”™ï¼Œè¦ç»§ç»­åŠ æ²¹å•Šï¼&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œæˆ‘ä»¬å°±è®¾è®¡äº†å››ç§è®¿é—®è€…ï¼Œä½†æ˜¯ä¸åŒçš„è®¿é—®è€…å¯¹äºæŸä¸€ä»¶äº‹åŠ¡çš„å¤„ç†å¯èƒ½ä¼šä¸åŒã€‚è®¿é—®è€…æ¨¡å¼æŠŠæ•°æ®ç»“æ„å’Œä½œç”¨äºç»“æ„ä¸Šçš„æ“ä½œè§£è€¦ï¼Œä½¿å¾—æ“ä½œé›†åˆå¯ç›¸å¯¹è‡ªç”±åœ°æ¼”åŒ–ï¼Œæˆ‘ä»¬ä¸Šé¢å°±æ˜¯å°†å¥–é¡¹æœ¬èº«çš„å±æ€§å’Œå¯¹äºå¥–é¡¹çš„ä¸åŒæ“ä½œè¿›è¡Œäº†åˆ†ç¦»ã€‚</p><hr><p>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºæŸç çŸ¥è¯†åº“ç‰ˆæƒæ‰€æœ‰ï¼Œç¦æ­¢ä¸€åˆ‡æœªç»æˆæƒçš„è½¬è½½ã€å‘å¸ƒã€å‡ºå”®ç­‰è¡Œä¸ºï¼Œè¿è€…å°†è¢«è¿½ç©¶æ³•å¾‹è´£ä»»ã€‚</p><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://www.itbaima.cn/document/6386mh7anqt4tzyv">https://www.itbaima.cn/document/6386mh7anqt4tzyv</a></p>]]></content>
    
    
    <categories>
      
      <category>è®¾è®¡æ¨¡å¼</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è®¾è®¡æ¨¡å¼-ç»“æ„å‹</title>
    <link href="/post/b096a378-bcc1-42bf-96dc-658502442b53/"/>
    <url>/post/b096a378-bcc1-42bf-96dc-658502442b53/</url>
    
    <content type="html"><![CDATA[<h3 id="è®¾è®¡æ¨¡å¼-ç»“æ„å‹"><a href="#è®¾è®¡æ¨¡å¼-ç»“æ„å‹" class="headerlink" title="è®¾è®¡æ¨¡å¼-ç»“æ„å‹"></a>è®¾è®¡æ¨¡å¼-ç»“æ„å‹</h3><p><code>hexo template generate by typora plugin templater</code></p><p><img src="zsQt38PgRYnXcjH-1720456474374-243.jpg" alt="image-20230301111823966"></p><h1 id="è®¾è®¡æ¨¡å¼ï¼ˆç»“æ„å‹ï¼‰"><a href="#è®¾è®¡æ¨¡å¼ï¼ˆç»“æ„å‹ï¼‰" class="headerlink" title="è®¾è®¡æ¨¡å¼ï¼ˆç»“æ„å‹ï¼‰"></a>è®¾è®¡æ¨¡å¼ï¼ˆç»“æ„å‹ï¼‰</h1><p>ç»“æ„å‹è®¾è®¡æ¨¡å¼å…³æ³¨å¦‚ä½•å°†ç°æœ‰çš„ç±»æˆ–å¯¹è±¡ç»„ç»‡åœ¨ä¸€èµ·å½¢æˆæ›´åŠ å¼ºå¤§çš„ç»“æ„ã€‚å¹¶ä¸”æ ¹æ®æˆ‘ä»¬å‰é¢å­¦ä¹ çš„åˆæˆå¤ç”¨åŸåˆ™ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•å°½å¯èƒ½åœ°ä½¿ç”¨å…³è”å…³ç³»æ¥ä»£æ›¿ç»§æ‰¿å…³ç³»æ˜¯æˆ‘ä»¬æœ¬ç‰ˆå—éœ€è¦é‡ç‚¹å­¦ä¹ çš„å†…å®¹ã€‚</p><h2 id="ç±»-å¯¹è±¡é€‚é…å™¨æ¨¡å¼"><a href="#ç±»-å¯¹è±¡é€‚é…å™¨æ¨¡å¼" class="headerlink" title="ç±»&#x2F;å¯¹è±¡é€‚é…å™¨æ¨¡å¼"></a>ç±»&#x2F;å¯¹è±¡é€‚é…å™¨æ¨¡å¼</h2><p>åœ¨ç”Ÿæ´»ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸é‡åˆ°è¿™æ ·çš„ä¸€ä¸ªé—®é¢˜ï¼šç¬”è®°æœ¬å¤ªè½»è–„äº†ï¼Œä»¥è‡³äºæ²¡æœ‰RJ45ç½‘å£å’ŒUSB Aå£ï¼ˆæ¯”å¦‚Macbookä¸ºäº†è½»è–„ç”šè‡³å…¨æ˜¯type-cå½¢å¼çš„é›·ç”µå£ï¼‰ä½†æ˜¯ç°åœ¨æˆ‘ä»¬å› ä¸ºå·¥ä½œéœ€è¦ï¼Œåˆå¾—ä½¿ç”¨è¿™äº›æ¥å£æ¥è¿æ¥çº¿ç¼†ï¼Œè¿™æ—¶æˆ‘ä»¬æƒ³åˆ°çš„ç¬¬ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œå°±æ˜¯å»ä¹°ä¸€ä¸ªè½¬æ¥å£ï¼ˆæ‰©å±•åï¼‰ï¼Œæ‰©å±•åå¯ä»¥å°†type-cå£è½¬æ¢ä¸ºå…¶ä»–ç±»å‹çš„æ¥å£ä¾›æˆ‘ä»¬ä½¿ç”¨ï¼Œå®é™…ä¸Šè¿™å°±æ˜¯ä¸€ç§é€‚é…æ¨¡å¼ã€‚</p><p><img src="5HkWt8fhwIZCxPE.jpg" alt="image-20230301111837481"></p><p>ç”±äºæˆ‘ä»¬çš„ç”µè„‘æ²¡æœ‰è¿™äº›æ¥å£ï¼Œä½†æ˜¯æä¾›äº†type-cç±»å‹çš„æ¥å£ï¼Œè™½ç„¶æ¥å£ç±»å‹ä¸ä¸€æ ·ï¼Œä½†æ˜¯åŒæ ·å¯ä»¥åšå…¶ä»–æ¥å£èƒ½åšçš„äº‹æƒ…ï¼Œæ¯”å¦‚USBæ–‡ä»¶ä¼ è¾“ã€æœ‰çº¿ç½‘ç»œè¿æ¥ç­‰ï¼Œæ‰€ä»¥ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€è¦æ·»åŠ ä¸€ä¸ªä¸­é—´äººæ¥å¸®æˆ‘ä»¬è½¬æ¢ä¸€ä¸‹æ¥å£å½¢æ€å³å¯ã€‚åŒ…æ‹¬æˆ‘ä»¬å¸¸ç”¨çš„å……ç”µå¤´ï¼Œä¸ºä»€ä¹ˆå«ç”µæºé€‚é…å™¨å‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“ä¼ ç»Ÿçš„ä¾›ç”µæ˜¯220Väº¤æµç”µï¼Œä½†æ˜¯æˆ‘ä»¬çš„æ‰‹æœºå¯èƒ½åªéœ€è¦5Vçš„ç”µå‹è¿›è¡Œå……ç”µï¼Œè™½ç„¶ç°åœ¨æœ‰ç”µï¼Œä½†æ˜¯ä¸èƒ½ç›´æ¥å……ï¼Œæˆ‘ä»¬ä¹Ÿä¸å¯èƒ½è®©ç”µåŠ›å…¬å¸ä¸“é—¨ä¸ºæˆ‘ä»¬æä¾›ä¸€ä¸ª5Vçš„ç›´æµç”µä½¿ç”¨ã€‚è¿™æ—¶ç”µæºé€‚é…å™¨å°±å¼€å§‹å‘æŒ¥ä½œç”¨äº†ï¼Œæ¯”å¦‚è‹¹æœçš„ç¥–ä¼ 5V1Aå……ç”µå¤´ï¼Œå®é™…ä¸Šå°±æ˜¯å°†220Väº¤æµç”µè½¬æ¢ä¸º5Vçš„ç›´æµç”µè¿›è¡Œä¼ è¾“ï¼Œè¿™æ ·å°±ç›¸å½“äºåœ¨220Väº¤æµç”µå’Œæˆ‘ä»¬çš„æ‰‹æœºä¹‹å‰ï¼Œåšäº†ä¸€ä¸ªé€‚é…å™¨çš„è§’è‰²ã€‚</p><p>åœ¨æˆ‘ä»¬çš„Javaç¨‹åºä¸­ï¼Œä¹Ÿä¼šç»å¸¸é‡åˆ°è¿™æ ·çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestSupplier</span> &#123;   <span class="hljs-comment">//æ‰‹æœºä¾›åº”å•†</span><br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">doSupply</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;iPhone 14 Pro&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">TestSupplier</span> <span class="hljs-variable">supplier</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestSupplier</span>();<br>      test( ? );   <span class="hljs-comment">//æˆ‘ä»¬æ²¡æœ‰Targetç±»å‹çš„æ‰‹æœºä¾›åº”å•†ï¼Œåªæœ‰å…¶ä»–çš„ï¼Œé‚£è¿™é‡Œè¯¥å¡«ä¸ªå•¥</span><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">(Target target)</span>&#123;   <span class="hljs-comment">//ç°åœ¨æˆ‘ä»¬éœ€è¦è°ƒç”¨testæ–¹æ³•ï¼Œä½†æ˜¯testæ–¹æ³•éœ€è¦Targetç±»å‹çš„æ‰‹æœºä¾›åº”å•†</span><br>        System.out.println(<span class="hljs-string">&quot;æˆåŠŸå¾—åˆ°ï¼š&quot;</span>+target.supply());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Target</span> &#123;    <span class="hljs-comment">//ç°åœ¨çš„æ‰‹æœºä¾›åº”å•†ï¼Œå¹¶ä¸æ˜¯testæ–¹æ³•æ‰€éœ€è¦çš„é‚£ç§ç±»å‹</span><br><br>    String <span class="hljs-title function_">supply</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨é€‚é…å™¨æ¨¡å¼äº†ï¼Œé€‚é…å™¨æ¨¡å¼åˆ†ä¸ºç±»é€‚é…å™¨å’Œå¯¹è±¡é€‚é…å™¨ï¼Œæˆ‘ä»¬é¦–å…ˆæ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ç±»é€‚é…å™¨è§£å†³è¿™ç§é—®é¢˜ï¼Œæˆ‘ä»¬ç›´æ¥åˆ›å»ºä¸€ä¸ªé€‚é…å™¨ç±»ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestAdapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">TestSupplier</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Target</span> &#123;  <br>  <span class="hljs-comment">//è®©æˆ‘ä»¬çš„é€‚é…å™¨ç»§æ‰¿TestSupplierå¹¶ä¸”å®ç°Targetæ¥å£</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">supply</span><span class="hljs-params">()</span> &#123;   <span class="hljs-comment">//æ¥ç€å®ç°supplyæ–¹æ³•ï¼Œç›´æ¥ä½¿ç”¨TestSupplieræä¾›çš„å®ç°</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.doSupply();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº†ä¸€ä¸ªTargetç±»å‹çš„å®ç°ç±»ï¼Œå¹¶ä¸”åŒæ—¶é‡‡ç”¨çš„æ˜¯TestSupplieræä¾›çš„å®ç°ã€‚</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">TestAdapter</span> <span class="hljs-variable">adapter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestAdapter</span>();<br>    test(adapter);<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">(Target target)</span>&#123;<br>    System.out.println(<span class="hljs-string">&quot;æˆåŠŸå¾—åˆ°ï¼š&quot;</span>+target.supply());<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸è¿‡ï¼Œè¿™ç§å®ç°æ–¹å¼éœ€è¦å ç”¨ä¸€ä¸ªç»§æ‰¿å‘ä½ï¼Œå¦‚æœæ­¤æ—¶Targetä¸æ˜¯æ¥å£è€Œæ˜¯æŠ½åƒç±»çš„è¯ï¼Œç”±äºJavaä¸æ”¯æŒå¤šç»§æ‰¿ï¼Œé‚£ä¹ˆå°±æ— æ³•å®ç°äº†ã€‚åŒæ—¶æ ¹æ®åˆæˆå¤ç”¨åŸåˆ™ï¼Œæˆ‘ä»¬åº”è¯¥æ›´å¤šçš„é€šè¿‡åˆæˆçš„æ–¹å¼å»å®ç°åŠŸèƒ½ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¥çœ‹çœ‹ç¬¬äºŒç§ï¼Œä¹Ÿæ˜¯ç”¨çš„æ¯”è¾ƒå¤šçš„ä¸€ç§æ¨¡å¼ï¼Œå¯¹è±¡é€‚é…å™¨ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestAdapter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Target</span>&#123;   <span class="hljs-comment">//ç°åœ¨ä¸å†ç»§æ‰¿TestSupplierï¼Œä»…å®ç°Target</span><br><br>    TestSupplier supplier;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">TestAdapter</span><span class="hljs-params">(TestSupplier supplier)</span>&#123;<br>        <span class="hljs-built_in">this</span>.supplier = supplier;<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">supply</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> supplier.doSupply();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œæˆ‘ä»¬å°±å°†å¯¹è±¡ä»¥ç»„åˆçš„å½¢å¼å­˜æ”¾åœ¨TestAdapterä¸­ï¼Œä¾ç„¶æ˜¯é€šè¿‡å­˜æ”¾çš„å¯¹è±¡è°ƒç”¨å…·ä½“å®ç°ã€‚</p><h2 id="æ¡¥æ¥æ¨¡å¼"><a href="#æ¡¥æ¥æ¨¡å¼" class="headerlink" title="æ¡¥æ¥æ¨¡å¼"></a>æ¡¥æ¥æ¨¡å¼</h2><p>ç›¸ä¿¡å„ä½éƒ½å»å¥¶èŒ¶åº—ä¹°è¿‡å¥¶èŒ¶ï¼Œåœ¨è´­ä¹°å¥¶èŒ¶çš„æ—¶å€™ï¼Œåº—å‘˜é¦–å…ˆä¼šé—®æˆ‘ä»¬ï¼Œæ‚¨éœ€è¦ä»€ä¹ˆç±»å‹çš„å¥¶èŒ¶ï¼Œæ¯”å¦‚æˆ‘ä»¬æ­¤æ—¶ç‚¹äº†ä¸€æ¯å•µå•µèŠ‹åœ†å¥¶èŒ¶ï¼Œæ¥ç€åº—å‘˜ä¼šç›´æ¥é—®æˆ‘ä»¬éœ€è¦å¤§æ¯ã€ä¸­æ¯è¿˜æ˜¯å°æ¯ï¼Œæœ€åè¿˜ä¼šè¯¢é—®æˆ‘ä»¬éœ€è¦åŠ ä»€ä¹ˆé…æ–™ï¼Œæ¯”å¦‚æ¤°æœã€çç ç­‰ï¼Œæœ€åæ‰ä¼šç»™æˆ‘ä»¬åˆ¶ä½œå¥¶èŒ¶ã€‚</p><p><img src="ZAjo69kfFUuIJ52.jpg" alt="image-20230301111852891"></p><p>é‚£ä¹ˆç°åœ¨è®©ä½ æ¥è®¾è®¡ä¸€ä¸‹è¿™ç§æ¨¡å¼çš„Javaç±»ï¼Œè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿé¦–å…ˆæˆ‘ä»¬è¦æ˜ç¡®ï¼Œä¸€æ¯å¥¶èŒ¶é™¤äº†ç±»å‹ä¹‹å¤–ï¼Œè¿˜åˆ†å¤§ä¸­å°æ¯ï¼Œç”šè‡³å¯èƒ½è¿˜åˆ†åŠ ä»€ä¹ˆé…æ–™ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬æŒ‰ç…§æ¥å£å®ç°çš„å†™æ³•ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Tea</span> &#123;   <span class="hljs-comment">//ç”±å…·ä½“ç±»å‹çš„å¥¶èŒ¶å®ç°</span><br>    String <span class="hljs-title function_">getType</span><span class="hljs-params">()</span>;   <span class="hljs-comment">//ä¸åŒçš„å¥¶èŒ¶è¿”å›çš„ç±»å‹ä¸åŒ</span><br>&#125;<br></code></pre></td></tr></table></figure><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Size</span> &#123;   <span class="hljs-comment">//åˆ†å¤§æ¯å°æ¯ä¸­æ¯</span><br>    String <span class="hljs-title function_">getSize</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¯”å¦‚ç°åœ¨æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»å‹ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å¤§æ¯èŠ‹åœ†å•µå•µå¥¶èŒ¶</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LargeKissTea</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Tea</span>, Size&#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getSize</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;å¤§æ¯&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getType</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;èŠ‹åœ†å•µå•µå¥¶èŒ¶&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è™½ç„¶è¿™æ ·è®¾è®¡èµ·æ¥è¿˜æŒºåˆç†çš„ï¼Œä½†æ˜¯å¦‚æœç°åœ¨æˆ‘ä»¬çš„å¥¶èŒ¶å“ç§å¤šèµ·æ¥äº†ï¼Œå¹¶ä¸”æ¯ç§å¥¶èŒ¶éƒ½æœ‰å¤§ä¸­å°æ¯ï¼Œç°åœ¨ä¸€å…±æœ‰ä¸¤ä¸ªç»´åº¦éœ€è¦è€ƒè™‘ï¼Œé‚£ä¹ˆæˆ‘ä»¬å²‚ä¸æ˜¯å¾—ä¸€ä¸ªä¸€ä¸ªå»åˆ›å»ºè¿™äº›ç±»ï¼Ÿç”šè‡³å¦‚æœè¿˜è¦è€ƒè™‘é…æ–™ï¼Œé‚£ä¹ˆå…‰åˆ›å»ºç±»å°±å¾—åˆ›å»ºä¸çŸ¥é“å¤šå°‘ä¸ªäº†ã€‚æ˜¾ç„¶è¿™ç§è®¾è®¡ä¸å¤ªå¥½ï¼Œæˆ‘ä»¬å¾—æ¢ä¸ªæ–¹å¼ã€‚</p><p>è¿™æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨æˆ‘ä»¬çš„æ¡¥æ¥æ¨¡å¼äº†ï¼Œç°åœ¨æˆ‘ä»¬é¢ä¸´çš„é—®é¢˜æ˜¯ï¼Œç»´åº¦å¤ªå¤šï¼Œä¸å¯èƒ½å„ç§ç±»å‹å„ç§å°ºå¯¸çš„å¥¶èŒ¶éƒ½å»åˆ›å»ºä¸€ä¸ªç±»ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¿˜æ˜¯å•ç‹¬å¯¹è¿™äº›æ¥å£è¿›è¡Œç®€å•çš„æ‰©å±•ï¼Œå•ç‹¬å¯¹ä¸åŒçš„ç»´åº¦è¿›è¡Œæ§åˆ¶ï¼Œä½†æ˜¯å¦‚ä½•å®ç°å‘¢ï¼Ÿæˆ‘ä»¬ä¸å¦¨å°†å¥¶èŒ¶çš„ç±»å‹ä½œä¸ºæœ€åŸºæœ¬çš„æŠ½è±¡ç±»ï¼Œç„¶åå¯¹å°ºå¯¸ã€é…æ–™ç­‰å±æ€§è¿›è¡Œæ¡¥æ¥ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AbstractTea</span> &#123;<br>    <br>    <span class="hljs-keyword">protected</span> Size size;   <span class="hljs-comment">//å°ºå¯¸ä½œä¸ºæ¡¥æ¥å±æ€§å­˜æ”¾åœ¨ç±»ä¸­</span><br>    <br>    <span class="hljs-keyword">protected</span> <span class="hljs-title function_">AbstractTea</span><span class="hljs-params">(Size size)</span>&#123;   <span class="hljs-comment">//åœ¨æ„é€ æ—¶éœ€è¦çŸ¥é“å°ºå¯¸å±æ€§</span><br>        <span class="hljs-built_in">this</span>.size = size;<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> String <span class="hljs-title function_">getType</span><span class="hljs-params">()</span>;   <span class="hljs-comment">//å…·ä½“ç±»å‹ä¾ç„¶æ˜¯ç”±å­ç±»å†³å®š</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸è¿‡è¿™ä¸ªæŠ½è±¡ç±»æä¾›çš„æ–¹æ³•è¿˜ä¸å…¨é¢ï¼Œä»…ä»…åªæœ‰Teaçš„getTypeæ–¹æ³•ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ·»åŠ å…¶ä»–ç»´åº¦çš„æ–¹æ³•ï¼Œæ‰€ä»¥ç»§ç»­ç¼–å†™ä¸€ä¸ªå­ç±»ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RefinedAbstractTea</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractTea</span>&#123;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-title function_">RefinedAbstractTea</span><span class="hljs-params">(Size size)</span> &#123;<br>        <span class="hljs-built_in">super</span>(size);<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getSize</span><span class="hljs-params">()</span>&#123;   <span class="hljs-comment">//æ·»åŠ å°ºå¯¸ç»´åº¦è·å–æ–¹å¼</span><br>        <span class="hljs-keyword">return</span> size.getSize();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬åªéœ€è¦å•ç‹¬ä¸ºSizeåˆ›å»ºå­ç±»å³å¯ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Large</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Size</span>&#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getSize</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;å¤§æ¯&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬å¦‚æœéœ€è¦ä¸€ä¸ªå¤§æ¯çš„å•µå•µèŠ‹åœ†å¥¶èŒ¶ï¼Œåªéœ€è¦ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">KissTea</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RefinedAbstractTea</span>&#123;   <span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªå•µå•µèŠ‹åœ†å¥¶èŒ¶çš„å­ç±»</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-title function_">KissTea</span><span class="hljs-params">(Size size)</span> &#123;   <span class="hljs-comment">//åœ¨æ„é€ æ—¶éœ€è¦æŒ‡å®šå…·ä½“çš„å¤§å°å®ç°</span><br>        <span class="hljs-built_in">super</span>(size);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getType</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;å•µå•µèŠ‹åœ†å¥¶èŒ¶&quot;</span>;   <span class="hljs-comment">//è¿”å›å¥¶èŒ¶ç±»å‹</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬å°±å°†ä¸¤ä¸ªç»´åº¦æ‹†å¼€ï¼Œå¯ä»¥åˆ†åˆ«è¿›è¡Œé…ç½®äº†ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">KissTea</span> <span class="hljs-variable">tea</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">KissTea</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Large</span>());<br>    System.out.println(tea.getType());<br>    System.out.println(tea.getSize());<br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡æ¡¥æ¥æ¨¡å¼ï¼Œä½¿å¾—æŠ½è±¡å’Œå®ç°å¯ä»¥æ²¿ç€å„è‡ªçš„ç»´åº¦æ¥è¿›è¡Œå˜åŒ–ï¼Œä¸å†æ˜¯å›ºå®šçš„ç»‘å®šå…³ç³»ã€‚</p><h2 id="ç»„åˆæ¨¡å¼"><a href="#ç»„åˆæ¨¡å¼" class="headerlink" title="ç»„åˆæ¨¡å¼"></a>ç»„åˆæ¨¡å¼</h2><p>ç»„åˆæ¨¡å¼å®é™…ä¸Šå°±æ˜¯å°†å¤šä¸ªç»„ä»¶è¿›è¡Œç»„åˆï¼Œè®©ç”¨æˆ·å¯ä»¥å¯¹å®ƒä»¬è¿›è¡Œä¸€è‡´æ€§å¤„ç†ã€‚æ¯”å¦‚æˆ‘ä»¬çš„æ–‡ä»¶å¤¹ï¼Œä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­å¯ä»¥æœ‰å¾ˆå¤šä¸ªå­æ–‡ä»¶å¤¹æˆ–æ˜¯æ–‡ä»¶ï¼š</p><p><img src="MYPyj9edEOmNWwU.jpg" alt="image-20230301111907078"></p><p>å®ƒå°±åƒæ˜¯ä¸€ä¸ªæ ‘å½¢ç»“æ„ä¸€æ ·ï¼Œæœ‰åˆ†æ”¯æœ‰å¶å­ï¼Œè€Œç»„åˆæ¨¡å¼åˆ™æ˜¯å¯ä»¥å¯¹æ•´ä¸ªæ ‘å½¢ç»“æ„ä¸Šçš„æ‰€æœ‰èŠ‚ç‚¹è¿›è¡Œé€’å½’å¤„ç†ï¼Œæ¯”å¦‚æˆ‘ä»¬ç°åœ¨å¸Œæœ›å°†æ‰€æœ‰æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶çš„åç§°å‰é¢éƒ½æ·»åŠ ä¸€ä¸ªå‰ç¼€ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨ç»„åˆæ¨¡å¼ã€‚</p><p><img src="FzeBOp53ojM4Sui.jpg" alt="image-20230301111916996"></p><p>ç»„åˆæ¨¡å¼çš„ç¤ºä¾‹å¦‚ä¸‹ï¼Œè¿™é‡Œæˆ‘ä»¬å°±ç”¨æ–‡ä»¶å’Œæ–‡ä»¶å¤¹çš„ä¾‹å­æ¥è®²è§£ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * é¦–å…ˆåˆ›å»ºä¸€ä¸ªç»„ä»¶æŠ½è±¡ï¼Œç»„ä»¶å¯ä»¥åŒ…å«ç»„ä»¶ï¼Œç»„ä»¶æœ‰è‡ªå·±çš„ä¸šåŠ¡æ–¹æ³•</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Component</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addComponent</span><span class="hljs-params">(Component component)</span>;    <span class="hljs-comment">//æ·»åŠ å­ç»„ä»¶</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeComponent</span><span class="hljs-params">(Component component)</span>;   <span class="hljs-comment">//åˆ é™¤å­ç»„ä»¶</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> Component <span class="hljs-title function_">getChild</span><span class="hljs-params">(<span class="hljs-type">int</span> index)</span>;   <span class="hljs-comment">//è·å–å­ç»„ä»¶</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span>;   <span class="hljs-comment">//æ‰§è¡Œå¯¹åº”çš„ä¸šåŠ¡æ–¹æ³•ï¼Œæ¯”å¦‚ä¿®æ”¹æ–‡ä»¶åç§°</span><br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ç€æˆ‘ä»¬æ¥ç¼–å†™ä¸¤ç§å®ç°ç±»ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Directory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Component</span>&#123;   <span class="hljs-comment">//ç›®å½•å¯ä»¥åŒ…å«å¤šä¸ªæ–‡ä»¶æˆ–ç›®å½•</span><br><br>    List&lt;Component&gt; child = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();   <span class="hljs-comment">//è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨Listæ¥å­˜æ”¾ç›®å½•ä¸­çš„å­ç»„ä»¶</span><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addComponent</span><span class="hljs-params">(Component component)</span> &#123;<br>        child.add(component);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeComponent</span><span class="hljs-params">(Component component)</span> &#123;<br>        child.remove(component);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Component <span class="hljs-title function_">getChild</span><span class="hljs-params">(<span class="hljs-type">int</span> index)</span> &#123;<br>        <span class="hljs-keyword">return</span> child.get(index);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> &#123;<br>        child.forEach(Component::test);   <span class="hljs-comment">//å°†ç»§ç»­è°ƒç”¨æ‰€æœ‰å­ç»„ä»¶çš„testæ–¹æ³•æ‰§è¡Œä¸šåŠ¡</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">File</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Component</span>&#123;   <span class="hljs-comment">//æ–‡ä»¶å°±ç›¸å½“äºæ˜¯æ ‘å¶ï¼Œæ— æ³•å†ç»§ç»­æ·»åŠ å­ç»„ä»¶äº†</span><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addComponent</span><span class="hljs-params">(Component component)</span> &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>();   <span class="hljs-comment">//ä¸æ”¯æŒè¿™äº›æ“ä½œäº†</span><br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeComponent</span><span class="hljs-params">(Component component)</span> &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Component <span class="hljs-title function_">getChild</span><span class="hljs-params">(<span class="hljs-type">int</span> index)</span> &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;æ–‡ä»¶åç§°ä¿®æ”¹æˆåŠŸï¼&quot;</span>+<span class="hljs-built_in">this</span>);   <span class="hljs-comment">//å…·ä½“çš„åç§°ä¿®æ”¹æ“ä½œ</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æœ€åï¼Œæˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">Directory</span> <span class="hljs-variable">outer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Directory</span>();   <span class="hljs-comment">//æ–°å»ºä¸€ä¸ªå¤–å±‚ç›®å½•</span><br>    <span class="hljs-type">Directory</span> <span class="hljs-variable">inner</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Directory</span>();   <span class="hljs-comment">//æ–°å»ºä¸€ä¸ªå†…å±‚ç›®å½•</span><br>    outer.addComponent(inner);<br>    outer.addComponent(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>());   <span class="hljs-comment">//åœ¨å†…å±‚ç›®å½•å’Œå¤–å±‚ç›®å½•éƒ½æ·»åŠ ç‚¹æ–‡ä»¶ï¼Œæ³¨æ„åˆ«å¯¼é”™åŒ…äº†</span><br>    inner.addComponent(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>());<br>    inner.addComponent(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>());<br>    outer.test();    <span class="hljs-comment">//å¼€å§‹æ‰§è¡Œæ–‡ä»¶åç§°ä¿®æ”¹æ“ä½œ</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å¯¹æœ€å¤–å±‚ç›®å½•è¿›è¡Œæ“ä½œåï¼Œä¼šé€’å½’å‘ä¸‹å¤„ç†å½“å‰ç›®å½•å’Œå­ç›®å½•ä¸­æ‰€æœ‰çš„æ–‡ä»¶ã€‚</p><h2 id="è£…é¥°æ¨¡å¼"><a href="#è£…é¥°æ¨¡å¼" class="headerlink" title="è£…é¥°æ¨¡å¼"></a>è£…é¥°æ¨¡å¼</h2><p>è£…é¥°æ¨¡å¼å°±åƒå…¶åå­—ä¸€æ ·ï¼Œä¸ºäº†å¯¹ç°æœ‰çš„ç±»è¿›è¡Œè£…é¥°ã€‚æ¯”å¦‚ä¸€å¼ ç›¸ç‰‡å°±ä¸€å¼ çº¸ï¼Œå¦‚æœç›´æ¥è´´åœ¨å¢™ä¸Šï¼Œæ€»æ„Ÿè§‰å°‘äº†ç‚¹ä»€ä¹ˆï¼Œä½†æ˜¯æˆ‘ä»¬ç»™å…¶æ·»åŠ ä¸€ä¸ªå¥½çœ‹çš„ç›¸æ¡†ï¼Œå°±ä¼šå˜å¾—éå¸¸å¯¹å‘³ã€‚è£…é¥°æ¨¡å¼çš„æ ¸å¿ƒå°±åœ¨äºä¸æ”¹å˜ä¸€ä¸ªå¯¹è±¡æœ¬èº«åŠŸèƒ½çš„åŸºç¡€ä¸Šï¼Œç»™å¯¹è±¡æ·»åŠ é¢å¤–çš„è¡Œä¸ºï¼Œå¹¶ä¸”å®ƒæ˜¯é€šè¿‡ç»„åˆçš„å½¢å¼å®Œæˆçš„ï¼Œè€Œä¸æ˜¯ä¼ ç»Ÿçš„ç»§æ‰¿å…³ç³»ã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ªæ™®é€šçš„åŠŸèƒ½ç±»ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span> &#123;   <span class="hljs-comment">//é¡¶å±‚æŠ½è±¡ç±»ï¼Œå®šä¹‰äº†ä¸€ä¸ªtestæ–¹æ³•æ‰§è¡Œä¸šåŠ¡</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Base</span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;æˆ‘æ˜¯ä¸šåŠ¡æ–¹æ³•&quot;</span>);   <span class="hljs-comment">//å…·ä½“çš„ä¸šåŠ¡æ–¹æ³•</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸è¿‡ç°åœ¨çš„å®ç°ç±»å¤ªå•è°ƒäº†ï¼Œæˆ‘ä»¬æ¥æ·»åŠ ä¸€ç‚¹è£…é¥°ä¸Šå»ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Decorator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Base</span>&#123;   <span class="hljs-comment">//è£…é¥°è€…éœ€è¦å°†è£…é¥°ç›®æ ‡ç»„åˆåˆ°ç±»ä¸­</span><br><br>    <span class="hljs-keyword">protected</span> Base base;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Decorator</span><span class="hljs-params">(Base base)</span> &#123;<br>        <span class="hljs-built_in">this</span>.base = base;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> &#123;<br>        base.test();    <span class="hljs-comment">//è¿™é‡Œæš‚æ—¶è¿˜æ˜¯ä½¿ç”¨ç›®æ ‡çš„åŸæœ¬æ–¹æ³•å®ç°</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DecoratorImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Decorator</span>&#123;   <span class="hljs-comment">//è£…é¥°å®ç°</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DecoratorImpl</span><span class="hljs-params">(Base base)</span> &#123;<br>        <span class="hljs-built_in">super</span>(base);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> &#123;    <span class="hljs-comment">//å¯¹åŸæœ¬çš„æ–¹æ³•è¿›è¡Œè£…é¥°ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å‰åéƒ½å»æ·»åŠ é¢å¤–æ“ä½œ</span><br>        System.out.println(<span class="hljs-string">&quot;è£…é¥°æ–¹æ³•ï¼šæˆ‘æ˜¯æ“ä½œå‰é€»è¾‘&quot;</span>);<br>        <span class="hljs-built_in">super</span>.test();<br>        System.out.println(<span class="hljs-string">&quot;è£…é¥°æ–¹æ³•ï¼šæˆ‘æ˜¯æ“ä½œåé€»è¾‘&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±é€šè¿‡è£…é¥°æ¨¡å¼å¯¹ç±»çš„åŠŸèƒ½è¿›è¡Œäº†æ‰©å±•ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">Base</span> <span class="hljs-variable">base</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BaseImpl</span>();<br>    <span class="hljs-type">Decorator</span> <span class="hljs-variable">decorator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DecoratorImpl</span>(base);  <span class="hljs-comment">//å°†Baseå®ç°è£…é¥°ä¸€ä¸‹</span><br>    <span class="hljs-type">Decorator</span> <span class="hljs-variable">outer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DecoratorImpl</span>(decorator);  <span class="hljs-comment">//è£…é¥°è€…è¿˜å¯ä»¥åµŒå¥—</span><br><br>    decorator.test();<br><br>    outer.test();<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬å°±å®ç°äº†è£…é¥°æ¨¡å¼ã€‚</p><h2 id="ä»£ç†æ¨¡å¼"><a href="#ä»£ç†æ¨¡å¼" class="headerlink" title="ä»£ç†æ¨¡å¼"></a>ä»£ç†æ¨¡å¼</h2><p>ä»£ç†æ¨¡å¼å’Œè£…é¥°æ¨¡å¼å¾ˆåƒï¼Œåˆå­¦è€…å¾ˆå®¹æ˜“ææ··ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å¾—ç´§æ¥ç€æ¥è®²è§£ä¸€ä¸‹ã€‚é¦–å…ˆè¯·è®°ä½ï¼Œå½“æ— æ³•ç›´æ¥è®¿é—®æŸä¸ªå¯¹è±¡æˆ–è®¿é—®æŸä¸ªå¯¹è±¡å­˜åœ¨å›°éš¾æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¸€ä¸ªä»£ç†å¯¹è±¡æ¥é—´æ¥è®¿é—®ã€‚</p><p>å®é™…ä¸Šä»£ç†åœ¨æˆ‘ä»¬ç”Ÿæ´»ä¸­å¤„å¤„éƒ½å­˜åœ¨ï¼Œæ¯”å¦‚æ‰‹æœºå‚å•†è¦å»é”€å”®æ‰‹æœºï¼Œä½†æ˜¯æ‰‹æœºå‚å•†æœ¬èº«æ²¡æœ‰ä»€ä¹ˆæ¸ é“å¯ä»¥å¤§è§„æ¨¡åœ°è¿›è¡Œå”®å–ï¼Œå¾ˆéš¾ä¸è¿™äº›æ¶ˆè´¹è€…è¿›è¡Œå¯¹æ¥ï¼Œè¿™æ—¶å°±å¾—äº¤ç»™ä»£ç†å•†å»è¿›è¡Œå‡ºå”®ï¼Œæ¯”å¦‚Appleåœ¨ä¸­å›½çš„ç›´è¥åº—å¾ˆå°‘ï¼Œä½†æ˜¯åœ¨ä¸­å›½çš„æˆæƒç»é”€å•†å´å¾ˆå¤šï¼Œæ‰‹æœºå‚å•†é€šè¿‡äº¤ç»™æ——ä¸‹ä»£ç†å•†çš„å½¢å¼æ¥è¿›è¡Œæ›´å¤§è§„æ¨¡çš„å‡ºå”®ã€‚æ¯”å¦‚æˆ‘ä»¬ç»å¸¸è¦è®¿é—®Githubï¼Œä½†æ˜¯ç›´æ¥è¿æ¥ä¼šå‘ç°å¾ˆéš¾è¿çš„ä¸Šï¼Œè¿™æ—¶æˆ‘ä»¬åŠ äº†ä¸€ä¸ªä»£ç†å°±å¯ä»¥è½»æ¾è®¿é—®ï¼Œä¹Ÿæ˜¯åœ¨ä½“ç°ä»£ç†çš„ä½œç”¨ã€‚</p><p><img src="4yRZix1FfvaYboj.jpg" alt="image-20230301111934493"></p><p>åŒæ—¶ï¼Œä»£ç†ç±»éœ€è¦ä¿è¯å®¢æˆ·ç«¯ä½¿ç”¨çš„é€æ˜æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´æ“ä½œèµ·æ¥éœ€è¦ä¸åŸæœ¬çš„çœŸå®å¯¹è±¡ç›¸åŒï¼Œæ¯”å¦‚æˆ‘ä»¬è®¿é—®Githubåªéœ€è¦è¾“å…¥ç½‘å€å³å¯è®¿é—®ï¼Œè€Œæ·»åŠ ä»£ç†ä¹‹åï¼Œä¹Ÿæ˜¯ä½¿ç”¨åŒæ ·çš„æ–¹å¼å»è®¿é—®Githubï¼Œæ‰€ä»¥æ“ä½œèµ·æ¥æ˜¯ä¸€æ ·çš„ã€‚åŒ…æ‹¬Springæ¡†æ¶å…¶å®ä¹Ÿæ˜¯ä¾é ä»£ç†æ¨¡å¼å»å®ç°çš„AOPè®°å½•æ—¥å¿—ç­‰ã€‚</p><p>æ¯”å¦‚ç°åœ¨æœ‰ä¸€ä¸ªç›®æ ‡ç±»ï¼Œä½†æ˜¯æˆ‘ä»¬ç°åœ¨éœ€è¦é€šè¿‡ä»£ç†æ¥ä½¿ç”¨å®ƒï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Subject</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SubjectImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Subject</span>&#123;  <span class="hljs-comment">//æ­¤ç±»æ— æ³•ç›´æ¥ä½¿ç”¨ï¼Œéœ€è¦æˆ‘ä»¬è¿›è¡Œä»£ç†</span><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;æˆ‘æ˜¯æµ‹è¯•æ–¹æ³•ï¼&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬ä¸ºå…¶å»ºç«‹ä¸€ä¸ªä»£ç†ç±»ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Proxy</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Subject</span>&#123;   <span class="hljs-comment">//ä¸ºäº†ä¿è¯å’ŒSubjectæ“ä½œæ–¹å¼ä¸€æ ·ï¼Œä¿è¯é€æ˜æ€§ï¼Œä¹Ÿå¾—ç»§æ‰¿</span><br><br>    Subject target;   <span class="hljs-comment">//è¢«ä»£ç†çš„å¯¹è±¡ï¼ˆç”šè‡³å¯ä»¥å¤šé‡ä»£ç†ï¼‰</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Proxy</span><span class="hljs-params">(Subject subject)</span>&#123;<br>        <span class="hljs-built_in">this</span>.target = subject;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> &#123;   <span class="hljs-comment">//ç”±ä»£ç†å»æ‰§è¡Œè¢«ä»£ç†å¯¹è±¡çš„æ–¹æ³•ï¼Œå¹¶ä¸”æˆ‘ä»¬è¿˜å¯ä»¥åœ¨å‰åæ·»æ²¹åŠ é†‹</span><br>        System.out.println(<span class="hljs-string">&quot;ä»£ç†å‰ç»•æ–¹æ³•&quot;</span>);<br>        target.test();<br>        System.out.println(<span class="hljs-string">&quot;ä»£ç†åç»•æ–¹æ³•&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¹ä¸€çœ‹ï¼Œè¿™ä¸è·Ÿä¹‹å‰çš„è£…é¥°æ¨¡å¼ä¸€æ¨¡ä¸€æ ·å—ï¼Ÿ</p><p>å¯¹è£…é¥°å™¨æ¨¡å¼æ¥è¯´ï¼Œè£…é¥°è€…å’Œè¢«è£…é¥°è€…éƒ½å®ç°åŒä¸€ä¸ªæ¥å£&#x2F;æŠ½è±¡ç±»ã€‚å¯¹ä»£ç†æ¨¡å¼æ¥è¯´ï¼Œä»£ç†ç±»å’Œè¢«ä»£ç†çš„ç±»éƒ½å®ç°åŒä¸€ä¸ªæ¥å£&#x2F;æŠ½è±¡ç±»ï¼Œåœ¨ç»“æ„ä¸Šç¡®å®æ²¡æœ‰å•¥åŒºåˆ«ã€‚ä½†æ˜¯ä»–ä»¬çš„ä½œç”¨ä¸åŒï¼Œè£…é¥°å™¨æ¨¡å¼å¼ºè°ƒçš„æ˜¯å¢å¼ºè‡ªèº«ï¼Œåœ¨è¢«è£…é¥°ä¹‹åä½ èƒ½å¤Ÿåœ¨è¢«å¢å¼ºçš„ç±»ä¸Šä½¿ç”¨å¢å¼ºåçš„åŠŸèƒ½ï¼Œå¢å¼ºåä½ è¿˜æ˜¯ä½ ï¼Œåªä¸è¿‡è¢«å¼ºåŒ–äº†è€Œå·²ï¼›ä»£ç†æ¨¡å¼å¼ºè°ƒè¦è®©åˆ«äººå¸®ä½ å»åšäº‹æƒ…ï¼Œä»¥åŠæ·»åŠ ä¸€äº›æœ¬èº«ä¸ä½ ä¸šåŠ¡æ²¡æœ‰å¤ªå¤šå…³ç³»çš„äº‹æƒ…ï¼ˆè®°å½•æ—¥å¿—ã€è®¾ç½®ç¼“å­˜ç­‰ï¼‰é‡ç‚¹åœ¨äºè®©åˆ«äººå¸®ä½ åšã€‚</p><p>è£…é¥°æ¨¡å¼å’Œä»£ç†æ¨¡å¼çš„ä¸åŒä¹‹å¤„åœ¨äºæ€æƒ³ã€‚</p><p>å½“ç„¶å®ç°ä»£ç†æ¨¡å¼é™¤äº†æˆ‘ä»¬ä¸Šé¢æ‰€è¯´çš„è¿™ç§æ–¹å¼ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨JDKä¸ºæˆ‘ä»¬æä¾›çš„åŠ¨æ€ä»£ç†æœºåˆ¶ï¼Œæˆ‘ä»¬ä¸å†éœ€è¦æ‰‹åŠ¨ç¼–å†™ç»§æ‰¿å…³ç³»åˆ›å»ºä»£ç†ç±»ï¼Œå®ƒèƒ½å¤Ÿåœ¨è¿è¡Œæ—¶é€šè¿‡åå°„æœºåˆ¶ä¸ºæˆ‘ä»¬è‡ªåŠ¨ç”Ÿæˆä»£ç†ç±»ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Subject</span> &#123;  <span class="hljs-comment">//JDKæä¾›çš„åŠ¨æ€ä»£ç†åªæ”¯æŒæ¥å£</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SubjectImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Subject</span>&#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;æˆ‘æ˜¯æµ‹è¯•æ–¹æ³•ï¼&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ç€æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªåŠ¨æ€ä»£ç†çš„å¤„ç†é€»è¾‘ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestProxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InvocationHandler</span> &#123;    <span class="hljs-comment">//ä»£ç†ç±»ï¼Œéœ€è¦å®ç°InvocationHandleræ¥å£</span><br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Object object;   <span class="hljs-comment">//è¿™é‡Œéœ€è¦ä¿å­˜ä¸€ä¸‹è¢«ä»£ç†çš„å¯¹è±¡ï¼Œä¸‹é¢éœ€è¦ç”¨åˆ°</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">TestProxy</span><span class="hljs-params">(Object object)</span> &#123;<br>        <span class="hljs-built_in">this</span>.object = object;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span>   <span class="hljs-comment">//æ­¤æ–¹æ³•å°±æ˜¯è°ƒç”¨ä»£ç†å¯¹è±¡çš„å¯¹åº”æ–¹æ³•æ—¶ä¼šè¿›å…¥ï¼Œè¿™é‡Œæˆ‘ä»¬å°±éœ€è¦ç¼–å†™å¦‚ä½•è¿›è¡Œä»£ç†äº†</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>     <span class="hljs-comment">//methodå°±æ˜¯è°ƒç”¨çš„ä»£ç†å¯¹è±¡çš„å“ªä¸€ä¸ªæ–¹æ³•ï¼Œargsæ˜¯å®å‚æ•°ç»„</span><br>        System.out.println(<span class="hljs-string">&quot;ä»£ç†çš„å¯¹è±¡ï¼š&quot;</span>+proxy.getClass());   <span class="hljs-comment">//proxyå°±æ˜¯ç”Ÿæˆçš„ä»£ç†å¯¹è±¡äº†ï¼Œæˆ‘ä»¬çœ‹çœ‹æ˜¯ä»€ä¹ˆç±»å‹çš„</span><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">res</span> <span class="hljs-operator">=</span> method.invoke(object, args);   <span class="hljs-comment">//åœ¨ä»£ç†ä¸­è°ƒç”¨è¢«ä»£ç†å¯¹è±¡åŸæœ¬çš„æ–¹æ³•ï¼Œå› ä¸ºä½ æ˜¯ä»£ç†ï¼Œè¿˜æ˜¯å¾—æ‰§è¡Œä¸€ä¸‹åˆ«äººçš„ä¸šåŠ¡ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä¸æ‰§è¡Œï¼Œä½†æ˜¯è¿™æ ·å°±å¤±å»ä»£ç†çš„æ„ä¹‰äº†ï¼Œæ³¨æ„è¦ç”¨ä¸Šé¢çš„object</span><br>        System.out.println(<span class="hljs-string">&quot;æ–¹æ³•è°ƒç”¨å®Œæˆï¼Œè¿”å›å€¼ä¸ºï¼š&quot;</span>+res);   <span class="hljs-comment">//çœ‹çœ‹è¿”å›å€¼æ˜¯ä»€ä¹ˆ</span><br>        <span class="hljs-keyword">return</span> res;   <span class="hljs-comment">//è¿”å›è¿”å›å€¼</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æœ€åæˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•åˆ›å»ºä¸€ä¸ªä»£ç†ç±»ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">SubjectImpl</span> <span class="hljs-variable">subject</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SubjectImpl</span>();   <span class="hljs-comment">//è¢«ä»£ç†çš„å¤§å†¤ç§</span><br>    <span class="hljs-type">InvocationHandler</span> <span class="hljs-variable">handler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestProxy</span>(subject);<br>    <span class="hljs-type">Subject</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> (Subject) Proxy.newProxyInstance(<br>            subject.getClass().getClassLoader(),    <span class="hljs-comment">//éœ€è¦ä¼ å…¥è¢«ä»£ç†çš„ç±»çš„ç±»åŠ è½½å™¨</span><br>            subject.getClass().getInterfaces(),    <span class="hljs-comment">//éœ€è¦ä¼ å…¥è¢«ä»£ç†çš„ç±»çš„æ¥å£åˆ—è¡¨</span><br>            handler);    <span class="hljs-comment">//æœ€åä¼ å…¥æˆ‘ä»¬å®ç°çš„ä»£ç†å¤„ç†é€»è¾‘å®ç°ç±»</span><br>    proxy.test();    <span class="hljs-comment">//æ¯”å¦‚ç°åœ¨æˆ‘ä»¬è°ƒç”¨ä»£ç†ç±»çš„testæ–¹æ³•ï¼Œé‚£ä¹ˆå°±ä¼šè¿›å…¥åˆ°æˆ‘ä»¬ä¸Šé¢TestProxyä¸­invokeæ–¹æ³•ï¼Œèµ°æˆ‘ä»¬çš„ä»£ç†é€»è¾‘</span><br>&#125;<br></code></pre></td></tr></table></figure><p>è¿è¡Œä¸€æ¬¡ï¼Œå¯ä»¥çœ‹åˆ°è°ƒç”¨ä»£ç†ç±»çš„æ–¹æ³•ï¼Œæœ€ç»ˆä¼šèµ°åˆ°æˆ‘ä»¬çš„invokeæ–¹æ³•ä¸­è¿›è¡Œï¼š</p><p><img src="RipPFu3Q6Y5Idel.jpg" alt="image-20230301112001604"></p><p>æ ¹æ®æ¥å£ï¼Œä»£ç†å¯¹è±¡æ˜¯<code>com.sun.proxy.$Proxy0</code>ç±»ï¼ˆçœ‹åå­—å°±çŸ¥é“ä¸å¯¹åŠ²ï¼‰ï¼Œè¿™ä¸ªç±»æ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼Œæˆ‘ä»¬ä¹Ÿæ‰¾ä¸åˆ°å…·ä½“çš„æºä»£ç ã€‚</p><p>ä¸è¿‡JDKæä¾›çš„åŠ¨æ€ä»£ç†åªèƒ½ä½¿ç”¨æ¥å£ï¼Œå¦‚æœæ¢æˆæˆ‘ä»¬ä¸€å¼€å§‹çš„æŠ½è±¡ç±»ï¼Œå°±æ²¡åŠæ³•äº†ï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€äº›ç¬¬ä¸‰æ–¹æ¡†æ¶æ¥å®ç°æ›´å¤šæ–¹å¼çš„åŠ¨æ€ä»£ç†ï¼Œæ¯”å¦‚Springéƒ½åœ¨ä½¿ç”¨çš„CGLibæ¡†æ¶ï¼ŒMavenä¾èµ–å¦‚ä¸‹ï¼š</p><p>â€‹                              </p><p>â€‹        xml        å¤åˆ¶ä»£ç       </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>cglib<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>cglib<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ç”±äºCGlibåº•å±‚ä½¿ç”¨ASMæ¡†æ¶ï¼ˆJVMç¯‡è§†é¢‘æ•™ç¨‹æœ‰ä»‹ç»ï¼‰è¿›è¡Œå­—èŠ‚ç ç¼–è¾‘ï¼Œæ‰€ä»¥èƒ½å¤Ÿå®ç°ä¸ä»…ä»…å±€é™äºå¯¹æ¥å£çš„ä»£ç†ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestProxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MethodInterceptor</span> &#123;  <span class="hljs-comment">//é¦–å…ˆè¿˜æ˜¯ç¼–å†™æˆ‘ä»¬çš„ä»£ç†é€»è¾‘</span><br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Object target;   <span class="hljs-comment">//è¿™äº›å’Œä¹‹å‰JDKåŠ¨æ€ä»£ç†å†™æ³•æ˜¯ä¸€æ ·çš„</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">TestProxy</span><span class="hljs-params">(Object target)</span> &#123;<br>        <span class="hljs-built_in">this</span>.target = target;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span>   <span class="hljs-comment">//æˆ‘ä»¬ä¹Ÿæ˜¯éœ€è¦åœ¨è¿™é‡Œå»ç¼–å†™æˆ‘ä»¬çš„ä»£ç†é€»è¾‘</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(Object o, Method method, Object[] objects, MethodProxy methodProxy)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>        System.out.println(<span class="hljs-string">&quot;ç°åœ¨æ˜¯ç”±CGLibè¿›è¡Œä»£ç†æ“ä½œï¼&quot;</span>+o.getClass());<br>        <span class="hljs-keyword">return</span> method.invoke(target, objects);   <span class="hljs-comment">//ä¹Ÿæ˜¯ç›´æ¥è°ƒç”¨ä»£ç†å¯¹è±¡çš„æ–¹æ³•å³å¯</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ç€æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸‹ä»£ç†ç±»ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">SubjectImpl</span> <span class="hljs-variable">subject</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SubjectImpl</span>();<br><br>    <span class="hljs-type">Enhancer</span> <span class="hljs-variable">enhancer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Enhancer</span>();   <span class="hljs-comment">//å¢å¼ºå™¨ï¼Œä¸€ä¼šå°±éœ€è¦ä¾é å¢å¼ºå™¨æ¥ä¸ºæˆ‘ä»¬ç”ŸæˆåŠ¨æ€ä»£ç†å¯¹è±¡</span><br>    enhancer.setSuperclass(SubjectImpl.class);    <span class="hljs-comment">//ç›´æ¥é€‰æ‹©æˆ‘ä»¬éœ€è¦ä»£ç†çš„ç±»å‹ï¼Œç›´æ¥ä¸éœ€è¦æ¥å£æˆ–æ˜¯æŠ½è±¡ç±»ï¼ŒSuperClassä½œä¸ºä»£ç†ç±»çš„çˆ¶ç±»å­˜åœ¨ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æŒ‰ç…§æŒ‡å®šç±»å‹çš„æ–¹å¼å»æ“ä½œä»£ç†ç±»äº†</span><br>    enhancer.setCallback(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TestProxy</span>(subject));  <span class="hljs-comment">//è®¾å®šæˆ‘ä»¬åˆšåˆšç¼–å†™å¥½çš„ä»£ç†é€»è¾‘</span><br><br>    <span class="hljs-type">SubjectImpl</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> (SubjectImpl) enhancer.create();   <span class="hljs-comment">//ç›´æ¥åˆ›å»ºä»£ç†ç±»</span><br><br>    proxy.test();   <span class="hljs-comment">//è°ƒç”¨ä»£ç†ç±»çš„testæ–¹æ³•</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œæ•ˆæœå…¶å®æ˜¯å·®ä¸å¤šçš„ï¼š</p><p><img src="Y1bHtnZTIoq8pBu.jpg" alt="image-20230301112013486"></p><p>å¯ä»¥çœ‹åˆ°ä»£ç†ç±»æ˜¯<code>åŒ…å.SubjectImpl$$EnhancerByCGLIB$$47f6ed3a</code>ï¼Œä¹Ÿæ˜¯åŠ¨æ€ç”Ÿæˆçš„ä¸€ä¸ªç±»ï¼Œæ‰€ä»¥æˆ‘ä»¬æ— æ³•å»æŸ¥çœ‹æºç ï¼Œä¸è¿‡æ­¤ç±»æ˜¯ç»§æ‰¿è‡ªæˆ‘ä»¬æŒ‡å®šçš„ç±»å‹çš„ã€‚</p><h2 id="å¤–è§‚æ¨¡å¼"><a href="#å¤–è§‚æ¨¡å¼" class="headerlink" title="å¤–è§‚æ¨¡å¼"></a>å¤–è§‚æ¨¡å¼</h2><p>ä½ æ˜¯å¦ç»å†è¿‡ç±»ä¼¼çš„æƒ…å†µï¼šä»Šå¹´è®¡ç®—æœºå­¦é™¢çš„å¥–å­¦é‡‘è¯„å®šå·¥ä½œå¼€å§‹äº†ï¼Œç”±äºä½ å»å¹´ä¸€ä¸å°å¿ƒæ‹¿äº†ä¸ªACMçš„åŒºåŸŸèµ›é‡‘ç‰Œï¼Œè§‰å¾—è‡ªå·±åˆè¡Œäº†ï¼Œäºæ˜¯ä¹Ÿæƒ³å‚ä¸åˆ°å¥–å­¦é‡‘çš„äº‰å¤ºä¸­ï¼Œé¦–å…ˆä½ çš„è¾…å¯¼å‘˜ä¼šé€šçŸ¥ä½ å»æ‰“å°ä½ çš„è·å¥–ææ–™ï¼Œç„¶åä½ é«˜é«˜å…´å…´æ‹¿ç»™è¾…å¯¼å‘˜ä¹‹åï¼Œè¾…å¯¼å‘˜åˆç»™äº†ä½ ä¸€å¼ è¡¨ï¼Œè®©ä½ æ‰“å°äº†ä¹‹åå¡«å†™ä¸€ä¸‹ï¼ŒåŒ…æ‹¬ä½ çš„ä¸ªäººä¿¡æ¯è¿˜æœ‰ä¸€äº›ä¸ªäººä»‹ç»ï¼Œå®Œæˆåï¼Œä½ æœ¬ä»¥ä¸ºå¯ä»¥åç­‰å‘å¥–äº†ï¼Œç»“æœè¾…å¯¼å‘˜åˆè·Ÿä½ è¯´æˆ‘ä»¬è¯„å®šè¿˜è¦å»æŸæŸåœ°æ–¹ç›–ç« ï¼Œç›–å®Œç« è¿˜è¦å»æ‰¾è°è°è°ç­¾å­—ï¼Œæœ€åè¿˜è¦å‚åŠ ä¸€ä¸‹ç­”è¾©â€¦ çœ‹ç€å¦‚æ­¤å¤æ‚çš„æµç¨‹ï¼Œä½ ç¬é—´ä¸æƒ³æäº†ã€‚</p><p><img src="y2wzFh1UWYmpgJX.jpg" alt="image-20230301112039165"></p><p>å®é™…ä¸Šæˆ‘ä»¬ç”Ÿæ´»ä¸­å¾ˆå¤šæ—¶å€™éƒ½æ˜¯è¿™æ ·ï¼Œå¯èƒ½åœ¨åŠä¸€ä»¶äº‹æƒ…çš„æ—¶å€™ï¼Œç”±äºéƒ¨é—¨èŒèƒ½çš„ä¸åŒï¼Œä½ å¾—å„ä¸ªéƒ¨é—¨åˆ°å¤„è·‘ï¼Œä½ è‚¯å®šä¼šæŠ±æ€¨ä¸€å¥ï¼Œå°±ä¸èƒ½æœ‰ä¸ªäººæ¥ç»Ÿä¸€ä¸€ä¸‹å—ï¼Œå°±ä¸èƒ½åœ¨ä¸€ä¸ªåœ°æ–¹ä¸€èµ·æŠŠäº‹æƒ…éƒ½åŠäº†å—ï¼Ÿè¿™æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨åˆ°å¤–è§‚æ¨¡å¼äº†ã€‚</p><p>å¤–è§‚æ¨¡å¼å……åˆ†ä½“ç°äº†è¿ªç±³ç‰¹æ³•åˆ™ã€‚å¯èƒ½æˆ‘ä»¬çš„æ•´ä¸ªé¡¹ç›®æœ‰å¾ˆå¤šä¸ªå­ç³»ç»Ÿï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥åœ¨è¿™äº›å­ç³»ç»Ÿçš„ä¸Šé¢åŠ ä¸€ä¸ªé—¨é¢ï¼ˆFacadeï¼‰å½“æˆ‘ä»¬å¤–éƒ¨éœ€è¦ä¸å„ä¸ªå­ç³»ç»Ÿäº¤äº’æ—¶ï¼Œæ— éœ€å†å»ç›´æ¥ä½¿ç”¨å„ä¸ªå­ç³»ç»Ÿï¼Œè€Œæ˜¯ä¸é—¨é¢è¿›è¡Œäº¤äº’ï¼Œå†ç”±é—¨é¢ä¸åé¢çš„å„ä¸ªå­ç³»ç»Ÿæ“ä½œï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬ä»¥åéœ€è¦åŠä»€ä¹ˆäº‹æƒ…ï¼Œå°±ç»Ÿä¸€æ‰¾é—¨é¢å°±è¡Œäº†ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯ï¼Œé¦–å…ˆè‚¯å®šæ–¹ä¾¿äº†ä»£ç çš„ç¼–å†™ï¼Œç»Ÿä¸€æ‰¾é—¨é¢å°±è¡Œï¼Œä¸éœ€è¦å»è¯¦ç»†äº†è§£å­ç³»ç»Ÿï¼Œå¹¶ä¸”ï¼Œå½“å­ç³»ç»Ÿéœ€è¦ä¿®æ”¹æ—¶ï¼Œä¹Ÿåªéœ€è¦ä¿®æ”¹é—¨é¢ä¸­çš„é€»è¾‘ï¼Œä¸éœ€è¦å¤§é¢ç§¯çš„å˜åŠ¨ï¼Œéµå¾ªè¿ªç±³ç‰¹æ³•åˆ™å°½å¯èƒ½å°‘çš„äº¤äº’ã€‚</p><p><img src="BylhOfcFtni29uQ.jpg" alt="image-20230301112103676"></p><p>æ¯”å¦‚ç°åœ¨æˆ‘ä»¬è®¾è®¡äº†ä¸‰ä¸ªå­ç³»ç»Ÿï¼Œåˆ†åˆ«æ˜¯æ’é˜Ÿã€ç»“å©šã€é¢†è¯ï¼Œæ­£å¸¸æƒ…å†µä¸‹æˆ‘ä»¬æ˜¯éœ€è¦åˆ†åˆ«å»æ‰¾è¿™ä¸‰ä¸ªéƒ¨é—¨å»å®Œæˆçš„ï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬é€šè¿‡é—¨é¢ç»Ÿä¸€æ¥å®Œæˆï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SubSystemA</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test1</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;æ’é˜Ÿ&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SubSystemB</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test2</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;ç»“å©š&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SubSystemC</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test3</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;é¢†è¯&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç°åœ¨ä¸‰ä¸ªç³»ç»Ÿå¤ªå¤æ‚äº†ï¼Œæˆ‘ä»¬æ·»åŠ ä¸€ä¸ªé—¨é¢ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Facade</span> &#123;<br><br>    <span class="hljs-type">SubSystemA</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SubSystemA</span>();<br>    <span class="hljs-type">SubSystemB</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SubSystemB</span>();<br>    <span class="hljs-type">SubSystemC</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SubSystemC</span>();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">marry</span><span class="hljs-params">()</span>&#123;   <span class="hljs-comment">//çº¢ç™½å–œäº‹ä¸€æ¡é¾™æœåŠ¡</span><br>        a.test1();<br>        b.test2();<br>        c.test3();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªé—¨é¢å°±èƒ½ç›´æ¥æŠŠäº‹æƒ…åŠå®Œäº†ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">Facade</span> <span class="hljs-variable">facade</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Facade</span>();<br>    facade.marry();<br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡ä½¿ç”¨å¤–è§‚æ¨¡å¼ï¼Œæˆ‘ä»¬å°±å¤§å¤§é™ä½äº†ç±»ä¸ç±»ç›´æ¥çš„å…³è”ç¨‹åº¦ï¼Œå¹¶ä¸”ç®€åŒ–äº†æµç¨‹ã€‚</p><h2 id="äº«å…ƒæ¨¡å¼"><a href="#äº«å…ƒæ¨¡å¼" class="headerlink" title="äº«å…ƒæ¨¡å¼"></a>äº«å…ƒæ¨¡å¼</h2><p>æœ€åæˆ‘ä»¬æ¥çœ‹çœ‹äº«å…ƒæ¨¡å¼ï¼ˆFlyweightï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªâ€äº«å…ƒâ€ä»£è¡¨ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ä¸‹é¢çš„é—®é¢˜ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">str1</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;abcdefg&quot;</span>;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">str2</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;abcd&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å‘ç°ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä¸¤ä¸ªå­—ç¬¦ä¸²è™½ç„¶é•¿çŸ­ä¸åŒï¼Œä½†æ˜¯å´åŒ…å«äº†ä¸€æ®µç›¸åŒçš„éƒ¨åˆ†ï¼Œé‚£ä¹ˆç°åœ¨æˆ‘ä»¬å¦‚æœè¦å¯¹å†…å­˜è¿›è¡Œä¼˜åŒ–ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">str1</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;efg&quot;</span>;   <span class="hljs-comment">//ç”±äºstr1åŒ…å«str2ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å»æ‰é‡å¤çš„éƒ¨åˆ†ï¼Œå½“éœ€è¦åŸæœ¬çš„str1æ—¶ï¼Œå†åˆåœ¨ä¸€èµ·</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">str2</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;abcd&quot;</span>;<br>    System.out.println(<span class="hljs-string">&quot;str1 = &quot;</span>+str2+str1);<br>&#125;<br></code></pre></td></tr></table></figure><p>è€Œäº«å…ƒæ¨¡å¼å°±æ˜¯è¿™ä¸ªæ€æƒ³ï¼Œæˆ‘ä»¬å¯ä»¥å°†é‚£äº›é‡å¤å‡ºç°çš„å†…å®¹ä½œä¸ºå…±äº«éƒ¨åˆ†å–å‡ºï¼Œè¿™æ ·å½“æˆ‘ä»¬æ‹¥æœ‰å¤§é‡å¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬æŠŠå…¶ä¸­å…±åŒçš„éƒ¨åˆ†æŠ½å–å‡ºæ¥ï¼Œç”±äºæå–çš„éƒ¨åˆ†æ˜¯å¤šä¸ªå¯¹è±¡å…±äº«åªæœ‰ä¸€ä»½ï¼Œé‚£ä¹ˆå°±å¯ä»¥å‡è½»å†…å­˜çš„å‹åŠ›ã€‚åŒ…æ‹¬æˆ‘ä»¬çš„å›´æ£‹ï¼Œå®é™…ä¸Šæˆ‘ä»¬åªéœ€è¦çŸ¥é“æ£‹ç›˜ä¸Šçš„å„ä¸ªä½ç½®æ˜¯é»‘æ£‹è¿˜æ˜¯ç™½æ£‹ï¼Œå®é™…ä¸Šæ²¡æœ‰æ¯•ä¸šåˆ›å»ºå¾ˆå¤šä¸ªæ£‹å­å¯¹è±¡ï¼Œæˆ‘ä»¬åªéœ€è¦å»å¤ç”¨ä¸€ä¸ªé»‘æ£‹å’Œä¸€ä¸ªç™½æ£‹å­å¯¹è±¡å³å¯ã€‚</p><p>æ¯”å¦‚ç°åœ¨æˆ‘ä»¬æœ‰ä¸¤ä¸ªæœåŠ¡ï¼Œä½†æ˜¯ä»–ä»¬éƒ½éœ€è¦ä½¿ç”¨æ•°æ®åº“å·¥å…·ç±»æ¥æ“ä½œï¼Œå®é™…ä¸Šè¿™ä¸ªå·¥å…·ç±»æ²¡å¿…è¦åˆ›å»ºå¤šä¸ªï¼Œæˆ‘ä»¬è¿™æ—¶å°±å¯ä»¥ä½¿ç”¨äº«å…ƒæ¨¡å¼ï¼Œè®©æ•°æ®åº“å·¥å…·ç±»ä½œä¸ºäº«å…ƒç±»ï¼Œé€šè¿‡äº«å…ƒå·¥å‚æ¥æä¾›ä¸€ä¸ªå…±äº«çš„æ•°æ®åº“å·¥å…·ç±»ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DBUtil</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">selectDB</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;æˆ‘æ˜¯æ•°æ®åº“æ“ä½œ...&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DBUtilFactory</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">DBUtil</span> <span class="hljs-variable">UTIL</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DBUtil</span>();   <span class="hljs-comment">//äº«å…ƒå¯¹è±¡è¢«å­˜æ”¾åœ¨å·¥å‚ä¸­</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> DBUtil <span class="hljs-title function_">getFlyweight</span><span class="hljs-params">()</span>&#123;   <span class="hljs-comment">//è·å–äº«å…ƒå¯¹è±¡</span><br>        <span class="hljs-keyword">return</span> UTIL;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æœ€åå½“æˆ‘ä»¬éœ€è¦ä½¿ç”¨äº«å…ƒå¯¹è±¡æ—¶ï¼Œç›´æ¥æ‰¾äº«å…ƒå·¥å‚è¦å°±è¡Œäº†ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> &#123;   <span class="hljs-comment">//ç”¨æˆ·æœåŠ¡</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">service</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">DBUtil</span> <span class="hljs-variable">util</span> <span class="hljs-operator">=</span> DBUtilFactory.getFlyweight();   <span class="hljs-comment">//é€šè¿‡äº«å…ƒå·¥å‚æ‹¿åˆ°DBUtilå¯¹è±¡</span><br>        util.selectDB();    <span class="hljs-comment">//è¯¥å¹²å˜›å¹²å˜›</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œè¿™åªæ˜¯ç®€å•çš„äº«å…ƒæ¨¡å¼å®ç°ï¼Œå®é™…ä¸Šæˆ‘ä»¬ä¸€å¼€å§‹ä¸¾ä¾‹çš„Stringç±»ï¼Œä¹Ÿåœ¨ä½¿ç”¨äº«å…ƒæ¨¡å¼è¿›è¡Œä¼˜åŒ–ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">str1</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;abcd&quot;</span>;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">str2</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;abcd&quot;</span>;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">str3</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;ab&quot;</span> + <span class="hljs-string">&quot;cd&quot;</span>;<br>    System.out.println(str1 == str2);<br>    System.out.println(str1 == str3);   <span class="hljs-comment">//çŒœçŒœè¿™ä¸‰ä¸ªå¯¹è±¡æ˜¯ä¸æ˜¯éƒ½æ˜¯åŒä¸€ä¸ªï¼Ÿ</span><br>&#125;<br></code></pre></td></tr></table></figure><p>è™½ç„¶æˆ‘ä»¬è¿™é‡Œå®šä¹‰äº†ä¸‰ä¸ªå­—ç¬¦ä¸²ï¼Œä½†æ˜¯æˆ‘ä»¬å‘ç°ï¼Œè¿™ä¸‰ä¸ªå¯¹è±¡æŒ‡å‘çš„éƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå®é™…ä¸Šè¿™æ­£æ˜¯Javaè¯­è¨€å®ç°äº†æ•°æ®çš„å…±äº«ï¼Œæƒ³è¦äº†è§£å…·ä½“å®ç°è¯·å‰å¾€JVMç¯‡è§†é¢‘æ•™ç¨‹ã€‚</p><hr><p>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºæŸç çŸ¥è¯†åº“ç‰ˆæƒæ‰€æœ‰ï¼Œç¦æ­¢ä¸€åˆ‡æœªç»æˆæƒçš„è½¬è½½ã€å‘å¸ƒã€å‡ºå”®ç­‰è¡Œä¸ºï¼Œè¿è€…å°†è¢«è¿½ç©¶æ³•å¾‹è´£ä»»ã€‚</p><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://www.itbaima.cn/document/6386mh7anqt4tzyv">https://www.itbaima.cn/document/6386mh7anqt4tzyv</a></p>]]></content>
    
    
    <categories>
      
      <category>è®¾è®¡æ¨¡å¼</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è®¾è®¡æ¨¡å¼-åˆ›å»ºå‹</title>
    <link href="/post/88c4bd86-406b-4f82-b97f-94054c971e48/"/>
    <url>/post/88c4bd86-406b-4f82-b97f-94054c971e48/</url>
    
    <content type="html"><![CDATA[<h3 id="è®¾è®¡æ¨¡å¼-åˆ›å»ºå‹"><a href="#è®¾è®¡æ¨¡å¼-åˆ›å»ºå‹" class="headerlink" title="è®¾è®¡æ¨¡å¼-åˆ›å»ºå‹"></a>è®¾è®¡æ¨¡å¼-åˆ›å»ºå‹</h3><p><code>hexo template generate by typora plugin templater</code></p><p><img src="CZbSEekKftDYp25-1720456478594-245.jpg" alt="image-20230301111626247"></p><h1 id="è®¾è®¡æ¨¡å¼ï¼ˆåˆ›å»ºå‹ï¼‰"><a href="#è®¾è®¡æ¨¡å¼ï¼ˆåˆ›å»ºå‹ï¼‰" class="headerlink" title="è®¾è®¡æ¨¡å¼ï¼ˆåˆ›å»ºå‹ï¼‰"></a>è®¾è®¡æ¨¡å¼ï¼ˆåˆ›å»ºå‹ï¼‰</h1><p>è½¯ä»¶è®¾è®¡æ¨¡å¼ï¼ˆDesign patternï¼‰ï¼Œåˆç§°è®¾è®¡æ¨¡å¼ï¼Œæ˜¯ä¸€å¥—è¢«åå¤ä½¿ç”¨ã€å¤šæ•°äººçŸ¥æ™“çš„ã€ç»è¿‡åˆ†ç±»ç¼–ç›®çš„ã€ä»£ç è®¾è®¡ç»éªŒçš„æ€»ç»“ã€‚ä½¿ç”¨è®¾è®¡æ¨¡å¼æ˜¯ä¸ºäº†å¯é‡ç”¨ä»£ç ã€è®©ä»£ç æ›´å®¹æ˜“è¢«ä»–äººç†è§£ã€ä¿è¯ä»£ç å¯é æ€§ã€ç¨‹åºçš„é‡ç”¨æ€§ã€‚</p><blockquote><p>è‚¯ç‰¹Â·è´å…‹å’Œ<a href="https://baike.baidu.com/item/%E6%B2%83%E5%BE%B7%C2%B7%E5%9D%8E%E5%AE%81%E5%AE%89/6488429">æ²ƒå¾·Â·åå®å®‰</a>åœ¨1987å¹´åˆ©ç”¨å…‹é‡Œæ–¯æ‰˜ä½›Â·äºšå†å±±å¤§åœ¨å»ºç­‘è®¾è®¡é¢†åŸŸé‡Œçš„æ€æƒ³å¼€å‘äº†è®¾è®¡æ¨¡å¼å¹¶æŠŠæ­¤æ€æƒ³åº”ç”¨åœ¨Smalltalkä¸­çš„å›¾å½¢ç”¨æˆ·æ¥å£çš„ç”Ÿæˆä¸­ã€‚ä¸€å¹´åErich Gammaåœ¨ä»–çš„<a href="https://baike.baidu.com/item/%E8%8B%8F%E9%BB%8E%E4%B8%96%E5%A4%A7%E5%AD%A6/1621125">è‹é»ä¸–å¤§å­¦</a>åšå£«æ¯•ä¸šè®ºæ–‡ä¸­å¼€å§‹å°è¯•æŠŠè¿™ç§æ€æƒ³æ”¹å†™ä¸ºé€‚ç”¨äºè½¯ä»¶å¼€å‘ã€‚ä¸æ­¤åŒæ—¶James Coplien åœ¨1989å¹´è‡³1991 å¹´ä¹Ÿåœ¨åˆ©ç”¨ç›¸åŒçš„æ€æƒ³è‡´åŠ›äºC++çš„å¼€å‘ï¼Œè€Œåäº1991å¹´å‘è¡¨äº†ä»–çš„è‘—ä½œAdvanced C++ Idiomsã€‚å°±åœ¨è¿™ä¸€å¹´Erich Gamma å¾—åˆ°äº†åšå£«å­¦ä½ï¼Œç„¶åå»äº†ç¾å›½ï¼Œåœ¨é‚£ä¸Richard Helm, Ralph Johnson ,John Vlissidesåˆä½œå‡ºç‰ˆäº†Design Patterns - Elements of Reusable Object-Oriented Software ä¸€ä¹¦ï¼Œåœ¨æ­¤ä¹¦ä¸­å…±æ”¶å½•äº†23ä¸ªè®¾è®¡æ¨¡å¼ã€‚è¿™å››ä½ä½œè€…åœ¨è½¯ä»¶å¼€å‘é¢†åŸŸé‡Œä¹Ÿä»¥ä»–ä»¬çš„åŒ¿åè‘—ç§°Gang of Four(å››äººå¸®ï¼Œç®€ç§°GoF),å¹¶ä¸”æ˜¯ä»–ä»¬åœ¨æ­¤ä¹¦ä¸­çš„åä½œå¯¼è‡´äº†è½¯ä»¶è®¾è®¡æ¨¡å¼çš„çªç ´ã€‚</p></blockquote><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æœ‰å…³å¯¹è±¡åˆ›å»ºçš„å‡ ç§è®¾è®¡æ¨¡å¼ã€‚</p><h2 id="å·¥å‚æ–¹æ³•æ¨¡å¼"><a href="#å·¥å‚æ–¹æ³•æ¨¡å¼" class="headerlink" title="å·¥å‚æ–¹æ³•æ¨¡å¼"></a>å·¥å‚æ–¹æ³•æ¨¡å¼</h2><p>é¦–å½“å…¶å†²çš„æ˜¯æœ€ç®€å•çš„ä¸€ç§è®¾è®¡æ¨¡å¼â€”â€”å·¥å‚æ–¹æ³•æ¨¡å¼ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœéœ€è¦åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆæœ€ç®€å•çš„æ–¹å¼å°±æ˜¯ç›´æ¥newä¸€ä¸ªå³å¯ã€‚è€Œå·¥å‚æ–¹æ³•æ¨¡å¼ä»£æ›¿äº†ä¼ ç»Ÿçš„ç›´æ¥newçš„å½¢å¼ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¦æ›¿ä»£ä¼ ç»Ÿçš„newå½¢å¼å‘¢ï¼Ÿ</p><p>å¯ä»¥æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæ‰€æœ‰çš„å¯¹è±¡æˆ‘ä»¬éƒ½é€šè¿‡newçš„æ–¹å¼å»åˆ›å»ºï¼Œé‚£ä¹ˆå½“æˆ‘ä»¬çš„ç¨‹åºä¸­å¤§é‡ä½¿ç”¨æ­¤å¯¹è±¡æ—¶ï¼Œçªç„¶æœ‰ä¸€å¤©è¿™ä¸ªå¯¹è±¡çš„æ„é€ æ–¹æ³•æˆ–æ˜¯ç±»åå‘ç”Ÿäº†ä¿®æ”¹ï¼Œé‚£æˆ‘ä»¬å²‚ä¸æ˜¯å¾—æŒ¨ä¸ªå»è¿›è¡Œä¿®æ”¹ï¼Ÿæ ¹æ®è¿ªç±³ç‰¹æ³•åˆ™ï¼Œæˆ‘ä»¬åº”è¯¥å°½å¯èƒ½åœ°å°‘ä¸å…¶ä»–ç±»è¿›è¡Œäº¤äº’ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†é‚£äº›éœ€è¦é¢‘ç¹å‡ºç°çš„å¯¹è±¡åˆ›å»ºï¼Œå°è£…åˆ°ä¸€ä¸ªå·¥å‚ç±»ä¸­ï¼Œå½“æˆ‘ä»¬éœ€è¦å¯¹è±¡æ—¶ï¼Œç›´æ¥è°ƒç”¨å·¥å‚ç±»ä¸­çš„å·¥å‚æ–¹æ³•æ¥ä¸ºæˆ‘ä»¬ç”Ÿæˆå¯¹è±¡ï¼Œè¿™æ ·ï¼Œå°±ç®—ç±»å‡ºç°äº†å˜åŠ¨ï¼Œæˆ‘ä»¬ä¹Ÿåªéœ€è¦ä¿®æ”¹å·¥å‚ä¸­çš„ä»£ç å³å¯ï¼Œè€Œä¸æ˜¯å¤§é¢ç§¯åœ°è¿›è¡Œä¿®æ”¹ã€‚</p><p>åŒæ—¶ï¼Œå¯èƒ½æŸäº›å¯¹è±¡çš„åˆ›å»ºå¹¶ä¸åªæ˜¯ä¸€ä¸ªnewå°±å¯ä»¥æå®šï¼Œå¯èƒ½è¿˜éœ€è¦æ›´å¤šçš„æ­¥éª¤æ¥å‡†å¤‡æ„é€ æ–¹æ³•éœ€è¦çš„å‚æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨<code>ç®€å•å·¥å‚æ¨¡å¼</code>æ¥åˆ›å»ºå¯¹è±¡ï¼Œæ—¢ç„¶æ˜¯å·¥å‚ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ¥åˆ›å»ºç‚¹å·¥å‚éœ€è¦ç”Ÿäº§çš„ä¸œè¥¿ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Fruit</span> &#123;   <span class="hljs-comment">//æ°´æœæŠ½è±¡ç±»</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String name;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Fruit</span><span class="hljs-params">(String name)</span>&#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name+<span class="hljs-string">&quot;@&quot;</span>+hashCode();   <span class="hljs-comment">//æ‰“å°ä¸€ä¸‹å½“å‰æ°´æœåç§°ï¼Œè¿˜æœ‰å¯¹è±¡çš„hashCode</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Apple</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Fruit</span>&#123;   <span class="hljs-comment">//è‹¹æœï¼Œç»§æ‰¿è‡ªæ°´æœ</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Apple</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>(<span class="hljs-string">&quot;è‹¹æœ&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Orange</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Fruit</span>&#123;  <span class="hljs-comment">//æ©˜å­ï¼Œä¹Ÿæ˜¯ç»§æ‰¿è‡ªæ°´æœ</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Orange</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>(<span class="hljs-string">&quot;æ©˜å­&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç›´æ¥newå°±å¯ä»¥å¾—åˆ°å¯¹è±¡äº†ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">Apple</span> <span class="hljs-variable">apple</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Apple</span>();<br>        System.out.println(apple);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬å°†å¯¹è±¡çš„åˆ›å»ºå°è£…åˆ°å·¥å‚ä¸­ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FruitFactory</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è¿™é‡Œå°±ç›´æ¥æ¥ä¸€ä¸ªé™æ€æ–¹æ³•æ ¹æ®æŒ‡å®šç±»å‹è¿›è¡Œåˆ›å»º</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> type æ°´æœç±»å‹</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> å¯¹åº”çš„æ°´æœå¯¹è±¡</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Fruit <span class="hljs-title function_">getFruit</span><span class="hljs-params">(String type)</span> &#123;<br>        <span class="hljs-keyword">switch</span> (type) &#123;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;è‹¹æœ&quot;</span>:<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Apple</span>();<br>           <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;æ©˜å­&quot;</span>:<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Orange</span>();<br>            <span class="hljs-keyword">default</span>:<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨æ­¤å·¥å‚æ¥åˆ›å»ºå¯¹è±¡äº†ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">Fruit</span> <span class="hljs-variable">fruit</span> <span class="hljs-operator">=</span> FruitFactory.getFruit(<span class="hljs-string">&quot;æ©˜å­&quot;</span>);   <span class="hljs-comment">//ç›´æ¥é—®å·¥å‚è¦ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬è‡ªå·±å»åˆ›å»º</span><br>        System.out.println(fruit);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸è¿‡è¿™æ ·è¿˜æ˜¯æœ‰ä¸€äº›é—®é¢˜ï¼Œæˆ‘ä»¬å‰é¢æåˆ°äº†å¼€é—­åŸåˆ™ï¼Œä¸€ä¸ªè½¯ä»¶å®ä½“ï¼Œæ¯”å¦‚ç±»ã€æ¨¡å—å’Œå‡½æ•°åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ç°åœ¨éœ€è¦æ–°å¢ä¸€ç§æ°´æœï¼Œæ¯”å¦‚æ¡ƒå­ï¼Œé‚£ä¹ˆè¿™æ—¶æˆ‘ä»¬å°±å¾—å»ä¿®æ”¹å·¥å‚æä¾›çš„å·¥å‚æ–¹æ³•äº†ï¼Œä½†æ˜¯è¿™æ ·æ˜¯ä¸å¤ªç¬¦åˆå¼€é—­åŸåˆ™çš„ï¼Œå› ä¸ºå·¥å‚å®é™…ä¸Šæ˜¯é’ˆå¯¹äºè°ƒç”¨æ–¹æä¾›çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥å°½å¯èƒ½å¯¹ä¿®æ”¹å…³é—­ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å°±åˆ©ç”¨å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­çš„æ€§è´¨ï¼Œå°†<code>ç®€å•å·¥å‚æ¨¡å¼</code>æ”¹è¿›ä¸º<code>å·¥å‚æ–¹æ³•æ¨¡å¼</code>ï¼Œé‚£ç°åœ¨æ—¢ç„¶ä¸è®©æ”¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±çœ‹çœ‹å¦‚ä½•å»ä½¿ç”¨æ‰©å±•çš„å½¢å¼ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FruitFactory</span>&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Fruit</span>&gt; &#123;   <span class="hljs-comment">//å°†æ°´æœå·¥å‚æŠ½è±¡ä¸ºæŠ½è±¡ç±»ï¼Œæ·»åŠ æ³›å‹Tç”±å­ç±»æŒ‡å®šæ°´æœç±»å‹</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> T <span class="hljs-title function_">getFruit</span><span class="hljs-params">()</span>;  <span class="hljs-comment">//ä¸åŒçš„æ°´æœå·¥å‚ï¼Œé€šè¿‡æ­¤æ–¹æ³•ç”Ÿäº§ä¸åŒçš„æ°´æœ</span><br>&#125;<br></code></pre></td></tr></table></figure><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppleFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">FruitFactory</span>&lt;Apple&gt; &#123;  <span class="hljs-comment">//è‹¹æœå·¥å‚ï¼Œç›´æ¥è¿”å›Appleï¼Œä¸€æ­¥åˆ°ä½</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Apple <span class="hljs-title function_">getFruit</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Apple</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ä¸åŒç±»å‹çš„å·¥å‚æ¥ç”Ÿäº§ä¸åŒç±»å‹çš„æ°´æœäº†ï¼Œå¹¶ä¸”å¦‚æœæ–°å¢äº†æ°´æœç±»å‹ï¼Œç›´æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„å·¥å‚ç±»å°±è¡Œï¼Œä¸éœ€è¦ä¿®æ”¹ä¹‹å‰å·²ç»ç¼–å†™å¥½çš„å†…å®¹ã€‚</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        test(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AppleFactory</span>()::getFruit);   <span class="hljs-comment">//æ¯”å¦‚æˆ‘ä»¬ç°åœ¨è¦åƒä¸€ä¸ªè‹¹æœï¼Œé‚£ä¹ˆå°±ç›´æ¥é€šè¿‡è‹¹æœå·¥å‚æ¥è·å–è‹¹æœ</span><br>    &#125;<br><br>    <span class="hljs-comment">//æ­¤æ–¹æ³•æ¨¡æ‹Ÿåƒæ‰ä¸€ä¸ªæ°´æœ</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">(Supplier&lt;Fruit&gt; supplier)</span>&#123;<br>        System.out.println(supplier.get()+<span class="hljs-string">&quot; è¢«åƒæ‰äº†ï¼ŒçœŸå¥½åƒã€‚&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±ç®€å•å®ç°äº†å·¥å‚æ–¹æ³•æ¨¡å¼ï¼Œé€šè¿‡å·¥å‚æ¥å±è”½å¯¹è±¡çš„åˆ›å»ºç»†èŠ‚ï¼Œä½¿ç”¨è€…åªéœ€è¦å…³å¿ƒå¦‚ä½•å»ä½¿ç”¨å¯¹è±¡å³å¯ã€‚</p><h2 id="æŠ½è±¡å·¥å‚æ¨¡å¼"><a href="#æŠ½è±¡å·¥å‚æ¨¡å¼" class="headerlink" title="æŠ½è±¡å·¥å‚æ¨¡å¼"></a>æŠ½è±¡å·¥å‚æ¨¡å¼</h2><p>å‰é¢æˆ‘ä»¬ä»‹ç»äº†å·¥å‚æ–¹æ³•æ¨¡å¼ï¼Œé€šè¿‡å®šä¹‰é¡¶å±‚æŠ½è±¡å·¥å‚ç±»ï¼Œé€šè¿‡ç»§æ‰¿çš„æ–¹å¼ï¼Œé’ˆå¯¹äºæ¯ä¸€ä¸ªäº§å“éƒ½æä¾›ä¸€ä¸ªå·¥å‚ç±»ç”¨äºåˆ›å»ºã€‚</p><p>ä¸è¿‡è¿™ç§æ¨¡å¼åªé€‚ç”¨äºç®€å•å¯¹è±¡ï¼Œå½“æˆ‘ä»¬éœ€è¦ç”Ÿäº§è®¸å¤šä¸ªäº§å“æ—çš„æ—¶å€™ï¼Œè¿™ç§æ¨¡å¼å°±æœ‰ç‚¹ä¹åŠ›äº†ï¼Œæ¯”å¦‚ï¼š</p><p><img src="leHOprkRiys3WhN.jpg" alt="image-20230301111712035"></p><p>å®é™…ä¸Šè¿™äº›äº§å“éƒ½æ˜¯æˆæ—å‡ºç°çš„ï¼Œæ¯”å¦‚å°ç±³çš„äº§å“çº¿ä¸Šæœ‰å°ç±³12ï¼Œå°ç±³å¹³æ¿ç­‰ï¼Œåä¸ºçš„äº§å“çº¿ä¸Šä¹Ÿæœ‰åä¸ºæ‰‹æœºã€åä¸ºå¹³æ¿ï¼Œä½†æ˜¯å¦‚æœæŒ‰ç…§æˆ‘ä»¬ä¹‹å‰å·¥å‚æ–¹æ³•æ¨¡å¼æ¥è¿›è¡Œè®¾è®¡ï¼Œé‚£å°±éœ€è¦å•ç‹¬è®¾è®¡9ä¸ªå·¥å‚æ¥ç”Ÿäº§ä¸Šé¢è¿™äº›äº§å“ï¼Œæ˜¾ç„¶è¿™æ ·å°±æ¯”è¾ƒæµªè´¹æ—¶é—´çš„ã€‚</p><p>ä½†æ˜¯ç°åœ¨æœ‰ä»€ä¹ˆæ–¹æ³•èƒ½å¤Ÿæ›´å¥½åœ°å¤„ç†è¿™ç§æƒ…å†µå‘¢ï¼Ÿæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨æŠ½è±¡å·¥å‚æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥å°†å¤šä¸ªäº§å“ï¼Œéƒ½æ”¾åœ¨ä¸€ä¸ªå·¥å‚ä¸­è¿›è¡Œç”Ÿæˆï¼ŒæŒ‰ä¸åŒçš„äº§å“æ—è¿›è¡Œåˆ’åˆ†ï¼Œæ¯”å¦‚å°ç±³ï¼Œé‚£ä¹ˆæˆ‘å°±å¯ä»¥å®‰æ’ä¸€ä¸ªå°ç±³å·¥å‚ï¼Œè€Œè¿™ä¸ªå·¥å‚é‡Œé¢å°±å¯ä»¥ç”Ÿäº§æ•´æ¡äº§å“çº¿ä¸Šçš„å†…å®¹ï¼ŒåŒ…æ‹¬å°ç±³æ‰‹æœºã€å°ç±³å¹³æ¿ã€å°ç±³è·¯ç”±ç­‰ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬åªéœ€è¦å»ºç«‹ä¸€ä¸ªæŠ½è±¡å·¥å‚å³å¯ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Router</span> &#123;<br>&#125;<br></code></pre></td></tr></table></figure><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Table</span> &#123;<br>&#125;<br></code></pre></td></tr></table></figure><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Phone</span> &#123;<br>&#125;<br></code></pre></td></tr></table></figure><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AbstractFactory</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> Phone <span class="hljs-title function_">getPhone</span><span class="hljs-params">()</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> Table <span class="hljs-title function_">getTable</span><span class="hljs-params">()</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> Router <span class="hljs-title function_">getRouter</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸€ä¸ªå·¥å‚å¯ä»¥ç”Ÿäº§åŒä¸€ä¸ªäº§å“æ—çš„æ‰€æœ‰äº§å“ï¼Œè¿™æ ·æŒ‰æ—è¿›è¡Œåˆ†ç±»ï¼Œæ˜¾ç„¶æ¯”ä¹‹å‰çš„å·¥å‚æ–¹æ³•æ¨¡å¼æ›´å¥½ã€‚</p><p>ä¸è¿‡ï¼Œç¼ºç‚¹è¿˜æ˜¯æœ‰çš„ï¼Œå¦‚æœäº§å“æ—æ–°å¢äº†äº§å“ï¼Œé‚£ä¹ˆæˆ‘å°±ä¸å¾—ä¸å»ä¸ºæ¯ä¸€ä¸ªäº§å“æ—çš„å·¥å‚éƒ½å»æ·»åŠ æ–°äº§å“çš„ç”Ÿäº§æ–¹æ³•ï¼Œè¿èƒŒäº†å¼€é—­åŸåˆ™ã€‚</p><h2 id="å»ºé€ è€…æ¨¡å¼"><a href="#å»ºé€ è€…æ¨¡å¼" class="headerlink" title="å»ºé€ è€…æ¨¡å¼"></a>å»ºé€ è€…æ¨¡å¼</h2><p>å»ºé€ è€…æ¨¡å¼ä¹Ÿæ˜¯éå¸¸å¸¸è§çš„ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œæˆ‘ä»¬ç»å¸¸çœ‹åˆ°æœ‰å¾ˆå¤šçš„æ¡†æ¶éƒ½ä¸ºæˆ‘ä»¬æä¾›äº†å½¢å¦‚<code>XXXBuilder</code>çš„ç±»å‹ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¹Ÿæ˜¯ä½¿ç”¨è¿™äº›ç±»æ¥åˆ›å»ºæˆ‘ä»¬éœ€è¦çš„å¯¹è±¡ã€‚</p><p>æ¯”å¦‚ï¼Œæˆ‘ä»¬åœ¨JavaSEä¸­å°±å­¦ä¹ è¿‡çš„<code>StringBuiler</code>ç±»ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();   <span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªStringBuilderæ¥é€æ­¥æ„å»ºä¸€ä¸ªå­—ç¬¦ä¸²</span><br>    builder.append(<span class="hljs-number">666</span>);   <span class="hljs-comment">//æ‹¼æ¥ä¸€ä¸ªæ•°å­—</span><br>    builder.append(<span class="hljs-string">&quot;è€é“&quot;</span>);   <span class="hljs-comment">//æ‹¼æ¥ä¸€ä¸ªå­—ç¬¦ä¸²</span><br>   builder.insert(<span class="hljs-number">2</span>, <span class="hljs-string">&#x27;?&#x27;</span>);  <span class="hljs-comment">//åœ¨ç¬¬ä¸‰ä¸ªä½ç½®æ’å…¥ä¸€ä¸ªå­—ç¬¦</span><br>    System.out.println(builder.toString());   <span class="hljs-comment">//å·®ä¸å¤šæˆå½¢äº†ï¼Œæœ€åè½¬æ¢ä¸ºå­—ç¬¦ä¸²</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å®é™…ä¸Šæˆ‘ä»¬æ˜¯é€šè¿‡å»ºé€ è€…æ¥ä¸æ–­é…ç½®å‚æ•°æˆ–æ˜¯å†…å®¹ï¼Œå½“æˆ‘ä»¬é…ç½®å®Œæ‰€æœ‰å†…å®¹åï¼Œæœ€åå†è¿›è¡Œå¯¹è±¡çš„æ„å»ºã€‚</p><p>ç›¸æ¯”ç›´æ¥å»newä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå»ºé€ è€…æ¨¡å¼çš„é‡å¿ƒæ›´åŠ å…³æ³¨åœ¨å¦‚ä½•å®Œæˆæ¯ä¸€æ­¥çš„é…ç½®ï¼ŒåŒæ—¶å¦‚æœä¸€ä¸ªç±»çš„æ„é€ æ–¹æ³•å‚æ•°è¿‡å¤šï¼Œæˆ‘ä»¬é€šè¿‡å»ºé€ è€…æ¨¡å¼æ¥åˆ›å»ºè¿™ä¸ªå¯¹è±¡ï¼Œä¼šæ›´åŠ ä¼˜é›…ã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ªå­¦ç”Ÿç±»ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> &#123;<br>    <span class="hljs-type">int</span> id;<br>    <span class="hljs-type">int</span> age;<br>    <span class="hljs-type">int</span> grade;<br>    String name;<br>    String college;<br>    String profession;<br>    List&lt;String&gt; awards;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">(<span class="hljs-type">int</span> id, <span class="hljs-type">int</span> age, <span class="hljs-type">int</span> grade, String name, String college, String profession, List&lt;String&gt; awards)</span> &#123;<br>        <span class="hljs-built_in">this</span>.id = id;<br>        <span class="hljs-built_in">this</span>.age = age;<br>        <span class="hljs-built_in">this</span>.grade = grade;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.college = college;<br>        <span class="hljs-built_in">this</span>.profession = profession;<br>        <span class="hljs-built_in">this</span>.awards = awards;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªå­¦ç”Ÿç±»çš„å±æ€§æ˜¯éå¸¸å¤šçš„ï¼Œæ‰€ä»¥æ„é€ æ–¹æ³•ä¸æ˜¯ä¸€èˆ¬çš„é•¿ï¼Œå¦‚æœæˆ‘ä»¬ç°åœ¨ç›´æ¥é€šè¿‡newçš„æ–¹å¼å»åˆ›å»ºï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-number">1</span>, <span class="hljs-number">18</span>, <span class="hljs-number">3</span>, <span class="hljs-string">&quot;å°æ˜&quot;</span>, <span class="hljs-string">&quot;è®¡ç®—æœºå­¦é™¢&quot;</span>, <span class="hljs-string">&quot;è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯&quot;</span>, Arrays.asList(<span class="hljs-string">&quot;ICPC-ACM åŒºåŸŸèµ› é‡‘ç‰Œ&quot;</span>, <span class="hljs-string">&quot;LPL 2022æ˜¥å­£èµ› å† å†›&quot;</span>));<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å…‰æ˜¯å¡«å‚æ•°å°±éº»çƒ¦ï¼Œæˆ‘ä»¬è¿˜å¾—ä¸€ä¸ªä¸€ä¸ªå¯¹åº”ç€å»å¡«ï¼Œä¸€ä¸å°å¿ƒå¯èƒ½å°±æŠŠå‚æ•°å¡«åˆ°é”™è¯¯çš„ä½ç½®äº†ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥ä½¿ç”¨å»ºé€ è€…æ¨¡å¼æ¥è¿›è¡Œå¯¹è±¡çš„åˆ›å»ºï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> &#123;<br>...<br><br>    <span class="hljs-comment">//ä¸€å¾‹ä½¿ç”¨å»ºé€ è€…æ¥åˆ›å»ºï¼Œä¸å¯¹å¤–ç›´æ¥å¼€æ”¾</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Student</span><span class="hljs-params">(<span class="hljs-type">int</span> id, <span class="hljs-type">int</span> age, <span class="hljs-type">int</span> grade, String name, String college, String profession, List&lt;String&gt; awards)</span> &#123;<br>        ...<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> StudentBuilder <span class="hljs-title function_">builder</span><span class="hljs-params">()</span>&#123;   <span class="hljs-comment">//é€šè¿‡builderæ–¹æ³•ç›´æ¥è·å–å»ºé€ è€…</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StudentBuilder</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StudentBuilder</span>&#123;   <span class="hljs-comment">//è¿™é‡Œå°±ç›´æ¥åˆ›å»ºä¸€ä¸ªå†…éƒ¨ç±»</span><br>        <span class="hljs-comment">//Builderä¹Ÿéœ€è¦å°†æ‰€æœ‰çš„å‚æ•°éƒ½è¿›è¡Œæš‚æ—¶ä¿å­˜ï¼Œæ‰€ä»¥Studentæ€ä¹ˆå®šä¹‰çš„è¿™é‡Œå°±æ€ä¹ˆå®šä¹‰</span><br>        <span class="hljs-type">int</span> id;<br>        <span class="hljs-type">int</span> age;<br>        <span class="hljs-type">int</span> grade;<br>        String name;<br>        String college;<br>        String profession;<br>        List&lt;String&gt; awards;<br><br>        <span class="hljs-keyword">public</span> StudentBuilder <span class="hljs-title function_">id</span><span class="hljs-params">(<span class="hljs-type">int</span> id)</span>&#123;    <span class="hljs-comment">//ç›´æ¥è°ƒç”¨å»ºé€ è€…å¯¹åº”çš„æ–¹æ³•ï¼Œä¸ºå¯¹åº”çš„å±æ€§èµ‹å€¼</span><br>            <span class="hljs-built_in">this</span>.id = id;<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;   <span class="hljs-comment">//ä¸ºäº†æ”¯æŒé“¾å¼è°ƒç”¨ï¼Œè¿™é‡Œç›´æ¥è¿”å›å»ºé€ è€…æœ¬èº«ï¼Œä¸‹åŒ</span><br>        &#125;<br><br>        <span class="hljs-keyword">public</span> StudentBuilder <span class="hljs-title function_">age</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span>&#123;<br>            <span class="hljs-built_in">this</span>.age = age;<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>        &#125;<br>      <br>      ...<br><br>        <span class="hljs-keyword">public</span> StudentBuilder <span class="hljs-title function_">awards</span><span class="hljs-params">(String... awards)</span>&#123;<br>            <span class="hljs-built_in">this</span>.awards = Arrays.asList(awards);<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>        &#125;<br>        <br>        <span class="hljs-keyword">public</span> Student <span class="hljs-title function_">build</span><span class="hljs-params">()</span>&#123;    <span class="hljs-comment">//æœ€åæˆ‘ä»¬åªéœ€è¦è°ƒç”¨å»ºé€ è€…æä¾›çš„buildæ–¹æ³•å³å¯æ ¹æ®æˆ‘ä»¬çš„é…ç½®è¿”å›ä¸€ä¸ªå¯¹è±¡</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(id, age, grade, name, college, profession, awards);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å»ºé€ è€…æ¥ä¸ºæˆ‘ä»¬ç”Ÿæˆå¯¹è±¡äº†ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> Student.builder()   <span class="hljs-comment">//è·å–å»ºé€ è€…</span><br>            .id(<span class="hljs-number">1</span>)    <span class="hljs-comment">//é€æ­¥é…ç½®å„ä¸ªå‚æ•°</span><br>            .age(<span class="hljs-number">18</span>)<br>            .grade(<span class="hljs-number">3</span>)<br>            .name(<span class="hljs-string">&quot;å°æ˜&quot;</span>)<br>            .awards(<span class="hljs-string">&quot;ICPC-ACM åŒºåŸŸèµ› é‡‘ç‰Œ&quot;</span>, <span class="hljs-string">&quot;LPL 2022æ˜¥å­£èµ› å† å†›&quot;</span>)<br>            .build();   <span class="hljs-comment">//æœ€åç›´æ¥å»ºé€ æˆ‘ä»¬æƒ³è¦çš„å¯¹è±¡</span><br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥è®©è¿™äº›å‚æ•°å¯¹å·å…¥åº§äº†ï¼Œå¹¶ä¸”ä¹Ÿæ¯”ä¹‹å‰çš„æ–¹å¼ä¼˜é›…è®¸å¤šã€‚</p><h2 id="å•ä¾‹æ¨¡å¼"><a href="#å•ä¾‹æ¨¡å¼" class="headerlink" title="å•ä¾‹æ¨¡å¼"></a>å•ä¾‹æ¨¡å¼</h2><p>å•ä¾‹æ¨¡å¼å…¶å®åœ¨ä¹‹å‰çš„è¯¾ç¨‹ä¸­å·²ç»æ¼”ç¤ºè¿‡å¾ˆå¤šæ¬¡äº†ï¼Œè¿™ä¹Ÿæ˜¯ä½¿ç”¨é¢‘ç‡éå¸¸é«˜çš„ä¸€ç§æ¨¡å¼ã€‚</p><p>é‚£ä¹ˆï¼Œä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼å‘¢ï¼Ÿé¡¾åæ€ä¹‰ï¼Œå•ä¾‹é‚£ä¹ˆè‚¯å®šå°±æ˜¯åªæœ‰ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œåœ¨æˆ‘ä»¬çš„æ•´ä¸ªç¨‹åºä¸­ï¼ŒåŒä¸€ä¸ªç±»å§‹ç»ˆåªä¼šæœ‰ä¸€ä¸ªå¯¹è±¡æ¥è¿›è¡Œæ“ä½œã€‚æ¯”å¦‚æ•°æ®åº“è¿æ¥ç±»ï¼Œå®é™…ä¸Šæˆ‘ä»¬åªéœ€è¦åˆ›å»ºä¸€ä¸ªå¯¹è±¡æˆ–æ˜¯ç›´æ¥ä½¿ç”¨é™æ€æ–¹æ³•å°±å¯ä»¥äº†ï¼Œæ²¡å¿…è¦å»åˆ›å»ºå¤šä¸ªå¯¹è±¡ã€‚</p><p>è¿™é‡Œè¿˜æ˜¯è¿˜åŸä¸€ä¸‹æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„ç®€å•å•ä¾‹æ¨¡å¼ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Singleton</span> <span class="hljs-variable">INSTANCE</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();   <span class="hljs-comment">//ç”¨äºå¼•ç”¨å…¨å±€å”¯ä¸€çš„å•ä¾‹å¯¹è±¡ï¼Œåœ¨ä¸€å¼€å§‹å°±åˆ›å»ºå¥½</span><br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton</span><span class="hljs-params">()</span> &#123;&#125;   <span class="hljs-comment">//ä¸å…è®¸éšä¾¿newï¼Œéœ€è¦å¯¹è±¡ç›´æ¥æ‰¾getInstance</span><br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span>&#123;   <span class="hljs-comment">//è·å–å…¨å±€å”¯ä¸€çš„å•ä¾‹å¯¹è±¡</span><br>        <span class="hljs-keyword">return</span> INSTANCE;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œå½“æˆ‘ä»¬éœ€è¦è·å–æ­¤å¯¹è±¡æ—¶ï¼Œåªèƒ½é€šè¿‡<code>getInstance()</code>æ¥è·å–å”¯ä¸€çš„å¯¹è±¡ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">Singleton</span> <span class="hljs-variable">singleton</span> <span class="hljs-operator">=</span> Singleton.getInstance();<br>&#125;<br></code></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œå•ä¾‹æ¨¡å¼é™¤äº†è¿™ç§å†™æ³•ä¹‹å¤–ï¼Œè¿˜æœ‰å…¶ä»–å†™æ³•ï¼Œè¿™ç§å†™æ³•è¢«ç§°ä¸ºé¥¿æ±‰å¼å•ä¾‹ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨ä¸€å¼€å§‹ç±»åŠ è½½æ—¶å°±åˆ›å»ºå¥½äº†ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å¦ä¸€ç§å†™æ³•â€”â€”æ‡’æ±‰å¼ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Singleton INSTANCE;   <span class="hljs-comment">//åœ¨ä¸€å¼€å§‹å…ˆä¸è¿›è¡Œå¯¹è±¡åˆ›å»º</span><br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton</span><span class="hljs-params">()</span> &#123;&#125;   <span class="hljs-comment">//ä¸ç”¨å¤šè¯´äº†å§</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span>&#123;   <span class="hljs-comment">//å°†å¯¹è±¡çš„åˆ›å»ºå»¶ååˆ°éœ€è¦æ—¶å†è¿›è¡Œ</span><br>        <span class="hljs-keyword">if</span>(INSTANCE == <span class="hljs-literal">null</span>) &#123;    <span class="hljs-comment">//å¦‚æœå®ä¾‹ä¸ºç©ºï¼Œé‚£ä¹ˆå°±è¿›è¡Œåˆ›å»ºï¼Œä¸ä¸ºç©ºè¯´æ˜å·²ç»åˆ›å»ºè¿‡äº†ï¼Œé‚£ä¹ˆå°±ç›´æ¥è¿”å›</span><br>            INSTANCE = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();<br>        &#125;<br>        <span class="hljs-keyword">return</span> INSTANCE;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œæ‡’æ±‰å¼å°±çœŸçš„æ˜¯æ¡æ‡’ç‹—ï¼Œä½ ä¸å»ç”¨å®ƒï¼Œå®ƒæ˜¯ä¸ä¼šç»™ä½ æå‰å‡†å¤‡å•ä¾‹å¯¹è±¡çš„ï¼ˆå»¶è¿ŸåŠ è½½ï¼Œæ‡’åŠ è½½ï¼‰ï¼Œå½“æˆ‘ä»¬éœ€è¦è·å–å¯¹è±¡æ—¶ï¼Œæ‰ä¼šè¿›è¡Œæ£€æŸ¥å¹¶åˆ›å»ºã€‚è™½ç„¶é¥¿æ±‰å¼å’Œæ‡’æ±‰å¼å†™æ³•ä¸åŒï¼Œä½†æ˜¯æœ€åéƒ½æ˜¯æˆåŠŸå®ç°äº†å•ä¾‹æ¨¡å¼ã€‚</p><p>ä¸è¿‡ï¼Œè¿™é‡Œéœ€è¦ç‰¹åˆ«æé†’ä¸€ä¸‹ï¼Œç”±äºæ‡’æ±‰å¼æ˜¯åœ¨æ–¹æ³•ä¸­è¿›è¡Œçš„åˆå§‹åŒ–ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¯èƒ½ä¼šå‡ºç°é—®é¢˜ï¼ˆå»ºè®®å­¦å®ŒJUCç¯‡è§†é¢‘æ•™ç¨‹å†æ¥è§‚çœ‹ï¼‰å¤§å®¶å¯ä»¥è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶è°ƒç”¨äº†<code>getInstance()</code>æ–¹æ³•ï¼Œé‚£ä¹ˆä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ</p><p><img src="w1oN7u3SxG4cEzL.jpg" alt="image-20230301111737649"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¦‚æœä¸‰æ¡çº¿ç¨‹åŒæ—¶è°ƒç”¨<code>getInstance()</code>æ–¹æ³•ï¼Œä¼šåŒæ—¶è¿›è¡Œ<code>INSTANCE == null</code>çš„åˆ¤æ–­ï¼Œé‚£ä¹ˆæ­¤æ—¶ç”±äºç¡®å®è¿˜æ²¡æœ‰è¿›è¡Œä»»ä½•å®ä¾‹åŒ–ï¼Œæ‰€ä»¥å¯¼è‡´ä¸‰æ¡çº¿ç¨‹å…¨éƒ¨åˆ¤æ–­ä¸º<code>true</code>ï¼ˆè€Œé¥¿æ±‰å¼ç”±äºåœ¨ç±»åŠ è½½æ—¶å°±åˆ›å»ºå®Œæˆï¼Œä¸ä¼šå­˜åœ¨è¿™æ ·çš„é—®é¢˜ï¼‰æ­¤æ—¶é—®é¢˜å°±æ¥äº†ï¼Œæˆ‘ä»¬æ—¢ç„¶è¦ä½¿ç”¨å•ä¾‹æ¨¡å¼ï¼Œé‚£ä¹ˆè‚¯å®šæ˜¯åªå¸Œæœ›å¯¹è±¡åªè¢«åˆå§‹åŒ–ä¸€æ¬¡çš„ï¼Œä½†æ˜¯ç°åœ¨ç”±äºå¤šçº¿ç¨‹çš„æœºåˆ¶ï¼Œå¯¼è‡´å¯¹è±¡è¢«å¤šæ¬¡åˆ›å»ºã€‚</p><p>æ‰€ä»¥ï¼Œä¸ºäº†é¿å…çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œé’ˆå¯¹äºæ‡’æ±‰å¼å•ä¾‹ï¼Œæˆ‘ä»¬è¿˜å¾—è¿›è¡Œä¸€äº›æ”¹è¿›ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">synchronized</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span>&#123;   <span class="hljs-comment">//æ–¹æ³•å¿…é¡»æ·»åŠ synchronizedå…³é”®å­—åŠ é”</span><br>    <span class="hljs-keyword">if</span>(INSTANCE == <span class="hljs-literal">null</span>) &#123;<br>        INSTANCE = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();<br>    &#125;<br>    <span class="hljs-keyword">return</span> INSTANCE;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ—¢ç„¶å¤šä¸ªçº¿ç¨‹è¦è°ƒç”¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ç›´æ¥åŠ ä¸€æŠŠé”ï¼Œåœ¨æ–¹æ³•ä¸Šæ·»åŠ <code>synchronized</code>å…³é”®å­—å³å¯ï¼Œè¿™æ ·åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è¿›å…¥äº†ã€‚è™½ç„¶è¿™æ ·ç®€å•ç²—æš´ï¼Œä½†æ˜¯åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œæ•ˆç‡è‚¯å®šæ˜¯æ¯”è¾ƒä½çš„ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•è¿›è¡Œä¼˜åŒ–ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-keyword">if</span>(INSTANCE == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">synchronized</span> (Singleton.class) &#123;    <span class="hljs-comment">//å®é™…ä¸Šåªéœ€è¦å¯¹èµ‹å€¼è¿™ä¸€æ­¥è¿›è¡ŒåŠ é”å³å¯</span><br>            INSTANCE = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();   <br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> INSTANCE;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸è¿‡è¿™æ ·è¿˜ä¸å®Œç¾ï¼Œå› ä¸ºè¿™æ ·è¿˜æ˜¯æœ‰å¯èƒ½å¤šä¸ªçº¿ç¨‹åŒæ—¶åˆ¤æ–­ä¸º<code>null</code>è€Œè¿›å…¥ç­‰é”çš„çŠ¶æ€ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬è¿˜å¾—åŠ ä¸€å±‚å†…å±‚åˆ¤æ–­ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-keyword">if</span>(INSTANCE == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">synchronized</span> (Singleton.class) &#123;<br>            <span class="hljs-keyword">if</span>(INSTANCE == <span class="hljs-literal">null</span>) INSTANCE = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();  <span class="hljs-comment">//å†…å±‚è¿˜è¦è¿›è¡Œä¸€æ¬¡æ£€æŸ¥ï¼ŒåŒé‡æ£€æŸ¥é”å®š</span><br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> INSTANCE;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸è¿‡æˆ‘ä»¬è¿˜å°‘è€ƒè™‘äº†ä¸€æ ·å†…å®¹ï¼Œå…¶å®IDEAæ­¤æ—¶åº”è¯¥æ˜¯ç»™äº†é»„æ ‡äº†ï¼š</p><p><img src="I9PAi6HRbyMNsJn.jpg" alt="image-20230301111754155"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼ŒIDEAä¼šè¦æ±‚æˆ‘ä»¬æ·»åŠ ä¸€ä¸ª<code>volatile</code>ç»™<code>INSTANCE</code>ï¼Œå„ä½è¿˜è®°å¾—è¿™ä¸ªå…³é”®å­—æœ‰ä»€ä¹ˆä½œç”¨å—ï¼Ÿæ²¡é”™ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¿è¯<code>INSTANCE</code>åœ¨çº¿ç¨‹ä¹‹é—´çš„å¯è§æ€§ï¼Œè¿™æ ·å½“å…¶ä»–çº¿ç¨‹è¿›å…¥ä¹‹åæ‰ä¼šæ‹¿<code>INSTANCE</code>ç”±å…¶ä»–çº¿ç¨‹æ›´æ–°çš„æœ€æ–°å€¼å»åˆ¤æ–­ï¼Œè¿™æ ·ï¼Œå°±å·®ä¸å¤šå®Œç¾äº†ã€‚</p><p>é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰ä¸€ç§æ›´å¥½çš„ï¼Œä¸ç”¨åŠ é”çš„æ–¹å¼ä¹Ÿèƒ½å®ç°å»¶è¿ŸåŠ è½½çš„å†™æ³•å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ä½¿ç”¨é™æ€å†…éƒ¨ç±»ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton</span><span class="hljs-params">()</span> &#123;&#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Holder</span> &#123;   <span class="hljs-comment">//ç”±é™æ€å†…éƒ¨ç±»æŒæœ‰å•ä¾‹å¯¹è±¡ï¼Œä½†æ˜¯æ ¹æ®ç±»åŠ è½½ç‰¹æ€§ï¼Œæˆ‘ä»¬ä»…ä½¿ç”¨Singletonç±»æ—¶ï¼Œä¸ä¼šå¯¹é™æ€å†…éƒ¨ç±»è¿›è¡Œåˆå§‹åŒ–</span><br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Singleton</span> <span class="hljs-variable">INSTANCE</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span>&#123;   <span class="hljs-comment">//åªæœ‰çœŸæ­£ä½¿ç”¨å†…éƒ¨ç±»æ—¶ï¼Œæ‰ä¼šè¿›è¡Œç±»åˆå§‹åŒ–</span><br>        <span class="hljs-keyword">return</span> Holder.INSTANCE;   <span class="hljs-comment">//ç›´æ¥è·å–å†…éƒ¨ç±»ä¸­çš„</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼æ˜¾ç„¶æ˜¯æœ€å®Œç¾çš„æ‡’æ±‰å¼è§£å†³æ–¹æ¡ˆï¼Œæ²¡æœ‰è¿›è¡Œä»»ä½•çš„åŠ é”æ“ä½œï¼Œä¹Ÿèƒ½ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œä¸è¿‡è¦å®ç°è¿™ç§å†™æ³•ï¼Œè·Ÿè¯­è¨€æœ¬èº«ä¹Ÿæœ‰ä¸€å®šçš„å…³è”ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„è¯­è¨€éƒ½æ”¯æŒè¿™ç§å†™æ³•ã€‚</p><h2 id="åŸå‹æ¨¡å¼"><a href="#åŸå‹æ¨¡å¼" class="headerlink" title="åŸå‹æ¨¡å¼"></a>åŸå‹æ¨¡å¼</h2><p>åŸå‹æ¨¡å¼å®é™…ä¸Šä¸å¯¹è±¡çš„æ‹·è´æ¯æ¯ç›¸å…³ï¼ŒåŸå‹æ¨¡å¼ä½¿ç”¨åŸå‹å®ä¾‹æŒ‡å®šå¾…åˆ›å»ºå¯¹è±¡çš„ç±»å‹ï¼Œå¹¶ä¸”é€šè¿‡å¤åˆ¶è¿™ä¸ªåŸå‹æ¥åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŸå‹å¯¹è±¡ä½œä¸ºæ¨¡æ¿ï¼Œé€šè¿‡å…‹éš†æ“ä½œï¼Œæ¥äº§ç”Ÿæ›´å¤šçš„å¯¹è±¡ï¼Œå°±åƒç»†èƒçš„å¤åˆ¶ä¸€æ ·ã€‚</p><p>å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆä»‹ç»ä¸€ä¸‹å¯¹è±¡çš„æ·±æ‹·è´å’Œæµ…æ‹·è´ï¼Œé¦–å…ˆæˆ‘ä»¬æ¥çœ‹æµ…æ‹·è´ï¼š</p><ul><li><p><strong>æµ…æ‹·è´ï¼š</strong> å¯¹äºç±»ä¸­åŸºæœ¬æ•°æ®ç±»å‹ï¼Œä¼šç›´æ¥å¤åˆ¶å€¼ç»™æ‹·è´å¯¹è±¡ï¼›å¯¹äºå¼•ç”¨ç±»å‹ï¼Œåªä¼šå¤åˆ¶å¯¹è±¡çš„åœ°å€ï¼Œè€Œå®é™…ä¸ŠæŒ‡å‘çš„è¿˜æ˜¯åŸæ¥çš„é‚£ä¸ªå¯¹è±¡ï¼Œæ‹·è´ä¸ªåŸºè«ã€‚</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> a;  <span class="hljs-comment">//åŸºæœ¬ç±»å‹æµ…æ‹·è´</span><br>    System.out.println(a == b);<br><br>    <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();<br>    <span class="hljs-type">Object</span> <span class="hljs-variable">k</span> <span class="hljs-operator">=</span> o;    <span class="hljs-comment">//å¼•ç”¨ç±»å‹æµ…æ‹·è´ï¼Œæ‹·è´çš„ä»…ä»…æ˜¯å¯¹ä¸Šé¢å¯¹è±¡çš„å¼•ç”¨</span><br>    System.out.println(o == k);<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>æ·±æ‹·è´ï¼š</strong> æ— è®ºæ˜¯åŸºæœ¬ç±»å‹è¿˜æ˜¯å¼•ç”¨ç±»å‹ï¼Œæ·±æ‹·è´ä¼šå°†å¼•ç”¨ç±»å‹çš„æ‰€æœ‰å†…å®¹ï¼Œå…¨éƒ¨æ‹·è´ä¸ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼ŒåŒ…æ‹¬å¯¹è±¡å†…éƒ¨çš„æ‰€æœ‰æˆå‘˜å˜é‡ï¼Œä¹Ÿä¼šè¿›è¡Œæ‹·è´ã€‚</p></li></ul><p>åœ¨Javaä¸­ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨Cloneableæ¥å£æä¾›çš„æ‹·è´æœºåˆ¶ï¼Œæ¥å®ç°åŸå‹æ¨¡å¼ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Cloneable</span>&#123;   <span class="hljs-comment">//æ³¨æ„éœ€è¦å®ç°Cloneableæ¥å£</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">clone</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> CloneNotSupportedException &#123;   <span class="hljs-comment">//æå‡cloneæ–¹æ³•çš„è®¿é—®æƒé™</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.clone();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ç€æˆ‘ä»¬æ¥çœ‹çœ‹å…‹éš†çš„å¯¹è±¡æ˜¯ä¸æ˜¯åŸæ¥çš„å¯¹è±¡ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> CloneNotSupportedException &#123;<br>    <span class="hljs-type">Student</span> <span class="hljs-variable">student0</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>();<br>    <span class="hljs-type">Student</span> <span class="hljs-variable">student1</span> <span class="hljs-operator">=</span> (Student) student0.clone();<br>    System.out.println(student0);<br>    System.out.println(student1);<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡<code>clone()</code>æ–¹æ³•å…‹éš†çš„å¯¹è±¡å¹¶ä¸æ˜¯åŸæ¥çš„å¯¹è±¡ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å¦‚æœå¯¹è±¡å†…éƒ¨æœ‰å±æ€§ä¼šä¸ä¼šä¸€èµ·è¿›è¡Œå…‹éš†ï¼š</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Cloneable</span>&#123;<br>    <br>    String name;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">(String name)</span>&#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">clone</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> CloneNotSupportedException &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.clone();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> CloneNotSupportedException &#123;<br>    <span class="hljs-type">Student</span> <span class="hljs-variable">student0</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">&quot;å°æ˜&quot;</span>);<br>    <span class="hljs-type">Student</span> <span class="hljs-variable">student1</span> <span class="hljs-operator">=</span> (Student) student0.clone();<br>    System.out.println(student0.getName() == student1.getName());<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶Studentå¯¹è±¡æˆåŠŸæ‹·è´ï¼Œä½†æ˜¯å…¶å†…å±‚å¯¹è±¡å¹¶æ²¡æœ‰è¿›è¡Œæ‹·è´ï¼Œä¾ç„¶åªæ˜¯å¯¹è±¡å¼•ç”¨çš„å¤åˆ¶ï¼Œæ‰€ä»¥Javaä¸ºæˆ‘ä»¬æä¾›çš„<code>clone</code>æ–¹æ³•åªä¼šè¿›è¡Œæµ…æ‹·è´ã€‚é‚£ä¹ˆå¦‚ä½•æ‰èƒ½å®ç°æ·±æ‹·è´å‘¢ï¼Ÿ</p><p>â€‹                              </p><p>â€‹             </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">clone</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> CloneNotSupportedException &#123;   <span class="hljs-comment">//è¿™é‡Œæˆ‘ä»¬æ”¹è¿›ä¸€ä¸‹ï¼Œé’ˆå¯¹æˆå‘˜å˜é‡ä¹Ÿè¿›è¡Œæ‹·è´</span><br>    <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> (Student) <span class="hljs-built_in">super</span>.clone();<br>    student.name = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(name);<br>    <span class="hljs-keyword">return</span> student;   <span class="hljs-comment">//æˆå‘˜æ‹·è´å®Œæˆåï¼Œå†è¿”å›</span><br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å®ç°äº†æ·±æ‹·è´ã€‚</p><hr><p>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºæŸç çŸ¥è¯†åº“ç‰ˆæƒæ‰€æœ‰ï¼Œç¦æ­¢ä¸€åˆ‡æœªç»æˆæƒçš„è½¬è½½ã€å‘å¸ƒã€å‡ºå”®ç­‰è¡Œä¸ºï¼Œè¿è€…å°†è¢«è¿½ç©¶æ³•å¾‹è´£ä»»ã€‚</p><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://www.itbaima.cn/document/6386mh7anqt4tzyv">https://www.itbaima.cn/document/6386mh7anqt4tzyv</a></p>]]></content>
    
    
    <categories>
      
      <category>è®¾è®¡æ¨¡å¼</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™</title>
    <link href="/post/3d053257-9a1f-4b4c-b2bc-eacffab49599/"/>
    <url>/post/3d053257-9a1f-4b4c-b2bc-eacffab49599/</url>
    
    <content type="html"><![CDATA[<h2 id="é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™"><a href="#é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™" class="headerlink" title="é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™"></a>é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™</h2><p><code>hexo template generate by typora plugin templater</code></p><h3 id="å•ä¸€èŒè´£åŸåˆ™"><a href="#å•ä¸€èŒè´£åŸåˆ™" class="headerlink" title="å•ä¸€èŒè´£åŸåˆ™"></a>å•ä¸€èŒè´£åŸåˆ™</h3><p>å•ä¸€èŒè´£åŸåˆ™ï¼ˆSimple Responsibility Pincipleï¼ŒSRPï¼‰æ˜¯æœ€ç®€å•çš„é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™ï¼Œå®ƒç”¨äºæ§åˆ¶ç±»çš„ç²’åº¦å¤§å°ã€‚</p><blockquote><p>ä¸€ä¸ªå¯¹è±¡åº”è¯¥åªåŒ…å«å•ä¸€çš„èŒè´£ï¼Œå¹¶ä¸”è¯¥èŒè´£è¢«å®Œæ•´åœ°å°è£…åœ¨ä¸€ä¸ªç±»ä¸­ã€‚</p></blockquote><p>æ¯”å¦‚æˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ª People ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//ä¸€ä¸ªäººç±»</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">People</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * äººç±»ä¼šç¼–ç¨‹</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">coding</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;int mian() &#123;&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;   printf(\&quot;Holle Wrold!\&quot;);&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;&#125;&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;å•Šå˜ï¼Œæ€ä¹ˆè¿è¡Œä¸èµ·ï¼Ÿæ˜æ˜ç…§ç€è€å¸ˆæ•²çš„å•Š&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å·¥å‚æ‰“èºä¸ä¹Ÿä¼š</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">work</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;çœŸå¼€å¿ƒï¼Œèƒ½è¿›åˆ°å¯ŒåœŸåº·æ‰“èºä¸&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;è¯¶ï¼Œæ€ä¹ˆå·¥å‹éƒ½ææ¡¶è·‘è·¯äº†&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * é€å¤–å–ä¹Ÿä¼š</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">ride</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;ä»Šå¤©ç»ˆäºé€šè¿‡ç¾å›¢æœ€ç»ˆé¢ï¼ŒåŠ å…¥äº†æ¢¦å¯ä»¥æ±‚çš„å¤§å‚äº†&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;æ„Ÿè§‰é¢è¯•æŒºç®€å•çš„ï¼Œå°±æ˜¯ä¸çŸ¥é“ä¸ºå•¥æˆ‘åŒå­¦æ˜¯ç°åœºåšä¸€é“åŠ›æ‰£æ¥é›¨æ°´ï¼Œè€Œæˆ‘æ˜¯ç°åœºé—®ä¼šä¸ä¼šéª‘è½¦&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;ï¼ˆè¿«ä¸åŠå¾…ç©¿ä¸Šå¤–å–æœè£…ï¼‰&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ª People ç±»å¯ä»¥è¯´æ˜¯åå…«èˆ¬æ­¦è‰ºæ ·æ ·ç²¾é€šäº†ï¼Œå•¥éƒ½ä¼šï¼Œä½†æ˜¯å®é™…ä¸Šï¼Œæˆ‘ä»¬æ¯ä¸ªäººæœ€ç»ˆéƒ½æ˜¯åœ¨è‡ªå·±æ‰€æ“…é•¿çš„é¢†åŸŸå·¥ä½œï¼Œæ‰€è°“é—»é“æœ‰å…ˆåï¼Œæœ¯ä¸šæœ‰ä¸“æ”»ï¼Œä¼šç¼–ç¨‹çš„å°±åº”è¯¥æ˜¯ç¨‹åºå‘˜ï¼Œä¼šæ‰“èºä¸çš„å°±åº”è¯¥æ˜¯å·¥äººï¼Œä¼šé€å¤–å–çš„åº”è¯¥æ˜¯éª‘æ‰‹ï¼Œæ˜¾ç„¶è¿™ä¸ª People å¤ªè¿‡è‡ƒè‚¿ï¼ˆæˆ‘ä»¬éœ€è¦ä¿®æ”¹ä»»æ„ä¸€ç§è¡Œä¸ºéƒ½éœ€è¦ä¿®æ”¹ People ç±»ï¼Œå®ƒæ‹¥æœ‰ä¸æ­¢ä¸€ä¸ªå¼•èµ·å®ƒå˜åŒ–çš„åŸå› ï¼‰ï¼Œæ‰€ä»¥æ ¹æ®å•ä¸€èŒè´£åŸåˆ™ï¼Œæˆ‘ä»¬ä¸‹éœ€è¦è¿›è¡Œæ›´æ˜ç¡®çš„åˆ’åˆ†ï¼ŒåŒç§ç±»å‹çš„æ“ä½œæˆ‘ä»¬ä¸€èˆ¬æ‰æ”¾åœ¨ä¸€èµ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Coder</span>&#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç¨‹åºå‘˜ä¼šç¼–ç¨‹</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">coding</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;int mian() &#123;&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;   printf(\&quot;Hello World!\&quot;)&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;&#125;&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;å•Šå˜ï¼Œæ€ä¹ˆè¿è¡Œä¸èµ·ï¼Ÿæ˜æ˜ç…§ç€è€å¸ˆæ•²çš„å•Š&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Worker</span>&#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å·¥äººä¼šæ‰“èºä¸</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">work</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;çœŸå¼€å¿ƒï¼Œèƒ½è¿›åˆ°å¯ŒåœŸåº·æ‰“èºä¸&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;è¯¶ï¼Œæ€ä¹ˆå·¥å‹éƒ½ææ¡¶è·‘è·¯äº†&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Rider</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * éª‘æ‰‹ä¼šé€å¤–å–</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">ride</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;ä»Šå¤©ç»ˆäºé€šè¿‡ç¾å›¢æœ€ç»ˆé¢ï¼ŒåŠ å…¥äº†æ¢¦å¯ä»¥æ±‚çš„å¤§å‚&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;æ„Ÿè§‰é¢è¯•æŒºç®€å•çš„ï¼Œå°±æ˜¯ä¸çŸ¥é“ä¸ºå•¥æˆ‘åŒå­¦æ˜¯ç°åœºåšä¸€é“åŠ›æ‰£æ¥é›¨æ°´ï¼Œæˆ‘æ˜¯ç°åœºé—®ä¼šä¸ä¼šéª‘è½¦&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;ï¼ˆè¿«ä¸åŠå¾…ç©¿ä¸Šå¤–å–æœè£…ï¼‰&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å°†ç±»çš„ç²’åº¦è¿›è¡Œæ›´è¿‘ä¸€æ­¥çš„åˆ’åˆ†ï¼Œè¿™æ ·å°±å¾ˆæ¸…æ™°äº†ï¼ŒåŒ…æ‹¬æˆ‘ä»¬ä»¥ååœ¨è®¾è®¡ Mapperã€Serviceã€Controller ç­‰ç­‰ï¼Œæ ¹æ®ä¸åŒçš„ä¸šåŠ¡è¿›è¡Œåˆ’åˆ†ï¼Œéƒ½å¯ä»¥é‡‡ç”¨å•ä¸€èŒè´£åŸåˆ™ï¼Œä»¥å®ƒä½œä¸ºæˆ‘ä»¬å®ç°<strong>é«˜å†…èšä½è€¦åˆ</strong>çš„æŒ‡å¯¼æ–¹é’ˆã€‚å®é™…ä¸Šæˆ‘ä»¬çš„å¾®æœåŠ¡ä¹Ÿæ˜¯å‚è€ƒäº†å•ä¸€èŒè´£åŸåˆ™ï¼Œæ¯ä¸ªå¾®æœåŠ¡åªåº”æ‹…è´Ÿä¸€ä¸ªèŒè´£ã€‚</p><h3 id="å¼€é—­åŸåˆ™"><a href="#å¼€é—­åŸåˆ™" class="headerlink" title="å¼€é—­åŸåˆ™"></a>å¼€é—­åŸåˆ™</h3><p>å¼€é—­åŸåˆ™ï¼ˆOpen Close Principleï¼‰ä¹Ÿæ˜¯é‡è¦çš„é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™ã€‚</p><blockquote><p>è½¯ä»¶å®ä½“åº”å½“å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚</p></blockquote><p>ä¸€ä¸ªè½¯ä»¶å®ä½“ï¼Œæ¯”å¦‚ç±»ã€æ¨¡å—å’Œå‡½æ•°åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚å…¶ä¸­ï¼Œå¯¹æ‰©å±•å¼€æ”¾æ˜¯é’ˆå¯¹æä¾›æ–¹æ¥è¯´çš„ï¼Œå¯¹ä¿®æ”¹å…³é—­æ˜¯é’ˆå¯¹è°ƒç”¨æ–¹æ¥è¯´çš„ã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬çš„ç¨‹åºå‘˜åˆ†ä¸º Java ç¨‹åºå‘˜ã€C#ç¨‹åºå‘˜ã€C è‰¹ç¨‹åºå‘˜ã€PHP ç¨‹åºå‘˜ã€å‰ç«¯ç¨‹åºå‘˜ç­‰ï¼Œè€Œä»–ä»¬è¦åšçš„éƒ½æ˜¯å»æ‰“ä»£ç ï¼Œè€Œå…·ä½“å¦‚ä½•æ‰“ä»£ç æ˜¯æ ¹æ®ä¸åŒè¯­è¨€çš„ç¨‹åºå‘˜æ¥å†³å®šçš„ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç¨‹åºå‘˜æ‰“ä»£ç è¿™ä¸€ä¸ªè¡Œä¸ºæŠ½è±¡æˆä¸€ä¸ªç»Ÿä¸€çš„æ¥å£æˆ–æ˜¯æŠ½è±¡ç±»ï¼Œè¿™æ ·æˆ‘ä»¬å°±æ»¡è¶³äº†å¼€é—­åŸåˆ™çš„ç¬¬ä¸€ä¸ªè¦æ±‚ï¼šå¯¹æ‰©å±•å¼€æ”¾ï¼Œä¸åŒçš„ç¨‹åºå‘˜å¯ä»¥è‡ªç”±åœ°å†³å®šä»–ä»¬è¯¥å¦‚ä½•è¿›è¡Œç¼–ç¨‹ã€‚è€Œå…·ä½“å“ªä¸ªç¨‹åºå‘˜ä½¿ç”¨ä»€ä¹ˆè¯­è¨€æ€ä¹ˆç¼–ç¨‹ï¼Œæ˜¯è‡ªå·±åœ¨è´Ÿè´£ï¼Œä¸éœ€è¦å…¶ä»–ç¨‹åºå‘˜å¹²æ¶‰ï¼Œæ‰€ä»¥æ»¡è¶³ç¬¬äºŒä¸ªè¦æ±‚ï¼šå¯¹ä¿®æ”¹å…³é—­ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Coder</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">coding</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">JavaCoder</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Coder</span>&#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">coding</span><span class="hljs-params">()</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;Javaå¤ªå·äº†T_Tï¼Œå¿«å»å­¦Goå§ï¼&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">PHPCoder</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Coder</span>&#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">coding</span><span class="hljs-params">()</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;PHPæ˜¯ä¸–ç•Œä¸Šæœ€å¥½çš„è¯­è¨€&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span>è‰¹Coder <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Coder</span>&#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">coding</span><span class="hljs-params">()</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;ç¬‘æ­»ï¼ŒJavaå†ç‰›é€¼åº•å±‚ä¸è¿˜å¾—æ‰¾æˆ‘ï¼Ÿ&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡æä¾›ä¸€ä¸ª Coder æŠ½è±¡ç±»ï¼Œå®šä¹‰å‡ºç¼–ç¨‹çš„è¡Œä¸ºï¼Œä½†æ˜¯ä¸è¿›è¡Œå®ç°ï¼Œè€Œæ˜¯å¼€æ”¾ç»™å…¶ä»–å…·ä½“ç±»å‹çš„ç¨‹åºå‘˜æ¥å®ç°ï¼Œè¿™æ ·å°±å¯ä»¥æ ¹æ®ä¸åŒçš„ä¸šåŠ¡è¿›è¡Œçµæ´»æ‰©å±•äº†ï¼Œå…·æœ‰è¾ƒå¥½çš„å»¶ç»­æ€§ã€‚</p><p>ä¸è¿‡ï¼Œå›é¡¾æˆ‘ä»¬è¿™ä¸€è·¯çš„å­¦ä¹ ï¼Œå¥½åƒå¤„å¤„éƒ½åœ¨ä½¿ç”¨å¼€é—­åŸåˆ™ã€‚</p><h3 id="é‡Œæ°æ›¿æ¢åŸåˆ™"><a href="#é‡Œæ°æ›¿æ¢åŸåˆ™" class="headerlink" title="é‡Œæ°æ›¿æ¢åŸåˆ™"></a>é‡Œæ°æ›¿æ¢åŸåˆ™</h3><p>é‡Œæ°æ›¿æ¢åŸåˆ™ï¼ˆLiskov Substitution Principleï¼‰æ˜¯å¯¹å­ç±»å‹çš„ç‰¹åˆ«å®šä¹‰ã€‚å®ƒç”±èŠ­èŠ­æ‹‰Â·åˆ©æ–¯ç§‘å¤«ï¼ˆBarbara Liskovï¼‰åœ¨ 1987 å¹´åœ¨ä¸€æ¬¡ä¼šè®®ä¸Šåä¸º â€œæ•°æ®çš„æŠ½è±¡ä¸å±‚æ¬¡â€ çš„æ¼”è¯´ä¸­é¦–å…ˆæå‡ºã€‚</p><blockquote><p>æ‰€æœ‰å¼•ç”¨åŸºç±»çš„åœ°æ–¹å¿…é¡»èƒ½é€æ˜åœ°ä½¿ç”¨å…¶å­ç±»çš„å¯¹è±¡ã€‚</p></blockquote><p><strong>ç®€å•çš„è¯´å°±æ˜¯ï¼Œå­ç±»å¯ä»¥æ‰©å±•çˆ¶ç±»çš„åŠŸèƒ½ï¼Œä½†ä¸èƒ½æ”¹å˜çˆ¶ç±»åŸæœ‰çš„åŠŸèƒ½ï¼š</strong></p><ol><li>å­ç±»å¯ä»¥å®ç°çˆ¶ç±»çš„æŠ½è±¡æ–¹æ³•ï¼Œä½†ä¸èƒ½è¦†ç›–çˆ¶ç±»çš„éæŠ½è±¡æ–¹æ³•ã€‚</li><li>å­ç±»å¯ä»¥å¢åŠ è‡ªå·±ç‰¹æœ‰çš„æ–¹æ³•ã€‚</li><li>å½“å­ç±»çš„æ–¹æ³•é‡è½½çˆ¶ç±»çš„æ–¹æ³•æ—¶ï¼Œæ–¹æ³•çš„å‰ç½®æ¡ä»¶ï¼ˆå³æ–¹æ³•çš„è¾“å…¥&#x2F;å…¥å‚ï¼‰è¦æ¯”çˆ¶ç±»æ–¹æ³•çš„è¾“å…¥å‚æ•°æ›´å®½æ¾ã€‚</li><li>å½“å­ç±»çš„æ–¹æ³•å®ç°çˆ¶ç±»çš„æ–¹æ³•æ—¶ï¼ˆé‡å†™&#x2F;é‡è½½æˆ–å®ç°æŠ½è±¡æ–¹æ³•ï¼‰ï¼Œæ–¹æ³•çš„åç½®æ¡ä»¶ï¼ˆå³æ–¹æ³•çš„è¾“å‡º&#x2F;è¿”å›å€¼ï¼‰è¦æ¯”çˆ¶ç±»æ›´ä¸¥æ ¼æˆ–ä¸çˆ¶ç±»ä¸€æ ·ã€‚</li></ol><p>æ¯”å¦‚æˆ‘ä»¬ä¸‹é¢çš„ä¾‹å­ï¼š</p><p>â€‹                              </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Coder</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">coding</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;æˆ‘ä¼šæ‰“ä»£ç &quot;</span>);<br>    &#125;<br><br><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">JavaCoder</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Coder</span>&#123;<br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * å­ç±»é™¤äº†ä¼šæ‰“ä»£ç ä¹‹å¤–ï¼Œè¿˜ä¼šæ‰“æ¸¸æˆ</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">game</span><span class="hljs-params">()</span>&#123;<br>            System.out.println(<span class="hljs-string">&quot;è‰¾æ¬§å°¼äºšæœ€å¼ºç‹è€…å·²ä¸Šå·&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ° JavaCoder è™½ç„¶ç»§æ‰¿è‡ª Coderï¼Œ<strong>ä½†æ˜¯å¹¶æ²¡æœ‰å¯¹çˆ¶ç±»æ–¹æ³•è¿›è¡Œé‡å†™ï¼Œå¹¶ä¸”è¿˜åœ¨çˆ¶ç±»çš„åŸºç¡€ä¸Šè¿›è¡Œé¢å¤–æ‰©å±•ï¼Œç¬¦åˆé‡Œæ°æ›¿æ¢åŸåˆ™ã€‚</strong>ä½†æ˜¯æˆ‘ä»¬å†æ¥çœ‹ä¸‹é¢çš„è¿™ä¸ªä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Coder</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">coding</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;æˆ‘ä¼šæ‰“ä»£ç &quot;</span>);<br>    &#125;<br><br><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">JavaCoder</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Coder</span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">game</span><span class="hljs-params">()</span>&#123;<br>            System.out.println(<span class="hljs-string">&quot;è‰¾æ¬§å°¼äºšæœ€å¼ºç‹è€…å·²ä¸Šå·&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * è¿™é‡Œæˆ‘ä»¬å¯¹çˆ¶ç±»çš„è¡Œä¸ºè¿›è¡Œäº†é‡å†™ï¼Œç°åœ¨å®ƒä¸å†å…·å¤‡çˆ¶ç±»åŸæœ¬çš„èƒ½åŠ›äº†</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">coding</span><span class="hljs-params">()</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;æˆ‘å¯’çª—è‹¦è¯»åå…­å¹´ï¼Œåˆ°æœ€åè¿˜ä¸å¦‚åŸ¹è®­ç­ä¸‰ä¸ªæœˆå‡ºæ¥çš„ç¨‹åºå‘˜&quot;</span>);<br>            System.out.println(<span class="hljs-string">&quot;æƒ³æ¥æƒ³å»ï¼Œæˆ¿å­è½¦å­ç»“å©šå½©ç¤¼ï¼Œä¸ºä»€ä¹ˆè¿™è¾ˆå­è¦æ´»çš„è¿™ä¹ˆç´¯å‘¢ï¼Ÿ&quot;</span>);<br>            System.out.println(<span class="hljs-string">&quot;éš¾é“æ¥åˆ°è¿™ä¸–é—´èµ°è¿™ä¸€é­å°±ä¸ºäº†èŠ±ä¸€è¾ˆå­æ—¶é—´ä¹°ä¸ªæˆ¿å­å—ï¼Ÿä¸€ä¸ªäººä¸æ˜¯ä¹Ÿèƒ½æ´»çš„è½»æ¾å¿«ä¹å—ï¼Ÿ&quot;</span>);<br>            System.out.println(<span class="hljs-string">&quot;æ‘†çƒ‚äº†ï¼Œå•Šå¯¹å¯¹å¯¹&quot;</span>);  <br>          <span class="hljs-comment">//å¥½äº†ï¼Œemo ç»“æŸï¼Œç»§ç»­å·å§ï¼Œäººç”Ÿå› å¥‹æ–—è€Œç¾ä¸½ï¼Œè¿™ä¸ªä¸–ç•Œè™½ç„¶æ»¡ç›®ç–®ç—ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰å¾ˆå¤šç¾å¥½å€¼å¾—æœŸå¾…</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œç°åœ¨æˆ‘ä»¬å¯¹çˆ¶ç±»çš„æ–¹æ³•è¿›è¡Œäº†é‡å†™ï¼Œæ˜¾ç„¶ï¼Œçˆ¶ç±»çš„è¡Œä¸ºå·²ç»è¢«æˆ‘ä»¬ç»™è¦†ç›–äº†ï¼Œè¿™ä¸ªå­ç±»å·²ç»ä¸å…·å¤‡çˆ¶ç±»çš„åŸæœ¬çš„è¡Œä¸ºï¼Œå¾ˆæ˜¾ç„¶<strong>è¿èƒŒäº†é‡Œæ°æ›¿æ¢åŸåˆ™ã€‚</strong></p><p>è¦æ˜¯ç¨‹åºå‘˜è¿æ•²ä»£ç éƒ½ä¸ä¼šäº†ï¼Œè¿˜èƒ½å«åšç¨‹åºå‘˜å—ï¼Ÿ</p><p>æ‰€ä»¥ï¼Œå¯¹äºè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬ä¸éœ€è¦å†ç»§æ‰¿è‡ª Coder äº†ï¼Œæˆ‘ä»¬å¯ä»¥æå‡ä¸€ä¸‹ï¼Œå°†æ­¤è¡Œä¸ºå®šä¹‰åˆ° People ä¸­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">People</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">coding</span><span class="hljs-params">()</span>;   <span class="hljs-comment">//è¿™ä¸ªè¡Œä¸ºè¿˜æ˜¯å®šä¹‰å‡ºæ¥ï¼Œä½†æ˜¯ä¸å®ç°</span><br>    <br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Coder</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">People</span>&#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">coding</span><span class="hljs-params">()</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;æˆ‘ä¼šæ‰“ä»£ç &quot;</span>);<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">JavaCoder</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">People</span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">game</span><span class="hljs-params">()</span>&#123;<br>            System.out.println(<span class="hljs-string">&quot;è‰¾æ¬§å°¼äºšæœ€å¼ºç‹è€…å·²ä¸Šå·&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">coding</span><span class="hljs-params">()</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;æ‘†çƒ‚äº†ï¼Œå•Šå¯¹å¯¹å¯¹&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é‡Œæ°æ›¿æ¢ä¹Ÿæ˜¯å®ç°å¼€é—­åŸåˆ™çš„é‡è¦æ–¹å¼ä¹‹ä¸€ã€‚</p><h3 id="ä¾èµ–å€’è½¬åŸåˆ™"><a href="#ä¾èµ–å€’è½¬åŸåˆ™" class="headerlink" title="ä¾èµ–å€’è½¬åŸåˆ™"></a>ä¾èµ–å€’è½¬åŸåˆ™</h3><p>ä¾èµ–å€’è½¬åŸåˆ™ï¼ˆDependence Inversion Principleï¼‰ä¹Ÿæ˜¯æˆ‘ä»¬ä¸€ç›´åœ¨ä½¿ç”¨çš„ï¼Œæœ€æ˜æ˜¾çš„å°±æ˜¯æˆ‘ä»¬çš„ Spring æ¡†æ¶äº†ã€‚</p><blockquote><p>é«˜å±‚æ¨¡å—ä¸åº”ä¾èµ–äºåº•å±‚æ¨¡å—ï¼Œå®ƒä»¬éƒ½åº”è¯¥ä¾èµ–æŠ½è±¡ã€‚æŠ½è±¡ä¸åº”ä¾èµ–äºç»†èŠ‚ï¼Œç»†èŠ‚åº”è¯¥ä¾èµ–äºæŠ½è±¡ã€‚</p></blockquote><p>è¿˜è®°å¾—æˆ‘ä»¬åœ¨æˆ‘ä»¬ä¹‹å‰çš„å­¦ä¹ ä¸­ä¸ºä»€ä¹ˆè¦ä¸€ç›´ä½¿ç”¨æ¥å£æ¥è¿›è¡ŒåŠŸèƒ½å®šä¹‰ï¼Œç„¶åå†å»å®ç°å—ï¼Ÿæˆ‘ä»¬å›é¡¾ä¸€ä¸‹åœ¨ä½¿ç”¨ Spring æ¡†æ¶ä¹‹å‰çš„æƒ…å†µï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">UserController</span> <span class="hljs-variable">controller</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserController</span>();<br>      <span class="hljs-comment">//è¯¥æ€ä¹ˆç”¨å°±è¿™ä¹ˆç”¨</span><br>    &#125;<br><br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserMapper</span> &#123;<br>        <span class="hljs-comment">//CRUD...</span><br>    &#125;<br><br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> &#123;<br>        <span class="hljs-type">UserMapper</span> <span class="hljs-variable">mapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserMapper</span>();<br>        <span class="hljs-comment">//ä¸šåŠ¡ä»£ç ....</span><br>    &#125;<br><br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> &#123;<br>        <span class="hljs-type">UserService</span> <span class="hljs-variable">service</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserService</span>();<br>        <span class="hljs-comment">//ä¸šåŠ¡ä»£ç ....</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯çªç„¶æœ‰ä¸€å¤©ï¼Œå…¬å¸ä¸šåŠ¡éœ€æ±‚å˜åŒ–ï¼Œç°åœ¨ç”¨æˆ·ç›¸å…³çš„ä¸šåŠ¡æ“ä½œéœ€è¦ä½¿ç”¨æ–°çš„å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">UserController</span> <span class="hljs-variable">controller</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserController</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserMapper</span> &#123;<br>        <span class="hljs-comment">//CRUD...</span><br>    &#125;<br><br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceNew</span> &#123;   <span class="hljs-comment">//ç”±äº UserServiceNew å‘ç”Ÿå˜åŒ–ï¼Œä¼šç›´æ¥å½±å“åˆ°å…¶ä»–é«˜å±‚æ¨¡å—</span><br>        <span class="hljs-type">UserMapper</span> <span class="hljs-variable">mapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserMapper</span>();<br>        <span class="hljs-comment">//ä¸šåŠ¡ä»£ç ....</span><br>    &#125;<br><br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> &#123;   <span class="hljs-comment">//ç„¯ï¼Œå¹²å˜›æ”¹åº•å±‚å•Šï¼Œæˆ‘è¿™åˆå¾—é‡å†™äº†</span><br>        <span class="hljs-type">UserService</span> <span class="hljs-variable">service</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserService</span>();   <span class="hljs-comment">//å“¦è±ï¼ŒåŸæ¥çš„ä¸èƒ½ç”¨äº†</span><br>        <span class="hljs-type">UserServiceNew</span> <span class="hljs-variable">serviceNew</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserServiceNew</span>();   <span class="hljs-comment">//åªèƒ½ä¿®æ”¹æˆæ–°çš„äº†</span><br>        <span class="hljs-comment">//ä¸šåŠ¡ä»£ç ....</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å‘ç°ï¼Œæˆ‘ä»¬çš„å„ä¸ªæ¨¡å—ä¹‹é—´å®é™…ä¸Šæ˜¯å…·æœ‰å¼ºå…³è”çš„ï¼Œä¸€ä¸ªæ¨¡å—æ˜¯ç›´æ¥æŒ‡å®šä¾èµ–äºå¦ä¸€ä¸ªæ¨¡å—ï¼Œè™½ç„¶è¿™æ ·ç»“æ„æ¸…æ™°ï¼Œä½†æ˜¯åº•å±‚æ¨¡å—çš„å˜åŠ¨ï¼Œä¼šç›´æ¥å½±å“åˆ°å…¶ä»–ä¾èµ–äºå®ƒçš„é«˜å±‚æ¨¡å—ï¼Œå¦‚æœæˆ‘ä»¬çš„é¡¹ç›®å˜å¾—å¾ˆåºå¤§ï¼Œé‚£ä¹ˆè¿™æ ·çš„ä¿®æ”¹å°†æ˜¯ä¸€åœºç¾éš¾ã€‚</p><p>è€Œæœ‰äº† Spring æ¡†æ¶ä¹‹åï¼Œæˆ‘ä»¬çš„å¼€å‘æ¨¡å¼å°±å‘ç”Ÿäº†å˜åŒ–ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">UserController</span> <span class="hljs-variable">controller</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserController</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> &#123;<br>        <span class="hljs-comment">//æ¥å£ä¸­åªåš CRUD æ–¹æ³•å®šä¹‰</span><br>    &#125;<br><br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserMapperImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserMapper</span> &#123;<br>        <span class="hljs-comment">//å®ç°ç±»å®Œæˆ CRUD å…·ä½“å®ç°</span><br>    &#125;<br><br>    <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserService</span> &#123;<br>        <span class="hljs-comment">//ä¸šåŠ¡ä»£ç å®šä¹‰....</span><br>    &#125;<br><br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserService</span> &#123;<br>        <span class="hljs-meta">@Resource</span>   <span class="hljs-comment">//ç°åœ¨ç”± Spring æ¥ä¸ºæˆ‘ä»¬é€‰æ‹©ä¸€ä¸ªæŒ‡å®šçš„å®ç°ç±»ï¼Œç„¶åæ³¨å…¥ï¼Œè€Œä¸æ˜¯ç”±æˆ‘ä»¬åœ¨ç±»ä¸­ç¡¬ç¼–ç è¿›è¡ŒæŒ‡å®š</span><br>        UserMapper mapper;<br>        <br>        <span class="hljs-comment">//ä¸šåŠ¡ä»£ç å…·ä½“å®ç°</span><br>    &#125;<br><br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> &#123;<br>        <span class="hljs-meta">@Resource</span><br>        UserService service;   <span class="hljs-comment">//ç›´æ¥ä½¿ç”¨æ¥å£ï¼Œå°±ç®—ä½ æ”¹å®ç°ï¼Œæˆ‘ä¹Ÿä¸éœ€è¦å†ä¿®æ”¹ä»£ç äº†</span><br><br>        <span class="hljs-comment">//ä¸šåŠ¡ä»£ç ....</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡ä½¿ç”¨æ¥å£ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†åŸæœ‰çš„å¼ºå…³è”ç»™å¼±åŒ–ï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“æ¥å£ä¸­å®šä¹‰äº†ä»€ä¹ˆæ–¹æ³•ç„¶åå»ä½¿ç”¨å³å¯ï¼Œè€Œå…·ä½“çš„æ“ä½œç”±æ¥å£çš„å®ç°ç±»æ¥å®Œæˆï¼Œå¹¶ç”± Spring æ¥ä¸ºæˆ‘ä»¬æ³¨å…¥ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬é€šè¿‡ç¡¬ç¼–ç çš„æ–¹å¼å»æŒ‡å®šã€‚</p><h3 id="æ¥å£éš”ç¦»åŸåˆ™"><a href="#æ¥å£éš”ç¦»åŸåˆ™" class="headerlink" title="æ¥å£éš”ç¦»åŸåˆ™"></a>æ¥å£éš”ç¦»åŸåˆ™</h3><p>æ¥å£éš”ç¦»åŸåˆ™ï¼ˆInterface Segregation Principle, ISPï¼‰å®é™…ä¸Šæ˜¯å¯¹æ¥å£çš„ç»†åŒ–ã€‚</p><blockquote><p>å®¢æˆ·ç«¯ä¸åº”ä¾èµ–é‚£äº›å®ƒä¸éœ€è¦çš„æ¥å£ã€‚</p></blockquote><p>æˆ‘ä»¬åœ¨å®šä¹‰æ¥å£çš„æ—¶å€™ï¼Œä¸€å®šè¦æ³¨æ„æ§åˆ¶æ¥å£çš„ç²’åº¦ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Device</span> &#123;<br>    String <span class="hljs-title function_">getCpu</span><span class="hljs-params">()</span>;<br>    String <span class="hljs-title function_">getType</span><span class="hljs-params">()</span>;<br>    String <span class="hljs-title function_">getMemory</span><span class="hljs-params">()</span>;<br>&#125;<br><br><span class="hljs-comment">//ç”µè„‘å°±æ˜¯ä¸€ç§ç”µå­è®¾å¤‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å®ç°æ­¤æ¥å£</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Computer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Device</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getCpu</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;i9-12900K&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getType</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ç”µè„‘&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getMemory</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;32G DDR5&quot;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//ç”µé£æ‰‡ä¹Ÿç®—æ˜¯ä¸€ç§ç”µå­è®¾å¤‡</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Fan</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Device</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getCpu</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;   <span class="hljs-comment">//å°±ä¸€ä¸ªç ´é£æ‰‡ï¼Œè¿˜éœ€è¦ CPUï¼Ÿ</span><br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getType</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;é£æ‰‡&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getMemory</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;   <span class="hljs-comment">//é£æ‰‡ä¹Ÿä¸éœ€è¦å†…å­˜å§</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è™½ç„¶æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª Device æ¥å£ï¼Œä½†æ˜¯ç”±äºæ­¤æ¥å£çš„ç²’åº¦ä¸å¤Ÿç»†ï¼Œè™½ç„¶æ¯”è¾ƒå¥‘åˆç”µè„‘è¿™ç§è®¾å¤‡ï¼Œä½†æ˜¯ä¸é€‚åˆé£æ‰‡è¿™ç§è®¾å¤‡ï¼Œå› ä¸ºé£æ‰‡å‹æ ¹å°±ä¸éœ€è¦ CPU å’Œå†…å­˜ï¼Œæ‰€ä»¥é£æ‰‡å®Œå…¨ä¸éœ€è¦è¿™äº›æ–¹æ³•ã€‚è¿™æ—¶æˆ‘ä»¬å°±å¿…é¡»è¦å¯¹å…¶è¿›è¡Œæ›´ç»†ç²’åº¦çš„åˆ’åˆ†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">SmartDevice</span> &#123;   <span class="hljs-comment">//æ™ºèƒ½è®¾å¤‡æ‰æœ‰ getCpu å’Œ getMemory</span><br>    String <span class="hljs-title function_">getCpu</span><span class="hljs-params">()</span>;<br>    String <span class="hljs-title function_">getType</span><span class="hljs-params">()</span>;<br>    String <span class="hljs-title function_">getMemory</span><span class="hljs-params">()</span>;<br>&#125;<br><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">NormalDevice</span> &#123;   <span class="hljs-comment">//æ™®é€šè®¾å¤‡åªæœ‰ getType</span><br>    String <span class="hljs-title function_">getType</span><span class="hljs-params">()</span>;<br>&#125;<br><br><span class="hljs-comment">//ç”µè„‘å°±æ˜¯ä¸€ç§ç”µå­è®¾å¤‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ç»§æ‰¿æ­¤æ¥å£</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Computer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SmartDevice</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getCpu</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;i9-12900K&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getType</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ç”µè„‘&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getMemory</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;32G DDR5&quot;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//ç”µé£æ‰‡ä¹Ÿç®—æ˜¯ä¸€ç§ç”µå­è®¾å¤‡</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Fan</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">NormalDevice</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getType</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;é£æ‰‡&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å°†æ¥å£è¿›è¡Œäº†ç»†ç²’åº¦çš„åˆ’åˆ†ï¼Œä¸åŒç±»å‹çš„ç”µå­è®¾å¤‡å°±å¯ä»¥æ ¹æ®åˆ’åˆ†å»å®ç°ä¸åŒçš„æ¥å£äº†ã€‚å½“ç„¶ï¼Œä¹Ÿä¸èƒ½åˆ’åˆ†å¾—å¤ªå°ï¼Œè¿˜æ˜¯è¦æ ¹æ®å®é™…æƒ…å†µæ¥è¿›è¡Œå†³å®šã€‚</p><h3 id="åˆæˆå¤ç”¨åŸåˆ™"><a href="#åˆæˆå¤ç”¨åŸåˆ™" class="headerlink" title="åˆæˆå¤ç”¨åŸåˆ™"></a>åˆæˆå¤ç”¨åŸåˆ™</h3><p>åˆæˆå¤ç”¨åŸåˆ™ï¼ˆComposite Reuse Principleï¼‰çš„æ ¸å¿ƒå°±æ˜¯å§”æ´¾ã€‚</p><blockquote><p>ä¼˜å…ˆä½¿ç”¨å¯¹è±¡ç»„åˆï¼Œè€Œä¸æ˜¯é€šè¿‡ç»§æ‰¿æ¥è¾¾åˆ°å¤ç”¨çš„ç›®çš„ã€‚</p></blockquote><p>åœ¨ä¸€ä¸ªæ–°çš„å¯¹è±¡é‡Œé¢ä½¿ç”¨ä¸€äº›å·²æœ‰çš„å¯¹è±¡ï¼Œä½¿ä¹‹æˆä¸ºæ–°å¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼Œæ–°çš„å¯¹è±¡é€šè¿‡å‘è¿™äº›å¯¹è±¡çš„å§”æ´¾è¾¾åˆ°å¤ç”¨å·²æœ‰åŠŸèƒ½çš„ç›®çš„ã€‚å®é™…ä¸Šæˆ‘ä»¬åœ¨è€ƒè™‘å°†æŸä¸ªç±»é€šè¿‡ç»§æ‰¿å…³ç³»åœ¨å­ç±»å¾—åˆ°çˆ¶ç±»å·²ç»å®ç°çš„æ–¹æ³•ä¹‹å¤–ï¼ˆæ¯”å¦‚ A ç±»å®ç°äº†è¿æ¥æ•°æ®åº“çš„åŠŸèƒ½ï¼Œæ°å·§ B ç±»ä¸­ä¹Ÿéœ€è¦ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ç»§æ‰¿æ¥è·å¾— A å·²ç»å†™å¥½çš„è¿æ¥æ•°æ®åº“çš„åŠŸèƒ½ï¼Œè¿™æ ·å°±èƒ½ç›´æ¥å¤ç”¨ A ä¸­å·²ç»å†™å¥½çš„é€»è¾‘ï¼‰æˆ‘ä»¬åº”è¯¥åº”è¯¥ä¼˜å…ˆåœ°å»è€ƒè™‘ä½¿ç”¨åˆæˆçš„æ–¹å¼æ¥å®ç°å¤ç”¨ã€‚</p><p>æ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š</p><p>â€‹                              </p><p>â€‹        java        å¤åˆ¶ä»£ç       </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">connectDatabase</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;æˆ‘æ˜¯è¿æ¥æ•°æ®åº“æ“ä½œï¼&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">A</span>&#123;    <span class="hljs-comment">//ç›´æ¥é€šè¿‡ç»§æ‰¿çš„æ–¹å¼ï¼Œå¾—åˆ° A çš„æ•°æ®åº“è¿æ¥é€»è¾‘</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;æˆ‘æ˜¯Bçš„æ–¹æ³•ï¼Œæˆ‘ä¹Ÿéœ€è¦è¿æ¥æ•°æ®åº“ï¼&quot;</span>);<br>        connectDatabase();   <span class="hljs-comment">//ç›´æ¥è°ƒç”¨çˆ¶ç±»æ–¹æ³•å°±è¡Œ</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è™½ç„¶è¿™æ ·çœ‹èµ·æ¥æ²¡å•¥æ¯›ç—…ï¼Œä½†æ˜¯è¿˜æ˜¯å­˜åœ¨æˆ‘ä»¬ä¹‹å‰è¯´çš„é‚£ä¸ªé—®é¢˜ï¼Œè€¦åˆåº¦å¤ªé«˜äº†ã€‚</p><p>å¯ä»¥çœ‹åˆ°é€šè¿‡ç»§æ‰¿çš„æ–¹å¼å®ç°å¤ç”¨ï¼Œæˆ‘ä»¬æ˜¯å°†ç±» B ç›´æ¥æŒ‡å®šç»§æ‰¿è‡ªç±» A çš„ï¼Œé‚£ä¹ˆå¦‚æœæœ‰ä¸€å¤©ï¼Œç”±äºä¸šåŠ¡çš„æ›´æ”¹ï¼Œæˆ‘ä»¬çš„æ•°æ®åº“è¿æ¥æ“ä½œï¼Œä¸å†ç”± A æ¥è´Ÿè´£ï¼Œè€Œæ˜¯ç”±æ–°æ¥çš„ C å»è´Ÿè´£ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±ä¸å¾—ä¸å°†éœ€è¦å¤ç”¨ A ä¸­æ–¹æ³•çš„å­ç±»å…¨éƒ¨è¿›è¡Œä¿®æ”¹ï¼Œå¾ˆæ˜¾ç„¶è¿™æ ·æ˜¯è´¹æ—¶è´¹åŠ›çš„ã€‚</p><p>å¹¶ä¸”è¿˜æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œé€šè¿‡ç»§æ‰¿å­ç±»ä¼šå¾—åˆ°ä¸€äº›çˆ¶ç±»ä¸­çš„å®ç°ç»†èŠ‚ï¼Œæ¯”å¦‚æŸäº›å­—æ®µæˆ–æ˜¯æ–¹æ³•ï¼Œè¿™æ ·ç›´æ¥æš´éœ²ç»™å­ç±»ï¼Œå¹¶ä¸å®‰å…¨ã€‚</p><p>æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬éœ€è¦å®ç°å¤ç”¨æ—¶ï¼Œå¯ä»¥ä¼˜å…ˆè€ƒè™‘ä»¥ä¸‹æ“ä½œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">connectDatabase</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;æˆ‘æ˜¯è¿æ¥æ•°æ®åº“æ“ä½œï¼&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span> &#123;   <span class="hljs-comment">//ä¸è¿›è¡Œç»§æ‰¿ï¼Œè€Œæ˜¯åœ¨ç”¨çš„æ—¶å€™ç»™æˆ‘ä¸€ä¸ª Aï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æŠ½è±¡æˆä¸€ä¸ªæ¥å£ï¼Œæ›´åŠ çµæ´»</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">(A a)</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;æˆ‘æ˜¯Bçš„æ–¹æ³•ï¼Œæˆ‘ä¹Ÿéœ€è¦è¿æ¥æ•°æ®åº“ï¼&quot;</span>);<br>        a.connectDatabase();   <span class="hljs-comment">//åœ¨é€šè¿‡ä¼ å…¥çš„å¯¹è±¡ A å»æ‰§è¡Œ</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ–æ˜¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">connectDatabase</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;æˆ‘æ˜¯è¿æ¥æ•°æ®åº“æ“ä½œï¼&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span> &#123;<br>    <br>    A a;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">B</span><span class="hljs-params">(A a)</span>&#123;   <span class="hljs-comment">//åœ¨æ„é€ æ—¶å°±æŒ‡å®šå¥½</span><br>        <span class="hljs-built_in">this</span>.a = a;<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;æˆ‘æ˜¯Bçš„æ–¹æ³•ï¼Œæˆ‘ä¹Ÿéœ€è¦è¿æ¥æ•°æ®åº“ï¼&quot;</span>);<br>        a.connectDatabase();   <span class="hljs-comment">//ä¹Ÿæ˜¯é€šè¿‡å¯¹è±¡ A å»æ‰§è¡Œ</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡å¯¹è±¡ä¹‹é—´çš„ç»„åˆï¼Œæˆ‘ä»¬å°±å¤§å¤§é™ä½äº†ç±»ä¹‹é—´çš„è€¦åˆåº¦ï¼Œå¹¶ä¸” A çš„å®ç°ç»†èŠ‚æˆ‘ä»¬ä¹Ÿä¸ä¼šç›´æ¥å¾—åˆ°äº†ã€‚</p><h3 id="è¿ªç±³ç‰¹æ³•åˆ™"><a href="#è¿ªç±³ç‰¹æ³•åˆ™" class="headerlink" title="è¿ªç±³ç‰¹æ³•åˆ™"></a>è¿ªç±³ç‰¹æ³•åˆ™</h3><p>è¿ªç±³ç‰¹æ³•åˆ™ï¼ˆLaw of Demeterï¼‰åˆç§°æœ€å°‘çŸ¥è¯†åŸåˆ™ï¼Œæ˜¯å¯¹ç¨‹åºå†…éƒ¨æ•°æ®äº¤äº’çš„é™åˆ¶ã€‚</p><blockquote><p>æ¯ä¸€ä¸ªè½¯ä»¶å•ä½å¯¹å…¶ä»–å•ä½éƒ½åªæœ‰æœ€å°‘çš„çŸ¥è¯†ï¼Œè€Œä¸”å±€é™äºé‚£äº›ä¸æœ¬å•ä½å¯†åˆ‡ç›¸å…³çš„è½¯ä»¶å•ä½ã€‚</p></blockquote><p>ç®€å•æ¥è¯´å°±æ˜¯ï¼Œä¸€ä¸ªç±»&#x2F;æ¨¡å—å¯¹å…¶ä»–çš„ç±»&#x2F;æ¨¡å—æœ‰è¶Šå°‘çš„äº¤äº’è¶Šå¥½ã€‚å½“ä¸€ä¸ªç±»å‘ç”Ÿæ”¹åŠ¨ï¼Œé‚£ä¹ˆï¼Œä¸å…¶ç›¸å…³çš„ç±»ï¼ˆæ¯”å¦‚ç”¨åˆ°æ­¤ç±»å•¥æ–¹æ³•çš„ç±»ï¼‰éœ€è¦å°½å¯èƒ½å°‘çš„å—å½±å“ï¼ˆæ¯”å¦‚ä¿®æ”¹äº†æ–¹æ³•åã€å­—æ®µåç­‰ï¼Œå¯èƒ½å…¶ä»–ç”¨åˆ°è¿™äº›æ–¹æ³•æˆ–æ˜¯å­—æ®µçš„ç±»ä¹Ÿéœ€è¦è·Ÿç€ä¿®æ”¹ï¼‰è¿™æ ·æˆ‘ä»¬åœ¨ç»´æŠ¤é¡¹ç›®çš„æ—¶å€™ä¼šæ›´åŠ è½»æ¾ä¸€äº›ã€‚</p><p>å…¶å®è¯´ç™½äº†ï¼Œè¿˜æ˜¯é™ä½è€¦åˆåº¦ï¼Œæˆ‘ä»¬è¿˜æ˜¯æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><p>â€‹                              </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">Socket</span> <span class="hljs-variable">socket</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Socket</span>(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-number">8080</span>);   <span class="hljs-comment">//å‡è®¾æˆ‘ä»¬å½“å‰çš„ç¨‹åºéœ€è¦è¿›è¡Œç½‘ç»œé€šä¿¡</span><br>        <span class="hljs-type">Test</span> <span class="hljs-variable">test</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Test</span>();<br>        test.test(socket);   <span class="hljs-comment">//ç°åœ¨éœ€è¦æ‰§è¡Œ test æ–¹æ³•æ¥åšä¸€äº›äº‹æƒ…</span><br>    &#125;<br><br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span> &#123;<br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * æ¯”å¦‚ test æ–¹æ³•éœ€è¦å¾—åˆ°æˆ‘ä»¬å½“å‰ Socket è¿æ¥çš„æœ¬åœ°åœ°å€</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">(Socket socket)</span>&#123;<br>            System.out.println(<span class="hljs-string">&quot;IPåœ°å€ï¼š&quot;</span>+socket.getLocalAddress());<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶ä¸Šé¢è¿™ç§å†™æ³•æ²¡æœ‰é—®é¢˜ï¼Œæˆ‘ä»¬æä¾›ç›´æ¥æä¾›ä¸€ä¸ª Socket å¯¹è±¡ï¼Œç„¶åå†ç”± test æ–¹æ³•æ¥å–å‡º IP åœ°å€ï¼Œä½†æ˜¯è¿™æ ·æ˜¾ç„¶è¿èƒŒäº†è¿ªç±³ç‰¹æ³•åˆ™ï¼Œå®é™…ä¸Šè¿™é‡Œçš„ <code>test</code> æ–¹æ³•åªéœ€è¦ä¸€ä¸ª IP åœ°å€å³å¯ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥ç›´æ¥ä¼ å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯æ•´ä¸ª Socket å¯¹è±¡ï¼Œæˆ‘ä»¬éœ€è¦ä¿è¯ä¸å…¶ä»–ç±»çš„äº¤äº’å°½å¯èƒ½çš„å°‘ã€‚</p><p>å°±åƒæˆ‘ä»¬åœ¨é¤å…åƒå®Œäº†é¥­ï¼Œåº”è¯¥æ˜¯æˆ‘ä»¬è‡ªå·±æ‰«ç ä»˜æ¬¾ï¼Œè€Œä¸æ˜¯ç›´æ¥æŠŠæ‰‹æœºäº¤ç»™è€æ¿æ¥å¸®ä½ æ“ä½œä»˜æ¬¾ã€‚</p><p>è¦æ˜¯æŸä¸€å¤©ï¼ŒSocket ç±»ä¸­çš„è¿™äº›æ–¹æ³•å‘ç”Ÿä¿®æ”¹äº†ï¼Œé‚£æˆ‘ä»¬å°±å¾—è¿å¸¦ç€å»ä¿®æ”¹è¿™äº›ç±»ï¼Œå¾ˆéº»çƒ¦ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬æ¥æ”¹è¿›æ”¹è¿›ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">Socket</span> <span class="hljs-variable">socket</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Socket</span>(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-number">8080</span>);<br>        <span class="hljs-type">Test</span> <span class="hljs-variable">test</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Test</span>();<br>        test.test(socket.getLocalAddress().getHostAddress());  <span class="hljs-comment">//åœ¨å¤–é¢è§£æå¥½å°±è¡Œäº†</span><br>    &#125;<br><br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span> &#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">(String str)</span>&#123;   <span class="hljs-comment">//ä¸€ä¸ªå­—ç¬¦ä¸²å°±èƒ½æå®šï¼Œå°±æ²¡å¿…è¦ä¸¢æ•´ä¸ªå¯¹è±¡è¿›æ¥</span><br>            System.out.println(<span class="hljs-string">&quot;IPåœ°å€ï¼š&quot;</span>+str);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œç±»ä¸ç±»ä¹‹é—´çš„è€¦åˆåº¦å†æ¬¡é™ä½ã€‚</p><hr><p>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºæŸç çŸ¥è¯†åº“ç‰ˆæƒæ‰€æœ‰ï¼Œç¦æ­¢ä¸€åˆ‡æœªç»æˆæƒçš„è½¬è½½ã€å‘å¸ƒã€å‡ºå”®ç­‰è¡Œä¸ºï¼Œè¿è€…å°†è¢«è¿½ç©¶æ³•å¾‹è´£ä»»ã€‚</p><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://www.itbaima.cn/document/6386mh7anqt4tzyv">https://www.itbaima.cn/document/6386mh7anqt4tzyv</a></p>]]></content>
    
    
    <categories>
      
      <category>è®¾è®¡æ¨¡å¼</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é¢å‘å¯¹è±¡</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>560. å’Œä¸º K çš„å­æ•°ç»„</title>
    <link href="/post/5114e513-0f9f-414d-887a-73479298e447/"/>
    <url>/post/5114e513-0f9f-414d-887a-73479298e447/</url>
    
    <content type="html"><![CDATA[<h3 id="560-å’Œä¸º-K-çš„å­æ•°ç»„"><a href="#560-å’Œä¸º-K-çš„å­æ•°ç»„" class="headerlink" title="560. å’Œä¸º K çš„å­æ•°ç»„"></a>560. å’Œä¸º K çš„å­æ•°ç»„</h3><p><code>hexo template generate by typora plugin templater</code></p><h4 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h4><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>nums</code> å’Œä¸€ä¸ªæ•´æ•° <code>k</code> ï¼Œè¯·ä½ ç»Ÿè®¡å¹¶è¿”å› <em>è¯¥æ•°ç»„ä¸­å’Œä¸º <code>k</code> çš„å­æ•°ç»„çš„ä¸ªæ•°</em> ã€‚</p><p>å­æ•°ç»„æ˜¯æ•°ç»„ä¸­å…ƒç´ çš„è¿ç»­éç©ºåºåˆ—ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight fix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs fix"><span class="hljs-attr">è¾“å…¥ï¼šnums </span>=<span class="hljs-string"> [1,1,1], k = 2</span><br><span class="hljs-string">è¾“å‡ºï¼š2</span><br></code></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight fix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs fix"><span class="hljs-attr">è¾“å…¥ï¼šnums </span>=<span class="hljs-string"> [1,2,3], k = 3</span><br><span class="hljs-string">è¾“å‡ºï¼š2</span><br></code></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li><code>1 &lt;= nums.length &lt;= 2 * 104</code></li><li><code>-1000 &lt;= nums[i] &lt;= 1000</code></li><li><code>-107 &lt;= k &lt;= 107</code></li></ul><h4 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">subarraySum</span><span class="hljs-params">(<span class="hljs-type">int</span>[] nums, <span class="hljs-type">int</span> k)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i&lt; nums.length;i++)&#123;<br>             result += formIndexHasSubArraySum(nums,k,i);<br>        &#125;<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br>    <span class="hljs-comment">//ä»ç¬¬ index ä½å¼€å§‹å¯»æ‰¾, æ˜¯å¦å­˜åœ¨ä¸€ä¸ªè¿ç»­æ•°ç»„å’Œç­‰äº k , </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">formIndexHasSubArraySum</span><span class="hljs-params">(<span class="hljs-type">int</span>[] nums, <span class="hljs-type">int</span> k , <span class="hljs-type">int</span> index)</span>&#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span><span class="hljs-number">0</span>;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=index; i&lt;nums.length; i++ )&#123;<br>            sum += nums[i];<br>            <span class="hljs-keyword">if</span>(sum == k)&#123;<br>                count ++;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> count;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
      <category>Leetcode</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Leetcode</tag>
      
      <tag>ä¸­ç­‰</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>49. å­—æ¯å¼‚ä½è¯åˆ†ç»„</title>
    <link href="/post/634b9f44-37c7-4385-81d0-02957234546a/"/>
    <url>/post/634b9f44-37c7-4385-81d0-02957234546a/</url>
    
    <content type="html"><![CDATA[<h3 id="49-å­—æ¯å¼‚ä½è¯åˆ†ç»„"><a href="#49-å­—æ¯å¼‚ä½è¯åˆ†ç»„" class="headerlink" title="49. å­—æ¯å¼‚ä½è¯åˆ†ç»„"></a>49. å­—æ¯å¼‚ä½è¯åˆ†ç»„</h3><p><code>hexo template generate by typora plugin templater</code></p><h4 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h4><p>ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œè¯·ä½ å°† <strong>å­—æ¯å¼‚ä½è¯</strong> ç»„åˆåœ¨ä¸€èµ·ã€‚å¯ä»¥æŒ‰ä»»æ„é¡ºåºè¿”å›ç»“æœåˆ—è¡¨ã€‚</p><p><strong>å­—æ¯å¼‚ä½è¯</strong> æ˜¯ç”±é‡æ–°æ’åˆ—æºå•è¯çš„æ‰€æœ‰å­—æ¯å¾—åˆ°çš„ä¸€ä¸ªæ–°å•è¯ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs prolog">è¾“å…¥: strs = [<span class="hljs-string">&quot;eat&quot;</span>, <span class="hljs-string">&quot;tea&quot;</span>, <span class="hljs-string">&quot;tan&quot;</span>, <span class="hljs-string">&quot;ate&quot;</span>, <span class="hljs-string">&quot;nat&quot;</span>, <span class="hljs-string">&quot;bat&quot;</span>]<br>è¾“å‡º: [[<span class="hljs-string">&quot;bat&quot;</span>],[<span class="hljs-string">&quot;nat&quot;</span>,<span class="hljs-string">&quot;tan&quot;</span>],[<span class="hljs-string">&quot;ate&quot;</span>,<span class="hljs-string">&quot;eat&quot;</span>,<span class="hljs-string">&quot;tea&quot;</span>]]<br></code></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2:</strong></p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs lua">è¾“å…¥: strs = [<span class="hljs-string">&quot;&quot;</span>]<br>è¾“å‡º: <span class="hljs-string">[[&quot;&quot;]]</span><br></code></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 3:</strong></p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs lua">è¾“å…¥: strs = [<span class="hljs-string">&quot;a&quot;</span>]<br>è¾“å‡º: <span class="hljs-string">[[&quot;a&quot;]]</span><br></code></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li><code>1 &lt;= strs.length &lt;= 104</code></li><li><code>0 &lt;= strs[i].length &lt;= 100</code></li><li><code>strs[i]</code> ä»…åŒ…å«å°å†™å­—æ¯</li></ul><h4 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br>        <span class="hljs-keyword">public</span> List&lt;List&lt;String&gt;&gt; <span class="hljs-title function_">groupAnagrams</span><span class="hljs-params">(String[] strs)</span> &#123;<br>            <span class="hljs-keyword">final</span> HashMap&lt;String, List&lt;String&gt;&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>            <span class="hljs-keyword">for</span> (String str : strs) &#123;<br>                <span class="hljs-comment">//å°†æ¯ä¸€ä¸ªå•è¯åˆ†è§£</span><br>                <span class="hljs-keyword">final</span> <span class="hljs-type">char</span>[] chars = str.toCharArray();<br>                <span class="hljs-comment">//æ’åº</span><br>                Arrays.sort(chars);<br>                <span class="hljs-comment">//ç»„æˆkey</span><br>                <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(chars);<br>                <span class="hljs-comment">//æ ¹æ®key å–ä¸€ç»„å¼‚ä½è¯æ•°æ®,æ²¡æœ‰å°±new ä¸€ä¸ª</span><br>                <span class="hljs-keyword">final</span> List&lt;String&gt; list = map.getOrDefault(key, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;String&gt;());<br>                <span class="hljs-comment">//å°†å½“å‰è¯è¯­æ”¾åœ¨è¿™ä¸€ç»„ä¸­</span><br>                list.add(str);<br>                <span class="hljs-comment">//æ›´æ–°æ•°æ®</span><br>                map.put(key, list);<br>            &#125;<br>            <span class="hljs-comment">//è¿”å›mapä¸­æ‰€æœ‰çš„å€¼</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;List&lt;String&gt;&gt;(map.values());<br>        &#125;<br>    &#125;<br><br></code></pre></td></tr></table></figure><p>æµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-keyword">final</span> String[] strings = &#123;<span class="hljs-string">&quot;eat&quot;</span>, <span class="hljs-string">&quot;tea&quot;</span>, <span class="hljs-string">&quot;tan&quot;</span>, <span class="hljs-string">&quot;ate&quot;</span>, <span class="hljs-string">&quot;nat&quot;</span>, <span class="hljs-string">&quot;bat&quot;</span>&#125;;<br>    System.out.println(<span class="hljs-string">&quot;new Solution().groupAnagrams(strings) = &quot;</span> + <span class="hljs-keyword">new</span> <span class="hljs-title class_">Solution</span>().groupAnagrams(strings));<br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Solution</span>().groupAnagrams(strings) = [[eat, tea, ate], [bat], [tan, nat]]<br><br>è¿›ç¨‹å·²ç»“æŸï¼Œé€€å‡ºä»£ç ä¸º <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
      <category>Leetcode</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Leetcode</tag>
      
      <tag>Hot100</tag>
      
      <tag>ä¸­ç­‰</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Spring Boot æ ¸å¿ƒç‰¹æ€§</title>
    <link href="/post/2340056a-ebde-4c90-9452-04055c1a718a/"/>
    <url>/post/2340056a-ebde-4c90-9452-04055c1a718a/</url>
    
    <content type="html"><![CDATA[<h1 id="Spring-Boot-æ ¸å¿ƒç‰¹æ€§"><a href="#Spring-Boot-æ ¸å¿ƒç‰¹æ€§" class="headerlink" title="Spring Boot æ ¸å¿ƒç‰¹æ€§"></a>Spring Boot æ ¸å¿ƒç‰¹æ€§</h1><p>Spring æ•™ç¨‹</p><hr><p>æœ¬éƒ¨åˆ†å°†ä»‹ç» Spring Boot ç›¸å…³çš„ç»†èŠ‚å†…å®¹. åœ¨è¿™é‡Œ, æ‚¨å¯ä»¥å­¦ä¹ åˆ°å¯èƒ½éœ€è¦ä½¿ç”¨å’Œè‡ªå®šä¹‰çš„ä¸»è¦åŠŸèƒ½. æ‚¨å¦‚æœè¿˜æ²¡æœ‰åšå¥½å……åˆ†å‡†å¤‡, å¯èƒ½éœ€è¦é˜…è¯» â€œ<a href="https://sca.aliyun.com/learn/spring-boot/core/getting-started.html#getting-started">å…¥é—¨</a>â€ å’Œ â€œ<a href="https://sca.aliyun.com/learn/spring-boot/core/using.html#using">ä½¿ç”¨ Spring Boot è¿›è¡Œå¼€å‘</a>â€ , ä»¥ä¾¿æ‰“ä¸‹å‰æœŸåŸºç¡€.</p><h2 id="1-SpringApplication"><a href="#1-SpringApplication" class="headerlink" title="1. SpringApplication"></a>1. SpringApplication</h2><p><code>SpringApplication</code> ç±»æä¾›äº†ä¸€ç§å¯é€šè¿‡è¿è¡Œ <code>main()</code> æ–¹æ³•æ¥å¯åŠ¨ Spring åº”ç”¨çš„ç®€å•æ–¹å¼. å¤§å¤šæ•°æƒ…å†µä¸‹, æ‚¨åªéœ€è¦å§”æ‰˜ç»™é™æ€çš„ <code>SpringApplication.run</code> æ–¹æ³•:</p><p>Java</p><p>Kotlin</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplicationpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyApplication</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;     <br>        SpringApplication.run(MyApplication.class, args);  <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å½“åº”ç”¨å¯åŠ¨æ—¶, æ‚¨åº”è¯¥ä¼šçœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹çš„å†…å®¹è¾“å‡º:</p><p>. ____ _ _ _ _ _ &#x2F;\ &#x2F; _ <em><em>â€™</em> _ _ _ <em>(</em>)_ _ _ _ _ _ \ \ \ \ ( ( )_</em> _ | â€™_ | â€™_| | â€™_ / <em>&#96; | \ \ \ \ \&#x2F; <em>_<em>)| |</em>)| | | | | || (_| | ) ) ) ) â€™ |</em></em><strong>| .</strong>|<em>| |</em>|<em>| |</em>_<em>, | &#x2F; &#x2F; &#x2F; &#x2F; &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;|</em>|&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;|<em>_<em>&#x2F;&#x3D;&#x2F;</em>&#x2F;_&#x2F;</em>&#x2F; :: Spring Boot :: (v3.0.0)</p><p>2022-11-24T17:03:48.214Z INFO 20764 â€” [ main] o.s.b.d.f.s.MyApplication : Starting MyApplication using Java 17.0.5 with PID 20764 (&#x2F;opt&#x2F;apps&#x2F;myapp.jar started by myuser in &#x2F;opt&#x2F;apps&#x2F;) 2022-11-24T17:03:48.219Z INFO 20764 â€” [ main] o.s.b.d.f.s.MyApplication : No active profile set, falling back to 1 default profile: â€œdefaultâ€ 2022-11-24T17:03:50.511Z INFO 20764 â€” [ main] o.s.b.w.embedded.tomcat.TomcatWebServer : Tomcat initialized with port(s): 8080 (http) 2022-11-24T17:03:50.524Z INFO 20764 â€” [ main] o.apache.catalina.core.StandardService : Starting service [Tomcat] 2022-11-24T17:03:50.524Z INFO 20764 â€” [ main] o.apache.catalina.core.StandardEngine : Starting Servlet engine: [Apache Tomcat&#x2F;10.1.1] 2022-11-24T17:03:50.623Z INFO 20764 â€” [ main] o.a.c.c.C.[Tomcat].[localhost].[&#x2F;] : Initializing Spring embedded WebApplicationContext 2022-11-24T17:03:50.625Z INFO 20764 â€” [ main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 2269 ms 2022-11-24T17:03:51.380Z INFO 20764 â€” [ main] o.s.b.w.embedded.tomcat.TomcatWebServer : Tomcat started on port(s): 8080 (http) with context path â€ 2022-11-24T17:03:51.418Z INFO 20764 â€” [ main] o.s.b.d.f.s.MyApplication : Started MyApplication in 3.872 seconds (process running for 5.008) 2022-11-24T17:03:51.506Z INFO 20764 â€” [ionShutdownHook] o.apache.catalina.core.StandardService : Stopping service [Tomcat]</p><p>é»˜è®¤æƒ…å†µä¸‹, å°†æ˜¾ç¤º <code>INFO</code> çº§åˆ«çš„æ—¥å¿—ä¿¡æ¯, åŒ…æ‹¬ä¸€äº›åº”ç”¨å¯åŠ¨ç›¸å…³ä¿¡æ¯. å¦‚æœæ‚¨éœ€è¦ä¿®æ”¹ <code>INFO</code> æ—¥å¿—çº§åˆ«, è¯·å‚è€ƒ <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.logging.log-levels">æ—¥å¿—ç­‰çº§</a>.</p><p>ä½¿ç”¨ä¸»åº”ç”¨ç¨‹åºç±»åŒ…ä¸­çš„å®ç°ç‰ˆæœ¬æ¥ç¡®å®šåº”ç”¨ç¨‹åºç‰ˆæœ¬. å¯ä»¥é€šè¿‡å°† <code>spring.main.log-startup-info</code> è®¾ç½®ä¸º <code>false</code> æ¥å…³é—­å¯åŠ¨ä¿¡æ¯è®°å½•. è¿™è¿˜å°†å…³é—­å¯¹åº”ç”¨ç¨‹åº active é…ç½®æ–‡ä»¶çš„æ—¥å¿—è®°å½•.</p><p>è¦åœ¨å¯åŠ¨æœŸé—´æ·»åŠ å…¶ä»–æ—¥å¿—è®°å½•, å¯ä»¥åœ¨ <code>SpringApplication</code> çš„å­ç±»ä¸­é‡å†™ <code>logStartupInfo(boolean)</code>.</p><h3 id="1-1-å¯åŠ¨å¤±è´¥"><a href="#1-1-å¯åŠ¨å¤±è´¥" class="headerlink" title="1.1. å¯åŠ¨å¤±è´¥"></a>1.1. å¯åŠ¨å¤±è´¥</h3><p>å¦‚æœæ‚¨çš„åº”ç”¨æ— æ³•å¯åŠ¨, æ³¨å†Œçš„ <code>FailureAnalyzers</code> å¯èƒ½ä¼šæä¾›æœ‰ç›¸å…³çš„é”™è¯¯ä¿¡æ¯å’Œè§£å†³é—®é¢˜çš„å…·ä½“æ–¹æ³•. ä¾‹å¦‚, å¦‚æœæ‚¨åœ¨å·²ç»è¢«å ç”¨çš„ <code>8080</code> ç«¯å£ä¸Šå¯åŠ¨äº†ä¸€ä¸ª web åº”ç”¨, ä¼šçœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹çš„é”™è¯¯ä¿¡æ¯:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">**** **** **** **** **** **** *** APPLICATION FAILED TO START *** **** **** **** **** **** ****<br><br>Description:<br><br>Embedded servlet container failed to start. Port <span class="hljs-number">8080</span> was already in use.<br><br>Action:<br><br>Identify and stop the process that is listening on port <span class="hljs-number">8080</span> or configure <span class="hljs-built_in">this</span> application to listen on another port.<br></code></pre></td></tr></table></figure><p>Spring Boot æä¾›äº†è®¸å¤šçš„ <code>FailureAnalyzer</code> å®ç°, æ‚¨ä¹Ÿå¯ä»¥ <a href="https://sca.aliyun.com/learn/spring-boot/core/howto.html#howto.application.failure-analyzer">æ·»åŠ è‡ªå·±çš„å®ç°</a>.</p><p>å¦‚æœæ²¡æœ‰å¤±è´¥åˆ†æå™¨èƒ½å¤Ÿå¤„ç†çš„å¼‚å¸¸, æ‚¨ä»ç„¶å¯ä»¥æ˜¾ç¤ºå®Œæ•´çš„æ¡ä»¶æŠ¥å‘Šä»¥ä¾¿æ›´å¥½åœ°äº†è§£å‡ºç°çš„é—®é¢˜. ä¸ºæ­¤, æ‚¨éœ€è¦é’ˆå¯¹ <code>org.springframework.boot.autoconfigure.logging.ConditionEvaluationReportLoggingListener</code> <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.external-config">å¯ç”¨ <code>debug</code> å±æ€§</a> æˆ–è€… <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.logging.log-levels">å¼€å¯ <code>DEBUG</code> æ—¥å¿—</a>.</p><p>ä¾‹å¦‚, å¦‚æœæ‚¨ä½¿ç”¨ <code>java -jar</code> è¿è¡Œåº”ç”¨, å¯ä»¥æŒ‰ä»¥ä¸‹æ–¹å¼å¯ç”¨ <code>debug</code> å±æ€§:</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">$ <span class="hljs-keyword">java </span>-<span class="hljs-keyword">jar </span>myproject<span class="hljs-number">-0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>-SNAPSHOT.<span class="hljs-keyword">jar </span>--<span class="hljs-built_in">debug</span><br></code></pre></td></tr></table></figure><h3 id="1-2-å»¶è¿Ÿåˆå§‹åŒ–"><a href="#1-2-å»¶è¿Ÿåˆå§‹åŒ–" class="headerlink" title="1.2. å»¶è¿Ÿåˆå§‹åŒ–"></a>1.2. å»¶è¿Ÿåˆå§‹åŒ–</h3><p><code>SpringApplication</code> å…è®¸å»¶è¿Ÿåœ°åˆå§‹åŒ–åº”ç”¨ç¨‹åº. å¯ç”¨å»¶è¿Ÿåˆå§‹åŒ–å, å°†æ ¹æ®éœ€è¦åˆ›å»º bean, è€Œä¸æ˜¯åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æœŸé—´åˆ›å»º bean. å› æ­¤, å¯ç”¨å»¶è¿Ÿåˆå§‹åŒ–å¯ä»¥å‡å°‘åº”ç”¨ç¨‹åºå¯åŠ¨æ‰€éœ€çš„æ—¶é—´. åœ¨ Web åº”ç”¨ç¨‹åºä¸­, å¯ç”¨å»¶è¿Ÿåˆå§‹åŒ–å°†å¯¼è‡´è®¸å¤šä¸ Web ç›¸å…³çš„ Bean åœ¨æ”¶åˆ° HTTP è¯·æ±‚åæ‰è¢«åˆå§‹åŒ–.</p><p>å»¶è¿Ÿåˆå§‹åŒ–çš„ç¼ºç‚¹æ˜¯, å®ƒå¯èƒ½ä¼šå»¶è¿Ÿå‘ç°åº”ç”¨ç¨‹åºé—®é¢˜çš„æ—¶é—´. å¦‚æœé…ç½®é”™è¯¯çš„ Bean å»¶è¿Ÿåˆå§‹åŒ–, åˆ™åœ¨å¯åŠ¨æœŸé—´ä¸ä¼šå‘ç”Ÿé—®é¢˜, å¹¶ä¸”åªæœ‰åœ¨åˆå§‹åŒ– Bean æ—¶é—®é¢˜æ‰ä¼šå˜å¾—æ˜æ˜¾. è¿˜å¿…é¡»æ³¨æ„ç¡®ä¿ JVM æœ‰è¶³å¤Ÿçš„å†…å­˜æ¥å®¹çº³æ‰€æœ‰åº”ç”¨ç¨‹åºçš„ bean, è€Œä¸ä»…ä»…æ˜¯å¯åŠ¨æœŸé—´åˆå§‹åŒ–çš„ bean. ç”±äºè¿™äº›åŸå› , é»˜è®¤æƒ…å†µä¸‹ä¸ä¼šå¯ç”¨å»¶è¿Ÿåˆå§‹åŒ–, å› æ­¤å»ºè®®åœ¨å¯ç”¨å»¶è¿Ÿåˆå§‹åŒ–ä¹‹å‰å…ˆå¯¹ JVM çš„å †å¤§å°è¿›è¡Œå¾®è°ƒ.</p><p>å¯ä»¥ä½¿ç”¨ <code>SpringApplicationBuilder</code> ä¸Šçš„ <code>lazyInitialization</code> æ–¹æ³•æˆ– <code>SpringApplication</code> ä¸Šçš„ <code>setLazyInitialization</code> æ–¹æ³•ä»¥ç¼–ç¨‹æ–¹å¼å¯ç”¨å»¶è¿Ÿåˆå§‹åŒ–. å¦å¤–, å¯ä»¥ä½¿ç”¨ <code>spring.main.lazy-initialization</code> å±æ€§å¯ç”¨å®ƒ, å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br><br>  <span class="hljs-attr">main:</span><br><br>    <span class="hljs-attr">lazy-initialization:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>å¦‚æœæ‚¨ç¦ç”¨äº†å»¶è¿Ÿåˆå§‹åŒ–ï¼Œä½†å¯¹åº”ç”¨ç¨‹åºå…¶ä½™éƒ¨åˆ†ä½¿ç”¨å»¶è¿Ÿåˆå§‹åŒ–æ—¶, åˆ™å¯ä»¥ä½¿ç”¨ <code>@Lazy(false)</code> æ³¨è§£å°†å®ƒä»¬çš„å»¶è¿Ÿå±æ€§æ˜¾å¼è®¾ç½®ä¸º <code>false</code>.</p><h3 id="1-3-è‡ªå®šä¹‰-banner"><a href="#1-3-è‡ªå®šä¹‰-banner" class="headerlink" title="1.3. è‡ªå®šä¹‰ banner"></a>1.3. è‡ªå®šä¹‰ banner</h3><p>å¯ä»¥é€šè¿‡åœ¨ classpath ä¸‹æ·»åŠ ä¸€ä¸ª <code>banner.txt</code> æ–‡ä»¶, æˆ–è€…å°† <code>spring.banner.location</code> å±æ€§æŒ‡å‘è¯¥æ–‡ä»¶çš„ä½ç½®æ¥æ›´æ”¹å¯åŠ¨æ—¶æ‰“å°çš„ banner. å¦‚æœæ–‡ä»¶é‡‡ç”¨äº†é UTF-8 ç¼–ç , æ‚¨å¯ä»¥è®¾ç½® <code>spring.banner.charset</code> æ¥è§£å†³.</p><p>æ‚¨å¯ä»¥åœ¨ <code>banner.txt</code> æ–‡ä»¶ä¸­ä½¿ç”¨ <code>Environment</code> ç¯å¢ƒå˜é‡ä»¥åŠä»¥ä¸‹å ä½ç¬¦:</p><p>Table 1. Banner å˜é‡</p><p>å˜é‡</p><p>æè¿°</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">$&#123;<span class="hljs-built_in">application</span>.<span class="hljs-built_in">version</span>&#125;<br></code></pre></td></tr></table></figure><p>æ‚¨çš„åº”ç”¨ç‰ˆæœ¬å·, å£°æ˜åœ¨ <code>MANIFEST.MF</code> ä¸­. ä¾‹å¦‚, <code>Implementation-Version: 1.0</code> å°†è¢«æ‰“å°ä¸º <code>1.0</code>.</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">$&#123;<span class="hljs-built_in">application</span>.formatted-<span class="hljs-built_in">version</span>&#125;<br></code></pre></td></tr></table></figure><p>æ‚¨çš„åº”ç”¨ç‰ˆæœ¬å·, å£°æ˜åœ¨ <code>MANIFEST.MF</code> ä¸­, æ ¼å¼åŒ–ä¹‹åæ‰“å° (ç”¨æ‹¬å·æ‹¬èµ·æ¥, ä»¥ <code>v</code> ä¸ºå‰ç¼€) , ä¾‹å¦‚ <code>(v1.0)</code>.</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stata"><span class="hljs-variable">$&#123;spring</span>-<span class="hljs-keyword">boot</span>.<span class="hljs-keyword">version</span>&#125;<br></code></pre></td></tr></table></figure><p>æ‚¨ä½¿ç”¨çš„ Spring Boot ç‰ˆæœ¬. ä¾‹å¦‚ <code>3.0.0</code>.</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stata"><span class="hljs-variable">$&#123;spring</span>-<span class="hljs-keyword">boot</span>.formatted-<span class="hljs-keyword">version</span>&#125;<br></code></pre></td></tr></table></figure><p>æ‚¨ä½¿ç”¨çš„ Spring Boot ç‰ˆæœ¬æ ¼å¼åŒ–ä¹‹åæ˜¾ç¤º (ç”¨æ‹¬å·æ‹¬èµ·æ¥, ä»¥ <code>v</code> ä¸ºå‰ç¼€) . ä¾‹å¦‚ <code>(v3.0.0)</code>.</p><p><code>$&#123;Ansi.NAME&#125;</code> (or <code>$&#123;AnsiColor.NAME&#125;</code>, <code>$&#123;AnsiBackground.NAME&#125;</code>, <code>$&#123;AnsiStyle.NAME&#125;</code>)</p><p>å…¶ä¸­ <code>NAME</code> æ˜¯ ANSI è½¬ä¹‰ç çš„åç§°. æœ‰å…³è¯¦ç»†ä¿¡æ¯, è¯·å‚é˜… <a href="https://github.com/spring-projects/spring-boot/tree/main/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/ansi/AnsiPropertySource.java"><code>AnsiPropertySource</code></a>.</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">$&#123;<span class="hljs-built_in">application</span>.title&#125;<br></code></pre></td></tr></table></figure><p>æ‚¨çš„åº”ç”¨æ ‡é¢˜, å£°æ˜åœ¨ <code>MANIFEST.MF</code> ä¸­, ä¾‹å¦‚ <code>Implementation-Title: MyApp</code> æ‰“å°ä¸º <code>MyApp</code>.</p><p>å¦‚æœæ‚¨æƒ³ä»¥ç¼–ç¨‹çš„æ–¹å¼ç”Ÿæˆ banner, å¯ä»¥ä½¿ç”¨ <code>SpringApplication.setBanner(â€¦)</code> æ–¹æ³•. ä½¿ç”¨ <code>org.springframework.boot.Banner</code> æ¥å£å¹¶å®ç°è‡ªå·±çš„ <code>printBanner()</code> æ–¹æ³•.</p><p>æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ <code>spring.main.banner-mode</code> å±æ€§æ¥ç¡®å®šæ˜¯å¦å¿…é¡»åœ¨ <code>System.out</code> (<code>console</code>) ä¸Šæ‰“å° banner, è¿˜æ˜¯ä½¿ç”¨æ—¥å¿—è®°å½•å™¨ (<code>log</code>) æˆ–è€…éƒ½ä¸æ‰“å° (<code>off</code>).</p><p>æ‰“å°çš„ banner çš„å•ä¾‹ bean ä¸ºï¼š <code>springBootBanner</code> .</p><p>åªæœ‰åœ¨ä½¿ç”¨ Spring Boot å¯åŠ¨æ—¶ï¼Œ <code>$ &#123;application.version&#125;</code> å’Œ <code>$&#123;application.formatted-version&#125;</code> å±æ€§æ‰å¯ç”¨. å¦‚æœæ‚¨è¿è¡Œçš„æ˜¯æœªæ‰“åŒ…çš„ jar å¹¶ä»¥ <code>java -cp &lt;classpath&gt; &lt;mainclass&gt;</code> å¼€å¤´ï¼Œ åˆ™æ— æ³•è§£æè¿™äº›å€¼.</p><p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å»ºè®®æ‚¨å§‹ç»ˆä½¿ç”¨é€šè¿‡ <code>java org.springframework.boot.loader.JarLauncher</code> æ¥å¯åŠ¨æœªæ‰“åŒ…çš„ jar çš„åŸå› . è¿™å°†åœ¨æ„å»ºç±»è·¯å¾„å¹¶å¯åŠ¨æ‚¨çš„åº”ç”¨ç¨‹åºä¹‹å‰åˆå§‹åŒ– <code>application.*</code> å˜é‡.</p><h3 id="1-4-è‡ªå®šä¹‰-SpringApplication"><a href="#1-4-è‡ªå®šä¹‰-SpringApplication" class="headerlink" title="1.4. è‡ªå®šä¹‰ SpringApplication"></a>1.4. è‡ªå®šä¹‰ SpringApplication</h3><p>å¦‚æœ <code>SpringApplication</code> çš„é»˜è®¤è®¾ç½®ä¸ç¬¦åˆæ‚¨çš„æƒ³æ³•, æ‚¨å¯ä»¥åˆ›å»ºæœ¬åœ°å®ä¾‹è¿›è¡Œå®šåˆ¶åŒ–. ä¾‹å¦‚, è¦å…³é—­ banner, æ‚¨å¯ä»¥è¿™æ ·:</p><p>Java</p><p>Kotlin</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplicationpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyApplication</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;    <br>        <span class="hljs-type">SpringApplication</span> <span class="hljs-variable">application</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpringApplication</span>(MyApplication.class);        application.setBannerMode(Banner.Mode.OFF);   <br>        application.run(args);    <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¼ å…¥ <code>SpringApplication</code> çš„æ„é€ å‚æ•°æ˜¯ Spring beans çš„é…ç½®æº. å¤§å¤šæƒ…å†µä¸‹æ˜¯å¼•ç”¨ <code>@Configuration</code> ç±», ä½†æ‚¨ä¹Ÿå¯ä»¥å¼•ç”¨ XML é…ç½®æˆ–è€…è¢«æ‰«æçš„åŒ….</p><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>application.properties</code> æ–‡ä»¶é…ç½® <code>SpringApplication</code>. æœ‰å…³è¯¦ç»†ä¿¡æ¯, è¯·å‚è§ <em><a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.external-config">å¤–éƒ¨åŒ–é…ç½®</a></em>.</p><p>å…³äºé…ç½®é€‰é¡¹çš„å®Œæ•´åˆ—è¡¨, è¯·å‚é˜… <a href="https://docs.spring.io/spring-boot/docs/3.0.0/api/org/springframework/boot/SpringApplication.html"><code>SpringApplication</code> Javadoc</a>.</p><h3 id="1-5-Fluent-Builder-API-æµå¼æ„å»º-API"><a href="#1-5-Fluent-Builder-API-æµå¼æ„å»º-API" class="headerlink" title="1.5. Fluent Builder API(æµå¼æ„å»º API)"></a>1.5. Fluent Builder API(æµå¼æ„å»º API)</h3><p>å¦‚æœæ‚¨éœ€è¦æ„å»ºä¸€ä¸ªæœ‰å±‚çº§å…³ç³»çš„ <code>ApplicationContext</code> (å…·æœ‰çˆ¶&#x2F;å­å…³ç³»çš„å¤šä¸Šä¸‹æ–‡) , æˆ–è€…åå‘ä½¿ç”¨ fluent (æµå¼) æ„å»ºå™¨ API, å¯ä»¥ä½¿ç”¨ <code>SpringApplicationBuilder</code>.</p><p><code>SpringApplicationBuilder</code> å…è®¸æ‚¨é“¾å¼è°ƒç”¨å¤šä¸ªæ–¹æ³•, åŒ…æ‹¬èƒ½åˆ›å»ºå‡ºå…·æœ‰å±‚æ¬¡ç»“æ„çš„ <code>parent</code> å’Œ <code>child</code> æ–¹æ³•.</p><p>ä¾‹å¦‚:</p><p>Java</p><p>Kotlin</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">new</span> <span class="hljs-title class_">SpringApplicationBuilder</span>()<br><br>    .sources(Parent.class)<br><br>    .child(Application.class)<br><br>    .bannerMode(Banner.Mode.OFF)<br><br>    .run(args);<br></code></pre></td></tr></table></figure><p>åˆ›å»ºå±‚çº§çš„ <code>ApplicationContext</code> æ—¶æœ‰éƒ¨åˆ†é™åˆ¶, æ¯”å¦‚ Web ç»„ä»¶å¿…é¡»åŒ…å«åœ¨å­ä¸Šä¸‹æ–‡ä¸­, å¹¶ä¸”ç›¸åŒçš„ <code>Environment</code> å°†ä½œç”¨äºçˆ¶å­ä¸Šä¸‹æ–‡. æœ‰å…³è¯¦ç»†ä¿¡æ¯, è¯·å‚é˜… <a href="https://docs.spring.io/spring-boot/docs/3.0.0/api/org/springframework/boot/builder/SpringApplicationBuilder.html"><code>SpringApplicationBuilder</code> Javadoc</a> .</p><h3 id="1-6-åº”ç”¨ç¨‹åºçš„å¯ç”¨æ€§"><a href="#1-6-åº”ç”¨ç¨‹åºçš„å¯ç”¨æ€§" class="headerlink" title="1.6. åº”ç”¨ç¨‹åºçš„å¯ç”¨æ€§"></a>1.6. åº”ç”¨ç¨‹åºçš„å¯ç”¨æ€§</h3><p>åœ¨å¹³å°ä¸Šéƒ¨ç½²å, åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨è¯¸å¦‚ <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/">Kubernetes Probes</a> ä¹‹ç±»çš„åŸºç¡€ç»“æ„å‘å¹³å°æä¾›æœ‰å…³å…¶å¯ç”¨æ€§çš„ä¿¡æ¯. Spring Boot å¯¹å¸¸ç”¨çš„ â€œlivenessâ€ å’Œ â€œreadinessâ€ å¯ç”¨æ€§çŠ¶æ€æä¾›äº†å¼€ç®±å³ç”¨çš„æ”¯æŒ. å¦‚æœæ‚¨ä½¿ç”¨äº† Spring Boot çš„ â€œactuatorâ€ æ”¯æŒ, åˆ™è¿™äº›çŠ¶æ€å°†æ˜¾ç¤ºä¸ºè¿è¡ŒçŠ¶å†µç«¯ç‚¹ç»„.</p><p>å¦å¤–, æ‚¨è¿˜å¯ä»¥é€šè¿‡å°† <code>ApplicationAvailability</code> æ¥å£æ³¨å…¥åˆ°æ‚¨è‡ªå·±çš„ bean ä¸­æ¥è·å–å¯ç”¨æ€§çŠ¶æ€.</p><h4 id="1-6-1-Liveness-State"><a href="#1-6-1-Liveness-State" class="headerlink" title="1.6.1. Liveness State"></a>1.6.1. Liveness State</h4><p>åº”ç”¨ç¨‹åºçš„ â€œLivenessâ€ çŠ¶æ€è¡¨æ˜å…¶å†…éƒ¨æ˜¯å¦æ­£å¸¸è¿è¡Œ, æˆ–è€…åœ¨å½“å‰å‡ºç°æ•…éšœæ—¶è‡ªè¡Œæ¢å¤. ä¸€ä¸ª broken ï¼ˆæŸåï¼‰çš„ â€œLivenessâ€ çŠ¶æ€æ„å‘³ç€åº”ç”¨ç¨‹åºå¤„äºæ— æ³•æ¢å¤çš„çŠ¶æ€, å¹¶ä¸”åº”é‡æ–°å¯åŠ¨åº”ç”¨ç¨‹åº.</p><p>é€šå¸¸,â€œLivenessâ€ çŠ¶æ€ä¸åº”åŸºäºå¤–éƒ¨æ£€æŸ¥ (ä¾‹å¦‚ <a href="https://sca.aliyun.com/learn/spring-boot/core/actuator.html#actuator.endpoints.health">Health checks</a>) . å¦‚æœç¡®å®å¦‚æ­¤, åˆ™å‘ç”Ÿæ•…éšœçš„å¤–éƒ¨ç³»ç»Ÿ (æ•°æ®åº“, Web API, å¤–éƒ¨ç¼“å­˜) å°†è§¦å‘æ•´ä¸ªå¹³å°çš„å¤§é‡é‡å¯å’Œçº§è”æ•…éšœ.</p><p>Spring Boot åº”ç”¨ç¨‹åºçš„å†…éƒ¨çŠ¶æ€ä¸»è¦ç”± Spring <code>ApplicationContext</code> è¡¨ç¤º. å¦‚æœåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡å·²æˆåŠŸå¯åŠ¨, åˆ™ Spring Boot ä¼šå‡å®šè¯¥åº”ç”¨ç¨‹åºå¤„äºæœ‰æ•ˆçŠ¶æ€. åˆ·æ–°ä¸Šä¸‹æ–‡å, åº”ç”¨ç¨‹åºå³è¢«è§†ä¸ºæ´»åŠ¨åº”ç”¨ç¨‹åº, è¯·å‚é˜… <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.spring-application.application-events-and-listeners">Spring Boot åº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸå’Œç›¸å…³çš„åº”ç”¨ç¨‹åºäº‹ä»¶</a>.</p><h4 id="1-6-2-Readiness-State"><a href="#1-6-2-Readiness-State" class="headerlink" title="1.6.2. Readiness State"></a>1.6.2. Readiness State</h4><p>åº”ç”¨ç¨‹åºçš„ â€œReadinessâ€ çŠ¶æ€å‘Šè¯‰åº”ç”¨ç¨‹åºæ˜¯å¦å·²å‡†å¤‡å¥½å¤„ç†æµé‡. failingï¼ˆå¤±è´¥çš„ï¼‰ â€œReadinessâ€ çŠ¶æ€å‘Šè¯‰å¹³å°å½“å‰ä¸åº”å°†æµé‡è·¯ç”±åˆ°åº”ç”¨ç¨‹åº. è¿™é€šå¸¸å‘ç”Ÿåœ¨å¯åŠ¨è¿‡ç¨‹ä¸­, æ­£åœ¨å¤„ç† <code>CommandLineRunner</code> å’Œ <code>ApplicationRunner</code> ç»„ä»¶æ—¶, æˆ–è€…åœ¨åº”ç”¨ç¨‹åºè®¤ä¸ºå®ƒå¤ªå¿™è€Œæ— æ³•è·å¾—é¢å¤–æµé‡çš„æƒ…å†µä¸‹.</p><p>ä¸€æ—¦è°ƒç”¨äº†åº”ç”¨ç¨‹åºå’Œå‘½ä»¤è¡Œè¿è¡Œç¨‹åº, å°±è®¤ä¸ºè¯¥åº”ç”¨ç¨‹åºå·²å‡†å¤‡å°±ç»ª, è¯·å‚é˜… <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.spring-application.application-events-and-listeners">Spring Boot åº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸå’Œç›¸å…³çš„åº”ç”¨ç¨‹åºäº‹ä»¶</a>.</p><p>é¢„æœŸåœ¨å¯åŠ¨æœŸé—´è¿è¡Œçš„ä»»åŠ¡åº”ç”± <code>CommandLineRunner</code> å’Œ <code>ApplicationRunner</code> ç»„ä»¶æ‰§è¡Œ, è€Œä¸æ˜¯ä½¿ç”¨ Spring ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå›è°ƒ (å¦‚ <code>@PostConstruct</code>) æ‰§è¡Œ.</p><h4 id="1-6-3-ç®¡ç†åº”ç”¨ç¨‹åºå¯ç”¨æ€§çŠ¶æ€"><a href="#1-6-3-ç®¡ç†åº”ç”¨ç¨‹åºå¯ç”¨æ€§çŠ¶æ€" class="headerlink" title="1.6.3. ç®¡ç†åº”ç”¨ç¨‹åºå¯ç”¨æ€§çŠ¶æ€"></a>1.6.3. ç®¡ç†åº”ç”¨ç¨‹åºå¯ç”¨æ€§çŠ¶æ€</h4><p>é€šè¿‡æ³¨å…¥ <code>ApplicationAvailability</code> æ¥å£å¹¶è°ƒç”¨å…¶æ–¹æ³•, åº”ç”¨ç¨‹åºç»„ä»¶å¯ä»¥éšæ—¶æ£€ç´¢å½“å‰çš„å¯ç”¨æ€§çŠ¶æ€. åº”ç”¨ç¨‹åºé€šå¸¸ä¼šå¸Œæœ›ç›‘å¬çŠ¶æ€æ›´æ–°æˆ–æ›´æ–°åº”ç”¨ç¨‹åºçš„çŠ¶æ€.</p><p>ä¾‹å¦‚, æˆ‘ä»¬å¯ä»¥å°†åº”ç”¨ç¨‹åºçš„ â€œReadinessâ€ çŠ¶æ€å¯¼å‡ºåˆ°æ–‡ä»¶ä¸­, ä»¥ä¾¿ Kubernetes çš„ â€œexec Probeâ€ å¯ä»¥æŸ¥çœ‹æ­¤æ–‡ä»¶:</p><p>Java</p><p>Kotlin</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyReadinessStateExporter</span> &#123;<br>    <span class="hljs-meta">@EventListener</span> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onStateChange</span><span class="hljs-params">(AvailabilityChangeEvent&lt;ReadinessState&gt; event)</span> &#123;        <br>        <span class="hljs-keyword">switch</span> (event.getState()) &#123;   <br>            <span class="hljs-keyword">case</span> ACCEPTING_TRAFFIC:       <br>                <span class="hljs-comment">// create file /tmp/healthy   </span><br>                <span class="hljs-keyword">break</span>;       <br>            <span class="hljs-keyword">case</span> REFUSING_TRAFFIC:        <br>                <span class="hljs-comment">// remove file /tmp/healthy    </span><br>                <span class="hljs-keyword">break</span>;        &#125;    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å½“åº”ç”¨ç¨‹åºå´©æºƒä¸”æ— æ³•æ¢å¤æ—¶, æˆ‘ä»¬è¿˜å¯ä»¥æ›´æ–°åº”ç”¨ç¨‹åºçš„çŠ¶æ€:</p><p>Java</p><p>Kotlin</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Componentpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyLocalCacheVerifier</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ApplicationEventPublisher eventPublisher;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyLocalCacheVerifier</span><span class="hljs-params">(ApplicationEventPublisher eventPublisher)</span> &#123;   <br>        <span class="hljs-built_in">this</span>.eventPublisher = eventPublisher;    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkLocalCache</span><span class="hljs-params">()</span> &#123;        <span class="hljs-keyword">try</span> &#123;            <span class="hljs-comment">// ...  </span><br>    &#125;        <span class="hljs-keyword">catch</span> (CacheCompletelyBrokenException ex) &#123;      <br>        AvailabilityChangeEvent.publish(<span class="hljs-built_in">this</span>.eventPublisher, ex, LivenessState.BROKEN);     <br>    &#125;    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>Spring Boot é€šè¿‡ <a href="https://sca.aliyun.com/learn/spring-boot/core/actuator.html#actuator.endpoints.kubernetes-probes">Kubernetes HTTP probes for â€œLivenessâ€ and â€œReadinessâ€ with Actuator Health Endpoints</a>.æ‚¨å¯ä»¥åœ¨ä¸“ç”¨éƒ¨åˆ†ä¸­è·å¾— <a href="https://sca.aliyun.com/learn/spring-boot/core/deployment.html#deployment.cloud.kubernetes">æœ‰å…³åœ¨ Kubernetes ä¸Šéƒ¨ç½² Spring Boot åº”ç”¨ç¨‹åºçš„æ›´å¤šæŒ‡å—</a>.</p><h3 id="1-7-åº”ç”¨ç¨‹åºäº‹ä»¶ä¸ç›‘å¬å™¨"><a href="#1-7-åº”ç”¨ç¨‹åºäº‹ä»¶ä¸ç›‘å¬å™¨" class="headerlink" title="1.7. åº”ç”¨ç¨‹åºäº‹ä»¶ä¸ç›‘å¬å™¨"></a>1.7. åº”ç”¨ç¨‹åºäº‹ä»¶ä¸ç›‘å¬å™¨</h3><p>é™¤äº†å¸¸è§çš„ Spring Framework äº‹ä»¶, æ¯”å¦‚ <a href="https://docs.spring.io/spring-framework/docs/6.0.2/javadoc-api/org/springframework/context/event/ContextRefreshedEvent.html"><code>ContextRefreshedEvent</code></a>, <code>SpringApplication</code> è¿˜ä¼šå‘é€å…¶ä»–åº”ç”¨ç¨‹åºäº‹ä»¶.</p><p>åœ¨ <code>ApplicationContext</code> åˆ›å»ºä¹‹å‰, å®é™…ä¸Šè§¦å‘äº†ä¸€äº›äº‹ä»¶, å› æ­¤æ‚¨ä¸èƒ½åƒ <code>@Bean</code> ä¸€æ ·æ³¨å†Œç›‘å¬å™¨. æ‚¨å¯ä»¥é€šè¿‡ <code>SpringApplication.addListeners(â€¦)</code> æˆ–è€… <code>SpringApplicationBuilder.listeners(â€¦)</code> æ–¹æ³•æ³¨å†Œå®ƒä»¬.</p><p>å¦‚æœæ‚¨å¸Œæœ›æ— è®ºåº”ç”¨ä½¿ç”¨ä½•ç§åˆ›å»ºæ–¹å¼éƒ½èƒ½è‡ªåŠ¨æ³¨å†Œè¿™äº›ç›‘å¬å™¨, æ‚¨éƒ½å¯ä»¥å°† <code>META-INF/spring.factories</code> æ–‡ä»¶æ·»åŠ åˆ°é¡¹ç›®ä¸­, å¹¶ä½¿ç”¨ <code>org.springframework.context.ApplicationListener</code> å±æ€§é”®æŒ‡å‘æ‚¨çš„ç›‘å¬å™¨. æ¯”å¦‚:</p><p>org.springframework.context.ApplicationListener &#x3D; com.example.project.MyListener</p><p>å½“æ‚¨è¿è¡Œåº”ç”¨æ—¶, åº”ç”¨ç¨‹åºäº‹ä»¶å°†æŒ‰ç…§ä»¥ä¸‹é¡ºåºå‘é€:</p><ol><li>åœ¨å¼€å§‹åº”ç”¨å¼€å§‹è¿è¡Œä½†è¿˜æ²¡æœ‰è¿›è¡Œä»»ä½•å¤„ç†æ—¶ (é™¤äº†æ³¨å†Œ listeners å’Œ initializers ) , å°†å‘é€ <code>ApplicationStartingEvent</code>.</li><li>å½“ <code>Environment</code> è¢«ä¸Šä¸‹æ–‡ä½¿ç”¨, ä½†æ˜¯åœ¨ä¸Šä¸‹æ–‡åˆ›å»ºä¹‹å‰, å°†å‘é€ <code>ApplicationEnvironmentPreparedEvent</code>.</li><li>å‡†å¤‡ <code>ApplicationContext</code> å¹¶è°ƒç”¨ <code>ApplicationContextInitializers</code> ä¹‹åä½†åœ¨åŠ è½½ä»»ä½• bean å®šä¹‰ä¹‹å‰, å°†å‘é€ <code>ApplicationContextInitializedEvent</code>.</li><li>å¼€å§‹åˆ·æ–°ä¹‹å‰, bean å®šä¹‰è¢«åŠ è½½ä¹‹åå‘é€ <code>ApplicationPreparedEvent</code>.</li><li>åœ¨ä¸Šä¸‹æ–‡åˆ·æ–°ä¹‹åä¸”æ‰€æœ‰çš„åº”ç”¨å’Œå‘½ä»¤è¡Œè¿è¡Œå™¨ (command-line runner) è¢«è°ƒç”¨ä¹‹å‰å‘é€ <code>ApplicationStartedEvent</code>.</li><li>ç´§éšå…¶åå‘é€å¸¦æœ‰ <code>LivenessState.CORRECT</code> çš„ <code>AvailabilityChangeEvent</code>, ä»¥æŒ‡ç¤ºè¯¥åº”ç”¨ç¨‹åºå¤„äºæ´»åŠ¨çŠ¶æ€.</li><li>åœ¨ <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.spring-application.command-line-runner">åº”ç”¨ç¨‹åºå’Œå‘½ä»¤è¡Œè¿è¡Œå™¨ (command-line runner)</a> è¢«è°ƒç”¨ä¹‹å, å°†å‘å‡º, å°†å‘é€ <code>ApplicationReadyEvent</code>.</li><li>éšå³åœ¨ <code>ReadinessState.ACCEPTING_TRAFFIC</code> ä¹‹åå‘é€ <code>AvailabilityChangeEvent</code>, ä»¥æŒ‡ç¤ºè¯¥åº”ç”¨ç¨‹åºå·²å‡†å¤‡å°±ç»ª, å¯ä»¥å¤„ç†è¯·æ±‚.</li><li>å¦‚æœå¯åŠ¨æ—¶å‘ç”Ÿå¼‚å¸¸, åˆ™å‘é€ <code>ApplicationFailedEvent</code>.</li></ol><p>ä¸Šé¢çš„åˆ—è¡¨ä»…åŒ…å«ç»‘å®šåˆ° <code>SpringApplication</code> çš„ <code>SpringApplicationEvent</code> s. é™¤è¿™äº›ä»¥å¤–, ä»¥ä¸‹äº‹ä»¶ä¹Ÿåœ¨ <code>ApplicationPreparedEvent</code> ä¹‹åå’Œ <code>ApplicationStartedEvent</code> ä¹‹å‰å‘å¸ƒ:</p><ol><li><code>WebServer</code> å‡†å¤‡å°±ç»ªå, å°†å‘é€ <code>WebServerInitializedEvent</code>. <code>ServletWebServerInitializedEvent</code> å’Œ <code>ReactiveWebServerInitializedEvent</code> åˆ†åˆ«æ˜¯ servlet å’Œ reactive å˜é‡.</li><li>åˆ·æ–° <code>ApplicationContext</code> æ—¶, å°†å‘é€ <code>ContextRefreshedEvent</code> äº‹ä»¶.</li></ol><p>æ‚¨å¯èƒ½ä¸ä¼šç»å¸¸ä½¿ç”¨åº”ç”¨ç¨‹åºäº‹ä»¶, ä½†äº†è§£ä»–ä»¬çš„å­˜åœ¨è¿˜æ˜¯å¾ˆæœ‰å¿…è¦çš„. åœ¨æ¡†æ¶å†…éƒ¨, Spring Boot ä½¿ç”¨è¿™äº›äº‹ä»¶æ¥å¤„ç†å„ç§ä»»åŠ¡.</p><p>é»˜è®¤æƒ…å†µä¸‹, äº‹ä»¶ç›‘å¬å™¨ä¸åº”è¯¥è¿è¡Œå¯èƒ½å¾ˆé•¿çš„ä»»åŠ¡, å› ä¸ºå®ƒä»¬åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œ.è€ƒè™‘æ”¹ç”¨ <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.spring-application.command-line-runner">application and command-line runners</a>.</p><p>åº”ç”¨ç¨‹åºäº‹ä»¶å‘é€ä½¿ç”¨äº† Spring Framework çš„äº‹ä»¶å‘å¸ƒæœºåˆ¶. è¯¥éƒ¨åˆ†æœºåˆ¶ç¡®ä¿åœ¨å­ä¸Šä¸‹æ–‡ä¸­å‘å¸ƒç»™ç›‘å¬å™¨çš„äº‹ä»¶ä¹Ÿä¼šå‘å¸ƒç»™æ‰€æœ‰ç¥–å…ˆä¸Šä¸‹æ–‡ä¸­çš„ç›‘å¬å™¨. å› æ­¤, å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºä½¿ç”¨æœ‰å±‚çº§ç»“æ„çš„ <code>SpringApplication</code> å®ä¾‹, åˆ™ç›‘å¬å™¨å¯èƒ½ä¼šæ”¶åˆ°åŒç§ç±»å‹åº”ç”¨ç¨‹åºäº‹ä»¶çš„å¤šä¸ªå®ä¾‹.</p><p>ä¸ºäº†è®©ç›‘å¬å™¨èƒ½å¤ŸåŒºåˆ†å…¶ä¸Šä¸‹æ–‡äº‹ä»¶å’Œåä»£ä¸Šä¸‹æ–‡äº‹ä»¶, æ‚¨åº”è¯¥æ³¨å…¥å…¶åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡, ç„¶åå°†æ³¨å…¥çš„ä¸Šä¸‹æ–‡ä¸äº‹ä»¶çš„ä¸Šä¸‹æ–‡è¿›è¡Œæ¯”è¾ƒ. å¯ä»¥é€šè¿‡å®ç° <code>ApplicationContextAware</code> æ¥æ³¨å…¥ä¸Šä¸‹æ–‡, å¦‚æœç›‘å¬å™¨æ˜¯ bean, åˆ™ä½¿ç”¨ <code>@Autowired</code> æ³¨å…¥ä¸Šä¸‹æ–‡.</p><h3 id="1-8-Web-ç¯å¢ƒ"><a href="#1-8-Web-ç¯å¢ƒ" class="headerlink" title="1.8. Web ç¯å¢ƒ"></a>1.8. Web ç¯å¢ƒ</h3><p><code>SpringApplication</code> è¯•å›¾ä¸ºæ‚¨åˆ›å»ºæ­£ç¡®ç±»å‹çš„ <code>ApplicationContext</code>. ç¡®å®š <code>WebApplicationType</code> çš„ç®—æ³•éå¸¸ç®€å•:</p><ul><li>å¦‚æœå­˜åœ¨ Spring MVC, åˆ™ä½¿ç”¨ <code>AnnotationConfigServletWebServerApplicationContext</code></li><li>å¦‚æœ Spring MVC ä¸å­˜åœ¨ä¸”å­˜åœ¨ Spring WebFlux, åˆ™ä½¿ç”¨ <code>AnnotationConfigReactiveWebServerApplicationContext</code></li><li>å¦åˆ™, ä½¿ç”¨ <code>AnnotationConfigApplicationContext</code></li></ul><p>è¿™æ„å‘³ç€å¦‚æœæ‚¨åœ¨åŒä¸€ä¸ªåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨äº† Spring MVC å’Œ Spring WebFlux ä¸­çš„æ–° <code>WebClient</code>, é»˜è®¤æƒ…å†µä¸‹å°†ä½¿ç”¨ Spring MVC. æ‚¨å¯ä»¥é€šè¿‡è°ƒç”¨ <code>setWebApplicationType(WebApplicationType)</code> ä¿®æ”¹é»˜è®¤è¡Œä¸º.</p><p>ä¹Ÿå¯ä»¥è°ƒç”¨ <code>setApplicationContextClass(â€¦)</code> æ¥å®Œå…¨æ§åˆ¶ <code>ApplicationContext</code> ç±»å‹.</p><p>åœ¨ JUnit æµ‹è¯•ä¸­ä½¿ç”¨ <code>SpringApplication</code> æ—¶, é€šå¸¸éœ€è¦è°ƒç”¨ <code>setWebApplicationType(WebApplicationType.NONE)</code>.</p><h3 id="1-9-è®¿é—®åº”ç”¨ç¨‹åºå‚æ•°"><a href="#1-9-è®¿é—®åº”ç”¨ç¨‹åºå‚æ•°" class="headerlink" title="1.9. è®¿é—®åº”ç”¨ç¨‹åºå‚æ•°"></a>1.9. è®¿é—®åº”ç”¨ç¨‹åºå‚æ•°</h3><p>å¦‚æœæ‚¨éœ€è¦è®¿é—®ä» <code>SpringApplication.run(â€¦)</code> ä¼ å…¥çš„åº”ç”¨ç¨‹åºå‚æ•°, å¯ä»¥æ³¨å…¥ä¸€ä¸ª <code>org.springframework.boot.ApplicationArguments</code> bean. <code>ApplicationArguments</code> æ¥å£æä¾›äº†è®¿é—®åŸå§‹ <code>String[]</code> å‚æ•°ä»¥åŠè§£æåçš„ <code>option</code> å’Œ <code>non-option</code> å‚æ•°çš„æ–¹æ³•:</p><p>Java</p><p>Kotlin</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">@Componentpublic <span class="hljs-keyword">class</span> MyBean &#123;<br>    <span class="hljs-built_in">public</span> MyBean(ApplicationArguments args) &#123;        <span class="hljs-type">boolean</span> <span class="hljs-keyword">debug</span> = args.containsOption(&quot;debug&quot;);        List&lt;String&gt; files = args.getNonOptionArgs();        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">debug</span>) &#123;            <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(files);        &#125;        // <span class="hljs-keyword">if</span> run <span class="hljs-keyword">with</span> &quot;--debug logfile.txt&quot; prints [&quot;logfile.txt&quot;]    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>Spring Boot è¿˜å‘ Spring <code>Environment</code> æ³¨å†Œäº†ä¸€ä¸ª <code>CommandLinePropertySource</code>. è¿™å…è®¸æ‚¨å¯ä»¥ä½¿ç”¨ <code>@Value</code> æ³¨è§£æ³¨å…¥å•ä¸ªåº”ç”¨å‚æ•°.</p><h3 id="1-10-ä½¿ç”¨-ApplicationRunner-æˆ–-CommandLineRunner"><a href="#1-10-ä½¿ç”¨-ApplicationRunner-æˆ–-CommandLineRunner" class="headerlink" title="1.10. ä½¿ç”¨ ApplicationRunner æˆ– CommandLineRunner"></a>1.10. ä½¿ç”¨ ApplicationRunner æˆ– CommandLineRunner</h3><p>å¦‚æœæ‚¨éœ€è¦åœ¨ <code>SpringApplication</code> å¯åŠ¨æ—¶è¿è¡Œä¸€äº›ä»£ç , å¯ä»¥å®ç° <code>ApplicationRunner</code> æˆ–è€… <code>CommandLineRunner</code> æ¥å£. è¿™ä¸¤ä¸ªæ¥å£çš„å·¥ä½œæ–¹å¼æ˜¯ä¸€æ ·çš„, éƒ½æä¾›äº†ä¸€ä¸ªå•ç‹¬çš„ <code>run</code> æ–¹æ³•, å®ƒå°†åœ¨ <code>SpringApplication.run(â€¦)</code> å®Œæˆä¹‹å‰è°ƒç”¨.</p><p>è¿™ä¸ªå¥‘çº¦éå¸¸é€‚åˆé‚£äº›åº”è¯¥åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨åä½†åœ¨å®ƒå¼€å§‹æ¥å—æµé‡ä¹‹å‰è¿è¡Œçš„ä»»åŠ¡.</p><p><code>CommandLineRunner</code> æ¥å£æä¾›äº†è®¿é—®åº”ç”¨ç¨‹åºå­—ç¬¦ä¸²æ•°ç»„å½¢å¼å‚æ•°çš„æ–¹æ³•, è€Œ <code>ApplicationRunner</code> åˆ™ä½¿ç”¨äº†ä¸Šè¿°çš„ <code>ApplicationArguments</code> æ¥å£. ä»¥ä¸‹ç¤ºä¾‹å±•ç¤º <code>CommandLineRunner</code> å’Œ <code>run</code> æ–¹æ³•çš„ä½¿ç”¨:</p><p>Java</p><p>Kotlin</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Componentpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyCommandLineRunner</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">CommandLineRunner</span> &#123;<br>    <span class="hljs-meta">@Override</span>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">run</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>... args</span>) &#123;        <span class="hljs-comment">// Do something...    &#125;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœæ‚¨å®šä¹‰äº†å¤šä¸ª <code>CommandLineRunner</code> æˆ–è€… <code>ApplicationRunner</code> bean, åˆ™å¿…é¡»æŒ‡å®šè°ƒç”¨é¡ºåº, æ‚¨å¯ä»¥å®ç° <code>org.springframework.core.Ordered</code> æ¥å£, ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>org.springframework.core.annotation.Order</code> æ³¨è§£è§£å†³é¡ºåºé—®é¢˜.</p><h3 id="1-11-åº”ç”¨ç¨‹åºé€€å‡º"><a href="#1-11-åº”ç”¨ç¨‹åºé€€å‡º" class="headerlink" title="1.11. åº”ç”¨ç¨‹åºé€€å‡º"></a>1.11. åº”ç”¨ç¨‹åºé€€å‡º</h3><p>æ¯ä¸ª <code>SpringApplication</code> æ³¨å†Œäº†ä¸€ä¸ª JVM å…³é—­é’©å­, ä»¥ç¡®ä¿ <code>ApplicationContext</code> åœ¨é€€å‡ºæ—¶å¯ä»¥ä¼˜é›…å…³é—­. æ‰€æœ‰æ ‡å‡†çš„ Spring ç”Ÿå‘½å‘¨æœŸå›è°ƒ (æ¯”å¦‚ <code>DisposableBean</code> æ¥å£, æˆ–è€… <code>@PreDestroy</code> æ³¨è§£) éƒ½å¯ä»¥ä½¿ç”¨.</p><p>æ­¤å¤–, å¦‚æœå¸Œæœ›åœ¨è°ƒç”¨ <code>SpringApplication.exit()</code> æ—¶è¿”å›ç‰¹å®šçš„é€€å‡ºç , åˆ™ bean å¯ä»¥å®ç° <code>org.springframework.boot.ExitCodeGenerator</code> æ¥å£. ä¹‹åé€€å‡ºç å°†ä¼ é€’ç»™ <code>System.exit()</code> ä»¥å°†å…¶ä½œä¸ºçŠ¶æ€ç è¿”å›, å¦‚ç¤ºä¾‹æ‰€ç¤º:</p><p>Java</p><p>Kotlin</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">@SpringBootApplicationpublic class MyApplication &#123;<br>    @Bean    public ExitCodeGenerator exitCodeGenerator() &#123;        return () -&gt; <span class="hljs-number">42</span>;    &#125;<br>    public static void main(String[] args) &#123;        System.<span class="hljs-keyword">exit</span>(SpringApplication.<span class="hljs-keyword">exit</span>(SpringApplication.run(MyApplication.class, args)));    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ­¤å¤–, <code>ExitCodeGenerator</code> æ¥å£å¯ä»¥é€šè¿‡å¼‚å¸¸å®ç°. é‡åˆ°è¿™ç±»å¼‚å¸¸æ—¶, Spring Boot å°†è¿”å›å®ç°çš„ <code>getExitCode()</code> æ–¹æ³•æä¾›çš„é€€å‡ºç .</p><p>å¦‚æœæœ‰å¤šä¸ª <code>ExitCodeGenerator</code>ï¼Œåˆ™ä½¿ç”¨ç”Ÿæˆçš„ç¬¬ä¸€ä¸ªéé›¶é€€å‡ºä»£ç ã€‚ è¦æ§åˆ¶è°ƒç”¨ç”Ÿæˆå™¨çš„é¡ºåºï¼Œè¯·å¦å¤–å®ç° <code>org.springframework.core.Ordered</code> æ¥å£æˆ–ä½¿ç”¨ <code>org.springframework.core.annotation.Order</code> æ³¨è§£ã€‚</p><h3 id="1-12-Admin-Featuresï¼ˆç®¡ç†åŠŸèƒ½ï¼‰"><a href="#1-12-Admin-Featuresï¼ˆç®¡ç†åŠŸèƒ½ï¼‰" class="headerlink" title="1.12. Admin Featuresï¼ˆç®¡ç†åŠŸèƒ½ï¼‰"></a>1.12. Admin Featuresï¼ˆç®¡ç†åŠŸèƒ½ï¼‰</h3><p>å¯ä»¥é€šè¿‡æŒ‡å®š <code>spring.application.admin.enabled</code> å±æ€§æ¥ä¸ºåº”ç”¨ç¨‹åºå¯ç”¨ç®¡ç†ç›¸å…³çš„åŠŸèƒ½. å…¶å°†åœ¨ <code>MBeanServer</code> å¹³å°ä¸Šæš´éœ² <a href="https://github.com/spring-projects/spring-boot/tree/main/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/admin/SpringApplicationAdminMXBean.java"><code>SpringApplicationAdminMXBean</code></a>. æ‚¨å¯ä»¥ä½¿ç”¨æ­¤åŠŸèƒ½æ¥è¿œç¨‹ç®¡ç† Spring Boot åº”ç”¨. è¯¥åŠŸèƒ½å¯¹æœåŠ¡åŒ…è£…å™¨çš„å®ç°ä¹Ÿæ˜¯éå¸¸æœ‰ç”¨çš„.</p><p>å¦‚æœæ‚¨æƒ³çŸ¥é“åº”ç”¨ç¨‹åºåœ¨å“ªä¸€ä¸ª HTTP ç«¯å£ä¸Šè¿è¡Œ, è¯·ä½¿ç”¨ <code>local.server.port</code> é”®è·å–è¯¥å±æ€§.</p><h3 id="1-13-Application-Startup-trackingï¼ˆåº”ç”¨ç¨‹åºå¯åŠ¨è·Ÿè¸ªï¼‰"><a href="#1-13-Application-Startup-trackingï¼ˆåº”ç”¨ç¨‹åºå¯åŠ¨è·Ÿè¸ªï¼‰" class="headerlink" title="1.13. Application Startup trackingï¼ˆåº”ç”¨ç¨‹åºå¯åŠ¨è·Ÿè¸ªï¼‰"></a>1.13. Application Startup trackingï¼ˆåº”ç”¨ç¨‹åºå¯åŠ¨è·Ÿè¸ªï¼‰</h3><p>åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æœŸé—´ï¼Œ<code>SpringApplication</code> å’Œ <code>ApplicationContext</code> æ‰§è¡Œè®¸å¤šä¸åº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸã€bean ç”Ÿå‘½å‘¨æœŸç”šè‡³å¤„ç†åº”ç”¨ç¨‹åºäº‹ä»¶ç›¸å…³çš„ä»»åŠ¡. ä½¿ç”¨ <a href="https://docs.spring.io/spring-framework/docs/6.0.2/javadoc-api/org/springframework/core/metrics/ApplicationStartup.html"><code>ApplicationStartup</code></a>, Spring æ¡†æ¶å…è®¸ä½ ä½¿ç”¨ <a href="https://sca.aliyun.com/blog/learning/spring/core/ioc#context-functionality-startup"><code>StartupStep</code> å¯¹è±¡è·Ÿè¸ªåº”ç”¨ç¨‹åºçš„å¯åŠ¨é¡ºåº</a>. æ”¶é›†è¿™äº›æ•°æ®å¯ä»¥ç”¨äºåˆ†æç›®çš„ï¼Œæˆ–è€…åªæ˜¯ä¸ºäº†æ›´å¥½åœ°ç†è§£åº”ç”¨ç¨‹åºå¯åŠ¨è¿‡ç¨‹.</p><p>æ‚¨å¯ä»¥åœ¨è®¾ç½® <code>SpringApplication</code> å®ä¾‹æ—¶é€‰æ‹© <code>ApplicationStartup</code> å®ç°. ä¾‹å¦‚ï¼Œè¦ä½¿ç”¨ <code>BufferingApplicationStartup</code>ï¼Œæ‚¨å¯ä»¥ç¼–å†™:</p><p>Java</p><p>Kotlin</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@SpringBootApplicationpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyApplication</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) &#123;        <span class="hljs-title class_">SpringApplication</span> application = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpringApplication</span>(<span class="hljs-title class_">MyApplication</span>.<span class="hljs-property">class</span>);        application.<span class="hljs-title function_">setApplicationStartup</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferingApplicationStartup</span>(<span class="hljs-number">2048</span>));        application.<span class="hljs-title function_">run</span>(args);    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªå¯ç”¨çš„å®ç°æ˜¯ç”± Spring æ¡†æ¶æä¾›çš„ <code>FlightRecorderApplicationStartup</code>. å®ƒå°†ç‰¹å®šäº Spring çš„å¯åŠ¨äº‹ä»¶æ·»åŠ åˆ° Java Flight Recorder ä¼šè¯ä¸­ï¼Œç”¨äºåˆ†æåº”ç”¨ç¨‹åºï¼Œå¹¶å°†å…¶ Spring ä¸Šä¸‹æ–‡ç”Ÿå‘½å‘¨æœŸä¸ JVM äº‹ä»¶(å¦‚ allocationsã€gcã€ç±»åŠ è½½â€¦â€¦)å…³è”èµ·æ¥. ä¸€æ—¦é…ç½®å¥½ï¼Œä½ å°±å¯ä»¥é€šè¿‡å¯ç”¨ Flight Recorder è¿è¡Œåº”ç”¨ç¨‹åºæ¥è®°å½•æ•°æ®:</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-variable">$ </span>java -<span class="hljs-variable constant_">XX</span><span class="hljs-symbol">:StartFlightRecording</span><span class="hljs-symbol">:filename=recording</span>.jfr,duration=10s -jar demo.jar<br></code></pre></td></tr></table></figure><p>Spring Boot é™„å¸¦ <code>BufferingApplicationStartup</code> , è¿™ä¸ªå®ç°çš„ç›®çš„æ˜¯ç¼“å†²å¯åŠ¨æ­¥éª¤ï¼Œå¹¶å°†å®ƒä»¬æŠ½å–åˆ°å¤–éƒ¨æŒ‡æ ‡ç³»ç»Ÿä¸­. åº”ç”¨ç¨‹åºå¯ä»¥åœ¨ä»»ä½•ç»„ä»¶ä¸­è¯·æ±‚ <code>BufferingApplicationStartup</code> ç±»å‹çš„ bean. æ­¤å¤–ï¼ŒSpring Boot Actuator å°† <a href="https://docs.spring.io/spring-boot/docs/3.0.0/actuator-api/htmlsingle/#startup">å°†æš´éœ²ä¸€ä¸ª <code>startup</code> ç«¯ç‚¹ä»¥å°†æ­¤ä¿¡æ¯å…¬å¼€ä¸º JSON æ–‡æ¡£</a>.</p><h2 id="2-å¤–éƒ¨åŒ–é…ç½®"><a href="#2-å¤–éƒ¨åŒ–é…ç½®" class="headerlink" title="2. å¤–éƒ¨åŒ–é…ç½®"></a>2. å¤–éƒ¨åŒ–é…ç½®</h2><p>Spring Boot å¯ä»¥è®©æ‚¨çš„é…ç½®å¤–éƒ¨åŒ–, ä»¥ä¾¿å¯ä»¥åœ¨ä¸åŒç¯å¢ƒä¸­ä½¿ç”¨ç›¸åŒçš„åº”ç”¨ç¨‹åºä»£ç . æ‚¨å¯ä»¥ä½¿ç”¨å„ç§å¤–éƒ¨é…ç½®æº, åŒ…æ‹¬ Java properties æ–‡ä»¶ã€YAML æ–‡ä»¶ã€ç¯å¢ƒå˜é‡æˆ–è€…å‘½ä»¤è¡Œå‚æ•°.</p><p>å¯ä»¥ä½¿ç”¨ <code>@Value</code> æ³¨è§£å°†å±æ€§å€¼ç›´æ¥æ³¨å…¥åˆ° bean ä¸­, å¯é€šè¿‡ Spring çš„ <code>Environment</code> è®¿é—®, æˆ–è€…é€šè¿‡ <code>@ConfigurationProperties</code> <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.external-config.typesafe-configuration-properties">ç»‘å®šåˆ°ç»“æ„åŒ–å¯¹è±¡</a>.</p><p>Spring Boot ä½¿ç”¨äº†ä¸€ä¸ªéå¸¸ç‰¹åˆ«çš„ <code>PropertySource</code> æŒ‡ä»¤, ç”¨äºè¦†ç›–é»˜è®¤å€¼. å±æ€§å°†æŒ‰ç…§ä»¥ä¸‹é¡ºåºå¤„ç†(åé¢çš„å€¼è¦†ç›–å‰é¢çš„å€¼):</p><ol><li>é»˜è®¤å±æ€§ (é€šè¿‡è®¾ç½® <code>SpringApplication.setDefaultProperties</code> æŒ‡å®š).</li><li><code>@Configuration</code> ç±»ä¸Šçš„ <a href="https://docs.spring.io/spring-framework/docs/6.0.2/javadoc-api/org/springframework/context/annotation/PropertySource.html"><code>@PropertySource</code></a> æ³¨è§£. è¯·æ³¨æ„ï¼Œåœ¨åˆ·æ–°åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¹‹å‰ï¼Œä¸ä¼šå°†æ­¤ç±»å±æ€§æ·»åŠ åˆ° <code>Environment</code> ä¸­. è¿™æ—¶é…ç½®æŸäº›å±æ€§(å¦‚ <code>logging.*</code> and <code>spring.main.*</code>) å·²ç»å¤ªæ™šäº†. è¿™äº›å±æ€§åœ¨åˆ·æ–°å¼€å§‹ä¹‹å‰å°±å·²è¯»å–.</li><li>é…ç½®æ•°æ® (ä¾‹å¦‚ <code>application.properties</code> æ–‡ä»¶)</li><li>åªæœ‰ <code>random.*</code> å±æ€§çš„ <code>RandomValuePropertySource</code>.</li><li>æ“ä½œç³»ç»Ÿç¯å¢ƒå˜é‡.</li><li>Java System å±æ€§ (<code>System.getProperties()</code>).</li><li>æ¥è‡ª <code>java:comp/env</code> çš„ JNDI å±æ€§ .</li><li><code>ServletContext</code> åˆå§‹åŒ–å‚æ•°.</li><li><code>ServletConfig</code> åˆå§‹åŒ–å‚æ•°.</li><li>æ¥è‡ª <code>SPRING_APPLICATION_JSON</code> çš„å±æ€§ (åµŒå…¥åœ¨ç¯å¢ƒå˜é‡æˆ–è€…ç³»ç»Ÿå±æ€§ä¸­çš„å†…è” JSON) .</li><li>å‘½ä»¤è¡Œå‚æ•°.</li><li>æµ‹è¯•ä¸­çš„ <code>properties</code>.</li><li>åœ¨æµ‹è¯•ä¸­ä½¿ç”¨åˆ°çš„ <code>properties</code> å±æ€§, å¯ä»¥æ˜¯ <a href="https://docs.spring.io/spring-boot/docs/3.0.0/api/org/springframework/boot/test/context/SpringBootTest.html"><code>@SpringBootTest</code></a> å’Œ <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.testing.spring-boot-applications.autoconfigured-tests">ç”¨äºæµ‹è¯•åº”ç”¨ç¨‹åºæŸéƒ¨åˆ†çš„æµ‹è¯•æ³¨è§£</a>.</li><li>åœ¨æµ‹è¯•ä¸­ä½¿ç”¨åˆ°çš„ <a href="https://docs.spring.io/spring-framework/docs/6.0.2/javadoc-api/org/springframework/test/context/TestPropertySource.html"><code>@TestPropertySource</code></a> æ³¨è§£.</li><li>å½“ devtools è¢«æ¿€æ´», <code>$HOME/.config/spring-boot</code> ç›®å½•ä¸­çš„ <a href="https://sca.aliyun.com/learn/spring-boot/core/using.html#using.devtools.globalsettings">Devtools å…¨å±€è®¾ç½®å±æ€§</a>.</li></ol><p>é…ç½®æ•°æ®æ–‡ä»¶æŒ‰ä»¥ä¸‹é¡ºåºè¿›è¡Œï¼š</p><ol><li>åœ¨å·²æ‰“åŒ…çš„ jar å†…éƒ¨çš„ <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.external-config.files">Application properties</a> æ–‡ä»¶ (<code>application.properties</code> å’Œ YAML å˜é‡).</li><li>åœ¨å·²æ‰“åŒ…çš„ jar å†…éƒ¨çš„ <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.external-config.files.profile-specific">æŒ‡å®š profile çš„åº”ç”¨å±æ€§æ–‡ä»¶</a> (<code>application-&#123;profile&#125;.properties</code> å’Œ YAML å˜é‡).</li><li>åœ¨å·²æ‰“åŒ…çš„ jar å¤–éƒ¨çš„ <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.external-config.files">Application properties</a> æ–‡ä»¶ (<code>application.properties</code> å’Œ YAML å˜é‡).</li><li>åœ¨å·²æ‰“åŒ…çš„ jar å¤–éƒ¨çš„ <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.external-config.files.profile-specific">æŒ‡å®š profile çš„åº”ç”¨å±æ€§æ–‡ä»¶</a> (<code>application-&#123;profile&#125;.properties</code> å’Œ YAML å˜é‡).</li></ol><p>å»ºè®®æ‚¨åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­åšæŒä½¿ç”¨ä¸€ç§æ ¼å¼. å¦‚æœåœ¨ç›¸åŒçš„ä½ç½®æœ‰ <code>.properties</code> å’Œ <code>.yml</code> æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼Œåˆ™ <code>.properties</code> ä¼˜å…ˆ.</p><p>ä¸¾ä¸ªä¾‹å­, å‡è®¾å¼€å‘çš„ <code>@Component</code> ä½¿ç”¨äº† <code>name</code> å±æ€§, å¯ä»¥è¿™æ ·:</p><p>Java</p><p>Kotlin</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@Componentpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyBean</span> &#123;<br>    <span class="hljs-meta">@Value(<span class="hljs-string">&quot;<span class="hljs-subst">$&#123;name&#125;</span>&quot;</span>)</span>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨æ‚¨çš„åº”ç”¨ç¨‹åºçš„ classpath ä¸­ (æ¯”å¦‚åœ¨ jar ä¸­) , æ‚¨å¯ä»¥æœ‰ä¸€ä¸ª <code>application.properties</code>, å®ƒä¸º name æä¾›äº†ä¸€ä¸ªåˆé€‚çš„é»˜è®¤å±æ€§å€¼. å½“åœ¨æ–°ç¯å¢ƒä¸­è¿è¡Œæ—¶, æ‚¨å¯ä»¥åœ¨ jar å¤–é¢æä¾›ä¸€ä¸ª <code>application.properties</code> æ¥è¦†ç›– <code>name</code>. å¯¹äºä¸€æ¬¡æ€§æµ‹è¯•, æ‚¨å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡ŒæŒ‡å®šå½¢å¼å¯åŠ¨ (æ¯”å¦‚ <code>java -jar app.jar --name=&quot;Spring&quot;</code>) .</p><p><code>env</code> å’Œ <code>configprops</code> ç«¯ç‚¹åœ¨ç¡®å®šå±æ€§çš„ç‰¹å®šå€¼æ—¶å¾ˆæœ‰ç”¨. æ‚¨å¯ä»¥ä½¿ç”¨è¿™ä¸¤ä¸ªç«¯ç‚¹æ¥è¯Šæ–­æ„å¤–çš„å±æ€§å€¼. æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œ è¯·å‚è§ â€œ<a href="https://sca.aliyun.com/learn/spring-boot/core/actuator.html#actuator.endpoints">ç”Ÿäº§å°±ç»ª</a>â€ éƒ¨åˆ†.</p><h3 id="2-1-è®¿é—®å‘½ä»¤è¡Œå±æ€§"><a href="#2-1-è®¿é—®å‘½ä»¤è¡Œå±æ€§" class="headerlink" title="2.1. è®¿é—®å‘½ä»¤è¡Œå±æ€§"></a>2.1. è®¿é—®å‘½ä»¤è¡Œå±æ€§</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>SpringApplication</code> å°†ä»»ä½•å‘½ä»¤è¡Œé€‰é¡¹å‚æ•°(å³ä»¥ <code>--</code> å¼€å¤´çš„å‚æ•°ï¼Œä¾‹å¦‚ <code>--server.port=9000</code> )è½¬æ¢ä¸ºå±æ€§ï¼Œå¹¶å°†å®ƒä»¬æ·»åŠ åˆ° Spring <code>Environment</code> ä¸­. å¦‚å‰æ‰€è¿°ï¼Œå‘½ä»¤è¡Œå±æ€§æ€»æ˜¯ä¼˜å…ˆäºåŸºäºæ–‡ä»¶çš„å±æ€§.</p><p>å¦‚æœä¸å¸Œæœ›å°†å‘½ä»¤è¡Œå±æ€§æ·»åŠ åˆ° <code>Environment</code> ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <code>SpringApplication.setAddCommandLineProperties(false)</code> ç¦ç”¨å®ƒä»¬.</p><h3 id="2-2-JSON-åº”ç”¨ç¨‹åºå±æ€§"><a href="#2-2-JSON-åº”ç”¨ç¨‹åºå±æ€§" class="headerlink" title="2.2. JSON åº”ç”¨ç¨‹åºå±æ€§"></a>2.2. JSON åº”ç”¨ç¨‹åºå±æ€§</h3><p>ç¯å¢ƒå˜é‡å’Œç³»ç»Ÿå±æ€§é€šå¸¸æœ‰é™åˆ¶ï¼Œè¿™æ„å‘³ç€æŸäº›å±æ€§åä¸èƒ½ä½¿ç”¨. ä¸ºäº†å¸®åŠ©å®ç°è¿™ä¸€ç‚¹ï¼ŒSpring Boot å…è®¸æ‚¨å°†å±æ€§å—ç¼–ç åˆ°å•ä¸ª JSON ç»“æ„ä¸­.</p><p>å½“åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ï¼Œä»»ä½• <code>spring.application.json</code> æˆ– <code>SPRING_APPLICATION_JSON</code> å±æ€§éƒ½å°†è¢«è§£æå¹¶æ·»åŠ åˆ° <code>Environment</code> ä¸­.</p><p>ä¾‹å¦‚ï¼Œ<code>SPRING_APPLICATION_JSON</code> å±æ€§å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­æä¾›ä¸€ä¸ªç¯å¢ƒå˜é‡. æ¯”å¦‚åœ¨ UN*X shell ä¸­:</p><figure class="highlight scilab"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scilab">$ SPRING_APPLICATION_JSON=<span class="hljs-string">&#x27;&#123;&quot;</span>my<span class="hljs-string">&quot;:&#123;&quot;</span>name<span class="hljs-string">&quot;:&quot;</span>test<span class="hljs-string">&quot;&#125;&#125;&#x27;</span> java -jar myapp.jar<br></code></pre></td></tr></table></figure><p>åœ¨æ­¤ç¤ºä¾‹ä¸­, æ‚¨å¯ä»¥åœ¨ Spring <code>Environment</code> ä¸­ä½¿ç”¨ <code>my.name=test</code>ã€‚</p><p>åŒæ ·çš„ JSON ä¹Ÿå¯ä»¥ä½œä¸ºç³»ç»Ÿå±æ€§æä¾›:</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">$ java -Dspring.<span class="hljs-built_in">application</span>.json=&#x27;&#123;<span class="hljs-string">&quot;my&quot;</span>:&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;test&quot;</span>&#125;&#125;&#x27; -jar myapp.jar<br></code></pre></td></tr></table></figure><p>æˆ–è€…æ‚¨å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°æä¾› JSON:</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">$ java -jar myapp.jar <span class="hljs-params">--spring</span>.application.json=&#x27;&#123;<span class="hljs-string">&quot;my&quot;</span>:&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;test&quot;</span>&#125;&#125;&#x27;<br></code></pre></td></tr></table></figure><p>å¦‚æœæ‚¨æ­£åœ¨éƒ¨ç½²åˆ°ä¸€ä¸ªç»å…¸çš„åº”ç”¨ç¨‹åºæœåŠ¡å™¨ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨åä¸º <code>java:comp/env/spring.application.json</code> çš„ JNDI å˜é‡.</p><p>å°½ç®¡ JSON ä¸­çš„ <code>null</code> è¢«æ·»åŠ åˆ°ç»“æœå±æ€§é›†ä¸­, ä½† <code>PropertySourcesPropertyResolver</code> å°† <code>null</code> å±æ€§è§†ä¸ºç¼ºå¤±å€¼. è¿™æ„å‘³ç€ JSON æ— æ³•ä½¿ç”¨ <code>null</code> è¦†ç›–åœ¨å±æ€§é›†ä¸­å…·æœ‰ä½ä¼˜å…ˆçº§çš„å±æ€§.</p><h3 id="2-3-å¤–éƒ¨åº”ç”¨ç¨‹åºå±æ€§"><a href="#2-3-å¤–éƒ¨åº”ç”¨ç¨‹åºå±æ€§" class="headerlink" title="2.3. å¤–éƒ¨åº”ç”¨ç¨‹åºå±æ€§"></a>2.3. å¤–éƒ¨åº”ç”¨ç¨‹åºå±æ€§</h3><p>åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ï¼ŒSpring Boot å°†è‡ªåŠ¨ä»ä»¥ä¸‹ä½ç½®æŸ¥æ‰¾å¹¶åŠ è½½ <code>application.properties</code> å’Œ <code>application.yaml</code> æ–‡ä»¶:</p><ol><li>ä» classpath<ol><li>classpath æ ¹ç›®å½•</li><li>classpath ä¸Šçš„ <code>/config</code> åŒ…</li></ol></li><li>ä»å½“å‰ç›®å½•<ol><li>å½“å‰ç›®å½•</li><li>å½“å‰ç›®å½•ä¸‹çš„ <code>config/</code> å­ç›®å½•</li><li><code>config/</code> å­ç›®å½•çš„ç›´æ¥å­ç›®å½•</li></ol></li></ol><p>è¯¥åˆ—è¡¨æŒ‰ä¼˜å…ˆçº§æ’åº(è¾ƒä½é¡¹çš„å€¼è¦†ç›–è¾ƒæ—©é¡¹çš„å€¼). åŠ è½½æ–‡ä»¶ä¸­çš„æ–‡æ¡£ä½œä¸º <code>PropertySources</code> æ·»åŠ åˆ° Spring <code>Environment</code> ä¸­.</p><p>å¦‚æœæ‚¨ä¸å–œæ¬¢ <code>application.properties</code> ä½œä¸ºé…ç½®æ–‡ä»¶å, åˆ™å¯ä»¥é€šè¿‡æŒ‡å®š <code>spring.config.name</code> ç¯å¢ƒå±æ€§æ¥åˆ‡æ¢åˆ°å¦ä¸€ä¸ªæ–‡ä»¶å.</p><p>ä¾‹å¦‚ï¼Œè¦æŸ¥æ‰¾ <code>myproject.properties</code> å’Œ <code>myproject.yaml</code> æ–‡ä»¶ï¼Œæ‚¨å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼è¿è¡Œåº”ç”¨ç¨‹åºï¼š</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">$ <span class="hljs-keyword">java </span>-<span class="hljs-keyword">jar </span>myproject.<span class="hljs-keyword">jar </span>--spring.config.name=myproject<br></code></pre></td></tr></table></figure><p>æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ <code>spring.config.location</code> ç¯å¢ƒå±æ€§æ¥æ˜¾å¼å¼•ç”¨ä¸€ä¸ªä½ç½® (ä»¥é€—å·åˆ†éš”çš„ç›®å½•ä½ç½®æˆ–æ–‡ä»¶è·¯å¾„åˆ—è¡¨) .</p><p>ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•æŒ‡å®šä¸¤ä¸ªä½ç½®:</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs arduino">$ java -jar myproject.jar --spring.config.location=\<br><br>    optional:classpath:/<span class="hljs-keyword">default</span>.properties,\<br><br>    optional:classpath:/<span class="hljs-keyword">override</span>.properties<br></code></pre></td></tr></table></figure><p>å¦‚æœ <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.external-config.files.optional-prefix">locations are optional</a>ï¼Œå¯ä»¥ä½¿ç”¨å‰ç¼€ <code>optional:</code> ï¼Œå¹¶ä¸”æ‚¨ä¸ä»‹æ„å®ƒä»¬æ˜¯å¦å­˜åœ¨.</p><p><code>spring.config.name</code> <code>spring.config.location</code> å’Œ <code>spring.config.additional-location</code> åœ¨ç¨‹åºå¯åŠ¨æ—©æœŸå°±ç”¨æ¥ç¡®å®šå“ªäº›æ–‡ä»¶å¿…é¡»åŠ è½½. å®ƒä»¬å¿…é¡»å®šä¹‰ä¸ºä¸€ä¸ªç¯å¢ƒå±æ€§(é€šå¸¸æ˜¯ä¸€ä¸ª OS ç¯å¢ƒå˜é‡ã€ä¸€ä¸ªç³»ç»Ÿå±æ€§æˆ–ä¸€ä¸ªå‘½ä»¤è¡Œå‚æ•°).</p><p>å¦‚æœ <code>spring.config.location</code> åŒ…å«ç›®å½• (è€Œä¸æ˜¯æ–‡ä»¶) , åˆ™å®ƒä»¬åº”è¯¥ä»¥ <code>/</code> ç»“å°¾ã€‚åœ¨è¿è¡Œæ—¶ï¼Œåœ¨åŠ è½½ä¹‹å‰è¿½åŠ ä» <code>spring.config.name</code> ç”Ÿæˆçš„åç§°. <code>spring.config.location</code> ä¸­æŒ‡å®šçš„æ–‡ä»¶ç›´æ¥å¯¼å…¥.</p><p>ç›®å½•å’Œæ–‡ä»¶çš„ä½ç½®å€¼ä¹Ÿè¢«æ‰©å±•ä¸ºæ£€æŸ¥ <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.external-config.files.profile-specific">profile-specific files</a>. ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æœ‰ä¸€ä¸ª <code>classpath:myconfig.properties</code> çš„ <code>spring.config.location</code>ï¼Œæ‚¨è¿˜ä¼šå‘ç°åŠ è½½äº†ç›¸åº”çš„ <code>classpath:myconfig-&lt;profile&gt;.properties</code> æ–‡ä»¶ã€‚</p><p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ‚¨æ·»åŠ çš„æ¯ä¸ª <code>spring.config.location</code> é¡¹éƒ½å°†å¼•ç”¨å•ä¸ªæ–‡ä»¶æˆ–ç›®å½•ã€‚ ä½ç½®æŒ‰ç…§å®šä¹‰çš„é¡ºåºè¿›è¡Œå¤„ç†ï¼Œåé¢çš„ locations å¯ä»¥è¦†ç›–å‰é¢çš„ locations.</p><p>å¦‚æœæ‚¨æœ‰ä¸€ä¸ªå¤æ‚çš„ä½ç½®è®¾ç½®ï¼Œå¹¶ä¸”æ‚¨ä½¿ç”¨ç‰¹å®šäºé…ç½®æ–‡ä»¶çš„é…ç½®æ–‡ä»¶ï¼Œæ‚¨å¯èƒ½éœ€è¦æä¾›è¿›ä¸€æ­¥çš„æç¤ºï¼Œä»¥ä¾¿ Spring Boot çŸ¥é“åº”è¯¥å¦‚ä½•å¯¹å®ƒä»¬è¿›è¡Œåˆ†ç»„.</p><p>location ç»„æ˜¯æ‰€æœ‰è¢«è§†ä¸ºåŒä¸€çº§åˆ«çš„ location çš„é›†åˆã€‚ ä¾‹å¦‚ï¼Œæ‚¨å¯èƒ½å¸Œæœ›å¯¹æ‰€æœ‰ç±»è·¯å¾„ä½ç½®è¿›è¡Œåˆ†ç»„ï¼Œç„¶åå¯¹æ‰€æœ‰å¤–éƒ¨ä½ç½®è¿›è¡Œåˆ†ç»„ã€‚location ç»„ä¸­çš„åº”ä½¿ç”¨ <code>;</code> åˆ†éš”ã€‚</p><p>æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… â€œ<a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.external-config.files.profile-specific">ç‰¹å®š Profile çš„å±æ€§æ–‡ä»¶</a>â€ éƒ¨åˆ†ä¸­çš„ç¤ºä¾‹.</p><p>å½“ä½¿ç”¨äº† <code>spring.config.location</code> é…ç½®è‡ªå®šä¹‰é…ç½®ä½ç½®æ—¶, é»˜è®¤ä½ç½®é…ç½®å°†è¢«æ›¿ä»£. ä¾‹å¦‚ï¼Œå¦‚æœ <code>spring.config.location</code> é…ç½®ä¸º <code>optional:classpath:/custom-config/,optional:file:./custom-config/</code> æ—¶ï¼Œå®Œæ•´ä½ç½®é›†æ˜¯:</p><ol><li><code>optional:classpath:custom-config/</code></li><li><code>optional:file:./custom-config/</code></li></ol><p>æˆ–è€…, å½“ä½¿ç”¨ <code>spring.config.additional-location</code> é…ç½®è‡ªå®šä¹‰é…ç½®ä½ç½®æ—¶, é™¤äº†ä½¿ç”¨é»˜è®¤ä½ç½®å¤–, è¿˜ä¼šä½¿ç”¨å®ƒä»¬. ä¾‹å¦‚ï¼Œå¦‚æœ <code>spring.config.additional-location</code> é…ç½®ä¸º <code>optional:classpath:/custom-config/,optional:file:./custom-config/</code>ï¼Œå®Œæ•´ä½ç½®é›†æ˜¯:</p><ol><li><code>optional:classpath:/;optional:classpath:/config/</code></li><li><code>optional:file:./;optional:file:./config/;optional:file:./config/*/</code></li><li><code>optional:classpath:custom-config/</code></li><li><code>optional:file:./custom-config/</code></li></ol><p>è¯¥æœç´¢é¡ºåºå…è®¸æ‚¨åœ¨ä¸€ä¸ªé…ç½®æ–‡ä»¶ä¸­æŒ‡å®šé»˜è®¤å€¼, ç„¶åæœ‰é€‰æ‹©åœ°è¦†ç›–å¦ä¸€ä¸ªé…ç½®æ–‡ä»¶ä¸­çš„å€¼. æ‚¨å¯ä»¥åœ¨ <code>application.properties</code> (æˆ–æ‚¨ä½¿ç”¨ <code>spring.config.name</code> æŒ‡å®šçš„å…¶ä»–æ–‡ä»¶) ä¸­çš„æŸä¸ªé»˜è®¤ä½ç½®ä¸ºåº”ç”¨ç¨‹åºæä¾›é»˜è®¤å€¼. ä¹‹å, åœ¨è¿è¡Œæ—¶, è¿™äº›é»˜è®¤å€¼å°†è¢«è‡ªå®šä¹‰ä½ç½®ä¸­çš„æŸä¸ªæ–‡ä»¶æ‰€è¦†ç›–.</p><p>å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ç¯å¢ƒå˜é‡è€Œä¸æ˜¯ç³»ç»Ÿå±æ€§, å¤§éƒ¨åˆ†æ“ä½œç³»ç»Ÿéƒ½ä¸å…è®¸ä½¿ç”¨ . åˆ†éš”çš„é”®å, ä½†æ‚¨å¯ä»¥ä½¿ç”¨ä¸‹åˆ’çº¿æ¥ä»£æ›¿ (ä¾‹å¦‚, ä½¿ç”¨ <code>SPRING_CONFIG_NAME</code> è€Œä¸æ˜¯ <code>spring.config.name</code>) .æŸ¥çœ‹ <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.external-config.typesafe-configuration-properties.relaxed-binding.environment-variables">ä»ç¯å¢ƒå˜é‡ç»‘å®š</a> è·å–æ›´å¤šç»†èŠ‚ä¿¡æ¯.</p><p>å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºè¿è¡Œåœ¨ servlet å®¹å™¨æˆ–åº”ç”¨æœåŠ¡å™¨ä¸­, åˆ™å¯ä»¥ä½¿ç”¨ JNDI å±æ€§ (<code>java:comp/env</code>) æˆ– servlet ä¸Šä¸‹æ–‡åˆå§‹åŒ–å‚æ•°æ¥ä»£æ›¿ç¯å¢ƒå˜é‡æˆ–ç³»ç»Ÿå±æ€§.</p><h4 id="2-3-1-Optional-Locationsï¼ˆå¯é€‰ä½ç½®ï¼‰"><a href="#2-3-1-Optional-Locationsï¼ˆå¯é€‰ä½ç½®ï¼‰" class="headerlink" title="2.3.1. Optional Locationsï¼ˆå¯é€‰ä½ç½®ï¼‰"></a>2.3.1. Optional Locationsï¼ˆå¯é€‰ä½ç½®ï¼‰</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“æŒ‡å®šçš„é…ç½®æ•°æ®ä½ç½®ä¸å­˜åœ¨æ—¶ï¼ŒSpring Boot å°†æŠ›å‡º <code>ConfigDataLocationNotFoundException</code> å¹¶ä¸”æ‚¨çš„åº”ç”¨ç¨‹åºå°†ä¸ä¼šå¯åŠ¨.</p><p>å¦‚æœæ‚¨æƒ³æŒ‡å®šä¸€ä¸ªä½ç½®ï¼Œä½†ä»–æœ‰å¯èƒ½ä¸å­˜åœ¨ï¼Œè¿™æ—¶ï¼Œæ‚¨å¯ä»¥åœ¨ <code>spring.config.location</code> å’Œ <code>spring.config.additional-location</code> å±æ€§ä¸­ä½¿ç”¨ <code>optional:</code> å‰ç¼€ï¼Œä»¥åŠ <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.external-config.files.importing"><code>spring.config.import</code></a> å£°æ˜.</p><p>ä¾‹å¦‚ï¼Œå½“ <code>spring.config.import</code> çš„å€¼ä¸º <code>optional:file:./myconfig.properties</code> æ—¶. å…è®¸æ‚¨çš„åº”ç”¨ç¨‹åºå¯åŠ¨ï¼Œå³ä½¿ <code>myconfig.properties</code> æ–‡ä»¶ä¸¢å¤±.</p><p>å¦‚æœä½ æƒ³å¿½ç•¥æ‰€æœ‰çš„ <code>ConfigDataLocationNotFoundExceptions</code> è€Œæ€»æ˜¯ç»§ç»­å¯åŠ¨ä½ çš„åº”ç”¨ç¨‹åºï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>spring.config.on-not-found</code> å±æ€§. ä½¿ç”¨ <code>SpringApplication.setDefaultProperties(â€¦)</code> æˆ–ä½¿ç”¨ç³»ç»Ÿ&#x2F;ç¯å¢ƒå˜é‡å°†è¯¥å€¼è®¾ç½®ä¸º <code>ignore</code>.</p><h4 id="2-3-2-Wildcard-Locationsï¼ˆé€šé…ç¬¦ä½ç½®ï¼‰"><a href="#2-3-2-Wildcard-Locationsï¼ˆé€šé…ç¬¦ä½ç½®ï¼‰" class="headerlink" title="2.3.2. Wildcard Locationsï¼ˆé€šé…ç¬¦ä½ç½®ï¼‰"></a>2.3.2. Wildcard Locationsï¼ˆé€šé…ç¬¦ä½ç½®ï¼‰</h4><p>å¦‚æœé…ç½®æ–‡ä»¶çš„ä½ç½®åŒ…å«æœ€åä¸€ä¸ªè·¯å¾„æ®µçš„ <code>*</code> ï¼Œåˆ™å°†å…¶è§†ä¸ºé€šé…ç¬¦ä½ç½®. åŠ è½½é…ç½®æ—¶ï¼Œé€šé…ç¬¦ä¼šæ‰©å±•ï¼Œä»¥ä¾¿æ£€æŸ¥å­ç›®å½•. å½“å­˜åœ¨å¤šä¸ªé…ç½®å±æ€§æºæ—¶, é€šé…ç¬¦ä½ç½®åœ¨è¯¸å¦‚ Kubernetes ä¹‹ç±»çš„ç¯å¢ƒä¸­ç‰¹åˆ«æœ‰ç”¨.</p><p>ä¾‹å¦‚, å¦‚æœæ‚¨æœ‰ä¸€äº› Redis é…ç½®å’ŒæŸäº› MySQL é…ç½®, åˆ™å¯èƒ½å¸Œæœ›å°†è¿™ä¸¤ä¸ªé…ç½®åˆ†å¼€, åŒæ—¶è¦æ±‚è¿™ä¸¤ä¸ªé…ç½®éƒ½å­˜åœ¨äºè¯¥åº”ç”¨ç¨‹åºå¯ä»¥ç»‘å®šåˆ°çš„ <code>application.properties</code> ä¸­. è¿™å¯èƒ½ä¼šå¯¼è‡´ä¸¤ä¸ªå•ç‹¬çš„ <code>application.properties</code> æ–‡ä»¶å®‰è£…åœ¨ä¸åŒçš„ä½ç½®, ä¾‹å¦‚ <code>/config/redis/application.properties</code> å’Œ <code>/config/mysql/application.properties</code>. åœ¨è¿™ç§æƒ…å†µä¸‹, å½“é€šé…ç¬¦ä½ç½®ä¸º <code>config/*/</code> å°†å¯¼è‡´ä¸¤ä¸ªæ–‡ä»¶éƒ½è¢«å¤„ç†.</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Boot æœç´¢çš„ä½ç½®ä¸­åŒ…å« <code>config/*/</code>. è¿™æ„å‘³ç€å°†æœç´¢ jar ä¹‹å¤– <code>/config</code> ç›®å½•çš„æ‰€æœ‰å­ç›®å½•.</p><p>æ‚¨å¯ä»¥ä½¿ç”¨ <code>spring.config.location</code> å’Œ <code>spring.config.additional-location</code> å±æ€§æŒ‡å®šé€šé…ç¬¦ä½ç½®.</p><p>é€šé…ç¬¦ä½ç½®å¿…é¡»ä»…åŒ…å«ä¸€ä¸ª <code>*</code> å¹¶ä»¥ <code>*/</code> ç»“å°¾ (å¯¹äºç›®å½•çš„æœç´¢ä½ç½®) æˆ– <code>*/&lt;filename&gt;</code> (å¯¹äºæ–‡ä»¶çš„æœç´¢ä½ç½®) .å¸¦é€šé…ç¬¦çš„ä½ç½®æ ¹æ®æ–‡ä»¶åçš„ç»å¯¹è·¯å¾„æŒ‰å­—æ¯é¡ºåºæ’åº.</p><p>é€šé…ç¬¦ä½ç½®ä»…é€‚ç”¨äºå¤–éƒ¨ç›®å½•. æ‚¨ä¸èƒ½åœ¨ <code>classpath:</code> ä½ç½®ä¸­ä½¿ç”¨é€šé…ç¬¦.</p><h4 id="2-3-3-ç‰¹å®š-Profile-çš„å±æ€§æ–‡ä»¶"><a href="#2-3-3-ç‰¹å®š-Profile-çš„å±æ€§æ–‡ä»¶" class="headerlink" title="2.3.3. ç‰¹å®š Profile çš„å±æ€§æ–‡ä»¶"></a>2.3.3. ç‰¹å®š Profile çš„å±æ€§æ–‡ä»¶</h4><p>é™¤ <code>application.properties</code> æ–‡ä»¶å¤–, è¿˜å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½åçº¦å®šå®šä¹‰ç‰¹å®š profile çš„å±æ€§æ–‡ä»¶: <code>application-&#123;profile&#125;</code>. ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºæ¿€æ´»äº†ä¸€ä¸ªåä¸º <code>prod</code> çš„ profile æ–‡ä»¶å¹¶ä½¿ç”¨ YAML æ–‡ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ª <code>application.yml</code> å’Œ <code>application-prod.yml</code> å°†è¢«åŠ è½½.</p><p>ç‰¹å®š profile çš„å±æ€§æ–‡ä»¶ä»ä¸æ ‡å‡† <code>application.properties</code> ç›¸åŒçš„ä½ç½®åŠ è½½, ç‰¹å®š profile çš„å±æ€§æ–‡ä»¶å§‹ç»ˆè¦†ç›–éç‰¹å®šæ–‡ä»¶. å¦‚æœæŒ‡å®šäº†å¤šä¸ªé…ç½®æ–‡ä»¶ï¼Œåˆ™åº”ç”¨ last-wins ç­–ç•¥ (ä¼˜å…ˆé‡‡å–æœ€åä¸€ä¸ª) .ä¾‹å¦‚ï¼Œå¦‚æœ ç”± <code>spring.profiles.active</code> æŒ‡å®š <code>prod,live</code> profiles , <code>application-prod.properties</code> ä¸­çš„å±æ€§å€¼å°†è¢« <code>application-live.properties</code> ä¸­çš„å€¼è¦†ç›–</p><p>æœ€åè·èƒœç­–ç•¥é€‚ç”¨äº <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.external-config.files.location-groups">location group</a> çº§åˆ«ã€‚ <code>spring.config.location</code> ä¸º <code>classpath:/cfg/,classpath:/ext/</code> ä¸ä¼šå…·æœ‰ä¸ <code>classpath:/cfg/;classpath:/ext/</code> ç›¸åŒçš„è¦†ç›–è§„åˆ™</p><p>ä¾‹å¦‚ï¼Œç»§ç»­ä¸Šé¢çš„ <code>prod,live</code> ç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯èƒ½æœ‰ä»¥ä¸‹æ–‡ä»¶:</p><p>&#x2F;cfg application-live.properties &#x2F;ext application-live.properties application-prod.properties</p><p>å½“ <code>spring.config.location</code> ä¸º <code>classpath:/cfg/,classpath:/ext/</code> æ—¶ï¼Œæˆ‘ä»¬ä¼šåœ¨æ‰€æœ‰ <code>/ext</code> æ–‡ä»¶ä¹‹å‰å¤„ç†æ‰€æœ‰ <code>/cfg</code> æ–‡ä»¶ï¼š:</p><ol><li><code>/cfg/application-live.properties</code></li><li><code>/ext/application-prod.properties</code></li><li><code>/ext/application-live.properties</code></li></ol><p>å½“æˆ‘ä»¬ä½¿ç”¨ <code>classpath:/cfg/;classpath:/ext/</code> ä»£æ›¿ï¼ˆä½¿ç”¨ <code>;</code> åˆ†éš”ç¬¦ï¼‰æ—¶ï¼Œæˆ‘ä»¬åœ¨åŒä¸€çº§åˆ«å¤„ç† <code>/cfg</code> å’Œ <code>/ext</code>ï¼š</p><ol><li><code>/ext/application-prod.properties</code></li><li><code>/cfg/application-live.properties</code></li><li><code>/ext/application-live.properties</code></li></ol><p>Environment æœ‰ä¸€ç»„é»˜è®¤é…ç½®æ–‡ä»¶ (é»˜è®¤æƒ…å†µä¸‹ä¸º <code>[default]</code>) , å¦‚æœæœªè®¾ç½®æ¿€æ´»çš„ (active) profile, åˆ™ä½¿ç”¨è¿™äº›é…ç½®æ–‡ä»¶. æ¢å¥è¯è¯´, å¦‚æœæ²¡æœ‰æ˜¾å¼æ¿€æ´» profile, åˆ™ä¼šåŠ è½½ <code>application-default</code> ä¸­çš„å±æ€§.</p><p>NOTE: å±æ€§æ–‡ä»¶åªåŠ è½½ä¸€æ¬¡. å¦‚æœæ‚¨å·²ç»ç›´æ¥ <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.external-config.files.importing">imported</a> äº†ç‰¹å®šäºé…ç½®æ–‡ä»¶çš„å±æ€§æ–‡ä»¶ï¼Œé‚£ä¹ˆå®ƒå°†ä¸ä¼šè¢«å†æ¬¡å¯¼å…¥.</p><h4 id="2-3-4-å¯¼å…¥å…¶ä»–æ•°æ®"><a href="#2-3-4-å¯¼å…¥å…¶ä»–æ•°æ®" class="headerlink" title="2.3.4. å¯¼å…¥å…¶ä»–æ•°æ®"></a>2.3.4. å¯¼å…¥å…¶ä»–æ•°æ®</h4><p>åº”ç”¨ç¨‹åºå±æ€§å¯ä»¥ä½¿ç”¨ <code>Spring.config.import</code> å±æ€§å¯¼å…¥æ¥è‡ªå…¶ä»–ä½ç½®çš„å…¶ä»–é…ç½®æ•°æ®. å¯¼å…¥æ˜¯åœ¨å‘ç°å®ƒä»¬æ—¶è¿›è¡Œå¤„ç†çš„ï¼Œå¹¶ä¸”è¢«è§†ä¸ºç›´æ¥æ’å…¥åœ¨å£°æ˜å¯¼å…¥çš„æ–‡æ¡£ä¸‹é¢çš„é™„åŠ æ–‡æ¡£.</p><p>ä¾‹å¦‚ï¼Œæ‚¨çš„ ClassPath <code>application.properties</code> æ–‡ä»¶ä¸­å¯èƒ½å…·æœ‰ä»¥ä¸‹å†…å®¹:</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">spring:</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">  application:</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">    name:</span> <span class="hljs-string">&quot;myapp&quot;</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">  config:</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">    import:</span> <span class="hljs-string">&quot;optional:file:./dev.properties&quot;</span><br></code></pre></td></tr></table></figure><p>è¿™å°†è§¦å‘å½“å‰ç›®å½•ä¸­ <code>dev.properties</code> æ–‡ä»¶çš„å¯¼å…¥(å¦‚æœå­˜åœ¨è¿™æ ·çš„æ–‡ä»¶). å¯¼å…¥çš„ <code>dev.properties</code> ä¸­çš„å€¼å°†ä¼˜å…ˆäºè§¦å‘å¯¼å…¥çš„æ–‡ä»¶. åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ<code>dev.properties</code> å¯ä»¥å°† <code>spring.application.name</code> é‡å®šä¹‰ä¸ºä¸åŒçš„å€¼.</p><p>æ— è®ºå£°æ˜äº†å¤šå°‘æ¬¡ï¼Œå¯¼å…¥éƒ½åªä¼šè¢«å¯¼å…¥ä¸€æ¬¡. åœ¨ properties&#x2F;yaml æ–‡ä»¶ä¸­çš„å•ä¸ªæ–‡æ¡£ä¸­å®šä¹‰å¯¼å…¥çš„é¡ºåºå¹¶ä¸é‡è¦. ä¾‹å¦‚ï¼Œä¸‹é¢ä¸¤ä¸ªä¾‹å­äº§ç”Ÿç›¸åŒçš„ç»“æœ:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">spring: <br>config:  <br><span class="hljs-keyword">import</span>: <span class="hljs-string">&quot;my.properties&quot;</span>my:  property: <span class="hljs-string">&quot;value&quot;</span><br>my:  property: <span class="hljs-string">&quot;value&quot;</span>spring:  config:    <span class="hljs-keyword">import</span>: <span class="hljs-string">&quot;my.properties&quot;</span><br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°ä¸¤ä¸ªç¤ºä¾‹ä¸­ï¼Œæ¥è‡ª <code>my.properties</code> æ–‡ä»¶çš„å€¼å°†ä¼˜å…ˆäºè§¦å‘å…¶å¯¼å…¥çš„æ–‡ä»¶.</p><p>å¯ä»¥åœ¨å•ä¸ª <code>spring.config.import</code> key æŒ‡å®šå¤šä¸ªä½ç½®. ä½ç½®å°†æŒ‰ç…§å®ƒä»¬å®šä¹‰çš„é¡ºåºè¿›è¡Œå¤„ç†ï¼Œç¨åçš„å¯¼å…¥ä¼˜å…ˆ.</p><p>é€‚å½“æ—¶ï¼Œè¿˜ä¼šè€ƒè™‘å¯¼å…¥ <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.external-config.files.profile-specific">Profile-specific variants</a> ã€‚ ä¸Šé¢çš„ç¤ºä¾‹å°†å¯¼å…¥ <code>my.properties</code> ä»¥åŠä»»ä½• <code>my-&lt;profile&gt;.properties</code> å˜ä½“.</p><p>Spring Boot åŒ…æ‹¬å¯æ’æ‹” APIï¼Œå…è®¸æ”¯æŒå„ç§ä¸åŒçš„ä½ç½®åœ°å€. é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥å¯¼å…¥ Java å±æ€§ï¼Œyaml å’Œ â€œ<a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.external-config.files.configtree">ä½¿ç”¨é…ç½®æ ‘</a>â€.</p><p>ç¬¬ä¸‰æ–¹ JAR å¯ä»¥æä¾›å¯¹é™„åŠ æŠ€æœ¯çš„æ”¯æŒ(ä¸éœ€è¦æ–‡ä»¶æ˜¯æœ¬åœ°çš„). ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥æƒ³è±¡é…ç½®æ•°æ®æ¥è‡ªå¤–éƒ¨å­˜å‚¨ï¼Œä¾‹å¦‚ Consulï¼ŒApache Zookeeper æˆ– Netflix Archaius.</p><p>å¦‚æœè¦æ”¯æŒè‡ªå·±çš„ä½ç½®ï¼Œè¯·å‚é˜… <code>org.springframework.boot.context.config</code> åŒ…ä¸­çš„ <code>ConfigDataLocationResolver</code> å’Œ <code>ConfigDataLoader</code> ç±».</p><h4 id="2-3-5-å¯¼å…¥æ— æ‰©å±•åæ–‡ä»¶"><a href="#2-3-5-å¯¼å…¥æ— æ‰©å±•åæ–‡ä»¶" class="headerlink" title="2.3.5. å¯¼å…¥æ— æ‰©å±•åæ–‡ä»¶"></a>2.3.5. å¯¼å…¥æ— æ‰©å±•åæ–‡ä»¶</h4><p>ä¸€äº›äº‘å¹³å°ä¸èƒ½ä¸ºæŒ‚è½½çš„æ–‡ä»¶æ·»åŠ æ–‡ä»¶æ‰©å±•å. è¦å¯¼å…¥è¿™äº›æ— æ‰©å±•æ–‡ä»¶ï¼Œæ‚¨éœ€è¦ç»™ Spring Boot ä¸€ä¸ªæç¤ºï¼Œä»¥ä¾¿å®ƒçŸ¥é“å¦‚ä½•åŠ è½½å®ƒä»¬. æ‚¨å¯ä»¥é€šè¿‡å°†æ‰©å±•æç¤ºæ”¾åœ¨æ–¹æ‹¬å·ä¸­æ¥å®ç°è¿™ä¸€ç‚¹.</p><p>ä¾‹å¦‚ï¼Œå‡è®¾æ‚¨æœ‰ä¸€ä¸ª <code>/etc/config/myconfig</code> æ–‡ä»¶ï¼Œå¸Œæœ›å¯¼å…¥ä¸º yaml. æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹çš„ <code>application.properties</code> å¯¼å…¥:</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">spring:</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">  config:</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">    import:</span> <span class="hljs-string">&quot;file:/etc/config/myconfig[.yaml]&quot;</span><br></code></pre></td></tr></table></figure><h4 id="2-3-6-ä½¿ç”¨é…ç½®æ ‘"><a href="#2-3-6-ä½¿ç”¨é…ç½®æ ‘" class="headerlink" title="2.3.6. ä½¿ç”¨é…ç½®æ ‘"></a>2.3.6. ä½¿ç”¨é…ç½®æ ‘</h4><p>åœ¨äº‘å¹³å°ä¸Šè¿è¡Œåº”ç”¨ç¨‹åºï¼ˆä¾‹å¦‚ Kubernetesï¼‰ï¼Œæ‚¨é€šå¸¸éœ€è¦é˜…è¯»å¹³å°æä¾›çš„é…ç½®å€¼. ä½¿ç”¨ç¯å¢ƒå˜é‡æ¥å®ç°è¿™ç±»ç›®çš„å¹¶ä¸å°‘è§ï¼Œä½†æ˜¯è¿™æ ·åšå¯èƒ½ä¼šæœ‰ç¼ºç‚¹ï¼Œç‰¹åˆ«æ˜¯åœ¨å€¼åº”è¯¥ä¿å¯†çš„æƒ…å†µä¸‹.</p><p>ä½œä¸ºç¯å¢ƒå˜é‡çš„æ›¿ä»£æ–¹æ¡ˆï¼Œè®¸å¤šäº‘å¹³å°ç°åœ¨å…è®¸æ‚¨å°†é…ç½®æ˜ å°„åˆ°å®‰è£…çš„æ•°æ®å·ä¸­. ä¾‹å¦‚ï¼ŒKubernetes å¯ä»¥åŒæ—¶å·è½½ <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-pod-configmap/#populate-a-volume-with-data-stored-in-a-configmap"><code>ConfigMaps</code></a> å’Œ <a href="https://kubernetes.io/docs/concepts/configuration/secret/#using-secrets-as-files-from-a-pod"><code>Secrets</code></a>.</p><p>æœ‰ä¸¤ç§å¸¸è§çš„å·æŒ‚è½½æ¨¡å¼å¯ä»¥ä½¿ç”¨:</p><ol><li>å•ä¸ªæ–‡ä»¶åŒ…å«ä¸€ç»„å®Œæ•´çš„å±æ€§(é€šå¸¸ä»¥ YAML çš„å½¢å¼ç¼–å†™).</li><li>å¤šä¸ªæ–‡ä»¶è¢«å†™å…¥ä¸€ä¸ªç›®å½•æ ‘ï¼Œæ–‡ä»¶åæˆä¸º â€˜keyâ€™ï¼Œå†…å®¹æˆä¸º â€˜valueâ€™.</li></ol><p>å¯¹äºç¬¬ä¸€ç§æƒ…å†µï¼Œæ‚¨å¯ä»¥åƒ <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.external-config.files.importing">ä¸Šé¢æè¿°</a> çš„é‚£æ ·ç›´æ¥ä½¿ç”¨ <code>spring.config.import</code> å¯¼å…¥ YAML æˆ– Properties æ–‡ä»¶. å¯¹äºç¬¬äºŒç§æƒ…å†µï¼Œæ‚¨éœ€è¦ä½¿ç”¨ <code>configtree:</code> å‰ç¼€ï¼Œä»¥ä¾¿ Spring Boot çŸ¥é“å®ƒéœ€è¦å°†æ‰€æœ‰æ–‡ä»¶ä½œä¸ºå±æ€§å…¬å¼€.</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ Kubernetes å·²ç»æŒ‚è½½äº†ä¸‹é¢çš„å·:</p><p>etc&#x2F; config&#x2F; myapp&#x2F; username password</p><p><code>username</code> æ–‡ä»¶çš„å†…å®¹å°†æ˜¯ä¸€ä¸ªé…ç½®å€¼ï¼Œ<code>password</code> çš„å†…å®¹å°†æ˜¯ä¸€ä¸ª secret.</p><p>è¦å¯¼å…¥è¿™äº›å±æ€§ï¼Œå¯ä»¥å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ° <code>application.properties</code> æˆ– <code>application.yaml</code> æ–‡ä»¶:</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">spring:</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">  config:</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">    import:</span> <span class="hljs-string">&quot;optional:configtree:/etc/config/&quot;</span><br></code></pre></td></tr></table></figure><p>ç„¶åï¼Œæ‚¨å¯ä»¥å‘å¾€å¸¸ä¸€æ ·ä» <code>Environment</code> ä¸­è®¿é—®æˆ–æ³¨å…¥ <code>myapp.username</code> å’Œ <code>myapp.password</code> .</p><p>é…ç½®æ ‘ä¸‹çš„æ–‡ä»¶å¤¹æ„æˆå±æ€§åç§°ã€‚åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œè¦ä»¥ <code>username</code> å’Œ <code>password</code> è®¿é—®å±æ€§ï¼Œå¯ä»¥å°† <code>spring.config.import</code> è®¾ç½®ä¸º <code>optional:configtree:/etc/config/myapp</code>ã€‚</p><p>å¸¦æœ‰ . ç¬¦å·çš„æ–‡ä»¶åä¹Ÿè¢«æ­£ç¡®æ˜ å°„ã€‚ ä¾‹å¦‚ï¼Œåœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ<code>/etc/config</code> ä¸­åä¸º <code>myapp.username</code> çš„æ–‡ä»¶å°†å¯¼è‡´ <code>Environment</code> ä¸­çš„ <code>myapp.username</code> å±æ€§ã€‚</p><p>æ ¹æ®æ‰€æœŸæœ›çš„å†…å®¹ï¼Œé…ç½®æ ‘å€¼å¯ä»¥ç»‘å®šåˆ°å­—ç¬¦ä¸² <code>String</code> å’Œ <code>byte[]</code> ç±»å‹.</p><p>å¦‚æœæœ‰å¤šä¸ªé…ç½®æ ‘è¦ä»åŒä¸€ä¸ªçˆ¶æ–‡ä»¶å¤¹å¯¼å…¥ï¼Œå¯ä»¥ä½¿ç”¨é€šé…ç¬¦å¿«æ·æ–¹å¼. ä»»ä½•ä»¥ <code>/*/</code> ç»“å°¾çš„ <code>configtree:</code> location å°†å¯¼å…¥æ‰€æœ‰ç›´æ¥å­æ ‘ä½œä¸ºé…ç½®æ ‘.</p><p>ä¾‹å¦‚ï¼Œç»™å®šä»¥ä¸‹å·:</p><p>etc&#x2F; config&#x2F; dbconfig&#x2F; db&#x2F; username password mqconfig&#x2F; mq&#x2F; username password</p><p>ä½ å¯ä»¥ä½¿ç”¨ <code>configtree:/etc/config/*/</code> ä½œä¸ºå¯¼å…¥ä½ç½®:</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">spring:</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">  config:</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">    import:</span> <span class="hljs-string">&quot;optional:configtree:/etc/config/*/&quot;</span><br></code></pre></td></tr></table></figure><p>è¿™å°†ä¼šæ·»åŠ  <code>db.username</code>, <code>db.password</code>, <code>mq.username</code> å’Œ <code>mq.password</code> å±æ€§.</p><p>ä½¿ç”¨é€šé…ç¬¦åŠ è½½çš„ç›®å½•æŒ‰å­—æ¯é¡ºåºæ’åº. å¦‚æœæ‚¨éœ€è¦ä¸åŒçš„é¡ºåºï¼Œé‚£ä¹ˆæ‚¨åº”è¯¥å°†æ¯ä¸ªä½ç½®ä½œä¸ºå•ç‹¬çš„å¯¼å…¥åˆ—å‡º</p><p>é…ç½®æ ‘ä¹Ÿå¯ä»¥ç”¨äº Docker secrets. å½“ä¸€ä¸ª Docker é›†ç¾¤æœåŠ¡è¢«æˆæƒè®¿é—®ä¸€ä¸ª secrets æ—¶ï¼Œè¿™ä¸ª secrets å°±ä¼šè¢«å®‰è£…åˆ°å®¹å™¨ä¸­. ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ª secrets å‘½åä¸º <code>db.password</code> è¢«æŒ‚è½½åœ¨ <code>/run/secrets/</code> ä½ç½®ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å†…å®¹ä½¿ <code>db.password</code> å¯ç”¨äº Spring ç¯å¢ƒ:</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">spring:</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">  config:</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">    import:</span> <span class="hljs-string">&quot;optional:configtree:/run/secrets/&quot;</span><br></code></pre></td></tr></table></figure><h4 id="2-3-7-å±æ€§ä¸­çš„å ä½ç¬¦"><a href="#2-3-7-å±æ€§ä¸­çš„å ä½ç¬¦" class="headerlink" title="2.3.7. å±æ€§ä¸­çš„å ä½ç¬¦"></a>2.3.7. å±æ€§ä¸­çš„å ä½ç¬¦</h4><p><code>application.properties</code> å’Œ <code>application.yml</code> ä¸­çš„å€¼åœ¨ä½¿ç”¨æ—¶é€šè¿‡ç°æœ‰çš„ <code>Environment</code> è¿›è¡Œè¿‡æ»¤, å› æ­¤æ‚¨å¯ä»¥è¿”å›ä¹‹å‰å®šä¹‰çš„å€¼ (ä¾‹å¦‚, ä»ç³»ç»Ÿå±æ€§æˆ–ç¯å¢ƒå˜é‡) . æ ‡å‡†çš„ <code>$&#123;name&#125;</code> å±æ€§å ä½ç¬¦è¯­æ³•å¯ä»¥åœ¨å€¼çš„ä»»ä½•åœ°æ–¹ä½¿ç”¨. å±æ€§å ä½ç¬¦è¿˜å¯ä»¥ä½¿ç”¨ <code>:</code> æŒ‡å®šé»˜è®¤å€¼ï¼Œä»¥å°†é»˜è®¤å€¼ä¸å±æ€§åç§°åˆ†å¼€ï¼Œä¾‹å¦‚ <code>$&#123;name:default&#125;</code>ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†ä½¿ç”¨å¸¦å’Œä¸å¸¦é»˜è®¤å€¼çš„å ä½ç¬¦:</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">app:</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">  name:</span> <span class="hljs-string">&quot;MyApp&quot;</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">  description:</span> <span class="hljs-string">&quot;$&#123;app.name&#125; is a Spring Boot application written by $&#123;username:Unknown&#125;&quot;</span><br></code></pre></td></tr></table></figure><p>å‡è®¾ <code>username</code> å±æ€§æ²¡æœ‰åœ¨å…¶ä»–åœ°æ–¹è®¾ç½®ï¼Œ<code>app.description</code> å°†ä¸º <code>MyApp is a Spring Boot application written by Unknown</code>.</p><p>æ‚¨åº”è¯¥å§‹ç»ˆä½¿ç”¨è§„èŒƒå½¢å¼ï¼ˆkebab-case ä»…ä½¿ç”¨å°å†™å­—æ¯ï¼‰å¼•ç”¨å ä½ç¬¦ä¸­çš„å±æ€§åç§°ã€‚ è¿™å°†å…è®¸ Spring Boot ä½¿ç”¨ä¸ <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.external-config.typesafe-configuration-properties.relaxed-binding">relaxed binding</a> <code>@ConfigurationProperties</code> ç›¸åŒçš„é€»è¾‘ã€‚</p><p>ä¾‹å¦‚ï¼Œ<code>$&#123;demo.item-price&#125;</code> å°†ä» <code>application.properties</code> æ–‡ä»¶ä¸­æå– <code>demo.item-price</code> å’Œ <code>demo.itemPrice</code> å±æ€§ï¼Œä»¥åŠä»ç³»ç»Ÿç¯å¢ƒä¸­æå– <code>DEMO_ITEMPRICE</code>ã€‚ å¦‚æœæ‚¨æ”¹ç”¨ <code>$&#123;demo.itemPrice&#125;</code>ï¼Œåˆ™ä¸ä¼šè€ƒè™‘ <code>demo.item-price</code> å’Œ <code>DEMO_ITEMPRICE</code>ã€‚</p><p>æ‚¨è¿˜å¯ä»¥ä½¿ç”¨æ­¤æŠ€æœ¯åˆ›å»ºç°æœ‰ Spring Boot å±æ€§çš„ç®€çŸ­å½¢å¼. æœ‰å…³è¯¦ç»†ä¿¡æ¯, è¯·å‚è§ <em><a href="https://sca.aliyun.com/learn/spring-boot/core/howto.html#howto.properties-and-configuration.short-command-line-arguments">howto.html</a></em> .</p><h4 id="2-3-8-å¤„ç†å¤šæ–‡æ¡£æ–‡ä»¶"><a href="#2-3-8-å¤„ç†å¤šæ–‡æ¡£æ–‡ä»¶" class="headerlink" title="2.3.8. å¤„ç†å¤šæ–‡æ¡£æ–‡ä»¶"></a>2.3.8. å¤„ç†å¤šæ–‡æ¡£æ–‡ä»¶</h4><p>Spring Boot å…è®¸æ‚¨å°†å•ä¸ªç‰©ç†æ–‡ä»¶æ‹†åˆ†ä¸ºå¤šä¸ªé€»è¾‘æ–‡æ¡£ï¼Œæ¯ä¸ªé€»è¾‘æ–‡ä»¶éƒ½æ˜¯ç‹¬ç«‹æ·»åŠ çš„. æ–‡æ¡£æŒ‰é¡ºåºå¤„ç†ï¼Œä»ä¸Šåˆ°ä¸‹å¤„ç†. åé¢çš„æ–‡æ¡£å¯ä»¥è¦†ç›–æ—©æœŸå®šä¹‰çš„å±æ€§.</p><p>å¯¹äº <code>application.yml</code> æ–‡ä»¶ï¼Œä½¿ç”¨æ ‡å‡† yaml å¤šæ–‡æ¡£è¯­æ³•. <code>---</code> å­—ç¬¦ä»£è¡¨ä¸€ä¸ªæ–‡æ¡£çš„ç»“å°¾ï¼Œå¹¶å¼€å§‹ä¸‹ä¸€ä¸ªæ–‡æ¡£.</p><p>ä¾‹å¦‚ï¼Œä»¥ä¸‹æ–‡ä»¶å…·æœ‰ä¸¤ä¸ªé€»è¾‘æ–‡ä»¶:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br><br>  <span class="hljs-attr">application:</span><br><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;MyApp&quot;</span><br><br><span class="hljs-meta">---</span><br><span class="hljs-meta"></span><br><span class="hljs-attr">spring:</span><br><br>  <span class="hljs-attr">application:</span><br><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;MyCloudApp&quot;</span><br><br>  <span class="hljs-attr">config:</span><br><br>    <span class="hljs-attr">activate:</span><br><br>      <span class="hljs-attr">on-cloud-platform:</span> <span class="hljs-string">&quot;kubernetes&quot;</span><br></code></pre></td></tr></table></figure><p>å¯¹äº <code>application.properties</code> æ–‡ä»¶ï¼Œç‰¹æ®Š <code>#---</code> æˆ– <code>!---</code> æ³¨é‡Šç”¨äºæ ‡è®°æ–‡æ¡£æ‹†åˆ†:</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">spring.application.name</span>=MyApp<br><br><span class="hljs-comment">#---</span><br><br><span class="hljs-attr">spring.application.name</span>=MyCloudApp<br><br><span class="hljs-attr">spring.config.activate.on-cloud-platform</span>=kubernetes<br></code></pre></td></tr></table></figure><p>å±æ€§æ–‡ä»¶åˆ†éš”ç¬¦å¿…é¡»æ²¡æœ‰ä»»ä½•å‰å¯¼ç©ºæ ¼ï¼Œå¹¶ä¸”å¿…é¡»æ°å¥½æœ‰ä¸‰ä¸ªè¿å­—ç¬¦. åˆ†éš”ç¬¦å‰åçš„è¡Œä¸èƒ½æ˜¯ç›¸åŒçš„æ³¨é‡Šå‰ç¼€.</p><p>å¤šæ–‡æ¡£å±æ€§æ–‡ä»¶é€šå¸¸ä¸æ¿€æ´»å±æ€§ä¸€èµ·ä½¿ç”¨ï¼Œä¾‹å¦‚ <code>spring.config.activate.on-profile</code> ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œ<a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.external-config.files.activation-properties">è¯·å‚é˜…ä¸‹ä¸€èŠ‚</a>.</p><p>æ— æ³•ä½¿ç”¨ <code>@PropertySource</code> æˆ– <code>@TestPropertySource</code> æ³¨è§£åŠ è½½å¤šæ–‡æ¡£å±æ€§æ–‡ä»¶.</p><h4 id="2-3-9-Activation-Propertiesï¼ˆæ¿€æ´»å±æ€§ï¼‰"><a href="#2-3-9-Activation-Propertiesï¼ˆæ¿€æ´»å±æ€§ï¼‰" class="headerlink" title="2.3.9. Activation Propertiesï¼ˆæ¿€æ´»å±æ€§ï¼‰"></a>2.3.9. Activation Propertiesï¼ˆæ¿€æ´»å±æ€§ï¼‰</h4><p>æœ‰æ—¶ï¼Œåªåœ¨æ»¡è¶³æŸäº›æ¡ä»¶æ—¶æ‰æ¿€æ´»ç»™å®šçš„å±æ€§æ˜¯æœ‰ç”¨çš„. ä¾‹å¦‚ï¼Œæ‚¨å¯èƒ½æ‹¥æœ‰ä»…åœ¨ç‰¹å®šæ¦‚è¦æ–‡ä»¶æ¿€æ´»æ—¶æ‰ç›¸å…³çš„å±æ€§.</p><p>æ‚¨å¯ä»¥ä½¿ç”¨ <code>spring.config.activate.*</code> æœ‰æ¡ä»¶åœ°æ¿€æ´»å±æ€§æ–‡æ¡£.</p><p>ä»¥ä¸‹æ¿€æ´»å±æ€§å¯ç”¨:</p><p>Table 2. activation properties</p><p>Property</p><p>Note</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">on</span>-<span class="hljs-keyword">profile</span><br></code></pre></td></tr></table></figure><p>è¦ä½¿æ–‡æ¡£å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œå¿…é¡»åŒ¹é…çš„é…ç½®æ–‡ä»¶è¡¨è¾¾å¼ã€‚</p><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs delphi"><span class="hljs-keyword">on</span>-cloud-<span class="hljs-keyword">platform</span><br></code></pre></td></tr></table></figure><p>è¦ä½¿æ–‡æ¡£å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œå¿…é¡»æ£€æµ‹åˆ° <code>CloudPlatform</code>.</p><p>ä¾‹å¦‚ï¼Œä¸‹é¢çš„å‘½ä»¤æŒ‡å®šç¬¬äºŒä¸ªæ–‡æ¡£åªæœ‰åœ¨ Kubernetes ä¸Šè¿è¡Œæ—¶æ˜¯æ¿€æ´»çš„ï¼Œå¹¶ä¸”åªæœ‰åœ¨ â€œprodâ€ æˆ– â€œstagingâ€ é…ç½®æ–‡ä»¶æ˜¯æ¿€æ´»çš„æ—¶å€™:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">myprop:</span><br><br>  <span class="hljs-string">&quot;always-set&quot;</span><br><br><span class="hljs-meta">---</span><br><span class="hljs-meta"></span><br><span class="hljs-attr">spring:</span><br><br>  <span class="hljs-attr">config:</span><br><br>    <span class="hljs-attr">activate:</span><br><br>      <span class="hljs-attr">on-cloud-platform:</span> <span class="hljs-string">&quot;kubernetes&quot;</span><br><br>      <span class="hljs-attr">on-profile:</span> <span class="hljs-string">&quot;prod | staging&quot;</span><br><br><span class="hljs-attr">myotherprop:</span> <span class="hljs-string">&quot;sometimes-set&quot;</span><br></code></pre></td></tr></table></figure><h3 id="2-4-Encrypting-Properties"><a href="#2-4-Encrypting-Properties" class="headerlink" title="2.4. Encrypting Properties"></a>2.4. Encrypting Properties</h3><p>Spring Boot æ²¡æœ‰ä¸ºåŠ å¯†å±æ€§å€¼æä¾›ä»»ä½•å†…ç½®æ”¯æŒ, ç„¶è€Œ, å®ƒæä¾›äº†ä¿®æ”¹ Spring <code>Environment</code> åŒ…å«çš„å€¼æ‰€å¿…éœ€çš„é’©å­. <code>EnvironmentPostProcessor</code> æ¥å£å…è®¸æ‚¨åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨ä¹‹å‰æ“ä½œ <code>Environment</code>. æœ‰å…³è¯¦ç»†ä¿¡æ¯, è¯·å‚è§ <a href="https://sca.aliyun.com/learn/spring-boot/core/howto.html#howto.application.customize-the-environment-or-application-context">howto.html</a>.</p><p>å¦‚æœæ‚¨æ­£åœ¨å¯»æ‰¾ä¸€ç§å¯ç”¨äºå­˜å‚¨å‡­æ®å’Œå¯†ç çš„å®‰å…¨æ–¹æ³•, <a href="https://cloud.spring.io/spring-cloud-vault/">Spring Cloud Vault</a> é¡¹ç›®æ”¯æŒåœ¨ <a href="https://www.vaultproject.io/">HashiCorp Vault</a> ä¸­å­˜å‚¨å¤–éƒ¨åŒ–é…ç½®.</p><h3 id="2-5-ä½¿ç”¨-YAML"><a href="#2-5-ä½¿ç”¨-YAML" class="headerlink" title="2.5. ä½¿ç”¨ YAML"></a>2.5. ä½¿ç”¨ YAML</h3><p><a href="https://yaml.org/">YAML</a> æ˜¯ JSON çš„è¶…é›†, æ˜¯ä¸€ä¸ªå¯ç”¨äºæŒ‡å®šå±‚çº§é…ç½®æ•°æ®çš„ä¾¿æ·æ ¼å¼. åªè¦åœ¨ classpath ä¸Šæœ‰ <a href="https://github.com/snakeyaml/snakeyaml">SnakeYAML</a> åº“, <code>SpringApplication</code> ç±»å°±ä¼šè‡ªåŠ¨æ”¯æŒ YAML ä½œä¸ºå±æ€§æ–‡ä»¶ (properties) çš„æ›¿ä»£.</p><p>å¦‚æœä½¿ç”¨ <code>starter</code>, åˆ™ <code>spring-boot-starter</code> ä¼šè‡ªåŠ¨æä¾› SnakeYAML.</p><h4 id="2-5-1-ä½¿ç”¨-YAML-ä»£æ›¿å±æ€§æ–‡ä»¶"><a href="#2-5-1-ä½¿ç”¨-YAML-ä»£æ›¿å±æ€§æ–‡ä»¶" class="headerlink" title="2.5.1. ä½¿ç”¨ YAML ä»£æ›¿å±æ€§æ–‡ä»¶"></a>2.5.1. ä½¿ç”¨ YAML ä»£æ›¿å±æ€§æ–‡ä»¶</h4><p>YAML æ–‡æ¡£éœ€è¦ä»å…¶åˆ†å±‚æ ¼å¼è½¬æ¢ä¸ºå¯ä¸ Spring <code>Environment</code> ä¸€èµ·ä½¿ç”¨çš„å¹³é¢ç»“æ„. ä¾‹å¦‚ï¼Œè€ƒè™‘ä»¥ä¸‹ YAML æ–‡æ¡£:</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">environments:</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">  dev:</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">    url:</span> <span class="hljs-string">&quot;https://dev.example.com&quot;</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">    name:</span> <span class="hljs-string">&quot;Developer Setup&quot;</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">  prod:</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">    url:</span> <span class="hljs-string">&quot;https://another.example.com&quot;</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">    name:</span> <span class="hljs-string">&quot;My Cool App&quot;</span><br></code></pre></td></tr></table></figure><p>ä¸ºäº†ä» <code>Environment</code> è®¿é—®è¿™äº›å±æ€§ï¼Œå®ƒä»¬å°†è¢«æ‰å¹³åŒ–å¦‚ä¸‹:</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">environments.dev.url</span>=https://dev.example.com<br><br><span class="hljs-attr">environments.dev.name</span>=Developer Setup<br><br><span class="hljs-attr">environments.prod.url</span>=https://another.example.com<br><br><span class="hljs-attr">environments.prod.name</span>=My Cool App<br></code></pre></td></tr></table></figure><p>åŒæ ·ï¼ŒYAML åˆ—è¡¨ä¹Ÿéœ€è¦è¢«å±•å¹³ï¼ŒYAML åˆ—è¡¨è¡¨ç¤ºå¸¦æœ‰ <code>[index]</code> ä¸‹æ ‡å¼•ç”¨çš„å±æ€§é”®. ä¾‹å¦‚ä»¥ä¸‹ YAM:</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">my:</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol"> servers:</span><br><br> - <span class="hljs-string">&quot;dev.example.com&quot;</span><br><br> - <span class="hljs-string">&quot;another.example.com&quot;</span><br></code></pre></td></tr></table></figure><p>ä»¥ä¸Šç¤ºä¾‹å°†è½¬æˆä»¥ä¸‹å±æ€§:</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus">my<span class="hljs-selector-class">.servers</span><span class="hljs-selector-attr">[0]</span>=dev<span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.com</span><br><br>my<span class="hljs-selector-class">.servers</span><span class="hljs-selector-attr">[1]</span>=another<span class="hljs-selector-class">.example</span>.com<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>[index]</code> è¡¨ç¤ºçš„å±æ€§å¯ä»¥é€šè¿‡ Spring Boot çš„ <code>Binder</code> ç±»ç»‘å®šåˆ° Java <code>List</code> æˆ– <code>Set</code> å¯¹è±¡. æœ‰å…³æ›´å¤šç»†èŠ‚ï¼Œè¯·å‚é˜…ä¸‹é¢çš„ â€œ<a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.external-config.typesafe-configuration-properties">ç±»å‹å®‰å…¨çš„é…ç½®å±æ€§</a>â€ ä¸€èŠ‚.</p><p>YAML æ–‡ä»¶ä¸èƒ½é€šè¿‡ä½¿ç”¨ <code>@PropertySource</code> æˆ– <code>@TestPropertySource</code> æ³¨è§£åŠ è½½. å› æ­¤ï¼Œåœ¨ä½ éœ€è¦ä»¥è¿™ç§æ–¹å¼åŠ è½½å€¼çš„æƒ…å†µä¸‹ï¼Œä½ éœ€è¦ä½¿ç”¨ä¸€ä¸ªå±æ€§æ–‡ä»¶.</p><h4 id="2-5-2-ç›´æ¥åŠ è½½-YAML"><a href="#2-5-2-ç›´æ¥åŠ è½½-YAML" class="headerlink" title="2.5.2. ç›´æ¥åŠ è½½ YAML"></a>2.5.2. ç›´æ¥åŠ è½½ YAML</h4><p>Spring Framework æä¾›äº†ä¸¤ä¸ªæ–¹ä¾¿çš„ç±»ï¼Œå¯ç”¨äºåŠ è½½ YAML æ–‡æ¡£. <code>YamlPropertiesFactoryBean</code> ä»¥ <code>Properties</code> çš„å½¢å¼åŠ è½½ YAMLï¼Œè€Œ <code>YamlMapFactoryBean</code> ä»¥ <code>Map</code> çš„å½¢å¼åŠ è½½ YAML.</p><p>ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>YamlPropertySourceLoader</code> ç±»ï¼Œå¦‚æœä½ æƒ³åŠ è½½ YAML ä½œä¸ºä¸€ä¸ª Spring <code>PropertySource</code>.</p><h3 id="2-6-é…ç½®éšæœºå€¼"><a href="#2-6-é…ç½®éšæœºå€¼" class="headerlink" title="2.6. é…ç½®éšæœºå€¼"></a>2.6. é…ç½®éšæœºå€¼</h3><p><code>RandomValuePropertySource</code> å¯¹äºæ³¨å…¥éšæœºå€¼(ä¾‹å¦‚ï¼Œæ³¨å…¥ secrets æˆ–æµ‹è¯•ç”¨ä¾‹)å¾ˆæœ‰ç”¨. å®ƒå¯ä»¥äº§ç”Ÿ integers, longs, uuids, æˆ– stringsï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤º:</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs perl"><span class="hljs-keyword">my</span>:<br><br>  secret: <span class="hljs-string">&quot;<span class="hljs-subst">$&#123;random.value&#125;</span>&quot;</span><br><br>  number: <span class="hljs-string">&quot;<span class="hljs-subst">$&#123;random.int&#125;</span>&quot;</span><br><br>  bignumber: <span class="hljs-string">&quot;<span class="hljs-subst">$&#123;random.long&#125;</span>&quot;</span><br><br>  uuid: <span class="hljs-string">&quot;<span class="hljs-subst">$&#123;random.uuid&#125;</span>&quot;</span><br><br>  number-less-than-ten: <span class="hljs-string">&quot;<span class="hljs-subst">$&#123;random.int(<span class="hljs-number">10</span>)&#125;</span>&quot;</span><br><br>  number-in-range: <span class="hljs-string">&quot;<span class="hljs-subst">$&#123;random.int[<span class="hljs-number">1024</span>,<span class="hljs-number">65536</span>]&#125;</span>&quot;</span><br></code></pre></td></tr></table></figure><p><code>random.int*</code> è¯­æ³•æ˜¯ <code>OPEN value (,max) CLOSE</code>ï¼Œå…¶ä¸­ <code>OPEN,CLOSE</code> ä¸ºä»»æ„å­—ç¬¦ï¼Œ<code>value,max</code> ä¸ºæ•´æ•°. å¦‚æœæä¾›äº† <code>max</code>ï¼Œé‚£ä¹ˆ <code>value</code> æ˜¯æœ€å°å€¼ï¼Œ<code>max</code> æ˜¯æœ€å¤§å€¼(ä¸åŒ…æ‹¬).</p><h3 id="2-7-é…ç½®ç³»ç»Ÿç¯å¢ƒå±æ€§"><a href="#2-7-é…ç½®ç³»ç»Ÿç¯å¢ƒå±æ€§" class="headerlink" title="2.7. é…ç½®ç³»ç»Ÿç¯å¢ƒå±æ€§"></a>2.7. é…ç½®ç³»ç»Ÿç¯å¢ƒå±æ€§</h3><p>Spring Boot å¯ä»¥ä¸ºç¯å¢ƒå±æ€§è®¾ç½®å‰ç¼€ã€‚ å¦‚æœç³»ç»Ÿç¯å¢ƒç”±å…·æœ‰ä¸åŒé…ç½®è¦æ±‚çš„å¤šä¸ª Spring Boot åº”ç”¨ç¨‹åºå…±äº«ï¼Œè¿™å°†å¾ˆæœ‰ç”¨ã€‚ ç³»ç»Ÿç¯å¢ƒå±æ€§çš„å‰ç¼€å¯ä»¥ç›´æ¥åœ¨ <code>SpringApplication</code> ä¸Šè®¾ç½®ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨å°†å‰ç¼€è®¾ç½®ä¸º <code>input</code>ï¼Œé‚£ä¹ˆåœ¨ç³»ç»Ÿç¯å¢ƒä¸­ï¼Œ<code>remote.timeout</code> ç­‰å±æ€§ä¹Ÿä¼šè¢«è§£æä¸º <code>input.remote.timeout</code>.</p><h3 id="2-8-ç±»å‹å®‰å…¨çš„é…ç½®å±æ€§"><a href="#2-8-ç±»å‹å®‰å…¨çš„é…ç½®å±æ€§" class="headerlink" title="2.8. ç±»å‹å®‰å…¨çš„é…ç½®å±æ€§"></a>2.8. ç±»å‹å®‰å…¨çš„é…ç½®å±æ€§</h3><p>ä½¿ç”¨ <code>@Value(&quot;$&#123;property&#125;&quot;)</code> æ³¨è§£æ¥æ³¨å…¥é…ç½®å±æ€§æœ‰æ—¶ä¼šå¾ˆéº»çƒ¦, ç‰¹åˆ«æ˜¯å¦‚æœæ‚¨ä½¿ç”¨äº†å¤šä¸ªå±æ€§æˆ–è€…æ‚¨çš„æ•°æ®æœ¬è´¨ä¸Šæ˜¯åˆ†å±‚ç»“æ„. Spring Boot æä¾›äº†å¦ä¸€ç§ä½¿ç”¨å±æ€§çš„æ–¹æ³•, è¯¥æ–¹æ³•ä½¿ç”¨å¼ºç±»å‹çš„ bean æ¥ç®¡ç†å’ŒéªŒè¯åº”ç”¨ç¨‹åºçš„é…ç½®, å¦‚ä¸‹æ‰€ç¤º:</p><p>å¦è¯·å‚è§ <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.external-config.typesafe-configuration-properties.vs-value-annotation"><code>@Value</code> å’Œç±»å‹å®‰å…¨çš„é…ç½®å±æ€§ä¹‹é—´çš„åŒºåˆ«</a>.</p><h4 id="2-8-1-JavaBean-å±æ€§ç»‘å®š"><a href="#2-8-1-JavaBean-å±æ€§ç»‘å®š" class="headerlink" title="2.8.1. JavaBean å±æ€§ç»‘å®š"></a>2.8.1. JavaBean å±æ€§ç»‘å®š</h4><p>å¯ä»¥ç»‘å®šä¸€ä¸ªå£°æ˜æ ‡å‡† JavaBean å±æ€§çš„ bean, å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><p>Java</p><p>Kotlin</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-meta">@ConfigurationProperties</span>(<span class="hljs-string">&quot;my.service&quot;</span>)<span class="hljs-keyword">public</span> <span class="hljs-title class_"><span class="hljs-keyword">class</span> <span class="hljs-title">MyProperties</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> boolean enabled;<br>    <span class="hljs-keyword">private</span> InetAddress remoteAddress;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Security security = <span class="hljs-keyword">new</span> <span class="hljs-type">Security</span>();<br>    <span class="hljs-comment">// getters / setters...</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_"><span class="hljs-keyword">class</span> <span class="hljs-title">Security</span> </span>&#123;<br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">String</span> username;<br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">String</span> password;<br>        <span class="hljs-keyword">private</span> List&lt;<span class="hljs-keyword">String</span>&gt; roles = <span class="hljs-keyword">new</span> <span class="hljs-type">ArrayList</span>&lt;&gt;(Collections.singleton(<span class="hljs-string">&quot;USER&quot;</span>));<br>        <span class="hljs-comment">// getters / setters...</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å‰é¢çš„ POJO å®šä¹‰äº†ä»¥ä¸‹å±æ€§:</p><ul><li><code>my.service.enabled</code>, é»˜è®¤å€¼ä¸º <code>false</code>.</li><li><code>my.service.remote-address</code>, å¯ä»¥ä» <code>String</code> å¼ºåˆ¶è½¬æ¢çš„ç±»å‹.</li><li><code>my.service.security.username</code>, å†…åµŒä¸€ä¸ª <code>security</code> å¯¹è±¡, å…¶åç§°ç”±å±æ€§åç§°å†³å®š. ç‰¹åˆ«æ˜¯, è¿”å›ç±»å‹æ ¹æœ¬æ²¡æœ‰ä½¿ç”¨, å¯èƒ½æ˜¯ <code>SecurityProperties</code>.</li><li><code>my.service.security.password</code>.</li><li><code>my.service.security.roles</code>, <code>String</code> é›†åˆ. é»˜è®¤ä¸º <code>USER</code>.</li></ul><p>Spring Boot è‡ªåŠ¨é…ç½®å¤§é‡ä½¿ç”¨ <code>@ConfigurationProperties</code> æ¥è½»æ¾é…ç½®è‡ªåŠ¨é…ç½®çš„ bean. ä¸è‡ªåŠ¨é…ç½®ç±»ç›¸ä¼¼, Spring Boot ä¸­å¯ç”¨çš„ <code>@ConfigurationProperties</code> ç±»ä»…ä¾›å†…éƒ¨ä½¿ç”¨. é€šè¿‡å±æ€§æ–‡ä»¶, YAML æ–‡ä»¶, ç¯å¢ƒå˜é‡ç­‰é…ç½®çš„æ˜ å°„åˆ°è¯¥ç±»çš„å±æ€§æ˜¯ public API, ä½†ç±»æœ¬èº«çš„è®¿é—®å™¨ï¼ˆgetter&#x2F;setterï¼‰å¹¶ä¸æ„å‘³ç€å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚.</p><p>ä¾èµ–äºé»˜è®¤çš„ç©ºæ„é€ å‡½ï¼Œgetter å’Œ setter é€šå¸¸æ˜¯å¿…éœ€çš„, å› ä¸ºç»‘å®šæ˜¯é€šè¿‡æ ‡å‡†çš„ Java Bean å±æ€§æè¿°ç¬¦æ¥å®Œæˆ, å°±åƒåœ¨ Spring MVC ä¸­ä¸€æ ·. ä»¥ä¸‹æƒ…å†µå¯ä»¥çœç•¥ setter:</p><ul><li>Map, åªéœ€è¦åˆå§‹åŒ–, å°±éœ€è¦ä¸€ä¸ª getter ä½†ä¸ä¸€å®šéœ€è¦ setter, å› ä¸ºå®ƒä»¬å¯ä»¥è¢« binder ä¿®æ”¹.</li><li>é›†åˆå’Œæ•°ç»„å¯ä»¥é€šè¿‡ä¸€ä¸ªç´¢å¼• (é€šå¸¸ä½¿ç”¨ YAML) æˆ–ä½¿ç”¨å•ä¸ªé€—å·åˆ†éš”å€¼ (å±æ€§) è¿›è¡Œè®¿é—®. æœ€åä¸€ç§æƒ…å†µå¿…é¡»ä½¿ç”¨ setter. æˆ‘ä»¬å»ºè®®å§‹ç»ˆä¸ºæ­¤ç±»å‹æ·»åŠ  setter. å¦‚æœåˆå§‹åŒ–é›†åˆ, è¯·ç¡®ä¿å®ƒæ˜¯å¯å˜çš„ (å¦‚ä¸Šä¾‹æ‰€ç¤º) .</li><li>å¦‚æœåˆå§‹åŒ–åµŒå¥—çš„ POJO å±æ€§ (å¦‚å‰é¢ç¤ºä¾‹ä¸­çš„ <code>Security</code> å­—æ®µ) , åˆ™ä¸éœ€è¦ setter. å¦‚æœæ‚¨å¸Œæœ› binder ä½¿ç”¨å…¶é»˜è®¤æ„é€ å‡½æ•°åŠ¨æ€åˆ›å»ºå®ä¾‹, åˆ™éœ€è¦ä¸€ä¸ª setter.</li></ul><p>æœ‰äº›äººå¯èƒ½ä¼šä½¿ç”¨ Project Lombok æ¥è‡ªåŠ¨ç”Ÿæˆ getter å’Œ setter. è¯·ç¡®ä¿ Lombok ä¸ä¸ºæ­¤ç±»å‹ç”Ÿæˆä»»ä½•ç‰¹å®šæ„é€ å‡½æ•°, å› ä¸ºå®¹å™¨ä¼šè‡ªåŠ¨ä½¿ç”¨å®ƒæ¥å®ä¾‹åŒ–å¯¹è±¡.</p><p>æœ€å, è€ƒè™‘åˆ°æ ‡å‡† Java Bean å±æ€§, ä¸æ”¯æŒå¯¹é™æ€å±æ€§çš„ç»‘å®š.</p><h4 id="2-8-2-æ„é€ å‡½æ•°ç»‘å®š"><a href="#2-8-2-æ„é€ å‡½æ•°ç»‘å®š" class="headerlink" title="2.8.2. æ„é€ å‡½æ•°ç»‘å®š"></a>2.8.2. æ„é€ å‡½æ•°ç»‘å®š</h4><p>ä¸Šä¸€èŠ‚ä¸­çš„ç¤ºä¾‹å¯ä»¥ä»¥ä¸å˜çš„æ–¹å¼é‡å†™, å¦‚ä¸‹ä¾‹æ‰€ç¤º:</p><p>Java</p><p>Kotlin</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@ConfigurationProperties(<span class="hljs-string">&quot;my.service&quot;</span>)</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyProperties</span> &#123;<br>    <span class="hljs-comment">// fields...</span><br>    <span class="hljs-keyword">public</span> MyProperties(boolean enabled, InetAddress remoteAddress, Security security) &#123;        <span class="hljs-keyword">this</span>.enabled = enabled;        <span class="hljs-keyword">this</span>.remoteAddress = remoteAddress;        <span class="hljs-keyword">this</span>.security = security;    &#125;<br>    <span class="hljs-comment">// getters...</span><br>    <span class="hljs-keyword">public</span> static <span class="hljs-keyword">class</span> <span class="hljs-title class_">Security</span> &#123;<br>        <span class="hljs-comment">// fields...</span><br>        <span class="hljs-keyword">public</span> Security(String username, String password, <span class="hljs-meta">@DefaultValue(<span class="hljs-string">&quot;USER&quot;</span>)</span> List&lt;String&gt; roles) &#123;            <span class="hljs-keyword">this</span>.username = username;            <span class="hljs-keyword">this</span>.password = password;            <span class="hljs-keyword">this</span>.roles = roles;        &#125;<br>        <span class="hljs-comment">// getters...</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨æ­¤è®¾ç½®ä¸­ï¼Œåªæœ‰ä¸€ä¸ªå‚æ•°æ„é€ å‡½æ•°ï¼Œè¿™æ„å‘³ç€åº”ä½¿ç”¨æ„é€ å‡½æ•°ç»‘å®šã€‚ è¿™æ„å‘³ç€ç»‘å®šå™¨å°†æœŸæœ›æ‰¾åˆ°å¸¦æœ‰æ‚¨å¸Œæœ›ç»‘å®šçš„å‚æ•°çš„æ„é€ å‡½æ•°ã€‚ å¦‚æœæ‚¨çš„ç±»æœ‰å¤šä¸ªæ„é€ å‡½æ•°ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ <code>@ConstructorBinding</code> æ³¨è§£æ¥æŒ‡å®šç”¨äºæ„é€ å‡½æ•°ç»‘å®šçš„æ„é€ å‡½æ•°ã€‚ è‹¥è¦é€‰æ‹©é€€å‡ºå…·æœ‰ä¸€ä¸ªå‚æ•°åŒ–æ„é€ å‡½æ•°çš„ç±»çš„æ„é€ å‡½æ•°ç»‘å®šï¼Œå¿…é¡»ä½¿ç”¨ <code>@Autowired</code> æ³¨è§£æ„é€ å‡½æ•°ã€‚ å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ Java 16 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œåˆ™å¯ä»¥å°†æ„é€ å‡½æ•°ç»‘å®šä¸ records ä¸€èµ·ä½¿ç”¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé™¤éä½ çš„ record æœ‰å¤šä¸ªæ„é€ å‡½æ•°ï¼Œå¦åˆ™æ²¡æœ‰å¿…è¦ä½¿ç”¨ <code>@ConstructorBinding</code>ã€‚</p><p>æ„é€ å‡½æ•°ç»‘å®šç±»çš„åµŒå¥—æˆå‘˜ (ä¾‹å¦‚ä¸Šä¾‹ä¸­çš„ <code>Security</code> ) ä¹Ÿå°†é€šè¿‡å…¶æ„é€ å‡½æ•°è¿›è¡Œç»‘å®š.</p><p>å¯ä»¥åœ¨æ„é€ å‡½æ•°å‚æ•°å’Œ record ç»„ä»¶ä¸Šä½¿ç”¨ <code>@DefaultValue</code> æŒ‡å®šé»˜è®¤å€¼ï¼Œè½¬æ¢æœåŠ¡å°† <code>String</code> å€¼å¼ºåˆ¶ä¸ºç¼ºå°‘å±æ€§çš„ç›®æ ‡ç±»å‹.</p><p>é»˜è®¤æƒ…å†µä¸‹, å¦‚æœæ²¡æœ‰å±æ€§ç»‘å®šåˆ° <code>Security</code>, åˆ™ <code>MyProperties</code> å®ä¾‹çš„ <code>security</code> ä¸º <code>null</code>. å¦‚æœæ‚¨å¸Œæœ›å³ä½¿æ²¡æœ‰ç»‘å®šä»»ä½•å±æ€§éƒ½è¿”å› <code>Security</code> çš„éç©ºå®ä¾‹, åˆ™å¯ä»¥ä½¿ç”¨ç©ºçš„ <code>@DefaultValue</code> æ³¨è§£æ¥è¿™æ ·åšï¼ˆä½¿ç”¨ Kotlin æ—¶ï¼Œéœ€è¦å°† <code>Security</code> çš„ <code>username</code> å’Œ <code>password</code> å‚æ•°å£°æ˜ä¸ºå¯ä¸ºç©ºï¼Œå› ä¸ºå®ƒä»¬æ²¡æœ‰é»˜è®¤å€¼ï¼‰:</p><p>Java</p><p>Kotlin</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> MyProperties(boolean enabled, InetAddress remoteAddress, <span class="hljs-meta">@DefaultValue</span> Security security) &#123;<br><br>    <span class="hljs-keyword">this</span>.enabled = enabled;<br><br>    <span class="hljs-keyword">this</span>.remoteAddress = remoteAddress;<br><br>    <span class="hljs-keyword">this</span>.security = security;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>è¦ä½¿ç”¨æ„é€ å‡½æ•°ç»‘å®š, å¿…é¡»ä½¿ç”¨ <code>@EnableConfigurationProperties</code> æˆ–é…ç½®å±æ€§æ‰«ææ¥å¯ç”¨è¯¥ç±». æ‚¨ä¸èƒ½å¯¹é€šè¿‡å¸¸è§„ Spring æœºåˆ¶åˆ›å»ºçš„ bean ä½¿ç”¨æ„é€ å‡½æ•°ç»‘å®š (ä¾‹å¦‚ <code>@Component</code> bean, é€šè¿‡ <code>@Bean</code> æ–¹æ³•åˆ›å»ºçš„ bean æˆ–ä½¿ç”¨ <code>@Import</code> åŠ è½½çš„ bean)</p><p>è¦åœ¨åŸç”Ÿé•œåƒä¸­ä½¿ç”¨æ„é€ å‡½æ•°ç»‘å®šï¼Œå¿…é¡»ä½¿ç”¨ <code>-parameters</code> ç¼–è¯‘è¯¥ç±»ã€‚ å¦‚æœæ‚¨ä½¿ç”¨ Spring Boot çš„ Gradle æ’ä»¶ï¼Œæˆ–è€…å¦‚æœæ‚¨ä½¿ç”¨ Maven å’Œ <code>spring-boot-starter-parent</code>ï¼Œè¿™å°†è‡ªåŠ¨å‘ç”Ÿã€‚</p><p>ä¸å»ºè®®å°† <code>java.util.Optional</code> ä¸ <code>@ConfigurationProperties</code> ä¸€èµ·ä½¿ç”¨, å› ä¸ºå®ƒä¸»è¦æ˜¯ç”¨ä½œè¿”å›ç±»å‹. å› æ­¤, å®ƒä¸å¤ªé€‚åˆé…ç½®å±æ€§æ³¨å…¥. ä¸ºäº†ä¸å…¶ä»–ç±»å‹çš„å±æ€§ä¿æŒä¸€è‡´, å¦‚æœç¡®å®å£°æ˜äº† <code>Optional</code> å±æ€§å¹¶ä¸”æ²¡æœ‰ä»»ä½•å€¼, åˆ™å°†ç»‘å®š <code>null</code> è€Œä¸æ˜¯ç©ºçš„ <code>Optional</code>.</p><h4 id="2-8-3-å¯ç”¨-ConfigurationProperties-æ³¨è§£çš„ç±»å‹"><a href="#2-8-3-å¯ç”¨-ConfigurationProperties-æ³¨è§£çš„ç±»å‹" class="headerlink" title="2.8.3. å¯ç”¨ @ConfigurationProperties æ³¨è§£çš„ç±»å‹"></a>2.8.3. å¯ç”¨ <code>@ConfigurationProperties</code> æ³¨è§£çš„ç±»å‹</h4><p>Spring Boot æä¾›äº†ç»‘å®š <code>@ConfigurationProperties</code> ç±»å‹å¹¶å°†å…¶æ³¨å†Œä¸º Bean çš„åŸºç¡€æ¶æ„. æ‚¨å¯ä»¥é€ç±»å¯ç”¨é…ç½®å±æ€§, ä¹Ÿå¯ä»¥å¯ç”¨ä¸ç»„ä»¶æ‰«æç±»ä¼¼çš„æ–¹å¼è¿›è¡Œé…ç½®å±æ€§æ‰«æ.</p><p>æœ‰æ—¶, ç”¨ <code>@ConfigurationProperties</code> æ³¨è§£çš„ç±»å¯èƒ½ä¸é€‚ç”¨äºæ‰«æ, ä¾‹å¦‚, å¦‚æœæ‚¨æ­£åœ¨å¼€å‘è‡ªå·±çš„è‡ªåŠ¨é…ç½®, æˆ–è€…æƒ³è¦æœ‰æ¡ä»¶åœ°å¯ç”¨å®ƒä»¬. åœ¨è¿™äº›æƒ…å†µä¸‹, è¯·ä½¿ç”¨ <code>@EnableConfigurationProperties</code> æ³¨è§£ æŒ‡å®šè¦å¤„ç†çš„ç±»å‹åˆ—è¡¨. å¯ä»¥åœ¨ä»»ä½• <code>@Configuration</code> ç±»ä¸Šå®Œæˆæ­¤æ“ä½œ, å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><p>Java</p><p>Kotlin</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Configuration</span>(proxyBeanMethods = false)<span class="hljs-variable">@EnableConfigurationProperties</span>(SomeProperties.class)public class MyConfiguration &#123;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¦ä½¿ç”¨é…ç½®å±æ€§æ‰«æ, è¯·å°† <code>@ConfigurationPropertiesScan</code> æ³¨è§£ æ·»åŠ åˆ°æ‚¨çš„åº”ç”¨ç¨‹åº. é€šå¸¸, å®ƒè¢«æ·»åŠ åˆ°ä½¿ç”¨ <code>@SpringBootApplication</code> æ³¨è§£çš„ä¸»åº”ç”¨ç¨‹åºç±»ä¸­, ä½†å¯ä»¥å°†å…¶æ·»åŠ åˆ°ä»»ä½• <code>@Configuration</code> ç±»ä¸­. é»˜è®¤æƒ…å†µä¸‹, å°†ä»å£°æ˜æ³¨è§£çš„ç±»çš„åŒ…ä¸­è¿›è¡Œæ‰«æ. å¦‚æœè¦å®šä¹‰è¦æ‰«æçš„ç‰¹å®šç¨‹åºåŒ…, å¯ä»¥æŒ‰ç…§ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºè¿›è¡Œæ“ä½œ:</p><p>Java</p><p>Kotlin</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@SpringBootApplication</span><span class="hljs-variable">@ConfigurationPropertiesScan</span>(&#123; <span class="hljs-string">&quot;com.example.app&quot;</span>, <span class="hljs-string">&quot;com.example.another&quot;</span> &#125;)public class MyApplication &#123;<br>&#125;<br></code></pre></td></tr></table></figure><p>å½“ä»¥é…ç½®å±æ€§æˆ–è€…é€šè¿‡ <code>@EnableConfigurationProperties</code> æ³¨å†Œ <code>@ConfigurationProperties</code> bean æ—¶, bean å…·æœ‰ä¸€ä¸ªå›ºå®šæ ¼å¼çš„åç§°: <code>&lt;prefix&gt;-&lt;fqn&gt;</code>, å…¶ä¸­ <code>&lt;prefix&gt;</code> æ˜¯ <code>@ConfigurationProperties</code> æ³¨è§£ä¸­æŒ‡å®šçš„ç¯å¢ƒ key å‰ç¼€, <code>&lt;fqn&gt;</code> æ˜¯ bean çš„å®Œå…¨é™å®šç±»å. å¦‚æœæ³¨è§£æœªæä¾›ä»»ä½•å‰ç¼€, åˆ™ä»…ä½¿ç”¨ bean çš„å®Œå…¨é™å®šç±»å.</p><p>ä¸Šé¢ç¤ºä¾‹ä¸­çš„ bean åç§°ä¸º <code>com.example.app-com.example.app.SomeProperties</code>.</p><p>æˆ‘ä»¬ä¹Ÿå»ºè®® <code>@ConfigurationProperties</code> åªå¤„ç†ç¯å¢ƒ (environment) , ç‰¹åˆ«æ˜¯ä¸è¦ä»ä¸Šä¸‹æ–‡ä¸­æ³¨å…¥å…¶ä»– bean. å¯¹äºæç«¯æƒ…å†µ, å¯ä»¥ä½¿ç”¨ setter æ³¨å…¥æˆ–æ¡†æ¶æä¾›çš„ä»»ä½• <code>*Aware</code> æ¥å£ (ä¾‹å¦‚, éœ€è¦è®¿é—® <code>Environment</code> çš„ <code>EnvironmentAware</code>) . å¦‚æœä»ç„¶æƒ³ä½¿ç”¨æ„é€ å‡½æ•°æ³¨å…¥å…¶ä»– bean, åˆ™å¿…é¡»ä½¿ç”¨ <code>@Component</code> æ³¨è§£é…ç½®å±æ€§ bean, å¹¶ä½¿ç”¨åŸºäº JavaBean çš„å±æ€§ç»‘å®š.</p><h4 id="2-8-4-ä½¿ç”¨-ConfigurationProperties-æ³¨è§£ç±»å‹"><a href="#2-8-4-ä½¿ç”¨-ConfigurationProperties-æ³¨è§£ç±»å‹" class="headerlink" title="2.8.4. ä½¿ç”¨ @ConfigurationProperties æ³¨è§£ç±»å‹"></a>2.8.4. ä½¿ç”¨ @ConfigurationProperties æ³¨è§£ç±»å‹</h4><p>è¿™ç§é…ç½®æ ·å¼ä¸ <code>SpringApplication</code> å¤–éƒ¨ YAML é…ç½®ç‰¹åˆ«æœ‰æ•ˆ, å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">my:</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">  service:</span><br><br>    remote-address: <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.1</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">    security:</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">      username:</span> <span class="hljs-string">&quot;admin&quot;</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">      roles:</span><br><br>      - <span class="hljs-string">&quot;USER&quot;</span><br><br>      - <span class="hljs-string">&quot;ADMIN&quot;</span><br></code></pre></td></tr></table></figure><p>è¦ä½¿ç”¨ <code>@ConfigurationProperties</code> bean, æ‚¨å¯ä»¥ä½¿ç”¨ä¸å…¶ä»– bean ç›¸åŒçš„æ–¹å¼æ³¨å…¥å®ƒä»¬, å¦‚ä¸‹æ‰€ç¤º:</p><p>Java</p><p>Kotlin</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Servicepublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyService</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> MyProperties properties;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyService</span><span class="hljs-params">(MyProperties properties)</span> &#123;        <span class="hljs-built_in">this</span>.properties = properties;    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">openConnection</span><span class="hljs-params">()</span> &#123;        <span class="hljs-type">Server</span> <span class="hljs-variable">server</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Server</span>(<span class="hljs-built_in">this</span>.properties.getRemoteAddress());        server.start();        <span class="hljs-comment">// ...    &#125;</span><br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>@ConfigurationProperties</code> è¿˜å¯ä»¥ç”Ÿæˆå…ƒæ•°æ®æ–‡ä»¶, IDE å¯ä»¥é€šè¿‡è¿™äº›æ–‡ä»¶æ¥ä¸ºæ‚¨è‡ªå·±çš„ key æä¾›è‡ªåŠ¨å®ŒæˆåŠŸèƒ½. æœ‰å…³è¯¦ç»†ä¿¡æ¯, è¯·å‚é˜… <a href="https://sca.aliyun.com/learn/spring-boot/core/configuration-metadata.html#appendix.configuration-metadata">é™„å½• B: é…ç½®å…ƒæ•°æ®</a> .</p><h4 id="2-8-5-ç¬¬ä¸‰æ–¹é…ç½®"><a href="#2-8-5-ç¬¬ä¸‰æ–¹é…ç½®" class="headerlink" title="2.8.5. ç¬¬ä¸‰æ–¹é…ç½®"></a>2.8.5. ç¬¬ä¸‰æ–¹é…ç½®</h4><p><code>@ConfigurationProperties</code> é™¤äº†å¯ä»¥ä½¿ç”¨æ¥æ³¨è§£ç±»ä¹‹å¤–, æ‚¨è¿˜å¯ä»¥åœ¨å…¬å…±çš„ <code>@Bean</code> æ–¹æ³•ä¸Šä½¿ç”¨. å½“æ‚¨æƒ³è¦å°†å±æ€§ç»‘å®šåˆ°æ‚¨æŒæ§ä¹‹å¤–çš„ç¬¬ä¸‰æ–¹ç»„ä»¶æ—¶, è¿™æ ·åšç‰¹åˆ«æœ‰ç”¨.</p><p>è¦ä½¿ç”¨ <code>Environment</code> å±æ€§é…ç½® bean, è¯·å°† <code>@ConfigurationProperties</code> æ·»åŠ åˆ° bean æ³¨å†Œä¸Š, å¦‚ä¸‹æ‰€ç¤º:</p><p>Java</p><p>Kotlin</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Configuration</span>(proxyBeanMethods = false)public class ThirdPartyConfiguration &#123;<br>    <span class="hljs-variable">@Bean</span>    <span class="hljs-variable">@ConfigurationProperties</span>(prefix = <span class="hljs-string">&quot;another&quot;</span>)    public AnotherComponent <span class="hljs-built_in">anotherComponent</span>() &#123;        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">AnotherComponent</span>();    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>another</code> å‰ç¼€å®šä¹‰çš„æ‰€æœ‰å±æ€§éƒ½ä½¿ç”¨ä¸å‰é¢çš„ <code>SomeProperties</code> ç¤ºä¾‹ç±»ä¼¼çš„æ–¹å¼æ˜ å°„åˆ° <code>AnotherComponent</code> bean.</p><h4 id="2-8-6-å®½æ¾ç»‘å®š"><a href="#2-8-6-å®½æ¾ç»‘å®š" class="headerlink" title="2.8.6. å®½æ¾ç»‘å®š"></a>2.8.6. å®½æ¾ç»‘å®š</h4><p>Spring Boot ä½¿ç”¨ä¸€äº›å®½æ¾çš„è§„åˆ™å°† <code>Environment</code> å±æ€§ç»‘å®šåˆ° <code>@ConfigurationProperties</code> bean, å› æ­¤ <code>Environment</code> å±æ€§åä¸éœ€è¦å’Œ bean å±æ€§åç²¾ç¡®åŒ¹é…. å¸¸è§çš„ç¤ºä¾‹åŒ…æ‹¬ä½¿ç”¨äº† <code>-</code> ç¬¦å·åˆ†å‰²çš„ç¯å¢ƒå±æ€§ (ä¾‹å¦‚, <code>context-path</code> ç»‘å®šåˆ° <code>contextPath</code>) å’Œå¤§å†™ç¯å¢ƒå±æ€§ (ä¾‹å¦‚, <code>PORT</code> ç»‘å®šåˆ° <code>port</code>) .</p><p>å¦‚ä¸‹ <code>@ConfigurationProperties</code> ç±»:</p><p>Java</p><p>Kotlin</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@ConfigurationProperties</span>(prefix = <span class="hljs-string">&quot;my.main-project.person&quot;</span>)<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyPersonProperties</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> firstName;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getFirstName</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">firstName</span>;    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setFirstName</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> firstName</span>) &#123;        <span class="hljs-variable language_">this</span>.<span class="hljs-property">firstName</span> = firstName;    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­, åŒæ ·å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å±æ€§åç§°:</p><p>Table 3. å®½æ¾ç»‘å®š</p><p>å±æ€§</p><p>æè¿°</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-keyword">my</span>.main-project.person.<span class="hljs-keyword">first</span>-<span class="hljs-built_in">name</span><br></code></pre></td></tr></table></figure><p>Kebab é£æ ¼ (çŸ­æ¨ªçº¿å‘½å) , å»ºè®®åœ¨ <code>.properties</code> å’Œ <code>.yml</code> æ–‡ä»¶ä¸­ä½¿ç”¨.</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">my<span class="hljs-selector-class">.main-project</span><span class="hljs-selector-class">.person</span>.firstName<br></code></pre></td></tr></table></figure><p>æ ‡å‡†é©¼å³°å¼é£æ ¼.</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">my<span class="hljs-selector-class">.main-project</span><span class="hljs-selector-class">.person</span>.first_name<br></code></pre></td></tr></table></figure><p>ä¸‹åˆ’çº¿è¡¨ç¤ºæ³•, <code>.properties</code> å’Œ <code>.yaml</code> æ–‡ä»¶ä¸­çš„å¦å¤–ä¸€ç§æ ¼å¼..</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">MY_MAINPROJECT_PERSON_FIRSTNAME</span><br></code></pre></td></tr></table></figure><p>å¤§å†™é£æ ¼, å½“ä½¿ç”¨ç³»ç»Ÿç¯å¢ƒå˜é‡æ—¶æ¨èä½¿ç”¨è¯¥é£æ ¼.</p><p>æ³¨è§£çš„ <code>prefix</code> å€¼å¿…é¡»æ˜¯ kebab (çŸ­æ¨ªçº¿å‘½å)é£æ ¼ (å°å†™å¹¶ç”¨ <code>-</code> åˆ†éš”, ä¾‹å¦‚ <code>my.main-project.person</code>) .</p><p>Table 4. æ¯ç§å±æ€§æº (property source) çš„å®½æ¾ç»‘å®šè§„åˆ™</p><p>å±æ€§æº</p><p>ç®€å•ç±»å‹</p><p>åˆ—è¡¨é›†åˆç±»å‹</p><p>Properties æ–‡ä»¶</p><p>é©¼å³°å¼ã€çŸ­æ¨ªçº¿å¼æˆ–ä¸‹åˆ’çº¿å¼</p><p>æ ‡å‡†åˆ—è¡¨è¯­æ³•ä½¿ç”¨ <code>[ ]</code> æˆ–é€—å·åˆ†éš”å€¼</p><p>YAML æ–‡ä»¶</p><p>é©¼å³°å¼ã€çŸ­æ¨ªçº¿å¼æˆ–è€…ä¸‹åˆ’çº¿å¼</p><p>æ ‡å‡† YAML åˆ—è¡¨è¯­æ³•æˆ–è€…é€—å·åˆ†éš”å€¼</p><p>ç¯å¢ƒå˜é‡</p><p>å¤§å†™å¹¶ä¸”ä»¥ä¸‹åˆ’çº¿ä½œä¸ºå®šç•Œç¬¦,(æŸ¥çœ‹ <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.external-config.typesafe-configuration-properties.relaxed-binding.environment-variables">ä»ç¯å¢ƒå˜é‡ç»‘å®š</a>).</p><p>æ•°å­—å€¼ä¸¤è¾¹ä½¿ç”¨ä¸‹åˆ’çº¿è¿æ¥ (æŸ¥çœ‹ <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.external-config.typesafe-configuration-properties.relaxed-binding.environment-variables">ä»ç¯å¢ƒå˜é‡ç»‘å®š</a>)</p><p>ç³»ç»Ÿå±æ€§</p><p>é©¼å³°å¼ã€çŸ­æ¨ªçº¿å¼æˆ–è€…ä¸‹åˆ’çº¿å¼</p><p>æ ‡å‡†åˆ—è¡¨è¯­æ³•ä½¿ç”¨ <code>[ ]</code> æˆ–é€—å·åˆ†éš”å€¼</p><p>æˆ‘ä»¬å»ºè®®, å±æ€§å°½å¯èƒ½ä»¥å°å†™çš„çŸ­æ¨ªçº¿æ ¼å¼å­˜å‚¨, æ¯”å¦‚ <code>my.person.first-name=Rod</code>.</p><h5 id="ç»‘å®š-Maps"><a href="#ç»‘å®š-Maps" class="headerlink" title="ç»‘å®š Maps"></a>ç»‘å®š Maps</h5><p>å½“ç»‘å®šåˆ° <code>Map</code> å±æ€§æ—¶, å¦‚æœ <code>key</code> åŒ…å«é™¤å°å†™å­—æ¯æ•°å­—å­—ç¬¦æˆ– <code>-</code> ä»¥å¤–çš„ä»»ä½•å†…å®¹, åˆ™éœ€è¦ä½¿ç”¨æ‹¬å·è¡¨ç¤ºæ³•æ¥ä¿ç•™åŸå§‹å€¼. å¦‚æœ key æ²¡æœ‰ä½¿ç”¨ <code>[]</code> åŒ…è£¹, åˆ™é‡Œé¢çš„ä»»ä½•éå­—æ¯æ•°å­—å­—ç¬¦æˆ– <code>-</code> æˆ– <code>.</code> çš„å­—ç¬¦éƒ½å°†è¢«åˆ é™¤.</p><p>ä¾‹å¦‚, å°†ä»¥ä¸‹å±æ€§ç»‘å®šåˆ°ä¸€ä¸ª <code>Map&lt;String,String&gt;</code>:</p><p>Properties</p><p>Yaml</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus">my<span class="hljs-selector-class">.map</span>.<span class="hljs-selector-attr">[/key1]</span>=value1<br><br>my<span class="hljs-selector-class">.map</span>.<span class="hljs-selector-attr">[/key2]</span>=value2<br><br>my<span class="hljs-selector-class">.map</span>./key3=value3<br></code></pre></td></tr></table></figure><p>å¯¹äº YAML æ–‡ä»¶, æ–¹æ‹¬å·éœ€è¦ç”¨å¼•å·å¼•èµ·æ¥, ä»¥ä¾¿æ­£ç¡®è§£æ keys.</p><p>ä¸Šé¢çš„å±æ€§å°†ç»‘å®šåˆ°ä¸€ä¸ª <code>Map</code> ä¸Š, å…¶ä¸­ <code>/key1</code>, <code>/key2</code> å’Œ <code>key3</code> ä½œä¸º map çš„ key. <code>key3</code> ä¸­çš„æ–œæ ä¼šè¢«åˆ é™¤ï¼Œ å› ä¸ºå®ƒæ²¡æœ‰è¢«æ–¹æ‹¬å·åŒ…å›´.</p><p>å½“ç»‘å®šæ ‡é‡å€¼æ—¶ï¼Œå…¶ä¸­å¸¦æœ‰ <code>.</code> çš„ key ä¸éœ€è¦è¢« <code>[]</code> åŒ…å›´ã€‚æ ‡é‡å€¼éƒ½åŒ…å«æšä¸¾ç±»å‹ï¼Œ<code>java.lang</code> åŒ…ä¸­é™¤ <code>Object</code> ç±»å‹ä¹‹å¤–çš„æ‰€æœ‰ç±»å‹ã€‚ å°† <code>a.b=c</code> ç»‘å®šåˆ° <code>Map&lt;String, String&gt;</code> ä¸­æ—¶ï¼Œå°†åœ¨ key ä¸­ä¿ç•™ <code>.</code> å¹¶è¿”å›å¸¦æœ‰ <code>&#123;&quot;a.b&quot;=&quot;c&quot;&#125;</code> çš„ Mapã€‚ å¯¹äºä»»ä½•å…¶ä»–ç±»å‹ï¼Œå¦‚æœæ‚¨çš„ <code>key</code> åŒ…å« <code>.</code>ï¼Œåˆ™éœ€è¦ä½¿ç”¨æ‹¬å·è¡¨ç¤ºæ³•ã€‚ ä¾‹å¦‚ï¼Œå°† <code>a.b=c</code> ç»‘å®šåˆ° <code>Map&lt;String, Object&gt;</code> å°†è¿”å›ä¸€ä¸ªå¸¦æœ‰ <code>&#123;&quot;a&quot;=&#123;&quot;b&quot;=&quot;c&quot;&#125;&#125;</code> entry çš„ Mapï¼Œè€Œ <code>[a.b]=c</code> å°†è¿”å›ä¸€ä¸ªå¸¦æœ‰ <code>&#123;&quot;a.b&quot;=&quot;c&quot;&#125;</code> entry çš„ Mapã€‚</p><h5 id="ä»ç¯å¢ƒå˜é‡ç»‘å®š"><a href="#ä»ç¯å¢ƒå˜é‡ç»‘å®š" class="headerlink" title="ä»ç¯å¢ƒå˜é‡ç»‘å®š"></a>ä»ç¯å¢ƒå˜é‡ç»‘å®š</h5><p>å¤§å¤šæ•°æ“ä½œç³»ç»Ÿåœ¨å¯¹äºç¯å¢ƒå˜é‡æœ‰ä¸¥æ ¼è§„èŒƒ. ä¾‹å¦‚, Linux shell å˜é‡åªèƒ½åŒ…å«å­—æ¯(<code>a</code> to <code>z</code> æˆ– <code>A</code> to <code>Z</code>), æ•°å­—(<code>0</code> to <code>9</code>) æˆ–ä¸‹åˆ’çº¿å­—ç¬¦(<code>_</code>). æŒ‰ç…§çº¦å®š, Unix shell å˜é‡ä¹Ÿå¯ä»¥ç”¨å¤§å†™å­—æ¯å‘½å.</p><p>Spring Boot çš„å®½æ¾ç»‘å®šè§„åˆ™å°½å¯èƒ½è®¾è®¡æˆä¸è¿™äº›å‘½åé™åˆ¶å…¼å®¹.</p><p>è¦å°†è§„èŒƒå½¢å¼çš„å±æ€§åç§°è½¬æ¢ä¸ºç¯å¢ƒå˜é‡åç§°, å¯ä»¥éµå¾ªä»¥ä¸‹è§„åˆ™:</p><ul><li>ä½¿ç”¨ä¸‹åˆ’çº¿ (<code>_</code>) æ›¿ä»£ (<code>.</code>).</li><li>åˆ é™¤æ‰€æœ‰ (<code>-</code>).</li><li>è½¬æ¢ä¸ºå¤§å†™.</li></ul><p>ä¾‹å¦‚, é…ç½®å±æ€§ <code>spring.main.log-startup-info</code> æ˜¯ä¸€ä¸ªåä¸º <code>SPRING_MAIN_LOGSTARTUPINFO</code> çš„ç¯å¢ƒå˜é‡.</p><p>å½“ç»‘å®šåˆ°å¯¹è±¡åˆ—è¡¨æ—¶, ä¹Ÿå¯ä»¥ä½¿ç”¨ç¯å¢ƒå˜é‡. è¦ç»‘å®šåˆ° <code>List</code>, å…ƒç´ ç¼–å·åº”åœ¨å˜é‡åç§°ä¸­ç”¨ä¸‹åˆ’çº¿æ‹¬èµ·æ¥.</p><p>ä¾‹å¦‚, é…ç½®å±æ€§ <code>my.service[0].other</code> ä½¿ç”¨åä¸º <code>MY_SERVICE_0_OTHER</code> çš„ç¯å¢ƒå˜é‡.</p><h4 id="2-8-7-åˆå¹¶å¤æ‚ç±»å‹"><a href="#2-8-7-åˆå¹¶å¤æ‚ç±»å‹" class="headerlink" title="2.8.7. åˆå¹¶å¤æ‚ç±»å‹"></a>2.8.7. åˆå¹¶å¤æ‚ç±»å‹</h4><p>å½“åˆ—è¡¨é›†åˆ (list) åœ¨å¤šä¸ªåœ°æ–¹é…ç½®æ—¶, æ•´ä¸ªåˆ—è¡¨é›†åˆå°†è¢«æ›¿æ¢.</p><p>ä¾‹å¦‚, å‡è®¾ <code>MyPojo</code> å¯¹è±¡å¸¦æœ‰ <code>name</code> å’Œ <code>description</code> å±æ€§å¹¶ä¸”é»˜è®¤ä¸º <code>null</code>. ä»¥ä¸‹ç¤ºä¾‹ä¸­, <code>MyProperties</code> æš´éœ²äº†ä¸€ä¸ª <code>MyPojo</code> å¯¹è±¡åˆ—è¡¨é›†åˆ:</p><p>Java</p><p>Kotlin</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@ConfigurationProperties(<span class="hljs-string">&quot;my&quot;</span>)</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyProperties</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;MyPojo&gt; list = new ArrayList&lt;&gt;();<br>    <span class="hljs-keyword">public</span> List&lt;MyPojo&gt; getList() &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.list;    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é…ç½®å¯ä»¥å¦‚ä¸‹:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">my:</span><br><br>  <span class="hljs-attr">list:</span><br><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;my name&quot;</span><br><br>    <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;my description&quot;</span><br><br><span class="hljs-meta">---</span><br><span class="hljs-meta"></span><br><span class="hljs-attr">spring:</span><br><br>  <span class="hljs-attr">config:</span><br><br>    <span class="hljs-attr">activate:</span><br><br>      <span class="hljs-attr">on-profile:</span> <span class="hljs-string">&quot;dev&quot;</span><br><br><span class="hljs-attr">my:</span><br><br>  <span class="hljs-attr">list:</span><br><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;my another name&quot;</span><br></code></pre></td></tr></table></figure><p>å¦‚æœ <code>dev</code> é…ç½®æ–‡ä»¶æœªæ¿€æ´», åˆ™ <code>MyProperties.list</code> åªåŒ…å«ä¸€ä¸ª <code>MyPojo</code> , å¦‚ä¹‹å‰æ‰€è¿°. ä½†æ˜¯, å¦‚æœæ¿€æ´»äº† <code>dev</code> é…ç½®æ–‡ä»¶, åˆ—è¡¨é›†åˆä»ç„¶åªåŒ…å«ä¸€ä¸ªæ¡ç›® (name å±æ€§å€¼ä¸º <code>my another name</code>, description ä¸º <code>null</code>) . æ­¤é…ç½®ä¸ä¼šå‘åˆ—è¡¨é›†åˆä¸­æ·»åŠ ç¬¬äºŒä¸ª <code>MyPojo</code> å®ä¾‹, ä¹Ÿä¸ä¼šåˆå¹¶æ¡ç›®.</p><p>åœ¨å¤šä¸ªé…ç½®æ–‡ä»¶ä¸­æŒ‡å®šä¸€ä¸ª <code>List</code> æ—¶, æœ€é«˜ä¼˜å…ˆçº§ (å¹¶ä¸”åªæœ‰ä¸€ä¸ª) çš„åˆ—è¡¨é›†åˆå°†è¢«ä½¿ç”¨. å¯åšå¦‚ä¸‹é…ç½®:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">my:</span><br><br>  <span class="hljs-attr">list:</span><br><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;my name&quot;</span><br><br>    <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;my description&quot;</span><br><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;another name&quot;</span><br><br>    <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;another description&quot;</span><br><br><span class="hljs-meta">---</span><br><span class="hljs-meta"></span><br><span class="hljs-attr">spring:</span><br><br>  <span class="hljs-attr">config:</span><br><br>    <span class="hljs-attr">activate:</span><br><br>      <span class="hljs-attr">on-profile:</span> <span class="hljs-string">&quot;dev&quot;</span><br><br><span class="hljs-attr">my:</span><br><br>  <span class="hljs-attr">list:</span><br><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;my another name&quot;</span><br></code></pre></td></tr></table></figure><p>åœ¨å‰é¢ç¤ºä¾‹ä¸­, å¦‚æœ <code>dev</code> é…ç½®æ–‡ä»¶å¤„äº active çŠ¶æ€, åˆ™ <code>MyProperties.list</code> åŒ…å«ä¸€ä¸ª <code>MyPojo</code> æ¡ç›® (name ä¸º <code>my another name</code>, description ä¸º <code>null</code>) . å¯¹äº YAML è€Œè¨€, é€—å·åˆ†éš”çš„åˆ—è¡¨å’Œ YAML åˆ—è¡¨åŒæ ·ä¼šå®Œå…¨è¦†ç›–åˆ—è¡¨é›†åˆçš„å†…å®¹.</p><p>å¯¹äº <code>Map</code> å±æ€§, æ‚¨å¯ä»¥ç»‘å®šæ¥è‡ªå¤šä¸ªæºä¸­æå–çš„å±æ€§å€¼. ä½†æ˜¯, å¯¹äºå¤šä¸ªæºä¸­çš„ç›¸åŒå±æ€§, åˆ™ä½¿ç”¨é«˜ä¼˜å…ˆçº§æœ€é«˜çš„å±æ€§. ä»¥ä¸‹ç¤ºä¾‹ä» <code>MyProperties</code> æš´éœ²äº†ä¸€ä¸ª <code>Map&lt;String, MyPojo&gt;</code>:</p><p>Java</p><p>Kotlin</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@ConfigurationProperties</span>(<span class="hljs-string">&quot;my&quot;</span>)<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyProperties</span> &#123;<br>    <span class="hljs-keyword">private</span> final <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">MyPojo</span>&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashMap</span>&lt;&gt;();<br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">MyPojo</span>&gt; <span class="hljs-title function_">getMap</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>;    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è€ƒè™‘ä»¥ä¸‹é…ç½®:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">my:</span><br><br>  <span class="hljs-attr">map:</span><br><br>    <span class="hljs-attr">key1:</span><br><br>      <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;my name 1&quot;</span><br><br>      <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;my description 1&quot;</span><br><br><span class="hljs-meta">---</span><br><span class="hljs-meta"></span><br><span class="hljs-attr">spring:</span><br><br>  <span class="hljs-attr">config:</span><br><br>    <span class="hljs-attr">activate:</span><br><br>      <span class="hljs-attr">on-profile:</span> <span class="hljs-string">&quot;dev&quot;</span><br><br><span class="hljs-attr">my:</span><br><br>  <span class="hljs-attr">map:</span><br><br>    <span class="hljs-attr">key1:</span><br><br>      <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;dev name 1&quot;</span><br><br>    <span class="hljs-attr">key2:</span><br><br>      <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;dev name 2&quot;</span><br><br>      <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;dev description 2&quot;</span><br></code></pre></td></tr></table></figure><p>å¦‚æœ <code>dev</code> é…ç½®æ–‡ä»¶æœªæ¿€æ´», åˆ™ <code>MyProperties.map</code> åªåŒ…å«ä¸€ä¸ªå¸¦ <code>key1</code> çš„ entry (name ä¸º <code>my name 1</code>, description ä¸º <code>my description 1</code>) . å¦‚æœæ¿€æ´»äº† <code>dev</code> é…ç½®æ–‡ä»¶, åˆ™ map å°†åŒ…å«ä¸¤ä¸ª entry, key åˆ†åˆ«ä¸º <code>key1</code> (name ä¸º <code>dev name 1</code> å’Œ description ä¸º <code>my description 1</code>) å’Œ <code>key2</code> (name ä¸º <code>dev name 2</code> å’Œ description ä¸º <code>dev description 2</code>) .</p><p>å‰é¢çš„åˆå¹¶è§„åˆ™é€‚ç”¨äºæ‰€æœ‰ä¸åŒå±æ€§æºçš„å±æ€§, è€Œä¸ä»…ä»…æ˜¯æ–‡ä»¶.</p><h4 id="2-8-8-å±æ€§è½¬æ¢"><a href="#2-8-8-å±æ€§è½¬æ¢" class="headerlink" title="2.8.8. å±æ€§è½¬æ¢"></a>2.8.8. å±æ€§è½¬æ¢</h4><p>å½“å¤–éƒ¨åº”ç”¨ç¨‹åºå±æ€§ (application properties) ç»‘å®šåˆ° <code>@ConfigurationProperties</code> bean æ—¶, Spring Boot ä¼šå°è¯•å°†å…¶å±æ€§å¼ºåˆ¶è½¬æ¢ä¸ºæ­£ç¡®çš„ç±»å‹. å¦‚æœéœ€è¦è‡ªå®šä¹‰ç±»å‹è½¬æ¢, å¯ä»¥æä¾› <code>ConversionService</code> bean (åä¸º <code>conversionService</code> çš„ bean) æˆ–è‡ªå®šä¹‰å±æ€§ç¼–è¾‘å™¨ (é€šè¿‡ <code>CustomEditorConfigurer</code> bean) æˆ–è‡ªå®šä¹‰ <code>Converters</code> (å¸¦æœ‰æ³¨è§£ä¸º <code>@ConfigurationPropertiesBinding</code> çš„ bean å®šä¹‰) .</p><p>ç”±äºè¯¥ bean åœ¨åº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸæ—©æœŸå°±ä¼šä½¿ç”¨ , å› æ­¤è¯·é™åˆ¶ <code>ConversionService</code> æ‚¨ä½¿ç”¨çš„ä¾èµ–. å› ä¸ºæœ‰å¯èƒ½åœ¨åˆ›å»ºæ—¶å¯èƒ½æ— æ³•å®Œå…¨åˆå§‹åŒ–æ‰€éœ€çš„ä¾èµ–. å¦‚æœé…ç½® key ä¸ºéå¼ºåˆ¶éœ€è¦, æ‚¨å¯èƒ½å¸Œæœ›é‡å‘½åè‡ªå®šä¹‰çš„ <code>ConversionService</code>, å¹¶ä»…ä¾èµ–äºä½¿ç”¨ <code>@ConfigurationPropertiesBinding</code> é™å®šçš„è‡ªå®šä¹‰è½¬æ¢å™¨.</p><h5 id="è½¬æ¢-Durations"><a href="#è½¬æ¢-Durations" class="headerlink" title="è½¬æ¢ Durations"></a>è½¬æ¢ Durations</h5><p>Spring Boot æ”¯æŒæŒç»­æ—¶é—´ (duration) è¡¨è¾¾. å¦‚æœæ‚¨æš´éœ²ä¸€ä¸ª <code>java.time.Duration</code> å±æ€§, åˆ™å¯ä»¥åœ¨åº”ç”¨ç¨‹åºå±æ€§ä¸­ä½¿ç”¨ä»¥ä¸‹æ ¼å¼:</p><ul><li>å¸¸è§„ <code>long</code> è¡¨ç¤º (é™¤éæŒ‡å®š <code>@DurationUnit</code>, å¦åˆ™ä½¿ç”¨æ¯«ç§’ä½œä¸ºé»˜è®¤å•ä½)</li><li><a href="https://docs.oracle.com/javase/17/docs/api/java/time/Duration.html#parse-java.lang.CharSequence-">used by <code>java.time.Duration</code></a> ä½¿ç”¨çš„æ ‡å‡† ISO-8601 æ ¼å¼</li><li>ä¸€ç§æ›´æ˜“è¯»çš„æ ¼å¼, å€¼å’Œå•ä½åœ¨ä¸€èµ· (ä¾‹å¦‚ <code>10s</code> è¡¨ç¤º 10 ç§’)</li></ul><p>æ€è€ƒä»¥ä¸‹ç¤ºä¾‹:</p><p>Java</p><p>Kotlin</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ConfigurationProperties(&quot;my&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyProperties</span> &#123;<br>    <span class="hljs-meta">@DurationUnit(ChronoUnit.SECONDS)</span>    <span class="hljs-keyword">private</span> <span class="hljs-type">Duration</span> <span class="hljs-variable">sessionTimeout</span> <span class="hljs-operator">=</span> Duration.ofSeconds(<span class="hljs-number">30</span>);<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Duration</span> <span class="hljs-variable">readTimeout</span> <span class="hljs-operator">=</span> Duration.ofMillis(<span class="hljs-number">1000</span>);<br>    <span class="hljs-comment">// getters / setters...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>æŒ‡å®šä¸€ä¸ªä¼šè¯è¶…æ—¶æ—¶é—´ä¸º <code>30</code> ç§’, ä½¿ç”¨ <code>30</code>ã€<code>PT30S</code> å’Œ <code>30s</code> ç­‰å½¢å¼éƒ½æ˜¯å¯ä»¥çš„. è¯»å–è¶…æ—¶æ—¶é—´è®¾ç½®ä¸º <code>500ms</code>, å¯ä»¥é‡‡ç”¨ä»¥ä¸‹ä»»ä½•ä¸€ç§å½¢å¼: <code>500</code>ã€<code>PT0.5S</code> å’Œ <code>500ms</code>.</p><p>æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ä»»ä½•æ”¯æŒçš„å•ä½æ¥æ ‡è¯†:</p><ul><li><code>ns</code> çº³ç§’</li><li><code>us</code> å¾®ç§’</li><li><code>ms</code> æ¯«ç§’</li><li><code>s</code> ç§’</li><li><code>m</code> åˆ†</li><li><code>h</code> å°æ—¶</li><li><code>d</code> å¤©</li></ul><p>é»˜è®¤å•ä½æ˜¯æ¯«ç§’, å¯ä»¥ä½¿ç”¨ <code>@DurationUnit</code> é…åˆä¸Šé¢çš„å•ä½ç¤ºä¾‹é‡å†™. è¯·æ³¨æ„, åªæœ‰ä½¿ç”¨ getter å’Œ setter çš„ JavaBean æ ·å¼çš„å±æ€§ç»‘å®šæ‰æ”¯æŒ <code>@DurationUnit</code>.æ„é€ å‡½æ•°ç»‘å®šä¸æ”¯æŒ.</p><p>å¦‚æœæ‚¨æ›´å–œæ¬¢ä½¿ç”¨æ„é€ å‡½æ•°ç»‘å®šï¼Œåˆ™å¯ä»¥å…¬å¼€ç›¸åŒçš„å±æ€§ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><p>Java</p><p>Kotlin</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@ConfigurationProperties(<span class="hljs-string">&quot;my&quot;</span>)</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyProperties</span> &#123;<br>    <span class="hljs-comment">// fields...</span><br>    <span class="hljs-keyword">public</span> MyProperties(<span class="hljs-meta">@DurationUnit(ChronoUnit.SECONDS)</span> <span class="hljs-meta">@DefaultValue(<span class="hljs-string">&quot;30s&quot;</span>)</span> Duration sessionTimeout,            <span class="hljs-meta">@DefaultValue(<span class="hljs-string">&quot;1000ms&quot;</span>)</span> Duration readTimeout) &#123;        <span class="hljs-keyword">this</span>.sessionTimeout = sessionTimeout;        <span class="hljs-keyword">this</span>.readTimeout = readTimeout;    &#125;<br>    <span class="hljs-comment">// getters...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœæ‚¨è¦å‡çº§ <code>Long</code> å±æ€§ï¼Œå¦‚æœå®ƒä¸æ˜¯æ¯«ç§’ï¼Œè¯·ç¡®ä¿ä½¿ç”¨ <code>@DurationUnit</code> å®šä¹‰å•ä½ã€‚ è¿™æ ·åšæä¾›äº†ä¸€ä¸ªé€æ˜çš„å‡çº§è·¯å¾„ï¼ŒåŒæ—¶æ”¯æŒæ›´ä¸°å¯Œçš„æ ¼å¼.</p><h5 id="è½¬æ¢-periods"><a href="#è½¬æ¢-periods" class="headerlink" title="è½¬æ¢ periods"></a>è½¬æ¢ periods</h5><p>é™¤äº†æŒç»­æ—¶é—´, Spring Boot è¿˜å¯ä»¥ä½¿ç”¨ <code>java.time.Period</code> ç±»å‹. å¯ä»¥åœ¨åº”ç”¨ç¨‹åºå±æ€§ä¸­ä½¿ç”¨ä»¥ä¸‹æ ¼å¼:</p><ul><li>å¸¸è§„çš„ <code>int</code> è¡¨ç¤ºå½¢å¼ (ä½¿ç”¨å¤©ä½œä¸ºé»˜è®¤å•ä½, é™¤éå·²æŒ‡å®š <code>@PeriodUnit</code>)</li><li><a href="https://docs.oracle.com/javase/17/docs/api/java/time/Period.html#parse-java.lang.CharSequence-"><code>java.time.Period</code></a> ä½¿ç”¨çš„æ ‡å‡† ISO-8601 æ ¼å¼ã€‚</li><li>å°†å€¼å’Œå•ä½å¯¹è€¦åˆåœ¨ä¸€èµ· (e.g. <code>1y3d</code> è¡¨ç¤º 1 å¹´é›¶ 3 å¤©)</li></ul><p>ç®€å•æ ¼å¼æ”¯æŒä»¥ä¸‹å•ä½:</p><ul><li><code>y</code> å¹´</li><li><code>m</code> æœˆ</li><li><code>w</code> å‘¨</li><li><code>d</code> å¤©</li></ul><p><code>java.time.Period</code> ç±»å‹å®é™…ä¸Šä»ä¸å­˜å‚¨æ˜ŸæœŸæ•°, è¿™æ˜¯ä¸€ä¸ªå¿«æ·æ–¹å¼, è¡¨ç¤º â€œ7 daysâ€.</p><h5 id="è½¬æ¢-Data-Sizes"><a href="#è½¬æ¢-Data-Sizes" class="headerlink" title="è½¬æ¢ Data Sizes"></a>è½¬æ¢ Data Sizes</h5><p>Spring Framework æœ‰ä¸€ä¸ª <code>DataSize</code> å€¼ç±»å‹, å…è®¸ä»¥å­—èŠ‚è¡¨ç¤ºå¤§å°. å¦‚æœæš´éœ²ä¸€ä¸ª <code>DataSize</code> å±æ€§, åˆ™å¯ä»¥åœ¨åº”ç”¨ç¨‹åºå±æ€§ä¸­ä½¿ç”¨ä»¥ä¸‹æ ¼å¼:</p><ul><li>å¸¸è§„çš„ <code>long</code> è¡¨ç¤º (ä½¿ç”¨å­—èŠ‚ä½œä¸ºé»˜è®¤å•ä½, é™¤éæŒ‡å®šäº† <code>@DataSizeUnit</code>)</li><li>æ›´å…·æœ‰å¯è¯»æ€§çš„æ ¼å¼, å€¼å’Œå•ä½åœ¨ä¸€èµ· (ä¾‹å¦‚ <code>10MB</code> è¡¨ç¤º 10 å…†å­—èŠ‚)</li></ul><p>è¯·æ€è€ƒä»¥ä¸‹ç¤ºä¾‹:</p><p>Java</p><p>Kotlin</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ConfigurationProperties(&quot;my&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyProperties</span> &#123;<br>    <span class="hljs-meta">@DataSizeUnit(DataUnit.MEGABYTES)</span>    <span class="hljs-keyword">private</span> <span class="hljs-type">DataSize</span> <span class="hljs-variable">bufferSize</span> <span class="hljs-operator">=</span> DataSize.ofMegabytes(<span class="hljs-number">2</span>);<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">DataSize</span> <span class="hljs-variable">sizeThreshold</span> <span class="hljs-operator">=</span> DataSize.ofBytes(<span class="hljs-number">512</span>);<br>    <span class="hljs-comment">// getters/setters...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>è¦æŒ‡å®š <code>10</code> å…†å­—èŠ‚çš„ç¼“å†²å¤§å°, ä½¿ç”¨ <code>10</code> å’Œ <code>10MB</code> æ˜¯ç­‰æ•ˆçš„. <code>256</code> å­—èŠ‚çš„å¤§å°å¯ä»¥æŒ‡å®šä¸º <code>256</code> æˆ– <code>256B</code>.</p><p>æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ä»»ä½•æ”¯æŒçš„å•ä½:</p><ul><li><code>B</code> å­—èŠ‚</li><li><code>KB</code> åƒå­—èŠ‚</li><li><code>MB</code> å…†å­—èŠ‚</li><li><code>GB</code> åƒå…†å­—èŠ‚</li><li><code>TB</code> å…†å…†å­—èŠ‚</li></ul><p>é»˜è®¤å•ä½æ˜¯å­—èŠ‚, å¯ä»¥ä½¿ç”¨ <code>@DataSizeUnit</code> é…åˆä¸Šé¢çš„å•ä½é‡å†™.</p><p>å¦‚æœæ‚¨æ›´å–œæ¬¢ä½¿ç”¨æ„é€ å‡½æ•°ç»‘å®šï¼Œåˆ™å¯ä»¥å…¬å¼€ç›¸åŒçš„å±æ€§ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><p>Java</p><p>Kotlin</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@ConfigurationProperties(<span class="hljs-string">&quot;my&quot;</span>)</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyProperties</span> &#123;<br>    <span class="hljs-comment">// fields...</span><br>    <span class="hljs-keyword">public</span> MyProperties(<span class="hljs-meta">@DataSizeUnit(DataUnit.MEGABYTES)</span> <span class="hljs-meta">@DefaultValue(<span class="hljs-string">&quot;2MB&quot;</span>)</span> DataSize bufferSize,            <span class="hljs-meta">@DefaultValue(<span class="hljs-string">&quot;512B&quot;</span>)</span> DataSize sizeThreshold) &#123;        <span class="hljs-keyword">this</span>.bufferSize = bufferSize;        <span class="hljs-keyword">this</span>.sizeThreshold = sizeThreshold;    &#125;<br>    <span class="hljs-comment">// getters...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœæ‚¨è¦å‡çº§ <code>Long</code> å±æ€§ï¼Œå¦‚æœå®ƒä¸æ˜¯å­—èŠ‚ï¼Œè¯·ç¡®ä¿å®šä¹‰å•ä½ï¼ˆä½¿ç”¨ <code>@DataSizeUnit</code>ï¼‰ã€‚ è¿™æ ·åšæä¾›äº†ä¸€ä¸ªé€æ˜çš„å‡çº§è·¯å¾„ï¼ŒåŒæ—¶æ”¯æŒæ›´ä¸°å¯Œçš„æ ¼å¼ã€‚</p><h4 id="2-8-9-ConfigurationProperties-éªŒè¯"><a href="#2-8-9-ConfigurationProperties-éªŒè¯" class="headerlink" title="2.8.9. @ConfigurationProperties éªŒè¯"></a>2.8.9. @ConfigurationProperties éªŒè¯</h4><p>åªè¦ä½¿ç”¨äº† Spring çš„ <code>@Validated</code> æ³¨è§£, Spring Boot å°±ä¼šå°è¯•éªŒè¯ <code>@ConfigurationProperties</code> ç±». æ‚¨å¯ä»¥ç›´æ¥åœ¨é…ç½®ç±»ä¸Šä½¿ç”¨ JSR-303 <code>javax.validation</code> çº¦æŸæ³¨è§£. ä¸ºæ­¤, è¯·ç¡®ä¿ JSR-303 å®ç°åœ¨ classpath ä¸Š, ç„¶åå°†çº¦æŸæ³¨è§£æ·»åŠ åˆ°å­—æ®µä¸Š, å¦‚ä¸‹æ‰€ç¤º:</p><p>Java</p><p>Kotlin</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@ConfigurationProperties</span>(<span class="hljs-string">&quot;my.service&quot;</span>)<span class="hljs-variable">@Validatedpublic</span> class MyProperties &#123;<br>    <span class="hljs-variable">@NotNull</span>    private InetAddress remoteAddress;<br>    <span class="hljs-comment">// getters/setters...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>æ‚¨è¿˜å¯ä»¥é€šè¿‡ä½¿ç”¨ <code>@Validated</code> æ³¨è§£åˆ›å»ºé…ç½®å±æ€§çš„ <code>@Bean</code> æ–¹æ³•æ¥è§¦å‘éªŒè¯.</p><p>è™½ç„¶ç»‘å®šæ—¶ä¹Ÿä¼šéªŒè¯åµŒå¥—å±æ€§, ä½†æœ€å¥½çš„åšæ³•è¿˜æ˜¯å°†å…³è”å­—æ®µæ³¨è§£ä¸Š <code>@Valid</code>. è¿™å¯ç¡®ä¿å³ä½¿æœªæ‰¾åˆ°åµŒå¥—å±æ€§ä¹Ÿä¼šè§¦å‘éªŒè¯. ä»¥ä¸‹ç¤ºä¾‹åŸºäºå‰é¢çš„ <code>MyProperties</code> ç¤ºä¾‹:</p><p>Java</p><p>Kotlin</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@ConfigurationProperties</span>(<span class="hljs-string">&quot;my.service&quot;</span>)<span class="hljs-variable">@Validatedpublic</span> class MyProperties &#123;<br>    <span class="hljs-variable">@NotNull</span>    private InetAddress remoteAddress;<br>    <span class="hljs-variable">@Valid</span>    private final Security security = new <span class="hljs-built_in">Security</span>();<br>    <span class="hljs-comment">// getters/setters...</span><br>    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">static</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">Security</span> &#123;<br>        <span class="hljs-variable">@NotEmpty</span>        private String username;<br>        <span class="hljs-comment">// getters/setters...</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‚¨è¿˜å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªåä¸º <code>configurationPropertiesValidator</code> çš„ bean å®šä¹‰æ¥æ·»åŠ è‡ªå®šä¹‰ Spring <code>Validator</code>. åº”è¯¥å°† <code>@Bean</code> æ–¹æ³•å£°æ˜ä¸º <code>static</code>. é…ç½®å±æ€§éªŒè¯å™¨åœ¨åº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸçš„æ—©æœŸåˆ›å»º, å°† <code>@Bean</code> æ–¹æ³•å£°æ˜ä¸º <code>static</code> å¯ä»¥æ— éœ€å®ä¾‹åŒ– <code>@Configuration</code> ç±»æ¥åˆ›å»º bean. è¿™æ ·åšå¯ä»¥é¿å…æ—©æœŸå®ä¾‹åŒ–å¯èƒ½å¯¼è‡´çš„æ„å¤–é—®é¢˜. è¿™é‡Œæœ‰ä¸€ä¸ªå±æ€§éªŒè¯ç¤ºä¾‹, è®²è§£äº†å¦‚ä½•è®¾ç½®.</p><p><code>spring-boot-actuator</code> æ¨¡å—åŒ…æ‹¬ä¸€ä¸ªæš´éœ²æ‰€æœ‰ <code>@ConfigurationProperties</code> bean çš„ç«¯ç‚¹. å¯å°† Web æµè§ˆå™¨æŒ‡å‘ <code>/actuator/configprops</code> æˆ–ä½¿ç”¨ç­‰æ•ˆçš„ JMX ç«¯ç‚¹. æœ‰å…³è¯¦ç»†ä¿¡æ¯, è¯·å‚é˜… â€œ<a href="https://sca.aliyun.com/learn/spring-boot/core/actuator.html#actuator.endpoints">ç”Ÿäº§å°±ç»ªåŠŸèƒ½</a>â€ éƒ¨åˆ†.</p><h4 id="2-8-10-ConfigurationProperties-vs-Value"><a href="#2-8-10-ConfigurationProperties-vs-Value" class="headerlink" title="2.8.10. @ConfigurationProperties vs. @Value"></a>2.8.10. @ConfigurationProperties vs. @Value</h4><p><code>@Value</code> æ³¨è§£æ˜¯æ ¸å¿ƒå®¹å™¨åŠŸèƒ½, å®ƒä¸æä¾›ä¸ç±»å‹å®‰å…¨é…ç½®å±æ€§ç›¸åŒçš„åŠŸèƒ½. ä¸‹è¡¨æ€»ç»“äº† <code>@ConfigurationProperties</code> å’Œ <code>@Value</code> æ”¯æŒçš„åŠŸèƒ½:</p><p>åŠŸèƒ½</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@ConfigurationProperties</span><br><span class="hljs-variable">@Value</span><br></code></pre></td></tr></table></figure><p><a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.external-config.typesafe-configuration-properties.relaxed-binding">å®½æ¾ç»‘å®š</a></p><p>Yes</p><p>æœ‰é™åˆ¶ (æŸ¥çœ‹ <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.external-config.typesafe-configuration-properties.vs-value-annotation.note">note below</a>)</p><p><a href="https://sca.aliyun.com/learn/spring-boot/core/configuration-metadata.html#appendix.configuration-metadata">å…ƒæ•°æ®æ”¯æŒ</a></p><p>Yes</p><p>No</p><p><code>SpEL</code> è¡¨è¾¾å¼</p><p>No</p><p>Yes</p><p>å¦‚æœæ‚¨ç¡®å®æƒ³ä½¿ç”¨ <code>@Value</code>, æˆ‘ä»¬å»ºè®®æ‚¨ä»¥è§„èŒƒå½¢å¼å¼•ç”¨å±æ€§åç§°( kebab-case ä»…ä½¿ç”¨å°å†™å­—æ¯), è¿™ä¸ Spring Boot <code>@ConfigurationProperties</code> <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.external-config.typesafe-configuration-properties.relaxed-binding">å®½æ¾ç»‘å®š</a> ä½¿ç”¨ç›¸åŒçš„é€»è¾‘.</p><p>ä¾‹å¦‚, <code>@Value(&quot;$&#123;demo.item-price&#125;&quot;)</code> å°†ä» <code>application.properties</code> æ–‡ä»¶ä»¥åŠ <code>DEMO_ITEMPRICE</code> ç¯å¢ƒå˜é‡ä¸­è·å– <code>demo.item-price</code> å’Œ <code>demo.itemPrice</code> å½¢å¼. å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ <code>@Value(&quot;$&#123;demo.itemPrice&#125;&quot;)</code> , åˆ™ä¸ä¼šè€ƒè™‘ <code>demo.item-price</code> å’Œ <code>DEMO_ITEMPRICE</code> ç¯å¢ƒå˜é‡.</p><p>å¦‚æœæ‚¨è¦ä¸ºè‡ªå·±çš„ç»„ä»¶å®šä¹‰ä¸€ç»„é…ç½® key, æˆ‘ä»¬å»ºè®®æ‚¨å°†å®ƒä»¬åˆ†ç»„åˆ°ä½¿ç”¨ <code>@ConfigurationProperties</code> æ³¨è§£çš„ POJO ä¸­.è¿™æ ·åšå°†ä¸ºæ‚¨æä¾›ç»“æ„åŒ–, ç±»å‹å®‰å…¨çš„å¯¹è±¡, æ‚¨å¯ä»¥å°†å…¶æ³¨å…¥åˆ°è‡ªå·±çš„ bean ä¸­.</p><p>è§£æè¿™äº›æ–‡ä»¶å¹¶å¡«å……ç¯å¢ƒæ—¶, ä¸ä¼šå¤„ç†æ¥è‡ª <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.external-config.files">åº”ç”¨ç¨‹åºå±æ€§æ–‡ä»¶</a> çš„ SpEL è¡¨è¾¾å¼. ä½†æ˜¯, å¯ä»¥åœ¨ <code>@Value</code> ä¸­ç¼–å†™ SpEL è¡¨è¾¾å¼. å¦‚æœ <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.external-config.files">åº”ç”¨ç¨‹åºå±æ€§æ–‡ä»¶</a> ä¸­çš„å±æ€§å€¼æ˜¯ SpEL è¡¨è¾¾å¼, åˆ™åœ¨é€šè¿‡ <code>@Value</code> è¿›è¡Œä½¿ç”¨æ—¶å°†å¯¹å…¶è¿›è¡Œè¯„ä¼°.</p><h2 id="3-Profiles"><a href="#3-Profiles" class="headerlink" title="3. Profiles"></a>3. Profiles</h2><p>Spring Profile æä¾›äº†ä¸€ç§èƒ½å¤Ÿå°†åº”ç”¨ç¨‹åºçš„éƒ¨åˆ†é…ç½®éš”ç¦»ï¼Œå¹¶ä½¿å…¶ä»…åœ¨ç‰¹å®šç¯å¢ƒä¸­å¯ç”¨çš„æ–¹æ³•. å¯ä»¥ä½¿ç”¨ <code>@Profile</code> æ¥æ³¨è§£ä»»ä½• <code>@Component</code> æˆ– <code>@Configuration</code> æˆ– <code>@ConfigurationProperties</code> ä»¥æŒ‡å®šä½•æ—¶åŠ è½½å®ƒ, å¦‚ä¸‹æ‰€ç¤º:</p><p>Java</p><p>Kotlin</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Configuration</span>(proxyBeanMethods = false)<span class="hljs-variable">@Profile</span>(<span class="hljs-string">&quot;production&quot;</span>)public class ProductionConfiguration &#123;<br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœ <code>@ConfigurationProperties</code> Bean æ˜¯é€šè¿‡ <code>@EnableConfigurationProperties</code> è€Œéè‡ªåŠ¨æ‰«ææ³¨å†Œçš„, åˆ™éœ€è¦åœ¨ <code>@EnableConfigurationProperties</code> æ³¨è§£çš„ <code>@Configuration</code> ç±»ä¸ŠæŒ‡å®š <code>@Profile</code> æ³¨è§£. åœ¨æ‰«æ <code>@ConfigurationProperties</code> çš„æƒ…å†µä¸‹, å¯ä»¥åœ¨ <code>@ConfigurationProperties</code> ç±»æœ¬èº«ä¸ŠæŒ‡å®š <code>@Profile</code>.</p><p>æ‚¨å¯ä»¥ä½¿ç”¨ <code>spring.profiles.active</code> <code>Environment</code> å±æ€§æŒ‡å®šå“ªäº›é…ç½®æ–‡ä»¶å¤„äºæ¿€æ´»çŠ¶æ€. æ‚¨å¯ä»¥ä½¿ç”¨æœ¬ç« å‰é¢ä»‹ç»çš„ä»»ä½•æ–¹æ³•æŒ‡å®šå±æ€§. ä¾‹å¦‚, æ‚¨å¯ä»¥å°†å…¶åŒ…å«åœ¨ <code>application.properties</code> ä¸­, å¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">spring:</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">  profiles:</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">    active:</span> <span class="hljs-string">&quot;dev,hsqldb&quot;</span><br></code></pre></td></tr></table></figure><p>æ‚¨è¿˜å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸Šä½¿ç”¨ä»¥ä¸‹å¼€å…³æŒ‡å®šå®ƒ: <code>--spring.profiles.active=dev,hsqldb</code>.</p><p>å¦‚æœæ²¡æœ‰é…ç½®æ–‡ä»¶å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œåˆ™å¯ç”¨é»˜è®¤é…ç½®æ–‡ä»¶ã€‚ é»˜è®¤é…ç½®æ–‡ä»¶çš„åç§°æ˜¯ <code>default</code>ï¼Œå¯ä»¥ä½¿ç”¨ <code>spring.profiles.default</code> <code>Environment</code> å±æ€§å¯¹å…¶è¿›è¡Œè°ƒæ•´ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤º:</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">spring:</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">  profiles:</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">    default:</span> <span class="hljs-string">&quot;none&quot;</span><br></code></pre></td></tr></table></figure><p><code>spring.profiles.active</code> å’Œ <code>spring.profiles.default</code> åªèƒ½åœ¨éé…ç½®æ–‡ä»¶ç‰¹å®šçš„æ–‡æ¡£ä¸­ä½¿ç”¨ã€‚ è¿™æ„å‘³ç€å®ƒä»¬ä¸èƒ½åœ¨ <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.external-config.files.profile-specific">profile specific files</a> æˆ– <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.external-config.files.activation-properties">documents activated</a> ä¸­åŒ…å« <code>spring.config.activate.on-profile</code>ã€‚</p><p>ä¾‹å¦‚, ç¬¬äºŒä¸ªæ–‡æ¡£é…ç½®æ— æ•ˆ:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># this document is valid</span><br><br><span class="hljs-attr">spring:</span><br><br>  <span class="hljs-attr">profiles:</span><br><br>    <span class="hljs-attr">active:</span> <span class="hljs-string">&quot;prod&quot;</span><br><br><span class="hljs-meta">---</span><br><span class="hljs-meta"></span><br><span class="hljs-comment"># this document is invalid</span><br><br><span class="hljs-attr">spring:</span><br><br>  <span class="hljs-attr">config:</span><br><br>    <span class="hljs-attr">activate:</span><br><br>      <span class="hljs-attr">on-profile:</span> <span class="hljs-string">&quot;prod&quot;</span><br><br>  <span class="hljs-attr">profiles:</span><br><br>    <span class="hljs-attr">active:</span> <span class="hljs-string">&quot;metrics&quot;</span><br></code></pre></td></tr></table></figure><h3 id="3-1-æ·»åŠ æ¿€æ´»-Profile"><a href="#3-1-æ·»åŠ æ¿€æ´»-Profile" class="headerlink" title="3.1. æ·»åŠ æ¿€æ´» Profile"></a>3.1. æ·»åŠ æ¿€æ´» Profile</h3><p><code>spring.profiles.active</code> å±æ€§éµå¾ªä¸å…¶ä»–å±æ€§ç›¸åŒçš„æ’åºè§„åˆ™: åº”ç”¨ä¼˜å…ˆçº§æœ€é«˜çš„ <code>PropertySource</code>. è¿™æ„å‘³ç€æ‚¨å¯ä»¥åœ¨ <code>application.properties</code> ä¸­æŒ‡å®šæ¿€æ´»é…ç½®æ–‡ä»¶, ç„¶åä½¿ç”¨å‘½ä»¤è¡Œåˆ‡æ¢æ›¿æ¢å®ƒä»¬.</p><p>æœ‰æ—¶, å°†ç‰¹å®š profile çš„å±æ€§æ·»åŠ åˆ°æ¿€æ´»é…ç½®æ–‡ä»¶è€Œä¸æ˜¯æ›¿æ¢å®ƒä»¬, è¿™ç§æ–¹å¼ä¹Ÿæ˜¯å¾ˆæœ‰ç”¨çš„.<code>spring.profiles.include</code> å±æ€§å¯ç”¨äºåœ¨ <code>spring.profiles.active</code> å±æ€§æ¿€æ´»çš„é…ç½®æ–‡ä»¶ä¹‹ä¸Šæ·»åŠ æ¿€æ´»çš„é…ç½®æ–‡ä»¶ã€‚</p><p><code>SpringApplication</code> å…¥å£è¿˜æœ‰ä¸€ä¸ª Java API, ç”¨äºè®¾ç½®å…¶ä»– profileï¼Œè¯·å‚é˜… <a href="https://docs.spring.io/spring-boot/docs/3.0.0/api/org/springframework/boot/SpringApplication.html">SpringApplication</a> çš„ <code>setAdditionalProfiles()</code> æ–¹æ³•.</p><p>ä¾‹å¦‚ï¼Œå½“è¿è¡Œå…·æœ‰ä»¥ä¸‹å±æ€§çš„åº”ç”¨ç¨‹åºæ—¶ï¼Œå³ä½¿ä½¿ç”¨ â€”spring.profiles.active è¿è¡Œï¼Œä¹Ÿä¼šæ¿€æ´» common å’Œ local é…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">spring:</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">  profiles:</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">    include:</span><br><br>      - <span class="hljs-string">&quot;common&quot;</span><br><br>      - <span class="hljs-string">&quot;local&quot;</span><br></code></pre></td></tr></table></figure><p>ä¸ <code>spring.profiles.active</code> ä¸€æ ·, <code>spring.profiles.include</code> åªèƒ½åœ¨éé…ç½®æ–‡ä»¶ç‰¹å®šçš„æ–‡æ¡£ä¸­ä½¿ç”¨. è¿™æ„å‘³ç€å®ƒä»¬ä¸èƒ½åœ¨ <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.external-config.files.profile-specific">profile specific files</a> æˆ– <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.external-config.files.activation-properties">documents activated</a> åŒ…å« <code>spring.config.activate.on-profile</code>.</p><p>å¦‚æœç»™å®šçš„ Profile æ˜¯æ¿€æ´»çš„ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ Profile ç»„(å°†åœ¨ <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.profiles.groups">ä¸‹ä¸€èŠ‚ä¸­</a> è¿›è¡Œæè¿°)æ·»åŠ æ¿€æ´»çš„é…ç½®æ–‡ä»¶:</p><h3 id="3-2-Profile-ç»„"><a href="#3-2-Profile-ç»„" class="headerlink" title="3.2. Profile ç»„"></a>3.2. Profile ç»„</h3><p>æœ‰æ—¶ï¼Œæ‚¨åœ¨åº”ç”¨ç¨‹åºä¸­å®šä¹‰å’Œä½¿ç”¨çš„ Profile ç²’åº¦å¤ªç»†ï¼Œä½¿ç”¨èµ·æ¥å¾ˆéº»çƒ¦. ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <code>proddb</code> å’Œ <code>prodmq</code> Profile ç‹¬ç«‹åœ°å¯ç”¨æ•°æ®åº“å’Œæ¶ˆæ¯ä¼ é€’ç‰¹æ€§.</p><p>ä¸ºäº†å¸®åŠ©å®ç°è¿™ä¸€ç‚¹ï¼ŒSpring Boot å…è®¸æ‚¨å®šä¹‰ Profile ç»„. Profile ç»„å…è®¸æ‚¨ä¸ºç›¸å…³çš„ Profile ç»„å®šä¹‰é€»è¾‘åç§°.</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªç”± <code>proddb</code> å’Œ <code>prodmq</code> é…ç½®æ–‡ä»¶ç»„æˆçš„ <code>production</code> ç»„.</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">spring:</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">  profiles:</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">    group:</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">      production:</span><br><br>      - <span class="hljs-string">&quot;proddb&quot;</span><br><br>      - <span class="hljs-string">&quot;prodmq&quot;</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºç°åœ¨å¯ä»¥ä½¿ç”¨ <code>--spring.profiles.active=production</code> å¯åŠ¨. ä¸€æ¬¡æ€§æ¿€æ´» <code>production</code>, <code>proddb</code> å’Œ <code>prodmq</code> é…ç½®æ–‡ä»¶.</p><h3 id="3-3-ä»¥ç¼–ç¨‹æ–¹å¼è®¾ç½®-Profiles"><a href="#3-3-ä»¥ç¼–ç¨‹æ–¹å¼è®¾ç½®-Profiles" class="headerlink" title="3.3. ä»¥ç¼–ç¨‹æ–¹å¼è®¾ç½® Profiles"></a>3.3. ä»¥ç¼–ç¨‹æ–¹å¼è®¾ç½® Profiles</h3><p>æ‚¨å¯ä»¥åœ¨åº”ç”¨ç¨‹åºè¿è¡Œä¹‹å‰é€šè¿‡è°ƒç”¨ <code>SpringApplication.setAdditionalProfiles(â€¦)</code> ä»¥ç¼–ç¨‹æ–¹å¼è®¾ç½® active é…ç½®æ–‡ä»¶. ä¹Ÿå¯ä»¥ä½¿ç”¨ Spring çš„ <code>ConfigurableEnvironment</code> æ¥å£æ¿€æ´» profile.</p><h3 id="3-4-ç‰¹å®š-Profile-çš„é…ç½®æ–‡ä»¶"><a href="#3-4-ç‰¹å®š-Profile-çš„é…ç½®æ–‡ä»¶" class="headerlink" title="3.4. ç‰¹å®š Profile çš„é…ç½®æ–‡ä»¶"></a>3.4. ç‰¹å®š Profile çš„é…ç½®æ–‡ä»¶</h3><p>ç‰¹å®š profile çš„ <code>application.properties</code> (æˆ– <code>application.yml</code>) å’Œé€šè¿‡ <code>@ConfigurationProperties</code> å¼•ç”¨çš„æ–‡ä»¶è¢«å½“åšæ–‡ä»¶å¹¶åŠ è½½. æœ‰å…³è¯¦ç»†ä¿¡æ¯, è¯·å‚è§ â€œ<a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.external-config.files.profile-specific">ç‰¹å®š Profile çš„å±æ€§æ–‡ä»¶</a>â€.</p><h2 id="4-æ—¥å¿—è®°å½•"><a href="#4-æ—¥å¿—è®°å½•" class="headerlink" title="4. æ—¥å¿—è®°å½•"></a>4. æ—¥å¿—è®°å½•</h2><p>Spring Boot ä½¿ç”¨ <a href="https://commons.apache.org/logging">Commons Logging</a> è®°å½•æ‰€æœ‰å†…éƒ¨æ—¥å¿—, ä½†ä¿ç•™åº•å±‚æ—¥å¿—å®ç°. å…¶ä¸º <a href="https://docs.oracle.com/javase/17/docs/api/java/util/logging/package-summary.html">Java Util Logging</a>, <a href="https://logging.apache.org/log4j/2.x/">Log4J2</a> å’Œ <a href="https://logback.qos.ch/">Logback</a> æä¾›äº†é»˜è®¤é…ç½®. æ¯ç§æ—¥å¿—è®°å½•å™¨éƒ½é¢„å…ˆé…ç½®ä¸ºä½¿ç”¨æ§åˆ¶å°è¾“å‡º, å¹¶ä¸”è¿˜æä¾›å¯é€‰çš„æ–‡ä»¶è¾“å‡º.</p><p>é»˜è®¤æƒ…å†µä¸‹, å¦‚æœæ‚¨ä½¿ç”¨äº† <code>Starter</code>, åˆ™ä½¿ç”¨ Logback è¿›è¡Œæ—¥å¿—è®°å½•.è¿˜åŒ…æ‹¬åˆé€‚çš„ Logback è·¯ç”±, ä»¥ç¡®ä¿åœ¨ä½¿ç”¨ Java Util Loggingã€Commons Loggingã€Log4J æˆ– SLF4J çš„ä¾èµ–åº“éƒ½èƒ½æ­£å¸¸å·¥ä½œ.</p><p>Java æœ‰å¾ˆå¤šæ—¥å¿—æ¡†æ¶å¯ä¾›ä½¿ç”¨. å¦‚æœä»¥ä¸Šåˆ—è¡¨è®©æ‚¨æ„Ÿåˆ°å›°æƒ‘, è¯·ä¸è¦æ‹…å¿ƒ. é€šå¸¸, æ‚¨ä¸éœ€è¦æ›´æ”¹æ—¥å¿—ä¾èµ–, å¹¶ä¸” Spring Boot æä¾›çš„é»˜è®¤é…ç½®å¯ä»¥ä¿è¯æ—¥å¿—æ­£å¸¸å·¥ä½œ.</p><p>å°†åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ° Servlet å®¹å™¨æˆ–åº”ç”¨ç¨‹åºæœåŠ¡å™¨æ—¶, é€šè¿‡ Java Util Logging API æ‰§è¡Œçš„æ—¥å¿—è®°å½•ä¸ä¼šè·¯ç”±åˆ°åº”ç”¨ç¨‹åºçš„æ—¥å¿—ä¸­. è¿™æ ·å¯ä»¥é˜²æ­¢å®¹å™¨æˆ–å…¶ä»–å·²éƒ¨ç½²åˆ°å®¹å™¨ä¸­çš„åº”ç”¨ç¨‹åºæ‰§è¡Œçš„æ—¥å¿—è®°å½•å‡ºç°åœ¨åº”ç”¨ç¨‹åºçš„æ—¥å¿—ä¸­.</p><h3 id="4-1-æ—¥å¿—æ ¼å¼"><a href="#4-1-æ—¥å¿—æ ¼å¼" class="headerlink" title="4.1. æ—¥å¿—æ ¼å¼"></a>4.1. æ—¥å¿—æ ¼å¼</h3><p>Spring Boot é»˜è®¤æ—¥å¿—è¾“å‡ºç±»ä¼¼äºä»¥ä¸‹ç¤ºä¾‹:</p><p>2019-03-05 10:57:51.112 INFO 45469 â€” [ main] org.apache.catalina.core.StandardEngine : Starting Servlet Engine: Apache Tomcat&#x2F;7.0.52 2019-03-05 10:57:51.253 INFO 45469 â€” [ost-startStop-1] o.a.c.c.C.[Tomcat].[localhost].[&#x2F;] : Initializing Spring embedded WebApplicationContext 2019-03-05 10:57:51.253 INFO 45469 â€” [ost-startStop-1] o.s.web.context.ContextLoader : Root WebApplicationContext: initialization completed in 1358 ms 2019-03-05 10:57:51.698 INFO 45469 â€” [ost-startStop-1] o.s.b.c.e.ServletRegistrationBean : Mapping servlet: â€˜dispatcherServletâ€™ to [&#x2F;] 2019-03-05 10:57:51.702 INFO 45469 â€” [ost-startStop-1] o.s.b.c.embedded.FilterRegistrationBean : Mapping filter: â€˜hiddenHttpMethodFilterâ€™ to: [&#x2F;*]</p><p>è¾“å‡ºä»¥ä¸‹é¡¹:</p><ul><li>æ—¥æœŸå’Œæ—¶é—´: æ¯«ç§’ç²¾åº¦, æ˜“äºæ’åº.</li><li>æ—¥å¿—çº§åˆ«: <code>ERROR</code>ã€<code>WARN</code>ã€<code>INFO</code>ã€<code>DEBUG</code> æˆ– <code>TRACE</code>.</li><li>è¿›ç¨‹ ID.</li><li>ä¸€ä¸ª <code>---</code> åˆ†éš”ç¬¦, ç”¨äºåŒºåˆ†å®é™…æ—¥å¿—å†…å®¹çš„å¼€å§‹.</li><li>çº¿ç¨‹åç§°: åœ¨æ–¹æ‹¬å·ä¸­ (å¯èƒ½ä¼šæˆªæ–­æ§åˆ¶å°è¾“å‡º) .</li><li>æ—¥å¿—è®°å½•å™¨åç§°: è¿™é€šå¸¸æ˜¯æºç±»åç§° (é€šå¸¸ä¸ºç¼©å†™) .</li><li>æ—¥å¿—å†…å®¹.</li></ul><p>Logback æ²¡æœ‰ <code>FATAL</code> çº§åˆ«. è¯¥çº§åˆ«æ˜ å°„åˆ° <code>ERROR</code>.</p><h3 id="4-2-æ§åˆ¶å°è¾“å‡º"><a href="#4-2-æ§åˆ¶å°è¾“å‡º" class="headerlink" title="4.2. æ§åˆ¶å°è¾“å‡º"></a>4.2. æ§åˆ¶å°è¾“å‡º</h3><p>é»˜è®¤æ—¥å¿—é…ç½®ä¼šåœ¨å†™å…¥æ—¶å°†æ¶ˆæ¯å›æ˜¾åˆ°æ§åˆ¶å°. é»˜è®¤æƒ…å†µä¸‹, ä¼šè®°å½• <code>ERROR</code>ã€<code>WARN</code> å’Œ <code>INFO</code> çº§åˆ«çš„æ—¥å¿—. æ‚¨è¿˜å¯ä»¥é€šè¿‡ä½¿ç”¨ <code>--debug</code> æ ‡å¿—å¯åŠ¨åº”ç”¨ç¨‹åºæ¥å¯ç”¨è°ƒè¯•æ¨¡å¼.</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">$ <span class="hljs-keyword">java </span>-<span class="hljs-keyword">jar </span>myapp.<span class="hljs-keyword">jar </span>--<span class="hljs-built_in">debug</span><br></code></pre></td></tr></table></figure><p>æ‚¨è¿˜å¯ä»¥åœ¨ <code>application.properties</code> ä¸­æŒ‡å®š <code>debug=true</code>.</p><p>å¯ç”¨è°ƒè¯•æ¨¡å¼å, æ ¸å¿ƒæ—¥å¿—è®°å½•å™¨ (å†…åµŒå®¹å™¨ã€Hibernate å’Œ Spring Boot) å°†è¢«é…ç½®ä¸ºè¾“å‡ºæ›´å¤šæ—¥å¿—ä¿¡æ¯. å¯ç”¨è°ƒè¯•æ¨¡å¼ä¸ä¼šå°†åº”ç”¨ç¨‹åºé…ç½®ä¸ºä½¿ç”¨ <code>DEBUG</code> çº§åˆ«è®°å½•æ‰€æœ‰æ—¥å¿—å†…å®¹.</p><p>æˆ–è€…, æ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨ <code>--trace</code> æ ‡å¿— (æˆ–åœ¨ <code>application.properties</code> ä¸­çš„è®¾ç½® <code>trace=true</code>) å¯åŠ¨åº”ç”¨ç¨‹åºæ¥å¯ç”¨è·Ÿè¸ªæ¨¡å¼. è¿™æ ·åšå¯ä»¥ä¸ºé€‰æ‹©çš„æ ¸å¿ƒæ—¥å¿—è®°å½•å™¨ (å†…åµŒå®¹å™¨ã€Hibernate æ¨¡å¼ç”Ÿæˆå’Œæ•´ä¸ª Spring ç»„åˆ) å¯ç”¨æ—¥å¿—è¿½è¸ª.</p><h4 id="4-2-1-ç€è‰²è¾“å‡º"><a href="#4-2-1-ç€è‰²è¾“å‡º" class="headerlink" title="4.2.1. ç€è‰²è¾“å‡º"></a>4.2.1. ç€è‰²è¾“å‡º</h4><p>å¦‚æœæ‚¨çš„ç»ˆç«¯æ”¯æŒ ANSI, åˆ™å¯ä»¥ä½¿ç”¨é¢œè‰²è¾“å‡ºæ¥æé«˜å¯è¯»æ€§. æ‚¨å¯ä»¥å°† <code>spring.output.ansi.enabled</code> è®¾ç½®ä¸º <a href="https://docs.spring.io/spring-boot/docs/3.0.0/api/org/springframework/boot/ansi/AnsiOutput.Enabled.html">å—æ”¯æŒçš„å€¼</a> ä»¥è¦†ç›–è‡ªåŠ¨æ£€æµ‹:</p><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs haml"><span class="hljs-tag">%<span class="hljs-selector-tag">clr</span>(%5p)</span><br></code></pre></td></tr></table></figure><p>ä¸‹è¡¨æè¿°æ—¥å¿—çº§åˆ«ä¸é¢œè‰²çš„æ˜ å°„å…³ç³»:</p><p>Level</p><p>Color</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">FATAL</span><br></code></pre></td></tr></table></figure><p>Red</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">ERROR</span><br></code></pre></td></tr></table></figure><p>Red</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">WARN</span><br></code></pre></td></tr></table></figure><p>Yellow</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">INFO</span><br></code></pre></td></tr></table></figure><p>Green</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">DEBUG</span><br></code></pre></td></tr></table></figure><p>Green</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">TRACE</span><br></code></pre></td></tr></table></figure><p>Green</p><p>æˆ–è€…, æ‚¨å¯ä»¥é€šè¿‡å°†å…¶ä½œä¸ºè½¬æ¢é€‰é¡¹æŒ‡å®šåº”ä½¿ç”¨çš„é¢œè‰²æˆ–æ ·å¼. ä¾‹å¦‚, è¦å°†æ–‡æœ¬å˜ä¸ºé»„è‰², è¯·ä½¿ç”¨ä»¥ä¸‹è®¾ç½®:</p><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs haml"><span class="hljs-tag">%<span class="hljs-selector-tag">clr</span>(%d&#123;yyyy-MM-dd&#x27;T&#x27;HH:mm:ss.SSSXXX&#125;)&#123;yellow&#125;</span><br></code></pre></td></tr></table></figure><p>æ”¯æŒä»¥ä¸‹é¢œè‰²å’Œæ ·å¼:</p><ul><li><code>blue</code></li><li><code>cyan</code></li><li><code>faint</code></li><li><code>green</code></li><li><code>magenta</code></li><li><code>red</code></li><li><code>yellow</code></li></ul><h3 id="4-3-æ–‡ä»¶è¾“å‡º"><a href="#4-3-æ–‡ä»¶è¾“å‡º" class="headerlink" title="4.3. æ–‡ä»¶è¾“å‡º"></a>4.3. æ–‡ä»¶è¾“å‡º</h3><p>é»˜è®¤æƒ…å†µä¸‹, Spring Boot ä»…è®°å½•åˆ°æ§åˆ¶å°, ä¸ä¼šå†™å…¥æ—¥å¿—æ–‡ä»¶. æƒ³é™¤äº†æ§åˆ¶å°è¾“å‡ºä¹‹å¤–è¿˜è¦å†™å…¥æ—¥å¿—æ–‡ä»¶, åˆ™éœ€è¦è®¾ç½® <code>logging.file.name</code> æˆ– <code>logging.file.path</code> å±æ€§ (ä¾‹å¦‚, åœ¨ <code>application.properties</code> ä¸­) .</p><p>ä¸‹è¡¨å±•ç¤ºäº†å¦‚ä½•ä¸ <code>logging.*</code> å±æ€§ä¸€èµ·ä½¿ç”¨:</p><p>Table 5. Logging å±æ€§</p><p>configprop: logging .file.name []</p><p>configprop: logging .file.path []</p><p>Example</p><p>Description</p><p><em>(none)</em></p><p><em>(none)</em></p><p>ä»…åœ¨æ§åˆ¶å°è¾“å‡º</p><p>æŒ‡å®šæ–‡ä»¶</p><p><em>(none)</em></p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-keyword">my</span>.<span class="hljs-built_in">log</span><br></code></pre></td></tr></table></figure><p>å†™å…¥æŒ‡å®šçš„æ—¥å¿—æ–‡ä»¶. åç§°å¯ä»¥æ˜¯ç»å¯¹ä½ç½®æˆ–ç›¸å¯¹äºå½“å‰ç›®å½•.</p><p><em>(none)</em></p><p>æŒ‡å®šç›®å½•</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">/<span class="hljs-keyword">var</span>/<span class="hljs-built_in">log</span><br></code></pre></td></tr></table></figure><p>å°† <code>spring.log</code> å†™å…¥æŒ‡å®šçš„ç›®å½•. åç§°å¯ä»¥æ˜¯ç»å¯¹ä½ç½®æˆ–ç›¸å¯¹äºå½“å‰ç›®å½•.</p><p>æ—¥å¿—æ–‡ä»¶åœ¨è¾¾åˆ° <code>10MB</code> æ—¶ä¼šè½®è½¬, å¹¶ä¸”ä¸æ§åˆ¶å°è¾“å‡ºä¸€æ ·, é»˜è®¤æƒ…å†µä¸‹ä¼šè®°å½• <code>ERROR</code>ã€<code>WARN</code> å’Œ <code>INFO</code> çº§åˆ«çš„å†…å®¹.</p><p>æ—¥æ—¥å¿—å±æ€§ç‹¬ç«‹äºå®é™…çš„æ—¥å¿—åº•å±‚. å› æ­¤, spring Boot ä¸ç®¡ç†ç‰¹å®šçš„é…ç½® key (ä¾‹å¦‚ Logback çš„ <code>logback.configurationFile</code>) .</p><h3 id="4-4-File-Rotation"><a href="#4-4-File-Rotation" class="headerlink" title="4.4. File Rotation"></a>4.4. File Rotation</h3><p>å¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨ Logbackï¼Œåˆ™å¯ä»¥ä½¿ç”¨ <code>application.properties</code> æˆ– <code>application.yaml</code> è®¾ç½® log rotation. å¯¹äºæ‰€æœ‰å…¶ä»–æ—¥å¿—ç³»ç»Ÿï¼Œæ‚¨éœ€è¦è‡ªå·±ç›´æ¥é…ç½® rotation è®¾ç½®(ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨ä½¿ç”¨ Log4J2ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥æ·»åŠ ä¸€ä¸ª <code>log4j.xml</code> æˆ– <code>log4j2-spring.xml</code> æ–‡ä»¶).</p><p>æ”¯æŒä»¥ä¸‹ rotation ç­–ç•¥å±æ€§:</p><p>Name</p><p>Description</p><p>configprop: logging .logback.rollingpolicy.file-name-pattern []</p><p>The filename pattern used to create log archives.</p><p>configprop: logging .logback.rollingpolicy.clean-history-on-start []</p><p>If log archive cleanup should occur when the application starts.</p><p>configprop: logging .logback.rollingpolicy.max-file-size []</p><p>The maximum size of log file before it is archived.</p><p>configprop: logging .logback.rollingpolicy.total-size-cap []</p><p>The maximum amount of size log archives can take before being deleted.</p><p>configprop: logging .logback.rollingpolicy.max-history []</p><p>The maximum number of archive log files to keep (defaults to 7).</p><h3 id="4-5-æ—¥å¿—ç­‰çº§"><a href="#4-5-æ—¥å¿—ç­‰çº§" class="headerlink" title="4.5. æ—¥å¿—ç­‰çº§"></a>4.5. æ—¥å¿—ç­‰çº§</h3><p>æ‰€æœ‰å—æ”¯æŒçš„æ—¥å¿—è®°å½•ç³»ç»Ÿéƒ½å¯ä»¥ä½¿ç”¨ <code>logging.level.&lt;logger-name&gt;=&lt;level&gt;</code> æ¥è®¾ç½® Spring <code>Environment</code> ä¸­çš„è®°å½•å™¨ç­‰çº§ (ä¾‹å¦‚, åœ¨ <code>application.properties</code> ä¸­) . å…¶ä¸­ level æ˜¯ <code>TRACE</code>ã€<code>DEBUG</code>ã€<code>INFO</code>ã€<code>WARN</code>ã€<code>ERROR</code>ã€<code>FATAL</code> å’Œ <code>OFF</code> å…¶ä¸­ä¹‹ä¸€. å¯ä»¥ä½¿ç”¨ <code>logging.level.root</code> é…ç½® <code>root</code> è®°å½•å™¨.</p><p>ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº† <code>application.properties</code> ä¸­é»˜è®¤çš„æ—¥å¿—è®°å½•è®¾ç½®:</p><p>Properties</p><p>Yaml</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">logging.level.root</span>=warn<br><br><span class="hljs-attr">logging.level.org.springframework.web</span>=debug<br><br><span class="hljs-attr">logging.level.org.hibernate</span>=error<br></code></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ç¯å¢ƒå˜é‡è®¾ç½®æ—¥å¿—è®°å½•çº§åˆ«. ä¾‹å¦‚, <code>LOGGING_LEVEL_ORG_SPRINGFRAMEWORK_WEB=DEBUG</code> ä¼šå°† <code>org.springframework.web</code> è®¾ç½®ä¸º <code>DEBUG</code>.</p><p>ä»¥ä¸Šæ–¹æ³•ä»…é€‚ç”¨äºç¨‹åºåŒ…çº§åˆ«çš„æ—¥å¿—è®°å½•. ç”±äºå®½æ¾çš„ç»‘å®šæ€»æ˜¯å°†ç¯å¢ƒå˜é‡è½¬æ¢ä¸ºå°å†™, å› æ­¤æ— æ³•ä»¥è¿™ç§æ–¹å¼ä¸ºå•ä¸ªç±»é…ç½®æ—¥å¿—è®°å½•. å¦‚æœéœ€è¦ä¸ºç±»é…ç½®æ—¥å¿—è®°å½•, åˆ™å¯ä»¥ä½¿ç”¨ <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.external-config.application-json"><code>SPRING_APPLICATION_JSON</code></a> å˜é‡.</p><h3 id="4-6-æ—¥å¿—ç»„"><a href="#4-6-æ—¥å¿—ç»„" class="headerlink" title="4.6. æ—¥å¿—ç»„"></a>4.6. æ—¥å¿—ç»„</h3><p>å°†ç›¸å…³è®°å½•å™¨ç»„åˆåœ¨ä¸€èµ·ä»¥ä¾¿å¯ä»¥åŒæ—¶é…ç½®, è¿™é€šå¸¸å¾ˆæœ‰ç”¨. ä¾‹å¦‚, æ‚¨å¯ä»¥æ›´æ”¹æ‰€æœ‰ Tomcat ç›¸å…³è®°å½•å™¨çš„æ—¥å¿—è®°å½•çº§åˆ«, ä½†æ‚¨æ— æ³•è½»æ¾è®°ä½é¡¶å±‚çš„åŒ…å.</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜, Spring Boot å…è®¸æ‚¨åœ¨ Spring <code>Environment</code> ä¸­å®šä¹‰æ—¥å¿—è®°å½•ç»„. ä¾‹å¦‚, ä»¥ä¸‹é€šè¿‡å°† â€œtomcatâ€ ç»„æ·»åŠ åˆ° <code>application.properties</code> æ¥å®šä¹‰ tomcat ç»„:</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">logging:</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">  group:</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">    tomcat:</span> <span class="hljs-string">&quot;org.apache.catalina,org.apache.coyote,org.apache.tomcat&quot;</span><br></code></pre></td></tr></table></figure><p>å®šä¹‰å, æ‚¨å¯ä»¥ä½¿ç”¨ä¸€è¡Œé…ç½®æ¥æ›´æ”¹ç»„ä¸­æ‰€æœ‰è®°å½•å™¨çš„çº§åˆ«:</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">logging:</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">  level:</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">    tomcat:</span> <span class="hljs-string">&quot;trace&quot;</span><br></code></pre></td></tr></table></figure><p>Spring Boot åŒ…å«ä»¥ä¸‹é¢„å®šä¹‰çš„æ—¥å¿—è®°å½•ç»„, å¯ä»¥ç›´æ¥ä½¿ç”¨:</p><p>åç§°</p><p>æ—¥å¿—è®°å½•å™¨</p><p>web</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.core</span>.codec`, `org<span class="hljs-selector-class">.springframework</span>.http`, `org<span class="hljs-selector-class">.springframework</span>.web`, `org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.boot</span><span class="hljs-selector-class">.actuate</span><span class="hljs-selector-class">.endpoint</span>.web`, `org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.boot</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.servlet</span>.ServletContextInitializerBeans<br></code></pre></td></tr></table></figure><p>sql</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.jdbc</span>.core`, `org<span class="hljs-selector-class">.hibernate</span>.SQL`, `org<span class="hljs-selector-class">.jooq</span><span class="hljs-selector-class">.tools</span>.LoggerListener<br></code></pre></td></tr></table></figure><h3 id="4-7-ä½¿ç”¨æ—¥å¿—-Shutdown-é’©å­"><a href="#4-7-ä½¿ç”¨æ—¥å¿—-Shutdown-é’©å­" class="headerlink" title="4.7. ä½¿ç”¨æ—¥å¿— Shutdown é’©å­"></a>4.7. ä½¿ç”¨æ—¥å¿— Shutdown é’©å­</h3><p>ä¸ºäº†åœ¨æ‚¨çš„åº”ç”¨ç¨‹åºç»ˆæ­¢æ—¶é‡Šæ”¾æ—¥å¿—è®°å½•èµ„æºï¼Œæä¾›äº†ä¸€ä¸ª shutdown hookï¼ˆå‹¾å­ï¼‰ï¼Œè¯¥å‹¾å­å°†åœ¨ JVM é€€å‡ºæ—¶è§¦å‘æ—¥å¿—ç³»ç»Ÿæ¸…ç†ã€‚ é™¤éæ‚¨çš„åº”ç”¨ç¨‹åºéƒ¨ç½²ä¸º war æ–‡ä»¶ï¼Œå¦åˆ™æ­¤ shutdown å‹¾å­ä¼šè‡ªåŠ¨æ³¨å†Œã€‚ å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºå…·æœ‰å¤æ‚çš„ä¸Šä¸‹æ–‡å±‚æ¬¡ç»“æ„ï¼Œåˆ™ shutdown å‹¾å­å¯èƒ½æ— æ³•æ»¡è¶³æ‚¨çš„éœ€æ±‚ã€‚ å¦‚æœæ²¡æœ‰ï¼Œè¯·ç¦ç”¨ shutdown å‹¾å­ å¹¶è°ƒæŸ¥åº•å±‚æ—¥å¿—è®°å½•ç³»ç»Ÿç›´æ¥æä¾›çš„é€‰é¡¹ã€‚ ä¾‹å¦‚ï¼ŒLogback æä¾› <a href="https://logback.qos.ch/manual/loggingSeparation.html">context selectors</a>ï¼Œå®ƒå…è®¸åœ¨è‡ªå·±çš„ä¸Šä¸‹æ–‡ä¸­åˆ›å»ºæ¯ä¸ª Loggerã€‚</p><p>æ‚¨å¯ä»¥ä½¿ç”¨ <code>logging.register-shutdown-hook</code> å±æ€§æ¥ç¦ç”¨ shutdown å‹¾å­ã€‚å°†å…¶è®¾ç½®ä¸º <code>false</code> å°†ç¦ç”¨æ³¨å†Œã€‚ æ‚¨å¯ä»¥åœ¨ <code>application.properties</code> æˆ– <code>application.yaml</code> æ–‡ä»¶ä¸­è®¾ç½®å±æ€§ï¼š</p><p>å¯¹äºåœ¨è‡ªå·±çš„ JVM ä¸­éƒ¨ç½²çš„ç®€å• â€œjarâ€ åº”ç”¨ç¨‹åºï¼Œ å¯ä»¥ä½¿ç”¨ <code>logging.register-shutdown-hook</code> å±æ€§. å°† <code>logging.register-shutdown-hook</code> è®¾ç½®ä¸º <code>true</code> å°†æ³¨å†Œä¸€ä¸ªå…³é—­é’©å­ï¼Œ å½“ JVM é€€å‡ºæ—¶ï¼Œ è¯¥é’©å­å°†è§¦å‘æ—¥å¿—ç³»ç»Ÿæ¸…ç†.</p><p>æ‚¨å¯ä»¥åœ¨ <code>application.properties</code> æˆ– <code>application.yaml</code> æ–‡ä»¶ä¸­è®¾ç½®å±æ€§:</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs arduino">logging:<br><br>  <span class="hljs-keyword">register</span>-shutdown-hook: <span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure><h3 id="4-8-è‡ªå®šä¹‰æ—¥å¿—é…ç½®"><a href="#4-8-è‡ªå®šä¹‰æ—¥å¿—é…ç½®" class="headerlink" title="4.8. è‡ªå®šä¹‰æ—¥å¿—é…ç½®"></a>4.8. è‡ªå®šä¹‰æ—¥å¿—é…ç½®</h3><p>å¯ä»¥é€šè¿‡åœ¨ classpath ä¸­å¼•å…¥é€‚åˆçš„åº“æ¥æ¿€æ´»å„ç§æ—¥å¿—è®°å½•ç³»ç»Ÿ, å¹¶ä¸”å¯ä»¥é€šè¿‡åœ¨ classpath çš„æ ¹ç›®å½•ä¸­æˆ–åœ¨ä»¥ä¸‹ Spring Environment å±æ€§æŒ‡å®šçš„ä½ç½®æä¾›åˆé€‚çš„é…ç½®æ–‡ä»¶æ¥è¿›ä¸€æ­¥è‡ªå®šä¹‰: <code>logging.config</code>.</p><p>æ‚¨å¯ä»¥ä½¿ç”¨ <code>org.springframework.boot.logging.LoggingSystem</code> ç³»ç»Ÿå±æ€§å¼ºåˆ¶ Spring Boot ä½¿ç”¨ç‰¹å®šçš„æ—¥å¿—è®°å½•ç³»ç»Ÿ. è¯¥å€¼åº”è¯¥æ˜¯ä¸€ä¸ªå®ç°äº† <code>LoggingSystem</code> çš„ç±»çš„å®Œå…¨é™å®šç±»å. æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ <code>none</code> å€¼å®Œå…¨ç¦ç”¨ Spring Boot çš„æ—¥å¿—è®°å½•é…ç½®.</p><p>ç”±äºæ—¥å¿—è®°å½•åœ¨åˆ›å»º <code>ApplicationContext</code> ä¹‹å‰åˆå§‹åŒ–, å› æ­¤æ— æ³•åœ¨ Spring <code>@Configuration</code> æ–‡ä»¶ä¸­æ§åˆ¶æ¥è‡ª <code>@PropertySources</code> çš„æ—¥å¿—è®°å½•. æ›´æ”¹æ—¥å¿—è®°å½•ç³»ç»Ÿæˆ–å®Œå…¨ç¦ç”¨å®ƒçš„å”¯ä¸€æ–¹æ³•æ˜¯é€šè¿‡ç³»ç»Ÿå±æ€§è®¾ç½®.</p><p>æ ¹æ®æ‚¨çš„æ—¥å¿—è®°å½•ç³»ç»Ÿ, å°†åŠ è½½ä»¥ä¸‹æ–‡ä»¶:</p><p>æ—¥å¿—è®°å½•ç³»ç»Ÿ</p><p>æ–‡ä»¶</p><p>Logback</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">logback-spring.xml`, `logback-spring.groovy`, `logback.xml`, æˆ–è€… `logback.groovy<br></code></pre></td></tr></table></figure><p>Log4j2</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">log4j2-spring.xml` æˆ–è€… `log4j2.xml<br></code></pre></td></tr></table></figure><p>JDK (Java Util Logging)</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs matlab">logging.<span class="hljs-keyword">properties</span><br></code></pre></td></tr></table></figure><p>å¦‚æœå¯èƒ½, æˆ‘ä»¬å»ºè®®æ‚¨ä½¿ç”¨ <code>-spring</code> çš„å½¢å¼æ¥é…ç½®æ—¥å¿—è®°å½• (æ¯”å¦‚ <code>logback-spring.xml</code> è€Œä¸æ˜¯ <code>logback.xml</code>) . å¦‚æœä½¿ç”¨æ ‡å‡†çš„é…ç½®ä½ç½®, Spring æ— æ³•å®Œå…¨æ§åˆ¶æ—¥å¿—åˆå§‹åŒ–.</p><p>Java Util Logging å­˜åœ¨å·²çŸ¥çš„ç±»åŠ è½½é—®é¢˜, è¿™äº›é—®é¢˜åœ¨ä»¥ â€˜executable jarâ€™ è¿è¡Œæ—¶ä¼šè§¦å‘. å¦‚æœå¯èƒ½çš„è¯, æˆ‘ä»¬å»ºè®®æ‚¨åœ¨ä½¿ç”¨å¯æ‰§è¡Œ jar æ–¹å¼è¿è¡Œæ—¶é¿å…ä½¿ç”¨å®ƒ. .</p><p>ä¸ºäº†è¿›è¡Œè‡ªå®šä¹‰, éƒ¨åˆ†å…¶ä»–å±æ€§ä¼šä» Spring <code>Environment</code> ä¼ è¾“åˆ° <code>System</code> å±æ€§, å¦‚ä¸‹è¡¨æ‰€è¿°:</p><p>Spring Environment</p><p>ç³»ç»Ÿå±æ€§</p><p>è¯´æ˜</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">logging.<span class="hljs-keyword">exception</span>-<span class="hljs-keyword">conversion</span>-word<br>LOG_EXCEPTION_CONVERSION_WORD<br></code></pre></td></tr></table></figure><p>è®°å½•å¼‚å¸¸æ—¶ä½¿ç”¨çš„è½¬æ¢å­—.</p><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs delphi">logging.<span class="hljs-keyword">file</span>.<span class="hljs-keyword">name</span><br>LOG_FILE<br></code></pre></td></tr></table></figure><p>å¦‚æœå·²å®šä¹‰, åˆ™åœ¨é»˜è®¤æ—¥å¿—é…ç½®ä¸­ä½¿ç”¨å®ƒ.</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">logging<span class="hljs-selector-class">.file</span><span class="hljs-selector-class">.path</span><br>LOG_PATH<br></code></pre></td></tr></table></figure><p>å¦‚æœå·²å®šä¹‰, åˆ™åœ¨é»˜è®¤æ—¥å¿—é…ç½®ä¸­ä½¿ç”¨å®ƒ.</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">logging<span class="hljs-selector-class">.pattern</span><span class="hljs-selector-class">.console</span><br>CONSOLE_LOG_PATTERN<br></code></pre></td></tr></table></figure><p>è¦åœ¨æ§åˆ¶å°ä¸Šä½¿ç”¨çš„æ—¥å¿—æ¨¡å¼ (stdout) .</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">logging<span class="hljs-selector-class">.pattern</span><span class="hljs-selector-class">.dateformat</span><br>LOG_DATEFORMAT_PATTERN<br></code></pre></td></tr></table></figure><p>æ—¥å¿—æ—¥æœŸæ ¼å¼çš„ Appender æ¨¡å¼. (ä»…æ”¯æŒé»˜è®¤çš„ Logback è®¾ç½®. )</p><p>configprop: logging .charset.console []</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">CONSOLE_LOG_CHARSET</span><br></code></pre></td></tr></table></figure><p>The charset to use for console logging.</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">logging<span class="hljs-selector-class">.pattern</span><span class="hljs-selector-class">.file</span><br>FILE_LOG_PATTERN<br></code></pre></td></tr></table></figure><p>è¦åœ¨æ–‡ä»¶ä¸­ä½¿ç”¨çš„æ—¥å¿—æ¨¡å¼ (å¦‚æœå¯ç”¨äº† <code>LOG_FILE</code>) .</p><p>configprop: logging .charset.file []</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">FILE_LOG_CHARSET</span><br></code></pre></td></tr></table></figure><p>The charset to use for file logging (if <code>LOG_FILE</code> is enabled).</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">logging<span class="hljs-selector-class">.pattern</span><span class="hljs-selector-class">.level</span><br>LOG_LEVEL_PATTERN<br></code></pre></td></tr></table></figure><p>æ¸²æŸ“æ—¥å¿—çº§åˆ«æ—¶ä½¿ç”¨çš„æ ¼å¼ (é»˜è®¤å€¼ä¸º <code>%5p</code>) .</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">PID</span><br><span class="hljs-attribute">PID</span><br></code></pre></td></tr></table></figure><p>å½“å‰è¿›ç¨‹ ID (å¦‚æœå¯èƒ½, åˆ™åœ¨æœªå®šä¹‰ä¸º OS ç¯å¢ƒå˜é‡æ—¶å‘ç°) .</p><p>å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ Logbackï¼Œä»¥ä¸‹å±æ€§ä¹Ÿä¼šè¢«è½¬ç§»:</p><p>Spring Environment</p><p>System Property</p><p>Comments</p><p>configprop: logging .logback.rollingpolicy.file-name-pattern []</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">LOGBACK_ROLLINGPOLICY_FILE_NAME_PATTERN</span><br></code></pre></td></tr></table></figure><p>Pattern for rolled-over log file names (default <code>$&#123;LOG_FILE&#125;.%d&#123;yyyy-MM-dd&#125;.%i.gz</code>).</p><p>configprop: logging .logback.rollingpolicy.clean-history-on-start []</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">LOGBACK_ROLLINGPOLICY_CLEAN_HISTORY_ON_START</span><br></code></pre></td></tr></table></figure><p>Whether to clean the archive log files on startup.</p><p>configprop: logging .logback.rollingpolicy.max-file-size []</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">LOGBACK_ROLLINGPOLICY_MAX_FILE_SIZE</span><br></code></pre></td></tr></table></figure><p>Maximum log file size.</p><p>configprop: logging .logback.rollingpolicy.total-size-cap []</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">LOGBACK_ROLLINGPOLICY_TOTAL_SIZE_CAP</span><br></code></pre></td></tr></table></figure><p>Total size of log backups to be kept.</p><p>configprop: logging .logback.rollingpolicy.max-history []</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">LOGBACK_ROLLINGPOLICY_MAX_HISTORY</span><br></code></pre></td></tr></table></figure><p>Maximum number of archive log files to keep.</p><p>æ‰€æœ‰å—æ”¯æŒçš„æ—¥å¿—è®°å½•ç³»ç»Ÿåœ¨è§£æå…¶é…ç½®æ–‡ä»¶æ—¶éƒ½å¯ä»¥å‚è€ƒç³»ç»Ÿå±æ€§. æœ‰å…³ç¤ºä¾‹, è¯·å‚é˜… <code>spring-boot.jar</code> ä¸­çš„é»˜è®¤é…ç½®:</p><ul><li><a href="https://github.com/spring-projects/spring-boot/tree/main/spring-boot-project/spring-boot/src/main/resources/org/springframework/boot/logging/logback/defaults.xml">Logback</a></li><li><a href="https://github.com/spring-projects/spring-boot/tree/main/spring-boot-project/spring-boot/src/main/resources/org/springframework/boot/logging/log4j2/log4j2.xml">Log4j 2</a></li><li><a href="https://github.com/spring-projects/spring-boot/tree/main/spring-boot-project/spring-boot/src/main/resources/org/springframework/boot/logging/java/logging-file.properties">Java Util logging</a></li></ul><p>å¦‚æœè¦åœ¨æ—¥å¿—è®°å½•å±æ€§ä¸­ä½¿ç”¨å ä½ç¬¦, åˆ™åº”ä½¿ç”¨ <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.external-config.files.property-placeholders">Spring Boot çš„è¯­æ³•</a>, è€Œä¸æ˜¯ä½¿ç”¨åº•å±‚æ¡†æ¶çš„è¯­æ³•. å€¼å¾—æ³¨æ„çš„æ˜¯, å¦‚æœä½¿ç”¨ Logback, åˆ™åº”ä½¿ç”¨ <code>:</code> ä½œä¸ºå±æ€§åç§°ä¸å…¶é»˜è®¤å€¼ä¹‹é—´çš„åˆ†éš”ç¬¦, è€Œä¸æ˜¯ä½¿ç”¨ <code>:-</code>.</p><p>æ‚¨å¯ä»¥é€šè¿‡ä»…è¦†ç›– <code>LOG_LEVEL_PATTERN</code> (æˆ–å¸¦ Logback çš„ <code>logging.pattern.level</code>) å°† MDC å’Œå…¶ä»–ç‰¹åˆ«çš„å†…å®¹æ·»åŠ åˆ°æ—¥å¿—è¡Œ. ä¾‹å¦‚, å¦‚æœä½¿ç”¨ <code>logging.pattern.level=user:%X&#123;user&#125; %5p</code>, åˆ™é»˜è®¤æ—¥å¿—æ ¼å¼åŒ…å« user MDC é¡¹ (å¦‚æœå­˜åœ¨) , å¦‚ä¸‹æ‰€ç¤º:</p><p>2019-08-30 12:30:04.031 user: someone INFO 22174 â€” [ nio-8080-exec-0] demo.Controller Handling authenticated request</p><h3 id="4-9-Logback-æ‰©å±•"><a href="#4-9-Logback-æ‰©å±•" class="headerlink" title="4.9. Logback æ‰©å±•"></a>4.9. Logback æ‰©å±•</h3><p>Spring Boot åŒ…å«è®¸å¤š Logback æ‰©å±•, å¯ç”¨äºè¿›è¡Œé«˜çº§é…ç½®. æ‚¨å¯ä»¥åœ¨ <code>logback-spring.xml</code> é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨è¿™äº›æ‰©å±•.</p><p>ç”±äºæ ‡å‡†çš„ <code>logback.xml</code> é…ç½®æ–‡ä»¶åŠ è½½è¿‡æ—©, å› æ­¤æ— æ³•åœ¨å…¶ä¸­ä½¿ç”¨æ‰©å±•. æ‚¨éœ€è¦ä½¿ç”¨ <code>logback-spring.xml</code> æˆ–å®šä¹‰ <code>logging.config</code> å±æ€§.</p><p>æ‰©å±•ä¸èƒ½ä¸ Logback çš„ <a href="https://logback.qos.ch/manual/configuration.html#autoScan">é…ç½®æ‰«æ</a> ä¸€èµ·ä½¿ç”¨. å¦‚æœå°è¯•è¿™æ ·åš, æ›´æ”¹é…ç½®æ–‡ä»¶ä¼šå¯¼è‡´å‘ç”Ÿç±»ä¼¼ä»¥ä¸‹é”™è¯¯æ—¥å¿—: .</p><p>ERROR in ch.qos.logback.core.joran.spi.Interpreter@4:71 - no applicable action for [springProperty], current ElementPath is [[configuration][springProperty]] ERROR in ch.qos.logback.core.joran.spi.Interpreter@4:71 - no applicable action for [springProfile], current ElementPath is [[configuration][springProfile]]</p><h4 id="4-9-1-ç‰¹å®š-Profile-é…ç½®"><a href="#4-9-1-ç‰¹å®š-Profile-é…ç½®" class="headerlink" title="4.9.1. ç‰¹å®š Profile é…ç½®"></a>4.9.1. ç‰¹å®š Profile é…ç½®</h4><p><code>&lt;springProfile&gt;</code> æ ‡ç­¾å…è®¸æ‚¨æ ¹æ®æ¿€æ´»çš„ Spring profile é€‰æ‹©æ€§åœ°åŒ…å«æˆ–æ’é™¤é…ç½®éƒ¨åˆ†. åœ¨ <code>&lt;configuration&gt;</code> å…ƒç´ ä¸­çš„ä»»ä½•ä½ç½®éƒ½æ”¯æŒé…ç½® profile. ä½¿ç”¨ <code>name</code> å±æ€§æŒ‡å®šå“ªä¸ª profile æ¥å—é…ç½®. <code>&lt;springProfile&gt;</code> æ ‡è®°å¯ä»¥åŒ…å«ç®€å•çš„ proifle åç§° (ä¾‹å¦‚ <code>staging</code>) æˆ– profile è¡¨è¾¾å¼. profile è¡¨è¾¾å¼å…è®¸è¡¨è¾¾æ›´å¤æ‚çš„ profile é€»è¾‘, ä¾‹å¦‚ <code>production &amp; (eu-central | eu-west)</code>. æœ‰å…³è¯¦ç»†ä¿¡æ¯, è¯·æŸ¥é˜… <a href="https://sca.aliyun.com/blog/learning/spring/core/ioc#beans-definition-profiles-java">Spring Framework å‚è€ƒæŒ‡å—</a> . ä»¥ä¸‹æ¸…å•å±•ç¤ºäº†ä¸‰ä¸ªç¤ºä¾‹ profile:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">springProfile</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;staging&quot;</span>&gt;</span>    <span class="hljs-comment">&lt;!-- configuration to be enabled when the &quot;staging&quot; profile is active --&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">springProfile</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">springProfile</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dev | staging&quot;</span>&gt;</span>    <span class="hljs-comment">&lt;!-- configuration to be enabled when the &quot;dev&quot; or &quot;staging&quot; profiles are active --&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">springProfile</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">springProfile</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;!production&quot;</span>&gt;</span>    <span class="hljs-comment">&lt;!-- configuration to be enabled when the &quot;production&quot; profile is not active --&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">springProfile</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="4-9-2-ç¯å¢ƒå±æ€§"><a href="#4-9-2-ç¯å¢ƒå±æ€§" class="headerlink" title="4.9.2. ç¯å¢ƒå±æ€§"></a>4.9.2. ç¯å¢ƒå±æ€§</h4><p>ä½¿ç”¨ <code>&lt;springProperty&gt;</code> æ ‡ç­¾å¯ä»¥è®©æ‚¨æš´éœ² Spring ç¯å¢ƒ (<code>Environment</code>) ä¸­çš„å±æ€§, ä»¥ä¾¿åœ¨ Logback ä¸­ä½¿ç”¨. å¦‚æœåœ¨ Logback é…ç½®ä¸­è®¿é—®æ¥è‡ª <code>application.properties</code> æ–‡ä»¶çš„å€¼, è¿™æ ·åšå¾ˆæœ‰ç”¨. æ ‡ç­¾çš„å·¥ä½œæ–¹å¼ä¸ Logback çš„æ ‡å‡† <code>&lt;property&gt;</code> æ ‡ç­¾ç±»ä¼¼. ä½†æ˜¯, æ‚¨å¯ä»¥æŒ‡å®šå±æ€§ (æ¥è‡ª <code>Environment</code>) çš„ <code>source</code>, è€Œä¸æ˜¯æŒ‡å®šç›´æ¥çš„ <code>value</code>. å¦‚æœéœ€è¦å°†å±æ€§å­˜å‚¨åœ¨ <code>local</code> ä½œç”¨åŸŸä»¥å¤–çš„å…¶ä»–ä½ç½®, åˆ™å¯ä»¥ä½¿ç”¨ <code>scope</code> å±æ€§. å¦‚æœéœ€è¦å›é€€å€¼ (å¦‚æœæœªåœ¨ <code>Environment</code> ä¸­è®¾ç½®è¯¥å±æ€§) , åˆ™å¯ä»¥ä½¿ç”¨ <code>defaultValue</code> å±æ€§. ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•æš´éœ²å±æ€§ä»¥ä¾¿åœ¨ Logback ä¸­ä½¿ç”¨:</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">springProperty</span> <span class="hljs-attr">scope</span>=<span class="hljs-string">&quot;context&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;fluentHost&quot;</span> <span class="hljs-attr">source</span>=<span class="hljs-string">&quot;myapp.fluentd.host&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml"></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">defaultValue</span>=<span class="hljs-string">&quot;localhost&quot;</span>/&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;FLUENT&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.more.appenders.DataFluentAppender&quot;</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">remoteHost</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;fluentHost&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">remoteHost</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">    ...</span><br><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p>å¿…é¡»ä»¥ kebab é£æ ¼ (çŸ­æ¨ªçº¿å°å†™é£æ ¼) æŒ‡å®š <code>source</code> (ä¾‹å¦‚ <code>my.property-name</code>) . ä½†å¯ä»¥ä½¿ç”¨å®½æ¾è§„åˆ™å°†å±æ€§æ·»åŠ åˆ° <code>Environment</code> ä¸­.</p><h3 id="4-10-Log4j2-æ‰©å±•"><a href="#4-10-Log4j2-æ‰©å±•" class="headerlink" title="4.10. Log4j2 æ‰©å±•"></a>4.10. Log4j2 æ‰©å±•</h3><p>Spring Boot åŒ…æ‹¬è®¸å¤šå¯¹ Log4j2 çš„æ‰©å±•ï¼Œå¯ä»¥è¿›è¡Œé«˜çº§é…ç½®ã€‚æ‚¨å¯ä»¥åœ¨ä»»ä½• <code>log4j2-spring.xml</code> é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨è¿™äº›æ‰©å±•ã€‚</p><p>ç”±äºæ ‡å‡† <code>log4j2.xml</code> é…ç½®æ–‡ä»¶åŠ è½½å¾—å¤ªæ—©ï¼Œå› æ­¤ä¸èƒ½åœ¨å…¶ä¸­ä½¿ç”¨æ‰©å±•ã€‚æ‚¨éœ€è¦ä½¿ç”¨ <code>log4j2-spring.xml</code> æˆ–å®šä¹‰ <code>logging.config</code> å±æ€§ã€‚</p><p>è¿™äº›æ‰©å±•å–ä»£äº† <a href="https://logging.apache.org/log4j/2.x/log4j-spring-boot/index.html">Spring Boot æä¾›çš„å¯¹</a> Log4J çš„æ”¯æŒã€‚ä½ åº”è¯¥ç¡®ä¿åœ¨ä½ çš„æ„å»ºä¸­ä¸åŒ…å« <code>org.apache.logging.log4j:log4j-spring-boot</code> æ¨¡å—ã€‚</p><h4 id="4-10-1-Profile-specific-Configuration"><a href="#4-10-1-Profile-specific-Configuration" class="headerlink" title="4.10.1. Profile-specific Configuration"></a>4.10.1. Profile-specific Configuration</h4><p><code>&lt;SpringProfile&gt;</code> æ ‡ç­¾å…è®¸æ‚¨æ ¹æ®æ¿€æ´»çš„ Spring profile é€‰æ‹©æ€§åœ°åŒ…å«æˆ–æ’é™¤éƒ¨åˆ†é…ç½®ã€‚Profile éƒ¨åˆ†åœ¨ <code>&lt;Configuration&gt;</code> å…ƒç´ ä¸­çš„ä»»ä½•ä½ç½®éƒ½å—æ”¯æŒã€‚ ä½¿ç”¨ <code>name</code> å±æ€§æŒ‡å®šå“ªä¸ªé…ç½®æ–‡ä»¶æ¥å—é…ç½®ã€‚ <code>&lt;SpringProfile&gt;</code> æ ‡ç­¾å¯ä»¥åŒ…å«é…ç½®æ–‡ä»¶åç§°ï¼ˆä¾‹å¦‚ <code>staging</code>ï¼‰æˆ–é…ç½®æ–‡ä»¶è¡¨è¾¾å¼ã€‚ é…ç½®æ–‡ä»¶è¡¨è¾¾å¼å…è®¸è¡¨è¾¾æ›´å¤æ‚çš„é…ç½®æ–‡ä»¶é€»è¾‘ï¼Œä¾‹å¦‚ <code>production &amp; (eu-central | eu-west)</code>ã€‚ æŸ¥çœ‹ <a href="https://sca.aliyun.com/blog/learning/spring/core/ioc#beans-definition-profiles-java">Spring Framework å‚è€ƒæŒ‡å—</a> ä»¥è·å–æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚ ä»¥ä¸‹æ¸…å•æ˜¾ç¤ºäº†ä¸‰ä¸ªç¤ºä¾‹é…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">SpringProfile</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;staging&quot;</span>&gt;</span>    <span class="hljs-comment">&lt;!-- configuration to be enabled when the &quot;staging&quot; profile is active --&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">SpringProfile</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">SpringProfile</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dev | staging&quot;</span>&gt;</span>    <span class="hljs-comment">&lt;!-- configuration to be enabled when the &quot;dev&quot; or &quot;staging&quot; profiles are active --&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">SpringProfile</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">SpringProfile</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;!production&quot;</span>&gt;</span>    <span class="hljs-comment">&lt;!-- configuration to be enabled when the &quot;production&quot; profile is not active --&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">SpringProfile</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="4-10-2-Environment-Properties-Lookup"><a href="#4-10-2-Environment-Properties-Lookup" class="headerlink" title="4.10.2. Environment Properties Lookup"></a>4.10.2. Environment Properties Lookup</h4><p>å¦‚æœä½ æƒ³åœ¨ Log4j2 é…ç½®ä¸­å¼•ç”¨ Spring <code>Environment</code> ä¸­çš„å±æ€§ï¼Œä½ å¯ä»¥ä½¿ç”¨å‰ç¼€ <code>spring:</code> <a href="https://logging.apache.org/log4j/2.x/manual/lookups.html">lookups</a>ã€‚ å¦‚æœè¦è®¿é—® Log4j2 é…ç½®ä¸­çš„ <code>application.properties</code> æ–‡ä»¶ä¸­çš„å€¼ï¼Œè¿™æ ·åšä¼šå¾ˆæœ‰ç”¨ã€‚</p><p>ä¸‹é¢çš„ç¤ºä¾‹æ¼”ç¤ºå¦‚ä½•è®¾ç½®ä¸€ä¸ªåä¸º <code>applicationName</code> çš„ Log4j2 å±æ€§ï¼Œè¯¥å±æ€§ä» Spring <code>Environment</code> ä¸­è¯»å– <code>spring.application.name</code>ï¼š</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Properties</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">Property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;applicationName&quot;</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;spring:spring.application.name&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">Properties</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p>æŸ¥æ‰¾çš„ key åº”è¯¥ä»¥ kebab case å‘½å (such as <code>my.property-name</code>).</p><h4 id="4-10-3-Log4j2-ç³»ç»Ÿå±æ€§"><a href="#4-10-3-Log4j2-ç³»ç»Ÿå±æ€§" class="headerlink" title="4.10.3. Log4j2 ç³»ç»Ÿå±æ€§"></a>4.10.3. Log4j2 ç³»ç»Ÿå±æ€§</h4><p>Log4j2 æ”¯æŒè®¸å¤šå¯ç”¨äºé…ç½®å„ç§é¡¹ç›®çš„ <a href="https://logging.apache.org/log4j/2.x/manual/configuration.html#SystemProperties">System Properties</a> ã€‚ ä¾‹å¦‚ï¼Œ <code>log4j2.skipJansi</code> ç³»ç»Ÿå±æ€§å¯ç”¨äºé…ç½® <code>ConsoleAppender</code> æ˜¯å¦å°†å°è¯•åœ¨ Windows ä¸Šä½¿ç”¨ <a href="https://github.com/fusesource/jansi">Jansi</a> è¾“å‡ºæµã€‚</p><p>åœ¨ Log4j2 åˆå§‹åŒ–ååŠ è½½çš„æ‰€æœ‰ç³»ç»Ÿå±æ€§éƒ½å¯ä»¥ä» Spring çš„ <code>Environment</code> ä¸­è·å¾—ã€‚ ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥å°† <code>log4j2.skipJansi=false</code> æ·»åŠ åˆ° <code>application.properties</code> æ–‡ä»¶ä¸­ï¼Œä»¥ä½¿ <code>ConsoleAppender</code> åœ¨ Windows ä¸Šä½¿ç”¨ Jansiã€‚</p><p>ä»…å½“ç³»ç»Ÿå±æ€§å’Œæ“ä½œç³»ç»Ÿç¯å¢ƒå˜é‡ä¸åŒ…å«æ­£åœ¨åŠ è½½çš„å€¼æ—¶ï¼Œæ‰ä¼šè€ƒè™‘ Spring <code>Environment</code></p><p>åœ¨æ—©æœŸ Log4j2 åˆå§‹åŒ–æœŸé—´åŠ è½½çš„ç³»ç»Ÿå±æ€§ä¸èƒ½å¼•ç”¨ Spring çš„ <code>Environment</code>ã€‚ ä¾‹å¦‚ï¼Œåœ¨ Spring ç¯å¢ƒå¯ç”¨ä¹‹å‰ï¼Œå°†ä½¿ç”¨ Log4j2 ç”¨äºå…è®¸é€‰æ‹©é»˜è®¤ Log4j2 å®ç°çš„å±æ€§ã€‚</p><h2 id="5-å›½é™…åŒ–"><a href="#5-å›½é™…åŒ–" class="headerlink" title="5. å›½é™…åŒ–"></a>5. å›½é™…åŒ–</h2><p>Spring Boot æ”¯æŒæœ¬åœ°åŒ–æ¶ˆæ¯, å› æ­¤æ‚¨çš„åº”ç”¨ç¨‹åºå¯ä»¥è¿åˆä¸åŒè¯­è¨€é¦–é€‰é¡¹çš„ç”¨æˆ·. é»˜è®¤æƒ…å†µä¸‹, Spring Boot åœ¨ç±»è·¯å¾„çš„æ ¹ç›®å½•ä¸‹æŸ¥æ‰¾ <code>messages</code> èµ„æºåŒ…çš„å­˜åœ¨.</p><p>å½“å·²é…ç½®èµ„æºæŸçš„é»˜è®¤å±æ€§æ–‡ä»¶å¯ç”¨æ—¶ (å³é»˜è®¤æƒ…å†µä¸‹ä¸º <code>messages.properties</code>) , å°†åº”ç”¨è‡ªåŠ¨é…ç½®. å¦‚æœæ‚¨çš„èµ„æºåŒ…ä»…åŒ…å«ç‰¹å®šäºè¯­è¨€çš„å±æ€§æ–‡ä»¶, åˆ™éœ€è¦æ·»åŠ é»˜è®¤æ–‡ä»¶. å¦‚æœæ‰¾ä¸åˆ°ä¸ä»»ä½•é…ç½®çš„åŸºæœ¬åç§°åŒ¹é…çš„å±æ€§æ–‡ä»¶, å°†æ²¡æœ‰è‡ªåŠ¨é…ç½®çš„ <code>MessageSource</code>.</p><p>å¯ä»¥ä½¿ç”¨ <code>spring.messages</code> å‘½åç©ºé—´é…ç½®èµ„æºåŒ…çš„åŸºæœ¬åç§°ä»¥åŠå…¶ä»–å‡ ä¸ªå±æ€§, å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br><br>  <span class="hljs-attr">messages:</span><br><br>    <span class="hljs-attr">basename:</span> <span class="hljs-string">&quot;messages,config.i18n.messages&quot;</span><br><br>    <span class="hljs-attr">fallback-to-system-locale:</span> <span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure><p><code>spring.messages.basename</code> æ”¯æŒä»¥é€—å·åˆ†éš”çš„ä½ç½®åˆ—è¡¨, å¯ä»¥æ˜¯åŒ…é™å®šç¬¦, ä¹Ÿå¯ä»¥æ˜¯ä»ç±»è·¯å¾„æ ¹ç›®å½•è§£æçš„èµ„æº.</p><p>æœ‰å…³æ›´å¤šæ”¯æŒçš„é€‰é¡¹, è¯·å‚è§ <a href="https://github.com/spring-projects/spring-boot/tree/main/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/context/MessageSourceProperties.java"><code>MessageSourceProperties</code></a></p><h2 id="6-JSON"><a href="#6-JSON" class="headerlink" title="6. JSON"></a>6. JSON</h2><p>Spring Boot ä¸ºä¸‰ä¸ª JSON æ˜ å°„åº“æä¾›äº†å†…ç½®é›†æˆ:</p><ul><li>Gson</li><li>Jackson</li><li>JSON-B</li></ul><p>Jackson æ˜¯é¦–é€‰å’Œé»˜è®¤çš„åº“.</p><h3 id="6-1-Jackson"><a href="#6-1-Jackson" class="headerlink" title="6.1. Jackson"></a>6.1. Jackson</h3><p>Spring Boot æä¾›äº† Jackson çš„è‡ªåŠ¨é…ç½®, Jackson æ˜¯ <code>spring-boot-starter-json</code> çš„ä¸€éƒ¨åˆ†. å½“ Jackson åœ¨ classpath ä¸Šæ—¶, ä¼šè‡ªåŠ¨é…ç½® <code>ObjectMapper</code> bean. Spring Boot æä¾›äº†å‡ ä¸ªé…ç½®å±æ€§æ¥ <a href="https://sca.aliyun.com/learn/spring-boot/core/howto.html#howto.spring-mvc.customize-jackson-objectmapper">è‡ªå®šä¹‰ <code>ObjectMapper</code> çš„é…ç½®</a>.</p><h4 id="6-1-1-è‡ªå®šä¹‰åºåˆ—åŒ–å’Œååºåˆ—åŒ–å™¨"><a href="#6-1-1-è‡ªå®šä¹‰åºåˆ—åŒ–å’Œååºåˆ—åŒ–å™¨" class="headerlink" title="6.1.1. è‡ªå®šä¹‰åºåˆ—åŒ–å’Œååºåˆ—åŒ–å™¨"></a>6.1.1. è‡ªå®šä¹‰åºåˆ—åŒ–å’Œååºåˆ—åŒ–å™¨</h4><p>å¦‚æœä½¿ç”¨ Jackson åºåˆ—åŒ–å’Œååºåˆ—åŒ– JSON æ•°æ®ï¼Œåˆ™å¯èƒ½éœ€è¦ç¼–å†™è‡ªå·±çš„ <code>JsonSerializer</code> å’Œ <code>JsonDeserializer</code> ç±»ã€‚ è‡ªå®šä¹‰åºåˆ—åŒ–å™¨é€šå¸¸æ˜¯ <a href="https://github.com/FasterXML/jackson-docs/wiki/JacksonHowToCustomSerializers">é€šè¿‡æ¨¡å—å‘ Jackson æ³¨å†Œ</a>ï¼Œä½† Spring Boot æä¾›äº†ä¸€ä¸ªæ›¿ä»£çš„ <code>@JsonComponent</code> æ³¨è§£ï¼Œ ä½¿å¾—ç›´æ¥æ³¨å†Œ Spring Beans å˜å¾—æ›´åŠ å®¹æ˜“ã€‚</p><p>æ‚¨å¯ä»¥ç›´æ¥åœ¨ <code>JsonSerializer</code>, <code>JsonDeserializer</code> æˆ– <code>KeyDeserializer</code> å®ç°ä¸Šä½¿ç”¨ <code>@JsonComponent</code> æ³¨è§£ã€‚ è¿˜å¯ä»¥åœ¨åŒ…å«åºåˆ—åŒ–å™¨&#x2F;ååºåˆ—åŒ–å™¨ä½œä¸ºå†…éƒ¨ç±»çš„ç±»ä¸Šä½¿ç”¨å®ƒï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><p>Java</p><p>Kotlin</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-meta">@JsonComponentpublic</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyJsonComponent</span> </span>&#123;<br>    public static <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Serializer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JsonSerializer&lt;MyObject&gt;</span> </span>&#123;<br>        <span class="hljs-meta">@Override</span>        public void serialize(<span class="hljs-type">MyObject</span> value, <span class="hljs-type">JsonGenerator</span> jgen, <span class="hljs-type">SerializerProvider</span> serializers) <span class="hljs-keyword">throws</span> <span class="hljs-type">IOException</span> &#123;            jgen.writeStartObject();            jgen.writeStringField(<span class="hljs-string">&quot;name&quot;</span>, value.getName());            jgen.writeNumberField(<span class="hljs-string">&quot;age&quot;</span>, value.getAge());            jgen.writeEndObject();        &#125;<br>    &#125;<br>    public static <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Deserializer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JsonDeserializer&lt;MyObject&gt;</span> </span>&#123;<br>        <span class="hljs-meta">@Override</span>        public <span class="hljs-type">MyObject</span> deserialize(<span class="hljs-type">JsonParser</span> jsonParser, <span class="hljs-type">DeserializationContext</span> ctxt) <span class="hljs-keyword">throws</span> <span class="hljs-type">IOException</span> &#123;            <span class="hljs-type">ObjectCodec</span> codec = jsonParser.getCodec();            <span class="hljs-type">JsonNode</span> tree = codec.readTree(jsonParser);            <span class="hljs-type">String</span> name = tree.get(<span class="hljs-string">&quot;name&quot;</span>).textValue();            int age = tree.get(<span class="hljs-string">&quot;age&quot;</span>).intValue();            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-type">MyObject</span>(name, age);        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>ApplicationContext</code> ä¸­çš„æ‰€æœ‰ <code>@JsonComponent</code> bean éƒ½ä¼šè‡ªåŠ¨å‘ Jackson æ³¨å†Œã€‚ ç”±äº <code>@JsonComponent</code> æ˜¯ç”¨ <code>@Component</code> è¿›è¡Œå…ƒæ³¨è§£çš„ï¼Œå› æ­¤é€šå¸¸çš„ç»„ä»¶æ‰«æè§„åˆ™é€‚ç”¨ã€‚</p><p>Spring Boot è¿˜æä¾›äº† <a href="https://github.com/spring-projects/spring-boot/tree/main/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/jackson/JsonObjectSerializer.java"><code>JsonObjectSerializer</code></a> å’Œ <a href="https://github.com/spring-projects/spring-boot/tree/main/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/jackson/JsonObjectDeserializer.java"><code>JsonObjectDeserializer</code></a> åŸºç±»ï¼Œ å®ƒä»¬åœ¨åºåˆ—åŒ–å¯¹è±¡æ—¶æä¾›äº†æ ‡å‡† Jackson ç‰ˆæœ¬çš„æœ‰ç”¨æ›¿ä»£æ–¹æ¡ˆã€‚ æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… Javadoc ä¸­çš„ <a href="https://docs.spring.io/spring-boot/docs/3.0.0/api/org/springframework/boot/jackson/JsonObjectSerializer.html/[%60JsonObjectSerializer%60/]">https://docs.spring.io/spring-boot/docs/3.0.0/api/org/springframework/boot/jackson/JsonObjectSerializer.html\[`JsonObjectSerializer`\]</a> å’Œ <a href="https://docs.spring.io/spring-boot/docs/3.0.0/api/org/springframework/boot/jackson/JsonObjectDeserializer.html"><code>JsonObjectDeserializer</code></a>ã€‚</p><p>ä¸Šé¢çš„ç¤ºä¾‹å¯ä»¥é‡å†™ä¸ºä½¿ç”¨ <code>JsonObjectSerializer</code>&#x2F;<code>JsonObjectDeserializer</code> ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p>Java</p><p>Kotlin</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-meta">@JsonComponentpublic</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyJsonComponent</span> </span>&#123;<br>    public static <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Serializer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JsonObjectSerializer&lt;MyObject&gt;</span> </span>&#123;<br>        <span class="hljs-meta">@Override</span>        <span class="hljs-keyword">protected</span> void serializeObject(<span class="hljs-type">MyObject</span> value, <span class="hljs-type">JsonGenerator</span> jgen, <span class="hljs-type">SerializerProvider</span> provider)                <span class="hljs-keyword">throws</span> <span class="hljs-type">IOException</span> &#123;            jgen.writeStringField(<span class="hljs-string">&quot;name&quot;</span>, value.getName());            jgen.writeNumberField(<span class="hljs-string">&quot;age&quot;</span>, value.getAge());        &#125;<br>    &#125;<br>    public static <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Deserializer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JsonObjectDeserializer&lt;MyObject&gt;</span> </span>&#123;<br>        <span class="hljs-meta">@Override</span>        <span class="hljs-keyword">protected</span> <span class="hljs-type">MyObject</span> deserializeObject(<span class="hljs-type">JsonParser</span> jsonParser, <span class="hljs-type">DeserializationContext</span> context, <span class="hljs-type">ObjectCodec</span> codec,                <span class="hljs-type">JsonNode</span> tree) <span class="hljs-keyword">throws</span> <span class="hljs-type">IOException</span> &#123;            <span class="hljs-type">String</span> name = nullSafeValue(tree.get(<span class="hljs-string">&quot;name&quot;</span>), <span class="hljs-type">String</span>.<span class="hljs-keyword">class</span>);            int age = nullSafeValue(tree.get(<span class="hljs-string">&quot;age&quot;</span>), <span class="hljs-type">Integer</span>.<span class="hljs-keyword">class</span>);            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-type">MyObject</span>(name, age);        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="6-1-2-Mixins"><a href="#6-1-2-Mixins" class="headerlink" title="6.1.2. Mixins"></a>6.1.2. Mixins</h4><p>Jackson æ”¯æŒæ··åˆï¼Œå¯ç”¨äºå°†å…¶ä»–æ³¨è§£æ··åˆåˆ°å·²åœ¨ç›®æ ‡ç±»ä¸Šå£°æ˜çš„æ³¨è§£ä¸­ã€‚ Spring Boot çš„ Jackson è‡ªåŠ¨é…ç½®å°†æ‰«æåº”ç”¨ç¨‹åºçš„åŒ…ä»¥æŸ¥æ‰¾å¸¦æœ‰ <code>@JsonMixin</code> æ³¨è§£çš„ç±»ï¼Œå¹¶å°†å®ƒä»¬æ³¨å†Œåˆ°è‡ªåŠ¨é…ç½®çš„ <code>ObjectMapper</code>ã€‚ æ³¨å†Œç”± Spring Boot çš„ <code>JsonMixinModule</code> æ‰§è¡Œã€‚</p><h3 id="6-2-Gson"><a href="#6-2-Gson" class="headerlink" title="6.2. Gson"></a>6.2. Gson</h3><p>Spring Boot æä¾› Gson çš„è‡ªåŠ¨é…ç½®. å½“ <code>Gson</code> åœ¨ classpath ä¸Šæ—¶, ä¼šè‡ªåŠ¨é…ç½® Gson bean. Spring Boot æä¾›äº†å‡ ä¸ª <code>spring.gson.*</code> é…ç½®å±æ€§æ¥è‡ªå®šä¹‰é…ç½®. ä¸ºäº†è·å¾—æ›´å¤šæ§åˆ¶, å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ª <code>GsonBuilderCustomizer</code> bean.</p><h3 id="6-3-JSON-B"><a href="#6-3-JSON-B" class="headerlink" title="6.3. JSON-B"></a>6.3. JSON-B</h3><p>Spring Boot æä¾›äº† JSON-B çš„è‡ªåŠ¨é…ç½®. å½“ JSON-B API å’Œå®ç°åœ¨ classpath ä¸Šæ—¶, å°†è‡ªåŠ¨é…ç½® <code>Jsonb</code> bean. é¦–é€‰çš„ JSON-B å®ç°æ˜¯ Apache Johnzon, å®ƒæä¾›äº†ä¾èµ–ç®¡ç†.</p><h2 id="7-ä»»åŠ¡æ‰§è¡Œä¸è°ƒåº¦"><a href="#7-ä»»åŠ¡æ‰§è¡Œä¸è°ƒåº¦" class="headerlink" title="7. ä»»åŠ¡æ‰§è¡Œä¸è°ƒåº¦"></a>7. ä»»åŠ¡æ‰§è¡Œä¸è°ƒåº¦</h2><p>åœ¨ä¸Šä¸‹æ–‡ä¸­æ²¡æœ‰ <code>Executor</code> bean çš„æƒ…å†µä¸‹, Spring Boot ä¼šè‡ªåŠ¨é…ç½®ä¸€ä¸ªæœ‰åˆç†é»˜è®¤å€¼çš„ <code>ThreadPoolTaskExecutor</code>, å®ƒå¯ä»¥è‡ªåŠ¨ä¸å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œ (<code>@EnableAsync</code>) å’Œ Spring MVC å¼‚æ­¥è¯·æ±‚å¤„ç†ç›¸å…³è”.</p><p>å¦‚æœæ‚¨åœ¨ä¸Šä¸‹æ–‡ä¸­å®šä¹‰äº†è‡ªå®šä¹‰ <code>Executor</code>, åˆ™å¸¸è§„ä»»åŠ¡æ‰§è¡Œ (å³ <code>@EnableAsync</code>) å°†é€æ˜åœ°ä½¿ç”¨å®ƒ, ä½†ä¸ä¼šé…ç½® Spring MVC æ”¯æŒ, å› ä¸ºå®ƒéœ€è¦ <code>AsyncTaskExecutor</code> å®ç° (åä¸º <code>applicationTaskExecutor</code>) . æ ¹æ®æ‚¨çš„ç›®æ ‡å®‰æ’, æ‚¨å¯ä»¥å°† <code>Executor</code> æ›´æ”¹ä¸º <code>ThreadPoolTaskExecutor</code>, æˆ–è€…å®šä¹‰ <code>Executor</code> çš„ <code>ThreadPoolTaskExecutor</code> å’Œ <code>AsyncConfigurer</code> æ¥åŒ…è£…è‡ªå®šä¹‰çš„ <code>Executor</code>.</p><p>æ‚¨å¯ä»¥ä½¿ç”¨è‡ªåŠ¨é…ç½®çš„ <code>TaskExecutorBuilder</code> æ¥è½»æ¾åˆ›å»ºå®ä¾‹, ä»¥å¤åˆ¶é»˜è®¤çš„è‡ªåŠ¨é…ç½®.</p><p>çº¿ç¨‹æ± ä½¿ç”¨ 8 ä¸ªæ ¸å¿ƒçº¿ç¨‹, å¯æ ¹æ®è´Ÿè½½æƒ…å†µå¢åŠ å’Œå‡å°‘. å¯ä»¥ä½¿ç”¨ <code>spring.task.execution</code> å‘½åç©ºé—´å¯¹è¿™äº›é»˜è®¤è®¾ç½®è¿›è¡Œå¾®è°ƒ, å¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">spring</span><span class="hljs-punctuation">:</span><br><span class="hljs-punctuation"></span><br>  <span class="hljs-attribute">task</span><span class="hljs-punctuation">:</span><br><span class="hljs-punctuation"></span><br>    <span class="hljs-attribute">execution</span><span class="hljs-punctuation">:</span><br><span class="hljs-punctuation"></span><br>      <span class="hljs-attribute">pool</span><span class="hljs-punctuation">:</span><br><span class="hljs-punctuation"></span><br>        <span class="hljs-attribute">max-size</span><span class="hljs-punctuation">:</span> <span class="hljs-string">16</span><br><br>        <span class="hljs-attribute">queue-capacity</span><span class="hljs-punctuation">:</span> <span class="hljs-string">100</span><br><br>        <span class="hljs-attribute">keep-alive</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;10s&quot;</span><br></code></pre></td></tr></table></figure><p>è¿™ä¼šå°†çº¿ç¨‹æ± æ›´æ”¹ä¸ºä½¿ç”¨æœ‰ç•Œé˜Ÿåˆ—, åœ¨é˜Ÿåˆ—æ»¡ (100 ä¸ªä»»åŠ¡) æ—¶, çº¿ç¨‹æ± å°†å¢åŠ åˆ°æœ€å¤š 16 ä¸ªçº¿ç¨‹. å½“çº¿ç¨‹åœ¨é—²ç½® 10 ç§’ (è€Œä¸æ˜¯é»˜è®¤çš„ 60 ç§’) æ—¶å›æ”¶çº¿ç¨‹, æ± çš„æ”¶ç¼©æ›´ä¸ºæ˜æ˜¾.</p><p>å¦‚æœéœ€è¦ä¸è°ƒåº¦ä»»åŠ¡æ‰§è¡Œ (<code>@EnableScheduling</code>) ç›¸å…³è”, å¯ä»¥è‡ªåŠ¨é…ç½®ä¸€ä¸ª <code>ThreadPoolTaskScheduler</code>. é»˜è®¤æƒ…å†µä¸‹, çº¿ç¨‹æ± ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹, å¯ä»¥ä½¿ç”¨ <code>spring.task.scheduling</code> å‘½åç©ºé—´å¯¹è¿™äº›è®¾ç½®è¿›è¡Œå¾®è°ƒ.</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">spring:</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">  task:</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">    scheduling:</span><br><br>      thread-name-prefix: <span class="hljs-string">&quot;scheduling-&quot;</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">      pool:</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">        size:</span> <span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><p>å¦‚æœéœ€è¦åˆ›å»ºè‡ªå®šä¹‰ executor æˆ– scheduler , åˆ™åœ¨ä¸Šä¸‹æ–‡ä¸­å¯ä»¥ä½¿ç”¨ <code>TaskExecutorBuilder</code> bean å’Œ <code>TaskSchedulerBuilder</code> bean.</p><h2 id="8-æµ‹è¯•"><a href="#8-æµ‹è¯•" class="headerlink" title="8. æµ‹è¯•"></a>8. æµ‹è¯•</h2><p>Spring Boot æä¾›äº†è®¸å¤šå·¥å…·ç±»å’Œæ³¨è§£, å¯ä»¥åœ¨æµ‹è¯•åº”ç”¨ç¨‹åºæ—¶æä¾›å¸®åŠ©. ä¸»è¦ç”±ä¸¤ä¸ªæ¨¡å—æä¾›: <code>spring-boot-test</code> åŒ…å«æ ¸å¿ƒé¡¹, <code>spring-boot-test-autoconfigure</code> æ”¯æŒæµ‹è¯•çš„è‡ªåŠ¨é…ç½®.</p><p>å¤§å¤šæ•°å¼€å‘äººå‘˜éƒ½ä½¿ç”¨ <code>spring-boot-starter-test</code> â€œStarterâ€, å®ƒä¼šå¯¼å…¥ Spring Boot æµ‹è¯•æ¨¡å—ä»¥åŠ JUnit Jupiter, AssertJ, Hamcrest å’Œè®¸å¤šå…¶ä»–æœ‰ç”¨çš„åº“.</p><p>å¦‚æœæ‚¨æœ‰ä½¿ç”¨ JUnit 4 çš„æµ‹è¯•ï¼Œå¯ä»¥ä½¿ç”¨ JUnit 5 çš„ vintage engine æ¥è¿è¡Œå®ƒä»¬ã€‚è¦ä½¿ç”¨ vintage engineï¼Œæ·»åŠ ä¸€ä¸ªä¾èµ– <code>junit-vintage-engine</code>ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.junit.vintage<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit-vintage-engine<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.hamcrest<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hamcrest-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p><code>hamcrest-core</code> è¢«æ’é™¤åœ¨å¤–ï¼Œå› ä¸º <code>spring-boot-starter-test</code> é»˜è®¤æ”¯æŒ <code>org.hamcrest:hamcrest</code> ã€‚</p><h3 id="8-1-æµ‹è¯•ä¾èµ–"><a href="#8-1-æµ‹è¯•ä¾èµ–" class="headerlink" title="8.1. æµ‹è¯•ä¾èµ–"></a>8.1. æµ‹è¯•ä¾èµ–</h3><p><code>spring-boot-starter-test</code> â€œStarterâ€ (åœ¨ <code>test</code> <code>scope</code>) åŒ…å«ä»¥ä¸‹çš„åº“:</p><ul><li><a href="https://junit.org/junit5/">JUnit 5</a>: Java åº”ç”¨ç¨‹åºå•å…ƒæµ‹è¯•çš„æ ‡å‡†ã€‚</li><li><a href="https://sca.aliyun.com/blog/learning/spring/core/testing#integration-testing">Spring æµ‹è¯•</a> &amp; Spring Boot æµ‹è¯•: å¯¹ Spring Boot åº”ç”¨ç¨‹åºçš„å®ç”¨ç¨‹åºå’Œé›†æˆæµ‹è¯•æ”¯æŒ.</li><li><a href="https://assertj.github.io/doc/">AssertJ</a>: æµå¼çš„æ–­è¨€åº“.</li><li><a href="https://github.com/hamcrest/JavaHamcrest">Hamcrest</a>: åŒ¹é…å¯¹è±¡åº“ (ä¹Ÿç§°ä¸ºçº¦æŸæˆ–æ–­è¨€) .</li><li><a href="https://site.mockito.org/">Mockito</a>: ä¸€ä¸ª Java æ¨¡æ‹Ÿæ¡†æ¶.</li><li><a href="https://github.com/skyscreamer/JSONassert">JSONassert</a>: JSON çš„æ–­è¨€åº“.</li><li><a href="https://github.com/jayway/JsonPath">JsonPath</a>: JSON çš„ XPath.</li></ul><p>é€šå¸¸, æˆ‘ä»¬å‘ç°è¿™äº›é€šç”¨åº“åœ¨ç¼–å†™æµ‹è¯•æ—¶å¾ˆæœ‰ç”¨. å¦‚æœè¿™äº›åº“ä¸æ»¡è¶³æ‚¨çš„éœ€æ±‚, åˆ™å¯ä»¥æ·»åŠ è‡ªå·±çš„å…¶ä»–æµ‹è¯•ä¾èµ–.</p><h3 id="8-2-æµ‹è¯•-Spring-åº”ç”¨ç¨‹åº"><a href="#8-2-æµ‹è¯•-Spring-åº”ç”¨ç¨‹åº" class="headerlink" title="8.2. æµ‹è¯• Spring åº”ç”¨ç¨‹åº"></a>8.2. æµ‹è¯• Spring åº”ç”¨ç¨‹åº</h3><p>ä¾èµ–æ³¨å…¥çš„ä¸»è¦ä¼˜ç‚¹ä¹‹ä¸€æ˜¯, å®ƒåº”è¯¥ä½¿æ‚¨çš„ä»£ç æ›´æ˜“äºè¿›è¡Œå•å…ƒæµ‹è¯•. æ‚¨å¯ä»¥ä¸ä½¿ç”¨ Springï¼Œ ä½¿ç”¨ <code>new</code> è¿ç®—ç¬¦å®ä¾‹åŒ–å¯¹è±¡. æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ <em>mock objects</em> è€Œä¸æ˜¯å®é™…çš„ä¾èµ–.</p><p>é€šå¸¸, æ‚¨å¯èƒ½ä¸ä»…ä»…éœ€è¦å•å…ƒæµ‹è¯•ï¼Œä¹Ÿéœ€è¦é›†æˆæµ‹è¯• (ä½¿ç”¨ Spring <code>ApplicationContext</code>) . èƒ½å¤Ÿè¿›è¡Œé›†æˆæµ‹è¯•è€Œæ— éœ€éƒ¨ç½²åº”ç”¨ç¨‹åºæˆ–è¿æ¥åˆ°å…¶ä»–åŸºç¡€ç»“æ„æ˜¯å¾ˆæœ‰ç”¨çš„.</p><p>Spring æ¡†æ¶åŒ…æ‹¬ç”¨äºæ­¤ç±»é›†æˆæµ‹è¯•çš„ä¸“ç”¨æµ‹è¯•æ¨¡å—. æ‚¨å¯ä»¥ç›´æ¥å£°æ˜ <code>org.springframework:spring-test</code> ä¾èµ–, ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>spring-boot-starter-test</code> â€œStarterâ€ å°†å…¶ä¼ é€’.</p><p>å¦‚æœæ‚¨ä»¥å‰æ²¡æœ‰ä½¿ç”¨è¿‡ <code>spring-test</code> æ¨¡å—, åˆ™åº”å…ˆé˜…è¯» <a href="https://sca.aliyun.com/blog/learning/spring/core/testing#testing">Spring Framework å‚è€ƒæ–‡æ¡£çš„ç›¸å…³éƒ¨åˆ†</a> .</p><h3 id="8-3-æµ‹è¯•-Spring-Boot-åº”ç”¨ç¨‹åº"><a href="#8-3-æµ‹è¯•-Spring-Boot-åº”ç”¨ç¨‹åº" class="headerlink" title="8.3. æµ‹è¯• Spring Boot åº”ç”¨ç¨‹åº"></a>8.3. æµ‹è¯• Spring Boot åº”ç”¨ç¨‹åº</h3><p>Spring Boot åº”ç”¨ç¨‹åºæ˜¯ Spring <code>ApplicationContext</code>, å› æ­¤é™¤äº†å¯¹æ™®é€š Spring ä¸Šä¸‹æ–‡è¿›è¡Œå¸¸è§„æµ‹è¯•ä»¥å¤–, æ— éœ€æ‰§è¡Œä»»ä½•å…¶ä»–ç‰¹æ®Šæ“ä½œå³å¯å¯¹å…¶è¿›è¡Œæµ‹è¯•.</p><p>é»˜è®¤æƒ…å†µä¸‹, ä»…å½“æ‚¨ä½¿ç”¨ <code>SpringApplication</code> åˆ›å»º Spring Boot çš„å¤–éƒ¨å±æ€§, æ—¥å¿—è®°å½•å’Œå…¶ä»–åŠŸèƒ½æ—¶, æ‰å°†å®ƒä»¬å®‰è£…åœ¨ä¸Šä¸‹æ–‡ä¸­.</p><p>Spring Boot æä¾›äº† <code>@SpringBootTest</code> æ³¨è§£, å½“æ‚¨éœ€è¦ Spring Boot åŠŸèƒ½æ—¶, å¯ä»¥å°†å…¶ç”¨ä½œæ ‡å‡† <code>spring-test</code> <code>@ContextConfiguration</code> æ³¨è§£çš„æ›¿ä»£æ–¹æ³•. <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.testing.spring-boot-applications.detecting-configuration">æ³¨è§£é€šè¿‡ <code>SpringApplication</code> åœ¨æµ‹è¯•ä¸­åˆ›å»º <code>ApplicationContext</code> æ¥ä½¿ç”¨</a>. é™¤äº† <code>@SpringBootTest</code> ä¹‹å¤–, è¿˜æä¾›äº†è®¸å¤šå…¶ä»–æ³¨è§£æ¥æµ‹è¯•åº”ç”¨ç¨‹åºçš„ <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.testing.spring-boot-applications.autoconfigured-tests">ç‰¹å®šçš„éƒ¨åˆ†</a>.</p><p>å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ JUnit 4, è¯·ä¸è¦å¿˜è®°ä¹Ÿå°† <code>@RunWith(SpringRunner.class)</code> æ·»åŠ åˆ°æµ‹è¯•ä¸­, å¦åˆ™æ³¨è§£å°†è¢«å¿½ç•¥. å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ JUnit 5, åˆ™æ— éœ€å°†ç­‰æ•ˆçš„ <code>@ExtendWith(SpringExtension.class)</code> æ·»åŠ ä¸º <code>@SpringBootTest</code>, è€Œå…¶ä»– <code>@â€¦Test</code> æ³¨è§£å·²ç»åœ¨å…¶ä¸­è¿›è¡Œäº†æ³¨è§£.</p><p>é»˜è®¤æƒ…å†µä¸‹, <code>@SpringBootTest</code> å°†ä¸ä¼šå¯åŠ¨æœåŠ¡å™¨. æ‚¨å¯ä»¥ä½¿ç”¨ <code>@SpringBootTest</code> çš„ <code>webEnvironment</code> å±æ€§æ¥è¿›ä¸€æ­¥å®Œå–„æµ‹è¯•çš„è¿è¡Œæ–¹å¼:</p><ul><li><code>MOCK</code>(é»˜è®¤) : åŠ è½½ Web ApplicationContext å¹¶æä¾›æ¨¡æ‹Ÿ Web ç¯å¢ƒ. ä½¿ç”¨æ­¤æ³¨è§£æ—¶, ä¸ä¼šå¯åŠ¨åµŒå…¥å¼æœåŠ¡å™¨. å¦‚æœæ‚¨çš„ç±»è·¯å¾„ä¸Šæ²¡æœ‰ Web ç¯å¢ƒ, åˆ™æ­¤æ¨¡å¼å°†é€æ˜åœ°é€€å›åˆ°åˆ›å»ºå¸¸è§„çš„é Web <code>ApplicationContext</code>. å®ƒå¯ä»¥ä¸ <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.testing.spring-boot-applications.with-mock-environment"><code>@AutoConfigureMockMvc</code> æˆ– <code>@AutoConfigureWebTestClient</code></a> ç»“åˆä½¿ç”¨, ä»¥å¯¹ Web åº”ç”¨ç¨‹åºè¿›è¡ŒåŸºäº Mock çš„æµ‹è¯•.</li><li><code>RANDOM_PORT</code>: åŠ è½½ <code>WebServerApplicationContext</code> å¹¶æä¾›çœŸå®çš„ Web ç¯å¢ƒ. åœ¨éšæœºçš„ç«¯å£å¯åŠ¨å¹¶ç›‘å¬åµŒå…¥å¼æœåŠ¡å™¨.</li><li><code>DEFINED_PORT</code>: åŠ è½½ <code>WebServerApplicationContext</code> å¹¶æä¾›çœŸå®çš„ Web ç¯å¢ƒ. åœ¨å®šä¹‰çš„ç«¯å£(æ¥è‡ª <code>application.properties</code>) æˆ– <code>8080</code> ç«¯å£å¯åŠ¨å¹¶ç›‘å¬åµŒå…¥å¼æœåŠ¡å™¨</li><li><code>NONE</code>: ä½¿ç”¨ <code>SpringApplication</code> åŠ è½½ <code>ApplicationContext</code>, ä½†ä¸æä¾›ä»»ä½• Web ç¯å¢ƒ (æ¨¡æ‹Ÿæˆ–å…¶ä»–æ–¹å¼) .</li></ul><p>å¦‚æœæ‚¨æµ‹è¯•çš„æ˜¯ <code>@Transactional</code>, åˆ™é»˜è®¤æƒ…å†µä¸‹å®ƒå°†åœ¨æ¯ä¸ªæµ‹è¯•æ–¹æ³•çš„æœ«å°¾å›æ»šäº‹åŠ¡. ä½†æ˜¯, ç”±äºå°†è¿™ç§å®‰æ’ä¸ <code>RANDOM_PORT</code> æˆ– <code>DEFINED_PORT</code> ä¸€èµ·ä½¿ç”¨éšå¼æä¾›äº†ä¸€ä¸ªçœŸå®çš„ Servlet ç¯å¢ƒ, å› æ­¤ HTTP å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åœ¨å•ç‹¬çš„çº¿ç¨‹ä¸­è¿è¡Œ, å› æ­¤åœ¨å•ç‹¬çš„äº‹åŠ¡ä¸­è¿è¡Œ. åœ¨è¿™ç§æƒ…å†µä¸‹, æœåŠ¡å™¨ä¸Šå¯åŠ¨çš„ä»»ä½•äº‹åŠ¡éƒ½ä¸ä¼šå›æ»š.</p><p>å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºå°†ä¸åŒçš„ç«¯å£ç”¨äºç®¡ç†æœåŠ¡å™¨, åˆ™ <code>@SpringBootTest</code> çš„ <code>webEnvironment=WebEnvironment.RANDOM_PORT</code> ä¹Ÿå°†åœ¨å•ç‹¬çš„éšæœºç«¯å£ä¸Šå¯åŠ¨ç®¡ç†æœåŠ¡å™¨.</p><h4 id="8-3-1-æ£€æµ‹-Web-åº”ç”¨ç¨‹åºç±»å‹"><a href="#8-3-1-æ£€æµ‹-Web-åº”ç”¨ç¨‹åºç±»å‹" class="headerlink" title="8.3.1. æ£€æµ‹ Web åº”ç”¨ç¨‹åºç±»å‹"></a>8.3.1. æ£€æµ‹ Web åº”ç”¨ç¨‹åºç±»å‹</h4><p>å¦‚æœ Spring MVC å¯ç”¨, åˆ™é…ç½®åŸºäºå¸¸è§„ MVC çš„åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡. å¦‚æœæ‚¨åªæœ‰ Spring WebFlux, æˆ‘ä»¬å°†æ£€æµ‹åˆ°è¯¥æƒ…å†µå¹¶é…ç½®åŸºäº WebFlux çš„åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡.</p><p>å¦‚æœä¸¤è€…éƒ½å­˜åœ¨, åˆ™ Spring MVC ä¼˜å…ˆ. å¦‚æœè¦åœ¨è¿™ç§æƒ…å†µä¸‹æµ‹è¯•å“åº”å¼ Web åº”ç”¨ç¨‹åº, åˆ™å¿…é¡»è®¾ç½® <code>spring.main.web-application-type</code> å±æ€§:</p><p>Java</p><p>Kotlin</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@SpringBootTest(properties = <span class="hljs-string">&quot;spring.main.web-application-type=reactive&quot;</span>)</span><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyWebFluxTests</span> &#123;<br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="8-3-2-æ£€æµ‹æµ‹è¯•é…ç½®"><a href="#8-3-2-æ£€æµ‹æµ‹è¯•é…ç½®" class="headerlink" title="8.3.2. æ£€æµ‹æµ‹è¯•é…ç½®"></a>8.3.2. æ£€æµ‹æµ‹è¯•é…ç½®</h4><p>å¦‚æœæ‚¨ç†Ÿæ‚‰ Spring Test Framework, åˆ™å¯èƒ½ä¹ æƒ¯äºä½¿ç”¨ <code>@ContextConfiguration(classes=â€¦)</code> ä»¥æŒ‡å®šè¦åŠ è½½å“ªä¸ª Spring <code>@Configuration</code>. å¦å¤–, æ‚¨å¯èƒ½ç»å¸¸åœ¨æµ‹è¯•ä¸­ä½¿ç”¨åµŒå¥—çš„ <code>@Configuration</code> ç±».</p><p>åœ¨æµ‹è¯• Spring Boot åº”ç”¨ç¨‹åºæ—¶, é€šå¸¸ä¸éœ€è¦è¿™æ ·åš. åªè¦æ‚¨æ²¡æœ‰æ˜ç¡®å®šä¹‰, Spring Boot çš„ <code>@*Test</code> æ³¨è§£å°±ä¼šè‡ªåŠ¨æœç´¢æ‚¨çš„ä¸»è¦é…ç½®.</p><p>æœç´¢ç®—æ³•ä»åŒ…å«æµ‹è¯•çš„ç¨‹åºåŒ…å¼€å§‹å·¥ä½œ, ç›´åˆ°æ‰¾åˆ°å¸¦æœ‰ <code>@SpringBootApplication</code> æˆ– <code>@SpringBootConfiguration</code> æ³¨è§£çš„ç±». åªè¦æ‚¨ä»¥åˆç†çš„æ–¹å¼å¯¹ <a href="https://sca.aliyun.com/learn/spring-boot/core/using.html#using.structuring-your-code">ä»£ç è¿›è¡Œç»“æ„åŒ–</a>, é€šå¸¸å°±å¯ä»¥æ‰¾åˆ°æ‚¨çš„ä¸»è¦é…ç½®.</p><p>å¦‚æœæ‚¨ä½¿ç”¨ <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.testing.spring-boot-applications.autoconfigured-tests">æµ‹è¯•æ³¨è§£æ¥æµ‹è¯•åº”ç”¨ç¨‹åºçš„ç‰¹å®šéƒ¨åˆ†</a> , åˆ™åº”é¿å…åœ¨ <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.testing.spring-boot-applications.user-configuration-and-slicing">åº”ç”¨ç¨‹åºçš„ main æ–¹æ³•</a> ä¸­æ·»åŠ ç‰¹å®šäºç‰¹å®šåŒºåŸŸçš„é…ç½®è®¾ç½®.</p><p><code>@SpringBootApplication</code> çš„åŸºç¡€ç»„ä»¶æ‰«æé…ç½®å®šä¹‰äº†æ’é™¤è¿‡æ»¤å™¨, è¿™äº›è¿‡æ»¤å™¨ç”¨äºç¡®ä¿åˆ‡ç‰‡æŒ‰é¢„æœŸå·¥ä½œ. å¦‚æœåœ¨ <code>@SpringBootApplication</code> æ³¨è§£çš„ç±»ä¸Šä½¿ç”¨æ˜¾å¼çš„ <code>@ComponentScan</code> æŒ‡ä»¤, è¯·æ³¨æ„è¿™äº›è¿‡æ»¤å™¨å°†è¢«ç¦ç”¨. å¦‚æœä½¿ç”¨åˆ‡ç‰‡, åˆ™åº”å†æ¬¡å®šä¹‰å®ƒä»¬.</p><p>å¦‚æœè¦è‡ªå®šä¹‰ä¸»è¦é…ç½®ç±», åˆ™å¯ä»¥ä½¿ç”¨åµŒå¥—çš„ <code>@TestConfiguration</code> ç±». ä¸åµŒå¥—çš„ <code>@Configuration</code> ç±»ä¸åŒï¼Œå®ƒå°†ç”¨äºä»£æ›¿åº”ç”¨ç¨‹åºçš„ä¸»è¦é…ç½® , åµŒå¥—çš„ <code>@TestConfiguration</code> ç±»ç”¨äºåº”ç”¨ç¨‹åºçš„ä¸»è¦é…ç½®ä¹‹å¤–ã€‚</p><p>Spring çš„æµ‹è¯•æ¡†æ¶åœ¨æµ‹è¯•ä¹‹é—´ç¼“å­˜åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡. å› æ­¤, åªè¦æ‚¨çš„æµ‹è¯•å…±äº«ç›¸åŒçš„é…ç½® (æ— è®ºå¦‚ä½•å‘ç°) , åŠ è½½ä¸Šä¸‹æ–‡çš„æ½œåœ¨è€—æ—¶è¿‡ç¨‹å°±åªä¼šå‘ç”Ÿä¸€æ¬¡.</p><h4 id="8-3-3-ä½¿ç”¨æµ‹è¯•é…ç½®ä¸»æ–¹æ³•"><a href="#8-3-3-ä½¿ç”¨æµ‹è¯•é…ç½®ä¸»æ–¹æ³•" class="headerlink" title="8.3.3. ä½¿ç”¨æµ‹è¯•é…ç½®ä¸»æ–¹æ³•"></a>8.3.3. ä½¿ç”¨æµ‹è¯•é…ç½®ä¸»æ–¹æ³•</h4><p>é€šå¸¸ï¼Œ <code>@SpringBootTest</code> å‘ç°çš„æµ‹è¯•é…ç½®å°†æ˜¯æ‚¨çš„ä¸»è¦ <code>@SpringBootApplication</code>ã€‚ åœ¨å¤§å¤šæ•°çš„åº”ç”¨ç¨‹åºä¸­ï¼Œæ­¤é…ç½®ç±»è¿˜å°†åŒ…æ‹¬ç”¨äºå¯åŠ¨åº”ç”¨ç¨‹åºçš„ <code>main</code> æ–¹æ³•ã€‚</p><p>ä¾‹å¦‚ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªå…¸å‹çš„ Spring Boot åº”ç”¨ç¨‹åºéå¸¸å¸¸è§çš„ä»£ç æ¨¡å¼ï¼š</p><p>Java</p><p>Kotlin</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@SpringBootApplicationpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyApplication</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) &#123;        <span class="hljs-title class_">SpringApplication</span>.<span class="hljs-title function_">run</span>(<span class="hljs-title class_">MyApplication</span>.<span class="hljs-property">class</span>, args);    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ<code>main</code> æ–¹æ³•é™¤äº†å§”æ‰˜ç»™ <code>SpringApplication.run</code> ä¹‹å¤–æ²¡æœ‰åšä»»ä½•äº‹æƒ…ã€‚ ä½†æ˜¯ï¼Œå¯ä»¥æœ‰ä¸€ä¸ªæ›´å¤æ‚çš„ <code>main</code> æ–¹æ³•ï¼Œåœ¨è°ƒç”¨ <code>SpringApplication.run</code> ä¹‹å‰åº”ç”¨å®šåˆ¶ã€‚</p><p>ä¾‹å¦‚ï¼Œè¿™æ˜¯ä¸€ä¸ªæ›´æ”¹ banner æ¨¡å¼å¹¶è®¾ç½®å…¶ä»–é…ç½®æ–‡ä»¶çš„åº”ç”¨ç¨‹åºï¼š</p><p>Java</p><p>Kotlin</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@SpringBootApplicationpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyApplication</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) &#123;        <span class="hljs-title class_">SpringApplication</span> application = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpringApplication</span>(<span class="hljs-title class_">MyApplication</span>.<span class="hljs-property">class</span>);        application.<span class="hljs-title function_">setBannerMode</span>(<span class="hljs-title class_">Banner</span>.<span class="hljs-property">Mode</span>.<span class="hljs-property">OFF</span>);        application.<span class="hljs-title function_">setAdditionalProfiles</span>(<span class="hljs-string">&quot;myprofile&quot;</span>);        application.<span class="hljs-title function_">run</span>(args);    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç”±äº <code>main</code> æ–¹æ³•ä¸­çš„è‡ªå®šä¹‰ä¼šå½±å“ç”Ÿæˆçš„ <code>ApplicationContext</code>ï¼Œå› æ­¤æ‚¨å¯èƒ½è¿˜æƒ³ä½¿ç”¨ <code>main</code> æ–¹æ³•æ¥åˆ›å»ºç”¨äºæµ‹è¯•çš„ <code>ApplicationContext</code>ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œ <code>@SpringBootTest</code> ä¸ä¼šè°ƒç”¨æ‚¨çš„ <code>main</code> æ–¹æ³•ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨ç±»æœ¬èº«æ¥åˆ›å»º <code>ApplicationContext</code></p><p>å¦‚æœè¦æ›´æ”¹æ­¤è¡Œä¸ºï¼Œå¯ä»¥å°† <code>@SpringBootTest</code> çš„ <code>useMainMethod</code> å±æ€§æ›´æ”¹ä¸º <code>UseMainMethod.ALWAYS</code> æˆ– <code>UseMainMethod.WHEN_AVAILABLE</code>ã€‚ å½“è®¾ç½®ä¸º <code>ALWAYS</code> æ—¶ï¼Œå¦‚æœæ‰¾ä¸åˆ° <code>main</code> æ–¹æ³•ï¼Œæµ‹è¯•å°†å¤±è´¥ã€‚ å½“è®¾ç½®ä¸º <code>WHEN_AVAILABLE</code> æ—¶ï¼Œå¦‚æœå¯ç”¨ï¼Œå°†ä½¿ç”¨ <code>main</code> æ–¹æ³•ï¼Œå¦åˆ™å°†ä½¿ç”¨æ ‡å‡†åŠ è½½æœºåˆ¶ã€‚</p><p>ä¾‹å¦‚ï¼Œä»¥ä¸‹æµ‹è¯•å°†è°ƒç”¨ <code>MyApplication</code> çš„ <code>main</code> æ–¹æ³•æ¥åˆ›å»º <code>ApplicationContext</code>ã€‚ å¦‚æœ main æ–¹æ³•è®¾ç½®äº†é¢å¤–çš„é…ç½®æ–‡ä»¶ï¼Œé‚£ä¹ˆè¿™äº›é…ç½®æ–‡ä»¶å°†åœ¨ <code>ApplicationContext</code> å¯åŠ¨æ—¶å¤„äºæ´»åŠ¨çŠ¶æ€ã€‚</p><p>Java</p><p>Kotlin</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest(useMainMethod = UseMainMethod.ALWAYS)</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyApplicationTests</span> &#123;<br>    <span class="hljs-meta">@Test</span>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">exampleTest</span><span class="hljs-params">()</span> &#123;        <span class="hljs-comment">// ...    &#125;</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="8-3-4-æ’é™¤æµ‹è¯•é…ç½®"><a href="#8-3-4-æ’é™¤æµ‹è¯•é…ç½®" class="headerlink" title="8.3.4. æ’é™¤æµ‹è¯•é…ç½®"></a>8.3.4. æ’é™¤æµ‹è¯•é…ç½®</h4><p>å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºä½¿ç”¨äº†ç»„ä»¶æ‰«æ (ä¾‹å¦‚, å¦‚æœä½¿ç”¨ <code>@SpringBootApplication</code> æˆ– <code>@ComponentScan</code> ) , åˆ™å¯èƒ½ä¼šå‘ç°å¶ç„¶ä¸ºå„åœ°åˆ›å»ºçš„ä»…ä¸ºç‰¹å®šæµ‹è¯•åˆ›å»ºçš„é¡¶çº§é…ç½®ç±».</p><p><a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.testing.spring-boot-applications.detecting-configuration">å¦‚å‰æ‰€è¿°</a>, <code>@TestConfiguration</code> å¯ä»¥ç”¨äºæµ‹è¯•çš„å†…éƒ¨ç±»ä»¥è‡ªå®šä¹‰ä¸»è¦é…ç½®. å½“æ”¾ç½®åœ¨é¡¶çº§ç±»ä¸Šæ—¶, <code>@TestConfiguration</code> æŒ‡ç¤ºä¸åº”é€šè¿‡æ‰«æé€‰æ‹© <code>src/test/java</code> ä¸­çš„ç±». ç„¶å, å¯ä»¥åœ¨éœ€è¦çš„ä½ç½®æ˜¾å¼å¯¼å…¥è¯¥ç±», å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><p>Java</p><p>Kotlin</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@SpringBootTest</span><span class="hljs-variable">@Import</span>(MyTestsConfiguration.class)class MyTests &#123;<br>    <span class="hljs-variable">@Test</span>    void <span class="hljs-built_in">exampleTest</span>() &#123;        <span class="hljs-comment">// ...    &#125;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœç›´æ¥ä½¿ç”¨ <code>@ComponentScan</code> (å³ä¸æ˜¯é€šè¿‡ <code>@SpringBootApplication</code>) , åˆ™éœ€è¦å‘å…¶ä¸­æ³¨å†Œ <code>TypeExcludeFilter</code>. æœ‰å…³è¯¦ç»†ä¿¡æ¯, è¯·å‚è§ <a href="https://docs.spring.io/spring-boot/docs/3.0.0/api/org/springframework/boot/context/TypeExcludeFilter.html">Javadoc</a>.</p><h4 id="8-3-5-ä½¿ç”¨åº”ç”¨ç¨‹åºå‚æ•°"><a href="#8-3-5-ä½¿ç”¨åº”ç”¨ç¨‹åºå‚æ•°" class="headerlink" title="8.3.5. ä½¿ç”¨åº”ç”¨ç¨‹åºå‚æ•°"></a>8.3.5. ä½¿ç”¨åº”ç”¨ç¨‹åºå‚æ•°</h4><p>å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºéœ€è¦ <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.spring-application.application-arguments">å‚æ•°</a>, åˆ™å¯ä»¥ä½¿ç”¨ <code>args</code> å±æ€§è®© <code>@SpringBootTest</code> æ³¨å…¥å‚æ•°.</p><p>Java</p><p>Kotlin</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@SpringBootTest</span>(args = <span class="hljs-string">&quot;--app.test=one&quot;</span>)class MyApplicationArgumentTests &#123;<br>    <span class="hljs-variable">@Test</span>    void <span class="hljs-built_in">applicationArgumentsPopulated</span>(<span class="hljs-variable">@Autowired</span> ApplicationArguments args) &#123;        <span class="hljs-selector-tag">assertThat</span>(args.<span class="hljs-built_in">getOptionNames</span>())<span class="hljs-selector-class">.containsOnly</span>(<span class="hljs-string">&quot;app.test&quot;</span>);        <span class="hljs-selector-tag">assertThat</span>(args.<span class="hljs-built_in">getOptionValues</span>(<span class="hljs-string">&quot;app.test&quot;</span>))<span class="hljs-selector-class">.containsOnly</span>(<span class="hljs-string">&quot;one&quot;</span>);    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="8-3-6-åœ¨æ¨¡æ‹Ÿç¯å¢ƒä¸­è¿›è¡Œæµ‹è¯•"><a href="#8-3-6-åœ¨æ¨¡æ‹Ÿç¯å¢ƒä¸­è¿›è¡Œæµ‹è¯•" class="headerlink" title="8.3.6. åœ¨æ¨¡æ‹Ÿç¯å¢ƒä¸­è¿›è¡Œæµ‹è¯•"></a>8.3.6. åœ¨æ¨¡æ‹Ÿç¯å¢ƒä¸­è¿›è¡Œæµ‹è¯•</h4><p>é»˜è®¤æƒ…å†µä¸‹, <code>@SpringBootTest</code> ä¸ä¼šå¯åŠ¨æœåŠ¡å™¨. è€Œæ˜¯è®¾ç½®ä¸€ä¸ªæ¨¡æ‹Ÿç¯å¢ƒæ¥æµ‹è¯• Web ç«¯ç‚¹.</p><p>ä½¿ç”¨ Spring MVCï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <a href="https://sca.aliyun.com/blog/learning/spring/core/testing#spring-mvc-test-framework"><code>MockMvc</code></a> æˆ– <code>WebTestClient</code> æŸ¥è¯¢æˆ‘ä»¬çš„ Web ç«¯ç‚¹ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤º:</p><p>Java</p><p>Kotlin</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@SpringBootTest</span><span class="hljs-variable">@AutoConfigureMockMvcclass</span> MyMockMvcTests &#123;<br>    <span class="hljs-variable">@Test</span>    void <span class="hljs-built_in">testWithMockMvc</span>(<span class="hljs-variable">@Autowired</span> MockMvc mvc) throws Exception &#123;        <span class="hljs-selector-tag">mvc</span><span class="hljs-selector-class">.perform</span>(<span class="hljs-built_in">get</span>(<span class="hljs-string">&quot;/&quot;</span>))<span class="hljs-selector-class">.andExpect</span>(<span class="hljs-built_in">status</span>().<span class="hljs-built_in">isOk</span>())<span class="hljs-selector-class">.andExpect</span>(<span class="hljs-built_in">content</span>().<span class="hljs-built_in">string</span>(<span class="hljs-string">&quot;Hello World&quot;</span>));    &#125;<br>    <span class="hljs-comment">// If Spring WebFlux is on the classpath, you can drive MVC tests with a WebTestClient    @Test    void testWithWebTestClient(@Autowired WebTestClient webClient) &#123;        webClient                .get().uri(&quot;/&quot;)                .exchange()                .expectStatus().isOk()                .expectBody(String.class).isEqualTo(&quot;Hello World&quot;);    &#125;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœåªæƒ³å…³æ³¨ Web å±‚è€Œä¸å¸Œæœ›å¯åŠ¨å®Œæ•´çš„ <code>ApplicationContext</code>, è¯·è€ƒè™‘ä½¿ç”¨ <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.testing.spring-boot-applications.spring-mvc-tests"><code>@WebMvcTest</code></a>.</p><p>ä½¿ç”¨ Spring WebFlux ç«¯ç‚¹, æ‚¨å¯ä»¥é…ç½® <a href="https://sca.aliyun.com/blog/learning/spring/core/testing#webtestclient-tests"><code>WebTestClient</code></a> , å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><p>Java</p><p>Kotlin</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@SpringBootTest</span><span class="hljs-variable">@AutoConfigureWebTestClientclass</span> MyMockWebTestClientTests &#123;<br>    <span class="hljs-variable">@Test</span>    void <span class="hljs-built_in">exampleTest</span>(<span class="hljs-variable">@Autowired</span> WebTestClient webClient) &#123;        <span class="hljs-selector-tag">webClient</span>            <span class="hljs-selector-class">.get</span>()<span class="hljs-selector-class">.uri</span>(<span class="hljs-string">&quot;/&quot;</span>)            <span class="hljs-selector-class">.exchange</span>()            <span class="hljs-selector-class">.expectStatus</span>()<span class="hljs-selector-class">.isOk</span>()            <span class="hljs-selector-class">.expectBody</span>(String.class)<span class="hljs-selector-class">.isEqualTo</span>(<span class="hljs-string">&quot;Hello World&quot;</span>);    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨æ¨¡æ‹Ÿç¯å¢ƒä¸­è¿›è¡Œæµ‹è¯•é€šå¸¸æ¯”åœ¨å®Œæ•´çš„ Servlet å®¹å™¨ä¸­è¿è¡Œæ›´å¿«.ä½†æ˜¯, ç”±äºæ¨¡æ‹Ÿå‘ç”Ÿåœ¨ Spring MVC å±‚, å› æ­¤æ— æ³•ä½¿ç”¨ MockMvc ç›´æ¥æµ‹è¯•ä¾èµ–äºè¾ƒä½çº§åˆ« Servlet å®¹å™¨è¡Œä¸ºçš„ä»£ç .</p><p>ä¾‹å¦‚, Spring Boot çš„é”™è¯¯å¤„ç†åŸºäº Servlet å®¹å™¨æä¾›çš„ â€œerror pageâ€ æ”¯æŒ. è¿™æ„å‘³ç€, å°½ç®¡æ‚¨å¯ä»¥æŒ‰é¢„æœŸæµ‹è¯• MVC å±‚å¼•å‘å¹¶å¤„ç†å¼‚å¸¸, ä½†æ˜¯æ‚¨æ— æ³•ç›´æ¥æµ‹è¯•æ˜¯å¦å‘ˆç°äº†ç‰¹å®šçš„ <a href="https://sca.aliyun.com/learn/spring-boot/core/web.html#web.servlet.spring-mvc.error-handling.error-pages">è‡ªå®šä¹‰é”™è¯¯é¡µé¢</a>. å¦‚æœéœ€è¦æµ‹è¯•è¿™äº›è¾ƒä½çº§åˆ«çš„é—®é¢˜, åˆ™å¯ä»¥æŒ‰ç…§ä¸‹ä¸€èŠ‚ä¸­çš„æè¿°å¯åŠ¨ä¸€ä¸ªå®Œå…¨è¿è¡Œçš„æœåŠ¡å™¨.</p><h4 id="8-3-7-ä½¿ç”¨æ­£åœ¨è¿è¡Œçš„æœåŠ¡å™¨è¿›è¡Œæµ‹è¯•"><a href="#8-3-7-ä½¿ç”¨æ­£åœ¨è¿è¡Œçš„æœåŠ¡å™¨è¿›è¡Œæµ‹è¯•" class="headerlink" title="8.3.7. ä½¿ç”¨æ­£åœ¨è¿è¡Œçš„æœåŠ¡å™¨è¿›è¡Œæµ‹è¯•"></a>8.3.7. ä½¿ç”¨æ­£åœ¨è¿è¡Œçš„æœåŠ¡å™¨è¿›è¡Œæµ‹è¯•</h4><p>å¦‚æœéœ€è¦å¯åŠ¨å®Œå…¨è¿è¡Œçš„æœåŠ¡å™¨, å»ºè®®æ‚¨ä½¿ç”¨éšæœºç«¯å£. å¦‚æœä½¿ç”¨ <code>@SpringBootTest(webEnvironment=WebEnvironment.RANDOM_PORT)</code>, åˆ™æ¯æ¬¡è¿è¡Œæµ‹è¯•æ—¶éƒ½ä¼šéšæœºé€‰æ‹©ä¸€ä¸ªå¯ç”¨ç«¯å£.</p><p><code>@LocalServerPort</code> æ³¨è§£å¯ç”¨äºå°† <a href="https://sca.aliyun.com/learn/spring-boot/core/howto.html#howto.webserver.discover-port">å°†å®é™…ä½¿ç”¨çš„ç«¯å£æ³¨å…¥</a> æµ‹è¯•ä¸­. ä¸ºäº†æ–¹ä¾¿èµ·è§, éœ€è¦å¯¹å·²å¯åŠ¨çš„æœåŠ¡å™¨è¿›è¡Œ REST è°ƒç”¨çš„æµ‹è¯•å¯ä»¥ <code>@Autowire</code> é™„åŠ åœ°ä½¿ç”¨ <code>WebTestClient</code>, è¯¥ <a href="https://sca.aliyun.com/blog/learning/spring/core/testing#webtestclient-tests"><code>WebTestClient</code></a> è§£æåˆ°æ­£åœ¨è¿è¡Œçš„æœåŠ¡å™¨çš„ç›¸å¯¹é“¾æ¥, å¹¶å¸¦æœ‰ç”¨äºéªŒè¯å“åº”çš„ä¸“ç”¨ API, å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><p>Java</p><p>Kotlin</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@SpringBootTest</span>(webEnvironment = WebEnvironment.RANDOM_PORT)class MyRandomPortWebTestClientTests &#123;<br>    <span class="hljs-variable">@Test</span>    void <span class="hljs-built_in">exampleTest</span>(<span class="hljs-variable">@Autowired</span> WebTestClient webClient) &#123;        <span class="hljs-selector-tag">webClient</span>            <span class="hljs-selector-class">.get</span>()<span class="hljs-selector-class">.uri</span>(<span class="hljs-string">&quot;/&quot;</span>)            <span class="hljs-selector-class">.exchange</span>()            <span class="hljs-selector-class">.expectStatus</span>()<span class="hljs-selector-class">.isOk</span>()            <span class="hljs-selector-class">.expectBody</span>(String.class)<span class="hljs-selector-class">.isEqualTo</span>(<span class="hljs-string">&quot;Hello World&quot;</span>);    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>WebTestClient</code> å¯ç”¨äºå®æ—¶æœåŠ¡å™¨å’Œ <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.testing.spring-boot-applications.with-mock-environment">mock ç¯å¢ƒ</a>.</p><p>è¿™ç§è®¾ç½®éœ€è¦åœ¨ç±»è·¯å¾„ä¸Šä½¿ç”¨ <code>spring-webflux</code>. å¦‚æœæ‚¨ä¸èƒ½ webflux, åˆ™ Spring Boot è¿˜æä¾›äº† <code>TestRestTemplate</code> å·¥å…·:</p><p>Java</p><p>Kotlin</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript">@SpringBootTest(webEnvironment = WebEnvironment.RANDOM_PORT)<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyRandomPortTestRestTemplateTests</span> &#123;<br>    @Test    <span class="hljs-keyword">void</span> exampleTest(@Autowired TestRestTemplate restTemplate) &#123;        <span class="hljs-built_in">String</span> body = restTemplate.getForObject(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-built_in">String</span>.<span class="hljs-keyword">class</span>);        assertThat(body).isEqualTo(<span class="hljs-string">&quot;Hello World&quot;</span>);    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="8-3-8-è‡ªå®šä¹‰-WebTestClient"><a href="#8-3-8-è‡ªå®šä¹‰-WebTestClient" class="headerlink" title="8.3.8. è‡ªå®šä¹‰ WebTestClient"></a>8.3.8. è‡ªå®šä¹‰ WebTestClient</h4><p>è¦å®šåˆ¶ <code>WebTestClient</code> bean, è¯·é…ç½® <code>WebTestClientBuilderCustomizer</code> bean. å°†ä½¿ç”¨ç”¨äºåˆ›å»º <code>WebTestClient</code> çš„ <code>WebTestClient.Builder</code> è°ƒç”¨ä»»ä½•æ­¤ç±» bean.</p><h4 id="8-3-9-ä½¿ç”¨-JMX"><a href="#8-3-9-ä½¿ç”¨-JMX" class="headerlink" title="8.3.9. ä½¿ç”¨ JMX"></a>8.3.9. ä½¿ç”¨ JMX</h4><p>ç”±äºæµ‹è¯•ä¸Šä¸‹æ–‡æ¡†æ¶ç¼“å­˜ä¸Šä¸‹æ–‡, å› æ­¤é»˜è®¤æƒ…å†µä¸‹ç¦ç”¨ JMX ä»¥é˜²æ­¢ç›¸åŒç»„ä»¶åœ¨åŒä¸€ domain ä¸Šæ³¨å†Œ. å¦‚æœæ­¤ç±»æµ‹è¯•éœ€è¦è®¿é—® <code>MBeanServer</code>, è¯·è€ƒè™‘å°†å…¶æ ‡è®°ä¸º dirty:</p><p>Java</p><p>Kotlin</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@SpringBootTest</span>(properties = <span class="hljs-string">&quot;spring.jmx.enabled=true&quot;</span>)<span class="hljs-variable">@DirtiesContextclass</span> MyJmxTests &#123;<br>    <span class="hljs-variable">@Autowired</span>    private MBeanServer mBeanServer;<br>    <span class="hljs-variable">@Test</span>    void <span class="hljs-built_in">exampleTest</span>() &#123;        <span class="hljs-selector-tag">assertThat</span>(this.mBeanServer.<span class="hljs-built_in">getDomains</span>())<span class="hljs-selector-class">.contains</span>(<span class="hljs-string">&quot;java.lang&quot;</span>);        <span class="hljs-comment">// ...    &#125;</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="8-3-10-ä½¿ç”¨-Metrics"><a href="#8-3-10-ä½¿ç”¨-Metrics" class="headerlink" title="8.3.10. ä½¿ç”¨ Metrics"></a>8.3.10. ä½¿ç”¨ Metrics</h4><p>æ— è®ºæ‚¨çš„ç±»è·¯å¾„æ˜¯ä»€ä¹ˆï¼Œåœ¨ä½¿ç”¨ <code>@SpringBootTest</code> æ—¶ï¼Œmeter æ³¨å†Œè¡¨(å†…å­˜ä¸­æ”¯æŒçš„é™¤å¤–)éƒ½ä¸ä¼šè‡ªåŠ¨é…ç½®ã€‚</p><p>å¦‚æœæ‚¨éœ€è¦å°†æŒ‡æ ‡ä½œä¸ºé›†æˆæµ‹è¯•çš„ä¸€éƒ¨åˆ†å¯¼å‡ºåˆ°ä¸åŒçš„åç«¯ï¼Œè¯·ä½¿ç”¨ <code>@AutoConfigureMetrics</code> æ³¨è§£å®ƒã€‚</p><h4 id="8-3-11-Using-Tracing"><a href="#8-3-11-Using-Tracing" class="headerlink" title="8.3.11. Using Tracing"></a>8.3.11. Using Tracing</h4><p>æ— è®ºæ‚¨çš„ç±»è·¯å¾„å¦‚ä½•ï¼Œä½¿ç”¨ <code>@SpringBootTest</code> æ—¶éƒ½ä¸ä¼šè‡ªåŠ¨é…ç½®è¿½è¸ªã€‚</p><p>å¦‚æœæ‚¨éœ€è¦å°†è·Ÿè¸ªä½œä¸ºé›†æˆæµ‹è¯•çš„ä¸€éƒ¨åˆ†ï¼Œè¯·ä½¿ç”¨ <code>@AutoConfigureObservability</code> å¯¹å…¶è¿›è¡Œæ³¨è§£ã€‚</p><h4 id="8-3-12-Mockingï¼ˆæ¨¡æ‹Ÿï¼‰-å’Œ-Spyingï¼ˆæ£€æµ‹ï¼‰-Beans"><a href="#8-3-12-Mockingï¼ˆæ¨¡æ‹Ÿï¼‰-å’Œ-Spyingï¼ˆæ£€æµ‹ï¼‰-Beans" class="headerlink" title="8.3.12. Mockingï¼ˆæ¨¡æ‹Ÿï¼‰ å’Œ Spyingï¼ˆæ£€æµ‹ï¼‰ Beans"></a>8.3.12. Mockingï¼ˆæ¨¡æ‹Ÿï¼‰ å’Œ Spyingï¼ˆæ£€æµ‹ï¼‰ Beans</h4><p>è¿è¡Œæµ‹è¯•æ—¶, æœ‰æ—¶æœ‰å¿…è¦åœ¨åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­æ¨¡æ‹ŸæŸäº›ç»„ä»¶. ä¾‹å¦‚, æ‚¨å¯èƒ½åœ¨å¼€å‘è¿‡ç¨‹ä¸­æ— æ³•ä½¿ç”¨æŸäº›è¿œç¨‹æœåŠ¡çš„ facade. å½“æ‚¨è¦æ¨¡æ‹Ÿåœ¨å®é™…ç¯å¢ƒä¸­å¯èƒ½éš¾ä»¥è§¦å‘çš„æ•…éšœæ—¶, æ¨¡æ‹Ÿä¹Ÿå¾ˆæœ‰ç”¨.</p><p>Spring Boot åŒ…å«ä¸€ä¸ª <code>@MockBean</code> æ³¨è§£, å¯ç”¨äºä¸º <code>ApplicationContext</code> ä¸­çš„ bean å®šä¹‰ <code>Mockito</code> æ¨¡æ‹Ÿ. æ‚¨å¯ä»¥ä½¿ç”¨æ³¨è§£æ·»åŠ æ–° bean æˆ–æ›¿æ¢å•ä¸ªç°æœ‰ bean å®šä¹‰. æ³¨è§£å¯ä»¥ç›´æ¥ç”¨äºæµ‹è¯•ç±», æµ‹è¯•ä¸­çš„å­—æ®µæˆ– <code>@Configuration</code> ç±»å’Œå­—æ®µ. åœ¨å­—æ®µä¸Šä½¿ç”¨æ—¶, è¿˜å°†æ³¨å…¥åˆ›å»ºçš„æ¨¡æ‹Ÿçš„å®ä¾‹. æ¯ç§æµ‹è¯•æ–¹æ³•å, æ¨¡æ‹Ÿ Bean éƒ½ä¼šè‡ªåŠ¨é‡ç½®.</p><p>å¦‚æœæ‚¨çš„æµ‹è¯•ä½¿ç”¨ Spring Boot çš„æµ‹è¯•æ³¨è§£ä¹‹ä¸€ (ä¾‹å¦‚ <code>@SpringBootTest</code>) , åˆ™ä¼šè‡ªåŠ¨å¯ç”¨æ­¤åŠŸèƒ½. è¦ä»¥å…¶ä»–æ–¹å¼ä½¿ç”¨æ­¤åŠŸèƒ½, å¿…é¡»æ˜¾å¼æ·»åŠ ç›‘å¬å™¨, å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><p>Java</p><p>Kotlin</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@ContextConfiguration</span>(classes = MyConfig.class)<span class="hljs-variable">@TestExecutionListeners</span>(&#123; MockitoTestExecutionListener.class, ResetMocksTestExecutionListener.class &#125;)class MyTests &#123;<br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸‹é¢çš„ç¤ºä¾‹ç”¨æ¨¡æ‹Ÿå®ç°æ›¿æ¢ç°æœ‰çš„ <code>RemoteService</code> bean:</p><p>Java</p><p>Kotlin</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@SpringBootTestclass</span> <span class="hljs-title class_">MyTests</span> &#123;<br>    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Reverser</span> reverser;<br>    <span class="hljs-meta">@MockBean</span>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">RemoteService</span> remoteService;<br>    <span class="hljs-meta">@Test</span>    <span class="hljs-built_in">void</span> <span class="hljs-title function_">exampleTest</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-title function_">given</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">remoteService</span>.<span class="hljs-title function_">getValue</span>()).<span class="hljs-title function_">willReturn</span>(<span class="hljs-string">&quot;spring&quot;</span>);        <span class="hljs-title class_">String</span> reverse = <span class="hljs-variable language_">this</span>.<span class="hljs-property">reverser</span>.<span class="hljs-title function_">getReverseValue</span>(); <span class="hljs-comment">// Calls injected RemoteService        assertThat(reverse).isEqualTo(&quot;gnirps&quot;);    &#125;</span><br>&#125;<br></code></pre></td></tr></table></figure><p><code>@MockBean</code> ä¸èƒ½ç”¨äºæ¨¡æ‹Ÿåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡åˆ·æ–°æœŸé—´æ‰§è¡Œçš„ bean çš„è¡Œä¸º. åˆ°æ‰§è¡Œæµ‹è¯•æ—¶, åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡åˆ·æ–°å·²å®Œæˆ, å¹¶ä¸”é…ç½®æ¨¡æ‹Ÿè¡Œä¸ºä¸ºæ—¶å·²æ™š. æˆ‘ä»¬å»ºè®®åœ¨è¿™ç§æƒ…å†µä¸‹ä½¿ç”¨ <code>@Bean</code> æ–¹æ³•åˆ›å»ºå’Œé…ç½®æ¨¡æ‹Ÿ.</p><p>æ­¤å¤–, æ‚¨å¯ä»¥ä½¿ç”¨ <code>@SpyBean</code> ç”¨ Mockito <code>spy</code> åŒ…è£…ä»»ä½•ç°æœ‰çš„ bean. æœ‰å…³å®Œæ•´çš„è¯¦ç»†ä¿¡æ¯, è¯·å‚è§ <a href="https://docs.spring.io/spring-boot/docs/3.0.0/api/org/springframework/boot/test/mock/mockito/SpyBean.html">Javadoc</a>.</p><p>CGLib ä»£ç† (ä¾‹å¦‚ä¸ºä½œç”¨åŸŸå†…çš„ Bean åˆ›å»ºçš„ä»£ç†) å°†ä»£ç†æ–¹æ³•å£°æ˜ä¸º <code>final</code>. è¿™å°†é˜»æ­¢ Mockito æ­£å¸¸è¿è¡Œ, å› ä¸ºå®ƒæ— æ³•åœ¨å…¶é»˜è®¤é…ç½®ä¸­æ¨¡æ‹Ÿæˆ–ç›‘è§†æœ€ç»ˆæ–¹æ³•. å¦‚æœè¦æ¨¡æ‹Ÿæˆ–ç›‘è§†è¿™æ ·çš„ bean, è¯·é€šè¿‡å°† <code>org.mockito:mockito-inline</code> æ·»åŠ åˆ°åº”ç”¨ç¨‹åºçš„æµ‹è¯•ä¾èµ–ä¸­, å°† Mockito é…ç½®ä¸ºä½¿ç”¨å…¶åµŒå…¥å¼æ¨¡æ‹Ÿç”Ÿæˆå™¨. è¿™å…è®¸ Mockito æ¨¡æ‹Ÿå’Œç›‘è§† <code>final</code> æ–¹æ³•.</p><p>Spring çš„æµ‹è¯•æ¡†æ¶åœ¨æµ‹è¯•ä¹‹é—´ç¼“å­˜åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡, å¹¶ä¸ºå…±äº«ç›¸åŒé…ç½®çš„æµ‹è¯•é‡ç”¨ä¸Šä¸‹æ–‡, è€Œ <code>@MockBean</code> æˆ– <code>@SpyBean</code> çš„ä½¿ç”¨ä¼šå½±å“ç¼“å­˜é”®, è¿™å¾ˆå¯èƒ½ä¼šå¢åŠ ä¸Šä¸‹æ–‡æ•°é‡.</p><p>å¦‚æœæ‚¨ä½¿ç”¨ <code>@SpyBean</code> é€šè¿‡ <code>@Cacheable</code> æ–¹æ³•ç›‘è§†é€šè¿‡åç§°å¼•ç”¨å‚æ•°çš„ bean, åˆ™å¿…é¡»ä½¿ç”¨ <code>-parameters</code> ç¼–è¯‘åº”ç”¨ç¨‹åº. è¿™æ ·å¯ä»¥ç¡®ä¿ä¸€æ—¦ä¾¦å¯Ÿåˆ° bean, å‚æ•°åç§°å°±å¯ç”¨äºç¼“å­˜åŸºç¡€ç»“æ„.</p><p>å½“æ‚¨ä½¿ç”¨ <code>@SpyBean</code> ç›‘è§†ç”± Spring ä»£ç†çš„ bean æ—¶, åœ¨æŸäº›æƒ…å†µä¸‹, ä¾‹å¦‚ä½¿ç”¨ <code>given</code> æˆ– <code>when</code> è®¾ç½®æœŸæœ›å€¼æ—¶, æ‚¨å¯èƒ½éœ€è¦åˆ é™¤ Spring çš„ä»£ç†. ä½¿ç”¨ <code>AopTestUtils.getTargetObject(yourProxiedSpy)</code></p><h4 id="8-3-13-è‡ªåŠ¨é…ç½®æµ‹è¯•"><a href="#8-3-13-è‡ªåŠ¨é…ç½®æµ‹è¯•" class="headerlink" title="8.3.13. è‡ªåŠ¨é…ç½®æµ‹è¯•"></a>8.3.13. è‡ªåŠ¨é…ç½®æµ‹è¯•</h4><p>Spring Boot çš„è‡ªåŠ¨é…ç½®é€‚ç”¨äºåº”ç”¨ç¨‹åº, ä½†æœ‰æ—¶å¯¹æµ‹è¯•æ¥è¯´å¯èƒ½æœ‰ç‚¹è¿‡å¤š. å®ƒé€šå¸¸ä»…æœ‰åŠ©äºåŠ è½½æµ‹è¯•åº”ç”¨ç¨‹åº â€œåˆ‡ç‰‡â€ æ‰€éœ€çš„é…ç½®éƒ¨åˆ†. ä¾‹å¦‚, æ‚¨å¯èƒ½æƒ³è¦åœ¨æµ‹è¯•è¿è¡Œæ—¶æµ‹è¯• Spring MVC æ§åˆ¶å™¨æ˜¯å¦æ­£ç¡®æ˜ å°„äº† URL, å¹¶ä¸”æ‚¨ä¸æƒ³åœ¨è¿™äº›æµ‹è¯•ä¸­æ¶‰åŠæ•°æ®åº“è°ƒç”¨, æˆ–è€…æ‚¨æƒ³è¦æµ‹è¯• JPA å®ä½“.</p><p><code>spring-boot-test-autoconfigure</code> æ¨¡å—åŒ…æ‹¬è®¸å¤šæ³¨è§£, å¯ç”¨äºè‡ªåŠ¨é…ç½®æ­¤ç±» â€œåˆ‡ç‰‡â€. å®ƒä»¬ä¸­çš„æ¯ä¸€ä¸ªéƒ½ä»¥ç›¸ä¼¼çš„æ–¹å¼å·¥ä½œ, æä¾›äº†ä¸€ä¸ª <code>@â€¦Test</code> æ³¨è§£ (è¯¥æ³¨è§£åŠ è½½äº† <code>ApplicationContext</code>) ä»¥åŠä¸€ä¸ªæˆ–å¤šä¸ª <code>@AutoConfigureâ€¦</code> (å¯ç”¨äºè‡ªå®šä¹‰è‡ªåŠ¨é…ç½®è®¾ç½®çš„æ³¨è§£) .</p><p>æ¯ä¸ª â€œslicingâ€ å°†ç»„ä»¶æ‰«æé™åˆ¶ä¸ºé€‚å½“çš„ç»„ä»¶, å¹¶åŠ è½½ä¸€ç»„éå¸¸å—é™åˆ¶çš„è‡ªåŠ¨é…ç½®ç±». å¦‚æœæ‚¨éœ€è¦æ’é™¤å…¶ä¸­ä¹‹ä¸€, å¤§å¤šæ•° <code>@â€¦Test</code> æ³¨è§£æä¾›äº† <code>excludeAutoConfiguration</code> å±æ€§. æˆ–è€…, æ‚¨å¯ä»¥ä½¿ç”¨ <code>@ImportAutoConfiguration#exclude</code>.</p><p>ä¸æ”¯æŒåœ¨ä¸€ä¸ªæµ‹è¯•ä¸­ä½¿ç”¨å¤šä¸ª <code>@â€¦Test</code> æ³¨è§£æ¥åŒ…å«å¤šä¸ª â€œç‰‡æ®µâ€. å¦‚æœæ‚¨éœ€è¦å¤šä¸ª â€œslicesâ€, è¯·é€‰æ‹© <code>@â€¦Test</code> æ³¨è§£ä¹‹ä¸€, å¹¶æ‰‹åŠ¨æ·»åŠ å…¶ä»– â€œslicesâ€ çš„ <code>@AutoConfigureâ€¦</code> æ³¨è§£.</p><p>ä¹Ÿå¯ä»¥å°† <code>@AutoConfigureâ€¦</code> æ³¨è§£ä¸æ ‡å‡†çš„ <code>@SpringBootTest</code> æ³¨è§£ä¸€èµ·ä½¿ç”¨. å¦‚æœæ‚¨å¯¹ â€œslicingâ€ åº”ç”¨ç¨‹åºä¸æ„Ÿå…´è¶£, ä½†éœ€è¦ä¸€äº›è‡ªåŠ¨é…ç½®çš„æµ‹è¯• bean, åˆ™å¯ä»¥ä½¿ç”¨æ­¤ç»„åˆ.</p><h4 id="8-3-14-è‡ªåŠ¨é…ç½®çš„-JSON-æµ‹è¯•"><a href="#8-3-14-è‡ªåŠ¨é…ç½®çš„-JSON-æµ‹è¯•" class="headerlink" title="8.3.14. è‡ªåŠ¨é…ç½®çš„ JSON æµ‹è¯•"></a>8.3.14. è‡ªåŠ¨é…ç½®çš„ JSON æµ‹è¯•</h4><p>è¦æµ‹è¯•å¯¹è±¡ JSON åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ˜¯å¦æŒ‰é¢„æœŸå·¥ä½œ, å¯ä»¥ä½¿ç”¨ <code>@JsonTest</code> æ³¨è§£. <code>@JsonTest</code> è‡ªåŠ¨é…ç½®å¯ç”¨çš„å—æ”¯æŒçš„ JSON æ˜ å°„å™¨, è¯¥æ˜ å°„å™¨å¯ä»¥æ˜¯ä»¥ä¸‹åº“ä¹‹ä¸€:</p><ul><li>Jackson <code>ObjectMapper</code>, ä»»ä½•ä½¿ç”¨ <code>@JsonComponent</code> çš„ beans å’Œ ä»»ä½• Jackson <code>Module</code></li><li><code>Gson</code></li><li><code>Jsonb</code></li></ul><p>å¯ä»¥åœ¨ <a href="https://sca.aliyun.com/learn/spring-boot/core/test-auto-configuration.html#appendix.test-auto-configuration">é™„å½•</a> ä¸­æ‰¾åˆ°ç”± <code>@JsonTest</code> å¯ç”¨çš„è‡ªåŠ¨é…ç½®åˆ—è¡¨.</p><p>å¦‚æœéœ€è¦é…ç½®è‡ªåŠ¨é…ç½®çš„å…ƒç´ , åˆ™å¯ä»¥ä½¿ç”¨ <code>@AutoConfigureJsonTesters</code> æ³¨è§£.</p><p>Spring Boot åŒ…å«åŸºäº AssertJ çš„å¸®åŠ©ç¨‹åº, è¿™äº›å¸®åŠ©ç¨‹åºå¯ä¸ JSONAssert å’Œ JsonPath åº“ä¸€èµ·ä½¿ç”¨, ä»¥æ£€æŸ¥ JSON æ˜¯å¦æŒ‰é¢„æœŸæ–¹å¼æ˜¾ç¤º. <code>JacksonTester</code>, <code>GsonTester</code>, <code>JsonbTester</code> å’Œ <code>BasicJsonTester</code> ç±»å¯ä»¥åˆ†åˆ«ç”¨äº Jackson, Gson, Jsonb å’Œ Strings. ä½¿ç”¨ <code>@JsonTest</code> æ—¶, å¯ä»¥ä½¿ç”¨ <code>@Autowired</code> æµ‹è¯•ç±»ä¸Šçš„ä»»ä½•å¸®åŠ©ç¨‹åºå­—æ®µ. ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº† Jackson çš„æµ‹è¯•ç±»:</p><p>Java</p><p>Kotlin</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">@JsonTestclass MyJsonTests &#123;<br>    @Autowired    private JacksonTester&lt;VehicleDetails&gt; <span class="hljs-type">json</span>;<br>    @Test    <span class="hljs-type">void</span> serialize() throws <span class="hljs-keyword">Exception</span> &#123;        VehicleDetails details = <span class="hljs-built_in">new</span> VehicleDetails(&quot;Honda&quot;, &quot;Civic&quot;);        // <span class="hljs-keyword">Assert</span> against a `.json` file <span class="hljs-keyword">in</span> the same package <span class="hljs-keyword">as</span> the test        assertThat(this.json.<span class="hljs-keyword">write</span>(details)).isEqualToJson(&quot;expected.json&quot;);        // <span class="hljs-keyword">Or</span> use <span class="hljs-type">JSON</span> <span class="hljs-keyword">path</span> based assertions        assertThat(this.json.<span class="hljs-keyword">write</span>(details)).hasJsonPathStringValue(&quot;@.make&quot;);        assertThat(this.json.<span class="hljs-keyword">write</span>(details)).extractingJsonPathStringValue(&quot;@.make&quot;).isEqualTo(&quot;Honda&quot;);    &#125;<br>    @Test    <span class="hljs-type">void</span> deserialize() throws <span class="hljs-keyword">Exception</span> &#123;        String content = &quot;&#123;\&quot;make\&quot;:\&quot;Ford\&quot;,\&quot;model\&quot;:\&quot;Focus\&quot;&#125;&quot;;        assertThat(this.json.parse(content)).isEqualTo(<span class="hljs-built_in">new</span> VehicleDetails(&quot;Ford&quot;, &quot;Focus&quot;));        assertThat(this.json.parseObject(content).getMake()).isEqualTo(&quot;Ford&quot;);    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>JSON å¸®åŠ©ç¨‹åºç±»ä¹Ÿå¯ä»¥ç›´æ¥åœ¨æ ‡å‡†å•å…ƒæµ‹è¯•ä¸­ä½¿ç”¨. ä¸ºæ­¤, å¦‚æœä¸ä½¿ç”¨ <code>@JsonTest</code>, è¯·åœ¨ <code>@Before</code> æ–¹æ³•ä¸­è°ƒç”¨å¸®åŠ©ç¨‹åºçš„ <code>initFields</code> æ–¹æ³•.</p><p>å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ Spring Boot åŸºäº AssertJ çš„å¸®åŠ©å™¨, ä»¥ç»™å®šçš„ JSON è·¯å¾„å¯¹æ•°å­—å€¼è¿›è¡Œæ–­è¨€, åˆ™å–å†³äºç±»å‹, æ‚¨å¯èƒ½æ— æ³•ä½¿ç”¨ <code>isEqualTo</code>. ç›¸å, æ‚¨å¯ä»¥ä½¿ç”¨ AssertJ çš„æ»¡è¶³æ¡ä»¶æ¥æ–­è¨€è¯¥å€¼ç¬¦åˆç»™å®šæ¡ä»¶. ä¾‹å¦‚, ä»¥ä¸‹ç¤ºä¾‹æ–­è¨€å®é™…æ•°æ˜¯ä¸€ä¸ªåç§»é‡ä¸º <code>0.01</code> ä¸”æ¥è¿‘ <code>0.15</code> çš„æµ®ç‚¹å€¼.</p><p>Java</p><p>Kotlin</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs livescript">@Test<br><br><span class="hljs-literal">void</span> someTest() throws Exception &#123;<br><br>    SomeObject value = <span class="hljs-keyword">new</span> SomeObject(<span class="hljs-number">0.152f</span>);<br><br>    assertThat(this.json.write(value)).extractingJsonPathNumberValue(<span class="hljs-string">&quot;@.test.numberValue&quot;</span>)<br><br>            .satisfies<span class="hljs-function"><span class="hljs-params">((number) -&gt; assertThat(number.floatValue()).isCloseTo(<span class="hljs-number">0.15f</span>, within(<span class="hljs-number">0.01f</span>)))</span>;</span><br><span class="hljs-function"></span><br><span class="hljs-function">&#125;</span><br></code></pre></td></tr></table></figure><h4 id="8-3-15-è‡ªåŠ¨é…ç½®çš„-Spring-MVC-æµ‹è¯•"><a href="#8-3-15-è‡ªåŠ¨é…ç½®çš„-Spring-MVC-æµ‹è¯•" class="headerlink" title="8.3.15. è‡ªåŠ¨é…ç½®çš„ Spring MVC æµ‹è¯•"></a>8.3.15. è‡ªåŠ¨é…ç½®çš„ Spring MVC æµ‹è¯•</h4><p>è¦æµ‹è¯• Spring MVC æ§åˆ¶å™¨æ˜¯å¦æŒ‰é¢„æœŸå·¥ä½œ, è¯·ä½¿ç”¨ <code>@WebMvcTest</code> æ³¨è§£. <code>@WebMvcTest</code> è‡ªåŠ¨é…ç½® Spring MVC åŸºç¡€ç»“æ„, å¹¶å°†æ‰«æçš„ bean é™åˆ¶ä¸º <code>@Controller</code>, <code>@ControllerAdvice</code>, <code>@JsonComponent</code>, <code>Converter</code>, <code>GenericConverter</code>, <code>Filter</code>, <code>HandlerInterceptor</code>, <code>WebMvcConfigurer</code>, <code>WebMvcRegistrations</code> å’Œ <code>HandlerMethodArgumentResolver</code>. ä½¿ç”¨æ­¤æ³¨è§£æ—¶, ä¸æ‰«æå¸¸è§„ <code>@Component</code> , <code>@ConfigurationProperties</code> bean. <code>@EnableConfigurationProperties</code> å¯ç”¨äºåŒ…å« <code>@ConfigurationProperties</code> çš„ bean</p><p>å¯ä»¥åœ¨ <a href="https://sca.aliyun.com/learn/spring-boot/core/test-auto-configuration.html#appendix.test-auto-configuration">é™„å½•ä¸­</a> æ‰¾åˆ° <code>@WebMvcTest</code> å¯ç”¨çš„è‡ªåŠ¨é…ç½®è®¾ç½®çš„åˆ—è¡¨.</p><p>å¦‚æœéœ€è¦æ³¨å†Œå…¶ä»–ç»„ä»¶, ä¾‹å¦‚ Jackson <code>Module</code>, åˆ™å¯ä»¥åœ¨æµ‹è¯•ä¸­ä½¿ç”¨ <code>@Import</code> å¯¼å…¥å…¶ä»–é…ç½®ç±».</p><p><code>@WebMvcTest</code> é€šå¸¸ä»…é™äºå•ä¸ªæ§åˆ¶å™¨, å¹¶ä¸ <code>@MockBean</code> ç»“åˆä½¿ç”¨, ä»¥ä¸ºæ‰€éœ€çš„åä½œè€…æä¾›æ¨¡æ‹Ÿå®ç°.</p><p><code>@WebMvcTest</code> è¿˜å¯ä»¥è‡ªåŠ¨é…ç½® <code>MockMvc</code>. Mock MVC æä¾›äº†ä¸€ç§å¼ºå¤§çš„æ–¹æ³•æ¥å¿«é€Ÿæµ‹è¯• MVC æ§åˆ¶å™¨, è€Œæ— éœ€å¯åŠ¨å®Œæ•´çš„ HTTP æœåŠ¡å™¨.</p><p>æ‚¨è¿˜å¯ä»¥é€šè¿‡åœ¨é <code>@WebMvcTest</code> (ä¾‹å¦‚ <code>@SpringBootTest</code>) ä¸­ä½¿ç”¨ <code>@AutoConfigureMockMvc</code> å¯¹å…¶è¿›è¡Œæ³¨è§£æ¥è‡ªåŠ¨é…ç½® <code>MockMvc</code>. ä»¥ä¸‹ç¤ºä¾‹ä½¿ç”¨ <code>MockMvc</code>:</p><p>Java</p><p>Kotlin</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@WebMvcTest(<span class="hljs-params">UserVehicleController.<span class="hljs-keyword">class</span></span>)class MyControllerTests &#123;</span><br><span class="hljs-meta">    @Autowired    private MockMvc mvc;</span><br><span class="hljs-meta">    @MockBean    private UserVehicleService userVehicleService;</span><br><span class="hljs-meta">    @Test    void testExample() throws Exception &#123;        given(<span class="hljs-params">this.userVehicleService.getVehicleDetails(<span class="hljs-params"><span class="hljs-string">&quot;sboot&quot;</span></span>)</span>)            .willReturn(<span class="hljs-params">new VehicleDetails(<span class="hljs-params"><span class="hljs-string">&quot;Honda&quot;</span>, <span class="hljs-string">&quot;Civic&quot;</span></span>)</span>);        this.mvc.perform(<span class="hljs-params">get(<span class="hljs-params"><span class="hljs-string">&quot;/sboot/vehicle&quot;</span></span>).accept(<span class="hljs-params">MediaType.TEXT_PLAIN</span>)</span>)            .andExpect(<span class="hljs-params">status(<span class="hljs-params"></span>).isOk(<span class="hljs-params"></span>)</span>)            .andExpect(<span class="hljs-params">content(<span class="hljs-params"></span>).string(<span class="hljs-params"><span class="hljs-string">&quot;Honda Civic&quot;</span></span>)</span>);    &#125;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœæ‚¨éœ€è¦é…ç½®è‡ªåŠ¨é…ç½®çš„å…ƒç´  (ä¾‹å¦‚, å½“åº”è¯¥åº”ç”¨ servlet è¿‡æ»¤å™¨æ—¶) , åˆ™å¯ä»¥ä½¿ç”¨ <code>@AutoConfigureMockMvc</code> æ³¨è§£ä¸­çš„å±æ€§.</p><p>å¦‚æœä½¿ç”¨ HtmlUnit æˆ– Selenium, åˆ™è‡ªåŠ¨é…ç½®è¿˜ä¼šæä¾› HtmlUnit <code>WebClient</code> bean å’Œ&#x2F;æˆ– Selenium <code>WebDriver</code> bean. ä»¥ä¸‹ç¤ºä¾‹ä½¿ç”¨ HtmlUnit:</p><p>Java</p><p>Kotlin</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@WebMvcTest(UserVehicleController.class)</span><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyHtmlUnitTests</span> &#123;<br>    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">private</span> WebClient webClient;<br>    <span class="hljs-meta">@MockBean</span>    <span class="hljs-keyword">private</span> UserVehicleService userVehicleService;<br>    <span class="hljs-meta">@Test</span>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testExample</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;        given(<span class="hljs-built_in">this</span>.userVehicleService.getVehicleDetails(<span class="hljs-string">&quot;sboot&quot;</span>)).willReturn(<span class="hljs-keyword">new</span> <span class="hljs-title class_">VehicleDetails</span>(<span class="hljs-string">&quot;Honda&quot;</span>, <span class="hljs-string">&quot;Civic&quot;</span>));        <span class="hljs-type">HtmlPage</span> <span class="hljs-variable">page</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.webClient.getPage(<span class="hljs-string">&quot;/sboot/vehicle.html&quot;</span>);        assertThat(page.getBody().getTextContent()).isEqualTo(<span class="hljs-string">&quot;Honda Civic&quot;</span>);    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é»˜è®¤æƒ…å†µä¸‹, Spring Boot å°† <code>WebDriver</code> bean æ”¾åœ¨ç‰¹æ®Šçš„ â€œscopeâ€ ä¸­, ä»¥ç¡®ä¿é©±åŠ¨ç¨‹åºåœ¨æ¯æ¬¡æµ‹è¯•åé€€å‡ºå¹¶æ³¨å…¥æ–°å®ä¾‹. å¦‚æœæ‚¨ä¸å¸Œæœ›å‡ºç°è¿™ç§æƒ…å†µ, åˆ™å¯ä»¥å°† <code>@Scope(&quot;singleton&quot;)</code> æ·»åŠ åˆ° <code>WebDriver</code> <code>@Bean</code> å®šä¹‰ä¸­.</p><p>Spring Boot åˆ›å»ºçš„ <code>webDriver</code> ä½œç”¨åŸŸå°†æ›¿æ¢ä»»ä½•ç”¨æˆ·å®šä¹‰çš„åŒåä½œç”¨åŸŸ. å¦‚æœå®šä¹‰è‡ªå·±çš„ <code>webDriver</code> ä½œç”¨åŸŸ, åˆ™ä½¿ç”¨ <code>@WebMvcTest</code> æ—¶å¯èƒ½ä¼šå‘ç°å®ƒåœæ­¢å·¥ä½œ.</p><p>å¦‚æœæ‚¨åœ¨ç±»è·¯å¾„ä¸Šå…·æœ‰ Spring Security, åˆ™ <code>@WebMvcTest</code> è¿˜å°†æ‰«æ <code>WebSecurityConfigurer</code> Bean. æ‚¨å¯ä»¥ä½¿ç”¨ Spring Security çš„æµ‹è¯•æ”¯æŒæ¥ä»£æ›¿å®Œå…¨ç¦ç”¨æ­¤ç±»æµ‹è¯•çš„å®‰å…¨æ€§. æœ‰å…³å¦‚ä½•ä½¿ç”¨ Spring Security çš„ <code>MockMvc</code> æ”¯æŒçš„æ›´å¤šè¯¦ç»†ä¿¡æ¯, è¯·å‚è§ <em><a href="https://sca.aliyun.com/learn/spring-boot/core/howto.html#howto.testing.with-spring-security">howto.html</a></em> æ“ä½œæ–¹æ³•éƒ¨åˆ†.</p><p>æœ‰æ—¶ç¼–å†™ Spring MVC æµ‹è¯•æ˜¯ä¸å¤Ÿçš„. Spring Boot å¯ä»¥å¸®åŠ©æ‚¨åœ¨ <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.testing.spring-boot-applications.with-running-server">å®é™…æœåŠ¡å™¨ä¸Šè¿è¡Œå®Œæ•´çš„ç«¯åˆ°ç«¯æµ‹è¯•</a>.</p><h4 id="8-3-16-è‡ªåŠ¨é…ç½®çš„-Spring-WebFlux-æµ‹è¯•"><a href="#8-3-16-è‡ªåŠ¨é…ç½®çš„-Spring-WebFlux-æµ‹è¯•" class="headerlink" title="8.3.16. è‡ªåŠ¨é…ç½®çš„ Spring WebFlux æµ‹è¯•"></a>8.3.16. è‡ªåŠ¨é…ç½®çš„ Spring WebFlux æµ‹è¯•</h4><p>è¦æµ‹è¯• Spring WebFlux æ§åˆ¶å™¨æ˜¯å¦æŒ‰é¢„æœŸå·¥ä½œ, å¯ä»¥ä½¿ç”¨ <code>@WebFluxTest</code> æ³¨è§£. <code>@WebFluxTest</code> è‡ªåŠ¨é…ç½® Spring WebFlux åŸºç¡€ç»“æ„, å¹¶å°†æ‰«æçš„ bean é™åˆ¶ä¸º <code>@Controller</code>, <code>@ControllerAdvice</code>, <code>@JsonComponent</code>, <code>Converter</code>, <code>GenericConverter</code>, <code>WebFilter</code> å’Œ <code>WebFluxConfigurer</code>. ä½¿ç”¨ <code>@WebFluxTest</code> æ³¨è§£æ—¶, ä¸æ‰«æå¸¸è§„ <code>@Component</code> å’Œ <code>@ConfigurationProperties</code> bean.<code>@EnableConfigurationProperties</code> å¯ç”¨äºåŒ…å« <code>@ConfigurationProperties</code> çš„ bean</p><p>å¯ä»¥åœ¨ <a href="https://sca.aliyun.com/learn/spring-boot/core/test-auto-configuration.html#appendix.test-auto-configuration">é™„å½•ä¸­</a> æ‰¾åˆ° <code>@WebFluxTest</code> å¯ç”¨çš„è‡ªåŠ¨é…ç½®çš„åˆ—è¡¨. .</p><p>å¦‚æœéœ€è¦æ³¨å†Œå…¶ä»–ç»„ä»¶, ä¾‹å¦‚ Jackson <code>Module</code>, åˆ™å¯ä»¥åœ¨æµ‹è¯•ä¸­ä½¿ç”¨ <code>@Import</code> å¯¼å…¥å…¶ä»–é…ç½®ç±».</p><p>é€šå¸¸, <code>@WebFluxTest</code> ä»…é™äºå•ä¸ªæ§åˆ¶å™¨, å¹¶ä¸ <code>@MockBean</code> æ³¨è§£ç»“åˆä½¿ç”¨, ä»¥ä¸ºæ‰€éœ€çš„åä½œè€…æä¾›æ¨¡æ‹Ÿå®ç°.</p><p><code>@WebFluxTest</code> è¿˜å¯ä»¥è‡ªåŠ¨é…ç½® <a href="https://sca.aliyun.com/blog/learning/spring/core/testing#webtestclient"><code>WebTestClient</code></a>, å®ƒæä¾›äº†ä¸€ç§å¼ºå¤§çš„æ–¹æ³•æ¥å¿«é€Ÿæµ‹è¯• WebFlux æ§åˆ¶å™¨, è€Œæ— éœ€å¯åŠ¨å®Œæ•´çš„ HTTP æœåŠ¡å™¨.</p><p>æ‚¨è¿˜å¯ä»¥é€šè¿‡åœ¨é <code>@WebFluxTest</code> (ä¾‹å¦‚ <code>@SpringBootTest</code>) ä¸­è‡ªåŠ¨é…ç½® <code>WebTestClient</code>, æ–¹æ³•æ˜¯ä½¿ç”¨ <code>@AutoConfigureWebTestClient</code> å¯¹å…¶è¿›è¡Œæ³¨è§£. ä¸‹é¢çš„ç¤ºä¾‹æ˜¾ç¤ºä¸€ä¸ªåŒæ—¶ä½¿ç”¨ <code>@WebFluxTest</code> å’Œ <code>WebTestClient</code> çš„ç±»:</p><p>Java</p><p>Kotlin</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@WebFluxTest(UserVehicleController.class)</span><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyControllerTests</span> &#123;<br>    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">private</span> WebTestClient webClient;<br>    <span class="hljs-meta">@MockBean</span>    <span class="hljs-keyword">private</span> UserVehicleService userVehicleService;<br>    <span class="hljs-meta">@Test</span>    void testExample() &#123;        given(<span class="hljs-keyword">this</span>.userVehicleService.getVehicleDetails(<span class="hljs-string">&quot;sboot&quot;</span>))            .willReturn(new VehicleDetails(<span class="hljs-string">&quot;Honda&quot;</span>, <span class="hljs-string">&quot;Civic&quot;</span>));        <span class="hljs-keyword">this</span>.webClient.<span class="hljs-keyword">get</span>().uri(<span class="hljs-string">&quot;/sboot/vehicle&quot;</span>).accept(MediaType.TEXT_PLAIN).exchange()            .expectStatus().isOk()            .expectBody(String.<span class="hljs-keyword">class</span>).isEqualTo(<span class="hljs-string">&quot;Honda Civic&quot;</span>);    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>WebFlux åº”ç”¨ç¨‹åºä»…æ”¯æŒæ­¤è®¾ç½®, å› ä¸ºåœ¨æ¨¡æ‹Ÿçš„ Web åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ <code>WebTestClient</code> ç›®å‰ä»…ä¸ WebFlux ä¸€èµ·ä½¿ç”¨.</p><p><code>@WebFluxTest</code> æ— æ³•æ£€æµ‹é€šè¿‡åŠŸèƒ½ Web æ¡†æ¶æ³¨å†Œçš„è·¯ç”±. ä¸ºäº†åœ¨ä¸Šä¸‹æ–‡ä¸­æµ‹è¯• <code>RouterFunction</code> bean, è¯·è€ƒè™‘è‡ªå·±é€šè¿‡ <code>@Import</code> æˆ–ä½¿ç”¨ <code>@SpringBootTest</code> å¯¼å…¥ <code>RouterFunction</code>.</p><p><code>@WebFluxTest</code> æ— æ³•æ£€æµ‹é€šè¿‡ <code>SecurityWebFilterChain</code> ç±»å‹çš„ <code>@Bean</code> æ³¨å†Œçš„è‡ªå®šä¹‰å®‰å…¨é…ç½®. è¦å°†å…¶åŒ…æ‹¬åœ¨æµ‹è¯•ä¸­, æ‚¨å°†éœ€è¦é€šè¿‡ <code>@Import</code> å¯¼å…¥æˆ–ä½¿ç”¨ <code>@SpringBootTest</code> å¯¼å…¥ç”¨äºæ³¨å†Œ bean çš„é…ç½®.</p><p>æœ‰æ—¶ç¼–å†™ Spring WebFlux æµ‹è¯•æ˜¯ä¸å¤Ÿçš„. Spring Boot å¯ä»¥å¸®åŠ©æ‚¨åœ¨ <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.testing.spring-boot-applications.with-running-server">å®é™…æœåŠ¡å™¨ä¸Šè¿è¡Œå®Œæ•´çš„ç«¯åˆ°ç«¯æµ‹è¯•</a>.</p><h4 id="8-3-17-Spring-GraphQL-æµ‹è¯•è‡ªåŠ¨é…ç½®"><a href="#8-3-17-Spring-GraphQL-æµ‹è¯•è‡ªåŠ¨é…ç½®" class="headerlink" title="8.3.17. Spring GraphQL æµ‹è¯•è‡ªåŠ¨é…ç½®"></a>8.3.17. Spring GraphQL æµ‹è¯•è‡ªåŠ¨é…ç½®</h4><p>Spring GraphQL æä¾›äº†ä¸“é—¨çš„æµ‹è¯•æ”¯æŒæ¨¡å—ï¼› ä½ éœ€è¦å°†å®ƒæ·»åŠ åˆ°ä½ çš„é¡¹ç›®ä¸­ï¼š</p><p>Maven</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.graphql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-graphql-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>  <span class="hljs-comment">&lt;!-- Unless already present in the compile scope --&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-webflux<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><p>Gradle</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-variable">dependencies</span> &#123;<br><br>  <span class="hljs-function"><span class="hljs-title">testImplementation</span>(<span class="hljs-string">&quot;org.springframework.graphql:spring-graphql-test&quot;</span>)</span><br><br>  <span class="hljs-comment">// Unless already present in the implementation configuration</span><br><br>  <span class="hljs-function"><span class="hljs-title">testImplementation</span>(<span class="hljs-string">&quot;org.springframework.boot:spring-boot-starter-webflux&quot;</span>)</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæµ‹è¯•æ¨¡å—é™„å¸¦äº† GraphQlTester. spring-boot-project&#x2F;spring-boot-docs&#x2F;src&#x2F;docs&#x2F;asciidoc&#x2F;features&#x2F;testing.adoc</p><h4 id="8-3-18-è‡ªåŠ¨é…ç½®-Cassandra-æµ‹è¯•"><a href="#8-3-18-è‡ªåŠ¨é…ç½®-Cassandra-æµ‹è¯•" class="headerlink" title="8.3.18. è‡ªåŠ¨é…ç½® Cassandra æµ‹è¯•"></a>8.3.18. è‡ªåŠ¨é…ç½® Cassandra æµ‹è¯•</h4><p>æ‚¨å¯ä»¥ä½¿ç”¨ <code>@DataCassandraTest</code> æ³¨è§£æ¥æµ‹è¯• Cassandra åº”ç”¨ç¨‹åº. é»˜è®¤æƒ…å†µä¸‹, å®ƒå°†é…ç½®ä¸€ä¸ª <code>CassandraTemplate</code> æ¥æ‰«æ <code>@Table</code> ç±»å¹¶é…ç½® Spring Data Cassandra å­˜å‚¨åº“. ä½¿ç”¨ <code>@DataCassandraTest</code> æ³¨è§£æ—¶, ä¸æ‰«æå¸¸è§„ <code>@Component</code> å’Œ <code>@ConfigurationProperties</code> bean.<code>@EnableConfigurationProperties</code> å¯ç”¨äºåŒ…å« <code>@ConfigurationProperties</code> çš„ beanï¼ˆæœ‰å…³åœ¨ Spring Boot ä¸­ä½¿ç”¨ Cassandra çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…æœ¬ç« å‰é¢çš„ â€œ<a href="https://sca.aliyun.com/learn/spring-boot/core/data.html#data.nosql.cassandra">data.html</a>â€ï¼‰</p><p>å¯ä»¥åœ¨ <a href="https://sca.aliyun.com/learn/spring-boot/core/test-auto-configuration.html#appendix.test-auto-configuration">é™„å½•ä¸­</a> æ‰¾åˆ°ç”± <code>@DataCassandraTest</code> å¯ç”¨çš„è‡ªåŠ¨é…ç½®è®¾ç½®çš„åˆ—è¡¨.</p><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†åœ¨ Spring Boot ä¸­ä½¿ç”¨ Cassandra æµ‹è¯•çš„å…¸å‹è®¾ç½®:</p><p>Java</p><p>Kotlin</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@DataCassandraTestclass</span> MyDataCassandraTests &#123;<br>    <span class="hljs-variable">@Autowired</span>    private SomeRepository repository;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="8-3-19-è‡ªåŠ¨é…ç½®-Data-Couchbase-æµ‹è¯•"><a href="#8-3-19-è‡ªåŠ¨é…ç½®-Data-Couchbase-æµ‹è¯•" class="headerlink" title="8.3.19. è‡ªåŠ¨é…ç½® Data Couchbase æµ‹è¯•"></a>8.3.19. è‡ªåŠ¨é…ç½® Data Couchbase æµ‹è¯•</h4><p>æ‚¨å¯ä»¥ä½¿ç”¨ <code>@DataCouchbaseTest</code> æ³¨è§£æ¥æµ‹è¯• Couchbase åº”ç”¨ç¨‹åº. é»˜è®¤æƒ…å†µä¸‹, å®ƒå°†é…ç½®ä¸€ä¸ª <code>CouchbaseTemplate</code> æˆ– <code>ReactiveCouchbaseTemplate</code>, æ¥æ‰«æ <code>@Document</code> ç±»å¹¶é…ç½® Spring Data Couchbase å­˜å‚¨åº“. ä½¿ç”¨ <code>@DataCouchbaseTest</code> æ³¨è§£æ—¶, ä¸æ‰«æå¸¸è§„ <code>@Component</code> å’Œ <code>@ConfigurationProperties</code> bean.<code>@EnableConfigurationProperties</code> å¯ç”¨äºåŒ…å« <code>@ConfigurationProperties</code> çš„ beanï¼ˆæœ‰å…³åœ¨ Spring Boot ä¸­ä½¿ç”¨ Cassandra çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…æœ¬ç« å‰é¢çš„ â€œ<a href="https://sca.aliyun.com/learn/spring-boot/core/data.html#data.nosql.couchbase">data.html</a>â€ï¼‰</p><p>å¯ä»¥åœ¨ <a href="https://sca.aliyun.com/learn/spring-boot/core/test-auto-configuration.html#appendix.test-auto-configuration">é™„å½•ä¸­</a> æ‰¾åˆ°ç”± <code>@DataCouchbaseTest</code> å¯ç”¨çš„è‡ªåŠ¨é…ç½®è®¾ç½®çš„åˆ—è¡¨.</p><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†åœ¨ Spring Boot ä¸­ä½¿ç”¨ Couchbase æµ‹è¯•çš„å…¸å‹è®¾ç½®:</p><p>Java</p><p>Kotlin</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@DataCouchbaseTestclass</span> MyDataCouchbaseTests &#123;<br>    <span class="hljs-variable">@Autowired</span>    private SomeRepository repository;<br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="8-3-20-è‡ªåŠ¨é…ç½®-Data-Elasticsearch-æµ‹è¯•"><a href="#8-3-20-è‡ªåŠ¨é…ç½®-Data-Elasticsearch-æµ‹è¯•" class="headerlink" title="8.3.20. è‡ªåŠ¨é…ç½® Data Elasticsearch æµ‹è¯•"></a>8.3.20. è‡ªåŠ¨é…ç½® Data Elasticsearch æµ‹è¯•</h4><p>æ‚¨å¯ä»¥ä½¿ç”¨ <code>@DataElasticsearchTest</code> æ³¨è§£æ¥æµ‹è¯• Elasticsearch åº”ç”¨ç¨‹åº. é»˜è®¤æƒ…å†µä¸‹, å®ƒå°†é…ç½®ä¸€ä¸ª <code>ElasticsearchRestTemplate</code>, æ¥æ‰«æ <code>@Document</code> ç±»å¹¶é…ç½® Spring Data Elasticsearch å­˜å‚¨åº“. ä½¿ç”¨ <code>@DataElasticsearchTest</code> æ³¨è§£æ—¶, ä¸æ‰«æå¸¸è§„ <code>@Component</code> å’Œ <code>@ConfigurationProperties</code> bean.<code>@EnableConfigurationProperties</code> å¯ç”¨äºåŒ…å« <code>@ConfigurationProperties</code> çš„ beanï¼ˆæœ‰å…³åœ¨ Spring Boot ä¸­ä½¿ç”¨ Elasticsearch çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…æœ¬ç« å‰é¢çš„ â€œ<a href="https://sca.aliyun.com/learn/spring-boot/core/data.html#data.nosql.elasticsearch">data.html</a>â€ï¼‰</p><p>å¯ä»¥åœ¨ <a href="https://sca.aliyun.com/learn/spring-boot/core/test-auto-configuration.html#appendix.test-auto-configuration">é™„å½•ä¸­</a> æ‰¾åˆ°ç”± <code>@DataElasticsearchTest</code> å¯ç”¨çš„è‡ªåŠ¨é…ç½®è®¾ç½®çš„åˆ—è¡¨.</p><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†åœ¨ Spring Boot ä¸­ä½¿ç”¨ Elasticsearch æµ‹è¯•çš„å…¸å‹è®¾ç½®:</p><p>Java</p><p>Kotlin</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@DataElasticsearchTestclass</span> MyDataElasticsearchTests &#123;<br>    <span class="hljs-variable">@Autowired</span>    private SomeRepository repository;<br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="8-3-21-è‡ªåŠ¨é…ç½®çš„-Data-JPA-æµ‹è¯•"><a href="#8-3-21-è‡ªåŠ¨é…ç½®çš„-Data-JPA-æµ‹è¯•" class="headerlink" title="8.3.21. è‡ªåŠ¨é…ç½®çš„ Data JPA æµ‹è¯•"></a>8.3.21. è‡ªåŠ¨é…ç½®çš„ Data JPA æµ‹è¯•</h4><p>æ‚¨å¯ä»¥ä½¿ç”¨ <code>@DataJpaTest</code> æ³¨è§£æ¥æµ‹è¯• JPA åº”ç”¨ç¨‹åº. é»˜è®¤æƒ…å†µä¸‹, å®ƒå°†æ‰«æ <code>@Entity</code> ç±»å¹¶é…ç½® Spring Data JPA å­˜å‚¨åº“. å¦‚æœåœ¨ç±»è·¯å¾„ä¸Šæœ‰åµŒå…¥å¼æ•°æ®åº“, ä¹Ÿä¼šé…ç½®. é»˜è®¤æƒ…å†µä¸‹ï¼Œ é€šè¿‡å°† <code>spring.jpa.show-sql</code> å±æ€§è®¾ç½®ä¸º <code>true</code> æ¥è®°å½• SQL æŸ¥è¯¢. å¯ä»¥ä½¿ç”¨æ³¨è§£çš„ <code>showSql()</code> å±æ€§ç¦ç”¨æ­¤åŠŸèƒ½.</p><p>ä½¿ç”¨ <code>@DataJpaTest</code> æ³¨è§£æ—¶, ä¸æ‰«æå¸¸è§„ <code>@Component</code> å’Œ <code>@ConfigurationProperties</code> bean.<code>@EnableConfigurationProperties</code> å¯ç”¨äºåŒ…å« <code>@ConfigurationProperties</code> çš„ bean</p><p>å¯ä»¥åœ¨ <a href="https://sca.aliyun.com/learn/spring-boot/core/test-auto-configuration.html#appendix.test-auto-configuration">é™„å½•ä¸­</a> æ‰¾åˆ°ç”± <code>@DataJpaTest</code> å¯ç”¨çš„è‡ªåŠ¨é…ç½®è®¾ç½®çš„åˆ—è¡¨.</p><p>é»˜è®¤æƒ…å†µä¸‹, æ•°æ® JPA æµ‹è¯•æ˜¯äº‹åŠ¡æ€§çš„, å¹¶åœ¨æ¯æ¬¡æµ‹è¯•ç»“æŸæ—¶å›æ»š. æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯, è¯·å‚è§ã€ŠSpring Framework å‚è€ƒæ–‡æ¡£ã€‹ä¸­çš„ <a href="https://sca.aliyun.com/blog/learning/spring/core/testing#testcontext-tx-enabling-transactions">ç›¸å…³éƒ¨åˆ†</a> . å¦‚æœè¿™ä¸æ˜¯æ‚¨æƒ³è¦çš„, åˆ™å¯ä»¥æŒ‰ä»¥ä¸‹æ–¹å¼ç¦ç”¨æµ‹è¯•æˆ–æ•´ä¸ªç±»çš„äº‹åŠ¡ç®¡ç†:</p><p>Java</p><p>Kotlin</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@DataJpaTest</span><span class="hljs-variable">@Transactional</span>(propagation = Propagation.<span class="hljs-keyword">NOT</span>_SUPPORTED)class MyNonTransactionalTests &#123;<br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>JPA æµ‹è¯•ä¹Ÿå¯ä»¥æ³¨å…¥ <a href="https://github.com/spring-projects/spring-boot/tree/main/spring-boot-project/spring-boot-test-autoconfigure/src/main/java/org/springframework/boot/test/autoconfigure/orm/jpa/TestEntityManager.java"><code>TestEntityManager</code></a> bean, å®ƒä¸ºä¸“é—¨ä¸ºæµ‹è¯•è®¾è®¡çš„æ ‡å‡† JPA <code>EntityManager</code> æä¾›äº†æ›¿ä»£æ–¹æ³•.</p><p><code>TestEntityManager</code> ä¹Ÿå¯ä»¥é€šè¿‡æ·»åŠ  <code>@AutoConfigureTestEntityManager</code> è‡ªåŠ¨é…ç½®åˆ°ä»»ä½•åŸºäº Spring çš„æµ‹è¯•ç±»ã€‚ è¿™æ ·åšæ—¶ï¼Œè¯·ç¡®ä¿æ‚¨çš„æµ‹è¯•åœ¨äº‹åŠ¡ä¸­è¿è¡Œï¼Œä¾‹å¦‚é€šè¿‡åœ¨æµ‹è¯•ç±»æˆ–æ–¹æ³•ä¸Šæ·»åŠ  <code>@Transactional</code>ã€‚</p><p>å¦‚æœéœ€è¦, è¿˜å¯ä»¥ä½¿ç”¨ <code>JdbcTemplate</code>. ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†æ­£åœ¨ä½¿ç”¨çš„ <code>@DataJpaTest</code> æ³¨è§£:</p><p>Java</p><p>Kotlin</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@DataJpaTestclass MyRepositoryTests &#123;</span><br><span class="hljs-meta">    @Autowired    private TestEntityManager entityManager;</span><br><span class="hljs-meta">    @Autowired    private UserRepository repository;</span><br><span class="hljs-meta">    @Test    void testExample() &#123;        this.entityManager.persist(<span class="hljs-params">new User(<span class="hljs-params"><span class="hljs-string">&quot;sboot&quot;</span>, <span class="hljs-string">&quot;1234&quot;</span></span>)</span>);        User user = this.repository.findByUsername(<span class="hljs-params"><span class="hljs-string">&quot;sboot&quot;</span></span>);        assertThat(<span class="hljs-params">user.getUsername(<span class="hljs-params"></span>)</span>).isEqualTo(<span class="hljs-params"><span class="hljs-string">&quot;sboot&quot;</span></span>);        assertThat(<span class="hljs-params">user.getEmployeeNumber(<span class="hljs-params"></span>)</span>).isEqualTo(<span class="hljs-params"><span class="hljs-string">&quot;1234&quot;</span></span>);    &#125;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å†…å­˜åµŒå…¥å¼æ•°æ®åº“é€šå¸¸è¿è¡Œè‰¯å¥½, ä¸éœ€è¦ä»»ä½•å®‰è£…, å› æ­¤é€šå¸¸å¯ä»¥å¾ˆå¥½åœ°è¿›è¡Œæµ‹è¯•. ä½†æ˜¯, å¦‚æœæ‚¨å¸Œæœ›å¯¹çœŸå®æ•°æ®åº“è¿è¡Œæµ‹è¯•, åˆ™å¯ä»¥ä½¿ç”¨ <code>@AutoConfigureTestDatabase</code> æ³¨è§£, å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><p>Java</p><p>Kotlin</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@DataJpaTest</span><span class="hljs-variable">@AutoConfigureTestDatabase</span>(replace = Replace.NONE)class MyRepositoryTests &#123;<br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="8-3-22-è‡ªåŠ¨é…ç½®çš„-JDBC-æµ‹è¯•"><a href="#8-3-22-è‡ªåŠ¨é…ç½®çš„-JDBC-æµ‹è¯•" class="headerlink" title="8.3.22. è‡ªåŠ¨é…ç½®çš„ JDBC æµ‹è¯•"></a>8.3.22. è‡ªåŠ¨é…ç½®çš„ JDBC æµ‹è¯•</h4><p><code>@JdbcTest</code> ä¸ <code>@DataJpaTest</code> ç›¸ä¼¼, ä½†é€‚ç”¨äºä»…éœ€è¦ <code>DataSource</code> å¹¶ä¸”ä¸ä½¿ç”¨ Spring Data JDBC çš„æµ‹è¯•. é»˜è®¤æƒ…å†µä¸‹, å®ƒé…ç½®ä¸€ä¸ªå†…å­˜åµŒå…¥å¼æ•°æ®åº“å’Œä¸€ä¸ª <code>JdbcTemplate</code>. ä½¿ç”¨ <code>@JdbcTest</code> æ³¨è§£æ—¶, ä¸æ‰«æå¸¸è§„ <code>@Component</code> å’Œ <code>@ConfigurationProperties</code> bean.<code>@EnableConfigurationProperties</code> å¯ç”¨äºåŒ…å« <code>@ConfigurationProperties</code> çš„ bean</p><p>å¯ä»¥åœ¨ <a href="https://sca.aliyun.com/learn/spring-boot/core/test-auto-configuration.html#appendix.test-auto-configuration">é™„å½•ä¸­</a> æ‰¾åˆ° <code>@JdbcTest</code> å¯ç”¨çš„è‡ªåŠ¨é…ç½®çš„åˆ—è¡¨.</p><p>é»˜è®¤æƒ…å†µä¸‹, JDBC æµ‹è¯•æ˜¯äº‹åŠ¡æ€§çš„, å¹¶åœ¨æ¯ä¸ªæµ‹è¯•ç»“æŸæ—¶å›æ»š. æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯, è¯·å‚è§ã€Š Spring Framework å‚è€ƒæ–‡æ¡£ã€‹ä¸­çš„ <a href="https://sca.aliyun.com/blog/learning/spring/core/testing#testcontext-tx-enabling-transactions">ç›¸å…³éƒ¨åˆ†</a>. å¦‚æœè¿™ä¸æ˜¯æ‚¨æƒ³è¦çš„, åˆ™å¯ä»¥ä¸ºæµ‹è¯•æˆ–æ•´ä¸ªç±»ç¦ç”¨äº‹åŠ¡ç®¡ç†, å¦‚ä¸‹æ‰€ç¤º:</p><p>Java</p><p>Kotlin</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@JdbcTest</span><span class="hljs-variable">@Transactional</span>(propagation = Propagation.<span class="hljs-keyword">NOT</span>_SUPPORTED)class MyTransactionalTests &#123;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœæ‚¨å¸Œæœ›æµ‹è¯•é’ˆå¯¹çœŸå®æ•°æ®åº“è¿è¡Œ, åˆ™å¯ä»¥ä½¿ç”¨ <code>@AutoConfigureTestDatabase</code> æ³¨è§£, å…¶æ–¹å¼ä¸ <code>DataJpaTest</code> ç›¸åŒ. (è¯·å‚é˜… â€œ<a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.testing.spring-boot-applications.autoconfigured-spring-data-jpa">è‡ªåŠ¨é…ç½®çš„ Data JPA æµ‹è¯•</a>â€. )ã€‚</p><h4 id="8-3-23-è‡ªåŠ¨é…ç½®çš„-Data-JDBC-æµ‹è¯•"><a href="#8-3-23-è‡ªåŠ¨é…ç½®çš„-Data-JDBC-æµ‹è¯•" class="headerlink" title="8.3.23. è‡ªåŠ¨é…ç½®çš„ Data JDBC æµ‹è¯•"></a>8.3.23. è‡ªåŠ¨é…ç½®çš„ Data JDBC æµ‹è¯•</h4><p><code>@DataJdbcTest</code> ä¸ <code>@JdbcTest</code> ç›¸ä¼¼, ä½†é€‚ç”¨äºä½¿ç”¨ Spring Data JDBC å­˜å‚¨åº“çš„æµ‹è¯•. é»˜è®¤æƒ…å†µä¸‹, å®ƒé…ç½®ä¸€ä¸ªå†…å­˜åµŒå…¥å¼æ•°æ®åº“, ä¸€ä¸ª <code>JdbcTemplate</code> å’Œ Spring Data JDBC å­˜å‚¨åº“. ä½¿ç”¨ <code>@DataJdbcTest</code> æ³¨é‡Šæ—¶ä»…æ‰«æ <code>AbstractJdbcConfiguration</code> å­ç±»ï¼Œä¸æ‰«æå¸¸è§„ <code>@Component</code> å’Œ <code>@ConfigurationProperties</code> beanã€‚ <code>@EnableConfigurationProperties</code> å¯ç”¨äºåŒ…å« <code>@ConfigurationProperties</code> çš„ bean</p><p>å¯ä»¥åœ¨ <a href="https://sca.aliyun.com/learn/spring-boot/core/test-auto-configuration.html#appendix.test-auto-configuration">é™„å½•ä¸­</a> æ‰¾åˆ°ç”± <code>@DataJdbcTest</code> å¯ç”¨çš„è‡ªåŠ¨é…ç½®çš„åˆ—è¡¨.</p><p>é»˜è®¤æƒ…å†µä¸‹, Data JDBC æµ‹è¯•æ˜¯äº‹åŠ¡æ€§çš„, å¹¶åœ¨æ¯ä¸ªæµ‹è¯•ç»“æŸæ—¶å›æ»š. æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯, è¯·å‚è§ã€ŠSpring Framework å‚è€ƒæ–‡æ¡£ã€‹ä¸­çš„ <a href="https://sca.aliyun.com/blog/learning/spring/core/testing#testcontext-tx-enabling-transactions">ç›¸å…³éƒ¨åˆ†</a>. å¦‚æœè¿™ä¸æ˜¯æ‚¨æƒ³è¦çš„, åˆ™å¯ä»¥ç¦ç”¨æµ‹è¯•æˆ–æ•´ä¸ªæµ‹è¯•ç±»çš„äº‹åŠ¡ç®¡ç†, <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.testing.spring-boot-applications.autoconfigured-jdbc">å¦‚ JDBC ç¤ºä¾‹æ‰€ç¤º</a>.</p><p>å¦‚æœæ‚¨å¸Œæœ›æµ‹è¯•é’ˆå¯¹çœŸå®æ•°æ®åº“è¿è¡Œ, åˆ™å¯ä»¥ä½¿ç”¨ <code>@AutoConfigureTestDatabase</code> æ³¨è§£, å…¶æ–¹å¼ä¸ <code>DataJpaTest</code> ç›¸åŒ. (è¯·å‚é˜… â€œ<a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.testing.spring-boot-applications.autoconfigured-spring-data-jpa">è‡ªåŠ¨é…ç½®çš„ Data JPA æµ‹è¯•</a>â€. )ã€‚</p><h4 id="8-3-24-è‡ªåŠ¨é…ç½®çš„-jOOQ-Tests"><a href="#8-3-24-è‡ªåŠ¨é…ç½®çš„-jOOQ-Tests" class="headerlink" title="8.3.24. è‡ªåŠ¨é…ç½®çš„ jOOQ Tests"></a>8.3.24. è‡ªåŠ¨é…ç½®çš„ jOOQ Tests</h4><p>æ‚¨å¯ä»¥ä»¥ä¸ <code>@JdbcTest</code> ç±»ä¼¼çš„æ–¹å¼ä½¿ç”¨ <code>@JooqTest</code>, ä½†å¯ä»¥ç”¨äºä¸ jOOQ ç›¸å…³çš„æµ‹è¯•. ç”±äº jOOQ ä¸¥é‡ä¾èµ–ä¸æ•°æ®åº“æ¨¡å¼ç›¸å¯¹åº”çš„åŸºäº Java çš„æ¨¡å¼, å› æ­¤å°†ä½¿ç”¨ç°æœ‰çš„ <code>DataSource</code>. å¦‚æœè¦å°†å…¶æ›¿æ¢ä¸ºå†…å­˜æ•°æ®åº“, åˆ™å¯ä»¥ä½¿ç”¨ <code>@AutoConfigureTestDatabase</code> è¦†ç›–è¿™äº›è®¾ç½®. (æœ‰å…³åœ¨ Spring Boot ä¸­ä½¿ç”¨ jOOQ çš„æ›´å¤šä¿¡æ¯, è¯·å‚é˜… â€œ<a href="https://sca.aliyun.com/learn/spring-boot/core/data.html#data.sql.jooq">data.html</a>â€. ) ä½¿ç”¨ <code>@JooqTest</code> æ³¨è§£æ—¶, ä¸æ‰«æå¸¸è§„ <code>@Component</code> å’Œ <code>@ConfigurationProperties</code> bean.<code>@EnableConfigurationProperties</code> å¯ç”¨äºåŒ…å« <code>@ConfigurationProperties</code> çš„ bean</p><p>å¯ä»¥åœ¨ <a href="https://sca.aliyun.com/learn/spring-boot/core/test-auto-configuration.html#appendix.test-auto-configuration">é™„å½•ä¸­</a> æ‰¾åˆ° <code>@JooqTest</code> å¯ç”¨çš„è‡ªåŠ¨é…ç½®çš„åˆ—è¡¨.</p><p><code>@JooqTest</code> é…ç½® <code>DSLContext</code>. . ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†æ­£åœ¨ä½¿ç”¨çš„ <code>@JooqTest</code> æ³¨è§£:</p><p>Java</p><p>Kotlin</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@JooqTestclass</span> MyJooqTests &#123;<br>    <span class="hljs-variable">@Autowired</span>    private DSLContext dslContext;<br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>JOOQ æµ‹è¯•æ˜¯äº‹åŠ¡æ€§çš„, é»˜è®¤æƒ…å†µä¸‹ä¼šåœ¨æ¯ä¸ªæµ‹è¯•ç»“æŸæ—¶å›æ»š. å¦‚æœè¿™ä¸æ˜¯æ‚¨æƒ³è¦çš„, åˆ™å¯ä»¥ç¦ç”¨æµ‹è¯•æˆ–æ•´ä¸ªæµ‹è¯•ç±»çš„äº‹åŠ¡ç®¡ç†, <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.testing.spring-boot-applications.autoconfigured-jdbc">å¦‚ JDBC ç¤ºä¾‹æ‰€ç¤º</a>.</p><h4 id="8-3-25-è‡ªåŠ¨é…ç½®çš„-Data-MongoDB-æµ‹è¯•"><a href="#8-3-25-è‡ªåŠ¨é…ç½®çš„-Data-MongoDB-æµ‹è¯•" class="headerlink" title="8.3.25. è‡ªåŠ¨é…ç½®çš„ Data MongoDB æµ‹è¯•"></a>8.3.25. è‡ªåŠ¨é…ç½®çš„ Data MongoDB æµ‹è¯•</h4><p>æ‚¨å¯ä»¥ä½¿ç”¨ <code>@DataMongoTest</code> æµ‹è¯• MongoDB åº”ç”¨ç¨‹åº. é»˜è®¤æƒ…å†µä¸‹, å®ƒé…ç½®å†…å­˜åµŒå…¥å¼ MongoDB (å¦‚æœå¯ç”¨) , é…ç½® <code>MongoTemplate</code>, æ‰«æ <code>@Document</code> ç±», å¹¶é…ç½® Spring Data MongoDB å­˜å‚¨åº“. ä½¿ç”¨ <code>@DataMongoTest</code> æ³¨è§£æ—¶, ä¸æ‰«æå¸¸è§„ <code>@Component</code> å’Œ <code>@ConfigurationProperties</code> bean.<code>@EnableConfigurationProperties</code> å¯ç”¨äºåŒ…å« <code>@ConfigurationProperties</code> çš„ bean (æœ‰å…³å°† MongoDB ä¸ Spring Boot ç»“åˆä½¿ç”¨çš„æ›´å¤šä¿¡æ¯, è¯·å‚é˜… â€œ<a href="https://sca.aliyun.com/learn/spring-boot/core/data.html#data.nosql.mongodb">data.html</a>â€)</p><p>å¯ä»¥åœ¨ <a href="https://sca.aliyun.com/learn/spring-boot/core/test-auto-configuration.html#appendix.test-auto-configuration">é™„å½•ä¸­</a> æ‰¾åˆ°ç”± <code>@DataMongoTest</code> å¯ç”¨çš„è‡ªåŠ¨é…ç½®è®¾ç½®çš„åˆ—è¡¨.</p><p>æ­¤ç±»æ˜¾ç¤ºæ­£åœ¨ä½¿ç”¨çš„ <code>@DataMongoTest</code> æ³¨è§£:</p><p>Java</p><p>Kotlin</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@DataMongoTestclass</span> MyDataMongoDbTests &#123;<br>    <span class="hljs-variable">@Autowired</span>    private MongoTemplate mongoTemplate;<br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="8-3-26-Auto-configured-Data-Neo4j-Tests"><a href="#8-3-26-Auto-configured-Data-Neo4j-Tests" class="headerlink" title="8.3.26. Auto-configured Data Neo4j Tests"></a>8.3.26. Auto-configured Data Neo4j Tests</h4><p>æ‚¨å¯ä»¥ä½¿ç”¨ <code>@DataNeo4jTest</code> æ¥æµ‹è¯• Neo4j åº”ç”¨ç¨‹åº. é»˜è®¤æƒ…å†µä¸‹, ä»–ä¼šæ‰«æ <code>@Node</code> ç±», å¹¶é…ç½® Spring Data Neo4j å­˜å‚¨åº“. ä½¿ç”¨ <code>@DataNeo4jTest</code> æ³¨è§£æ—¶, ä¸æ‰«æå¸¸è§„ <code>@Component</code> å’Œ <code>@ConfigurationProperties</code> bean.<code>@EnableConfigurationProperties</code> å¯ç”¨äºåŒ…å« <code>@ConfigurationProperties</code> çš„ bean. (æœ‰å…³å°† Neo4J ä¸ Spring Boot ç»“åˆä½¿ç”¨çš„æ›´å¤šä¿¡æ¯, è¯·å‚é˜… â€œ<a href="https://sca.aliyun.com/learn/spring-boot/core/data.html#data.nosql.neo4j">data.html</a>â€. )</p><p>å¯ä»¥åœ¨ <a href="https://sca.aliyun.com/learn/spring-boot/core/test-auto-configuration.html#appendix.test-auto-configuration">é™„å½•ä¸­</a> æ‰¾åˆ°ç”± <code>@DataNeo4jTest</code> å¯ç”¨çš„è‡ªåŠ¨é…ç½®è®¾ç½®çš„åˆ—è¡¨.</p><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†åœ¨ Spring Boot ä¸­ä½¿ç”¨ Neo4J æµ‹è¯•çš„å…¸å‹è®¾ç½®:</p><p>Java</p><p>Kotlin</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@DataNeo4jTestclass</span> MyDataNeo4jTests &#123;<br>    <span class="hljs-variable">@Autowired</span>    private SomeRepository repository;<br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>é»˜è®¤æƒ…å†µä¸‹, Data Neo4j æµ‹è¯•æ˜¯äº‹åŠ¡æ€§çš„, å¹¶åœ¨æ¯æ¬¡æµ‹è¯•ç»“æŸæ—¶å›æ»š. æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯, è¯·å‚è§ã€ŠSpring Framework å‚è€ƒæ–‡æ¡£ã€‹ä¸­çš„ <a href="https://sca.aliyun.com/blog/learning/spring/core/testing#testcontext-tx-enabling-transactions">ç›¸å…³éƒ¨åˆ†</a> . å¦‚æœè¿™ä¸æ˜¯æ‚¨æƒ³è¦çš„, åˆ™å¯ä»¥ä¸ºæµ‹è¯•æˆ–æ•´ä¸ªç±»ç¦ç”¨äº‹åŠ¡ç®¡ç†, å¦‚ä¸‹æ‰€ç¤º:</p><p>Java</p><p>Kotlin</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@DataNeo4jTest</span><span class="hljs-variable">@Transactional</span>(propagation = Propagation.<span class="hljs-keyword">NOT</span>_SUPPORTED)class MyDataNeo4jTests &#123;<br>&#125;<br></code></pre></td></tr></table></figure><p>å“åº”å¼è®¿é—®ä¸æ”¯æŒäº‹åŠ¡æ€§æµ‹è¯•ã€‚å¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨è¿™ç§æ ·å¼ï¼Œæ‚¨å¿…é¡»å¦‚ä¸Šæ‰€è¿°é…ç½® <code>@DataNeo4jTest</code> æµ‹è¯•.</p><h4 id="8-3-27-è‡ªåŠ¨é…ç½®çš„-Data-Redis-æµ‹è¯•"><a href="#8-3-27-è‡ªåŠ¨é…ç½®çš„-Data-Redis-æµ‹è¯•" class="headerlink" title="8.3.27. è‡ªåŠ¨é…ç½®çš„ Data Redis æµ‹è¯•"></a>8.3.27. è‡ªåŠ¨é…ç½®çš„ Data Redis æµ‹è¯•</h4><p>æ‚¨å¯ä»¥ä½¿ç”¨ <code>@DataRedisTest</code> æµ‹è¯• Redis åº”ç”¨ç¨‹åº. é»˜è®¤æƒ…å†µä¸‹, å®ƒä¼šæ‰«æ <code>@RedisHash</code> ç±»å¹¶é…ç½® Spring Data Redis å­˜å‚¨åº“. ä½¿ç”¨ <code>@DataRedisTest</code> æ³¨è§£æ—¶, ä¸æ‰«æå¸¸è§„ <code>@Component</code> å’Œ <code>@ConfigurationProperties</code> bean.<code>@EnableConfigurationProperties</code> å¯ç”¨äºåŒ…å« <code>@ConfigurationProperties</code> çš„ bean. (æœ‰å…³å°† Redis ä¸ Spring Boot ç»“åˆä½¿ç”¨çš„æ›´å¤šä¿¡æ¯, è¯·å‚é˜… â€œ<a href="https://sca.aliyun.com/learn/spring-boot/core/data.html#data.nosql.redis">data.html</a>â€. )</p><p>å¯ä»¥åœ¨ <a href="https://sca.aliyun.com/learn/spring-boot/core/test-auto-configuration.html#appendix.test-auto-configuration">é™„å½•ä¸­</a> æ‰¾åˆ°ç”± <code>@DataRedisTest</code> å¯ç”¨çš„è‡ªåŠ¨é…ç½®è®¾ç½®çš„åˆ—è¡¨.</p><p>ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†ä½¿ç”¨ä¸­çš„ <code>@DataRedisTest</code> æ³¨è§£:</p><p>Java</p><p>Kotlin</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@DataRedisTestclass</span> MyDataRedisTests &#123;<br>    <span class="hljs-variable">@Autowired</span>    private SomeRepository repository;<br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="8-3-28-è‡ªåŠ¨é…ç½®çš„-Data-LDAP-æµ‹è¯•"><a href="#8-3-28-è‡ªåŠ¨é…ç½®çš„-Data-LDAP-æµ‹è¯•" class="headerlink" title="8.3.28. è‡ªåŠ¨é…ç½®çš„ Data LDAP æµ‹è¯•"></a>8.3.28. è‡ªåŠ¨é…ç½®çš„ Data LDAP æµ‹è¯•</h4><p>æ‚¨å¯ä»¥ä½¿ç”¨ <code>@DataLdapTest</code> æ¥æµ‹è¯• LDAP åº”ç”¨ç¨‹åº. é»˜è®¤æƒ…å†µä¸‹, å®ƒé…ç½®å†…å­˜åµŒå…¥å¼ LDAP (å¦‚æœå¯ç”¨) , é…ç½® <code>LdapTemplate</code>, æ‰«æ <code>@Entry</code> ç±», å¹¶é…ç½® Spring Data LDAP å­˜å‚¨åº“. ä½¿ç”¨ <code>@DataLdapTest</code> æ³¨è§£æ—¶, ä¸æ‰«æå¸¸è§„ <code>@Component</code> å’Œ <code>@ConfigurationProperties</code> bean.<code>@EnableConfigurationProperties</code> å¯ç”¨äºåŒ…å« <code>@ConfigurationProperties</code> çš„ bean. (æœ‰å…³å°† LDAP ä¸ Spring Boot ç»“åˆä½¿ç”¨çš„æ›´å¤šä¿¡æ¯, è¯·å‚é˜… â€œ<a href="https://sca.aliyun.com/learn/spring-boot/core/data.html#data.nosql.ldap">data.html</a>â€. )</p><p>å¯ä»¥åœ¨ <a href="https://sca.aliyun.com/learn/spring-boot/core/test-auto-configuration.html#appendix.test-auto-configuration">é™„å½•ä¸­</a> æ‰¾åˆ°ç”± <code>@DataLdapTest</code> å¯ç”¨çš„è‡ªåŠ¨é…ç½®è®¾ç½®çš„åˆ—è¡¨.</p><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†æ­£åœ¨ä½¿ç”¨çš„ <code>@DataLdapTest</code> æ³¨è§£:</p><p>Java</p><p>Kotlin</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@DataLdapTestclass</span> MyDataLdapTests &#123;<br>    <span class="hljs-variable">@Autowired</span>    private LdapTemplate ldapTemplate;<br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å†…å­˜åµŒå…¥å¼ LDAP é€šå¸¸éå¸¸é€‚åˆæµ‹è¯•, å› ä¸ºå®ƒé€Ÿåº¦å¿«å¹¶ä¸”ä¸éœ€è¦å®‰è£…ä»»ä½•å¼€å‘äººå‘˜. ä½†æ˜¯, å¦‚æœæ‚¨å¸Œæœ›é’ˆå¯¹çœŸå®çš„ LDAP æœåŠ¡å™¨è¿è¡Œæµ‹è¯•, åˆ™åº”æ’é™¤åµŒå…¥å¼ LDAP è‡ªåŠ¨é…ç½®, å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><p>Java</p><p>Kotlin</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-variable">@DataLdapTest</span>(excludeAutoConfiguration = <span class="hljs-title class_">EmbeddedLdapAutoConfiguration</span>.<span class="hljs-keyword">class</span>)<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataLdapTests</span> &#123;<br>    <span class="hljs-regexp">//</span> ...<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="8-3-29-è‡ªåŠ¨é…ç½®-REST-Clients"><a href="#8-3-29-è‡ªåŠ¨é…ç½®-REST-Clients" class="headerlink" title="8.3.29. è‡ªåŠ¨é…ç½® REST Clients"></a>8.3.29. è‡ªåŠ¨é…ç½® REST Clients</h4><p>æ‚¨å¯ä»¥ä½¿ç”¨ <code>@RestClientTest</code> æ³¨è§£æ¥æµ‹è¯• REST å®¢æˆ·ç«¯. é»˜è®¤æƒ…å†µä¸‹, å®ƒä¼šè‡ªåŠ¨é…ç½® Jackson, GSON å’Œ Jsonb æ”¯æŒ, é…ç½® <code>RestTemplateBuilder</code>, å¹¶æ·»åŠ å¯¹ <code>MockRestServiceServer</code> çš„æ”¯æŒ. ä½¿ç”¨ <code>@RestClientTest</code> æ³¨è§£æ—¶, ä¸æ‰«æå¸¸è§„ <code>@Component</code> å’Œ <code>@ConfigurationProperties</code> bean.<code>@EnableConfigurationProperties</code> å¯ç”¨äºåŒ…å« <code>@ConfigurationProperties</code> çš„ bean.</p><p>å¯ä»¥åœ¨ <a href="https://sca.aliyun.com/learn/spring-boot/core/test-auto-configuration.html#appendix.test-auto-configuration">é™„å½•ä¸­</a> æ‰¾åˆ°ç”± <code>@RestClientTest</code> å¯ç”¨çš„è‡ªåŠ¨é…ç½®è®¾ç½®çš„åˆ—è¡¨.</p><p>åº”è¯¥ä½¿ç”¨ <code>@RestClientTest</code> çš„ <code>value</code> æˆ– <code>components</code> å±æ€§æ¥æŒ‡å®šè¦æµ‹è¯•çš„ç‰¹å®š bean, å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><p>Java</p><p>Kotlin</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@RestClientTest(RemoteVehicleDetailsService.class)</span><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyRestClientTests</span> &#123;<br>    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">private</span> RemoteVehicleDetailsService service;<br>    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">private</span> MockRestServiceServer server;<br>    <span class="hljs-meta">@Test</span>    void getVehicleDetailsWhenResultIsSuccessShouldReturnDetails() &#123;        <span class="hljs-keyword">this</span>.server.<span class="hljs-keyword">expect</span>(requestTo(<span class="hljs-string">&quot;/greet/details&quot;</span>)).andRespond(withSuccess(<span class="hljs-string">&quot;hello&quot;</span>, MediaType.TEXT_PLAIN));        String greeting = <span class="hljs-keyword">this</span>.service.callRestService();        assertThat(greeting).isEqualTo(<span class="hljs-string">&quot;hello&quot;</span>);    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="8-3-30-è‡ªåŠ¨é…ç½®çš„-Spring-REST-Docs-æµ‹è¯•"><a href="#8-3-30-è‡ªåŠ¨é…ç½®çš„-Spring-REST-Docs-æµ‹è¯•" class="headerlink" title="8.3.30. è‡ªåŠ¨é…ç½®çš„ Spring REST Docs æµ‹è¯•"></a>8.3.30. è‡ªåŠ¨é…ç½®çš„ Spring REST Docs æµ‹è¯•</h4><p>æ‚¨å¯ä»¥ä½¿ç”¨ <code>@AutoConfigureRestDocs</code> æ³¨è§£åœ¨ Mock MVC, REST Assured æˆ– <code>WebTestClient</code> çš„æµ‹è¯•ä¸­ä½¿ç”¨ <a href="https://spring.io/projects/spring-restdocs">Spring REST Docs</a>. å®ƒæ¶ˆé™¤äº† Spring REST Docs ä¸­å¯¹ JUnit æ‰©å±•çš„éœ€æ±‚.</p><p><code>@AutoConfigureRestDocs</code> å¯ç”¨äºè¦†ç›–é»˜è®¤è¾“å‡ºç›®å½• (å¦‚æœä½¿ç”¨ Maven, åˆ™ä¸º <code>target/generated-snippets</code> å¦‚æœä½¿ç”¨ Gradle, åˆ™ä¸º <code>build/generated-snippets</code> ) . å®ƒä¹Ÿå¯ä»¥ç”¨äºé…ç½®å‡ºç°åœ¨ä»»ä½•è®°å½•çš„ URI ä¸­çš„ host, scheme, å’Œ port.</p><h5 id="ä½¿ç”¨-Mock-MVC-è‡ªåŠ¨é…ç½®çš„-Spring-REST-Docs-æµ‹è¯•"><a href="#ä½¿ç”¨-Mock-MVC-è‡ªåŠ¨é…ç½®çš„-Spring-REST-Docs-æµ‹è¯•" class="headerlink" title="ä½¿ç”¨ Mock MVC è‡ªåŠ¨é…ç½®çš„ Spring REST Docs æµ‹è¯•"></a>ä½¿ç”¨ Mock MVC è‡ªåŠ¨é…ç½®çš„ Spring REST Docs æµ‹è¯•</h5><p><code>@AutoConfigureRestDocs</code> è‡ªå®šä¹‰ <code>MockMvc</code> bean ä»¥ä½¿ç”¨ Spring REST Docs. æ‚¨å¯ä»¥ä½¿ç”¨ <code>@Autowired</code> æ³¨å…¥å®ƒ, å¹¶åƒé€šå¸¸ä½¿ç”¨ Mock MVC å’Œ Spring REST Docs ä¸€æ ·, åœ¨æµ‹è¯•ä¸­ä½¿ç”¨å®ƒ, å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><p>Java</p><p>Kotlin</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@WebMvcTest</span>(UserController.class)<span class="hljs-variable">@AutoConfigureRestDocsclass</span> MyUserDocumentationTests &#123;<br>    <span class="hljs-variable">@Autowired</span>    private MockMvc mvc;<br>    <span class="hljs-variable">@Test</span>    void <span class="hljs-built_in">listUsers</span>() throws Exception &#123;        <span class="hljs-selector-tag">this</span><span class="hljs-selector-class">.mvc</span><span class="hljs-selector-class">.perform</span>(<span class="hljs-built_in">get</span>(<span class="hljs-string">&quot;/users&quot;</span>).<span class="hljs-built_in">accept</span>(MediaType.TEXT_PLAIN))            <span class="hljs-selector-class">.andExpect</span>(<span class="hljs-built_in">status</span>().<span class="hljs-built_in">isOk</span>())            <span class="hljs-selector-class">.andDo</span>(<span class="hljs-built_in">document</span>(<span class="hljs-string">&quot;list-users&quot;</span>));    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœéœ€è¦å¯¹ Spring REST Docs é…ç½®è¿›è¡Œæ›´å¤šæ§åˆ¶, è€Œä¸æ˜¯ <code>@AutoConfigureRestDocs</code> å±æ€§æä¾›çš„æ§åˆ¶, åˆ™å¯ä»¥ä½¿ç”¨ <code>RestDocsMockMvcConfigurationCustomizer</code> bean, å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><p>Java</p><p>Kotlin</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@TestConfiguration</span>(proxyBeanMethods = <span class="hljs-literal">false</span>)<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyRestDocsConfiguration</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">RestDocsMockMvcConfigurationCustomizer</span> &#123;<br>    <span class="hljs-meta">@Override</span>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">customize</span>(<span class="hljs-params">MockMvcRestDocumentationConfigurer configurer</span>) &#123;        configurer.<span class="hljs-title function_">snippets</span>().<span class="hljs-title function_">withTemplateFormat</span>(<span class="hljs-title class_">TemplateFormats</span>.<span class="hljs-title function_">markdown</span>());    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœè¦ä½¿ç”¨ Spring REST Docs å¯¹å‚æ•°åŒ–è¾“å‡ºç›®å½•çš„æ”¯æŒ, å¯ä»¥åˆ›å»º <code>RestDocumentationResultHandler</code> bean. è‡ªåŠ¨é…ç½®ä½¿ç”¨æ­¤ç»“æœå¤„ç†ç¨‹åºè°ƒç”¨ <code>alwaysDo</code>, ä»è€Œä½¿æ¯ä¸ª <code>MockMvc</code> è°ƒç”¨è‡ªåŠ¨ç”Ÿæˆé»˜è®¤ç‰‡æ®µ. ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å®šä¹‰çš„ <code>RestDocumentationResultHandler</code>:</p><p>Java</p><p>Kotlin</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-meta">@TestConfiguration</span>(proxyBeanMethods = <span class="hljs-keyword">false</span>)<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyResultHandlerConfiguration</span> </span>&#123;<br>    <span class="hljs-meta">@Bean</span>    <span class="hljs-keyword">public</span> <span class="hljs-function">RestDocumentationResultHandler <span class="hljs-title">restDocumentation</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-function"><span class="hljs-keyword">return</span> MockMvcRestDocumentation.<span class="hljs-title">document</span><span class="hljs-params">(<span class="hljs-string">&quot;&#123;method-name&#125;&quot;</span>)</span></span>;    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="ä½¿ç”¨-WebTestClient-è‡ªåŠ¨é…ç½®çš„-Spring-REST-Docs-æµ‹è¯•"><a href="#ä½¿ç”¨-WebTestClient-è‡ªåŠ¨é…ç½®çš„-Spring-REST-Docs-æµ‹è¯•" class="headerlink" title="ä½¿ç”¨ WebTestClient è‡ªåŠ¨é…ç½®çš„ Spring REST Docs æµ‹è¯•"></a>ä½¿ç”¨ WebTestClient è‡ªåŠ¨é…ç½®çš„ Spring REST Docs æµ‹è¯•</h5><p><code>@AutoConfigureRestDocs</code> ä¹Ÿå¯ä»¥ä¸ <code>WebTestClient</code> ä¸€èµ·ä½¿ç”¨. æ‚¨å¯ä»¥ä½¿ç”¨ <code>@Autowired</code> æ³¨å…¥å®ƒ, å¹¶åƒé€šå¸¸ä½¿ç”¨ <code>@WebFluxTest</code> å’Œ Spring REST Docs ä¸€æ ·åœ¨æµ‹è¯•ä¸­ä½¿ç”¨å®ƒ, å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><p>Java</p><p>Kotlin</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@WebFluxTest</span><span class="hljs-variable">@AutoConfigureRestDocsclass</span> MyUsersDocumentationTests &#123;<br>    <span class="hljs-variable">@Autowired</span>    private WebTestClient webTestClient;<br>    <span class="hljs-variable">@Test</span>    void <span class="hljs-built_in">listUsers</span>() &#123;        <span class="hljs-selector-tag">this</span><span class="hljs-selector-class">.webTestClient</span>            <span class="hljs-selector-class">.get</span>()<span class="hljs-selector-class">.uri</span>(<span class="hljs-string">&quot;/&quot;</span>)        <span class="hljs-selector-class">.exchange</span>()        <span class="hljs-selector-class">.expectStatus</span>()            <span class="hljs-selector-class">.isOk</span>()        <span class="hljs-selector-class">.expectBody</span>()            <span class="hljs-selector-class">.consumeWith</span>(<span class="hljs-built_in">document</span>(<span class="hljs-string">&quot;list-users&quot;</span>));    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœéœ€è¦å¯¹ Spring REST Docs é…ç½®è¿›è¡Œæ›´å¤šæ§åˆ¶, è€Œä¸æ˜¯ <code>@AutoConfigureRestDocs</code> å±æ€§æä¾›çš„æ§åˆ¶, åˆ™å¯ä»¥ä½¿ç”¨ <code>RestDocsWebTestClientConfigurationCustomizer</code> bean, å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><p>Java</p><p>Kotlin</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@TestConfiguration</span>(proxyBeanMethods = <span class="hljs-literal">false</span>)<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyRestDocsConfiguration</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">RestDocsWebTestClientConfigurationCustomizer</span> &#123;<br>    <span class="hljs-meta">@Override</span>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">customize</span>(<span class="hljs-params">WebTestClientRestDocumentationConfigurer configurer</span>) &#123;        configurer.<span class="hljs-title function_">snippets</span>().<span class="hljs-title function_">withEncoding</span>(<span class="hljs-string">&quot;UTF-8&quot;</span>);    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœæ‚¨æƒ³åˆ©ç”¨ Spring REST Docs å¯¹å‚æ•°åŒ–è¾“å‡ºç›®å½•çš„æ”¯æŒï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <code>WebTestClientBuilderCustomizer</code> ä¸ºæ¯ä¸ªå®ä½“ exchange ç»“æœé…ç½®æ¶ˆè´¹è€…ã€‚ ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†ä¸€ä¸ªè¢«å®šä¹‰çš„ <code>WebTestClientBuilderCustomizer</code>:</p><p>Java</p><p>Kotlin</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs livescript">@TestConfiguration(proxyBeanMethods = <span class="hljs-literal">false</span>)public <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyWebTestClientBuilderCustomizerConfiguration</span> &#123;<br>    @Bean    public WebTestClientBuilderCustomizer restDocumentation<span class="hljs-function"><span class="hljs-params">()</span> &#123;        <span class="hljs-title">return</span> <span class="hljs-params">(builder)</span> -&gt;</span> builder.entityExchangeResultConsumer(document(<span class="hljs-string">&quot;&#123;method-name&#125;&quot;</span>));    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="ä½¿ç”¨-RES-TAssured-è‡ªåŠ¨é…ç½®çš„-Spring-REST-Docs-æµ‹è¯•"><a href="#ä½¿ç”¨-RES-TAssured-è‡ªåŠ¨é…ç½®çš„-Spring-REST-Docs-æµ‹è¯•" class="headerlink" title="ä½¿ç”¨ RES TAssured è‡ªåŠ¨é…ç½®çš„ Spring REST Docs æµ‹è¯•"></a>ä½¿ç”¨ RES TAssured è‡ªåŠ¨é…ç½®çš„ Spring REST Docs æµ‹è¯•</h5><p><code>@AutoConfigureRestDocs</code> ä½¿ä¸€ä¸ª <code>RequestSpecification</code> Bean (å¯é¢„é…ç½®ä¸ºä½¿ç”¨ Spring REST Docs) å¯ç”¨äºæ‚¨çš„æµ‹è¯•. æ‚¨å¯ä»¥ä½¿ç”¨ <code>@Autowired</code> æ³¨å…¥å®ƒ, å¹¶åƒåœ¨ä½¿ç”¨ REST Assured å’Œ Spring REST Docs æ—¶ä¸€æ ·, åœ¨æµ‹è¯•ä¸­ä½¿ç”¨å®ƒ, å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><p>Java</p><p>Kotlin</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@SpringBootTest</span>(webEnvironment = WebEnvironment.RANDOM_PORT)<span class="hljs-variable">@AutoConfigureRestDocsclass</span> MyUserDocumentationTests &#123;<br>    <span class="hljs-variable">@Test</span>    void <span class="hljs-built_in">listUsers</span>(<span class="hljs-variable">@Autowired</span> RequestSpecification documentationSpec, <span class="hljs-variable">@LocalServerPort</span> int port) &#123;        <span class="hljs-selector-tag">given</span>(documentationSpec)            <span class="hljs-selector-class">.filter</span>(<span class="hljs-built_in">document</span>(<span class="hljs-string">&quot;list-users&quot;</span>))        <span class="hljs-selector-class">.when</span>()            <span class="hljs-selector-class">.port</span>(port)            <span class="hljs-selector-class">.get</span>(<span class="hljs-string">&quot;/&quot;</span>)        <span class="hljs-selector-class">.then</span>()<span class="hljs-selector-class">.assertThat</span>()            <span class="hljs-selector-class">.statusCode</span>(<span class="hljs-built_in">is</span>(<span class="hljs-number">200</span>));    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœæ‚¨éœ€è¦å¯¹ Spring REST Docs é…ç½®è¿›è¡Œæ›´å¤šæ§åˆ¶, è€Œä¸æ˜¯ <code>@AutoConfigureRestDocs</code> å±æ€§æ‰€æä¾›çš„æ§åˆ¶, åˆ™å¯ä»¥ä½¿ç”¨ <code>RestDocsRestAssuredConfigurationCustomizer</code> bean, å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><p>Java</p><p>Kotlin</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@TestConfiguration</span>(proxyBeanMethods = <span class="hljs-literal">false</span>)<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyRestDocsConfiguration</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">RestDocsRestAssuredConfigurationCustomizer</span> &#123;<br>    <span class="hljs-meta">@Override</span>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">customize</span>(<span class="hljs-params">RestAssuredRestDocumentationConfigurer configurer</span>) &#123;        configurer.<span class="hljs-title function_">snippets</span>().<span class="hljs-title function_">withTemplateFormat</span>(<span class="hljs-title class_">TemplateFormats</span>.<span class="hljs-title function_">markdown</span>());    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="8-3-31-Auto-configured-Spring-Web-Services-Tests"><a href="#8-3-31-Auto-configured-Spring-Web-Services-Tests" class="headerlink" title="8.3.31. Auto-configured Spring Web Services Tests"></a>8.3.31. Auto-configured Spring Web Services Tests</h4><h5 id="è‡ªåŠ¨é…ç½®çš„-Spring-Web-Services-Client-æµ‹è¯•"><a href="#è‡ªåŠ¨é…ç½®çš„-Spring-Web-Services-Client-æµ‹è¯•" class="headerlink" title="è‡ªåŠ¨é…ç½®çš„ Spring Web Services Client æµ‹è¯•"></a>è‡ªåŠ¨é…ç½®çš„ Spring Web Services Client æµ‹è¯•</h5><p>æ‚¨å¯ä»¥ä½¿ç”¨ <code>@WebServiceClientTest</code> æ¥é€šè¿‡ Spring Web Services é¡¹ç›®æµ‹è¯•ä½¿ç”¨å‘¼å« Web æœåŠ¡çš„åº”ç”¨ç¨‹åº. é»˜è®¤æƒ…å†µä¸‹, å®ƒé…ç½®æ¨¡æ‹Ÿ <code>WebServiceServer</code> bean å¹¶è‡ªåŠ¨è‡ªå®šä¹‰ <code>WebServiceTemplateBuilder</code>. (æœ‰å…³åœ¨ Spring Boot ä¸­ç»“åˆä½¿ç”¨ Web æœåŠ¡çš„æ›´å¤šä¿¡æ¯, è¯·å‚é˜… â€œ<a href="https://sca.aliyun.com/learn/spring-boot/core/io.html#io.webservices">io.html</a>â€.)</p><p>å¯ä»¥åœ¨ <a href="https://sca.aliyun.com/learn/spring-boot/core/test-auto-configuration.html#appendix.test-auto-configuration">é™„å½•ä¸­</a> æ‰¾åˆ°ç”± <code>@WebServiceClientTest</code> å¯ç”¨çš„è‡ªåŠ¨é…ç½®è®¾ç½®çš„åˆ—è¡¨.</p><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†æ­£åœ¨ä½¿ç”¨çš„ <code>@WebServiceClientTest</code> æ³¨è§£:</p><p>Java</p><p>Kotlin</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@WebServiceClientTest(<span class="hljs-params">SomeWebService.<span class="hljs-keyword">class</span></span>)class MyWebServiceClientTests &#123;</span><br><span class="hljs-meta">    @Autowired    private MockWebServiceServer server;</span><br><span class="hljs-meta">    @Autowired    private SomeWebService someWebService;</span><br><span class="hljs-meta">    @Test    void mockServerCall() &#123;        this.server            .expect(<span class="hljs-params">payload(<span class="hljs-params">new StringSource(<span class="hljs-params"><span class="hljs-string">&quot;&lt;request/&gt;&quot;</span></span>)</span>)</span>)            .andRespond(<span class="hljs-params">withPayload(<span class="hljs-params">new StringSource(<span class="hljs-params"><span class="hljs-string">&quot;&lt;response&gt;&lt;status&gt;200&lt;/status&gt;&lt;/response&gt;&quot;</span></span>)</span>)</span>);        assertThat(<span class="hljs-params">this.someWebService.test(<span class="hljs-params"></span>)</span>)            .extracting(<span class="hljs-params">Response::getStatus</span>)            .isEqualTo(<span class="hljs-params"><span class="hljs-number">200</span></span>);    &#125;</span><br>&#125;<br></code></pre></td></tr></table></figure><h5 id="è‡ªåŠ¨é…ç½®çš„-Spring-Web-Services-Server-æµ‹è¯•"><a href="#è‡ªåŠ¨é…ç½®çš„-Spring-Web-Services-Server-æµ‹è¯•" class="headerlink" title="è‡ªåŠ¨é…ç½®çš„ Spring Web Services Server æµ‹è¯•"></a>è‡ªåŠ¨é…ç½®çš„ Spring Web Services Server æµ‹è¯•</h5><p>æ‚¨å¯ä»¥ä½¿ç”¨ <code>@WebServiceServerTest</code> æ¥æµ‹è¯•ä½¿ç”¨ Spring Web Services é¡¹ç›®å®ç° Web æœåŠ¡çš„åº”ç”¨ç¨‹åºã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒé…ç½®äº†ä¸€ä¸ª <code>MockWebServiceClient</code> beanï¼Œå¯ç”¨äºè°ƒç”¨æ‚¨çš„ Web æœåŠ¡ç«¯ç‚¹ã€‚ ï¼ˆæœ‰å…³åœ¨ Spring Boot ä¸­ä½¿ç”¨ Web æœåŠ¡çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… â€œ<a href="https://sca.aliyun.com/learn/spring-boot/core/io.html#io.webservices">io.html</a>â€ã€‚ï¼‰</p><p>å¯ä»¥åœ¨ <a href="https://sca.aliyun.com/learn/spring-boot/core/test-auto-configuration.html#appendix.test-auto-configuration">é™„å½•ä¸­</a> æ‰¾åˆ°ç”± <code>@WebServiceServerTest</code> å¯ç”¨çš„è‡ªåŠ¨é…ç½®è®¾ç½®çš„åˆ—è¡¨.</p><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†æ­£åœ¨ä½¿ç”¨çš„ <code>@WebServiceServerTest</code> æ³¨è§£:</p><p>Java</p><p>Kotlin</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@WebServiceServerTest(ExampleEndpoint.class)</span><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyWebServiceServerTests</span> &#123;<br>    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">private</span> MockWebServiceClient client;<br>    <span class="hljs-meta">@Test</span>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">mockServerCall</span><span class="hljs-params">()</span> &#123;        <span class="hljs-built_in">this</span>.client            .sendRequest(RequestCreators.withPayload(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringSource</span>(<span class="hljs-string">&quot;&lt;ExampleRequest/&gt;&quot;</span>)))            .andExpect(ResponseMatchers.payload(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringSource</span>(<span class="hljs-string">&quot;&lt;ExampleResponse&gt;42&lt;/ExampleResponse&gt;&quot;</span>)));    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="8-3-32-å…¶ä»–çš„è‡ªåŠ¨é…ç½®å’Œåˆ‡ç‰‡"><a href="#8-3-32-å…¶ä»–çš„è‡ªåŠ¨é…ç½®å’Œåˆ‡ç‰‡" class="headerlink" title="8.3.32. å…¶ä»–çš„è‡ªåŠ¨é…ç½®å’Œåˆ‡ç‰‡"></a>8.3.32. å…¶ä»–çš„è‡ªåŠ¨é…ç½®å’Œåˆ‡ç‰‡</h4><p>æ¯ä¸ªåˆ‡ç‰‡æä¾›ä¸€ä¸ªæˆ–å¤šä¸ª <code>@AutoConfigureâ€¦</code> æ³¨è§£, å³å®šä¹‰åº”åŒ…å«åœ¨åˆ‡ç‰‡ä¸­çš„è‡ªåŠ¨é…ç½®. å¯ä»¥é€šè¿‡åˆ›å»ºè‡ªå®šä¹‰ <code>@AutoConfigureâ€¦</code> æ³¨è§£æ¥æ·»åŠ å…¶ä»–è‡ªåŠ¨é…ç½®, ä¹Ÿå¯ä»¥ç®€å•åœ°é€šè¿‡å°† <code>@ImportAutoConfiguration</code> æ·»åŠ åˆ°æµ‹è¯•ä¸­æ¥æ·»åŠ å…¶ä»–è‡ªåŠ¨é…ç½®, å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><p>Java</p><p>Kotlin</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@JdbcTest</span><span class="hljs-variable">@ImportAutoConfiguration</span>(IntegrationAutoConfiguration.class)class MyJdbcTests &#123;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç¡®ä¿ä¸è¦ä½¿ç”¨å¸¸è§„çš„ <code>@Import</code> æ³¨è§£å¯¼å…¥è‡ªåŠ¨é…ç½®, å› ä¸ºå®ƒä»¬æ˜¯ç”± Spring Boot ä»¥ç‰¹å®šæ–¹å¼å¤„ç†çš„.</p><p>æˆ–è€…, å¯ä»¥é€šè¿‡åœ¨ <code>META-INF/spring.factories</code> ä¸­æ³¨å†Œåˆ‡ç‰‡æ³¨è§£çš„ä»»ä½•ä½¿ç”¨æ¥æ·»åŠ å…¶ä»–è‡ªåŠ¨é…ç½®, å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><p>META-INF&#x2F;spring&#x2F;org.springframework.boot.test.autoconfigure.jdbc.JdbcTest.imports</p><p>com.example.IntegrationAutoConfiguration</p><p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œåœ¨æ¯ä¸ªç”¨ <code>@JdbcTest</code> æ³¨è§£çš„æµ‹è¯•ä¸Šå¯ç”¨äº† <code>com.example.IntegrationAutoConfiguration</code>ã€‚</p><p>æ‚¨å¯ä»¥åœ¨æ­¤æ–‡ä»¶ä¸­é€šè¿‡ <code>#</code> ä½¿ç”¨æ³¨é‡Šã€‚</p><p>åˆ‡ç‰‡æˆ– <code>@AutoConfigureâ€¦</code> æ³¨è§£å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼è‡ªå®šä¹‰, åªè¦ä½¿ç”¨ <code>@ImportAutoConfiguration</code> å¯¹å…¶è¿›è¡Œå…ƒæ³¨è§£å³å¯.</p><h4 id="8-3-33-ç”¨æˆ·é…ç½®å’Œåˆ‡ç‰‡"><a href="#8-3-33-ç”¨æˆ·é…ç½®å’Œåˆ‡ç‰‡" class="headerlink" title="8.3.33. ç”¨æˆ·é…ç½®å’Œåˆ‡ç‰‡"></a>8.3.33. ç”¨æˆ·é…ç½®å’Œåˆ‡ç‰‡</h4><p>å¦‚æœæ‚¨ä»¥åˆç†çš„æ–¹å¼ <a href="https://sca.aliyun.com/learn/spring-boot/core/using.html#using.structuring-your-code">ç»„ç»‡ä»£ç </a> , åˆ™ <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.testing.spring-boot-applications.detecting-configuration">é»˜è®¤æƒ…å†µä¸‹</a> å°† <code>@SpringBootApplication</code> ç±»ç”¨ä½œæµ‹è¯•çš„é…ç½®.</p><p>å› æ­¤, å˜å¾—é‡è¦çš„æ˜¯, ä¸è¦ä½¿ç”¨ç‰¹å®šäºå…¶åŠŸèƒ½ç‰¹å®šåŒºåŸŸçš„é…ç½®è®¾ç½®æ¥ä¹±æ‰”åº”ç”¨ç¨‹åºçš„ä¸»ç±».</p><p>å‡è®¾æ‚¨æ­£åœ¨ä½¿ç”¨ Spring Batch, å¹¶ä¸”ä¾èµ–äºå®ƒçš„è‡ªåŠ¨é…ç½®. æ‚¨å¯ä»¥å¦‚ä¸‹å®šä¹‰ <code>@SpringBootApplication</code>:</p><p>Java</p><p>Kotlin</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@SpringBootApplication</span><span class="hljs-variable">@EnableBatchProcessingpublic</span> class MyApplication &#123;<br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å› ä¸ºæ­¤ç±»æ˜¯æµ‹è¯•çš„æºé…ç½®, æ‰€ä»¥ä»»ä½•åˆ‡ç‰‡æµ‹è¯•å®é™…ä¸Šéƒ½å°è¯•å¯åŠ¨ Spring Batch, è¿™ç»å¯¹ä¸æ˜¯æ‚¨æƒ³è¦æ‰§è¡Œçš„æ“ä½œ. å»ºè®®çš„æ–¹æ³•æ˜¯å°†ç‰¹å®šäºåŒºåŸŸçš„é…ç½®ç§»åŠ¨åˆ°ä¸æ‚¨çš„åº”ç”¨ç¨‹åºå¤„äºåŒä¸€çº§åˆ«çš„å•ç‹¬çš„ <code>@Configuration</code> ç±», å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><p>Java</p><p>Kotlin</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Configuration</span>(proxyBeanMethods = false)<span class="hljs-variable">@EnableBatchProcessingpublic</span> class MyBatchConfiguration &#123;<br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>æ ¹æ®æ‚¨åº”ç”¨ç¨‹åºçš„å¤æ‚æ€§, æ‚¨å¯ä»¥ä¸ºæ‚¨çš„è‡ªå®šä¹‰è®¾ç½®ä¸€ä¸ª <code>@Configuration</code> ç±», æˆ–è€…æ¯ä¸ªåŸŸåŒºåŸŸä¸€ä¸ªç±». åä¸€ç§æ–¹æ³•ä½¿æ‚¨å¯ä»¥åœ¨å…¶ä¸­ä¸€ä¸ªæµ‹è¯•ä¸­ä½¿ç”¨ <code>@Import</code> æ³¨è§£å¯ç”¨å®ƒ.è¯·å‚é˜… <a href="https://sca.aliyun.com/learn/spring-boot/core/howto.html#howto.testing.slice-tests">this how-to section</a> äº†è§£æœ‰å…³ä½•æ—¶å¯èƒ½éœ€è¦ä¸ºåˆ‡ç‰‡æµ‹è¯•å¯ç”¨ç‰¹å®š <code>@Configuration</code> ç±»çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚</p><p>æµ‹è¯•ç‰‡å°† <code>@Configuration</code> ç±»ä»æ‰«æä¸­æ’é™¤. ä¾‹å¦‚, å¯¹äº <code>@WebMvcTest</code>, ä»¥ä¸‹é…ç½®å°†åœ¨æµ‹è¯•åˆ‡ç‰‡åŠ è½½çš„åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­ä¸åŒ…æ‹¬ç»™å®šçš„ <code>WebMvcConfigurer</code> Bean:</p><p>Java</p><p>Kotlin</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Configuration</span>(proxyBeanMethods = <span class="hljs-literal">false</span>)<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyWebConfiguration</span> &#123;<br>    <span class="hljs-meta">@Bean</span>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">WebMvcConfigurer</span> <span class="hljs-title function_">testConfigurer</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebMvcConfigurer</span>() &#123;            <span class="hljs-comment">// ...        &#125;;    &#125;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯, ä»¥ä¸‹é…ç½®å°†å¯¼è‡´è‡ªå®šä¹‰ <code>WebMvcConfigurer</code> ç”±æµ‹è¯•ç‰‡åŠ è½½.</p><p>Java</p><p>Kotlin</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">@Componentpublic <span class="hljs-keyword">class</span> <span class="hljs-symbol">MyWebMvcConfigurer</span> <span class="hljs-symbol">implements</span> <span class="hljs-symbol">WebMvcConfigurer</span> &#123;<br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>æ··ä¹±çš„å¦ä¸€ä¸ªæ¥æºæ˜¯ç±»è·¯å¾„æ‰«æ. å‡å®šåœ¨ä»¥åˆç†çš„æ–¹å¼ç»„ç»‡ä»£ç çš„åŒæ—¶, æ‚¨éœ€è¦æ‰«æå…¶ä»–ç¨‹åºåŒ…. æ‚¨çš„åº”ç”¨ç¨‹åºå¯èƒ½ç±»ä¼¼äºä»¥ä¸‹ä»£ç :</p><p>Java</p><p>Kotlin</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@SpringBootApplication</span><span class="hljs-variable">@ComponentScan</span>(&#123; <span class="hljs-string">&quot;com.example.app&quot;</span>, <span class="hljs-string">&quot;com.example.another&quot;</span> &#125;)public class MyApplication &#123;<br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·åšæœ‰æ•ˆåœ°è¦†ç›–äº†é»˜è®¤çš„ç»„ä»¶æ‰«ææŒ‡ä»¤, å¹¶ä¸”å…·æœ‰æ‰«æè¿™ä¸¤ä¸ªè½¯ä»¶åŒ…çš„å‰¯ä½œç”¨, è€Œä¸æ‚¨é€‰æ‹©çš„åˆ‡ç‰‡æ— å…³. ä¾‹å¦‚, <code>@DataJpaTest</code> ä¼¼ä¹çªç„¶æ‰«æäº†åº”ç”¨ç¨‹åºçš„ç»„ä»¶å’Œç”¨æˆ·é…ç½®. åŒæ ·, å°†è‡ªå®šä¹‰æŒ‡ä»¤ç§»è‡³å•ç‹¬çš„ç±»æ˜¯è§£å†³æ­¤é—®é¢˜çš„å¥½æ–¹æ³•.</p><p>å¦‚æœè¿™ä¸æ˜¯æ‚¨çš„é€‰æ‹©, åˆ™å¯ä»¥åœ¨æµ‹è¯•å±‚æ¬¡ç»“æ„ä¸­çš„æŸä¸ªä½ç½®åˆ›å»º <code>@SpringBootConfiguration</code>, ä»¥ä¾¿ä»£æ›¿ä½¿ç”¨å®ƒ. æˆ–è€…, æ‚¨å¯ä»¥ä¸ºæµ‹è¯•æŒ‡å®šä¸€ä¸ªæº, ä»è€Œç¦ç”¨æŸ¥æ‰¾é»˜è®¤æºçš„è¡Œä¸º.</p><h4 id="8-3-34-ä½¿ç”¨-Spock-æµ‹è¯•-Spring-Boot-åº”ç”¨ç¨‹åº"><a href="#8-3-34-ä½¿ç”¨-Spock-æµ‹è¯•-Spring-Boot-åº”ç”¨ç¨‹åº" class="headerlink" title="8.3.34. ä½¿ç”¨ Spock æµ‹è¯• Spring Boot åº”ç”¨ç¨‹åº"></a>8.3.34. ä½¿ç”¨ Spock æµ‹è¯• Spring Boot åº”ç”¨ç¨‹åº</h4><p>å¦‚æœæ‚¨å¸Œæœ›ä½¿ç”¨ Spock 2.x æ¥æµ‹è¯• Spring Boot åº”ç”¨ç¨‹åº, åˆ™åº”åœ¨åº”ç”¨ç¨‹åºçš„æ„å»ºä¸­æ·»åŠ å¯¹ Spock çš„ <code>spock-spring</code> æ¨¡å—çš„ <code>-groovy-4.0</code> ç‰ˆæœ¬ä¾èµ–. <code>spock-spring</code> å°† Spring çš„æµ‹è¯•æ¡†æ¶é›†æˆåˆ°äº† Spock ä¸­. æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯, è¯·å‚è§ <a href="https://spockframework.org/spock/docs/2.2-M1/modules.html#_spring_module">Spock çš„ Spring æ¨¡å—çš„æ–‡æ¡£</a>..</p><h3 id="8-4-æµ‹è¯•å®ç”¨å·¥å…·"><a href="#8-4-æµ‹è¯•å®ç”¨å·¥å…·" class="headerlink" title="8.4. æµ‹è¯•å®ç”¨å·¥å…·"></a>8.4. æµ‹è¯•å®ç”¨å·¥å…·</h3><p>ä¸€äº›æµ‹è¯•å®ç”¨å·¥å…·ç±»é€šå¸¸åœ¨æµ‹è¯•æ‚¨çš„åº”ç”¨ç¨‹åºæ—¶æœ‰ç”¨, å®ƒä»¬è¢«æ‰“åŒ…ä¸º <code>spring-boot</code> çš„ä¸€éƒ¨åˆ†.</p><h4 id="8-4-1-ConfigDataApplicationContextInitializer"><a href="#8-4-1-ConfigDataApplicationContextInitializer" class="headerlink" title="8.4.1. ConfigDataApplicationContextInitializer"></a>8.4.1. ConfigDataApplicationContextInitializer</h4><p><code>ConfigFileApplicationContextInitializer</code> æ˜¯ä¸€ä¸ª <code>ApplicationContextInitializer</code>, æ‚¨å¯ä»¥å°†å…¶åº”ç”¨äºæµ‹è¯•ä»¥åŠ è½½ Spring Boot <code>application.properties</code> æ–‡ä»¶. å½“ä¸éœ€è¦ <code>@SpringBootTest</code> æä¾›çš„å…¨éƒ¨åŠŸèƒ½æ—¶, å¯ä»¥ä½¿ç”¨å®ƒ, å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><p>Java</p><p>Kotlin</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-variable">@ContextConfiguration</span>(classes = <span class="hljs-title class_">Config</span>.<span class="hljs-keyword">class</span>, initializers = <span class="hljs-title class_">ConfigDataApplicationContextInitializer</span>.<span class="hljs-keyword">class</span>)<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyConfigFileTests</span> &#123;<br>    <span class="hljs-regexp">//</span> ...<br>&#125;<br></code></pre></td></tr></table></figure><p>å•ç‹¬ä½¿ç”¨ <code>ConfigFileApplicationContextInitializer</code> ä¸èƒ½æä¾›å¯¹ <code>@Value(&quot;$&#123;â€¦&#125;&quot;)</code> æ³¨å…¥çš„æ”¯æŒ. å”¯ä¸€çš„å·¥ä½œå°±æ˜¯ç¡®ä¿å°† <code>application.properties</code> æ–‡ä»¶åŠ è½½åˆ° Spring çš„ç¯å¢ƒä¸­. ä¸ºäº†è·å¾— <code>@Value</code> æ”¯æŒ, æ‚¨éœ€è¦å¦å¤–é…ç½® <code>PropertySourcesPlaceholderConfigurer</code> æˆ–ä½¿ç”¨ <code>@SpringBootTest</code>, åè€…ä¼šä¸ºæ‚¨è‡ªåŠ¨é…ç½®ä¸€ä¸ª.</p><h4 id="8-4-2-TestPropertyValues"><a href="#8-4-2-TestPropertyValues" class="headerlink" title="8.4.2. TestPropertyValues"></a>8.4.2. TestPropertyValues</h4><p>ä½¿ç”¨ <code>TestPropertyValues</code>, å¯ä»¥å¿«é€Ÿå°†å±æ€§æ·»åŠ åˆ° <code>ConfigurableEnvironment</code> æˆ– <code>ConfigurableApplicationContext</code>. æ‚¨å¯ä»¥ä½¿ç”¨ <code>key=value</code> å­—ç¬¦ä¸²æ¥è°ƒç”¨å®ƒ, å¦‚ä¸‹æ‰€ç¤º:</p><p>Java</p><p>Kotlin</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyEnvironmentTests</span> &#123;<br><span class="hljs-meta">    @Test    void testPropertySources() &#123;        MockEnvironment environment = new MockEnvironment();        TestPropertyValues.of(<span class="hljs-params"><span class="hljs-string">&quot;org=Spring&quot;</span>, <span class="hljs-string">&quot;name=Boot&quot;</span></span>).applyTo(<span class="hljs-params">environment</span>);        assertThat(<span class="hljs-params">environment.getProperty(<span class="hljs-params"><span class="hljs-string">&quot;name&quot;</span></span>)</span>).isEqualTo(<span class="hljs-params"><span class="hljs-string">&quot;Boot&quot;</span></span>);    &#125;</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="8-4-3-OutputCapture"><a href="#8-4-3-OutputCapture" class="headerlink" title="8.4.3. OutputCapture"></a>8.4.3. OutputCapture</h4><p><code>OutputCapture</code> æ˜¯ä¸€ä¸ª JUnit æ‰©å±•, å¯ç”¨äºæ•è· <code>System.out</code> å’Œ <code>System.err</code> è¾“å‡º. è¦ä½¿ç”¨ add <code>@ExtendWith(OutputCaptureExtension.class)</code> å¹¶å°† <code>CapturedOutput</code> ä½œä¸ºå‚æ•°æ³¨å…¥æµ‹è¯•ç±»æ„é€ å‡½æ•°æˆ–æµ‹è¯•æ–¹æ³•, å¦‚ä¸‹æ‰€ç¤º:</p><p>Java</p><p>Kotlin</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@ExtendWith(<span class="hljs-params">OutputCaptureExtension.<span class="hljs-keyword">class</span></span>)class MyOutputCaptureTests &#123;</span><br><span class="hljs-meta">    @Test    void testName(<span class="hljs-params">CapturedOutput output</span>) &#123;        System.out.println(<span class="hljs-params"><span class="hljs-string">&quot;Hello World!&quot;</span></span>);        assertThat(<span class="hljs-params">output</span>).contains(<span class="hljs-params"><span class="hljs-string">&quot;World&quot;</span></span>);    &#125;</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="8-4-4-TestRestTemplate"><a href="#8-4-4-TestRestTemplate" class="headerlink" title="8.4.4. TestRestTemplate"></a>8.4.4. TestRestTemplate</h4><p><code>TestRestTemplate</code> æ˜¯ Spring <code>RestTemplate</code> çš„ä¸€ç§ä¾¿æ·æ›¿ä»£æ–¹æ¡ˆ, åœ¨é›†æˆæµ‹è¯•ä¸­éå¸¸æœ‰ç”¨. æ‚¨å¯ä»¥ä½¿ç”¨æ™®é€šæ¨¡æ¿æˆ–å‘é€åŸºæœ¬ HTTP èº«ä»½éªŒè¯ (å¸¦æœ‰ç”¨æˆ·åå’Œå¯†ç ) çš„æ¨¡æ¿. åœ¨ä»»ä½•ä¸€ç§æƒ…å†µä¸‹, æ¨¡ç‰ˆéƒ½å…·æœ‰å®¹é”™æ€§ï¼Œè¿™æ„å‘³ç€å®ƒä»¥ä¸€ç§æµ‹è¯•å‹å¥½çš„æ–¹å¼è¿è¡Œï¼Œä¸ä¼šåœ¨ 4xx å’Œ 5xx é”™è¯¯ä¸ŠæŠ›å‡ºå¼‚å¸¸ã€‚ç›¸åï¼Œå¯ä»¥é€šè¿‡è¿”å›çš„ <code>ResponseEntity</code> åŠå…¶çŠ¶æ€ç æ£€æµ‹æ­¤ç±»é”™è¯¯ã€‚</p><p>Spring Framework 5.0 æä¾›äº†ä¸€ä¸ªæ–°çš„ <code>WebTestClient</code>, å¯ç”¨äº <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.testing.spring-boot-applications.spring-webflux-tests">WebFlux é›†æˆæµ‹è¯•</a> å’Œ <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.testing.spring-boot-applications.with-running-server">WebFlux å’Œ MVC ç«¯åˆ°ç«¯æµ‹è¯•</a>. ä¸ <code>TestRestTemplate</code> ä¸åŒ, å®ƒä¸ºå£°æ˜æä¾›äº†æµå¼çš„ API.</p><p>å»ºè®® (ä½†ä¸æ˜¯å¼ºåˆ¶æ€§çš„) ä½¿ç”¨ Apache HTTP Client (ç‰ˆæœ¬ 4.3.2 æˆ–æ›´é«˜ç‰ˆæœ¬) . å¦‚æœæ‚¨åœ¨ç±»è·¯å¾„ä¸­å…·æœ‰è¯¥åç§°, åˆ™ <code>TestRestTemplate</code> ä¼šé€šè¿‡é€‚å½“é…ç½®å®¢æˆ·ç«¯è¿›è¡Œå“åº”. å¦‚æœæ‚¨ç¡®å®ä½¿ç”¨ Apache çš„ HTTP å®¢æˆ·ç«¯, åˆ™ä¼šå¯ç”¨ä¸€äº›å…¶ä»–æ˜“äºæµ‹è¯•çš„åŠŸèƒ½:</p><ul><li>ä¸æ”¯æŒé‡å®šå‘(å› æ­¤å¯ä»¥æ–­è¨€å“åº”ä½ç½®).</li><li>å¿½ç•¥ cookie(å› æ­¤æ¨¡æ¿æ˜¯æ— çŠ¶æ€çš„).</li></ul><p><code>TestRestTemplate</code> å¯ä»¥åœ¨ä½ çš„é›†æˆæµ‹è¯•ä¸­ç›´æ¥å®ä¾‹åŒ–, å¦‚ä¸‹é¢çš„ä¾‹å­æ‰€ç¤º:</p><p>Java</p><p>Kotlin</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTests</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> TestRestTemplate <span class="hljs-keyword">template</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">TestRestTemplate</span>();<br>    @<span class="hljs-function">Test    <span class="hljs-type">void</span> <span class="hljs-title">testRequest</span><span class="hljs-params">()</span> </span>&#123;        ResponseEntity&lt;<span class="hljs-type">String</span>&gt; headers = <span class="hljs-keyword">this</span>.<span class="hljs-keyword">template</span>.<span class="hljs-built_in">getForEntity</span>(<span class="hljs-string">&quot;https://myhost.example.com/example&quot;</span>, <span class="hljs-type">String</span>.<span class="hljs-keyword">class</span>);        <span class="hljs-built_in">assertThat</span>(headers.<span class="hljs-built_in">getHeaders</span>().<span class="hljs-built_in">getLocation</span>()).<span class="hljs-built_in">hasHost</span>(<span class="hljs-string">&quot;other.example.com&quot;</span>);    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ–è€…, å¦‚æœå°† <code>@SpringBootTest</code> æ³¨è§£ä¸ <code>WebEnvironment.RANDOM_PORT</code> æˆ– <code>WebEnvironment.DEFINED_PORT</code> ä¸€èµ·ä½¿ç”¨, åˆ™å¯ä»¥æ³¨å…¥å®Œå…¨é…ç½®çš„ <code>TestRestTemplate</code> å¹¶å¼€å§‹ä½¿ç”¨å®ƒ. å¦‚æœ‰å¿…è¦, å¯ä»¥é€šè¿‡ <code>RestTemplateBuilder</code> bean åº”ç”¨å…¶ä»–å®šåˆ¶. æœªæŒ‡å®šä¸»æœºå’Œç«¯å£çš„æ‰€æœ‰ URL éƒ½ä¼šè‡ªåŠ¨è¿æ¥åˆ°åµŒå…¥å¼æœåŠ¡å™¨, å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><p>Java</p><p>Kotlin</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@SpringBootTest</span>(webEnvironment = <span class="hljs-title class_">WebEnvironment</span>.<span class="hljs-property">RANDOM_PORT</span>)<span class="hljs-keyword">class</span> <span class="hljs-title class_">MySpringBootTests</span> &#123;<br>    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">TestRestTemplate</span> template;<br>    <span class="hljs-meta">@Test</span>    <span class="hljs-built_in">void</span> <span class="hljs-title function_">testRequest</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-title class_">HttpHeaders</span> headers = <span class="hljs-variable language_">this</span>.<span class="hljs-property">template</span>.<span class="hljs-title function_">getForEntity</span>(<span class="hljs-string">&quot;/example&quot;</span>, <span class="hljs-title class_">String</span>.<span class="hljs-property">class</span>).<span class="hljs-title function_">getHeaders</span>();        <span class="hljs-title function_">assertThat</span>(headers.<span class="hljs-title function_">getLocation</span>()).<span class="hljs-title function_">hasHost</span>(<span class="hljs-string">&quot;other.example.com&quot;</span>);    &#125;<br>    <span class="hljs-meta">@TestConfiguration</span>(proxyBeanMethods = <span class="hljs-literal">false</span>)    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RestTemplateBuilderConfiguration</span> &#123;<br>        <span class="hljs-meta">@Bean</span>        <span class="hljs-title class_">RestTemplateBuilder</span> <span class="hljs-title function_">restTemplateBuilder</span>(<span class="hljs-params"></span>) &#123;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestTemplateBuilder</span>().<span class="hljs-title function_">setConnectTimeout</span>(<span class="hljs-title class_">Duration</span>.<span class="hljs-title function_">ofSeconds</span>(<span class="hljs-number">1</span>))                    .<span class="hljs-title function_">setReadTimeout</span>(<span class="hljs-title class_">Duration</span>.<span class="hljs-title function_">ofSeconds</span>(<span class="hljs-number">1</span>));        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="9-åˆ›å»ºè‡ªå·±çš„è‡ªåŠ¨é…ç½®"><a href="#9-åˆ›å»ºè‡ªå·±çš„è‡ªåŠ¨é…ç½®" class="headerlink" title="9. åˆ›å»ºè‡ªå·±çš„è‡ªåŠ¨é…ç½®"></a>9. åˆ›å»ºè‡ªå·±çš„è‡ªåŠ¨é…ç½®</h2><p>å¦‚æœæ‚¨åœ¨å…¬å¸è´Ÿè´£å¼€å‘å…¬å…±ç±»åº“, æˆ–è€…å¦‚æœæ‚¨åœ¨å¼€å‘ä¸€ä¸ªå¼€æºæˆ–å•†ä¸šåº“, æ‚¨å¯èƒ½å¸Œæœ›å¼€å‘è‡ªå·±çš„è‡ªåŠ¨é…ç½®. è‡ªåŠ¨é…ç½®ç±»å¯ä»¥æ†ç»‘åœ¨å¤–éƒ¨ jar ä¸­, ä»–ä»ç„¶å¯ä»¥è¢« Spring Boot è·å–.</p><p>è‡ªåŠ¨é…ç½®å¯ä»¥ä¸æä¾›è‡ªåŠ¨é…ç½®ä»£ç çš„ starter ä»¥åŠæ‚¨å°†ä½¿ç”¨çš„ç±»åº“åº“ç›¸å…³è”. æˆ‘ä»¬é¦–å…ˆä»‹ç»æ„å»ºè‡ªå·±çš„è‡ªåŠ¨é…ç½®éœ€è¦äº†è§£çš„å†…å®¹, ç„¶åæˆ‘ä»¬å°†ç»§ç»­ä»‹ç»åˆ›å»º <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.developing-auto-configuration.custom-starter">è‡ªå®šä¹‰ starter æ‰€éœ€çš„æ­¥éª¤</a>.</p><h3 id="9-1-ç†è§£è‡ªåŠ¨é…ç½®çš„-Beans"><a href="#9-1-ç†è§£è‡ªåŠ¨é…ç½®çš„-Beans" class="headerlink" title="9.1. ç†è§£è‡ªåŠ¨é…ç½®çš„ Beans"></a>9.1. ç†è§£è‡ªåŠ¨é…ç½®çš„ Beans</h3><p>å®ç°è‡ªåŠ¨é…ç½®çš„ç±»ç”¨ <code>@AutoConfiguration</code> æ³¨è§£ã€‚ æ­¤æ³¨è§£æœ¬èº«ä½¿ç”¨ <code>@Configuration</code> è¿›è¡Œå…ƒæ³¨è§£ï¼Œä½¿è‡ªåŠ¨é…ç½®æˆä¸ºæ ‡å‡†çš„ <code>@Configuration</code> ç±»ã€‚ <code>@Conditional</code> æ³¨è§£ç”¨äºçº¦æŸä½•æ—¶åº”ç”¨è‡ªåŠ¨é…ç½®ã€‚ é€šå¸¸ï¼Œè‡ªåŠ¨é…ç½®ç±»ä½¿ç”¨ <code>@ConditionalOnClass</code> å’Œ <code>@ConditionalOnMissingBean</code> æ³¨è§£ã€‚ è¿™å¯ç¡®ä¿ä»…åœ¨æ‰¾åˆ°ç›¸å…³ç±»æ—¶ä»¥åŠæœªå£°æ˜æ‚¨è‡ªå·±çš„ <code>@Configuration</code> æ—¶æ‰åº”ç”¨è‡ªåŠ¨é…ç½®.</p><p>æ‚¨å¯ä»¥æµè§ˆ <a href="https://github.com/spring-projects/spring-boot/tree/main/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure"><code>spring-boot-autoconfigure</code></a> çš„æºä»£ç , ä»¥æŸ¥çœ‹ Spring æä¾›çš„ <code>@AutoConfiguration</code> ç±» (è¯·å‚é˜… <a href="https://github.com/spring-projects/spring-boot/tree/main/spring-boot-project/spring-boot-autoconfigure/src/main/resources/META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports"><code>META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code></a> æ–‡ä»¶).</p><h3 id="9-2-æ‰¾åˆ°å€™é€‰çš„è‡ªåŠ¨é…ç½®"><a href="#9-2-æ‰¾åˆ°å€™é€‰çš„è‡ªåŠ¨é…ç½®" class="headerlink" title="9.2. æ‰¾åˆ°å€™é€‰çš„è‡ªåŠ¨é…ç½®"></a>9.2. æ‰¾åˆ°å€™é€‰çš„è‡ªåŠ¨é…ç½®</h3><p>Spring Boot ä¼šæ£€æŸ¥å·²å‘å¸ƒ jar ä¸­æ˜¯å¦å­˜åœ¨ <code>META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code> æ–‡ä»¶. è¯¥æ–‡ä»¶åˆ—å‡ºæ‚¨çš„é…ç½®ç±»ï¼Œæ¯è¡Œä¸€ä¸ªç±»åï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š, å¦‚ä¸‹æ‰€ç¤º:</p><p>com.mycorp.libx.autoconfigure.LibXAutoConfiguration com.mycorp.libx.autoconfigure.LibXWebAutoConfiguration</p><p>TIP</p><p>æ‚¨å¯ä»¥ä½¿ç”¨ <code>#</code> å·æ·»åŠ æ³¨é‡Š.</p><p>å¿…é¡»ä»¥è¿™ç§æ–¹å¼åŠ è½½è‡ªåŠ¨é…ç½®. ç¡®ä¿å®ƒä»¬åœ¨ç‰¹å®šçš„åŒ…ç©ºé—´ä¸­å®šä¹‰, å¹¶ä¸”å®ƒä»¬ä¸èƒ½æ˜¯ç»„ä»¶æ‰«æçš„ç›®æ ‡. æ­¤å¤–, è‡ªåŠ¨é…ç½®ç±»ä¸åº”å¯ç”¨ç»„ä»¶æ‰«æä»¥æŸ¥æ‰¾å…¶ä»–ç»„ä»¶. åº”è¯¥ä½¿ç”¨ç‰¹å®šçš„ <code>@Imports</code> æ¥ä»£æ›¿.</p><p>å¦‚æœéœ€è¦æŒ‰ç‰¹å®šé¡ºåºåº”ç”¨é…ç½®, åˆ™å¯ä»¥ä½¿ç”¨ <a href="https://github.com/spring-projects/spring-boot/tree/main/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/AutoConfiguration.java"><code>@AutoConfiguration</code></a> çš„ <code>before</code>, <code>beforeName</code>, <code>after</code> å’Œ <code>afterName</code> å±æ€§ã€‚ æˆ–ä½¿ç”¨ <a href="https://github.com/spring-projects/spring-boot/tree/main/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/AutoConfigureAfter.java"><code>@AutoConfigureAfter</code></a> æˆ– <a href="https://github.com/spring-projects/spring-boot/tree/main/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/AutoConfigureBefore.java"><code>@AutoConfigureBefore</code></a> æ³¨è§£. ä¾‹å¦‚, å¦‚æœæ‚¨æä¾›ç‰¹å®šäº Web çš„é…ç½®, åˆ™å¯èƒ½éœ€è¦åœ¨ <code>WebMvcAutoConfiguration</code> ä¹‹ååº”ç”¨æ‚¨çš„ç±».</p><p>å¦‚æœæ‚¨æƒ³æ’åºæŸäº›ä¸åº”è¯¥å½¼æ­¤ç›´æ¥äº†è§£çš„è‡ªåŠ¨é…ç½®, æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>@AutoConfigureOrder</code>. è¯¥æ³¨è§£ä¸å¸¸è§„ <code>@Order</code> æ³¨è§£æœ‰ç›¸åŒçš„è¯­ä¹‰, ä½†å®ƒä¸ºè‡ªåŠ¨é…ç½®ç±»æä¾›äº†ä¸“ç”¨é¡ºåº.</p><p>ä¸æ ‡å‡†çš„ <code>@Configuration</code> ç±»ä¸€æ ·, è‡ªåŠ¨é…ç½®ç±»çš„åº”ç”¨é¡ºåºä»…ä¼šå½±å“å…¶ bean çš„å®šä¹‰é¡ºåº.éšååˆ›å»ºè¿™äº› bean çš„é¡ºåºä¸å—å½±å“, å¹¶ç”±æ¯ä¸ª bean çš„ä¾èµ–å…³ç³»å’Œä»»ä½• <code>@DependsOn</code> å…³ç³»ç¡®å®š.</p><h3 id="9-3-æ¡ä»¶æ³¨è§£"><a href="#9-3-æ¡ä»¶æ³¨è§£" class="headerlink" title="9.3. æ¡ä»¶æ³¨è§£"></a>9.3. æ¡ä»¶æ³¨è§£</h3><p>æ‚¨å‡ ä¹æ€»å¸Œæœ›åœ¨è‡ªåŠ¨é…ç½®ç±»ä¸­åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ª <code>@Conditional</code> æ³¨è§£. <code>@ConditionalOnMissingBean</code> æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„æ³¨è§£, å…¶å…è®¸å¼€å‘äººå‘˜åœ¨å¯¹æ‚¨çš„é»˜è®¤å€¼ä¸æ»¡æ„ç”¨äºè¦†ç›–è‡ªåŠ¨é…ç½®.</p><p>Spring Boot åŒ…å«è®¸å¤š <code>@Conditional</code> æ³¨è§£, æ‚¨å¯ä»¥é€šè¿‡æ³¨è§£ <code>@Configuration</code> ç±»æˆ–å•ç‹¬çš„ <code>@Bean</code> æ–¹æ³•åœ¨æ‚¨è‡ªå·±çš„ä»£ç ä¸­å¤ç”¨å®ƒä»¬. è¿™äº›æ³¨è§£åŒ…æ‹¬:</p><ul><li><a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.developing-auto-configuration.condition-annotations.class-conditions">ç±»æ¡ä»¶</a></li><li><a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.developing-auto-configuration.condition-annotations.bean-conditions">Bean æ¡ä»¶</a></li><li><a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.developing-auto-configuration.condition-annotations.property-conditions">å±æ€§æ¡ä»¶</a></li><li><a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.developing-auto-configuration.condition-annotations.resource-conditions">èµ„æºæ¡ä»¶</a></li><li><a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.developing-auto-configuration.condition-annotations.web-application-conditions">Web åº”ç”¨ç¨‹åºæ¡ä»¶</a></li><li><a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.developing-auto-configuration.condition-annotations.spel-conditions">SpEL è¡¨è¾¾å¼æ¡ä»¶</a></li></ul><h4 id="9-3-1-ç±»æ¡ä»¶"><a href="#9-3-1-ç±»æ¡ä»¶" class="headerlink" title="9.3.1. ç±»æ¡ä»¶"></a>9.3.1. ç±»æ¡ä»¶</h4><p><code>@ConditionalOnClass</code> å’Œ <code>@ConditionalOnMissingClass</code> æ³¨è§£å…è®¸æ ¹æ®ç‰¹å®šç±»çš„æ˜¯å¦å­˜åœ¨æ¥åŒ…å« <code>@Configuration</code> ç±». ç”±äºä½¿ç”¨ <a href="https://asm.ow2.io/">ASM</a> è§£ææ³¨è§£å…ƒæ•°æ®, æ‚¨å¯ä»¥ä½¿ç”¨ <code>value</code> å±æ€§æ¥å¼•ç”¨çœŸå®ç±», å³ä½¿è¯¥ç±»å®é™…ä¸Šå¯èƒ½ä¸ä¼šå‡ºç°åœ¨æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºçš„ <code>classpath</code> ä¸­. å¦‚æœæ‚¨å¸Œæœ›ä½¿ç”¨ <code>String</code> å€¼æ¥æŒ‡å®šç±»å, ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>name</code> å±æ€§.</p><p>æ­¤æœºåˆ¶ä¸ä¼šä»¥ç›¸åŒçš„æ–¹å¼åº”ç”¨äºè¿”å›ç±»å‹æ˜¯æ¡ä»¶çš„ç›®æ ‡çš„ <code>@Bean</code> æ–¹æ³•: åœ¨æ–¹æ³•ä¸Šçš„æ¡ä»¶åº”ç”¨ä¹‹å‰, JVM å°†åŠ è½½ç±»å’Œå¯èƒ½å¤„ç†çš„æ–¹æ³•å¼•ç”¨, å¦‚æœæ‰¾ä¸åˆ°ç±», å°†å‘ç”Ÿå¤±è´¥.</p><p>è¦å¤„ç†è¿™ç§æƒ…å†µ, å¯ä»¥ä½¿ç”¨å•ç‹¬çš„ <code>@Configuration</code> ç±»æ¥éš”ç¦»æ¡ä»¶, å¦‚ä¸‹æ‰€ç¤º:</p><p>Java</p><p>Kotlin</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@AutoConfiguration</span><span class="hljs-comment">// Some conditions ...public class MyAutoConfiguration &#123;</span><br>    <span class="hljs-comment">// Auto-configured beans ...</span><br>    <span class="hljs-variable">@Configuration</span>(proxyBeanMethods = false)    <span class="hljs-variable">@ConditionalOnClass</span>(SomeService.class)    public static class SomeServiceConfiguration &#123;<br>        <span class="hljs-variable">@Bean</span>        <span class="hljs-variable">@ConditionalOnMissingBean</span>        public SomeService <span class="hljs-built_in">someService</span>() &#123;            <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">SomeService</span>();        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœä½¿ç”¨ <code>@ConditionalOnClass</code> æˆ– <code>@ConditionalOnMissingClass</code> ä½œä¸ºå…ƒæ³¨è§£çš„ä¸€éƒ¨åˆ†æ¥ç»„æˆè‡ªå·±çš„ç»„åˆæ³¨è§£, åˆ™å¿…é¡»ä½¿ç”¨ <code>name</code> æ¥å¼•ç”¨ç±», åœ¨è¿™ç§æƒ…å†µå°†ä¸ä½œå¤„ç†.</p><h4 id="9-3-2-Bean-æ¡ä»¶"><a href="#9-3-2-Bean-æ¡ä»¶" class="headerlink" title="9.3.2. Bean æ¡ä»¶"></a>9.3.2. Bean æ¡ä»¶</h4><p><code>@ConditionalOnBean</code> å’Œ <code>@ConditionalOnMissingBean</code> æ³¨è§£å…è®¸æ ¹æ®ç‰¹å®š bean æ˜¯å¦å­˜åœ¨æ¥åŒ…å« bean. æ‚¨å¯ä»¥ä½¿ç”¨ <code>value</code> å±æ€§æŒ‰ç±»å‹æˆ–ä½¿ç”¨ <code>name</code> æ¥æŒ‡å®š bean. <code>search</code> å±æ€§å…è®¸æ‚¨é™åˆ¶åœ¨æœç´¢ bean æ—¶åº”è€ƒè™‘çš„ <code>ApplicationContext</code> å±‚æ¬¡ç»“æ„.</p><p>æ”¾ç½®åœ¨ <code>@Bean</code> æ–¹æ³•ä¸Šæ—¶, ç›®æ ‡ç±»å‹é»˜è®¤ä¸ºæ–¹æ³•çš„è¿”å›ç±»å‹, å¦‚ä¸‹æ‰€ç¤º:</p><p>Java</p><p>Kotlin</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@AutoConfigurationpublic</span> class MyAutoConfiguration &#123;<br>    <span class="hljs-variable">@Bean</span>    <span class="hljs-variable">@ConditionalOnMissingBean</span>    public SomeService <span class="hljs-built_in">someService</span>() &#123;        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">SomeService</span>();    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­, å¦‚æœ <code>ApplicationContext</code> ä¸­ä¸åŒ…å« <code>SomeService</code> ç±»å‹çš„ bean, åˆ™å°†åˆ›å»º <code>someService</code> bean.</p><p>æ‚¨éœ€è¦éå¸¸å°å¿ƒåœ°æ·»åŠ  bean å®šä¹‰çš„é¡ºåº, å› ä¸ºè¿™äº›æ¡ä»¶æ˜¯æ ¹æ®åˆ°ç›®å‰ä¸ºæ­¢å·²å¤„ç†çš„å†…å®¹è¿›è¡Œè®¡ç®—çš„. å› æ­¤, æˆ‘ä»¬å»ºè®®åœ¨è‡ªåŠ¨é…ç½®ç±»ä¸Šä»…ä½¿ç”¨ <code>@ConditionalOnBean</code> å’Œ <code>@ConditionalOnMissingBean</code> æ³¨è§£ (å› ä¸ºè¿™äº›æ³¨è§£ä¿è¯åœ¨æ·»åŠ æ‰€æœ‰ç”¨æˆ·å®šä¹‰çš„ bean å®šä¹‰ååŠ è½½) .</p><p><code>@ConditionalOnBean</code> å’Œ <code>@ConditionalOnMissingBean</code> ä¸ä¼šé˜»æ­¢åˆ›å»º <code>@Configuration</code> ç±». åœ¨ç±»çº§åˆ«ä½¿ç”¨è¿™äº›æ¡ä»¶å¹¶ä½¿ç”¨æ³¨è§£æ ‡è®°æ¯ä¸ªåŒ…å« <code>@Bean</code> æ–¹æ³•çš„å”¯ä¸€åŒºåˆ«æ˜¯, å¦‚æœæ¡ä»¶ä¸åŒ¹é…, å‰è€…ä¼šé˜»æ­¢å°† <code>@Configuration</code> ç±»æ³¨å†Œä¸º bean.</p><p>å£°æ˜ <code>@Bean</code> æ–¹æ³•æ—¶, è¯·åœ¨è¯¥æ–¹æ³•çš„è¿”å›ç±»å‹ä¸­æä¾›å°½å¯èƒ½å¤šçš„ç±»å‹ä¿¡æ¯.ä¾‹å¦‚, å¦‚æœæ‚¨çš„ bean çš„å…·ä½“ç±»å®ç°ä¸€ä¸ªæ¥å£, åˆ™ bean æ–¹æ³•çš„è¿”å›ç±»å‹åº”è¯¥æ˜¯å…·ä½“çš„ç±»è€Œä¸æ˜¯æ¥å£. ä½¿ç”¨ bean æ¡ä»¶æ—¶, åœ¨ <code>@Bean</code> æ–¹æ³•ä¸­æä¾›å°½å¯èƒ½å¤šçš„ç±»å‹ä¿¡æ¯å°¤ä¸ºé‡è¦, å› ä¸ºå®ƒä»¬çš„è¯„ä¼°åªèƒ½ä¾é æ–¹æ³•ç­¾åä¸­å¯ç”¨çš„ç±»å‹ä¿¡æ¯.</p><h4 id="9-3-3-å±æ€§æ¡ä»¶"><a href="#9-3-3-å±æ€§æ¡ä»¶" class="headerlink" title="9.3.3. å±æ€§æ¡ä»¶"></a>9.3.3. å±æ€§æ¡ä»¶</h4><p><code>@ConditionalOnProperty</code> æ³¨è§£å…è®¸åŸºäº Spring Environment å±æ€§åŒ…å«é…ç½®. ä½¿ç”¨ <code>prefix</code> å’Œ <code>name</code> å±æ€§æŒ‡å®šéœ€è¦æ£€æŸ¥çš„å±æ€§. é»˜è®¤æƒ…å†µä¸‹, åŒ¹é…å­˜åœ¨ä¸”ä¸ç­‰äº <code>false</code> çš„æ‰€æœ‰å±æ€§. æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ <code>havingValue</code> å’Œ <code>matchIfMissing</code> å±æ€§åˆ›å»ºæ›´é«˜çº§çš„æ£€æŸ¥.</p><h4 id="9-3-4-èµ„æºæ¡ä»¶"><a href="#9-3-4-èµ„æºæ¡ä»¶" class="headerlink" title="9.3.4. èµ„æºæ¡ä»¶"></a>9.3.4. èµ„æºæ¡ä»¶</h4><p><code>@ConditionalOnResource</code> æ³¨è§£ä»…å…è®¸åœ¨å­˜åœ¨ç‰¹å®šèµ„æºæ—¶åŒ…å«é…ç½®. å¯ä»¥ä½¿ç”¨å¸¸ç”¨çš„ Spring çº¦å®šæ¥æŒ‡å®šèµ„æº, å¦‚ä¸‹æ‰€ç¤º: <code>file:/home/user/test.dat</code>.</p><h4 id="9-3-5-Web-åº”ç”¨ç¨‹åºæ¡ä»¶"><a href="#9-3-5-Web-åº”ç”¨ç¨‹åºæ¡ä»¶" class="headerlink" title="9.3.5. Web åº”ç”¨ç¨‹åºæ¡ä»¶"></a>9.3.5. Web åº”ç”¨ç¨‹åºæ¡ä»¶</h4><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@ConditionalOnWebApplication</span><span class="hljs-built_in">` å’Œ `</span><span class="hljs-variable">@ConditionalOnNotWebApplication</span><span class="hljs-built_in">` æ³¨è§£åœ¨åº”ç”¨ç¨‹åºä¸º Web åº”ç”¨ç¨‹åºçš„æƒ…å†µä¸‹æ˜¯å¦åŒ…å«é…ç½®. åŸºäº servlet çš„ Web åº”ç”¨ç¨‹åºæ˜¯ä½¿ç”¨ Spring `</span>WebApplicationContext<span class="hljs-built_in">` å®šä¹‰ `</span>session<span class="hljs-built_in">` ä½œç”¨åŸŸæˆ–å…·æœ‰ `</span>ConfigurableWebEnvironment<span class="hljs-built_in">` çš„ä»»ä½•åº”ç”¨ç¨‹åºã€‚ å“åº”å¼ Web åº”ç”¨ç¨‹åºæ˜¯ä½¿ç”¨ `</span>ReactiveWebApplicationContext<span class="hljs-built_in">` æˆ–å…·æœ‰ `</span>ConfigurableReactiveWebEnvironment<br></code></pre></td></tr></table></figure><p>é€šè¿‡ <code>@ConditionalOnWarDeployment</code> æ³¨è§£, å¯ä»¥æ ¹æ®åº”ç”¨ç¨‹åºæ˜¯å¦æ˜¯å·²éƒ¨ç½²åˆ°å®¹å™¨çš„ä¼ ç»Ÿ WAR åº”ç”¨ç¨‹åºè¿›è¡Œé…ç½®.å¯¹äºåµŒå…¥å¼æœåŠ¡å™¨è¿è¡Œçš„åº”ç”¨ç¨‹åº, æ­¤æ¡ä»¶å°†ä¸åŒ¹é….</p><h4 id="9-3-6-SpEL-è¡¨è¾¾å¼æ¡ä»¶"><a href="#9-3-6-SpEL-è¡¨è¾¾å¼æ¡ä»¶" class="headerlink" title="9.3.6. SpEL è¡¨è¾¾å¼æ¡ä»¶"></a>9.3.6. SpEL è¡¨è¾¾å¼æ¡ä»¶</h4><p><code>@ConditionalOnExpression</code> æ³¨è§£å…è®¸æ ¹æ® <a href="https://sca.aliyun.com/blog/learning/spring/core/ioc#expressions">SpEL è¡¨è¾¾å¼</a> çš„ç»“æœåŒ…å«é…ç½®.</p><p>åœ¨è¡¨è¾¾å¼ä¸­å¼•ç”¨ bean å°†å¯¼è‡´è¯¥ bean åœ¨ä¸Šä¸‹æ–‡åˆ·æ–°å¤„ç†ä¸­å¾ˆæ—©å°±è¢«åˆå§‹åŒ–ã€‚ è¿™æ ·åšçš„ç»“æœæ˜¯ï¼Œbean å°†ä¸é€‚åˆè¿›è¡Œåå¤„ç†ï¼ˆä¾‹å¦‚é…ç½®å±æ€§ç»‘å®šï¼‰ï¼Œå¹¶ä¸”å…¶çŠ¶æ€å¯èƒ½ä¸å®Œæ•´ã€‚</p><h3 id="9-4-æµ‹è¯•è‡ªåŠ¨é…ç½®"><a href="#9-4-æµ‹è¯•è‡ªåŠ¨é…ç½®" class="headerlink" title="9.4. æµ‹è¯•è‡ªåŠ¨é…ç½®"></a>9.4. æµ‹è¯•è‡ªåŠ¨é…ç½®</h3><p>è‡ªåŠ¨é…ç½®å¯èƒ½å—è®¸å¤šå› ç´ çš„å½±å“: ç”¨æˆ·é…ç½® (<code>@Bean</code> å®šä¹‰å’Œ <code>Environment</code> è‡ªå®šä¹‰) ã€æ¡ä»¶è¯„ä¼° (å­˜åœ¨ç‰¹å®šçš„ç±»åº“) ç­‰. å…·ä½“è€Œè¨€, æ¯ä¸ªæµ‹è¯•éƒ½åº”è¯¥åˆ›å»ºä¸€ä¸ªå®šä¹‰è‰¯å¥½çš„ <code>ApplicationContext</code>, å®ƒè¡¨ç¤ºè¿™äº›è‡ªå®šä¹‰çš„ç»„åˆ. <code>ApplicationContextRunner</code> æä¾›äº†ä¸€ä¸ªå¥½çš„å®ç°æ–¹æ³•.</p><p><code>ApplicationContextRunner</code> é€šå¸¸è¢«å®šä¹‰ä¸ºæµ‹è¯•ç±»çš„ä¸€ä¸ªå­—æ®µ, ç”¨äºæ”¶é›†åŸºæœ¬çš„é€šç”¨é…ç½®. ä»¥ä¸‹ç¤ºä¾‹ç¡®ä¿å§‹ç»ˆè°ƒç”¨ <code>MyServiceAutoConfiguration</code>:</p><p>Java</p><p>Kotlin</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ApplicationContextRunner contextRunner = <span class="hljs-keyword">new</span> <span class="hljs-built_in">ApplicationContextRunner</span>()<br><br>        .<span class="hljs-built_in">withConfiguration</span>(AutoConfigurations.<span class="hljs-built_in">of</span>(MyServiceAutoConfiguration.<span class="hljs-keyword">class</span>));<br></code></pre></td></tr></table></figure><p>å¦‚æœå¿…é¡»å®šä¹‰å¤šä¸ªè‡ªåŠ¨é…ç½®, åˆ™æ— éœ€æŒ‰ç…§ä¸è¿è¡Œåº”ç”¨ç¨‹åºæ—¶å®Œå…¨ç›¸åŒçš„é¡ºåºè°ƒç”¨å®ƒä»¬çš„å£°æ˜.</p><p>æ¯ä¸ªæµ‹è¯•éƒ½å¯ä»¥ä½¿ç”¨ runner æ¥è¡¨ç¤ºç‰¹å®šçš„ç”¨ä¾‹. ä¾‹å¦‚, ä¸‹é¢çš„ç¤ºä¾‹è°ƒç”¨ç”¨æˆ·é…ç½® (<code>UserConfiguration</code>) å¹¶æ£€æŸ¥è‡ªåŠ¨é…ç½®æ˜¯å¦æ­£ç¡®é€€å›. è°ƒç”¨ <code>run</code> æä¾›äº†ä¸€ä¸ªå¯ä»¥ä¸ <code>AssertJ</code> ä¸€èµ·ä½¿ç”¨çš„å›è°ƒä¸Šä¸‹æ–‡.</p><p>Java</p><p>Kotlin</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs livescript">@Testvoid defaultServiceBacksOff<span class="hljs-function"><span class="hljs-params">()</span> &#123;    <span class="hljs-title">this</span>.<span class="hljs-title">contextRunner</span>.<span class="hljs-title">withUserConfiguration</span><span class="hljs-params">(UserConfiguration.<span class="hljs-keyword">class</span>)</span>.<span class="hljs-title">run</span><span class="hljs-params">((context) -&gt; &#123;        assertThat(context).hasSingleBean(MyService.<span class="hljs-keyword">class</span>);        assertThat(context).getBean(<span class="hljs-string">&quot;myCustomService&quot;</span>).isSameAs(context.getBean(MyService.<span class="hljs-keyword">class</span>));    &#125;)</span>;&#125;</span><br><span class="hljs-function">@<span class="hljs-title">Configuration</span><span class="hljs-params">(proxyBeanMethods = <span class="hljs-literal">false</span>)</span><span class="hljs-title">static</span> <span class="hljs-title">class</span> <span class="hljs-title">UserConfiguration</span> &#123;</span><br><span class="hljs-function">    @<span class="hljs-title">Bean</span>    <span class="hljs-title">MyService</span> <span class="hljs-title">myCustomService</span><span class="hljs-params">()</span> &#123;        <span class="hljs-title">return</span> <span class="hljs-title">new</span> <span class="hljs-title">MyService</span><span class="hljs-params">(<span class="hljs-string">&quot;mine&quot;</span>)</span>;    &#125;</span><br><span class="hljs-function">&#125;</span><br></code></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥è½»æ¾è‡ªå®šä¹‰ <code>Environment</code>, å¦‚ä¸‹æ‰€ç¤º:</p><p>Java</p><p>Kotlin</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs livescript">@Test<br><br><span class="hljs-literal">void</span> serviceNameCanBeConfigured() &#123;<br><br>    this.contextRunner.withPropertyValues<span class="hljs-function"><span class="hljs-params">(<span class="hljs-string">&quot;user.name=test123&quot;</span>)</span>.<span class="hljs-title">run</span><span class="hljs-params">((context) -&gt; &#123;</span></span><br><span class="hljs-params"><span class="hljs-function"></span></span><br><span class="hljs-params"><span class="hljs-function">        assertThat(context).hasSingleBean(MyService.<span class="hljs-keyword">class</span>);</span></span><br><span class="hljs-params"><span class="hljs-function"></span></span><br><span class="hljs-params"><span class="hljs-function">        assertThat(context.getBean(MyService.<span class="hljs-keyword">class</span>).getName()).isEqualTo(<span class="hljs-string">&quot;test123&quot;</span>);</span></span><br><span class="hljs-params"><span class="hljs-function"></span></span><br><span class="hljs-params"><span class="hljs-function">    &#125;)</span>;</span><br><span class="hljs-function"></span><br><span class="hljs-function">&#125;</span><br></code></pre></td></tr></table></figure><p>runner è¿˜å¯ç”¨äºå±•ç¤º <code>ConditionEvaluationReport</code>. æŠ¥å‘Šå¯ä»¥åœ¨ <code>INFO</code> æˆ– <code>DEBUG</code> çº§åˆ«ä¸‹æ‰“å°. ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºå¦‚ä½•ä½¿ç”¨ <code>ConditionEvaluationReportLoggingListener</code> åœ¨è‡ªåŠ¨é…ç½®æµ‹è¯•ä¸­æ‰“å°æŠ¥è¡¨.</p><p>Java</p><p>Kotlin</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs livescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyConditionEvaluationReportingTests</span> &#123;<br>    @Test    <span class="hljs-literal">void</span> autoConfigTest<span class="hljs-function"><span class="hljs-params">()</span> &#123;        <span class="hljs-title">new</span> <span class="hljs-title">ApplicationContextRunner</span><span class="hljs-params">()</span>            .<span class="hljs-title">withInitializer</span><span class="hljs-params">(ConditionEvaluationReportLoggingListener.forLogLevel(LogLevel.INFO))</span>            .<span class="hljs-title">run</span><span class="hljs-params">((context) -&gt; &#123;                    <span class="hljs-regexp">// Test something...            &#125;);    &#125;</span></span></span><br><span class="hljs-regexp"><span class="hljs-params"><span class="hljs-function">&#125;</span></span></span><br></code></pre></td></tr></table></figure><h4 id="9-4-1-æ¨¡æ‹Ÿä¸€ä¸ª-Web-ä¸Šä¸‹æ–‡"><a href="#9-4-1-æ¨¡æ‹Ÿä¸€ä¸ª-Web-ä¸Šä¸‹æ–‡" class="headerlink" title="9.4.1. æ¨¡æ‹Ÿä¸€ä¸ª Web ä¸Šä¸‹æ–‡"></a>9.4.1. æ¨¡æ‹Ÿä¸€ä¸ª Web ä¸Šä¸‹æ–‡</h4><p>å¦‚æœéœ€è¦æµ‹è¯•ä¸€ä¸ªä»…åœ¨ Servlet æˆ–å“åº”å¼ Web åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­è¿è¡Œçš„è‡ªåŠ¨é…ç½®, è¯·åˆ†åˆ«ä½¿ç”¨ <code>WebApplicationContextRunner</code> æˆ– <code>ReactiveWebApplicationContextRunner</code>.</p><h4 id="9-4-2-è¦†ç›–-Classpath"><a href="#9-4-2-è¦†ç›–-Classpath" class="headerlink" title="9.4.2. è¦†ç›– Classpath"></a>9.4.2. è¦†ç›– Classpath</h4><p>è¿˜å¯ä»¥æµ‹è¯•åœ¨è¿è¡Œæ—¶ä¸å­˜åœ¨ç‰¹å®šç±»å’Œ&#x2F;æˆ–åŒ…æ—¶å‘ç”Ÿçš„æƒ…å†µ. Spring Boot é™„å¸¦äº†ä¸€ä¸ªå¯ä»¥ç”±è·‘æ­¥è€…è½»æ¾ä½¿ç”¨çš„ <code>FilteredClassLoader</code>. åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­, æˆ‘ä»¬å£°æ˜å¦‚æœ <code>MyService</code> ä¸å­˜åœ¨, åˆ™ä¼šæ­£ç¡®ç¦ç”¨è‡ªåŠ¨é…ç½®:</p><p>Java</p><p>Kotlin</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs livescript">@Test<br><br><span class="hljs-literal">void</span> serviceIsIgnoredIfLibraryIsNotPresent() &#123;<br><br>    this.contextRunner.withClassLoader(<span class="hljs-keyword">new</span> FilteredClassLoader(MyService.<span class="hljs-keyword">class</span>))<br><br>            .run<span class="hljs-function"><span class="hljs-params">((context) -&gt; assertThat(context).doesNotHaveBean(<span class="hljs-string">&quot;myService&quot;</span>))</span>;</span><br><span class="hljs-function"></span><br><span class="hljs-function">&#125;</span><br></code></pre></td></tr></table></figure><h3 id="9-5-åˆ›å»ºè‡ªå·±çš„-Starter"><a href="#9-5-åˆ›å»ºè‡ªå·±çš„-Starter" class="headerlink" title="9.5. åˆ›å»ºè‡ªå·±çš„ Starter"></a>9.5. åˆ›å»ºè‡ªå·±çš„ Starter</h3><p>ä¸€ä¸ªå…¸å‹çš„ Spring Boot å¯åŠ¨å™¨åŒ…å«ç”¨äºè‡ªåŠ¨é…ç½®å’Œä½¿ç”¨çš„åŸºç¡€æŠ€æœ¯ç»“æ„çš„ä»£ç , æˆ‘ä»¬ç§°å…¶ä¸º â€œacmeâ€. ä¸ºäº†ä½¿å…¶æ˜“äºæ‰©å±•, å¯ä»¥å°†å‘½åç©ºé—´ä¸­çš„è®¸å¤šé…ç½®é¡¹æš´éœ²ç»™ç¯å¢ƒ.æœ€å, æä¾›äº†ä¸€ä¸ª â€œstarterâ€ ä¾èµ–, ä»¥å¸®åŠ©ç”¨æˆ·å°½å¯èƒ½è½»æ¾åœ°å…¥é—¨.</p><p>å…·ä½“è€Œè¨€, è‡ªå®šä¹‰å¯åŠ¨å™¨å¯ä»¥åŒ…å«ä»¥ä¸‹å†…å®¹:</p><ul><li><code>autoconfigure</code> æ¨¡å—, ä¸º â€œacmeâ€ åŒ…å«è‡ªåŠ¨é…ç½®ä»£ç .</li><li><code>starter</code> æ¨¡å—, å®ƒä¸º â€œacmeâ€ æä¾›å¯¹ <code>autoconfigure</code> æ¨¡å—ä¾èµ–ä»¥åŠç±»åº“å’Œå¸¸ç”¨çš„å…¶ä»–ä¾èµ–. ç®€è€Œè¨€ä¹‹, æ·»åŠ  starter åº”è¯¥æä¾›è¯¥åº“å¼€å§‹ä½¿ç”¨æ‰€éœ€çš„ä¸€åˆ‡ä¾èµ–.</li></ul><p>å®Œå…¨æ²¡æœ‰å¿…è¦å°†è¿™ä¸¤ä¸ªæ¨¡å—åˆ†å¼€.å¦‚æœ â€œacmeâ€ å…·æœ‰å¤šç§åŠŸèƒ½, é€‰é¡¹æˆ–å¯é€‰åŠŸèƒ½, åˆ™æœ€å¥½å°†è‡ªåŠ¨é…ç½®åˆ†å¼€, è¿™æ ·æ‚¨å¯ä»¥æ¸…æ¥šåœ°è¡¨ç¤ºæŸäº›åŠŸèƒ½æ˜¯å¯é€‰çš„.æ­¤å¤–, æ‚¨è¿˜å¯ä»¥åˆ¶ä½œä¸€ä¸ªå¯åŠ¨å™¨, ä»¥æä¾›æœ‰å…³å¯é€‰çš„ä¾èµ–. åŒæ—¶, å…¶ä»–äººåªèƒ½ä¾é  <code>autoconfigure</code> æ¨¡å—æ¥åˆ¶ä½œè‡ªå·±çš„å…·æœ‰ä¸åŒé€‰é¡¹çš„å¯åŠ¨å™¨.</p><p>å¦‚æœè‡ªåŠ¨é…ç½®ç›¸å¯¹ç®€å•å¹¶ä¸”ä¸å…·æœ‰å¯é€‰åŠŸèƒ½, åˆ™å°†ä¸¤ä¸ªæ¨¡å—åˆå¹¶åœ¨å¯åŠ¨å™¨ä¸­ç»å¯¹æ˜¯ä¸€ç§é€‰æ‹©.</p><h4 id="9-5-1-å‘½å"><a href="#9-5-1-å‘½å" class="headerlink" title="9.5.1. å‘½å"></a>9.5.1. å‘½å</h4><p>æ‚¨åº”è¯¥ç¡®ä¿ä¸ºæ‚¨çš„ starter æä¾›ä¸€ä¸ªåˆé€‚çš„å‘½åç©ºé—´. å³ä½¿æ‚¨ä½¿ç”¨å…¶ä»– Maven groupId, ä¹Ÿä¸è¦ä½¿ç”¨ <code>spring-boot</code> ä½œä¸ºæ¨¡å—åç§°çš„å¼€å¤´. æˆ‘ä»¬å¯èƒ½ä¼šä¸ºæ‚¨ä»¥åè‡ªåŠ¨é…ç½®çš„å†…å®¹æä¾›å®˜æ–¹æ”¯æŒ.</p><p>æ ¹æ®ç»éªŒ, æ‚¨åº”è¯¥åœ¨ starter åå‘½åä¸€ä¸ªç»„åˆæ¨¡å—. ä¾‹å¦‚, å‡è®¾æ‚¨æ­£åœ¨ä¸º acme åˆ›å»ºä¸€ä¸ª starter, å¹¶ä¸”æ‚¨å°†è‡ªåŠ¨é…ç½®æ¨¡å—å‘½åä¸º <code>acme-spring-boot</code>, å°† starter å‘½åä¸º <code>acme-spring-boot-starter</code>. å¦‚æœæ‚¨åªæœ‰ä¸€ä¸ªç»„åˆè¿™ä¸¤è€…çš„æ¨¡å—, è¯·å°†å…¶å‘½åä¸º <code>acme-spring-boot-starter</code>.</p><h4 id="9-5-2-é…ç½®-keys"><a href="#9-5-2-é…ç½®-keys" class="headerlink" title="9.5.2. é…ç½® keys"></a>9.5.2. é…ç½® keys</h4><p>æ­¤å¤–, å¦‚æœæ‚¨çš„ starter æä¾›é…ç½® key, è¯·ä¸ºå®ƒä»¬ä½¿ç”¨å”¯ä¸€çš„å‘½åç©ºé—´. å°¤å…¶æ˜¯, ä¸è¦å°†æ‚¨çš„ key åŒ…å«åœ¨ Spring Boot ä½¿ç”¨çš„å‘½åç©ºé—´ä¸­ (ä¾‹å¦‚ <code>server</code>ã€<code>management</code>ã€<code>spring</code> ç­‰) . å¦‚æœæ‚¨ä½¿ç”¨äº†ç›¸åŒçš„å‘½åç©ºé—´, æˆ‘ä»¬å°†æ¥å¯èƒ½ä¼šä»¥ç ´åæ‚¨çš„æ¨¡å—çš„æ–¹å¼æ¥ä¿®æ”¹è¿™äº›å‘½åç©ºé—´. æ ¹æ®ç»éªŒ, æ‰€æœ‰ key éƒ½å¿…é¡»æ‹¥æœ‰è‡ªå·±çš„å‘½åç©ºé—´ (ä¾‹å¦‚ <code>acme</code>) .</p><p>é€šè¿‡ä¸ºæ¯ä¸ªå±æ€§æ·»åŠ å­—æ®µ javadoc æ¥ç¡®ä¿è®°å½•äº†é…ç½® keys, å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><p>Java</p><p>Kotlin</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs axapta">@ConfigurationProperties(<span class="hljs-string">&quot;acme&quot;</span>)<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AcmeProperties</span> &#123;<br>    <span class="hljs-comment">/**     * Whether to check the location of acme resources.     */</span>    <span class="hljs-keyword">private</span> <span class="hljs-built_in">boolean</span> checkLocation = <span class="hljs-literal">true</span>;<br>    <span class="hljs-comment">/**     * Timeout for establishing a connection to the acme server.     */</span>    <span class="hljs-keyword">private</span> Duration loginTimeout = Duration.ofSeconds(<span class="hljs-number">3</span>);<br>    <span class="hljs-comment">// getters/setters ...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>æ‚¨ä»…åº”å°†ç®€å•æ–‡æœ¬ä¸ <code>@ConfigurationProperties</code> å­—æ®µ Javadoc ä¸€èµ·ä½¿ç”¨, å› ä¸ºåœ¨å°†å®ƒä»¬æ·»åŠ åˆ° JSON ä¹‹å‰ä¸ä¼šå¯¹å…¶è¿›è¡Œå¤„ç†.</p><p>è¿™æ˜¯æˆ‘ä»¬å†…éƒ¨éµå¾ªçš„ä¸€äº›è§„åˆ™, ä»¥ç¡®ä¿æè¿°ä¸€è‡´:</p><ul><li>è¯·å‹¿ä»¥ â€œTheâ€ æˆ– â€œAâ€ å¤´æè¿°.</li><li>å¯¹äºå¸ƒå°”ç±»å‹, è¯·ä» â€œWhetherâ€ æˆ– â€œEnableâ€ å¼€å§‹æè¿°.</li><li>å¯¹äºåŸºäºé›†åˆçš„ç±»å‹, è¯·ä»¥ â€œä»¥é€—å·åˆ†éš”çš„åˆ—è¡¨â€ å¼€å§‹æè¿°</li><li>ä½¿ç”¨ <code>java.time.Duration</code> è€Œä¸æ˜¯ <code>long</code>, å¦‚æœå®ƒä¸ç­‰äºæ¯«ç§’, è¯·è¯´æ˜é»˜è®¤å•ä½, ä¾‹å¦‚ â€œå¦‚æœæœªæŒ‡å®šæŒç»­æ—¶é—´åç¼€, åˆ™å°†ä½¿ç”¨ç§’â€.</li><li>é™¤éå¿…é¡»åœ¨è¿è¡Œæ—¶ç¡®å®šé»˜è®¤å€¼, å¦åˆ™è¯·ä¸è¦åœ¨æè¿°ä¸­æä¾›é»˜è®¤å€¼.</li></ul><p>ç¡®ä¿ <a href="https://sca.aliyun.com/learn/spring-boot/core/configuration-metadata.html#appendix.configuration-metadata.annotation-processor">è§¦å‘å…ƒæ•°æ®ç”Ÿæˆ</a> , ä»¥ä¾¿ä¸ºæ‚¨çš„ key æä¾› IDE å¸®åŠ©. . æ‚¨å¯èƒ½éœ€è¦æŸ¥çœ‹ç”Ÿæˆçš„å…ƒæ•°æ® (<code>META-INF/spring-configuration-metadata.json</code>) , ä»¥ç¡®ä¿æ‚¨çš„ key è®°å½•æ˜¯å¦æ­£ç¡®. åœ¨å…¼å®¹çš„ IDE ä¸­ä½¿ç”¨è‡ªå·±çš„ starter ä¹Ÿæ˜¯éªŒè¯å…ƒæ•°æ®è´¨é‡çš„å¥½ä¸»æ„.</p><h4 id="9-5-3-autoconfigure-æ¨¡å—"><a href="#9-5-3-autoconfigure-æ¨¡å—" class="headerlink" title="9.5.3. autoconfigure æ¨¡å—"></a>9.5.3. <code>autoconfigure</code> æ¨¡å—</h4><p><code>autoconfigure</code> æ¨¡å—åŒ…å«ç±»åº“å¼€å§‹ä½¿ç”¨æ‰€éœ€çš„æ‰€æœ‰å†…å®¹. å®ƒè¿˜å¯ä»¥åŒ…å«é…ç½® key å®šä¹‰ (ä¾‹å¦‚ <code>@ConfigurationProperties</code>) å’Œä»»ä½•å¯ç”¨äºè¿›ä¸€æ­¥è‡ªå®šä¹‰ç»„ä»¶åˆå§‹åŒ–æ–¹å¼çš„å›è°ƒæ¥å£.</p><p>æ‚¨åº”è¯¥å°†ç±»åº“çš„ä¾èµ–æ ‡è®°ä¸ºå¯é€‰, ä»¥ä¾¿æ‚¨å¯ä»¥æ›´è½»æ¾åœ°åœ¨é¡¹ç›®ä¸­åŒ…å« <code>autoconfigure</code> æ¨¡å—. å¦‚æœä»¥è¿™ç§æ–¹å¼æ‰§è¡Œ, åˆ™ä¸æä¾›ç±»åº“, é»˜è®¤æƒ…å†µä¸‹, Spring Boot å°†ä¼šé€€å‡º.</p><p>Spring Boot ä½¿ç”¨æ³¨è§£å¤„ç†å™¨æ¥æ”¶é›†å…ƒæ•°æ®æ–‡ä»¶ (<code>META-INF/spring-autoconfigure-metadata.properties</code>) ä¸­è‡ªåŠ¨é…ç½®çš„æ¡ä»¶.å¦‚æœè¯¥æ–‡ä»¶å­˜åœ¨, åˆ™ç”¨äºå¿«é€Ÿè¿‡æ»¤ä¸åŒ¹é…çš„è‡ªåŠ¨é…ç½®, ç¼©çŸ­å¯åŠ¨æ—¶é—´.</p><p>å½“ä½¿ç”¨ Maven æ„ä»¶ï¼Œå»ºè®®åœ¨åŒ…å«è‡ªåŠ¨é…ç½®çš„æ¨¡å—ä¸­æ·»åŠ ä»¥ä¸‹ä¾èµ–:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-autoconfigure-processor<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å¦‚æœæ‚¨ç›´æ¥åœ¨åº”ç”¨ç¨‹åºä¸­å®šä¹‰äº†è‡ªåŠ¨é…ç½®, è¯·ç¡®ä¿é…ç½® <code>spring-boot-maven-plugin</code>, ä»¥é˜²æ­¢ <code>repackage</code> ç›®æ ‡å°†ä¾èµ–æ·»åŠ åˆ° fat jar ä¸­:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">project</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>                <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">excludes</span>&gt;</span><br><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">exclude</span>&gt;</span><br><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-autoconfigure-processor<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">exclude</span>&gt;</span><br><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">excludes</span>&gt;</span><br><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ Gradle , åº”åœ¨ <code>annotationProcessor</code> é…ç½®ä¸­å£°æ˜ä¾èµ–, å¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs fsharp"><span class="hljs-keyword">dependencies</span> &#123;<br><br>    annotationProcessor <span class="hljs-string">&quot;org.springframework.boot:spring-boot-autoconfigure-processor&quot;</span><br><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="9-5-4-Starter-æ¨¡å—"><a href="#9-5-4-Starter-æ¨¡å—" class="headerlink" title="9.5.4. Starter æ¨¡å—"></a>9.5.4. Starter æ¨¡å—</h4><p>starter çœŸçš„æ˜¯ä¸€ä¸ªç©º jar. å®ƒçš„å”¯ä¸€ç›®çš„æ˜¯ä¸ºä½¿ç”¨ç±»åº“æä¾›å¿…è¦çš„ä¾èµ–. æ‚¨å¯ä»¥å°†å…¶è§†ä¸ºä½¿ç”¨ç±»åº“çš„ä¸€åˆ‡åŸºç¡€.</p><p>ä¸è¦å¯¹æ·»åŠ  starter çš„é¡¹ç›®æŠ±æœ‰å‡è®¾æƒ³æ³•. å¦‚æœæ‚¨è‡ªåŠ¨é…ç½®çš„åº“ç»å¸¸éœ€è¦å…¶ä»– starter, è¯·ä¸€å¹¶å£°æ˜å®ƒä»¬. å¦‚æœå¯é€‰ä¾èµ–çš„æ•°é‡å¾ˆå¤š, åˆ™æä¾›ä¸€ç»„é€‚å½“çš„é»˜è®¤ä¾èµ–å¯èƒ½å¾ˆéš¾, å› ä¸ºæ‚¨æœ¬åº”è¯¥é¿å…åŒ…å«å¯¹å¸¸ç”¨åº“çš„ä½¿ç”¨ä¸å¿…è¦çš„ä¾èµ–. æ¢è€Œè¨€ä¹‹, æ‚¨ä¸åº”è¯¥åŒ…å«å¯é€‰çš„ä¾èµ–.</p><p>æ— è®ºå“ªç§æ–¹å¼, æ‚¨çš„ starter å¿…é¡»ç›´æ¥æˆ–é—´æ¥å¼•ç”¨ Spring Boot çš„ core starter (<code>spring-boot-starter</code>) (å¦‚æœæ‚¨çš„ starter ä¾èµ–äºå¦ä¸€ä¸ª starter , åˆ™æ— éœ€æ·»åŠ å®ƒ) . å¦‚æœåªä½¿ç”¨è‡ªå®šä¹‰ starter åˆ›å»ºé¡¹ç›®, åˆ™ Spring Boot çš„æ ¸å¿ƒåŠŸèƒ½å°†é€šè¿‡ core starter æ¥å®ç°.</p><h2 id="10-Kotlin-æ”¯æŒ"><a href="#10-Kotlin-æ”¯æŒ" class="headerlink" title="10. Kotlin æ”¯æŒ"></a>10. Kotlin æ”¯æŒ</h2><p><a href="https://kotlinlang.org/">Kotlin</a> æ˜¯ä¸€ç§é’ˆå¯¹ JVM (å’Œå…¶ä»–å¹³å°) çš„é™æ€ç±»å‹è¯­è¨€, å®ƒå¯ç¼–å†™å‡ºç®€æ´è€Œä¼˜é›…çš„ä»£ç , åŒæ—¶æä¾›ä¸ä½¿ç”¨ Java ç¼–å†™çš„ç°æœ‰åº“çš„ <a href="https://kotlinlang.org/docs/reference/java-interop.html">äº’é€šæ€§</a>.</p><p>å¼€å§‹å­¦ä¹  Spring Boot å’Œ Kotlin æœ€ç®€å•æ–¹æ³•æ˜¯éµå¾ªè¿™ä¸ª <a href="https://spring.io/guides/tutorials/spring-boot-kotlin/">å…¨é¢æ•™ç¨‹</a>. æ‚¨å¯ä»¥é€šè¿‡ <a href="https://start.spring.io/#!language=kotlin">start.spring.io</a> åˆ›å»ºæ–°çš„ Kotlin é¡¹ç›®. å¦‚æœæ‚¨éœ€è¦æ”¯æŒ, è¯·å…è´¹åŠ å…¥ <a href="https://slack.kotlinlang.org/">Kotlin Slack</a> çš„ #spring é¢‘é“æˆ–ä½¿ç”¨ <a href="https://stackoverflow.com/questions/tagged/spring+kotlin">Stack Overflow</a> ä¸Šçš„ <code>spring</code> å’Œ <code>kotlin</code> æ ‡ç­¾æé—®.</p><h3 id="10-1-è¦æ±‚"><a href="#10-1-è¦æ±‚" class="headerlink" title="10.1. è¦æ±‚"></a>10.1. è¦æ±‚</h3><p>Spring Boot æ”¯æŒ Kotlin 1.7.x. è¦ä½¿ç”¨ Kotlin, classpath ä¸‹å¿…é¡»å­˜åœ¨ <code>org.jetbrains.kotlin:kotlin-stdlib</code> å’Œ <code>org.jetbrains.kotlin:kotlin-reflect</code>. ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>kotlin-stdlib</code> çš„å˜ä½“ <code>kotlin-stdlib-jdk7</code> å’Œ <code>kotlin-stdlib-jdk8</code>.</p><p>ç”±äº <a href="https://discuss.kotlinlang.org/t/classes-final-by-default/166">Kotlin ç±»é»˜è®¤ä¸º final</a>, å› æ­¤æ‚¨å¯èƒ½éœ€è¦é…ç½® <a href="https://kotlinlang.org/docs/reference/compiler-plugins.html#spring-support">kotlin-spring</a> æ’ä»¶ä»¥è‡ªåŠ¨æ‰“å¼€ <code>Spring-annotated</code> ç±», ä»¥ä¾¿å¯ä»¥ä»£ç†å®ƒä»¬.</p><p>åœ¨ Kotlin ä¸­åºåˆ—åŒ–&#x2F;ååºåˆ—åŒ– JSON æ•°æ®éœ€è¦ä½¿ç”¨ <a href="https://github.com/FasterXML/jackson-module-kotlin">Jackson çš„ Kotlin æ¨¡å—</a>. åœ¨ classpath ä¸­æ‰¾åˆ°å®ƒæ—¶ä¼šè‡ªåŠ¨æ³¨å†Œ. å¦‚æœ Jackson å’Œ Kotlin å­˜åœ¨ä½† Jackson Kotlin æ¨¡å—ä¸å­˜åœ¨, åˆ™ä¼šè®°å½•è­¦å‘Šæ¶ˆæ¯.</p><p>å¦‚æœåœ¨ <a href="https://start.spring.io/#!language=kotlin">start.spring.io</a> ä¸Šåˆ›å»º Kotlin é¡¹ç›®, åˆ™é»˜è®¤æä¾›è¿™äº›ä¾èµ–å’Œæ’ä»¶.</p><h3 id="10-2-Null-å®‰å…¨"><a href="#10-2-Null-å®‰å…¨" class="headerlink" title="10.2. Null å®‰å…¨"></a>10.2. Null å®‰å…¨</h3><p>Kotlin çš„ä¸€ä¸ªå…³é”®ç‰¹æ€§æ˜¯ <a href="https://kotlinlang.org/docs/reference/null-safety.html">null-safety</a>. å®ƒåœ¨ç¼–è¯‘æ—¶å¤„ç†ç©ºå€¼, è€Œä¸æ˜¯å°†é—®é¢˜æ¨è¿Ÿåˆ°è¿è¡Œæ—¶å¹¶é‡åˆ° <code>NullPointerException</code>. è¿™æœ‰åŠ©äºæ¶ˆé™¤å¸¸è§çš„é”™è¯¯æ¥æº, è€Œæ— éœ€æ”¯ä»˜åƒ <code>Optional</code> è¿™æ ·çš„åŒ…è£…å™¨çš„æˆæœ¬. Kotlin è¿˜å…è®¸ä½¿ç”¨æœ‰å¯ç©ºå€¼çš„, å¦‚ Kotlin <code>null</code> <a href="https://www.baeldung.com/kotlin-null-safety">å®‰å…¨ç»¼åˆæŒ‡å—ä¸­</a> æ‰€è¿°.</p><p>è™½ç„¶ Java ä¸å…è®¸åœ¨å…¶ç±»å‹ç³»ç»Ÿä¸­è¡¨ç¤º <code>null</code> å®‰å…¨, ä½† Spring Frameworkã€Spring Data å’Œ Reactor ç°åœ¨é€šè¿‡æ˜“äºä½¿ç”¨çš„å·¥å…·çš„æ³¨è§£æä¾›å…¶ API çš„å®‰å…¨æ€§. é»˜è®¤æƒ…å†µä¸‹, Kotlin ä¸­ä½¿ç”¨çš„ Java API ç±»å‹è¢«è¯†åˆ«ä¸ºæ”¾å®½ç©ºæ£€æŸ¥çš„ <a href="https://kotlinlang.org/docs/reference/java-interop.html#null-safety-and-platform-types">å¹³å°ç±»å‹</a>. Kotlin å¯¹ <a href="https://kotlinlang.org/docs/reference/java-interop.html#jsr-305-support">JSR 305 æ³¨è§£</a> çš„æ”¯æŒä¸å¯ç©ºæ³¨è§£ç›¸ç»“åˆ, ä¸º Kotlin ä¸­ Spring API ç›¸å…³çš„ä»£ç æä¾›äº†ç©ºå®‰å…¨.</p><p>å¯ä»¥é€šè¿‡ä½¿ç”¨ä»¥ä¸‹é€‰é¡¹æ·»åŠ  <code>-Xjsr305</code> ç¼–è¯‘å™¨æ ‡å¿—æ¥é…ç½® JSR 305 æ£€æŸ¥: <code>-Xjsr305=&#123;strict|warn|ignore&#125;</code>. é»˜è®¤è¡Œä¸ºä¸ <code>-Xjsr305=warn</code> ç›¸åŒ. åœ¨ä» Spring API æ¨æ–­å‡ºçš„ Kotlin ç±»å‹ä¸­éœ€è¦è€ƒè™‘ null å®‰å…¨çš„ <code>strict</code> å€¼, ä½†æ˜¯åº”è¯¥ä½¿ç”¨ Spring API å¯ç©ºå£°æ˜ç”šè‡³å¯ä»¥åœ¨æ¬¡è¦ç‰ˆæœ¬ä¹‹é—´å‘å±•å¹¶ä¸”å°†æ¥å¯èƒ½æ·»åŠ æ›´å¤šæ£€æŸ¥çš„æ–¹æ¡ˆ.</p><p>å°šä¸æ”¯æŒæ³›å‹ç±»å‹å‚æ•°ã€varargs å’Œæ•°ç»„å…ƒç´ å¯ç©ºæ€§. æœ‰å…³æœ€æ–°ä¿¡æ¯, è¯·å‚è§ <a href="https://jira.spring.io/browse/SPR-15942">SPR-15942</a>. å¦è¯·æ³¨æ„, Spring Boot è‡ªå·±çš„ API <a href="https://github.com/spring-projects/spring-boot/issues/10712">å°šæœªæ³¨è§£</a>.</p><h3 id="10-3-Kotlin-API"><a href="#10-3-Kotlin-API" class="headerlink" title="10.3. Kotlin API"></a>10.3. Kotlin API</h3><h4 id="10-3-1-runApplication"><a href="#10-3-1-runApplication" class="headerlink" title="10.3.1. runApplication"></a>10.3.1. runApplication</h4><p>Spring Boot æä¾›äº†ä½¿ç”¨ <code>runApplication&lt;MyApplication&gt;(*args)</code> è¿è¡Œåº”ç”¨ç¨‹åºçš„æƒ¯ç”¨æ–¹æ³•, å¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@SpringBootApplicationclass</span> MyApplication<br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">(args: <span class="hljs-type">Array</span>&lt;<span class="hljs-type">String</span>&gt;)</span></span> &#123;    runApplication&lt;MyApplication&gt;(*args)&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ˜¯ <code>SpringApplication.run(MyApplication::class.java, *args)</code> çš„æ›¿ä»£æ–¹å¼. å®ƒè¿˜å…è®¸è‡ªå®šä¹‰åº”ç”¨ç¨‹åº, å¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs scss">runApplication&lt;MyApplication&gt;(*args) &#123;<br><br>    <span class="hljs-built_in">setBannerMode</span>(OFF)<br><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="10-3-2-æ‰©å±•"><a href="#10-3-2-æ‰©å±•" class="headerlink" title="10.3.2. æ‰©å±•"></a>10.3.2. æ‰©å±•</h4><p>Kotlin <a href="https://kotlinlang.org/docs/reference/extensions.html">æ‰©å±•</a> æä¾›äº†ä½¿ç”¨é™„åŠ åŠŸèƒ½æ‰©å±•ç°æœ‰ç±»çš„èƒ½åŠ›. Spring Boot Kotlin API åˆ©ç”¨è¿™äº›æ‰©å±•ä¸ºç°æœ‰ API æ·»åŠ æ–°çš„ Kotlin ç‰¹å®šä¾¿åˆ©.</p><p>æä¾›çš„ <code>TestRestTemplate</code> æ‰©å±•ç±»ä¼¼äº Spring Framework ä¸º <code>RestOperations</code> æä¾›çš„. é™¤æ­¤ä¹‹å¤–, æ‰©å±•ä½¿å¾—åˆ©ç”¨ Kotlin reified ç±»å‹å‚æ•°å˜ä¸ºå¯èƒ½.</p><h3 id="10-4-ä¾èµ–ç®¡ç†"><a href="#10-4-ä¾èµ–ç®¡ç†" class="headerlink" title="10.4. ä¾èµ–ç®¡ç†"></a>10.4. ä¾èµ–ç®¡ç†</h3><p>ä¸ºäº†é¿å…åœ¨ classpath ä¸Šæ··åˆä¸åŒç‰ˆæœ¬çš„ Kotlin ä¾èµ–, Spring Boot ä¼šå¯¼å…¥ Kotlin BOM.</p><p>ä½¿ç”¨ Maven, å¯ä»¥é€šè¿‡ <code>kotlin.version</code> å±æ€§è‡ªå®šä¹‰ Kotlin ç‰ˆæœ¬, å¹¶ä¸”ä¸º <code>kotlin-maven-plugin</code> æä¾›äº†æ’ä»¶ç®¡ç†. ä½¿ç”¨ Gradle, Spring Boot æ’ä»¶ä¼šè‡ªåŠ¨å°† <code>kotlin.version</code> ä¸ Kotlin æ’ä»¶çš„ç‰ˆæœ¬ä¿ä¸€è‡´.</p><p>Spring Boot è¿˜é€šè¿‡å¯¼å…¥ Kotlin Coroutines BOM ç®¡ç† Coroutines ä¾èµ–çš„ç‰ˆæœ¬. å¯ä»¥é€šè¿‡ <code>kotlin-coroutines.version</code> å±æ€§è‡ªå®šä¹‰ç‰ˆæœ¬.</p><p>å¦‚æœåœ¨ <a href="https://start.spring.io/#!language=kotlin">start.spring.io</a> ä¸Šæ„å»ºçš„ Kotlin é¡¹ç›®æœ‰è‡³å°‘ä¸€ä¸ªå“åº”å¼ä¾èµ–, åˆ™é»˜è®¤æä¾› <code>org.jetbrains.kotlinx:kotlinx-coroutines-reactor</code> ä¾èµ–.</p><h3 id="10-5-ConfigurationProperties"><a href="#10-5-ConfigurationProperties" class="headerlink" title="10.5. @ConfigurationProperties"></a>10.5. @ConfigurationProperties</h3><p><code>@ConfigurationProperties</code> ä¸ <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.external-config.typesafe-configuration-properties.constructor-binding"><code>@ConstructorBinding</code></a> ç»“åˆä½¿ç”¨æ—¶, <code>@ConfigurationProperties</code> æ”¯æŒå…·æœ‰ä¸å˜ <code>val</code> å±æ€§çš„ç±», å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">@ConfigurationProperties(<span class="hljs-string">&quot;example.kotlin&quot;</span>)data <span class="hljs-keyword">class</span> <span class="hljs-symbol">KotlinExampleProperties</span>(        <span class="hljs-symbol">val</span> <span class="hljs-symbol">name: <span class="hljs-symbol">String</span>,        <span class="hljs-symbol">val</span></span> <span class="hljs-symbol">description: <span class="hljs-symbol">String</span>,        <span class="hljs-symbol">val</span></span> <span class="hljs-symbol">myService: <span class="hljs-symbol">MyService</span></span>) &#123;<br>    data <span class="hljs-keyword">class</span> <span class="hljs-symbol">MyService</span>(            <span class="hljs-symbol">val</span> <span class="hljs-symbol">apiToken: <span class="hljs-symbol">String</span>,            <span class="hljs-symbol">val</span></span> <span class="hljs-symbol">uri: <span class="hljs-symbol">URI</span></span>    )&#125;<br></code></pre></td></tr></table></figure><p>ä¸ºäº†ä½¿ç”¨æ³¨è§£å¤„ç†å™¨ <a href="https://sca.aliyun.com/learn/spring-boot/core/configuration-metadata.html#appendix.configuration-metadata.annotation-processor">ç”Ÿæˆè‡ªå·±çš„å…ƒæ•°æ®</a> , åº”è¯¥ä½¿ç”¨ <code>spring-boot-configuration-processor</code> ä¾èµ–é…ç½® <a href="https://kotlinlang.org/docs/reference/kapt.html"><code>kapt</code></a> . è¯·æ³¨æ„, ç”±äº kapt æä¾›çš„æ¨¡å‹çš„é™åˆ¶, æŸäº›åŠŸèƒ½ (ä¾‹å¦‚æ£€æµ‹é»˜è®¤å€¼æˆ–ä¸æ¨èä½¿ç”¨çš„é¡¹ç›®) æ— æ³•æ­£å¸¸å·¥ä½œ.</p><h3 id="10-6-æµ‹è¯•"><a href="#10-6-æµ‹è¯•" class="headerlink" title="10.6. æµ‹è¯•"></a>10.6. æµ‹è¯•</h3><p>è™½ç„¶å¯ä»¥ä½¿ç”¨ JUnit 4 æ¥æµ‹è¯• Kotlin ä»£ç , ä½†å»ºè®®ä½¿ç”¨ JUnit 5. JUnit 5 å…è®¸æµ‹è¯•ç±»å®ä¾‹åŒ–ä¸€æ¬¡, å¹¶åœ¨æ‰€æœ‰ç±»çš„æµ‹è¯•ä¸­å¤ç”¨. è¿™ä½¿å¾—å¯ä»¥åœ¨éé™æ€æ–¹æ³•ä¸Šä½¿ç”¨ <code>@BeforeAll</code> å’Œ <code>@AfterAll</code> æ³¨è§£, è¿™éå¸¸é€‚åˆ Kotlin.</p><p>è¦æ¨¡æ‹Ÿ Kotlin ç±», å»ºè®®ä½¿ç”¨ MockK. å¦‚æœæ‚¨éœ€è¦ä¸ Mockito ç‰¹å®šçš„ <a href="https://sca.aliyun.com/learn/spring-boot/core/?spm=5176.29160081.0.0.6fd93d07hNfjnl&source=learn#features.testing.spring-boot-applications.mocking-beans"><code>@MockBean</code> å’Œ <code>@SpyBean</code> æ³¨è§£</a> ç›¸å¯¹åº”çš„ Mockk, åˆ™å¯ä»¥ä½¿ç”¨ SpringMockK, å®ƒæä¾›ç±»ä¼¼çš„ <code>@MockkBean</code> å’Œ <code>@SpykBean</code> æ³¨è§£.</p><h3 id="10-7-èµ„æº"><a href="#10-7-èµ„æº" class="headerlink" title="10.7. èµ„æº"></a>10.7. èµ„æº</h3><h4 id="10-7-1-è¿›é˜¶é˜…è¯»"><a href="#10-7-1-è¿›é˜¶é˜…è¯»" class="headerlink" title="10.7.1. è¿›é˜¶é˜…è¯»"></a>10.7.1. è¿›é˜¶é˜…è¯»</h4><ul><li><a href="https://kotlinlang.org/docs/reference/">Kotlin è¯­è¨€å‚è€ƒ</a></li><li><a href="https://kotlinlang.slack.com/">Kotlin Slack</a> (æœ‰ä¸“ç”¨çš„ #spring é¢‘é“)</li><li><a href="https://stackoverflow.com/questions/tagged/spring+kotlin">Stackoverflow ä¸Š <code>spring</code> å’Œ <code>kotlin</code> æ ‡ç­¾</a></li><li><a href="https://try.kotlinlang.org/">åœ¨æµè§ˆå™¨ä¸­å°è¯• Kotlin</a></li><li><a href="https://blog.jetbrains.com/kotlin/">Kotlin åšå®¢</a></li><li><a href="https://kotlin.link/">Awesome Kotlin</a></li><li><a href="https://spring.io/guides/tutorials/spring-boot-kotlin/">æ•™ç¨‹: ä½¿ç”¨ Spring Boot å’Œ Kotlin æ„å»º Web åº”ç”¨ç¨‹åº</a></li><li><a href="https://spring.io/blog/2016/02/15/developing-spring-boot-applications-with-kotlin">ä½¿ç”¨ Kotlin å¼€å‘ Spring Boot åº”ç”¨ç¨‹åº</a></li><li><a href="https://spring.io/blog/2016/03/20/a-geospatial-messenger-with-kotlin-spring-boot-and-postgresql">ä½¿ç”¨ Kotlinã€Spring Boot å’Œ PostgreSQL å¼€å‘åœ°ç†ä¿¡æ¯</a></li><li><a href="https://spring.io/blog/2017/01/04/introducing-kotlin-support-in-spring-framework-5-0">åœ¨ Spring Framework 5.0 ä¸­å¼•å…¥ Kotlin æ”¯æŒ</a></li><li><a href="https://spring.io/blog/2017/08/01/spring-framework-5-kotlin-apis-the-functional-way">Spring Framework 5 Kotlin API å®ç°å‡½æ•°å¼</a></li></ul><h4 id="10-7-2-ç¤ºä¾‹"><a href="#10-7-2-ç¤ºä¾‹" class="headerlink" title="10.7.2. ç¤ºä¾‹"></a>10.7.2. ç¤ºä¾‹</h4><ul><li><a href="https://github.com/sdeleuze/spring-boot-kotlin-demo">spring-boot-kotlin-demo</a>: regular Spring Boot + Spring Data JPA project</li><li><a href="https://github.com/mixitconf/mixit">mixit</a>: Spring Boot 2 + WebFlux + Reactive Spring Data MongoDB</li><li><a href="https://github.com/sdeleuze/spring-kotlin-fullstack">spring-kotlin-fullstack</a>: WebFlux Kotlin fullstack example with Kotlin2js for frontend instead of JavaScript or TypeScript</li><li><a href="https://github.com/spring-petclinic/spring-petclinic-kotlin">spring-petclinic-kotlin</a>: Kotlin version of the Spring PetClinic Sample Application</li><li><a href="https://github.com/sdeleuze/spring-kotlin-deepdive">spring-kotlin-deepdive</a>: a step by step migration for Boot 1.0 + Java to Boot 2.0 + Kotlin</li><li><a href="https://github.com/sdeleuze/spring-boot-coroutines-demo">spring-boot-coroutines-demo</a>: Coroutines sample project</li></ul><h2 id="11-ä¸‹ä¸€æ­¥"><a href="#11-ä¸‹ä¸€æ­¥" class="headerlink" title="11. ä¸‹ä¸€æ­¥"></a>11. ä¸‹ä¸€æ­¥</h2><p>å¦‚æœæ‚¨æƒ³äº†è§£æœ¬èŠ‚ä¸­è®¨è®ºçš„ä»»ä½•ç±»ç›®çš„æ›´å¤šä¿¡æ¯, å¯ä»¥æŸ¥çœ‹ <a href="https://docs.spring.io/spring-boot/docs/3.0.0/api">Spring Boot API æ–‡æ¡£</a> , ä¹Ÿå¯ä»¥ç›´æ¥æµè§ˆ <a href="https://github.com/spring-projects/spring-boot/tree/main">æºä»£ç </a> . å¦‚æœæ‚¨æœ‰å…·ä½“é—®é¢˜, è¯·æŸ¥çœ‹ <a href="https://sca.aliyun.com/learn/spring-boot/core/howto.html#howto">how-to</a> éƒ¨åˆ†.</p><p>å¦‚æœæ‚¨å¯¹ Spring Boot çš„æ ¸å¿ƒåŠŸèƒ½æ„Ÿåˆ°æ»¡æ„, å¯ä»¥ç»§ç»­é˜…è¯»æœ‰å…³ t <a href="https://sca.aliyun.com/learn/spring-boot/core/actuator.html#actuator">ç”Ÿäº§å°±ç»ªåŠŸèƒ½</a> çš„å†…å®¹.</p><blockquote><p>Copyright Â© 2002 - 2024 VMware, Inc. All Rights Reserved.</p></blockquote><blockquote><p>Copies of this document may be made for your own use and for distribution to others, provided that you do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically.</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>Spring æ•™ç¨‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Spring</tag>
      
      <tag>SpringBoot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¼“å­˜</title>
    <link href="/post/eb33628b-f904-43e4-a665-86de378af284/"/>
    <url>/post/eb33628b-f904-43e4-a665-86de378af284/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¼“å­˜"><a href="#ç¼“å­˜" class="headerlink" title="ç¼“å­˜"></a>ç¼“å­˜</h1><p>Spring æ•™ç¨‹</p><hr><h2 id="5-ç¼“å­˜æŠ½è±¡"><a href="#5-ç¼“å­˜æŠ½è±¡" class="headerlink" title="5. ç¼“å­˜æŠ½è±¡"></a>5. ç¼“å­˜æŠ½è±¡</h2><p>ä»3.1ç‰ˆæœ¬å¼€å§‹,Springæ¡†æ¶ä¸ºåœ¨ç°æœ‰çš„Springåº”ç”¨ç¨‹åºé€æ˜åœ°æ·»åŠ ç¼“å­˜æä¾›äº†æ”¯æŒã€‚ ä¸<a href="https://sca.aliyun.com/learn/spring/integration/cache/data-access.html#transaction">äº‹åŠ¡</a>æ”¯æŒç±»ä¼¼ï¼Œç¼“å­˜æŠ½è±¡å…è®¸ä¸€è‡´åœ°ä½¿ç”¨å„ç§ç¼“å­˜è§£å†³æ–¹æ¡ˆï¼Œè€Œå¯¹ä»£ç çš„å½±å“æœ€å°ã€‚</p><p>ä»Spring 4.1å¼€å§‹ï¼Œé€šè¿‡<a href="https://sca.aliyun.com/learn/spring/integration/cache/?spm=0.29160081.0.0.51f92e5dCHrGI4#cache-jsr-107">JSR-107æ³¨è§£</a>å’Œæ›´å¤šè‡ªå®šä¹‰é€‰é¡¹çš„æ”¯æŒï¼Œç¼“å­˜æŠ½è±¡å¾—åˆ°äº†æ˜¾ç€æ”¹è¿›ã€‚</p><h3 id="5-1-äº†è§£ç¼“å­˜æŠ½è±¡"><a href="#5-1-äº†è§£ç¼“å­˜æŠ½è±¡" class="headerlink" title="5.1. äº†è§£ç¼“å­˜æŠ½è±¡"></a>5.1. äº†è§£ç¼“å­˜æŠ½è±¡</h3><p>Cache vs Buffer</p><p>æœ¯è¯­â€œbufferâ€ å’Œ â€œcache,â€å€¾å‘äºå¯äº’æ¢ä½¿ç”¨ã€‚ ä½†è¯·æ³¨æ„ï¼Œå®ƒä»¬ä»£è¡¨ä¸åŒçš„ä¸œè¥¿ã€‚ ç¼“å†²åŒºé€šå¸¸ç”¨ä½œå¿«é€Ÿå’Œæ…¢é€Ÿå®ä½“ä¹‹é—´çš„æ•°æ®çš„ä¸­é—´ä¸´æ—¶å­˜å‚¨åŒºã€‚ç”±äºä¸€æ–¹å¿…é¡»ç­‰å¾…å¦ä¸€ä¸ªå½±å“æ€§èƒ½çš„å› ç´ ï¼Œ å› æ­¤ç¼“å†²åŒºä¼šé€šè¿‡å…è®¸æ•´ä¸ªæ•°æ®å—åŒæ—¶ç§»åŠ¨ï¼Œ è€Œä¸æ˜¯ä¸€å°å—æ¥ç¼“è§£è¿™ä¸€é—®é¢˜ã€‚æ•°æ®åªåœ¨ç¼“å†²åŒºä¸­å†™å…¥å’Œè¯»å–ä¸€æ¬¡ã€‚æ­¤å¤–ï¼Œ ç¼“å†²åŒºè‡³å°‘å¯¹çŸ¥é“å®ƒçš„ä¸€æ–¹æ˜¯å¯è§çš„ã€‚</p><p>å¦ä¸€æ–¹é¢ï¼Œç†è®ºä¸Šçš„ç¼“å­˜æ˜¯éšè—çš„ï¼Œä»»ä½•ä¸€æ–¹éƒ½ä¸çŸ¥é“ç¼“å­˜æ˜¯å¦å‘ç”Ÿã€‚å®ƒè¿˜å¯ä»¥æé«˜æ€§èƒ½ï¼Œè€Œä¸”ç›¸åŒçš„æ•°æ®å¯ä»¥å¿«é€Ÿè¯»å–å¤šæ¬¡ã€‚</p><p>å¯¹ä¸¤è€…æ›´å¤šçš„è§£é‡Šæ˜¯åœ¨<a href="https://en.wikipedia.org/wiki/Cache_(computing)#The_difference_between_buffer_and_cache">here</a> .</p><p>ç¼“å­˜æŠ½è±¡çš„æ ¸å¿ƒæ˜¯å°†ç¼“å­˜åº”ç”¨äºJavaæ–¹æ³•ï¼Œä»è€Œæ ¹æ®ç¼“å­˜ä¸­å¯ç”¨çš„ä¿¡æ¯å‡å°‘æ‰§è¡Œæ¬¡æ•°ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯æ¬¡è°ƒç”¨ç›®æ ‡æ–¹æ³•æ—¶ï¼ŒæŠ½è±¡éƒ½ä¼šåº”ç”¨ä¸€ç§ç¼“å­˜è¡Œä¸ºï¼Œè¯¥è¡Œä¸ºæ£€æŸ¥è¯¥æ–¹æ³•æ˜¯å¦å·²é’ˆå¯¹ç»™å®šå‚æ•°æ‰§è¡Œã€‚ å¦‚æœå·²æ‰§è¡Œï¼Œåˆ™è¿”å›ç¼“å­˜çš„ç»“æœï¼Œè€Œä¸å¿…æ‰§è¡Œå®é™…æ–¹æ³•ã€‚ å¦‚æœè¯¥æ–¹æ³•å°šæœªæ‰§è¡Œï¼Œåˆ™æ‰§è¡Œè¯¥æ–¹æ³•ï¼Œå¹¶å°†ç»“æœç¼“å­˜å¹¶è¿”å›ç»™ç”¨æˆ·ï¼Œä»¥ä¾¿ä¸‹æ¬¡è°ƒç”¨è¯¥æ–¹æ³•æ—¶ï¼Œè¿”å›ç¼“å­˜çš„ç»“æœã€‚ è¿™æ ·ï¼Œå¯¹äºç»™å®šçš„ä¸€ç»„å‚æ•°ï¼Œæ˜‚è´µçš„æ–¹æ³•ï¼ˆæ— è®ºæ˜¯CPUè¿˜æ˜¯IOï¼‰åªèƒ½æ‰§è¡Œä¸€æ¬¡ï¼Œå¹¶ä¸”é‡ç”¨ç»“æœè€Œä¸å¿…å†æ¬¡å®é™…æ‰§è¡Œè¯¥æ–¹æ³•ã€‚ ç¼“å­˜é€»è¾‘æ˜¯é€æ˜åº”ç”¨çš„ï¼Œä¸ä¼šå¯¹è°ƒç”¨è€…é€ æˆä»»ä½•å¹²æ‰°ã€‚</p><p>æ­¤æ–¹æ³•ä»…é€‚ç”¨äºä¿è¯ä¸ºç»™å®šè¾“å…¥ï¼ˆæˆ–å‚æ•°ï¼‰è¿”å›ç›¸åŒè¾“å‡ºï¼ˆç»“æœï¼‰çš„æ–¹æ³•ï¼Œæ— è®ºå®ƒæ‰§è¡Œå¤šå°‘æ¬¡ã€‚</p><p>å…¶ä»–ä¸ç¼“å­˜ç›¸å…³çš„æ“ä½œç”±æŠ½è±¡æä¾›ï¼Œå¦‚æ›´æ–°ç¼“å­˜å†…å®¹çš„èƒ½åŠ›æˆ–åˆ é™¤æ‰€æœ‰æ¡ç›®ä¸­çš„ä¸€ä¸ªã€‚å¦‚æœç¼“å­˜å¤„ç†åœ¨åº”ç”¨ç¨‹åºè¿‡ç¨‹ä¸­å¯ä»¥æ›´æ”¹çš„æ•°æ®ï¼Œè¿™äº›éƒ½æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚</p><p>å°±åƒSpringæ¡†æ¶ä¸­çš„å…¶ä»–æœåŠ¡ä¸€æ ·ï¼Œç¼“å­˜æœåŠ¡æ˜¯æŠ½è±¡(ä¸æ˜¯ç¼“å­˜å®ç°)ï¼Œéœ€è¦ä½¿ç”¨å®é™…å­˜å‚¨æ¥å­˜å‚¨ç¼“å­˜æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒæŠ½è±¡ä½¿å¼€å‘äººå‘˜ä¸å¿…ç¼–å†™ç¼“å­˜é€»è¾‘ï¼Œä½†ä¸æä¾›å®é™…çš„å­˜å‚¨ã€‚æ­¤æŠ½è±¡ç”±<code>org.springframework.cache.Cache</code>å’Œ<code>org.springframework.cache.CacheManager</code>æ¥å£å…·ä½“åŒ–ã€‚</p><p>Springæä¾›äº†ä¸€äº›æŠ½è±¡å®ç°ï¼šåŸºäºJDK <code>java.util.concurrent.ConcurrentMap</code>çš„ç¼“å­˜ï¼Œ<a href="http://ehcache.org/">Ehcache 2.x</a>ï¼ŒGemfireç¼“å­˜ï¼Œ<a href="https://github.com/ben-manes/caffeine/wiki">Caffeine</a>å’Œç¬¦åˆJSR-107çš„ç¼“å­˜ï¼ˆä¾‹å¦‚Ehcache 3.xï¼‰ã€‚ æœ‰å…³æ’å…¥å…¶ä»–ç¼“å­˜å­˜å‚¨å’Œæä¾›ç¨‹åºçš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/integration/cache/?spm=0.29160081.0.0.51f92e5dCHrGI4#cache-plug">ä¸åŒçš„åç«¯ç¼“å­˜</a>ã€‚</p><p>ç¼“å­˜æŠ½è±¡æ²¡æœ‰é’ˆå¯¹å¤šçº¿ç¨‹å’Œå¤šè¿›ç¨‹ç¯å¢ƒçš„ç‰¹æ®Šå¤„ç†ï¼Œå› ä¸ºè¿™äº›åŠŸèƒ½ç”±ç¼“å­˜å®ç°å¤„ç†ã€‚</p><p>å¦‚æœæ‚¨å…·æœ‰å¤šè¿›ç¨‹ç¯å¢ƒï¼ˆå³ï¼Œéƒ¨ç½²åœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šçš„åº”ç”¨ç¨‹åºï¼‰ï¼Œåˆ™éœ€è¦ç›¸åº”åœ°é…ç½®ç¼“å­˜æä¾›ç¨‹åºã€‚ æ ¹æ®æ‚¨çš„ä½¿ç”¨æƒ…å†µï¼Œå‡ ä¸ªèŠ‚ç‚¹ä¸Šçš„ç›¸åŒæ•°æ®çš„å‰¯æœ¬å°±è¶³å¤Ÿäº†ã€‚ ä½†æ˜¯ï¼Œå¦‚æœåœ¨åº”ç”¨ç¨‹åºè¿‡ç¨‹ä¸­æ›´æ”¹æ•°æ®ï¼Œåˆ™å¯èƒ½éœ€è¦å¯ç”¨å…¶ä»–ä¼ æ’­æœºåˆ¶ã€‚</p><p>åœ¨ä»£ç ä¸­ç›´æ¥æ·»åŠ ç¼“å­˜çš„ç»å…¸æµç¨‹æœ‰ get-if-not-found-then-proceed-and-put-eventually è¿™é‡Œæ²¡æœ‰ç”¨åˆ°é”ã€‚åŒæ—¶å…è®¸å¤šçº¿ç¨‹åŒæ­¥æ—¶åŠ è½½åŒä¸€ä¸ªç¼“å­˜ã€‚åŒæ ·å¯¹äºå›æ”¶ç¼“å­˜ä¹Ÿæ˜¯ç›¸ä¼¼ã€‚ä½†å¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹è¯•å›¾æ›´æ–°æˆ–è€…å›æ”¶æ•°æ®çš„è¯ï¼Œå¯èƒ½ä¼šç”¨åˆ°æ—§æ•°æ®ã€‚æŸäº›ç¼“å­˜ä¸ºç¨‹åºä¸ºè¯¥åŒºåŸŸçš„æ“ä½œæä¾›äº†é«˜çº§åŠŸèƒ½ï¼Œè¯·å‚é˜…æ‚¨æ­£åœ¨ä½¿ç”¨çš„ç¼“å­˜æä¾›ç¨‹åºçš„æ–‡æ¡£ä»¥è·å–è¯¦ç»†ä¿¡æ¯ã€‚</p><p>è¦ä½¿ç”¨ç¼“å­˜æŠ½è±¡ï¼Œæ‚¨éœ€è¦æ³¨æ„ä¸¤ä¸ªæ–¹é¢ï¼š</p><ul><li>ç¼“å­˜å£°æ˜ï¼šç¡®å®šéœ€è¦ç¼“å­˜çš„æ–¹æ³•åŠå…¶ç­–ç•¥ã€‚</li><li>ç¼“å­˜é…ç½®ï¼šå­˜å‚¨æ•°æ®å¹¶ä»ä¸­è¯»å–æ•°æ®çš„åç«¯ç¼“å­˜ã€‚</li></ul><h3 id="5-2-åŸºäºæ³¨è§£å£°æ˜ç¼“å­˜"><a href="#5-2-åŸºäºæ³¨è§£å£°æ˜ç¼“å­˜" class="headerlink" title="5.2. åŸºäºæ³¨è§£å£°æ˜ç¼“å­˜"></a>5.2. åŸºäºæ³¨è§£å£°æ˜ç¼“å­˜</h3><p>å¯¹äºç¼“å­˜å£°æ˜ï¼ŒSpringçš„ç¼“å­˜æŠ½è±¡æä¾›äº†ä¸€ç»„Javaæ³¨è§£ï¼š</p><ul><li><code>@Cacheable</code>: è§¦å‘ç¼“å­˜å‚¨å­˜</li><li><code>@CacheEvict</code>: è§¦å‘ç¼“å­˜å›æ”¶</li><li><code>@CachePut</code>: åœ¨ä¸å½±å“æ–¹æ³•æ‰§è¡Œçš„æƒ…å†µä¸‹æ›´æ–°ç¼“å­˜</li><li><code>@Caching</code>: é‡æ–°åœ¨æ–¹æ³•ä¸Šåº”ç”¨å¤šä¸ªç¼“å­˜æ“ä½œ</li><li><code>@CacheConfig</code>: åœ¨ç±»çº§åˆ«å…±äº«ä¸ç¼“å­˜æœ‰å…³çš„å¸¸è§è®¾ç½®</li></ul><h4 id="5-2-1-Cacheable-æ³¨è§£"><a href="#5-2-1-Cacheable-æ³¨è§£" class="headerlink" title="5.2.1. @Cacheable æ³¨è§£"></a>5.2.1. <code>@Cacheable</code> æ³¨è§£</h4><p>é¡¾åæ€ä¹‰ï¼Œ<code>@Cacheable</code> ç”¨äºæ ‡å®šå¯ç¼“å­˜çš„æ–¹æ³• ï¼Œ å³å°†ç»“æœå­˜å‚¨åˆ°ç¼“å­˜ä¸­çš„æ–¹æ³•ï¼Œä»¥ä¾¿åœ¨åç»­è°ƒç”¨ä¸­(ä½¿ç”¨ç›¸åŒçš„å‚æ•°)ï¼Œç¼“å­˜çš„å€¼å¯ä»¥åœ¨ä¸æ‰§è¡Œæ–¹æ³•çš„æƒ…å†µä¸‹è¿”å›ã€‚æœ€ç®€å•çš„ï¼Œæ³¨è§£å£°æ˜è¦æ±‚å¸¦æ³¨è§£çš„æ–¹æ³•å…³è”ç¼“å­˜çš„åç§°ã€‚å¦‚ä¸‹:</p><figure class="highlight nim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nim">@<span class="hljs-type">Cacheable</span>(<span class="hljs-string">&quot;books&quot;</span>)<br><br>public <span class="hljs-type">Book</span> findBook(<span class="hljs-type">ISBN</span> isbn) <span class="hljs-meta">&#123;...&#125;</span><br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä»£ç æ®µä¸­ï¼Œæ–¹æ³•<code>findBook</code>ä¸åä¸º<code>books</code>çš„ç¼“å­˜å…³è”ã€‚æ¯æ¬¡è°ƒç”¨è¯¥æ–¹æ³•æ—¶ï¼Œéƒ½ä¼šæ£€æŸ¥ç¼“å­˜ä»¥æŸ¥çœ‹æ˜¯å¦å·²ç»æ‰§è¡Œäº†è°ƒç”¨ï¼Œå¹¶ä¸”ä¸ä¼šé‡å¤ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåªæœ‰ä¸€ä¸ªç¼“å­˜è¢«å£°æ˜ï¼Œæ³¨è§£å…è®¸æŒ‡å®šå¤šä¸ªåç§°ï¼Œä»¥ä¾¿ä½¿ç”¨ä¸€ä¸ªä»¥ä¸Šçš„ç¼“å­˜ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåœ¨æ‰§è¡Œæ–¹æ³•ä¹‹å‰å°†æ£€æŸ¥æ¯ä¸ªç¼“å­˜ï¼Œå¦‚æœè‡³å°‘å‘½ä¸­ä¸€ä¸ªç¼“å­˜ï¼Œåˆ™å°†è¿”å›å…³è”çš„å€¼ã€‚å¦‚ä¸‹ï¼š</p><p>å³ä½¿æœªå®é™…æ‰§è¡Œç¼“å­˜çš„æ–¹æ³•ï¼Œä¹Ÿä¼šæ›´æ–°ä¸åŒ…å«è¯¥å€¼çš„æ‰€æœ‰å…¶ä»–ç¼“å­˜ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹åœ¨ <code>findBook</code> æ–¹æ³•ä¸Šä½¿ç”¨<code>@Cacheable</code>:</p><figure class="highlight nim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nim">@<span class="hljs-type">Cacheable</span>(&#123;<span class="hljs-string">&quot;books&quot;</span>, <span class="hljs-string">&quot;isbns&quot;</span>&#125;)<br><br>public <span class="hljs-type">Book</span> findBook(<span class="hljs-type">ISBN</span> isbn) <span class="hljs-meta">&#123;...&#125;</span><br></code></pre></td></tr></table></figure><h5 id="é»˜è®¤çš„é”®ç”Ÿæˆ"><a href="#é»˜è®¤çš„é”®ç”Ÿæˆ" class="headerlink" title="é»˜è®¤çš„é”®ç”Ÿæˆ"></a>é»˜è®¤çš„é”®ç”Ÿæˆ</h5><p>ç”±äºç¼“å­˜å®è´¨ä¸Šæ˜¯é”®-å€¼å­˜å‚¨åŒºï¼Œå› æ­¤éœ€è¦å°†æ¯ä¸ªç¼“å­˜æ–¹æ³•çš„è°ƒç”¨è½¬æ¢ä¸ºé€‚åˆç¼“å­˜è®¿é—®çš„é”®ã€‚ç¼“å­˜æŠ½è±¡ä½¿ç”¨åŸºäºä»¥ä¸‹ç®—æ³•ä½¿ç”¨ç®€å•çš„é”®ç”Ÿæˆå™¨-<code>KeyGenerator</code>ï¼Œåšåˆ°å¼€ç®±å³ç”¨ã€‚:</p><ul><li>å¦‚æœæ²¡æœ‰å‚æ•°è¢«æŒ‡å®šï¼Œåˆ™è¿”å›<code>SimpleKey.EMPTY</code>.</li><li>å¦‚æœåªæœ‰ä¸€ä¸ªå‚æ•°è¢«æŒ‡å®šï¼Œåˆ™è¿”å›å®ä¾‹</li><li>å¦‚æœå¤šäºä¸€ä¸ªå‚æ•°è¢«æŒ‡å®šï¼Œåˆ™è¿”å›ä¸€ä¸ª<code>SimpleKey</code>åŒ…å«æ‰€æœ‰çš„å‚æ•°</li></ul><p>è¿™ç§æ–¹æ³•é€‚ç”¨äºå¤§å¤šæ•°ç”¨ä¾‹ã€‚åªè¦å‚æ•°æœ‰è‡ªç„¶çš„é”®å¹¶ä¸”å®ç°äº†æœ‰æ•ˆçš„<code>hashCode()</code> å’Œ <code>equals()</code>æ–¹æ³•ï¼Œå¦‚æœä¸æ˜¯è¿™æ ·çš„è¯ï¼Œ é‚£ä¹ˆæˆ˜ç•¥å°±éœ€è¦æ”¹å˜ã€‚</p><p>è¦æä¾›ä¸åŒçš„é»˜è®¤é”®ç”Ÿæˆå™¨ï¼Œæ‚¨éœ€è¦å®ç°<code>org.springframework.cache.interceptor.KeyGenerator</code>æ¥å£ã€‚</p><p>é»˜è®¤çš„é”®ç”Ÿæˆç­–ç•¥åœ¨Spring 4.0ç‰ˆæœ¬æœ‰ç‚¹æ”¹å˜ã€‚æ—©æœŸçš„Springç‰ˆæœ¬ä½¿ç”¨çš„é”®ç”Ÿæˆç­–ç•¥ï¼Œå¯¹äºå¤šä¸ªé”®å‚æ•°ï¼Œåªè€ƒè™‘å‚æ•°çš„<code>hashCode()</code> è€Œæ²¡æœ‰è€ƒè™‘åˆ° <code>equals()</code>æ–¹æ³•ï¼Œè¿™å°†å¯¼è‡´ä¸€å®šçš„ç¢°æ’ï¼ˆè§<a href="https://jira.spring.io/browse/SPR-10237">SPR-10237</a>ï¼‰ã€‚æ–°çš„ <code>SimpleKeyGenerator</code> ä¸ºè¿™ç§æƒ…å†µä½¿ç”¨å¤åˆé”®ã€‚</p><p>å¦‚æœæ‚¨å¸Œæœ›ç»§ç»­ä½¿ç”¨å‰é¢çš„ key strategy, åˆ™å¯ä»¥é…ç½®å·²å¼ƒç”¨çš„<code>org.springframework.cache.interceptor.DefaultKeyGenerator</code>ç±»æˆ–åˆ›å»ºè‡ªå®šä¹‰çš„åŸºäº<code>KeyGenerator</code>çš„å®ç°ã€‚</p><h5 id="è‡ªå®šä¹‰é”®ç”Ÿæˆå™¨"><a href="#è‡ªå®šä¹‰é”®ç”Ÿæˆå™¨" class="headerlink" title="è‡ªå®šä¹‰é”®ç”Ÿæˆå™¨"></a>è‡ªå®šä¹‰é”®ç”Ÿæˆå™¨</h5><p>ç”±äºç¼“å­˜æ˜¯å…·æœ‰æ™®éæ€§çš„ï¼Œå› æ­¤ç›®æ ‡æ–¹æ³•å¾ˆå¯èƒ½å…·æœ‰ä¸åŒçš„ç­¾åï¼Œä¸èƒ½ç®€å•åœ°æ˜ å°„åˆ°ç¼“å­˜ç»“æ„çš„é¡¶éƒ¨ã€‚å½“ç›®æ ‡æ–¹æ³•æœ‰å¤šä¸ªå‚æ•°æ—¶ï¼Œé—®é¢˜æ˜¾å¾—æ›´çªå‡ºï¼Œå…¶ä¸­åªæœ‰ä¸€éƒ¨åˆ†æ˜¯é€‚åˆäºç¼“å­˜çš„(å…¶ä½™ä»…ç”±æ–¹æ³•é€»è¾‘ä½¿ç”¨)ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Cacheable(&quot;books&quot;)</span><br><br><span class="hljs-keyword">public</span> Book <span class="hljs-title function_">findBook</span><span class="hljs-params">(ISBN isbn, <span class="hljs-type">boolean</span> checkWarehouse, <span class="hljs-type">boolean</span> includeUsed)</span><br></code></pre></td></tr></table></figure><p>ä¹ä¸€çœ‹ï¼Œè™½ç„¶ä¸¤ä¸ª <code>boolean</code>å‚æ•°å½±å“äº†bookçš„å‘ç°æ–¹å¼ï¼Œä½†å®ƒä»¬å¯¹ç¼“å­˜æ²¡æœ‰ç”¨å¤„ã€‚ å¦‚æœä¸¤ä¸ªä¸­åªæœ‰ä¸€ä¸ªé‡è¦è€Œå¦ä¸€ä¸ªä¸é‡è¦æ€ä¹ˆåŠï¼Ÿ</p><p>å¯¹äºè¿™ç§æƒ…å†µï¼Œ<code>@Cacheable</code>æ³¨è§£å…è®¸ç”¨æˆ·æŒ‡å®š<code>key</code>çš„ç”Ÿæˆå±æ€§ã€‚å¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨<a href="https://sca.aliyun.com/learn/spring/integration/cache/core.html#expressions">SpEL</a>)æ¥é€‰æ‹©æ„Ÿå…´è¶£çš„å‚æ•°(æˆ–å®ƒä»¬çš„åµŒå¥—å±æ€§)æ‰§è¡Œæ“ä½œï¼Œç”šè‡³è°ƒç”¨ä»»æ„æ–¹æ³•ï¼Œè€Œä¸å¿…ç¼–å†™ä»»ä½•ä»£ç æˆ–å®ç°ä»»ä½•æ¥å£ã€‚è¿™æ˜¯åœ¨é»˜è®¤ç”Ÿæˆå™¨ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¯å„ç§SpELå£°æ˜ï¼ˆå¦‚æœæ‚¨ä¸ç†Ÿæ‚‰SpELï¼Œè¯·é˜…è¯» <a href="https://sca.aliyun.com/learn/spring/integration/cache/core.html#expressions">Spring Expression Language</a>ï¼‰:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Cacheable</span>(cacheNames=<span class="hljs-string">&quot;books&quot;</span>, key=<span class="hljs-string">&quot;#isbn&quot;</span>)public Book <span class="hljs-built_in">findBook</span>(ISBN isbn, boolean checkWarehouse, boolean includeUsed)<br><span class="hljs-variable">@Cacheable</span>(cacheNames=<span class="hljs-string">&quot;books&quot;</span>, key=<span class="hljs-string">&quot;#isbn.rawNumber&quot;</span>)public Book <span class="hljs-built_in">findBook</span>(ISBN isbn, boolean checkWarehouse, boolean includeUsed)<br><span class="hljs-variable">@Cacheable</span>(cacheNames=<span class="hljs-string">&quot;books&quot;</span>, key=<span class="hljs-string">&quot;T(someType).hash(#isbn)&quot;</span>)public Book <span class="hljs-built_in">findBook</span>(ISBN isbn, boolean checkWarehouse, boolean includeUsed)<br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç æ®µæ˜¾ç¤ºäº†é€‰æ‹©æŸä¸ªå‚æ•°ã€æŸä¸ªå±æ€§ç”šè‡³æ˜¯ä»»æ„(é™æ€)æ–¹æ³•æ˜¯å¤šä¹ˆå®¹æ˜“ã€‚</p><p>å¦‚æœè´Ÿè´£ç”Ÿæˆé”®çš„ç®—æ³•å¤ªç‰¹æ®Šï¼Œæˆ–è€…éœ€è¦å…±äº«ï¼Œåˆ™å¯ä»¥åœ¨æ“ä½œä¸Šå®šä¹‰ä¸€ä¸ªè‡ªå®šä¹‰<code>keyGenerator</code>ã€‚ä¸ºæ­¤ï¼Œè¯·æŒ‡å®šè¦ä½¿ç”¨çš„<code>KeyGenerator</code> beanå®ç°çš„åç§°ã€‚å¦‚ä¸‹:</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-meta">@Cacheable</span>(cacheNames=<span class="hljs-string">&quot;books&quot;</span>, keyGenerator=<span class="hljs-string">&quot;myKeyGenerator&quot;</span>)<br><br><span class="hljs-keyword">public</span> Book findBook(ISBN isbn, <span class="hljs-keyword">boolean</span> checkWarehouse, <span class="hljs-keyword">boolean</span> includeUsed)<br></code></pre></td></tr></table></figure><p><code>key</code>å’Œ <code>keyGenerator</code>å‚æ•°æ˜¯äº’æ–¥çš„ï¼Œ æŒ‡å®šä¸¤è€…çš„æ“ä½œå°†å¯¼è‡´å¼‚å¸¸ã€‚</p><h5 id="é»˜è®¤çš„ç¼“å­˜è§£æ"><a href="#é»˜è®¤çš„ç¼“å­˜è§£æ" class="headerlink" title="é»˜è®¤çš„ç¼“å­˜è§£æ"></a>é»˜è®¤çš„ç¼“å­˜è§£æ</h5><p>ç¼“å­˜æŠ½è±¡ä½¿ç”¨ä¸€ä¸ªç®€å•çš„ <code>CacheResolver</code>ï¼ˆå¯å³ç”¨ï¼‰å®ƒä½¿ç”¨<code>CacheManager</code>é…ç½®æ£€ç´¢åœ¨æ“ä½œçº§åˆ«å®šä¹‰çš„ç¼“å­˜ã€‚</p><p>ä¸ºäº†æä¾›ä¸åŒé»˜è®¤ç¼“å­˜è§£æï¼Œéœ€è¦å®ç°<code>org.springframework.cache.interceptor.CacheResolver</code> æ¥å£.</p><h5 id="è‡ªå®šä¹‰ç¼“å­˜è§£æ"><a href="#è‡ªå®šä¹‰ç¼“å­˜è§£æ" class="headerlink" title="è‡ªå®šä¹‰ç¼“å­˜è§£æ"></a>è‡ªå®šä¹‰ç¼“å­˜è§£æ</h5><p>é»˜è®¤çš„ç¼“å­˜è§£æé€‚åˆäºåº”ç”¨å¯¹äºä½¿ç”¨å•ä¸ª<code>CacheManager</code>ï¼Œå¹¶ä¸”ä¸éœ€è¦å¤æ‚çš„è§£æè¦æ±‚ã€‚</p><p>å¯¹äºåº”ç”¨ä½¿ç”¨ä¸åŒçš„ç¼“å­˜ç®¡ç†ï¼Œå¯ä»¥è®¾ç½®<code>cacheManager</code> ä½¿ç”¨æ¯ä¸ªæ“ä½œã€‚å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight nim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nim">@<span class="hljs-type">Cacheable</span>(cacheNames=<span class="hljs-string">&quot;books&quot;</span>, cacheManager=<span class="hljs-string">&quot;anotherCacheManager&quot;</span>) (<span class="hljs-number">1</span>)<br><br>public <span class="hljs-type">Book</span> findBook(<span class="hljs-type">ISBN</span> isbn) <span class="hljs-meta">&#123;...&#125;</span><br></code></pre></td></tr></table></figure><p><strong>1</strong>ã€Specifying <code>anotherCacheManager</code>.</p><p>ä¹Ÿå¯ä»¥å®Œå…¨ä»¥ç±»ä¼¼äº <a href="https://sca.aliyun.com/learn/spring/integration/cache/?spm=0.29160081.0.0.51f92e5dCHrGI4#cache-annotations-cacheable-key">key generation</a>çš„æ–¹å¼æ›¿æ¢<code>CacheResolver</code>ã€‚ä¸ºæ¯ä¸ªç¼“å­˜æ“ä½œè¯·æ±‚è¯¥è§£å†³æ–¹æ¡ˆï¼Œ ä½¿å®ç°èƒ½å¤Ÿæ ¹æ®è¿è¡Œæ—¶å‚æ•°å®é™…è§£æè¦ä½¿ç”¨çš„ç¼“å­˜ã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•æŒ‡å®š <code>CacheResolver</code>ï¼š</p><figure class="highlight nim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nim">@<span class="hljs-type">Cacheable</span>(cacheResolver=<span class="hljs-string">&quot;runtimeCacheResolver&quot;</span>) (<span class="hljs-number">1</span>)<br><br>public <span class="hljs-type">Book</span> findBook(<span class="hljs-type">ISBN</span> isbn) <span class="hljs-meta">&#123;...&#125;</span><br></code></pre></td></tr></table></figure><p><strong>1</strong>ã€Specifying the <code>CacheResolver</code>.</p><p>Spring 4.1ç‰ˆæœ¬ä»¥å, ç¼“å­˜æ³¨è§£çš„ <code>value</code>å±æ€§ä¸å†æ˜¯å¼ºåˆ¶æ€§çš„äº†ï¼Œå› ä¸ºæ— è®ºæ³¨è§£çš„å†…å®¹å¦‚ä½•ï¼Œ<code>CacheResolver</code>éƒ½å¯ä»¥æä¾›æ­¤ç‰¹å®šä¿¡æ¯ã€‚</p><p>ä¸ <code>key</code>å’Œ<code>keyGenerator</code>ä¼¼ï¼Œ<code>cacheManager</code>å’Œ<code>cacheResolver</code>å‚æ•°æ˜¯äº’æ–¥çš„ï¼ŒåŒæ—¶æŒ‡å®šä¸¤è€…çš„æ“ä½œå°†å¯¼è‡´å¼‚å¸¸ï¼Œå› ä¸º<code>CacheResolver</code>å®ç°å¿½ç•¥äº†è‡ªå®šä¹‰<code>CacheManager</code>ã€‚è¿™å¯èƒ½ä¸æ˜¯ä½ æ‰€æœŸæœ›çš„ã€‚</p><h5 id="åŒæ­¥ç¼“å­˜"><a href="#åŒæ­¥ç¼“å­˜" class="headerlink" title="åŒæ­¥ç¼“å­˜"></a>åŒæ­¥ç¼“å­˜</h5><p>åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œå¯¹äºåŒä¸€å‚æ•°(é€šå¸¸åœ¨å¯åŠ¨æ—¶)ï¼Œå¯èƒ½ä¼šåŒæ—¶è°ƒç”¨æŸäº›æ“ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç¼“å­˜æŠ½è±¡ä¸ä¼šé”å®šä»»ä½•å†…å®¹ï¼Œå¹¶ä¸”å¯èƒ½ä¼šå¤šæ¬¡è®¡ç®—ç›¸åŒçš„å€¼ï¼Œä»è€Œæ— æ³•è¾¾åˆ°ç¼“å­˜çš„ç›®çš„ã€‚</p><p>å¯¹äºè¿™äº›ç‰¹å®šæƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨<code>sync</code>å±æ€§æŒ‡ç¤ºåŸºç¡€ç¼“å­˜æä¾›ç¨‹åºåœ¨è®¡ç®—å€¼æ—¶é”å®šç¼“å­˜é¡¹ã€‚å› æ­¤ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹å°†å¿™äºè®¡ç®—è¯¥å€¼ï¼Œè€Œå…¶ä½™çš„åˆ™è¢«é˜»å¡ï¼Œç›´åˆ°åœ¨ç¼“å­˜ä¸­æ›´æ–°è¯¥é¡¹ã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•ä½¿ç”¨<code>sync</code>å±æ€§:</p><figure class="highlight nim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nim">@<span class="hljs-type">Cacheable</span>(cacheNames=<span class="hljs-string">&quot;foos&quot;</span>, sync=<span class="hljs-literal">true</span>) (<span class="hljs-number">1</span>)<br><br>public <span class="hljs-type">Foo</span> executeExpensiveOperation(<span class="hljs-type">String</span> id) <span class="hljs-meta">&#123;...&#125;</span><br></code></pre></td></tr></table></figure><p><strong>1</strong>ã€Using the <code>sync</code> attribute.</p><p>è¿™æ˜¯ä¸€ä¸ªå¯é€‰çš„åŠŸèƒ½ï¼Œæ‚¨å–œæ¬¢çš„ç¼“å­˜åº“å¯èƒ½ä¸æ”¯æŒå®ƒã€‚æ ¸å¿ƒæ¡†æ¶æä¾›çš„æ‰€æœ‰<code>CacheManager</code> å®ç°éƒ½æ”¯æŒå®ƒã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…ç¼“å­˜æä¾›ç¨‹åºçš„æ–‡æ¡£ï¼Œ</p><h5 id="æ¡ä»¶ç¼“å­˜"><a href="#æ¡ä»¶ç¼“å­˜" class="headerlink" title="æ¡ä»¶ç¼“å­˜"></a>æ¡ä»¶ç¼“å­˜</h5><p>æœ‰æ—¶ï¼Œä¸€ä¸ªæ–¹æ³•åšç¼“å­˜å¯èƒ½ä¸æ˜¯ä¸‡èƒ½çš„(ä¾‹å¦‚ï¼Œå®ƒå¯èƒ½ä¾èµ–äºç»™å®šçš„å‚æ•°)ã€‚ç¼“å­˜æ³¨è§£é€šè¿‡<code>condition</code>å‚æ•°æ”¯æŒæ­¤ç±»åŠŸèƒ½ï¼Œå®ƒé‡‡ç”¨ <code>SpEL</code> è¡¨è¾¾å¼ï¼Œå¹¶å°†å…¶è®¡ç®—ä¸º<code>true</code>æˆ–<code>false</code>ã€‚å¦‚æœä¸º<code>true</code>ï¼Œåˆ™æ–¹æ³•æ‰§è¡Œç¼“å­˜ã€‚å¦‚æœä¸æ˜¯ï¼Œåˆ™å®ƒçš„è¡Œä¸ºå°±åƒä¸ç¼“å­˜çš„æ–¹æ³•ä¸€æ ·ã€‚ æ¯æ¬¡ä¸ç®¡ç¼“å­˜ä¸­çš„å€¼æ˜¯ä»€ä¹ˆæˆ–ä½¿ç”¨äº†ä»€ä¹ˆå‚æ•°ï¼Œéƒ½å°†æ‰§è¡Œå®ƒã€‚ä¾‹å¦‚ï¼Œä»…å½“å‚æ•°åç§°çš„é•¿åº¦å°äº32æ—¶ï¼Œæ‰ä¼šç¼“å­˜ä»¥ä¸‹æ–¹æ³•ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">@Cacheable(<span class="hljs-attribute">cacheNames</span>=<span class="hljs-string">&quot;book&quot;</span>, <span class="hljs-attribute">condition</span>=<span class="hljs-string">&quot;#name.length() &lt; 32&quot;</span>) (1)<br><br>public Book findBook(String name)<br></code></pre></td></tr></table></figure><p><strong>1</strong>ã€Setting a condition on <code>@Cacheable</code>.</p><p>æ­¤å¤–ï¼Œ é™¤äº†<code>condition</code>å‚æ•°å¤–ï¼Œ è¿˜å¯ä»¥ä½¿ç”¨<code>unless</code> å‚æ•°æ¥å†³å®šä¸æƒ³ç¼“å­˜çš„å€¼ã€‚ä¸ <code>condition</code>ä¸åŒï¼Œï¼Œ <code>unless</code>åœ¨è°ƒç”¨æ–¹æ³•åè®¡ç®—è¡¨è¾¾å¼ã€‚æ‰©å±•ä¸Šä¸€ç¤ºä¾‹ã€‚ä¹Ÿè®¸æˆ‘ä»¬åªæƒ³ç¼“å­˜å¹³è£…ä¹¦ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤º:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">@Cacheable(<span class="hljs-attribute">cacheNames</span>=<span class="hljs-string">&quot;book&quot;</span>, <span class="hljs-attribute">condition</span>=<span class="hljs-string">&quot;#name.length() &lt; 32&quot;</span>, <span class="hljs-attribute">unless</span>=<span class="hljs-string">&quot;#result.hardback&quot;</span>) (1)<br><br>public Book findBook(String name)<br></code></pre></td></tr></table></figure><p><strong>1</strong>ã€Using the <code>unless</code> attribute to block hardbacks.</p><p>ç¼“å­˜æŠ½è±¡æ”¯æŒ<code>java.util.Optional</code>ï¼Œä»…åœ¨å…¶å­˜åœ¨æ—¶å°†å…¶å†…å®¹ç”¨ä½œç¼“å­˜å€¼ã€‚ <code>#result</code>æ€»æ˜¯å¼•ç”¨ä¸šåŠ¡å®ä½“è€Œä»ä¸æ”¯æŒåŒ…è£…å™¨ï¼Œå› æ­¤å‰é¢çš„ç¤ºä¾‹å¯ä»¥é‡å†™å¦‚ä¸‹:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">@Cacheable(<span class="hljs-attribute">cacheNames</span>=<span class="hljs-string">&quot;book&quot;</span>, <span class="hljs-attribute">condition</span>=<span class="hljs-string">&quot;#name.length() &lt; 32&quot;</span>, <span class="hljs-attribute">unless</span>=<span class="hljs-string">&quot;#result?.hardback&quot;</span>)<br><br>public Optional&lt;Book&gt; findBook(String name)<br></code></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œ<code>result</code>ä»ç„¶å¼•ç”¨ <code>Book</code> è€Œä¸æ˜¯<code>Optional</code>ã€‚ ç”±äºå®ƒå¯èƒ½ä¸º<code>null</code>ï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨å®‰å…¨å¯¼èˆªæ“ä½œç¬¦ã€‚</p><h5 id="å¯ç”¨çš„ç¼“å­˜SpELè¡¨è¾¾å¼å†…å®¹"><a href="#å¯ç”¨çš„ç¼“å­˜SpELè¡¨è¾¾å¼å†…å®¹" class="headerlink" title="å¯ç”¨çš„ç¼“å­˜SpELè¡¨è¾¾å¼å†…å®¹"></a>å¯ç”¨çš„ç¼“å­˜SpELè¡¨è¾¾å¼å†…å®¹</h5><p>æ¯ä¸ª<code>SpEL</code>è¡¨è¾¾å¼éƒ½å¯ä»¥ç”¨äºå†æ¬¡æŒ‡å®šçš„ä¸Šä¸‹æ–‡å€¼ã€‚é™¤äº†åœ¨å‚æ•°ä¸­ç”Ÿæˆå¤–ï¼Œæ¡†æ¶è¿˜æä¾›ä¸“ç”¨çš„ä¸ç¼“å­˜ç›¸å…³çš„å…ƒæ•°æ®(å¦‚å‚æ•°åç§°)ã€‚ä¸‹è¡¨åˆ—å‡ºäº†å¯ç”¨äº<a href="https://sca.aliyun.com/learn/spring/integration/cache/core.html#expressions-language-ref"><code>context</code></a>çš„é¡¹ï¼Œä»¥ä¾¿å¯ä»¥ä½¿ç”¨è¿™äº›é¡¹è¿›è¡Œé”®å’Œæ¡ä»¶è®¡ç®—ã€‚</p><p>Table 11. ç¼“å­˜SpELå¯ç”¨çš„å…ƒæ•°æ®</p><table><thead><tr><th>åå­—</th><th>ä½ç½®</th><th>æè¿°</th><th>ä¾‹å­</th></tr></thead><tbody><tr><td><code>methodName</code></td><td>Root object</td><td>æ­£åœ¨è°ƒç”¨çš„æ–¹æ³•çš„åç§°</td><td><code>#root.methodName</code></td></tr><tr><td><code>method</code></td><td>Root object</td><td>æ­£åœ¨è°ƒç”¨çš„æ–¹æ³•</td><td><code>#root.method.name</code></td></tr><tr><td><code>target</code></td><td>Root object</td><td>æ­£åœ¨è°ƒç”¨çš„ç›®æ ‡å¯¹è±¡</td><td><code>#root.target</code></td></tr><tr><td><code>targetClass</code></td><td>Root object</td><td>è¢«è°ƒç”¨çš„ç›®æ ‡çš„ç±»</td><td><code>#root.targetClass</code></td></tr><tr><td><code>args</code></td><td>Root object</td><td>ç”¨äºè°ƒç”¨ç›®æ ‡çš„å‚æ•°ï¼ˆä½œä¸ºæ•°ç»„ï¼‰</td><td><code>#root.args[0]</code></td></tr><tr><td><code>caches</code></td><td>Root object</td><td>æ‰§è¡Œå½“å‰æ–¹æ³•çš„é«˜é€Ÿç¼“å­˜çš„é›†åˆ</td><td><code>#root.caches[0].name</code></td></tr><tr><td>Argument name</td><td>Evaluation context</td><td>ä»»ä½•æ–¹æ³•å‚æ•°çš„åç§°ã€‚ å¦‚æœåç§°ä¸å¯ç”¨ï¼ˆå¯èƒ½ç”±äºæ²¡æœ‰è°ƒè¯•ä¿¡æ¯ï¼‰ï¼Œå‚æ•°åç§°ä¹Ÿå¯ä»¥åœ¨<code>#a&lt;#arg&gt;</code>ä¸‹è·å¾—ï¼Œå…¶ä¸­ <code>#arg</code>ä»£è¡¨å‚æ•°ç´¢å¼•ï¼ˆä»0å¼€å§‹ï¼‰ã€‚</td><td><code>#iban</code> or <code>#a0</code> (you can also use <code>#p0</code> or <code>#p&lt;#arg&gt;</code> notation as an alias).</td></tr><tr><td><code>result</code></td><td>Evaluation context</td><td>æ–¹æ³•è°ƒç”¨çš„ç»“æœï¼ˆè¦ç¼“å­˜çš„å€¼ï¼‰ã€‚ ä»…åœ¨<code>unless</code>è¡¨è¾¾å¼ï¼Œç¼“å­˜<code>cache put</code>è¡¨è¾¾å¼ï¼ˆè®¡ç®—<code>key</code>ï¼‰æˆ–ç¼“å­˜<code>cache evict</code>è¡¨è¾¾å¼ï¼ˆå½“<code>beforeInvocation</code>ä¸º <code>false</code>æ—¶ï¼‰ä¸­å¯ç”¨ã€‚ å¯¹äºå—æ”¯æŒçš„åŒ…è£…å™¨ï¼ˆä¾‹å¦‚<code>Optional</code>ï¼‰ï¼Œ <code>#result</code>å¼•ç”¨å®é™…çš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯åŒ…è£…å™¨ã€‚</td><td><code>#result</code></td></tr></tbody></table><h4 id="5-2-2-CachePut-æ³¨è§£"><a href="#5-2-2-CachePut-æ³¨è§£" class="headerlink" title="5.2.2. @CachePut æ³¨è§£"></a>5.2.2. <code>@CachePut</code> æ³¨è§£</h4><p>å¯¹äºéœ€è¦æ›´æ–°ç¼“å­˜è€Œä¸å½±å“æ–¹æ³•æ‰§è¡Œçš„æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨<code>@CachePut</code>æ³¨è§£ã€‚å³ï¼Œå°†å§‹ç»ˆæ‰§è¡Œè¯¥æ–¹æ³•ï¼Œå¹¶å°†å…¶ç»“æœæ”¾å…¥ç¼“å­˜(æ ¹æ®<code>@CachePut</code>é€‰é¡¹)ã€‚å®ƒæ”¯æŒä¸<code>@Cacheable</code>ç›¸åŒçš„é€‰é¡¹ï¼Œï¼Œå¹¶ä¸”åº”ç”¨äºç¼“å­˜å¡«å……ï¼Œè€Œä¸æ˜¯æ–¹æ³•æµä¼˜åŒ–ã€‚ä»¥ä¸‹ç¤ºä¾‹ä½¿ç”¨<code>@CachePut</code>æ³¨è§£:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">@CachePut(<span class="hljs-attribute">cacheNames</span>=<span class="hljs-string">&quot;book&quot;</span>, <span class="hljs-attribute">key</span>=<span class="hljs-string">&quot;#isbn&quot;</span>)<br><br>public Book updateBook(ISBN isbn, BookDescriptor descriptor)<br></code></pre></td></tr></table></figure><p>é€šå¸¸å¼ºçƒˆå»ºè®®ä¸è¦åœ¨åŒä¸€æ–¹æ³•ä¸Šä½¿ç”¨<code>@CachePut</code>å’Œ<code>@Cacheable</code> æ³¨è§£ï¼Œå› ä¸ºå®ƒä»¬å…·æœ‰ä¸åŒçš„è¡Œä¸ºã€‚å½“åè€…å¯¼è‡´ä½¿ç”¨ç¼“å­˜è·³è¿‡æ–¹æ³•æ‰§è¡Œæ—¶ï¼Œå‰è€…å¼ºåˆ¶æ‰§è¡Œä»¥æ‰§è¡Œç¼“å­˜æ›´æ–°ã€‚è¿™ä¼šå¯¼è‡´æ„å¤–çš„è¡Œä¸ºï¼Œå¹¶ä¸”é™¤äº†ç‰¹å®šçš„æŸäº›æƒ…å†µ(ä¾‹å¦‚ï¼Œæœ‰æ’é™¤å½¼æ­¤çš„æ¡ä»¶çš„æ³¨è§£)ä¹‹å¤–ï¼Œ åº”é¿å…æ­¤ç±»å£°æ˜ã€‚è¿˜è¦æ³¨æ„ï¼Œæ­¤ç±»æ¡ä»¶ä¸åº”ä¾èµ–äºç»“æœå¯¹è±¡(å³<code>#result</code>å˜é‡)ï¼Œå› ä¸ºå®ƒä»¬æ˜¯é¢„å…ˆéªŒè¯çš„ï¼Œä»¥ç¡®è®¤æ’é™¤ã€‚</p><h4 id="5-2-3-CacheEvict-æ³¨è§£"><a href="#5-2-3-CacheEvict-æ³¨è§£" class="headerlink" title="5.2.3. @CacheEvict æ³¨è§£"></a>5.2.3. <code>@CacheEvict</code> æ³¨è§£</h4><p>æŠ½è±¡ç¼“å­˜ä¸ä»…å…è®¸ç¼“å­˜å­˜å‚¨åŒºçš„å¡«å……ï¼Œè€Œä¸”è¿˜å¯ä»¥å›æ”¶ã€‚æ­¤è¿‡ç¨‹å¯¹äºä»ç¼“å­˜ä¸­åˆ é™¤é™ˆæ—§æˆ–æœªä½¿ç”¨çš„æ•°æ®éå¸¸æœ‰ç”¨ã€‚ç›¸æ¯”äº<code>@Cacheable</code>ï¼Œæ³¨è§£ <code>@CacheEvict</code>æ‰§è¡Œç¼“å­˜å›æ”¶çš„åŒºåˆ†æ–¹æ³•ï¼Œå³å……å½“ä»ç¼“å­˜ä¸­ç§»é™¤æ•°æ®çš„è§¦å‘å™¨çš„æ–¹æ³•ã€‚å°±åƒå®ƒçš„åŒçº§æ³¨è§£ä¸€æ ·ï¼Œ <code>@CacheEvict</code>éœ€è¦æŒ‡å®šä¸€ä¸ª(æˆ–å¤šä¸ª)å—è¯¥æ“ä½œå½±å“çš„ç¼“å­˜ï¼Œå…è®¸è‡ªå®šä¹‰ç¼“å­˜å’Œé”®è§£ææˆ–æŒ‡å®šçš„æ¡ä»¶ï¼Œä½†é™¤æ­¤ä¹‹å¤– ï¼Œè¿˜å…·æœ‰ä¸€ä¸ªé¢å¤–çš„å‚æ•°<code>allEntries</code>ï¼Œå®ƒæŒ‡ç¤ºæ˜¯å¦éœ€è¦è¿›è¡Œç¼“å­˜èŒƒå›´çš„å›æ”¶ï¼Œè€Œä¸æ˜¯åªæ‰§è¡Œä¸€é¡¹(åŸºäºé”®):</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">@CacheEvict(<span class="hljs-attribute">cacheNames</span>=<span class="hljs-string">&quot;books&quot;</span>, <span class="hljs-attribute">allEntries</span>=<span class="hljs-literal">true</span>) (1)<br><br>public void loadBooks(InputStream batch)<br></code></pre></td></tr></table></figure><p><strong>1</strong>ã€Using the <code>allEntries</code> attribute to evict all entries from the cache.</p><p>å½“éœ€è¦æ¸…é™¤æ•´ä¸ªç¼“å­˜åŒºåŸŸæ—¶ï¼Œæ­¤é€‰é¡¹ä¼šæ´¾ä¸Šç”¨åœºã€‚ç„¶åå°†æ¯ä¸ªæ¡ç›®å›æ”¶(è¿™å°†éœ€è¦å¾ˆé•¿æ—¶é—´ï¼Œå› ä¸ºå®ƒçš„æ•ˆç‡å¾ˆä½)ï¼Œæ‰€æœ‰çš„æ¡ç›®éƒ½åœ¨ä¸€ä¸ªæ“ä½œä¸­è¢«ç§»é™¤ï¼Œå¦‚ä¸Šæ‰€ç¤ºã€‚è¯·æ³¨æ„ï¼Œæ¡†æ¶å°†å¿½ç•¥æ­¤æ–¹æ¡ˆä¸­æŒ‡å®šçš„ä»»ä½•é”®ï¼Œå› ä¸ºå®ƒä¸é€‚ç”¨(æ•´ä¸ªç¼“å­˜è¢«å›æ”¶çš„ä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ¡ç›®)ã€‚</p><p>æ‚¨è¿˜å¯ä»¥é€šè¿‡ä½¿ç”¨<code>beforeInvocation</code>å±æ€§æŒ‡ç¤ºå›æ”¶æ˜¯åœ¨ï¼ˆé»˜è®¤ï¼‰ä¹‹åè¿˜æ˜¯åœ¨æ–¹æ³•æ‰§è¡Œä¹‹å‰è¿›è¡Œçš„ã€‚å‰è€…æä¾›ä¸æ³¨è§£çš„å…¶ä½™éƒ¨åˆ†ç›¸åŒçš„è¯­ä¹‰ï¼šä¸€æ—¦æ–¹æ³•æˆåŠŸå®Œæˆï¼Œå°±ä¼šæ‰§è¡Œç¼“å­˜ä¸Šçš„æ“ä½œï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸ºå›æ”¶ï¼‰ã€‚å¦‚æœæ–¹æ³•æœªæ‰§è¡Œï¼ˆå› ä¸ºå®ƒå¯èƒ½è¢«ç¼“å­˜ï¼‰æˆ–æŠ›å‡ºå¼‚å¸¸ï¼Œåˆ™ä¸ä¼šå‘ç”Ÿå›æ”¶ã€‚ åè€…ï¼ˆ<code>beforeInvocation=true</code>ï¼‰å¯¼è‡´å›æ”¶å§‹ç»ˆåœ¨è°ƒç”¨æ–¹æ³•ä¹‹å‰å‘ç”Ÿã€‚ è¿™åœ¨å›æ”¶ä¸éœ€è¦ä¸æ–¹æ³•ç»“æœç›¸å…³è”çš„æƒ…å†µä¸‹éå¸¸æœ‰ç”¨ã€‚</p><p>å¿…é¡»æ³¨æ„çš„æ˜¯ï¼Œ<code>void</code>æ–¹æ³•å¯ä»¥ä¸<code>@CacheEvict</code>ä¸€èµ·ä½¿ç”¨-å› ä¸ºè¿™äº›æ–¹æ³•å……å½“è§¦å‘å™¨,æ‰€ä»¥è¿”å›å€¼è¢«å¿½ç•¥(å› ä¸ºå®ƒä»¬ä¸ä¸ç¼“å­˜äº¤äº’)ã€‚<code>@Cacheable</code> å°†æ•°æ®æ·»åŠ &#x2F;æ›´æ–°åˆ°ç¼“å­˜ä¸­çš„æƒ…å†µå¹¶éå¦‚æ­¤ï¼Œå› æ­¤éœ€è¦é‡æ–°è¯·æ±‚ç»“æœã€‚</p><h4 id="5-2-4-Caching-æ³¨è§£"><a href="#5-2-4-Caching-æ³¨è§£" class="headerlink" title="5.2.4. @Caching æ³¨è§£"></a>5.2.4. <code>@Caching</code> æ³¨è§£</h4><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œéœ€è¦æŒ‡å®šç›¸åŒç±»å‹çš„å¤šä¸ªæ³¨è§£(ä¾‹å¦‚<code>@CacheEvict</code>æˆ–<code>@CachePut</code>)ã€‚ä¾‹å¦‚ï¼Œå› ä¸ºæ¡ä»¶æˆ–é”®è¡¨è¾¾å¼åœ¨ä¸åŒçš„ç¼“å­˜ä¹‹é—´æ˜¯ä¸åŒçš„ã€‚ <code>@Caching</code>å…è®¸åœ¨åŒä¸€æ–¹æ³•ä¸Šä½¿ç”¨å¤šä¸ªåµŒå¥—çš„<code>@Cacheable</code>ã€<code>@CachePut</code>å’Œ<code>@CacheEvict</code>ã€‚ä»¥ä¸‹ç¤ºä¾‹ä½¿ç”¨ä¸¤ä¸ª<code>@CacheEvict</code>æ³¨è§£:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Caching</span>(evict = &#123; <span class="hljs-variable">@CacheEvict</span>(<span class="hljs-string">&quot;primary&quot;</span>), <span class="hljs-variable">@CacheEvict</span>(cacheNames=<span class="hljs-string">&quot;secondary&quot;</span>, key=<span class="hljs-string">&quot;#p0&quot;</span>) &#125;)<br><br>public Book <span class="hljs-built_in">importBooks</span>(String deposit, Date date)<br></code></pre></td></tr></table></figure><h4 id="5-2-5-CacheConfig-æ³¨è§£"><a href="#5-2-5-CacheConfig-æ³¨è§£" class="headerlink" title="5.2.5. @CacheConfig æ³¨è§£"></a>5.2.5. <code>@CacheConfig</code> æ³¨è§£</h4><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°ç¼“å­˜æ“ä½œæä¾›äº†è®¸å¤šè‡ªå®šä¹‰é€‰é¡¹ï¼Œæ‚¨å¯ä»¥ä¸ºæ¯ä¸ªæ“ä½œè®¾ç½®è¿™äº›é€‰é¡¹ã€‚ä½†æ˜¯ï¼Œå¦‚æœè¿™äº›è‡ªå®šä¹‰é€‰é¡¹é€‚ç”¨äºè¯¥ç±»çš„æ‰€æœ‰æ“ä½œï¼Œåˆ™å¯ä»¥å¯¹å…¶è¿›è¡Œé…ç½®ã€‚ä¾‹å¦‚ï¼ŒæŒ‡å®šè¦ç”¨äºè¯¥ç±»çš„æ¯ä¸ªç¼“å­˜æ“ä½œçš„ç¼“å­˜çš„åç§°å¯ä»¥ç”±å•ä¸ªç±»çº§åˆ«å®šä¹‰æ›¿æ¢ã€‚è¿™å°±æ˜¯<code>@CacheConfig</code>å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚ ä»¥ä¸‹ç¤ºä¾‹ä½¿ç”¨<code>@CacheConfig</code>è®¾ç½®ç¼“å­˜çš„åç§°:</p><figure class="highlight nim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nim">@<span class="hljs-type">CacheConfig</span>(<span class="hljs-string">&quot;books&quot;</span>) (<span class="hljs-number">1</span>)public class <span class="hljs-type">BookRepositoryImpl</span> implements <span class="hljs-type">BookRepository</span> &#123;<br>    @<span class="hljs-type">Cacheable</span>    public <span class="hljs-type">Book</span> findBook(<span class="hljs-type">ISBN</span> isbn) <span class="hljs-meta">&#123;...&#125;</span>&#125;<br></code></pre></td></tr></table></figure><p><strong>1</strong>ã€Using <code>@CacheConfig</code> to set the name of the cache.</p><p><code>@CacheConfig</code>æ˜¯ä¸€ä¸ªç±»çº§æ³¨è§£ï¼Œå®ƒå…è®¸å…±äº«ç¼“å­˜åç§°ã€è‡ªå®šä¹‰<code>KeyGenerator</code>ã€è‡ªå®šä¹‰<code>CacheManager</code>ä»¥åŠæœ€ç»ˆçš„è‡ªå®šä¹‰<code>CacheResolver</code>ã€‚å°†æ­¤æ³¨è§£æ”¾åœ¨ç±»ä¸Šä¸ä¼šæ‰“å¼€ä»»ä½•ç¼“å­˜æ“ä½œã€‚</p><p>æ“ä½œçº§è‡ªå®šä¹‰é¡¹å°†å§‹ç»ˆè¦†ç›–åœ¨<code>@CacheConfig</code>ä¸Šè®¾ç½®çš„è‡ªå®šä¹‰é¡¹ã€‚å› æ­¤ï¼Œæ¯ä¸ªç¼“å­˜æ“ä½œéƒ½æä¾›äº†ä¸‰ä¸ªçº§åˆ«çš„è‡ªå®šä¹‰é¡¹:</p><ul><li>å…¨å±€é…ç½®, é€‚ç”¨äº<code>CacheManager</code>, <code>KeyGenerator</code>.</li><li>åœ¨ç±»çº§åˆ«, ä½¿ç”¨@ <code>@CacheConfig</code>.</li><li>åœ¨æ“ä½œçº§åˆ«</li></ul><h4 id="5-2-6-å¯ç”¨ç¼“å­˜æ³¨è§£"><a href="#5-2-6-å¯ç”¨ç¼“å­˜æ³¨è§£" class="headerlink" title="5.2.6. å¯ç”¨ç¼“å­˜æ³¨è§£"></a>5.2.6. å¯ç”¨ç¼“å­˜æ³¨è§£</h4><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå³ä½¿å£°æ˜ç¼“å­˜æ³¨è§£ä¸ä¼šè‡ªåŠ¨è§¦å‘å®ƒä»¬çš„æ“ä½œ(å¦‚Springä¸­çš„è®¸å¤šé¡¹)ï¼Œè¯¥åŠŸèƒ½ä¹Ÿå¿…é¡»ä»¥å£°æ˜æ–¹å¼å¯ç”¨(è¿™æ„å‘³ç€å¦‚æœæ‚¨æ€€ç–‘ç¼“å­˜æ˜¯ç½ªé­ç¥¸é¦–ï¼Œæ‚¨å¯ä»¥é€šè¿‡åªåˆ é™¤ä¸€ä¸ªé…ç½®è¡Œè€Œä¸æ˜¯ä»£ç ä¸­çš„æ‰€æœ‰æ³¨è§£)ã€‚</p><p>è¦å¯ç”¨ç¼“å­˜æ³¨è§£ï¼Œè¯·å°†æ³¨è§£<code>@EnableCaching</code>æ·»åŠ åˆ°æ‚¨çš„<code>@Configuration</code>ç±»ä¹‹ä¸€ä¸Š:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Configuration</span><br><br><span class="hljs-variable">@EnableCaching</span><br><br>public class AppConfig &#123;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨XMLçš„é…ç½®ä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code>cache:annotation-driven</code> å…ƒç´ :</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;    xmlns:<span class="hljs-keyword">cache</span>=&quot;http://www.springframework.org/schema/<span class="hljs-keyword">cache</span>&quot;    xsi:schemaLocation=&quot;        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd        http://www.springframework.org/schema/<span class="hljs-keyword">cache</span> http://www.springframework.org/schema/<span class="hljs-keyword">cache</span>/spring-<span class="hljs-keyword">cache</span>.xsd&quot;&gt;<br>        &lt;<span class="hljs-keyword">cache</span>:annotation-driven/&gt;&lt;/beans&gt;<br></code></pre></td></tr></table></figure><p><code>cache:annotation-driven</code> å…ƒç´ å’Œ<code>@EnableCaching</code> æ³¨è§£å…è®¸æŒ‡å®šå„ç§é€‰é¡¹ï¼Œä»è€Œå½±å“é€šè¿‡AOPå°†ç¼“å­˜è¡Œä¸ºæ·»åŠ åˆ°åº”ç”¨ç¨‹åºçš„æ–¹å¼ã€‚æ­¤é…ç½®ä¸<a href="https://sca.aliyun.com/learn/spring/integration/cache/data-access.html#tx-annotation-driven-settings"><code>@Transactional</code></a>å¾ˆç±»ä¼¼ï¼š</p><p>å¤„ç†ç¼“å­˜æ³¨é‡Šçš„é»˜è®¤å»ºè®®æ¨¡å¼æ˜¯<code>proxy</code>ï¼Œå®ƒå…è®¸ä»…é€šè¿‡ä»£ç†æ‹¦æˆªè°ƒç”¨ã€‚ åŒä¸€ç±»ä¸­çš„æœ¬åœ°è°ƒç”¨ä¸èƒ½ä»¥è¿™ç§æ–¹å¼æˆªè·ã€‚ å¯¹äºæ›´é«˜çº§çš„æ‹¦æˆªæ¨¡å¼ï¼Œè¯·è€ƒè™‘ç»“åˆç¼–è¯‘æ—¶æˆ–åŠ è½½æ—¶ç¼–ç»‡åˆ‡æ¢åˆ°<code>aspectj</code>æ¨¡å¼ã€‚</p><p>æœ‰å…³å®ç°<code>CachingConfigurer</code>æ‰€éœ€çš„é«˜çº§è‡ªå®šä¹‰ï¼ˆä½¿ç”¨Javaé…ç½®ï¼‰çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/cache/annotation/CachingConfigurer.html">javadoc</a>ã€‚</p><p>Table 12. Cache æ³¨è§£è®¾ç½®</p><table><thead><tr><th>XMLå±æ€§</th><th>æ³¨è§£å±æ€§</th><th>é»˜è®¤å€¼</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>cache-manager</code></td><td>N&#x2F;A (see the <a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/cache/annotation/CachingConfigurer.html"><code>CachingConfigurer</code></a> javadoc)</td><td>è¦ä½¿ç”¨çš„ç¼“å­˜ç®¡ç†å™¨çš„åç§°ã€‚ ä½¿ç”¨æ­¤ç¼“å­˜ç®¡ç†å™¨ï¼ˆæˆ–æœªè®¾ç½®çš„<code>cacheManager</code>ï¼‰åœ¨åå°åˆå§‹åŒ–é»˜è®¤çš„<code>CacheResolver</code>ã€‚ è¦è·å¾—æ›´ç²¾ç»†çš„ç¼“å­˜fine-grained ç®¡ç†ï¼Œè¯·è€ƒè™‘è®¾ç½®â€™cache-resolverâ€™å±æ€§ã€‚</td><td><code>cacheManager</code></td></tr><tr><td><code>cache-resolver</code></td><td>N&#x2F;A (see the <a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/cache/annotation/CachingConfigurer.html"><code>CachingConfigurer</code></a> javadoc)</td><td>A <code>SimpleCacheResolver</code> using the configured <code>cacheManager</code>.</td><td>ç”¨äºè§£æåç«¯ç¼“å­˜çš„CacheResolverçš„beanåç§°ã€‚ æ­¤å±æ€§ä¸æ˜¯å¿…éœ€çš„ï¼Œåªéœ€è¦æŒ‡å®šä¸ºâ€™cache-managerâ€™å±æ€§çš„æ›¿ä»£ã€‚</td></tr><tr><td><code>key-generator</code></td><td>N&#x2F;A (see the <a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/cache/annotation/CachingConfigurer.html"><code>CachingConfigurer</code></a> javadoc)</td><td><code>SimpleKeyGenerator</code></td><td>è¦ä½¿ç”¨çš„è‡ªå®šä¹‰é”®ç”Ÿæˆå™¨çš„åç§°ã€‚</td></tr><tr><td><code>error-handler</code></td><td>N&#x2F;A (see the <a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/cache/annotation/CachingConfigurer.html"><code>CachingConfigurer</code></a> javadoc)</td><td><code>SimpleCacheErrorHandler</code></td><td>è¦ä½¿ç”¨çš„è‡ªå®šä¹‰ç¼“å­˜é”™è¯¯å¤„ç†ç¨‹åºçš„åç§°ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨ç¼“å­˜ç›¸å…³æ“ä½œæœŸé—´æŠ›å‡ºçš„ä»»ä½•å¼‚å¸¸éƒ½ä¼šåœ¨å®¢æˆ·ç«¯è¿”å›ã€‚</td></tr><tr><td><code>mode</code></td><td><code>mode</code></td><td><code>proxy</code></td><td>é»˜è®¤æ¨¡å¼ï¼ˆ<code>proxy</code>ï¼‰ä½¿ç”¨Springçš„AOPæ¡†æ¶å¤„ç†è¦æ³¨é‡Šçš„æ³¨é‡Šbeanï¼ˆéµå¾ªä»£ç†è¯­ä¹‰ï¼Œå¦‚å‰æ‰€è¿°ï¼Œä»…é€‚ç”¨äºé€šè¿‡ä»£ç†è¿›å…¥çš„æ–¹æ³•è°ƒç”¨ï¼‰ã€‚ æ›¿ä»£æ¨¡å¼ï¼ˆ<code>aspectj</code>ï¼‰ç”¨Springçš„AspectJç¼“å­˜æ–¹é¢ç¼–ç»‡å—å½±å“çš„ç±»ï¼Œä¿®æ”¹ç›®æ ‡ç±»å­—èŠ‚ä»£ç ä»¥åº”ç”¨äºä»»ä½•ç±»å‹çš„æ–¹æ³•è°ƒç”¨ã€‚ AspectJç¼–ç»‡éœ€è¦åœ¨ç±»è·¯å¾„ä¸­ä½¿ç”¨<code>spring-aspects.jar</code>ä»¥åŠå¯ç”¨åŠ è½½æ—¶ç»‡å…¥ï¼ˆæˆ–ç¼–è¯‘æ—¶ç»‡å…¥ï¼‰ã€‚ ï¼ˆæœ‰å…³å¦‚ä½•è®¾ç½®åŠ è½½æ—¶ç»‡å…¥çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/integration/cache/core.html#aop-aj-ltw-spring">Spring configuration</a>ã€‚ï¼‰</td></tr><tr><td><code>proxy-target-class</code></td><td><code>proxyTargetClass</code></td><td><code>false</code></td><td>ä»…é€‚ç”¨äºä»£ç†æ¨¡å¼ã€‚ æ§åˆ¶ä¸ºä½¿ç”¨<code>@Cacheable</code>æˆ–<code>@CacheEvict</code>æ³¨è§£æ³¨é‡Šçš„ç±»åˆ›å»ºå“ªç§ç±»å‹çš„é«˜é€Ÿç¼“å­˜ä»£ç†ã€‚ å¦‚æœ<code>proxy-target-class</code> å±æ€§è®¾ç½®ä¸º<code>true</code>ï¼Œåˆ™åˆ›å»ºåŸºäºç±»çš„ä»£ç†ã€‚ å¦‚æœ<code>proxy-target-class</code>ä¸º<code>false</code>æˆ–è€…çœç•¥äº†è¯¥å±æ€§ï¼Œåˆ™ä¼šåˆ›å»ºåŸºäºæ ‡å‡†JDKæ¥å£çš„ä»£ç†ã€‚ ï¼ˆæœ‰å…³ä¸åŒä»£ç†ç±»å‹çš„è¯¦ç»†æ£€æŸ¥ï¼Œè¯·å‚é˜… <a href="https://sca.aliyun.com/learn/spring/integration/cache/core.html#aop-proxying">ä»£ç†æœºåˆ¶</a></td></tr><tr><td><code>order</code></td><td><code>order</code></td><td>Ordered.LOWEST_PRECEDENCE</td><td>å®šä¹‰åº”ç”¨äºä½¿ç”¨<code>@Cacheable</code>æˆ–<code>@CacheEvict</code>æ³¨è§£çš„beançš„ç¼“å­˜é€šçŸ¥çš„é¡ºåºã€‚ ï¼ˆæœ‰å…³ä¸è®¢è´­AOP adviceç›¸å…³çš„è§„åˆ™çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/integration/cache/core.html#aop-ataspectj-advice-ordering">Advice Ordering</a>ã€‚ï¼‰æ²¡æœ‰æŒ‡å®šçš„æ’åºæ„å‘³ç€AOPå­ç³»ç»Ÿç¡®å®šadviceçš„é¡ºåºã€‚</td></tr></tbody></table><p><code>&lt;cache:annotation-driven/&gt;</code>åœ¨ bean ä¸­å®šä¹‰çš„åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­åªæŸ¥æ‰¾<code>@Cacheable/@CachePut/@CacheEvict/@Caching</code>ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœä½ åœ¨<code>WebApplicationContext</code> ä¸­ä¸º<code>DispatcherServlet</code>æ”¾ç½®<code>&lt;cache:annotation-driven/&gt;</code>ï¼Œä»–åªä¼šæ£€æŸ¥æ§åˆ¶å™¨ä¸­çš„beanï¼Œè€Œä¸æ˜¯ä½ çš„æœåŠ¡ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/integration/cache/web.html#mvc-servlet">MVCéƒ¨åˆ†</a>ã€‚</p><p>æ–¹æ³•å¯è§å’Œç¼“å­˜æ³¨è§£</p><p>ä½¿ç”¨ä»£ç†æ—¶ï¼Œåº”ä»…å°†ç¼“å­˜æ³¨è§£åº”ç”¨äºå…·æœ‰å…¬å…±å¯è§æ€§çš„æ–¹æ³•ã€‚å¦‚æœä½¿ç”¨è¿™äº›æ³¨è§£å¯¹å—ä¿æŠ¤çš„ã€ç§æœ‰çš„æˆ–åŒ…å¯è§çš„æ–¹æ³•è¿›è¡Œæ³¨è§£ï¼Œè™½ç„¶ä¸ä¼šå¼•å‘ä»»ä½•é”™è¯¯ï¼Œä½†æ³¨è§£çš„æ–¹æ³•ä¸ä¼šæ˜¾ç¤ºå·²é…ç½®çš„ç¼“å­˜è®¾ç½®ã€‚ å¦‚æœéœ€è¦åœ¨æ›´æ”¹å­—èŠ‚ç æœ¬èº«æ—¶å¯¹éå…¬å…±æ–¹æ³•è¿›è¡Œæ³¨è§£ï¼Œè¯·è€ƒè™‘ä½¿ç”¨AspectJ(è¯·å‚é˜…æœ¬èŠ‚çš„å…¶ä½™éƒ¨åˆ†)</p><p>Springå»ºè®®æ‚¨åªç”¨<code>@Cache*</code>æ³¨è§£æ¥æ³¨è§£å…·ä½“ç±»(è¿˜æœ‰å…·ä½“ç±»çš„æ–¹æ³•)ï¼Œè€Œä¸æ˜¯æ³¨è§£æ¥å£ã€‚å½“ç„¶ï¼Œæ‚¨å¯ä»¥å°†<code>@Cache*</code>æ³¨è§£æ”¾åœ¨æ¥å£(æˆ–æ¥å£æ–¹æ³•)ä¸Šï¼Œä½†è¿™åªé€‚ç”¨äºæ‚¨åœ¨ä½¿ç”¨åŸºäºä»£ç†æ—¶æ‰€æœŸæœ›çš„æ•ˆæœã€‚Javaæ³¨è§£ä¸æ˜¯ä»æ¥å£ç»§æ‰¿çš„è¿™ä¸€äº‹å®æ„å‘³ç€ï¼Œ å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯åŸºäºç±»çš„ä»£ç†(<code>proxy-target-class=&quot;true&quot;</code>)æˆ–weaving-based aspect(<code>mode=&quot;aspectj&quot;</code>)ï¼Œåˆ™ç¼“å­˜è®¾ç½®æ— æ³•è¢«ä»£ç†å’Œç¼–ç»‡åŸºç¡€ç»“æ„ï¼Œå¹¶ä¸”å¯¹è±¡ä¸ä¼šè¢«åŒ…è£…åœ¨ç¼“å­˜ä»£ç†ä¸­ï¼Œè¿™å°†æ˜¯ç»å¯¹ç³Ÿç³•çš„ã€‚</p><p>åœ¨ä»£ç†æ¨¡å¼(é»˜è®¤æƒ…å†µä¸‹), ä»…æˆªè·é€šè¿‡ä»£ç†è¿›å…¥çš„å¤–éƒ¨æ–¹æ³•è°ƒç”¨ã€‚è¿™æ„å‘³ç€ï¼Œå®é™…ä¸Šï¼Œself-invocationåœ¨ç›®æ ‡å¯¹è±¡ä¸­è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„å¦ä¸€ç§æ–¹æ³•æ—¶ï¼Œåœ¨è¿è¡Œæ—¶ä¸ä¼šå¯¼è‡´å®é™…çš„ç¼“å­˜ï¼Œå³ä½¿è°ƒç”¨çš„æ–¹æ³•æ ‡è®°ä¸º<code>@Cacheable</code>ï¼Œè€ƒè™‘ä½¿ç”¨<code>aspectj</code>æ¨¡å¼ä¹Ÿæ˜¯è¿™ç§æƒ…å†µï¼Œæ­¤å¤–ï¼Œä»£ç†å¿…é¡»å®Œå…¨åˆå§‹åŒ–ä»¥æä¾›é¢„æœŸçš„è¡Œä¸ºï¼Œå› æ­¤æ‚¨ä¸åº”ä¾èµ–äºåˆå§‹åŒ–ä»£ç ä¸­çš„æ­¤åŠŸèƒ½ï¼Œå³<code>@PostConstruct</code>ã€‚</p><h4 id="5-2-7-ä½¿ç”¨è‡ªå®šä¹‰çš„æ³¨è§£"><a href="#5-2-7-ä½¿ç”¨è‡ªå®šä¹‰çš„æ³¨è§£" class="headerlink" title="5.2.7. ä½¿ç”¨è‡ªå®šä¹‰çš„æ³¨è§£"></a>5.2.7. ä½¿ç”¨è‡ªå®šä¹‰çš„æ³¨è§£</h4><p>è‡ªå®šä¹‰çš„æ³¨è§£å’ŒAspectJ</p><p>æ­¤åŠŸèƒ½ä»…åœ¨åŸºäºæ–¹æ³•çš„æƒ…å†µä¸‹å·¥ä½œï¼Œä½†å¯ä»¥é€šè¿‡ä½¿ç”¨AspectJçš„é¢å¤–å·¥ä½œæ¥å¯ç”¨ã€‚</p><p><code>spring-aspects</code> æ¨¡å—å®šä¹‰äº†æ ‡å‡†æ³¨è§£çš„åˆ‡é¢ã€‚å¦‚æœä½ å®šä¹‰è‡ªå·±çš„æ³¨è§£ï¼Œåˆ™è¿˜éœ€è¦ä¸ºè¿™äº›æ³¨è§£å®šä¹‰ä¸€ä¸ªåˆ‡é¢ã€‚è¯·æ£€æŸ¥<code>AnnotationCacheAspect</code> ä»¥æŸ¥çœ‹ç¤ºä¾‹ï¼š</p><p>ç¼“å­˜æŠ½è±¡å…è®¸æ‚¨ä½¿ç”¨è‡ªå·±çš„æ³¨è§£æ¥è¯†åˆ«è§¦å‘ç¼“å­˜å‚¨å­˜æˆ–å›æ”¶çš„æ–¹æ³•ã€‚è¿™åœ¨æ¨¡æ¿æœºåˆ¶ä¸­éå¸¸æ–¹ä¾¿ï¼Œå› ä¸ºå®ƒæ¶ˆé™¤äº†é‡å¤ç¼“å­˜æ³¨è§£å£°æ˜çš„éœ€è¦(åœ¨æŒ‡å®šé”®æˆ–æ¡ä»¶æ—¶å°¤å…¶æœ‰ç”¨)ï¼Œæˆ–è€…åœ¨æ‚¨çš„ä»£ç åº“ä¸­ä¸å…è®¸ä½¿ç”¨å¤–éƒ¨å¯¼å…¥(<code>org.springframework</code>)ã€‚ä¸<a href="https://sca.aliyun.com/learn/spring/integration/cache/core.html#beans-stereotype-annotations">stereotype</a>æ³¨è§£çš„å…¶ä½™éƒ¨åˆ†ç±»ä¼¼ï¼Œ <code>@Cacheable</code>, <code>@CachePut</code>ã€<code>@CacheEvict</code>, å’Œ <code>@CacheConfig</code>å¯ä»¥ç”¨ä½œ<a href="https://sca.aliyun.com/learn/spring/integration/cache/core.html#beans-meta-annotations">meta-annotations</a>ã€‚è¿™æ˜¯å¯ä»¥æ³¨è§£å…¶ä»–æ³¨è§£çš„æ³¨è§£ï¼ˆå°±æ˜¯å…ƒæ³¨è§£ï¼‰ã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨è‡ªå·±çš„è‡ªå®šä¹‰æ³¨é‡Šæ›¿æ¢å¸¸è§çš„<code>@Cacheable</code>å£°æ˜ï¼š:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Retention</span>(RetentionPolicy.RUNTIME)<br><br><span class="hljs-variable">@Target</span>(&#123;ElementType.METHOD&#125;)<br><br><span class="hljs-variable">@Cacheable</span>(cacheNames=<span class="hljs-string">&quot;books&quot;</span>, key=<span class="hljs-string">&quot;#isbn&quot;</span>)<br><br>public <span class="hljs-variable">@interface</span> SlowService &#123;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†è‡ªå·±çš„<code>SlowService</code>æ³¨é‡Šï¼Œè¯¥æ³¨é‡Šæœ¬èº«ä½¿ç”¨<code>@Cacheable</code>è¿›è¡Œæ³¨é‡Šã€‚ ç°åœ¨æˆ‘ä»¬å¯ä»¥æ›¿æ¢ä»¥ä¸‹ä»£ç :</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-meta">@Cacheable</span>(cacheNames=<span class="hljs-string">&quot;books&quot;</span>, key=<span class="hljs-string">&quot;#isbn&quot;</span>)<br><br><span class="hljs-keyword">public</span> Book findBook(ISBN isbn, <span class="hljs-keyword">boolean</span> checkWarehouse, <span class="hljs-keyword">boolean</span> includeUsed)<br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†è‡ªå®šä¹‰æ³¨é‡Šï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥æ›¿æ¢å‰é¢çš„ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SlowService</span><br><br><span class="hljs-keyword">public</span> Book <span class="hljs-title function_">findBook</span><span class="hljs-params">(ISBN isbn, <span class="hljs-type">boolean</span> checkWarehouse, <span class="hljs-type">boolean</span> includeUsed)</span><br></code></pre></td></tr></table></figure><p>å°½ç®¡<code>@SlowService</code>ä¸æ˜¯Springæ³¨é‡Šï¼Œä½†å®¹å™¨ä¼šåœ¨è¿è¡Œæ—¶è‡ªåŠ¨è·å–å…¶å£°æ˜å¹¶ç†è§£å…¶å«ä¹‰ã€‚ è¯·æ³¨æ„ï¼Œ<a href="https://sca.aliyun.com/learn/spring/integration/cache/?spm=0.29160081.0.0.51f92e5dCHrGI4#cache-annotation-enable">å¦‚å‰æ‰€è¿°</a>ï¼Œéœ€è¦å¯ç”¨æ³¨é‡Šé©±åŠ¨çš„è¡Œä¸ºã€‚</p><h3 id="5-3-JCache-JSR-107-æ³¨è§£"><a href="#5-3-JCache-JSR-107-æ³¨è§£" class="headerlink" title="5.3. JCache (JSR-107) æ³¨è§£"></a>5.3. JCache (JSR-107) æ³¨è§£</h3><p>è‡ªSpringæ¡†æ¶4.1ä»¥æ¥ï¼Œç¼“å­˜æŠ½è±¡å®Œå…¨æ”¯æŒJCacheæ ‡å‡†æ³¨é‡Š: <code>@CacheResult</code>, <code>@CachePut</code>, <code>@CacheRemove</code>, he <code>@CacheRemoveAll</code> ä»¥åŠ <code>@CacheDefaults</code>, <code>@CacheKey</code>, å’Œ <code>@CacheValue</code>ã€‚è¿™äº›æ³¨è§£å¯ä»¥æ­£ç¡®åœ°ä½¿ç”¨ï¼Œè€Œæ— éœ€å°†ç¼“å­˜å­˜å‚¨è¿ç§»åˆ°JSR-107ã€‚å†…éƒ¨å®ç°ä½¿ç”¨Springçš„ç¼“å­˜æŠ½è±¡ï¼Œ å¹¶æä¾›é»˜è®¤çš„<code>CacheResolver</code>å’Œ<code>KeyGenerator</code>å®ç°ï¼Œå®ƒä»¬ç¬¦åˆè§„èŒƒã€‚æ¢è¨€ä¹‹ï¼Œå¦‚æœæ‚¨å·²ç»åœ¨ä½¿ç”¨Springçš„ç¼“å­˜æŠ½è±¡ï¼Œåˆ™å¯ä»¥åˆ‡æ¢åˆ°è¿™äº›æ ‡å‡†æ³¨è§£ï¼Œè€Œæ— éœ€æ›´æ”¹ç¼“å­˜å­˜å‚¨(æˆ–é…ç½®)ã€‚</p><h4 id="5-3-1-ç‰¹æ€§æ€»ç»“"><a href="#5-3-1-ç‰¹æ€§æ€»ç»“" class="headerlink" title="5.3.1. ç‰¹æ€§æ€»ç»“"></a>5.3.1. ç‰¹æ€§æ€»ç»“</h4><p>å¯¹äºç†Ÿæ‚‰Springç¼“å­˜æ³¨è§£çš„ç”¨æˆ·ï¼Œä¸‹è¡¨æè¿°äº†Springæ³¨è§£å’ŒJSR-107å¯¹åº”é¡¹ä¹‹é—´çš„ä¸»è¦åŒºåˆ«ï¼š</p><p>Table 13. Spring vs. JSR-107 ç¼“å­˜æ³¨è§£</p><table><thead><tr><th>Spring</th><th>JSR-107</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td><code>@Cacheable</code></td><td><code>@CacheResult</code></td><td>éå¸¸ç›¸ä¼¼ã€‚<code>@CacheResult</code>å¯ä»¥ç¼“å­˜ç‰¹å®šçš„å¼‚å¸¸å¹¶å¼ºåˆ¶æ‰§è¡Œè¯¥æ–¹æ³•ï¼Œè€Œä¸ç®¡ç¼“å­˜çš„å†…å®¹å¦‚ä½•ã€‚</td></tr><tr><td><code>@CachePut</code></td><td><code>@CachePut</code></td><td>å½“Springä½¿ç”¨æ–¹æ³•è°ƒç”¨çš„ç»“æœæ›´æ–°ç¼“å­˜æ—¶ï¼ŒJCacheè¦æ±‚å°†å…¶ä½œä¸ºä½¿ç”¨<code>@CacheValue</code>æ³¨é‡Šçš„å‚æ•°ä¼ é€’ã€‚ ç”±äºè¿™ç§å·®å¼‚ï¼ŒJCacheå…è®¸åœ¨å®é™…æ–¹æ³•è°ƒç”¨ä¹‹å‰æˆ–ä¹‹åæ›´æ–°ç¼“å­˜ã€‚</td></tr><tr><td><code>@CacheEvict</code></td><td><code>@CacheRemove</code></td><td>éå¸¸ç›¸ä¼¼ã€‚ å½“æ–¹æ³•è°ƒç”¨å¯¼è‡´å¼‚å¸¸æ—¶ï¼Œ<code>@CacheRemove</code>æ”¯æŒæ¡ä»¶å›æ”¶ã€‚</td></tr><tr><td><code>@CacheEvict(allEntries=true)</code></td><td><code>@CacheRemoveAll</code></td><td>See <code>@CacheRemove</code>.</td></tr><tr><td><code>@CacheConfig</code></td><td><code>@CacheDefaults</code></td><td>å…è®¸æ‚¨ä»¥ç±»ä¼¼çš„æ–¹å¼é…ç½®ç›¸åŒçš„æ¦‚å¿µã€‚</td></tr></tbody></table><p>JCacheå…·æœ‰ä¸Springçš„<code>CacheResolver</code>æ¥å£ç›¸åŒçš„<code>javax.cache.annotation.CacheResolver</code>ï¼Œä½†JCacheåªæ”¯æŒå•ä¸ªç¼“å­˜ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€ä¸ªç®€å•çš„å®ç°æ˜¯æ ¹æ®æ³¨è§£ä¸Šå£°æ˜çš„åç§°æ£€ç´¢è¦ä½¿ç”¨çš„ç¼“å­˜ã€‚ åº”è¯¥æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœåœ¨æ³¨è§£ä¸­æ²¡æœ‰æŒ‡å®šç¼“å­˜åç§°ï¼Œåˆ™ä¼šè‡ªåŠ¨ç”Ÿæˆé»˜è®¤å€¼ï¼Œå‚çœ‹<code>@CacheResult#cacheName()</code> ã€‚</p><p><code>CacheResolver</code>å®ä¾‹ç”±<code>CacheResolverFactory</code>æ£€ç´¢ã€‚ å¯ä»¥ä¸ºæ¯ä¸ªç¼“å­˜æ“ä½œè‡ªå®šä¹‰å·¥å‚ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@CacheResult(<span class="hljs-params">cacheNames=<span class="hljs-string">&quot;books&quot;</span>, cacheResolverFactory=MyCacheResolverFactory.<span class="hljs-keyword">class</span></span>) (<span class="hljs-params"><span class="hljs-number">1</span></span>)</span><br><br>public Book findBook(ISBN isbn)<br></code></pre></td></tr></table></figure><p><strong>1</strong>ã€ä¸ºæ­¤æ“ä½œè‡ªå®šä¹‰å·¥å‚ã€‚</p><p>å¯¹äºæ‰€æœ‰å¼•ç”¨çš„ç±»ï¼ŒSpringå°è¯•æŸ¥æ‰¾å…·æœ‰ç»™å®šç±»å‹çš„beanã€‚å¦‚æœå­˜åœ¨å¤šä¸ªåŒ¹é…é¡¹ï¼Œåˆ™ä¼šåˆ›å»ºä¸€ä¸ªæ–°å®ä¾‹ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨å¸¸è§„beanç”Ÿå‘½å‘¨æœŸå›è°ƒ(å¦‚ä¾èµ–é¡¹æ³¨å…¥)ã€‚</p><p>é”®ç”±<code>javax.cache.annotation.CacheKeyGenerator</code>æ–¹æ³•ç”Ÿæˆï¼Œå…¶ä½œç”¨ä¸Springçš„<code>KeyGenerator</code>ä¸€æ ·ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰æ–¹æ³•å‚æ•°éƒ½å°†è¢«è€ƒè™‘ï¼Œé™¤éè‡³å°‘æœ‰ä¸€ä¸ªå‚æ•°æ˜¯ç”¨<code>@CacheKey</code>æ³¨è§£ã€‚è¿™ç±»ä¼¼äºSpringçš„<a href="https://sca.aliyun.com/learn/spring/integration/cache/?spm=0.29160081.0.0.51f92e5dCHrGI4#cache-annotations-cacheable-key">è‡ªå®šä¹‰é”®ç”Ÿæˆå£°æ˜</a>ã€‚ä¾‹å¦‚ï¼ŒåŒæ ·çš„æ“ä½œï¼Œä¸€ä¸ªä½¿ç”¨Springçš„æŠ½è±¡ï¼Œå¦ä¸€ä¸ªç”¨JCacheï¼š:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Cacheable</span>(cacheNames=<span class="hljs-string">&quot;books&quot;</span>, key=<span class="hljs-string">&quot;#isbn&quot;</span>)public Book <span class="hljs-built_in">findBook</span>(ISBN isbn, boolean checkWarehouse, boolean includeUsed)<br><span class="hljs-variable">@CacheResult</span>(cacheName=<span class="hljs-string">&quot;books&quot;</span>)public Book <span class="hljs-built_in">findBook</span>(<span class="hljs-variable">@CacheKey</span> ISBN isbn, boolean checkWarehouse, boolean includeUsed)<br></code></pre></td></tr></table></figure><p>æ‚¨è¿˜å¯ä»¥åœ¨æ“ä½œä¸ŠæŒ‡å®š<code>CacheKeyResolver</code>ï¼Œç±»ä¼¼äºæŒ‡å®š<code>CacheResolverFactory</code>çš„æ–¹å¼ã€‚</p><p>JCacheå¯ä»¥ç®¡ç†ç”±æ³¨è§£çš„æ–¹æ³•å¼•å‘çš„å¼‚å¸¸ã€‚è¿™å¯ä»¥é˜²æ­¢ç¼“å­˜çš„æ›´æ–°ï¼Œä½†ä¹Ÿå¯ä»¥å°†å¼‚å¸¸ç¼“å­˜ä¸ºå¤±è´¥çš„æŒ‡ç¤ºå™¨ï¼Œè€Œä¸æ˜¯å†æ¬¡è°ƒç”¨è¯¥æ–¹æ³•ã€‚è®©æˆ‘ä»¬å‡è®¾ï¼Œå¦‚æœISBNçš„ç»“æ„é”™è¯¯ï¼Œåˆ™æŠ›å‡º<code>InvalidIsbnNotFoundException</code>ã€‚è¿™æ˜¯ä¸€ä¸ªæ°¸ä¹…æ€§çš„å¤±è´¥ï¼Œæ²¡æœ‰bookå¯ä»¥ç”¨è¿™æ ·çš„å‚æ•°æ£€ç´¢ã€‚ä¸‹é¢æŠ›å‡ºç¼“å­˜å¼‚å¸¸ï¼Œä»¥ä¾¿ä½¿ç”¨ç›¸åŒçš„æ— æ•ˆISBNè¿›è¡Œè¿›ä¸€æ­¥è°ƒç”¨ï¼Œç›´æ¥æŠ›å‡ºç¼“å­˜çš„å¼‚å¸¸ï¼Œè€Œä¸æ˜¯å†æ¬¡è°ƒç”¨è¯¥æ–¹æ³•ã€‚:</p><figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs d"><span class="hljs-keyword">@CacheResult</span>(cacheName=<span class="hljs-string">&quot;books&quot;</span>, exceptionCacheName=<span class="hljs-string">&quot;failures&quot;</span><br><br>            cachedExceptions = InvalidIsbnNotFoundException.<span class="hljs-keyword">class</span>)<br><br><span class="hljs-keyword">public</span> Book findBook(ISBN isbn)<br></code></pre></td></tr></table></figure><h4 id="5-3-2-å¯ç”¨-JSR-107-æ”¯æŒ"><a href="#5-3-2-å¯ç”¨-JSR-107-æ”¯æŒ" class="headerlink" title="5.3.2. å¯ç”¨ JSR-107 æ”¯æŒ"></a>5.3.2. å¯ç”¨ JSR-107 æ”¯æŒ</h4><p>é™¤äº†Springçš„å£°æ˜æ€§æ³¨è§£æ”¯æŒä¹‹å¤–ï¼Œä¸éœ€è¦åšä»»ä½•å…·ä½“çš„å·¥ä½œæ¥å¯ç”¨JSR-107æ”¯æŒã€‚å¦‚æœ<code>spring-context-support</code>æ¨¡å—å·²ç»åœ¨ç±»åŠ è½½è·¯å¾„ä¸­ï¼Œé‚£ä¹ˆä½¿ç”¨<code>@EnableCaching</code>æˆ–è€…<code>cache:annotation-driven</code>å…ƒç´ éƒ½å°†è‡ªåŠ¨å¯ç”¨JCacheæ”¯æŒã€‚</p><p>æ ¹æ®æ‚¨çš„ä½¿ç”¨æƒ…å†µï¼Œé€‰æ‹©ä½¿ç”¨ä¸å¦ç”±ä½ é€‰æ‹©ã€‚æ‚¨ç”šè‡³å¯ä»¥ä½¿ç”¨JSR-107 APIå’Œå…¶ä»–ä½¿ç”¨Springè‡ªå·±çš„æ³¨è§£æ¥æ··åˆä½¿ç”¨æœåŠ¡ã€‚ä½†æ˜¯ï¼Œè¯·æ³¨æ„ï¼Œå¦‚æœè¿™äº›æœåŠ¡å½±å“åˆ°ç›¸åŒçš„ç¼“å­˜ï¼Œåˆ™åº”ä½¿ç”¨ä¸€è‡´çš„å’Œç›¸åŒçš„é”®ç”Ÿæˆå®ç°ã€‚</p><h3 id="5-4-å£°æ˜å¼åŸºäºXMLçš„ç¼“å­˜"><a href="#5-4-å£°æ˜å¼åŸºäºXMLçš„ç¼“å­˜" class="headerlink" title="5.4. å£°æ˜å¼åŸºäºXMLçš„ç¼“å­˜"></a>5.4. å£°æ˜å¼åŸºäºXMLçš„ç¼“å­˜</h3><p>å¦‚æœæ³¨è§£ä¸æ˜¯å¯é€‰çš„(ä¸èƒ½è®¿é—®æºä»£ç æˆ–æ²¡æœ‰å¤–éƒ¨ç )ï¼Œåˆ™å¯ä»¥ä½¿ç”¨XMLè¿›è¡Œå£°æ˜æ€§ç¼“å­˜ã€‚å› æ­¤ï¼Œæ‚¨ä¸å¿…å¯¹ç¼“å­˜æ–¹æ³•è¿›è¡Œæ³¨è§£ï¼Œè€Œæ˜¯åœ¨å¤–éƒ¨æŒ‡å®šç›®æ ‡æ–¹æ³•å’Œç¼“å­˜æŒ‡ä»¤(ç±»ä¼¼äºå£°æ˜æ€§äº‹åŠ¡ç®¡ç†<a href="https://sca.aliyun.com/learn/spring/integration/cache/data-access.html#transaction-declarative-first-example">advice</a>)ã€‚ä¸Šä¸€èŠ‚ä¸­çš„ç¤ºä¾‹å¯ä»¥è½¬æ¢ä¸ºä»¥ä¸‹ç¤ºä¾‹:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- the service we want to make cacheable --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;bookService&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;x.y.service.DefaultBookService&quot;</span>/&gt;</span><br><span class="hljs-comment">&lt;!-- cache definitions --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">cache:advice</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;cacheAdvice&quot;</span> <span class="hljs-attr">cache-manager</span>=<span class="hljs-string">&quot;cacheManager&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">cache:caching</span> <span class="hljs-attr">cache</span>=<span class="hljs-string">&quot;books&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">cache:cacheable</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;findBook&quot;</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;#isbn&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">cache:cache-evict</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;loadBooks&quot;</span> <span class="hljs-attr">all-entries</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">cache:caching</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">cache:advice</span>&gt;</span><br><span class="hljs-comment">&lt;!-- apply the cacheable behavior to all BookService interfaces --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">aop:config</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">aop:advisor</span> <span class="hljs-attr">advice-ref</span>=<span class="hljs-string">&quot;cacheAdvice&quot;</span> <span class="hljs-attr">pointcut</span>=<span class="hljs-string">&quot;execution(* x.y.BookService.*(..))&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">aop:config</span>&gt;</span><br><span class="hljs-comment">&lt;!-- cache manager definition omitted --&gt;</span><br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„é…ç½®ä¸­ï¼Œ<code>bookService</code>æ˜¯å¯ä»¥ç¼“å­˜çš„ã€‚ç¼“å­˜è¯­ä¹‰è¢«ä¿å­˜åœ¨<code>cache:advice</code>å®šä¹‰ä¸­ï¼ŒæŒ‡å®šäº†æ–¹æ³•<code>findBooks</code>ç”¨äºå°†æ•°æ®æ”¾å…¥ç¼“å­˜ï¼Œè€Œæ–¹æ³•<code>loadBooks</code>ç”¨äºå›æ”¶æ•°æ®ã€‚è¿™ä¸¤ä¸ªå®šä¹‰éƒ½å¯ä»¥ä½¿ç”¨ <code>books</code>ç¼“å­˜ã€‚</p><p><code>aop:config</code>å®šä¹‰ä½¿ç”¨AspectJåˆ‡ç‚¹è¡¨è¾¾å¼å°†ç¼“å­˜é€šçŸ¥åº”ç”¨äºç¨‹åºä¸­çš„é€‚å½“çš„åˆ‡ç‚¹(æ›´å¤šä¿¡æ¯å‚çœ‹<a href="https://sca.aliyun.com/learn/spring/integration/cache/core.html#aop">Springé¢å‘åˆ‡é¢ç¼–ç¨‹</a>)ã€‚åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œå°†è€ƒè™‘<code>BookService</code>ä¸­çš„æ‰€æœ‰æ–¹æ³•ï¼Œå¹¶å°†ç¼“å­˜adviceåº”ç”¨äºå®ƒä»¬ã€‚</p><p>å£°æ˜æ€§XMLç¼“å­˜æ”¯æŒæ‰€æœ‰åŸºäºæ³¨è§£çš„æ¨¡å‹ï¼Œå› æ­¤åœ¨ä¸¤è€…ä¹‹é—´è½¬æ¢åº”è¯¥ç›¸å½“ç®€å•ã€‚åœ¨åŒä¸€ä¸ªåº”ç”¨ç¨‹åºä¸­å¯ä»¥è¿›ä¸€æ­¥ä½¿ç”¨å®ƒä»¬ã€‚åŸºäºXMLçš„æ–¹æ³•ä¸ä¼šè®¾è®¡åˆ°ç›®æ ‡ä»£ç ï¼Œä½†æ˜¯ç¼–å†™å®ƒéå¸¸å†—é•¿æ— èŠã€‚åœ¨å¤„ç†å…·æœ‰é’ˆå¯¹ç¼“å­˜çš„é‡è½½æ–¹æ³•çš„ç±»æ—¶ï¼Œç¡®å®šæ­£ç¡®çš„æ–¹æ³•ç¡®å®éœ€è¦é¢å¤–å·¥ä½œï¼Œå› ä¸ºè¯¥æ–¹æ³•å‚æ•°ä¸èƒ½å¾ˆå¥½çš„è¢«è¾¨åˆ«ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œ åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨AspectJåˆ‡å…¥ç‚¹æ¥æŒ‘é€‰ç›®æ ‡æ–¹æ³•å¹¶åº”ç”¨é€‚å½“çš„ç¼“å­˜åŠŸèƒ½ã€‚ç„¶è€Œï¼Œé€šè¿‡XMLï¼Œæ›´å®¹æ˜“åº”ç”¨åœ¨åŒ…&#x2F;ç»„&#x2F;æ¥å£èŒƒå›´ä¸Šçš„ç¼“å­˜(å†æ¬¡å› ä¸ºAspectJåˆ‡ç‚¹)å’Œåˆ›å»ºç±»ä¼¼æ¨¡æ¿çš„å®šä¹‰(å¦‚æˆ‘ä»¬åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­é€šè¿‡ç¼“å­˜å®šä¹‰ç›®æ ‡çš„<code>cache:definitions</code>å±æ€§ã€‚</p><h3 id="5-5-é…ç½®ç¼“å­˜çš„å­˜å‚¨"><a href="#5-5-é…ç½®ç¼“å­˜çš„å­˜å‚¨" class="headerlink" title="5.5. é…ç½®ç¼“å­˜çš„å­˜å‚¨"></a>5.5. é…ç½®ç¼“å­˜çš„å­˜å‚¨</h3><p>ç¼“å­˜æŠ½è±¡é›†æˆäº†å¤šä¸ªå­˜å‚¨åŠŸèƒ½ï¼Œå¯ä»¥å¼€ç®±å³ç”¨ã€‚ä¸ºäº†ä½¿ç”¨ä»–ä»¬ï¼Œæ‚¨éœ€è¦å£°æ˜ä¸€ä¸ªé€‚å½“çš„<code>CacheManager</code> ï¼ˆä¸€ä¸ªæ§åˆ¶å’Œç®¡ç†<code>Cache</code>å®ä¾‹çš„å®ä½“ï¼Œå¯ç”¨äºæ£€ç´¢è¿™äº›å®ä¾‹ä»¥è¿›è¡Œå­˜å‚¨ï¼‰ã€‚</p><h4 id="5-5-1-åŸºäºJDKConcurrentMap-ç¼“å­˜"><a href="#5-5-1-åŸºäºJDKConcurrentMap-ç¼“å­˜" class="headerlink" title="5.5.1. åŸºäºJDKConcurrentMap ç¼“å­˜"></a>5.5.1. åŸºäºJDK<code>ConcurrentMap</code> ç¼“å­˜</h4><p>åŸºäºJDKçš„<code>Cache</code>å®ç°ä½äº<code>org.springframework.cache.concurrent</code>åŒ…ä¸‹ã€‚å®ƒå…è®¸æ‚¨ä½¿ç”¨<code>ConcurrentHashMap</code>ä½œä¸ºæ”¯æŒ<code>Cache</code>å­˜å‚¨ã€‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•é…ç½®ä¸¤ä¸ªç¼“å­˜:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- simple cache manager --&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;cacheManager&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.cache.support.SimpleCacheManager&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;caches&quot;</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">set</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.cache.concurrent.ConcurrentMapCacheFactoryBean&quot;</span> <span class="hljs-attr">p:name</span>=<span class="hljs-string">&quot;default&quot;</span>/&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.cache.concurrent.ConcurrentMapCacheFactoryBean&quot;</span> <span class="hljs-attr">p:name</span>=<span class="hljs-string">&quot;books&quot;</span>/&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">set</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç æ®µä½¿ç”¨<code>SimpleCacheManager</code>ä¸ºåä¸º<code>default</code>å’Œ<code>books</code>çš„ä¸¤ä¸ªåµŒå¥—çš„<code>ConcurrentMapCache</code>å®ä¾‹åˆ›å»º<code>CacheManager</code>ã€‚è¯·æ³¨æ„ï¼Œè¿™äº›åç§°æ˜¯ä¸ºæ¯ä¸ªç¼“å­˜ç›´æ¥é…ç½®çš„ã€‚</p><p>ç”±äºç¼“å­˜æ˜¯ç”±åº”ç”¨ç¨‹åºåˆ›å»ºçš„ï¼Œå› æ­¤å®ƒè¢«ç»‘å®šåˆ°å…¶ç”Ÿå‘½å‘¨æœŸï¼Œä½¿å…¶é€‚åˆäºåŸºæœ¬ç”¨ä¾‹ã€æµ‹è¯•æˆ–ç®€å•åº”ç”¨ç¨‹åºã€‚é«˜é€Ÿç¼“å­˜çš„è§„æ¨¡å¾ˆå¤§ï¼Œè€Œä¸”é€Ÿåº¦éå¸¸å¿«ï¼Œä½†å®ƒä¸æä¾›ä»»ä½•ç®¡ç†æˆ–æŒä¹…æ€§åŠŸèƒ½ï¼Œä¹Ÿæ²¡æœ‰ä»»ä½•å›æ”¶çš„ç¨‹åºã€‚</p><h4 id="5-5-2-åŸºäºEhcacheçš„ç¼“å­˜"><a href="#5-5-2-åŸºäºEhcacheçš„ç¼“å­˜" class="headerlink" title="5.5.2. åŸºäºEhcacheçš„ç¼“å­˜"></a>5.5.2. åŸºäºEhcacheçš„ç¼“å­˜</h4><p>Ehcache 3.xå®Œå…¨ä¸JSR-107å…¼å®¹ï¼Œ ä¸éœ€è¦ä¸“é—¨çš„æ”¯æŒã€‚</p><p>Ehcache 2.xå®ç°åœ¨<code>org.springframework.cache.ehcache</code>åŒ…ä¸­ã€‚åŒæ ·åœ°ï¼Œè¦ä½¿ç”¨å®ƒï¼Œéœ€è¦ç®€å•åœ°å£°æ˜é€‚å½“çš„ <code>CacheManager</code>ã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;cacheManager&quot;</span>        <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.cache.ehcache.EhCacheCacheManager&quot;</span> <span class="hljs-attr">p:cache-manager-ref</span>=<span class="hljs-string">&quot;ehcache&quot;</span>/&gt;</span><br><span class="hljs-comment">&lt;!-- EhCache library setup --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;ehcache&quot;</span>        <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.cache.ehcache.EhCacheManagerFactoryBean&quot;</span> <span class="hljs-attr">p:config-location</span>=<span class="hljs-string">&quot;ehcache.xml&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><p>æ­¤è®¾ç½®å¼•å¯¼Spring IoCå†…éƒ¨çš„ehcacheåº“ï¼ˆé€šè¿‡<code>ehcache</code> beanï¼‰ï¼Œç„¶åå°†å…¶è¿æ¥åˆ°ä¸“ç”¨çš„<code>CacheManager</code>å®ç°ä¸­ã€‚ è¯·æ³¨æ„ï¼Œä»<code>ehcache.xml</code>è¯»å–æ•´ä¸ªç‰¹å®šäº<code>ehcache</code>çš„é…ç½®ã€‚</p><h4 id="5-5-3-Caffeine-Cache"><a href="#5-5-3-Caffeine-Cache" class="headerlink" title="5.5.3. Caffeine Cache"></a>5.5.3. Caffeine Cache</h4><p>Caffeineæ˜¯Java 8é‡å†™äº†Guavaçš„ç¼“å­˜ï¼Œä»–çš„å®ç°åœ¨<code>org.springframework.cache.caffeine</code>åŒ…ä¸­ï¼Œå¹¶ä¸”æä¾›äº†è®¿é—®Caffeineç‰¹æ€§çš„æ–¹æ³•ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹é…ç½®ä¸€ä¸ªæŒ‰éœ€åˆ›å»ºç¼“å­˜çš„<code>CacheManager</code>:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;bean <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;cacheManager&quot;</span><br><br>        <span class="hljs-attribute">class</span>=<span class="hljs-string">&quot;org.springframework.cache.caffeine.CaffeineCacheManager&quot;</span>/&gt;<br></code></pre></td></tr></table></figure><p>è¿˜å¯ä»¥æä¾›ç¼“å­˜ä»¥æ˜¾å¼ä½¿ç”¨ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåªæœ‰manageræ‰èƒ½æä¾›è¿™äº›å†…å®¹ã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œ:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;cacheManager&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.cache.caffeine.CaffeineCacheManager&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;caches&quot;</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">set</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>default<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>books<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">set</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p>Caffeine <code>CacheManager</code>ä¹Ÿæ”¯æŒè‡ªå®šä¹‰çš„<code>Caffeine</code> å’Œ <code>CacheLoader</code>. æŸ¥é˜… <a href="https://github.com/ben-manes/caffeine/wiki">Caffeine æ–‡æ¡£</a>äº†è§£æ›´å¤šä¿¡æ¯ã€‚</p><h4 id="5-5-4-åŸºäºGemFireçš„ç¼“å­˜"><a href="#5-5-4-åŸºäºGemFireçš„ç¼“å­˜" class="headerlink" title="5.5.4. åŸºäºGemFireçš„ç¼“å­˜"></a>5.5.4. åŸºäºGemFireçš„ç¼“å­˜</h4><p>GemFireæ˜¯ä¸€ä¸ªé¢å‘å†…å­˜&#x2F;ç£ç›˜å­˜å‚¨çš„å…¨å±€çš„å¤‡ä»½æ•°æ®åº“ï¼Œå®ƒå…·æœ‰å¯ä¼¸ç¼©çš„ã€å¯æŒç»­çš„ã€å¯æ‰©å±•çš„ã€å…·æœ‰å†…ç½®æ¨¡å¼è®¢é˜…é€šçŸ¥åŠŸèƒ½ç­‰ç­‰ç‰¹æ€§ã€‚å…¨å±€å¤åˆ¶çš„æ•°æ®åº“ã€‚å¹¶æä¾›å…¨åŠŸèƒ½çš„è¾¹ç¼˜ç¼“å­˜ã€‚ æœ‰å…³å¦‚ä½•å°†GemFireç”¨ä½œ<code>CacheManager</code>ï¼ˆä»¥åŠæ›´å¤šï¼‰çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://docs.spring.io/spring-gemfire/docs/current/reference/html/">Spring Data GemFireå‚è€ƒæ–‡æ¡£</a>ã€‚</p><h4 id="5-5-5-JSR-107-ç¼“å­˜"><a href="#5-5-5-JSR-107-ç¼“å­˜" class="headerlink" title="5.5.5. JSR-107 ç¼“å­˜"></a>5.5.5. JSR-107 ç¼“å­˜</h4><p>JSR-107å…¼å®¹çš„ç¼“å­˜ä¹Ÿå¯ç”¨äºSpringçš„ç¼“å­˜æŠ½è±¡ã€‚JCacheå®ç°åœ¨<code>org.springframework.cache.jcache</code> åŒ…ä¸­.</p><p>åŒæ ·ï¼Œè¦ä½¿ç”¨å®ƒï¼Œéœ€è¦ç®€å•åœ°å£°æ˜é€‚å½“çš„<code>CacheManager</code>ã€‚ç®€å•ç¤ºä¾‹å¦‚ä¸‹:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;cacheManager&quot;</span>        <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.cache.jcache.JCacheCacheManager&quot;</span>        <span class="hljs-attr">p:cache-manager-ref</span>=<span class="hljs-string">&quot;jCacheManager&quot;</span>/&gt;</span><br><span class="hljs-comment">&lt;!-- JSR-107 cache manager setup  --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;jCacheManager&quot;</span> <span class="hljs-attr">...</span>/&gt;</span><br></code></pre></td></tr></table></figure><h4 id="5-5-6-å¤„ç†æ²¡æœ‰åç«¯çš„ç¼“å­˜"><a href="#5-5-6-å¤„ç†æ²¡æœ‰åç«¯çš„ç¼“å­˜" class="headerlink" title="5.5.6.å¤„ç†æ²¡æœ‰åç«¯çš„ç¼“å­˜"></a>5.5.6.å¤„ç†æ²¡æœ‰åç«¯çš„ç¼“å­˜</h4><p>æœ‰æ—¶åœ¨åˆ‡æ¢ç¯å¢ƒæˆ–è¿›è¡Œæµ‹è¯•æ—¶ï¼Œ å¯èƒ½ä¼šåªå£°æ˜ç¼“å­˜ï¼Œ è€Œæ²¡æœ‰é…ç½®å®é™…çš„åç«¯ç¼“å­˜ã€‚ç”±äºè¿™æ˜¯ä¸€ä¸ªæ— æ•ˆçš„é…ç½®ï¼Œ åœ¨è¿è¡Œæ—¶å°†å¼•å‘å¼‚å¸¸ï¼Œ å› ä¸ºç¼“å­˜åŸºç¡€ç»“æ„æ— æ³•æ‰¾åˆ°åˆé€‚çš„å­˜å‚¨ã€‚åœ¨è¿™æ ·çš„æƒ…å†µä¸‹ï¼Œ ä¸å…¶åˆ é™¤ç¼“å­˜å£°æ˜(è¿™å¯èƒ½ä¼šå¾ˆç¹ç)ï¼Œ ä½ ä¸å¦‚å£°æ˜ä¸€ä¸ªç®€å•çš„ï¼Œä¸æ‰§è¡Œç¼“å­˜çš„è™šæ‹Ÿç¼“å­˜ï¼Œ å³å¼ºåˆ¶æ¯æ¬¡æ‰§è¡Œç¼“å­˜çš„æ–¹æ³•ã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œ:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;cacheManager&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.cache.support.CompositeCacheManager&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;cacheManagers&quot;</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">bean</span>=<span class="hljs-string">&quot;jdkCache&quot;</span>/&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">bean</span>=<span class="hljs-string">&quot;gemfireCache&quot;</span>/&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;fallbackToNoOpCache&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p><code>CompositeCacheManager</code>ä½¿ç”¨äº†å¤šä¸ª<code>CacheManager</code>å®ä¾‹ã€‚æ­¤å¤–ï¼Œé€šè¿‡<code>fallbackToNoOpCache</code> æ ‡å¿—ï¼Œæ·»åŠ äº†ä¸€ä¸ªæ²¡æœ‰opçš„ç¼“å­˜ï¼Œä¸ºæ‰€æœ‰çš„å®šä¹‰æ²¡æœ‰è¢«é…ç½®çš„ç¼“å­˜ç®¡ç†å™¨å¤„ç†ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨<code>jdkCache</code>æˆ–<code>gemfireCache</code>(ä¸Šé¢é…ç½®)ä¸­æ‰¾ä¸åˆ°çš„æ¯ä¸ªç¼“å­˜å®šä¹‰éƒ½å°†ç”±æ— opç¼“å­˜æ¥å¤„ç†ï¼Œå¹¶ä¸”ä¸ä¼šå­˜å‚¨ç›®æ ‡æ–¹æ³•çš„ä¿¡æ¯è€Œæ–¹æ³•æ¯æ¬¡éƒ½ä¼šè¢«æ‰§è¡Œï¼ˆå°±æ˜¯å¤šé…ç½®æˆå¯æ‰§è¡Œçš„æ— ç¼“å­˜æ“ä½œï¼‰ã€‚</p><h3 id="5-6-å„ç§å„æ ·çš„åç«¯ç¼“å­˜æ’ä»¶"><a href="#5-6-å„ç§å„æ ·çš„åç«¯ç¼“å­˜æ’ä»¶" class="headerlink" title="5.6. å„ç§å„æ ·çš„åç«¯ç¼“å­˜æ’ä»¶"></a>5.6. å„ç§å„æ ·çš„åç«¯ç¼“å­˜æ’ä»¶</h3><p>æ˜¾ç„¶ï¼Œæœ‰å¤§é‡çš„ç¼“å­˜äº§å“å¯ä»¥ç”¨ä½œåç«¯å­˜å‚¨ã€‚è¦å°†å®ƒä»¬é›†æˆï¼Œéœ€è¦æä¾›<code>CacheManager</code>å’Œ<code>Cache</code>å®ç°ï¼Œå› ä¸ºä¸å¹¸çš„æ˜¯æ²¡æœ‰å¯ç”¨çš„æ ‡å‡†ï¼Œæˆ‘ä»¬å¯ä»¥æ”¹ç”¨å®ƒã€‚è¿™å¬èµ·æ¥å¯èƒ½æ¯”ä½¿ç”¨å®ƒæ›´éš¾ï¼Œå› ä¸ºåœ¨å®è·µä¸­ï¼Œç±»å¾€å¾€æ˜¯ç®€å•çš„<a href="https://en.wikipedia.org/wiki/Adapter_pattern">adapters</a>ï¼Œå®ƒå°†ç¼“å­˜æŠ½è±¡æ¡†æ¶æ˜ å°„åˆ°å­˜å‚¨APIçš„é¡¶éƒ¨ï¼Œå°±åƒ<code>ehcache</code>ç±»å¯ä»¥æ˜¾ç¤ºçš„é‚£æ ·ã€‚ å¤§å¤šæ•°<code>CacheManager</code>ç±»å¯ä»¥ä½¿ç”¨<code>org.springframework.cache.support</code>åŒ…ä¸­çš„ç±»ï¼Œå¦‚<code>AbstractCacheManager</code>ï¼Œå®ƒè´Ÿè´£å¤„ç†æ ·æ¿ä»£ç ï¼Œåªç•™ä¸‹å®é™…çš„æ˜ å°„å³å¯ç»“æŸå·¥ä½œã€‚æˆ‘ä»¬å¸Œæœ›ï¼Œæä¾›ä¸Springé›†æˆçš„åº“èƒ½å¤ŸåŠæ—¶å¡«è¡¥è¿™ä¸€å°çš„é…ç½®ç¼ºå£ã€‚</p><h3 id="5-7-æˆ‘å¯ä»¥å¦‚ä½•è®¾ç½®TTL-TTI-Eviction-policy-XXXç‰¹æ€§"><a href="#5-7-æˆ‘å¯ä»¥å¦‚ä½•è®¾ç½®TTL-TTI-Eviction-policy-XXXç‰¹æ€§" class="headerlink" title="5.7. æˆ‘å¯ä»¥å¦‚ä½•è®¾ç½®TTL&#x2F;TTI&#x2F;Eviction policy&#x2F;XXXç‰¹æ€§?"></a>5.7. æˆ‘å¯ä»¥å¦‚ä½•è®¾ç½®TTL&#x2F;TTI&#x2F;Eviction policy&#x2F;XXXç‰¹æ€§?</h3><p>ç›´æ¥é€šè¿‡ç¼“å­˜æä¾›ç¨‹åºã€‚ ç¼“å­˜æŠ½è±¡æ˜¯æŠ½è±¡ï¼Œè€Œä¸æ˜¯ç¼“å­˜å®ç°ã€‚ æ‚¨æ­£åœ¨ä½¿ç”¨çš„è§£å†³æ–¹æ¡ˆå¯èƒ½æ”¯æŒä¸åŒçš„æ•°æ®ç­–ç•¥å’Œä¸åŒçš„æ‹“æ‰‘ç»“æ„ï¼Œè€Œå…¶ä»–è§£å†³æ–¹æ¡ˆä¸ä¼šè¿™æ ·åš(ä¾‹å¦‚ï¼ŒJDK <code>ConcurrentHashMap</code> - æš´éœ²åœ¨ç¼“å­˜æŠ½è±¡ä¸­å°†æ˜¯æ— ç”¨çš„ï¼Œå› ä¸ºæ²¡æœ‰åç«¯æ”¯æŒ)ã€‚åº”è¯¥é€šè¿‡åç«¯ç¼“å­˜ï¼ˆé…ç½®æ—¶ï¼‰æˆ–é€šè¿‡å…¶æœ¬æœºAPIç›´æ¥æ§åˆ¶æ­¤ç±»åŠŸèƒ½ã€‚</p><blockquote><p>Rod Johnson, Juergen Hoeller, Keith Donald, Colin Sampaleanu, Rob Harrop, Thomas Risberg, Alef Arendsen, Darren Davison, Dmitriy Kopylenko, Mark Pollack, Thierry Templier, Erwin Vervaet, Portia Tung, Ben Hale, Adrian Colyer, John Lewis, Costin Leau, Mark Fisher, Sam Brannen, Ramnivas Laddad, Arjen Poutsma, Chris Beams, Tareq Abedrabbo, Andy Clement, Dave Syer, Oliver Gierke, Rossen Stoyanchev, Phillip Webb, Rob Winch, Brian Clozel, Stephane Nicoll, Sebastien Deleuze, Jay Bryant, Mark Paluch</p></blockquote><blockquote><p>Copyright Â© 2002 - 2024 VMware, Inc. All Rights Reserved.</p></blockquote><blockquote><p>Copies of this document may be made for your own use and for distribution to others, provided that you do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically.</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>Spring æ•™ç¨‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Spring</tag>
      
      <tag>ç¼“å­˜</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å®šæ—¶ä»»åŠ¡</title>
    <link href="/post/5eba1caa-2b0b-423d-9e75-b17d9e3086ba/"/>
    <url>/post/5eba1caa-2b0b-423d-9e75-b17d9e3086ba/</url>
    
    <content type="html"><![CDATA[<h1 id="å®šæ—¶ä»»åŠ¡"><a href="#å®šæ—¶ä»»åŠ¡" class="headerlink" title="å®šæ—¶ä»»åŠ¡"></a>å®šæ—¶ä»»åŠ¡</h1><p>Spring æ•™ç¨‹</p><hr><h2 id="6-æ‰§è¡Œä»»åŠ¡å’Œä»»åŠ¡è®¡åˆ’"><a href="#6-æ‰§è¡Œä»»åŠ¡å’Œä»»åŠ¡è®¡åˆ’" class="headerlink" title="6. æ‰§è¡Œä»»åŠ¡å’Œä»»åŠ¡è®¡åˆ’"></a>6. æ‰§è¡Œä»»åŠ¡å’Œä»»åŠ¡è®¡åˆ’</h2><p>Springæ¡†æ¶åˆ†åˆ«ä¸ºå¼‚æ­¥æ‰§è¡Œã€<code>TaskExecutor</code>çš„ä»»åŠ¡è°ƒåº¦å’Œ<code>TaskScheduler</code>æ¥å£æä¾›äº†æŠ½è±¡ã€‚Springè¿˜å…·æœ‰æ”¯æŒçº¿ç¨‹æ± æˆ–å§”æ´¾åˆ°åº”ç”¨ç¨‹åºæœåŠ¡å™¨ç¯å¢ƒCommonJçš„æ¥å£å®ç°ã€‚æœ€ç»ˆï¼Œ åœ¨Java SE 5ã€Java SE 6å’ŒJava EEæœ‰å·®å¼‚çš„ç¯å¢ƒéƒ½å®ç°äº†ä¸€å¥—å…¬å…±çš„æŠ½è±¡æ¥å£ã€‚</p><p>Springè¿˜å…·æœ‰é›†æˆç±»ï¼Œæ”¯æŒä½¿ç”¨<code>Timer</code>ï¼ˆJDKè‡ª1.3ä»¥æ¥çš„ä¸€éƒ¨åˆ†ï¼‰å’ŒQuartz Schedulerï¼ˆ<a href="http://quartz-scheduler.org/">http://quartz-scheduler.org</a>ï¼‰è¿›è¡Œè°ƒåº¦ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨<code>FactoryBean</code>åŒæ—¶åˆ†åˆ«å¯¹<code>Timer</code>æˆ–<code>Trigger</code>å®ä¾‹è¿›è¡Œå¯é€‰å¼•ç”¨æ¥è®¾ç½®è¿™ä¸¤ä¸ªè°ƒåº¦ç¨‹åºã€‚ æ­¤å¤–ï¼Œè¿˜æä¾›äº†Quartz Schedulerå’Œ <code>Timer</code>çš„ä¾¿æ·ç±»ï¼Œå®ƒå…è®¸æ‚¨è°ƒç”¨ç°æœ‰ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•ï¼ˆç±»ä¼¼äºæ­£å¸¸çš„<code>MethodInvokingFactoryBean</code>æ“ä½œï¼‰ã€‚</p><h3 id="6-1-Spring-TaskExecutor-æŠ½è±¡"><a href="#6-1-Spring-TaskExecutor-æŠ½è±¡" class="headerlink" title="6.1. Spring TaskExecutor æŠ½è±¡"></a>6.1. Spring <code>TaskExecutor</code> æŠ½è±¡</h3><p>Executorsæ˜¯JDKä¸­ä½¿ç”¨çš„çº¿ç¨‹æ± çš„åå­—ï¼Œexecutoræ„æ€æ˜¯æ— æ³•ä¿è¯åº•å±‚çš„å®ç°å®é™…æ˜¯ä¸€ä¸ªæ± ï¼Œä¸€ä¸ªexecutorå¯ä»¥æ˜¯å•çº¿ç¨‹çš„æˆ–è€…æ˜¯åŒæ­¥çš„ã€‚Springçš„æŠ½è±¡éšè—äº†Java SEå’ŒJava EEç¯å¢ƒä¹‹é—´çš„å®ç°ç»†èŠ‚ã€‚</p><p>Springçš„<code>TaskExecutor</code>æ¥å£å’Œ<code>java.util.concurrent.Executor</code>æ¥å£æ˜¯ç›¸åŒçš„ã€‚å®é™…ä¸Šï¼Œä»–å­˜åœ¨çš„ä¸»è¦åŸå› æ˜¯åœ¨ä½¿ç”¨çº¿ç¨‹æ± æ—¶å¯¹Java 5æŠ½è±¡çš„ç¨‹åº¦ä¸åŒã€‚è¯¥æ¥å£æœ‰ä¸€ä¸ª (<code>execute(Runnable task)</code>)æ–¹æ³•,å®ƒæ ¹æ®çº¿ç¨‹æ± çš„è¯­ä¹‰å’Œé…ç½®æ¥å—æ‰§è¡Œä»»åŠ¡.</p><p>æœ€åˆåˆ›å»º<code>TaskExecutor</code>æ˜¯ä¸ºäº†ç»™å…¶ä»–Springç»„ä»¶æä¾›æ‰€éœ€çš„çº¿ç¨‹æ± æŠ½è±¡ã€‚è¯¸å¦‚<code>ApplicationEventMulticaster</code>ï¼ŒJMSçš„<code>AbstractMessageListenerContainer</code>å’ŒQuartzé›†æˆä¹‹ç±»çš„ç»„ä»¶éƒ½ä½¿ç”¨ <code>TaskExecutor</code>æŠ½è±¡æ¥æ± åŒ–çº¿ç¨‹ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæ‚¨çš„beanéœ€è¦çº¿ç¨‹æ± è¡Œä¸ºï¼Œæ‚¨ä¹Ÿå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦ä½¿ç”¨æ­¤æŠ½è±¡ã€‚</p><h4 id="6-1-1-TaskExecutor-ç±»å‹"><a href="#6-1-1-TaskExecutor-ç±»å‹" class="headerlink" title="6.1.1. TaskExecutor ç±»å‹"></a>6.1.1. <code>TaskExecutor</code> ç±»å‹</h4><p>SpringåŒ…å«è®¸å¤šTaskExecutorçš„é¢„æ„å»ºå®ç°ã€‚å¾ˆå¯èƒ½ï¼Œä½ æ°¸è¿œä¸éœ€è¦å®ç°è‡ªå·±çš„ã€‚ Springæä¾›çš„å˜ä½“å¦‚ä¸‹:</p><ul><li><code>SyncTaskExecutor</code>: æ­¤å®ç°ä¸ä¼šå¼‚æ­¥æ‰§è¡Œè°ƒç”¨ã€‚ ç›¸åï¼Œæ¯æ¬¡è°ƒç”¨éƒ½å‘ç”Ÿåœ¨è°ƒç”¨çº¿ç¨‹ä¸­ã€‚ å®ƒä¸»è¦ç”¨äºä¸éœ€è¦å¤šçº¿ç¨‹çš„æƒ…å†µï¼Œä¾‹å¦‚åœ¨ç®€å•çš„æµ‹è¯•ç”¨ä¾‹ä¸­ã€‚</li><li><code>SimpleAsyncTaskExecutor</code>: æ­¤å®ç°ä¸ä¼šé‡ç”¨ä»»ä½•çº¿ç¨‹ã€‚ ç›¸åï¼Œå®ƒä¸ºæ¯æ¬¡è°ƒç”¨å¯åŠ¨ä¸€ä¸ªæ–°çº¿ç¨‹ã€‚ ä½†æ˜¯ï¼Œå®ƒç¡®å®æ”¯æŒå¹¶å‘é™åˆ¶ï¼Œè¯¥é™åˆ¶ä¼šé˜»æ­¢ä»»ä½•è¶…å‡ºé™åˆ¶çš„è°ƒç”¨ï¼Œç›´åˆ°é‡Šæ”¾ä¸€ä¸ªæ’æ§½ã€‚ å¦‚æœæ‚¨æ­£åœ¨å¯»æ‰¾çœŸæ­£çš„æ± ï¼Œè¯·å‚é˜…æ­¤åˆ—è¡¨ä¸­ç¨åçš„<code>ThreadPoolTaskExecutor</code>ã€‚</li><li><code>ConcurrentTaskExecutor</code>: æ­¤å®ç°æ˜¯ <code>java.util.concurrent.Executor</code>å¯¹è±¡çš„é€‚é…å™¨ã€‚æœ‰ä¸€ä¸ªå¯é€‰çš„<code>ThreadPoolTaskExecutor</code>ï¼Œå®ƒå°† <code>Executor</code>é…ç½®å‚æ•°ä½œä¸ºbeanå±æ€§å…¬å¼€ã€‚å¾ˆå°‘éœ€è¦ä½¿ç”¨åˆ°<code>ConcurrentTaskExecutor</code>ï¼Œä½†å¦‚æœ<code>ThreadPoolTaskExecutor</code>ä¸å¤Ÿçµæ´»ï¼Œé‚£ä¹ˆä½ å°±éœ€è¦<code>ConcurrentTaskExecutor</code>ã€‚</li><li><code>ThreadPoolTaskExecutor</code>: è¿™ç§å®ç°æ˜¯æœ€å¸¸ç”¨çš„ã€‚ å®ƒå…¬å¼€äº†beanå±æ€§ï¼Œç”¨äºé…ç½®<code>java.util.concurrent.ThreadPoolExecutor</code>å¹¶å°†å…¶åŒ…è£…åœ¨<code>TaskExecutor</code>ä¸­ã€‚ å¦‚æœæ‚¨éœ€è¦é€‚åº”ä¸åŒç±»å‹çš„<code>java.util.concurrent.Executor</code>ï¼Œæˆ‘ä»¬å»ºè®®æ‚¨ä½¿ç”¨<code>ConcurrentTaskExecutor</code>ã€‚</li><li><code>WorkManagerTaskExecutor</code>: æ­¤å®ç°ä½¿ç”¨CommonJ <code>WorkManager</code>ä½œä¸ºå…¶åå¤‡æœåŠ¡æä¾›ç¨‹åºï¼Œå¹¶ä¸”æ˜¯åœ¨Springåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­åœ¨WebLogicæˆ–WebSphereä¸Šè®¾ç½®åŸºäºCommonJçš„çº¿ç¨‹æ± é›†æˆçš„ä¸­å¿ƒä¾¿åˆ©ç±»ã€‚</li><li><code>DefaultManagedTaskExecutor</code>: æ­¤å®ç°åœ¨JSR-236å…¼å®¹çš„è¿è¡Œæ—¶ç¯å¢ƒï¼ˆä¾‹å¦‚Java EE 7+åº”ç”¨ç¨‹åºæœåŠ¡å™¨ï¼‰ä¸­ä½¿ç”¨JNDIè·å–çš„<code>ManagedExecutorService</code>ï¼Œä¸ºæ­¤ç›®çš„æ›¿æ¢CommonJ WorkManagerã€‚</li></ul><h4 id="6-1-2-ä½¿ç”¨-TaskExecutor"><a href="#6-1-2-ä½¿ç”¨-TaskExecutor" class="headerlink" title="6.1.2. ä½¿ç”¨ TaskExecutor"></a>6.1.2. ä½¿ç”¨ <code>TaskExecutor</code></h4><p>Springçš„ <code>TaskExecutor</code>å®ç°ç”¨ä½œç®€å•çš„JavaBeansã€‚ åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªä½¿ç”¨<code>ThreadPoolTaskExecutor</code>å¼‚æ­¥æ‰“å°å‡ºä¸€ç»„æ¶ˆæ¯çš„bean:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.springframework.core.task.TaskExecutor;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TaskExecutorExample</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessagePrinterTask</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> &#123;<br><br>        <span class="hljs-keyword">private</span> String message;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-title function_">MessagePrinterTask</span><span class="hljs-params">(String message)</span> &#123;<br>            <span class="hljs-built_in">this</span>.message = message;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>            System.out.println(message);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> TaskExecutor taskExecutor;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">TaskExecutorExample</span><span class="hljs-params">(TaskExecutor taskExecutor)</span> &#123;<br>        <span class="hljs-built_in">this</span>.taskExecutor = taskExecutor;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printMessages</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">25</span>; i++) &#123;<br>            taskExecutor.execute(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MessagePrinterTask</span>(<span class="hljs-string">&quot;Message&quot;</span> + i));<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æ‚¨æ‰€è§ï¼Œæ‚¨å¯ä»¥å°†<code>Runnable</code>æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ï¼Œè€Œä¸æ˜¯ä»æ± ä¸­æ£€ç´¢çº¿ç¨‹å¹¶è‡ªè¡Œæ‰§è¡Œã€‚ ç„¶åï¼Œ<code>TaskExecutor</code>ä½¿ç”¨å…¶å†…éƒ¨è§„åˆ™æ¥ç¡®å®šä»»åŠ¡ä½•æ—¶æ‰§è¡Œã€‚</p><p>è¦é…ç½®<code>TaskExecutor</code>ä½¿ç”¨çš„è§„åˆ™ï¼Œæˆ‘ä»¬å…¬å¼€äº†ç®€å•çš„beanå±æ€§:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;taskExecutor&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;corePoolSize&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;5&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;maxPoolSize&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;10&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;queueCapacity&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;25&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;taskExecutorExample&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;TaskExecutorExample&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;taskExecutor&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="6-2-Spring-TaskScheduler-æŠ½è±¡"><a href="#6-2-Spring-TaskScheduler-æŠ½è±¡" class="headerlink" title="6.2. Spring TaskScheduler æŠ½è±¡"></a>6.2. Spring <code>TaskScheduler</code> æŠ½è±¡</h3><p>é™¤äº†<code>TaskExecutor</code>æŠ½è±¡ä¹‹å¤–ï¼ŒSpring 3.0è¿˜å¼•å…¥äº†ä¸€ä¸ª<code>TaskScheduler</code>ï¼Œå®ƒå…·æœ‰å„ç§æ–¹æ³•ï¼Œå¯ä»¥åœ¨å°†æ¥çš„æŸä¸ªæ—¶åˆ»è°ƒåº¦ä»»åŠ¡ã€‚ ä»¥ä¸‹æ¸…å•æ˜¾ç¤ºäº†<code>TaskScheduler</code>æ¥å£å®šä¹‰:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">TaskScheduler</span> &#123;<br><br>    ScheduledFuture <span class="hljs-title function_">schedule</span><span class="hljs-params">(Runnable task, Trigger trigger)</span>;<br><br>    ScheduledFuture <span class="hljs-title function_">schedule</span><span class="hljs-params">(Runnable task, Instant startTime)</span>;<br><br>    ScheduledFuture <span class="hljs-title function_">schedule</span><span class="hljs-params">(Runnable task, Date startTime)</span>;<br><br>    ScheduledFuture <span class="hljs-title function_">scheduleAtFixedRate</span><span class="hljs-params">(Runnable task, Instant startTime, Duration period)</span>;<br><br>    ScheduledFuture <span class="hljs-title function_">scheduleAtFixedRate</span><span class="hljs-params">(Runnable task, Date startTime, <span class="hljs-type">long</span> period)</span>;<br><br>    ScheduledFuture <span class="hljs-title function_">scheduleAtFixedRate</span><span class="hljs-params">(Runnable task, Duration period)</span>;<br><br>    ScheduledFuture <span class="hljs-title function_">scheduleAtFixedRate</span><span class="hljs-params">(Runnable task, <span class="hljs-type">long</span> period)</span>;<br><br>    ScheduledFuture <span class="hljs-title function_">scheduleWithFixedDelay</span><span class="hljs-params">(Runnable task, Instant startTime, Duration delay)</span>;<br><br>    ScheduledFuture <span class="hljs-title function_">scheduleWithFixedDelay</span><span class="hljs-params">(Runnable task, Date startTime, <span class="hljs-type">long</span> delay)</span>;<br><br>    ScheduledFuture <span class="hljs-title function_">scheduleWithFixedDelay</span><span class="hljs-params">(Runnable task, Duration delay)</span>;<br><br>    ScheduledFuture <span class="hljs-title function_">scheduleWithFixedDelay</span><span class="hljs-params">(Runnable task, <span class="hljs-type">long</span> delay)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä¸€ä¸ªåä¸º<code>schedule</code>çš„æ–¹æ³•ï¼Œå®ƒåªæ¥å—<code>Runnable</code>å’Œ<code>Date</code>ã€‚ è¿™ä¼šå¯¼è‡´ä»»åŠ¡åœ¨æŒ‡å®šæ—¶é—´åè¿è¡Œä¸€æ¬¡ã€‚ æ‰€æœ‰å…¶ä»–æ–¹æ³•éƒ½èƒ½å¤Ÿå®‰æ’ä»»åŠ¡é‡å¤è¿è¡Œã€‚ é€šè¿‡è¿™äº›æ–¹æ³•ï¼Œåœ¨ç®€å•çš„å‘¨æœŸä¸­éœ€è¦ä»¥å›ºå®šé¢‘ç‡å’Œå›ºå®šæ—¶é—´é—´éš”æ–¹æ³•æ‰§è¡Œä»»åŠ¡æ˜¯å®ç°çš„ï¼Œä½†æ¥å—<code>Trigger</code>ä¼šæ›´æ–¹ä¾¿ã€‚</p><h4 id="6-2-1-Trigger-æ¥å£"><a href="#6-2-1-Trigger-æ¥å£" class="headerlink" title="6.2.1. Trigger æ¥å£"></a>6.2.1. <code>Trigger</code> æ¥å£</h4><p><code>Trigger</code>æ¥å£åŸºæœ¬ä¸Šå—åˆ°JSR-236çš„å¯å‘ï¼Œä»Spring 3.0å¼€å§‹ï¼Œå®ƒå°šæœªæ­£å¼å®ç°ã€‚Triggerçš„åŸºæœ¬æ€æƒ³æ˜¯å¯ä»¥åŸºäºè¿‡å»çš„æ‰§è¡Œç»“æœæˆ–ç”šè‡³ä»»æ„æ¡ä»¶æ¥ç¡®å®šæ‰§è¡Œæ—¶é—´ã€‚å¦‚æœè¿™äº›ç¡®å®šè€ƒè™‘åˆ°äº†å‰ä¸€æ¬¡æ‰§è¡Œçš„ç»“æœï¼Œ åˆ™è¯¥ä¿¡æ¯åœ¨<code>TriggerContext</code>ä¸­å¯ç”¨ã€‚<code>Trigger</code> æ¥å£æœ¬èº«éå¸¸ç®€å•ï¼š:</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-symbol">Trigger</span> &#123;<br>    Date nextExecutionTime(TriggerContext triggerContext);&#125;<br></code></pre></td></tr></table></figure><p><code>TriggerContext</code>æ˜¯æœ€é‡è¦çš„éƒ¨åˆ†ã€‚ å®ƒå°è£…äº†æ‰€æœ‰ç›¸å…³æ•°æ®ï¼Œå¦‚æœ‰å¿…è¦ï¼Œå°†æ¥å¯ä»¥è¿›è¡Œæ‰©å±•ã€‚ <code>TriggerContext</code>æ˜¯ä¸€ä¸ªæ¥å£ï¼ˆé»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨ <code>SimpleTriggerContext</code>å®ç°ï¼‰ã€‚ ä»¥ä¸‹æ¸…å•æ˜¾ç¤ºäº†<code>Trigger</code>å®ç°çš„å¯ç”¨æ–¹æ³•ã€‚</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">TriggerContext</span> &#123;<br>    <span class="hljs-function">Date <span class="hljs-title">lastScheduledExecutionTime</span>()</span>;<br>    <span class="hljs-function">Date <span class="hljs-title">lastActualExecutionTime</span>()</span>;<br>    <span class="hljs-function">Date <span class="hljs-title">lastCompletionTime</span>()</span>;&#125;<br></code></pre></td></tr></table></figure><h4 id="6-2-2-Trigger-å®ç°"><a href="#6-2-2-Trigger-å®ç°" class="headerlink" title="6.2.2. Trigger å®ç°"></a>6.2.2. <code>Trigger</code> å®ç°</h4><p>Springæä¾›äº†ä¸¤ä¸ª<code>Trigger</code>æ¥å£çš„å®ç° ï¼Œ æœ€æœ‰è¶£çš„æ˜¯<code>CronTrigger</code>ã€‚ å®ƒæ”¯æŒåŸºäºcronè¡¨è¾¾å¼è°ƒåº¦ä»»åŠ¡ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹ä»»åŠ¡è¢«å®‰æ’åœ¨æ¯å°æ—¶è¶…è¿‡15åˆ†é’Ÿï¼Œ ä½†ä»…åœ¨å·¥ä½œæ—¥çš„æ—©ä¸Š9æ—¶åˆ°ä¸‹åˆ5æ—¶â€è¥ä¸šæ—¶é—´â€å†…è¿è¡Œ:</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">scheduler.schedule(<span class="hljs-keyword">task</span>, <span class="hljs-keyword">new</span> CronTrigger(<span class="hljs-string">&quot;0 15 9-17 * * MON-FRI&quot;</span>));<br></code></pre></td></tr></table></figure><p>å¦ä¸€ä¸ªç°æˆçš„å®ç°æ˜¯<code>PeriodicTrigger</code>,å®ƒæ¥å—ä¸€ä¸ªå›ºå®šçš„å‘¨æœŸã€ä¸€ä¸ªå¯é€‰çš„åˆå§‹å»¶è¿Ÿå€¼å’Œä¸€ä¸ªå¸ƒå°”å€¼æ¥æŒ‡ç¤ºè¯¥æœŸé—´æ˜¯å¦åº”è§£é‡Šä¸ºå›ºå®šé€Ÿç‡æˆ–å›ºå®šå»¶è¿Ÿã€‚ç”±äº<code>TaskScheduler</code>æ¥å£å·²ç»å®šä¹‰äº†ä»¥å›ºå®šé€Ÿç‡æˆ–å›ºå®šå»¶è¿Ÿæ¥è°ƒåº¦ä»»åŠ¡çš„æ–¹æ³•ï¼Œå› æ­¤åº”è¯¥å°½å¯èƒ½ç›´æ¥ä½¿ç”¨è¿™äº›æ–¹æ³•ã€‚ <code>PeriodicTrigger</code>å®ç°çš„ä»·å€¼åœ¨äºï¼Œå®ƒå¯ä»¥åœ¨ä¾èµ–äº<code>Trigger</code>æŠ½è±¡çš„ç»„ä»¶ä¸­ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œå…è®¸å‘¨æœŸæ€§è§¦å‘å™¨ã€cron-basedè§¦å‘å™¨ã€ç”šè‡³æ˜¯å¯äº’æ¢ä½¿ç”¨çš„è‡ªå®šä¹‰è§¦å‘å™¨å®ç°ï¼Œå¯èƒ½ä¼šå¾ˆæ–¹ä¾¿ã€‚æ­¤ç±»ç»„ä»¶å¯ä»¥åˆ©ç”¨ä¾èµ–é¡¹æ³¨å…¥ï¼Œè¿™æ ·å¯ä»¥åœ¨å¤–éƒ¨é…ç½®æ­¤ç±»<code>Triggers</code>ï¼Œå› æ­¤å®¹æ˜“ä¿®æ”¹æˆ–æ‰©å±•ã€‚</p><h4 id="6-2-3-TaskScheduler-å®ç°"><a href="#6-2-3-TaskScheduler-å®ç°" class="headerlink" title="6.2.3. TaskScheduler å®ç°"></a>6.2.3. <code>TaskScheduler</code> å®ç°</h4><p>ä¸Springçš„<code>TaskExecutor</code>æŠ½è±¡ä¸€æ ·ï¼Œ <code>TaskScheduler</code>çš„ä¸»è¦å¥½å¤„æ˜¯ï¼Œä¾èµ–äºè°ƒåº¦è¡Œä¸ºçš„ä»£ç ä¸å¿…ä¸ç‰¹å®šçš„è°ƒåº¦ç¨‹åºå®ç°è€¦åˆã€‚å½“åœ¨åº”ç”¨ç¨‹åºæœåŠ¡å™¨ç¯å¢ƒä¸­è¿è¡Œæ—¶ï¼Œä¸åº”ç”±åº”ç”¨ç¨‹åºæœ¬èº«ç›´æ¥åˆ›å»ºçº¿ç¨‹ï¼Œå› æ­¤æä¾›çš„çµæ´»æ€§å°¤å…¶é‡è¦ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œ Springæä¾›äº†ä¸€ä¸ª<code>TimerManagerTaskScheduler</code>ï¼Œå®ƒå§”æ‰˜ç»™WebLogicæˆ–WebSphereä¸Šçš„CommonJ <code>TimerManager</code>ï¼Œä»¥åŠä¸€ä¸ªå§”æ‰˜ç»™Java EE 7+ç¯å¢ƒä¸­çš„JSR-236 <code>ManagedScheduledExecutorService</code>çš„æ›´æ–°çš„<code>DefaultManagedTaskScheduler</code>ã€‚ ä¸¤è€…é€šå¸¸éƒ½é…ç½®æœ‰JNDIæŸ¥æ‰¾ã€‚</p><p>æ¯å½“å¤–éƒ¨çº¿ç¨‹ç®¡ç†ä¸æ˜¯å¿…éœ€çš„æ—¶å€™ï¼Œæ›´ç®€å•çš„æ›¿ä»£æ–¹æ¡ˆæ˜¯åº”ç”¨ç¨‹åºä¸­çš„æœ¬åœ°<code>ScheduledExecutorService</code>è®¾ç½®ï¼Œå¯ä»¥é€šè¿‡Springçš„<code>ConcurrentTaskScheduler</code>è¿›è¡Œè°ƒæ•´ã€‚ ä¸ºæ–¹ä¾¿èµ·è§ï¼ŒSpringè¿˜æä¾›äº†ä¸€ä¸ª<code>ThreadPoolTaskScheduler</code>ï¼Œå®ƒåœ¨å†…éƒ¨å§”æ‰˜ç»™<code>ScheduledExecutorService</code>ï¼Œä»¥æä¾›æ²¿<code>ThreadPoolTaskExecutor</code>è¡Œçš„å…¬å…±beanæ ·å¼é…ç½®ã€‚äº›å˜ä½“é€‚ç”¨äºå®½æ¾åº”ç”¨ç¨‹åºæœåŠ¡å™¨ç¯å¢ƒä¸­çš„æœ¬åœ°åµŒå…¥å¼çº¿ç¨‹æ± è®¾ç½®ï¼Œç‰¹åˆ«æ˜¯åœ¨Tomcatå’ŒJettyä¸Šã€‚</p><h3 id="6-3-å¯¹è°ƒåº¦å’Œå¼‚æ­¥æ‰§è¡Œçš„æ³¨è§£æ”¯æŒ"><a href="#6-3-å¯¹è°ƒåº¦å’Œå¼‚æ­¥æ‰§è¡Œçš„æ³¨è§£æ”¯æŒ" class="headerlink" title="6.3. å¯¹è°ƒåº¦å’Œå¼‚æ­¥æ‰§è¡Œçš„æ³¨è§£æ”¯æŒ"></a>6.3. å¯¹è°ƒåº¦å’Œå¼‚æ­¥æ‰§è¡Œçš„æ³¨è§£æ”¯æŒ</h3><p>Springä¸ºä»»åŠ¡è°ƒåº¦å’Œå¼‚æ­¥æ–¹æ³•æ‰§è¡Œæä¾›äº†æ³¨è§£æ”¯æŒ</p><h4 id="6-3-1-å¯ç”¨è°ƒåº¦æ³¨è§£"><a href="#6-3-1-å¯ç”¨è°ƒåº¦æ³¨è§£" class="headerlink" title="6.3.1. å¯ç”¨è°ƒåº¦æ³¨è§£"></a>6.3.1. å¯ç”¨è°ƒåº¦æ³¨è§£</h4><p>è¦å¯ç”¨å¯¹<code>@Scheduled</code>å’Œ<code>@Async</code>æ³¨è§£çš„æ”¯æŒï¼Œè¯·å°†<code>@EnableScheduling</code>å’Œ<code>@EnableAsync</code>æ·»åŠ åˆ°æ‚¨çš„<code>@Configuration</code> ç±»ä¸­ã€‚å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Configuration</span><br><br><span class="hljs-variable">@EnableAsync</span><br><br><span class="hljs-variable">@EnableScheduling</span><br><br>public class AppConfig &#123;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>æ‚¨å¯ä»¥è‡ªç”±é€‰æ‹©æ‚¨çš„åº”ç”¨ç¨‹åºçš„ç›¸å…³æ³¨è§£ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨åªéœ€è¦æ”¯æŒ<code>@Scheduled</code>ï¼Œé‚£ä¹ˆå°±çœç•¥<code>@EnableAsync</code>ã€‚å¯¹äºæ›´å¤šçš„fine-grainedæ§åˆ¶ï¼Œæ‚¨å¯ä»¥å¦å¤–å®ç°<a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/scheduling/annotation/SchedulingConfigurer.html"><code>SchedulingConfigurer</code></a>å’Œ&#x2F;æˆ–<a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/scheduling/annotation/AsyncConfigurer.html"><code>AsyncConfigurer</code></a>æ¥å£ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…å¯¹åº”çš„javadocsã€‚</p><p>å¦‚æœæ‚¨å–œæ¬¢XMLé…ç½®ï¼Œ è¯·ä½¿ç”¨<code>&lt;task:annotation-driven&gt;</code> å…ƒç´ ã€‚å¦‚ä¸‹:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;task:annotation-driven <span class="hljs-attribute">executor</span>=<span class="hljs-string">&quot;myExecutor&quot;</span> <span class="hljs-attribute">scheduler</span>=<span class="hljs-string">&quot;myScheduler&quot;</span>/&gt;<br><br>&lt;task:executor <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;myExecutor&quot;</span> <span class="hljs-attribute">pool-size</span>=<span class="hljs-string">&quot;5&quot;</span>/&gt;<br><br>&lt;task:scheduler <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;myScheduler&quot;</span> <span class="hljs-attribute">pool-size</span>=<span class="hljs-string">&quot;10&quot;</span>/&gt;<br></code></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œåœ¨ä¸Šé¢çš„XMLä¸­ï¼Œæä¾›äº†ä¸€ä¸ªæ‰§è¡Œå™¨å¼•ç”¨æ¥å¤„ç†ä¸<code>@Async</code>æ³¨è§£çš„æ–¹æ³•å¯¹åº”çš„é‚£äº›ä»»åŠ¡ï¼Œå¹¶æä¾›äº†è°ƒåº¦ç¨‹åºå¼•ç”¨æ¥ç®¡ç†é‚£äº›ç”¨<code>@Scheduled</code>æ³¨è§£çš„æ–¹æ³•ã€‚</p><p>å¤„ç†<code>@Async</code>æ³¨è§£çš„é»˜è®¤å»ºè®®æ¨¡å¼æ˜¯<code>proxy</code>ï¼Œå®ƒå…è®¸ä»…é€šè¿‡ä»£ç†æ‹¦æˆªè°ƒç”¨ã€‚ åŒä¸€ç±»ä¸­çš„æœ¬åœ°è°ƒç”¨ä¸èƒ½ä»¥è¿™ç§æ–¹å¼æˆªè·ã€‚ å¯¹äºæ›´é«˜çº§çš„æ‹¦æˆªæ¨¡å¼ï¼Œè¯·è€ƒè™‘ç»“åˆç¼–è¯‘æ—¶æˆ–åŠ è½½æ—¶ç¼–ç»‡åˆ‡æ¢åˆ°<code>aspectj</code>æ¨¡å¼ã€‚</p><h4 id="6-3-2-Scheduled-æ³¨è§£"><a href="#6-3-2-Scheduled-æ³¨è§£" class="headerlink" title="6.3.2. @Scheduled æ³¨è§£"></a>6.3.2. <code>@Scheduled</code> æ³¨è§£</h4><p>å¯ä»¥å°† <code>@Scheduled</code>æ³¨è§£ä¸è§¦å‘å™¨å…ƒæ•°æ®ä¸€èµ·æ·»åŠ åˆ°æ–¹æ³•ä¸­ã€‚ä¾‹å¦‚ï¼Œ ä¸‹é¢çš„æ–¹æ³•æ¯éš”5ç§’è°ƒç”¨ä¸€æ¬¡å›ºå®šçš„å»¶è¿Ÿï¼Œ è¿™æ„å‘³ç€è¯¥æœŸé—´å°†ä»æ¯æ¬¡è°ƒç”¨çš„å®Œæˆæ—¶é—´è®¡ç®—:</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs smali">@Scheduled(fixedDelay=5000)<br><span class="hljs-keyword"></span><br><span class="hljs-keyword">public</span> void doSomething() &#123;<br><br>    // something that should<span class="hljs-built_in"> execute </span>periodically<br><br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœéœ€è¦å®‰è£…å›ºå®šçš„é€Ÿåº¦æ¥æ‰§è¡Œï¼Œåªéœ€ç®€å•çš„æ”¹å˜æ³¨è§£ä¸­çš„å±æ€§åå³å¯æ‰§è¡Œã€‚ä¸‹é¢å¯ä»¥æ¯5ç§’æ‰§è¡Œé€Ÿåº¦åœ¨æ¯ä¸ªè°ƒç”¨å¼€å§‹åï¼š</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs smali">@Scheduled(fixedRate=5000)<br><span class="hljs-keyword"></span><br><span class="hljs-keyword">public</span> void doSomething() &#123;<br><br>    // something that should<span class="hljs-built_in"> execute </span>periodically<br><br>&#125;<br></code></pre></td></tr></table></figure><p>å¯¹äºå›ºå®šå»¶è¿Ÿå’Œå›ºå®šé€Ÿç‡ä»»åŠ¡ï¼Œ å¯ä»¥æŒ‡å®šåˆå§‹å»¶è¿Ÿï¼Œ æŒ‡ç¤ºåœ¨ç¬¬ä¸€æ¬¡æ‰§è¡Œè¯¥æ–¹æ³•ä¹‹å‰ç­‰å¾…çš„æ¯«ç§’æ•°ã€‚å¦‚ä¸‹é¢çš„ <code>fixedRate</code>ç¤ºä¾‹æ‰€ç¤º:</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs smali">@Scheduled(initialDelay=1000, fixedRate=5000)<br><span class="hljs-keyword"></span><br><span class="hljs-keyword">public</span> void doSomething() &#123;<br><br>    // something that should<span class="hljs-built_in"> execute </span>periodically<br><br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœç®€å•çš„å‘¨æœŸè°ƒåº¦ä¸å¤Ÿè¡¨è¾¾ä½ çš„æ„æ„¿ï¼Œ åˆ™å¯ä»¥æä¾›cronè¡¨è¾¾å¼ã€‚ä¾‹å¦‚ï¼Œ ä»¥ä¸‹ä»»åŠ¡å°†åªåœ¨å·¥ä½œæ—¥æ‰§è¡Œã€‚</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs smali">@Scheduled(cron=<span class="hljs-string">&quot;*/5 * * * * MON-FRI&quot;</span>)<br><span class="hljs-keyword"></span><br><span class="hljs-keyword">public</span> void doSomething() &#123;<br><br>    // something that should<span class="hljs-built_in"> execute </span>on weekdays only<br><br>&#125;<br></code></pre></td></tr></table></figure><p>ä½ å¯ä»¥ä½¿ç”¨ <code>zone</code>å±æ€§æ¥æŒ‡å®šè§£æcronè¡¨è¾¾å¼çš„æ—¶åŒº</p><p>è¯·æ³¨æ„ï¼Œè¦è®¡åˆ’çš„æ–¹æ³•å¿…é¡»å…·æœ‰voidè¿”å›ï¼Œå¹¶ä¸”ä¸èƒ½æœŸæœ›ä¸ºä»»ä½•å‚æ•°ã€‚å¦‚æœè¯¥æ–¹æ³•éœ€è¦ä¸åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­çš„å…¶ä»–å¯¹è±¡è¿›è¡Œäº¤äº’ï¼Œ åˆ™é€šå¸¸æ˜¯é€šè¿‡ä¾èµ–é¡¹æ³¨å…¥æä¾›çš„ã€‚</p><p>åœ¨Spring 4.3æ¡†æ¶ä¸­ï¼Œ ä»»ä½•èŒƒå›´çš„beanéƒ½æ”¯æŒ<code>@Scheduled</code> æ–¹æ³•ã€‚</p><p>è¯·ç¡®ä¿åœ¨è¿è¡Œæ—¶ä¸ä¼šåœ¨åŒä¸€ä¸ª<code>@Scheduled</code>æ³¨è§£ç±»ä¸Šåˆå§‹åŒ–å¤šä¸ªå®ä¾‹ï¼Œé™¤éæ‚¨ç¡®å®å¸Œæœ›ä¸ºæ¯ä¸ªæ­¤ç±»å®ä¾‹éƒ½å®‰æ’å›è°ƒã€‚ä¸æ­¤ç›¸å…³ï¼Œè¯·ç¡®ä¿ä¸è¦åœ¨beanç±»ä¸Šä½¿ç”¨<code>@Configurable</code>ï¼Œå¹¶å°†å…¶ä¸å®¹å™¨<code>@Scheduled</code>å¹¶æ³¨å†Œä¸ºå¸¸è§„çš„Spring beanã€‚å¦‚æœæ˜¯è¿™æ ·ï¼Œ ç¨‹åºå°†ä¼šåŒé‡åˆå§‹åŒ–ï¼Œå¦åˆ™ï¼Œä¸€æ—¦é€šè¿‡å®¹å™¨ï¼Œå¹¶é€šè¿‡@Configurableåˆ‡é¢ï¼Œæ¯ä¸ª<code>@Scheduled</code>æ–¹æ³•çš„ç»“æœéƒ½å°†è¢«è°ƒç”¨ä¸¤æ¬¡ã€‚</p><h4 id="6-3-3-Async-æ³¨è§£"><a href="#6-3-3-Async-æ³¨è§£" class="headerlink" title="6.3.3. @Async æ³¨è§£"></a>6.3.3. <code>@Async</code> æ³¨è§£</h4><p>å¯ä»¥åœ¨æ–¹æ³•ä¸Šæä¾›<code>@Async</code>æ³¨è§£ï¼Œä»¥ä¾¿å‘ç”Ÿè¯¥æ–¹æ³•çš„å¼‚æ­¥è°ƒç”¨ã€‚æ¢è¨€ä¹‹ï¼Œè°ƒç”¨æ–¹å°†åœ¨è°ƒç”¨æ—¶ç«‹å³è¿”å›ï¼Œå¹¶ä¸”è¯¥æ–¹æ³•çš„å®é™…æ‰§è¡Œå°†å‘ç”Ÿåœ¨å·²æäº¤åˆ°Spring <code>TaskExecutor</code>çš„ä»»åŠ¡ä¸­ã€‚åœ¨æœ€ç®€å•çš„æƒ…å†µä¸‹ï¼Œæ³¨è§£å¯ä»¥åº”ç”¨äº<code>void</code>è¿”å›æ–¹æ³•ã€‚å¦‚ä¸‹ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Async</span><br><br><span class="hljs-built_in">void</span> <span class="hljs-title function_">doSomething</span>(<span class="hljs-params"></span>) &#123;<br><br>    <span class="hljs-comment">// this will be executed asynchronously</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸ä½¿ç”¨<code>@Scheduled</code>æ³¨è§£çš„æ³¨è§£æ–¹æ³•ä¸åŒï¼Œè¿™äº›æ–¹æ³•å¯ä»¥æœ‰é¢„æœŸå‚æ•°çš„ï¼Œå› ä¸ºè°ƒç”¨æ–¹å°†åœ¨è¿è¡Œæ—¶ä»¥â€œnormalâ€æ–¹å¼è°ƒç”¨å®ƒä»¬ï¼Œè€Œä¸æ˜¯ç”±å®¹å™¨ç®¡ç†çš„è®¡åˆ’ä»»åŠ¡ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹æ˜¯<code>@Async</code>æ³¨è§£çš„åˆæ³•åº”ç”¨:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Async</span><br><br><span class="hljs-built_in">void</span> <span class="hljs-title function_">doSomething</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> s</span>) &#123;<br><br>    <span class="hljs-comment">// this will be executed asynchronously</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p>å³ä½¿è¿”å›å€¼çš„æ–¹æ³•ä¹Ÿå¯ä»¥å¼‚æ­¥è°ƒç”¨ï¼Œä½†æ˜¯ï¼Œæ­¤ç±»æ–¹æ³•éœ€è¦å…·æœ‰<code>Future</code>ç±»å‹çš„è¿”å›å€¼ã€‚è¿™ä»ç„¶æä¾›äº†å¼‚æ­¥æ‰§è¡Œçš„å¥½å¤„ï¼Œä»¥ä¾¿è°ƒç”¨è€…å¯ä»¥åœ¨è°ƒç”¨<code>Future</code>ä¸Šçš„<code>get()</code>ä¹‹å‰æ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•åœ¨è¿”å›å€¼çš„æ–¹æ³•ä¸Šä½¿ç”¨<code>@Async</code> :</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Async</span><br><br><span class="hljs-title class_">Future</span>&lt;<span class="hljs-title class_">String</span>&gt; <span class="hljs-title function_">returnSomething</span>(<span class="hljs-params">int i</span>) &#123;<br><br>    <span class="hljs-comment">// this will be executed asynchronously</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>@Async</code>æ–¹æ³•ä¸ä»…å¯ä»¥å£°æ˜ä¸€ä¸ªå¸¸è§„çš„<code>java.util.concurrent.Future</code>è¿”å›ç±»å‹ï¼Œè€Œä¸”è¿˜å¯èƒ½æ˜¯springçš„<code>org.springframework.util.concurrent.ListenableFuture</code> æˆ–è€…å¦‚Spring 4.2ç‰ˆæœ¬å,å­˜åœ¨äºJDK8çš„<code>java.util.concurrent.CompletableFuture</code>ã€‚ç”¨äºä¸å¼‚æ­¥ä»»åŠ¡è¿›è¡Œæ›´ä¸°å¯Œçš„äº¤äº’ï¼Œä»¥åŠé€šè¿‡è¿›ä¸€æ­¥çš„å¤„ç†æ­¥éª¤è¿›è¡Œç»„åˆæ“ä½œã€‚</p><p><code>@Async</code>ä¸èƒ½ä¸ç”Ÿå‘½å‘¨æœŸå›è°ƒ(å¦‚ <code>@PostConstruct</code>)ä¸€èµ·ä½¿ç”¨ã€‚è‹¥è¦å¼‚æ­¥åˆå§‹åŒ–Spring beanï¼Œåˆ™å½“å‰å¿…é¡»ä½¿ç”¨å•ç‹¬çš„åˆå§‹åŒ–Spring beanï¼Œç„¶ååœ¨ç›®æ ‡ä¸Šè°ƒç”¨<code>@Async</code>æ³¨è§£æ–¹æ³•ã€‚å¦‚ä¸‹:</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SampleBeanImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">SampleBean</span> </span>&#123;<br>    <span class="hljs-meta">@Async</span>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">doSomething</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-comment">// ...    &#125;</span><br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SampleBeanInitializer</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> SampleBean bean;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">SampleBeanInitializer</span><span class="hljs-params">(SampleBean bean)</span> </span>&#123;        <span class="hljs-keyword">this</span>.bean = bean;    &#125;<br>    <span class="hljs-meta">@PostConstruct</span>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">initialize</span><span class="hljs-params">()</span> </span>&#123;        bean.doSomething();    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ²¡æœ‰ç›´æ¥çš„XMLé…ç½®ç­‰ä»·äº<code>@Async</code>ï¼Œå› ä¸ºè¿™äº›æ–¹æ³•åº”è¯¥é¦–å…ˆè®¾è®¡ä¸ºå¼‚æ­¥æ‰§è¡Œï¼Œè€Œä¸æ˜¯å¤–éƒ¨å¾—æ¥çš„ã€‚ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥æ‰‹åŠ¨è®¾ç½®Springçš„<code>AsyncExecutionInterceptor</code>ä¸Spring AOPç»“åˆä½¿ç”¨è‡ªå®šä¹‰åˆ‡ç‚¹ã€‚</p><h4 id="6-3-4-ä½¿ç”¨-Asyncçš„Executorçš„æ¡ä»¶"><a href="#6-3-4-ä½¿ç”¨-Asyncçš„Executorçš„æ¡ä»¶" class="headerlink" title="6.3.4. ä½¿ç”¨ @Asyncçš„Executorçš„æ¡ä»¶"></a>6.3.4. ä½¿ç”¨ <code>@Async</code>çš„Executorçš„æ¡ä»¶</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨æ–¹æ³•ä¸ŠæŒ‡å®š<code>@Async</code>æ—¶ï¼Œä½¿ç”¨çš„æ‰§è¡Œç¨‹åºæ˜¯ <a href="https://sca.aliyun.com/learn/spring/integration/scheduling/?spm=0.29160081.0.0.51f92e5dCHrGI4#scheduling-enable-annotation-support">å¯ç”¨å¼‚æ­¥æ”¯æŒæ—¶é…ç½®</a>çš„æ‰§è¡Œç¨‹åºï¼Œä¾‹å¦‚ï¼Œå¦‚æœä½¿ç”¨XMLæˆ–<code>AsyncConfigurer</code>å®ç°ï¼ˆå¦‚æœæœ‰ï¼‰ï¼Œåˆ™ä¸ºâ€œannotation-drivenâ€å…ƒç´ ã€‚ä½†æ˜¯ï¼Œå½“éœ€è¦æŒ‡ç¤ºæ‰§è¡Œç»™å®šæ–¹æ³•æ—¶ï¼Œåº”ä½¿ç”¨éé»˜è®¤çš„æ‰§è¡Œå™¨æ—¶ï¼Œå¯ä»¥ä½¿ç”¨<code>@Async</code>æ³¨è§£çš„<code>value</code>å±æ€§ã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œ:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Async</span>(<span class="hljs-string">&quot;otherExecutor&quot;</span>)<br><br><span class="hljs-built_in">void</span> <span class="hljs-title function_">doSomething</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> s</span>) &#123;<br><br>    <span class="hljs-comment">// this will be executed asynchronously by &quot;otherExecutor&quot;</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>&quot;otherExecutor&quot;</code>å¯ä»¥æ˜¯Springå®¹å™¨ä¸­ä»»ä½•<code>Executor</code> beançš„åç§°ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸ä»»ä½•<code>Executor</code> å…³è”çš„é™å®šç¬¦çš„åç§°ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨<code>&lt;qualifier&gt;</code>å…ƒç´ æˆ–Springçš„<code>@Qualifier</code>æ³¨è§£æŒ‡å®šï¼‰</p><h4 id="6-3-5-ä½¿ç”¨-Asyncçš„å¼‚å¸¸ç®¡ç†"><a href="#6-3-5-ä½¿ç”¨-Asyncçš„å¼‚å¸¸ç®¡ç†" class="headerlink" title="6.3.5. ä½¿ç”¨@Asyncçš„å¼‚å¸¸ç®¡ç†"></a>6.3.5. ä½¿ç”¨<code>@Async</code>çš„å¼‚å¸¸ç®¡ç†</h4><p>å½“<code>@Async</code>æ–¹æ³•æœ‰<code>Future</code>ç±»å‹çš„è¿”å›å€¼æ—¶ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°ç®¡ç†åœ¨æ–¹æ³•æ‰§è¡ŒæœŸé—´å¼•å‘çš„å¼‚å¸¸ï¼Œå› ä¸ºå½“è°ƒç”¨å¯¹<code>Future</code>ç»“æœçš„<code>get</code>æ—¶å°†å¼•å‘æ­¤å¼‚å¸¸ã€‚ä½†æ˜¯ï¼Œå¯¹äº <code>void</code>è¿”å›ç±»å‹ï¼Œå¼‚å¸¸æ˜¯æ— æ³•æ•è·çš„ï¼Œæ— æ³•ä¼ è¾“çš„ã€‚å¯¹äºè¿™äº›æƒ…å†µï¼Œå¯ä»¥æä¾›<code>AsyncUncaughtExceptionHandler</code>æ¥å¤„ç†æ­¤ç±»å¼‚å¸¸ã€‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œï¼š:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAsyncUncaughtExceptionHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AsyncUncaughtExceptionHandler</span> &#123;<br>    <span class="hljs-meta">@Override</span>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">handleUncaughtException</span>(<span class="hljs-params">Throwable ex, Method method, <span class="hljs-built_in">Object</span>... params</span>) &#123;        <span class="hljs-comment">// handle exception    &#125;&#125;</span><br></code></pre></td></tr></table></figure><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä»…è®°å½•å¼‚å¸¸ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨<code>AsyncConfigurer</code>æˆ–<code>&lt;task:annotation-driven/&gt;</code>XMLå…ƒç´ å®šä¹‰è‡ªå®šä¹‰<code>AsyncUncaughtExceptionHandler</code>ã€‚</p><h3 id="6-4-task-å‘½åç©ºé—´"><a href="#6-4-task-å‘½åç©ºé—´" class="headerlink" title="6.4. task å‘½åç©ºé—´"></a>6.4. <code>task</code> å‘½åç©ºé—´</h3><p>ä»Spring 3.0å¼€å§‹ï¼Œæœ‰ä¸€ä¸ªç”¨äºé…ç½®<code>TaskExecutor</code>å’Œ<code>TaskScheduler</code>å®ä¾‹çš„XMLå‘½åç©ºé—´ã€‚</p><h4 id="6-4-1-â€˜schedulerâ€™-å…ƒç´ "><a href="#6-4-1-â€˜schedulerâ€™-å…ƒç´ " class="headerlink" title="6.4.1. â€˜schedulerâ€™ å…ƒç´ "></a>6.4.1. â€˜schedulerâ€™ å…ƒç´ </h4><p>ä¸‹é¢çš„å…ƒç´ å°†åˆ›å»ºå…·æœ‰æŒ‡å®šçº¿ç¨‹æ± å¤§å°çš„<code>ThreadPoolTaskScheduler</code> å®ä¾‹:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;task:scheduler <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;scheduler&quot;</span> <span class="hljs-attribute">pool-size</span>=<span class="hljs-string">&quot;10&quot;</span>/&gt;<br></code></pre></td></tr></table></figure><p>ä¸º<code>id</code>å±æ€§æä¾›çš„å€¼å°†ç”¨ä½œæ± ä¸­çº¿ç¨‹åç§°çš„å‰ç¼€ï¼Œ<code>scheduler</code> å…ƒç´ ç›¸å¯¹éå¸¸ç®€å•ã€‚å¦‚æœä¸æä¾›<code>pool-size</code> å±æ€§ï¼Œåˆ™é»˜è®¤çš„çº¿ç¨‹æ± å°†åªæœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚è®¡åˆ’ç¨‹åºå†ä¹Ÿæ²¡æœ‰å…¶ä»–é…ç½®é€‰é¡¹ã€‚</p><h4 id="6-4-2-executor-å…ƒç´ "><a href="#6-4-2-executor-å…ƒç´ " class="headerlink" title="6.4.2. executor å…ƒç´ "></a>6.4.2. <code>executor</code> å…ƒç´ </h4><p>ä»¥ä¸‹åˆ›å»ºä¸€ä¸ª<code>ThreadPoolTaskExecutor</code> å®ä¾‹:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;task:executor <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;executor&quot;</span> <span class="hljs-attribute">pool-size</span>=<span class="hljs-string">&quot;10&quot;</span>/&gt;<br></code></pre></td></tr></table></figure><p>ä¸<a href="https://sca.aliyun.com/learn/spring/integration/scheduling/?spm=0.29160081.0.0.51f92e5dCHrGI4#scheduling-task-namespace-scheduler">ä¸Šé¢</a>çš„è°ƒåº¦ç¨‹åºä¸€æ ·ï¼Œä¸º<code>id</code>å±æ€§æä¾›çš„å€¼å°†ç”¨ä½œæ± ä¸­çº¿ç¨‹åç§°çš„å‰ç¼€ã€‚å°±æ± å¤§å°è€Œè¨€ï¼Œ <code>executor</code>å…ƒç´ æ”¯æŒæ¯”<code>scheduler</code>å…ƒç´ æ›´å¤šçš„é…ç½®é€‰é¡¹ã€‚é¦–å…ˆï¼Œ<code>ThreadPoolTaskExecutor</code>çš„çº¿ç¨‹æ± æœ¬èº«æ›´å…·å¯é…ç½®ã€‚æ‰§è¡Œå™¨çš„çº¿ç¨‹æ± å¯èƒ½æœ‰ä¸åŒçš„æ ¸å¿ƒå€¼å’Œæœ€å¤§å¤§å°ï¼Œï¼Œè€Œä¸ä»…ä»…æ˜¯å•ä¸ªçš„å¤§å°ã€‚å¦‚æœæä¾›äº†å•ä¸ªå€¼ï¼Œåˆ™æ‰§è¡Œå™¨å°†å…·æœ‰å›ºå®šå¤§å°çš„çº¿ç¨‹æ± (æ ¸å¿ƒå’Œæœ€å¤§å¤§å°ç›¸åŒ)ã€‚ ä½†æ˜¯ï¼Œ<code>executor</code> å…ƒç´ çš„<code>pool-size</code> å±æ€§ä¹Ÿæ¥å—ä»¥<code>min-max</code>å½¢å¼çš„èŒƒå›´ã€‚ä»¥ä¸‹ç¤ºä¾‹å°†æœ€å°å€¼è®¾ç½®ä¸º<code>5</code>ï¼Œæœ€å¤§å€¼è®¾ç½®ä¸º<code>25</code>:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;task:executor<br><br>        <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;executorWithPoolSizeRange&quot;</span><br><br>        <span class="hljs-attribute">pool-size</span>=<span class="hljs-string">&quot;5-25&quot;</span><br><br>        <span class="hljs-attribute">queue-capacity</span>=<span class="hljs-string">&quot;100&quot;</span>/&gt;<br></code></pre></td></tr></table></figure><p>ä»è¯¥é…ç½®ä¸­å¯ä»¥çœ‹å‡ºï¼Œè¿˜æä¾›äº†<code>queue-capacity</code> (é˜Ÿåˆ—å®¹é‡)å€¼ã€‚è¿˜åº”æ ¹æ®æ‰§è¡Œè€…çš„é˜Ÿåˆ—å®¹é‡æ¥è€ƒè™‘çº¿ç¨‹æ± çš„é…ç½®ï¼Œæœ‰å…³æ± å¤§å°å’Œé˜Ÿåˆ—å®¹é‡ä¹‹é—´å…³ç³»çš„è¯¦ç»†è¯´æ˜ï¼Œè¯·å‚é˜…<a href="https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/ThreadPoolExecutor.html"><code>ThreadPoolExecutor</code></a>çš„æ–‡æ¡£ã€‚ ä¸»è¦çš„æƒ³æ³•æ˜¯ï¼Œåœ¨æäº¤ä»»åŠ¡æ—¶ï¼Œå¦‚æœæ´»åŠ¨çº¿ç¨‹çš„æ•°ç›®å½“å‰å°äºæ ¸å¿ƒå¤§å°ï¼Œæ‰§è¡Œå™¨å°†é¦–å…ˆå°è¯•ä½¿ç”¨ä¸€ä¸ªç©ºé—²çº¿ç¨‹ã€‚å¦‚æœå·²è¾¾åˆ°æ ¸å¿ƒå¤§å°ï¼Œåˆ™åªè¦å°šæœªè¾¾åˆ°å…¶å®¹é‡ï¼Œå°±ä¼šå°†è¯¥ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ã€‚åªæœ‰è¿™æ ·ï¼Œå¦‚æœå·²è¾¾åˆ°é˜Ÿåˆ—çš„å®¹é‡ï¼Œæ‰§è¡Œå™¨å°†åˆ›å»ºä¸€ä¸ªè¶…å‡ºæ ¸å¿ƒå¤§å°çš„æ–°çº¿ç¨‹ã€‚å¦‚æœè¿˜è¾¾åˆ°æœ€å¤§å¤§å°ï¼Œï¼Œåˆ™æ‰§è¡Œå™¨å°†æ‹’ç»è¯¥ä»»åŠ¡ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œé˜Ÿåˆ—æ˜¯æ— é™åˆ¶çš„ï¼Œä½†ä¸€èˆ¬ä¸ä¼šè¿™æ ·é…ç½®ï¼Œå› ä¸ºå½“æ‰€æœ‰æ± çº¿ç¨‹éƒ½è¿è¡Œæ—¶ï¼Œå¦‚æœå°†å¾ˆå¤šçš„ä»»åŠ¡æ·»åŠ åˆ°è¯¥é˜Ÿåˆ—ä¸­ï¼Œåˆ™ä¼šå¯¼è‡´<code>OutOfMemoryErrors</code>ã€‚æ­¤å¤–ï¼Œå¦‚æœé˜Ÿåˆ—æ˜¯æ— ç•Œçš„ï¼Œåˆ™æœ€å¤§å¤§å°æ ¹æœ¬æ²¡æœ‰æ•ˆæœã€‚ç”±äºæ‰§è¡Œå™¨æ€»æ˜¯åœ¨åˆ›å»ºè¶…å‡ºæ ¸å¿ƒå¤§å°çš„æ–°çº¿ç¨‹ä¹‹å‰å°è¯•è¯¥é˜Ÿåˆ—ï¼Œå› æ­¤é˜Ÿåˆ—å¿…é¡»å…·æœ‰æœ‰é™çš„å®¹é‡ï¼Œä»¥ä½¿çº¿ç¨‹æ± è¶…å‡ºæ ¸å¿ƒå¤§å°(è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨ä½¿ç”¨æ— ç•Œé˜Ÿåˆ—æ—¶ï¼Œå›ºå®šå¤§å°æ± æ˜¯å”¯ä¸€åˆç†çš„æƒ…å†µ)ã€‚</p><p>å¦‚ä¸Šæ‰€è¿°ï¼Œåœ¨ä»»åŠ¡è¢«æ‹’ç»æ—¶è€ƒè™‘è¿™ç§æƒ…å†µã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ä»»åŠ¡è¢«æ‹’ç»æ—¶ï¼Œçº¿ç¨‹æ± æ‰§è¡Œç¨‹åºä¼šæŠ›å‡º<code>TaskRejectedException</code>ã€‚ä½†æ˜¯ï¼Œæ‹’ç»ç­–ç•¥å®é™…ä¸Šæ˜¯å¯é…ç½®çš„ã€‚ä½¿ç”¨é»˜è®¤æ‹’ç»ç­–ç•¥æ—¶æŠ›å‡ºå¼‚å¸¸ï¼Œå³<code>AbortPolicy</code>å®ç°ã€‚å¯¹äºå¯ä»¥åœ¨é«˜è´Ÿè½½ä¸‹è·³è¿‡æŸäº›ä»»åŠ¡çš„åº”ç”¨ç¨‹åºï¼Œæ‚¨å¯ä»¥æ”¹ä¸ºé…ç½®<code>DiscardPolicy</code>æˆ–<code>DiscardOldestPolicy</code>ã€‚å¦ä¸€ä¸ªé€‚ç”¨äºéœ€è¦åœ¨é«˜è´Ÿè½½ä¸‹é™åˆ¶æäº¤ä»»åŠ¡çš„åº”ç”¨ç¨‹åºçš„é€‰é¡¹æ˜¯<code>CallerRunsPolicy</code>ã€‚è¯¥ç­–ç•¥ä¸æ˜¯æŠ›å‡ºå¼‚å¸¸æˆ–ä¸¢å¼ƒä»»åŠ¡ï¼Œè€Œæ˜¯å¼ºåˆ¶è°ƒç”¨submitæ–¹æ³•çš„çº¿ç¨‹è‡ªå·±è¿è¡Œä»»åŠ¡ã€‚è¿™ä¸ªæƒ³æ³•æ˜¯è¿™æ ·çš„è°ƒç”¨è€…åœ¨è¿è¡Œè¯¥ä»»åŠ¡æ—¶å¾ˆå¿™ï¼Œå¹¶ä¸”ä¸èƒ½ç«‹å³æäº¤å…¶ä»–ä»»åŠ¡ã€‚å› æ­¤ï¼Œå®ƒæä¾›äº†ä¸€ç§ç®€å•çš„æ–¹æ³•æ¥é™åˆ¶ä¼ å…¥çš„è´Ÿè½½ï¼ŒåŒæ—¶ä¿æŒçº¿ç¨‹æ± å’Œé˜Ÿåˆ—çš„é™åˆ¶ã€‚é€šå¸¸ï¼Œè¿™å…è®¸æ‰§è¡Œç¨‹åºâ€œèµ¶ä¸Šâ€å®ƒæ­£åœ¨å¤„ç†çš„ä»»åŠ¡ï¼Œä»è€Œé‡Šæ”¾é˜Ÿåˆ—ï¼Œæ± ä¸­æˆ–ä¸¤è€…ä¸­çš„ä¸€äº›å®¹é‡ã€‚æ‚¨å¯ä»¥ä»<code>executor</code>å…ƒç´ ä¸Šçš„<code>rejection-policy</code>å±æ€§çš„å¯ç”¨å€¼æšä¸¾ä¸­é€‰æ‹©ä»»ä½•è¿™äº›é€‰é¡¹ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†ä¸€ä¸ª<code>executor</code> å…ƒç´ ï¼Œå…¶ä¸­åŒ…å«è®¸å¤šå±æ€§ä»¥æŒ‡å®šå„ç§è¡Œä¸ºï¼š:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;task:executor<br><br>        <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;executorWithCallerRunsPolicy&quot;</span><br><br>        <span class="hljs-attribute">pool-size</span>=<span class="hljs-string">&quot;5-25&quot;</span><br><br>        <span class="hljs-attribute">queue-capacity</span>=<span class="hljs-string">&quot;100&quot;</span><br><br>        <span class="hljs-attribute">rejection-policy</span>=<span class="hljs-string">&quot;CALLER_RUNS&quot;</span>/&gt;<br></code></pre></td></tr></table></figure><p>æœ€å, <code>keep-alive</code>è®¾ç½®ç¡®å®šåœ¨ç»ˆæ­¢ä¹‹å‰çº¿ç¨‹å¯èƒ½ä¿æŒç©ºé—²çš„æ—¶é—´é™åˆ¶(ä»¥ç§’ä¸ºå•ä½)ã€‚å¦‚æœæ± ä¸­å½“å‰æœ‰å¤šä¸ªçº¿ç¨‹çš„æ ¸å¿ƒæ•°ç›®ï¼Œåˆ™åœ¨ç­‰å¾…æ­¤æ—¶é—´é‡åä¸å¤„ç†ä»»åŠ¡ï¼Œå¤šä½™çš„çº¿ç¨‹å°†è¢«ç»ˆæ­¢ã€‚æ—¶é—´å€¼ä¸ºé›¶å°†å¯¼è‡´å¤šä½™çš„çº¿ç¨‹åœ¨æ‰§è¡Œä»»åŠ¡åç«‹å³ç»ˆæ­¢ï¼Œè€Œä¸éœ€è¦åœ¨ä»»åŠ¡é˜Ÿåˆ—ä¸­ä¿ç•™åç»­å·¥ä½œã€‚ä»¥ä¸‹ç¤ºä¾‹å°†<code>keep-alive</code>å€¼è®¾ç½®ä¸ºä¸¤åˆ†é’Ÿï¼š:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;task:executor<br><br>        <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;executorWithKeepAlive&quot;</span><br><br>        <span class="hljs-attribute">pool-size</span>=<span class="hljs-string">&quot;5-25&quot;</span><br><br>        <span class="hljs-attribute">keep-alive</span>=<span class="hljs-string">&quot;120&quot;</span>/&gt;<br></code></pre></td></tr></table></figure><h4 id="6-4-3-â€˜scheduled-tasksâ€™-å…ƒç´ "><a href="#6-4-3-â€˜scheduled-tasksâ€™-å…ƒç´ " class="headerlink" title="6.4.3. â€˜scheduled-tasksâ€™ å…ƒç´ "></a>6.4.3. â€˜scheduled-tasksâ€™ å…ƒç´ </h4><p>Springçš„ä»»åŠ¡å‘½åç©ºé—´çš„æœ€å¼ºå¤§åŠŸèƒ½æ˜¯æ”¯æŒé…ç½®åœ¨Springåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­å®‰æ’çš„ä»»åŠ¡ã€‚è¿™éµå¾ªäº†ç±»ä¼¼äºSpringä¸­å…¶ä»–â€œmethod-invokersâ€çš„æ–¹æ³•ï¼Œä¾‹å¦‚ç”±JMSå‘½åç©ºé—´æä¾›çš„ç”¨äºé…ç½®æ¶ˆæ¯é©±åŠ¨çš„pojoã€‚ åŸºæœ¬ä¸Šï¼Œ <code>ref</code>å±æ€§å¯ä»¥æŒ‡å‘ä»»ä½•Springç®¡ç†çš„å¯¹è±¡ï¼Œ <code>method</code> å±æ€§æä¾›è¦åœ¨è¯¥å¯¹è±¡ä¸Šè°ƒç”¨çš„æ–¹æ³•çš„åç§°ã€‚ ä»¥ä¸‹æ¸…å•æ˜¾ç¤ºäº†ä¸€ä¸ªç®€å•ç¤ºä¾‹ï¼š:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;task:scheduled-tasks <span class="hljs-attribute">scheduler</span>=<span class="hljs-string">&quot;myScheduler&quot;</span>&gt;    &lt;task:scheduled <span class="hljs-attribute">ref</span>=<span class="hljs-string">&quot;beanA&quot;</span> <span class="hljs-attribute">method</span>=<span class="hljs-string">&quot;methodA&quot;</span> <span class="hljs-attribute">fixed-delay</span>=<span class="hljs-string">&quot;5000&quot;</span>/&gt;&lt;/task:scheduled-tasks&gt;<br>&lt;task:scheduler <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;myScheduler&quot;</span> <span class="hljs-attribute">pool-size</span>=<span class="hljs-string">&quot;10&quot;</span>/&gt;<br></code></pre></td></tr></table></figure><p>Tschedulerç”±å¤–éƒ¨å…ƒç´ å¼•ç”¨ï¼Œæ¯ä¸ªå•ç‹¬çš„ä»»åŠ¡éƒ½åŒ…æ‹¬å…¶è§¦å‘å™¨å…ƒæ•°æ®çš„é…ç½®ã€‚åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œè¯¥å…ƒæ•°æ®å®šä¹‰äº†ä¸€ä¸ªå®šæœŸè§¦å‘å™¨ï¼Œå®ƒå…·æœ‰å›ºå®šçš„å»¶è¿Ÿï¼Œè¡¨ç¤ºæ¯ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæˆåç­‰å¾…çš„æ¯«ç§’æ•°ã€‚å¦ä¸€ä¸ªé€‰é¡¹æ˜¯â€<code>fixed-rate</code>â€ï¼Œè¡¨ç¤ºæ— è®ºä»¥å‰æ‰§è¡Œå¤šé•¿æ—¶é—´ï¼Œæ–¹æ³•çš„æ‰§è¡Œé¢‘ç‡ã€‚æ­¤å¤–ï¼Œ ï¼Œå¯¹äº<code>fixed-delay</code>å’Œ<code>fixed-rate</code>ä»»åŠ¡ï¼Œå¯ä»¥æŒ‡å®šâ€™initial-delayâ€™å‚æ•°ï¼ŒæŒ‡ç¤ºåœ¨ç¬¬ä¸€æ¬¡æ‰§è¡Œè¯¥æ–¹æ³•ä¹‹å‰ç­‰å¾…çš„æ¯«ç§’æ•°ã€‚ä¸ºäº†è·å¾—æ›´å¤šçš„æ§åˆ¶ï¼Œå¯ä»¥æ”¹ä¸ºæä¾›ä¸€ä¸ª<code>cron</code>å±æ€§ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªæ¼”ç¤ºå…¶ä»–é€‰é¡¹çš„ç¤ºä¾‹:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;task:scheduled-tasks <span class="hljs-attribute">scheduler</span>=<span class="hljs-string">&quot;myScheduler&quot;</span>&gt;    &lt;task:scheduled <span class="hljs-attribute">ref</span>=<span class="hljs-string">&quot;beanA&quot;</span> <span class="hljs-attribute">method</span>=<span class="hljs-string">&quot;methodA&quot;</span> <span class="hljs-attribute">fixed-delay</span>=<span class="hljs-string">&quot;5000&quot;</span> <span class="hljs-attribute">initial-delay</span>=<span class="hljs-string">&quot;1000&quot;</span>/&gt;    &lt;task:scheduled <span class="hljs-attribute">ref</span>=<span class="hljs-string">&quot;beanB&quot;</span> <span class="hljs-attribute">method</span>=<span class="hljs-string">&quot;methodB&quot;</span> <span class="hljs-attribute">fixed-rate</span>=<span class="hljs-string">&quot;5000&quot;</span>/&gt;    &lt;task:scheduled <span class="hljs-attribute">ref</span>=<span class="hljs-string">&quot;beanC&quot;</span> <span class="hljs-attribute">method</span>=<span class="hljs-string">&quot;methodC&quot;</span> <span class="hljs-attribute">cron</span>=<span class="hljs-string">&quot;*/5 * * * * MON-FRI&quot;</span>/&gt;&lt;/task:scheduled-tasks&gt;<br>&lt;task:scheduler <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;myScheduler&quot;</span> <span class="hljs-attribute">pool-size</span>=<span class="hljs-string">&quot;10&quot;</span>/&gt;<br></code></pre></td></tr></table></figure><h3 id="6-5-ä½¿ç”¨Quartzçš„Scheduler"><a href="#6-5-ä½¿ç”¨Quartzçš„Scheduler" class="headerlink" title="6.5. ä½¿ç”¨Quartzçš„Scheduler"></a>6.5. ä½¿ç”¨Quartzçš„Scheduler</h3><p>Quartzä½¿ç”¨<code>Trigger</code>, <code>Job</code>, å’Œ <code>JobDetail</code>ç­‰å¯¹è±¡æ¥è¿›è¡Œå„ç§ç±»å‹çš„ä»»åŠ¡è°ƒåº¦ã€‚å…³äºQuartzçš„åŸºæœ¬æ¦‚å¿µï¼Œè¯·å‚é˜…<a href="http://quartz-scheduler.org/">http://quartz-scheduler.org</a>ã€‚ä¸ºäº†è®©åŸºäºSpringçš„åº”ç”¨ç¨‹åºæ–¹ä¾¿ä½¿ç”¨ï¼ŒSpringæä¾›äº†ä¸€äº›ç±»æ¥ç®€åŒ–quartzçš„ç”¨æ³•ã€‚</p><h4 id="6-5-1-ä½¿ç”¨JobDetailFactoryBean"><a href="#6-5-1-ä½¿ç”¨JobDetailFactoryBean" class="headerlink" title="6.5.1. ä½¿ç”¨JobDetailFactoryBean"></a>6.5.1. ä½¿ç”¨<code>JobDetailFactoryBean</code></h4><p>Quartz <code>JobDetail</code> å¯¹è±¡ä¿å­˜è¿è¡Œä¸€ä¸ªä»»åŠ¡æ‰€éœ€çš„å…¨éƒ¨ä¿¡æ¯ã€‚Springæä¾›ä¸€ä¸ªå«ä½œ <code>JobDetailFactoryBean</code>çš„ç±»è®©JobDetailèƒ½å¯¹ä¸€äº›æœ‰æ„ä¹‰çš„åˆå§‹å€¼(ä»XMLé…ç½®)è¿›è¡Œåˆå§‹åŒ–ï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸ªä¾‹å­:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;exampleJob&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.scheduling.quartz.JobDetailFactoryBean&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;jobClass&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;example.ExampleJob&quot;</span>/&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;jobDataAsMap&quot;</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">map</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;timeout&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;5&quot;</span>/&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">map</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p>job detail é…ç½®æ‹¥æœ‰æ‰€æœ‰è¿è¡Œjob(<code>ExampleJob</code>)çš„å¿…è¦ä¿¡æ¯ã€‚ å¯ä»¥é€šè¿‡jobçš„data mapæ¥æŒ‡å®štimeoutã€‚Jobçš„data mapå¯ä»¥é€šè¿‡<code>JobExecutionContext</code>ï¼ˆåœ¨è¿è¡Œæ—¶ä¼ é€’ç»™ä½ )æ¥å¾—åˆ°ï¼Œä½†æ˜¯ <code>JobDetail</code>åŒæ—¶æŠŠä»jobçš„data mapä¸­å¾—åˆ°çš„å±æ€§æ˜ å°„åˆ°å®é™…jobä¸­çš„å±æ€§ä¸­å»ã€‚ æ‰€ä»¥ï¼Œå¦‚æœ<code>ExampleJob</code>ä¸­åŒ…å«ä¸€ä¸ªåä¸º <code>timeout</code>çš„å±æ€§ï¼Œ<code>JobDetail</code>å°†è‡ªåŠ¨ä¸ºå®ƒèµ‹å€¼:</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">package</span> example;<br>public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExampleJob</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">QuartzJobBean</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> int timeout;<br>    <span class="hljs-comment">/**     * Setter called after the ExampleJob is instantiated     * with the value from the JobDetailFactoryBean (5)     */</span>    public void setTimeout(int timeout) &#123;        <span class="hljs-keyword">this</span>.timeout = timeout;    &#125;<br>    <span class="hljs-keyword">protected</span> void executeInternal(<span class="hljs-type">JobExecutionContext</span> ctx) <span class="hljs-keyword">throws</span> <span class="hljs-type">JobExecutionException</span> &#123;        <span class="hljs-comment">// do the actual work    &#125;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>data mapä¸­çš„æ‰€æœ‰é™„åŠ å±æ€§å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨çš„</p><p>ä½¿ç”¨<code>name</code>å’Œ<code>group</code>å±æ€§ï¼Œä½ å¯ä»¥åˆ†åˆ«ä¿®æ”¹jobåœ¨å“ªä¸€ä¸ªç»„ä¸‹è¿è¡Œå’Œä½¿ç”¨ä»€ä¹ˆåç§°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œjobçš„åç§°ç­‰äº<code>JobDetailFactoryBean</code>çš„åç§°ï¼ˆåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ä¸º<code>exampleJob</code>)ã€‚</p><h4 id="6-5-2-ä½¿ç”¨-MethodInvokingJobDetailFactoryBean"><a href="#6-5-2-ä½¿ç”¨-MethodInvokingJobDetailFactoryBean" class="headerlink" title="6.5.2. ä½¿ç”¨ MethodInvokingJobDetailFactoryBean"></a>6.5.2. ä½¿ç”¨ <code>MethodInvokingJobDetailFactoryBean</code></h4><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œä½ åªéœ€è¦è°ƒç”¨ç‰¹å®šå¯¹è±¡ä¸Šçš„ä¸€ä¸ªæ–¹æ³•å³å¯å®ç°ä»»åŠ¡è°ƒåº¦ã€‚ä½ å¯ä»¥ä½¿ç”¨<code>MethodInvokingJobDetailFactoryBean</code>å‡†ç¡®çš„åšåˆ°è¿™ä¸€ç‚¹:</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs abnf">&lt;bean id<span class="hljs-operator">=</span><span class="hljs-string">&quot;jobDetail&quot;</span> class<span class="hljs-operator">=</span><span class="hljs-string">&quot;org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean&quot;</span>&gt;<br><br>    &lt;property name<span class="hljs-operator">=</span><span class="hljs-string">&quot;targetObject&quot;</span> ref<span class="hljs-operator">=</span><span class="hljs-string">&quot;exampleBusinessObject&quot;</span>/&gt;<br><br>    &lt;property name<span class="hljs-operator">=</span><span class="hljs-string">&quot;targetMethod&quot;</span> value<span class="hljs-operator">=</span><span class="hljs-string">&quot;doIt&quot;</span>/&gt;<br><br>&lt;/bean&gt;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢ä¾‹å­å°†è°ƒç”¨<code>exampleBusinessObject</code>ä¸­çš„<code>doIt</code> æ–¹æ³•å¦‚ä¸‹:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ExampleBusinessObject</span> &#123;<br>    <span class="hljs-comment">// properties and collaborators</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doIt</span>()</span> &#123;        <span class="hljs-comment">// do the actual work    &#125;&#125;</span><br>&lt;bean id=<span class="hljs-string">&quot;exampleBusinessObject&quot;</span> <span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;examples.ExampleBusinessObject&quot;</span>/&gt;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨<code>MethodInvokingJobDetailFactoryBean</code>ä½ ä¸éœ€è¦åˆ›å»ºåªæœ‰ä¸€è¡Œä»£ç ä¸”åªè°ƒç”¨ä¸€ä¸ªæ–¹æ³•çš„jobï¼Œ ä½ åªéœ€è¦åˆ›å»ºçœŸå®çš„ä¸šåŠ¡å¯¹è±¡æ¥åŒ…è£…å…·ä½“çš„ç»†èŠ‚çš„å¯¹è±¡ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒQuartz Jobsæ˜¯æ— çŠ¶æ€çš„ï¼Œå¯èƒ½å¯¼è‡´jobsä¹‹é—´äº’ç›¸çš„å½±å“ã€‚å¦‚æœä½ ä¸ºç›¸åŒçš„<code>JobDetail</code>æŒ‡å®šä¸¤ä¸ªTriggerï¼Œ å¾ˆå¯èƒ½å½“ç¬¬ä¸€ä¸ªjobå®Œæˆä¹‹å‰ï¼Œç¬¬äºŒä¸ªjobå°±å¼€å§‹äº†ã€‚å¦‚æœ<code>JobDetail</code>å¯¹è±¡å®ç°äº†<code>Stateful</code>æ¥å£ï¼Œå°±ä¸ä¼šå‘ç”Ÿè¿™æ ·çš„äº‹æƒ…ã€‚ ç¬¬äºŒä¸ªjobå°†ä¸ä¼šåœ¨ç¬¬ä¸€ä¸ªjobå®Œæˆä¹‹å‰å¼€å§‹ã€‚ä¸ºäº†ä½¿å¾—jobsä¸å¹¶å‘è¿è¡Œï¼Œè®¾ç½®<code>MethodInvokingJobDetailFactoryBean</code>ä¸­çš„<code>concurrent</code>æ ‡è®°ä¸º<code>false</code>:</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs abnf">&lt;bean id<span class="hljs-operator">=</span><span class="hljs-string">&quot;jobDetail&quot;</span> class<span class="hljs-operator">=</span><span class="hljs-string">&quot;org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean&quot;</span>&gt;<br><br>    &lt;property name<span class="hljs-operator">=</span><span class="hljs-string">&quot;targetObject&quot;</span> ref<span class="hljs-operator">=</span><span class="hljs-string">&quot;exampleBusinessObject&quot;</span>/&gt;<br><br>    &lt;property name<span class="hljs-operator">=</span><span class="hljs-string">&quot;targetMethod&quot;</span> value<span class="hljs-operator">=</span><span class="hljs-string">&quot;doIt&quot;</span>/&gt;<br><br>    &lt;property name<span class="hljs-operator">=</span><span class="hljs-string">&quot;concurrent&quot;</span> value<span class="hljs-operator">=</span><span class="hljs-string">&quot;false&quot;</span>/&gt;<br><br>&lt;/bean&gt;<br></code></pre></td></tr></table></figure><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œjobsåœ¨å¹¶å‘çš„æ–¹å¼ä¸‹è¿è¡Œã€‚</p><h4 id="6-5-3-ä½¿ç”¨triggerså’ŒSchedulerFactoryBeanæ¥ç»‡å…¥ä»»åŠ¡"><a href="#6-5-3-ä½¿ç”¨triggerså’ŒSchedulerFactoryBeanæ¥ç»‡å…¥ä»»åŠ¡" class="headerlink" title="6.5.3. ä½¿ç”¨triggerså’ŒSchedulerFactoryBeanæ¥ç»‡å…¥ä»»åŠ¡"></a>6.5.3. ä½¿ç”¨triggerså’Œ<code>SchedulerFactoryBean</code>æ¥ç»‡å…¥ä»»åŠ¡</h4><p>æˆ‘ä»¬å·²ç»åˆ›å»ºäº†job detailsï¼Œjobsã€‚æˆ‘ä»¬åŒæ—¶å›é¡¾äº†å…è®¸ä½ è°ƒç”¨ç‰¹å®šå¯¹è±¡ä¸ŠæŸä¸€ä¸ªæ–¹æ³•çš„ä¾¿æ·çš„beanã€‚ å½“ç„¶æˆ‘ä»¬ä»éœ€è¦è°ƒåº¦è¿™äº›jobsã€‚è¿™éœ€è¦ä½¿ç”¨triggerså’Œ<code>SchedulerFactoryBean</code>æ¥å®Œæˆã€‚ Quartzä¸­æä¾›äº†å‡ ä¸ªtriggersï¼ŒSpringæä¾›äº†ä¸¤ä¸ªå¸¦æœ‰æ–¹ä¾¿é»˜è®¤å€¼çš„Quartz <code>FactoryBean</code>å®ç°ï¼š<code>CronTriggerFactoryBean</code>å’Œ<code>SimpleTriggerFactoryBean</code>ã€‚</p><p>Triggersä¹Ÿéœ€è¦è¢«è°ƒåº¦ã€‚Springæä¾›<code>SchedulerFactoryBean</code>æ¥å…¬å¼€ä¸€äº›å±æ€§æ¥è®¾ç½®triggersã€‚<code>SchedulerFactoryBean</code>è´Ÿè´£è°ƒåº¦é‚£äº›å®é™…çš„triggers</p><p>ä»¥ä¸‹æ¸…å•ä½¿ç”¨<code>SimpleTriggerFactoryBean</code>å’Œ<code>CronTriggerFactoryBean</code>:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;simpleTrigger&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.scheduling.quartz.SimpleTriggerFactoryBean&quot;</span>&gt;</span>    <span class="hljs-comment">&lt;!-- see the example of method invoking job above --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;jobDetail&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;jobDetail&quot;</span>/&gt;</span>    <span class="hljs-comment">&lt;!-- 10 seconds --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;startDelay&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;10000&quot;</span>/&gt;</span>    <span class="hljs-comment">&lt;!-- repeat every 50 seconds --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;repeatInterval&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;50000&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;cronTrigger&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.scheduling.quartz.CronTriggerFactoryBean&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;jobDetail&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;exampleJob&quot;</span>/&gt;</span>    <span class="hljs-comment">&lt;!-- run every morning at 6 AM --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;cronExpression&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;0 0 6 * * ?&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬åˆ›å»ºäº†ä¸¤ä¸ªtriggersï¼Œå…¶ä¸­ä¸€ä¸ªå¼€å§‹å»¶è¿Ÿ10ç§’ä»¥åæ¯50ç§’è¿è¡Œä¸€æ¬¡ï¼Œå¦ä¸€ä¸ªæ¯å¤©æ—©ä¸Š6ç‚¹é’Ÿè¿è¡Œã€‚ æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª<code>SchedulerFactoryBean</code>æ¥æœ€ç»ˆå®ç°ä¸Šè¿°çš„ä¸€åˆ‡:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.scheduling.quartz.SchedulerFactoryBean&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;triggers&quot;</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">bean</span>=<span class="hljs-string">&quot;cronTrigger&quot;</span>/&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">bean</span>=<span class="hljs-string">&quot;simpleTrigger&quot;</span>/&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æ›´å¤šçš„å±æ€§ä½ å¯ä»¥é€šè¿‡<code>SchedulerFactoryBean</code>æ¥è®¾ç½®ï¼Œä¾‹å¦‚job detailsä½¿ç”¨çš„æ—¥æœŸï¼Œ ç”¨æ¥è®¢åˆ¶Quartzçš„ä¸€äº›å±æ€§ä»¥åŠå…¶å®ƒç›¸å…³ä¿¡æ¯ã€‚ ä½ å¯ä»¥æŸ¥é˜…<a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/scheduling/quartz/SchedulerFactoryBean.html"><code>SchedulerFactoryBean</code></a>çš„Javadocã€‚</p><blockquote><p>Rod Johnson, Juergen Hoeller, Keith Donald, Colin Sampaleanu, Rob Harrop, Thomas Risberg, Alef Arendsen, Darren Davison, Dmitriy Kopylenko, Mark Pollack, Thierry Templier, Erwin Vervaet, Portia Tung, Ben Hale, Adrian Colyer, John Lewis, Costin Leau, Mark Fisher, Sam Brannen, Ramnivas Laddad, Arjen Poutsma, Chris Beams, Tareq Abedrabbo, Andy Clement, Dave Syer, Oliver Gierke, Rossen Stoyanchev, Phillip Webb, Rob Winch, Brian Clozel, Stephane Nicoll, Sebastien Deleuze, Jay Bryant, Mark Paluch</p></blockquote><blockquote><p>Copyright Â© 2002 - 2024 VMware, Inc. All Rights Reserved.</p></blockquote><blockquote><p>Copies of this document may be made for your own use and for distribution to others, provided that you do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically.</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>Spring æ•™ç¨‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Spring</tag>
      
      <tag>å®šæ—¶ren&#39;w</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Web Clients</title>
    <link href="/post/efb32359-a119-4f6d-a418-0c879bc6867b/"/>
    <url>/post/efb32359-a119-4f6d-a418-0c879bc6867b/</url>
    
    <content type="html"><![CDATA[<h1 id="Web-Clients"><a href="#Web-Clients" class="headerlink" title="Web Clients"></a>Web Clients</h1><p>Spring æ•™ç¨‹</p><hr><h2 id="1-REST-Clients"><a href="#1-REST-Clients" class="headerlink" title="1. REST Clients"></a>1. REST Clients</h2><p>Spring Framework ä¸ºè°ƒç”¨ REST ç«¯ç‚¹æä¾›äº†ä»¥ä¸‹é€‰æ‹©ï¼š</p><ul><li><a href="https://sca.aliyun.com/learn/spring/web-servlet/rest-clients/?spm=0.29160081.0.0.51f92e5dCHrGI4#rest-webclient">WebClient</a> - å…·æœ‰éé˜»å¡ã€å“åº”å¼çš„æµå¼ API å®¢æˆ·ç«¯ã€‚</li><li><a href="https://sca.aliyun.com/learn/spring/web-servlet/rest-clients/?spm=0.29160081.0.0.51f92e5dCHrGI4#rest-resttemplate">RestTemplate</a> - å…·æœ‰ template method API çš„åŒæ­¥å®¢æˆ·ç«¯.</li><li><a href="https://sca.aliyun.com/learn/spring/web-servlet/rest-clients/?spm=0.29160081.0.0.51f92e5dCHrGI4#rest-http-interface">HTTP Interface</a> - å…·æœ‰ç”Ÿæˆçš„åŠ¨æ€ä»£ç†å®ç°çš„æ³¨è§£æ¥å£ã€‚</li></ul><h3 id="1-1-WebClient"><a href="#1-1-WebClient" class="headerlink" title="1.1. WebClient"></a>1.1. WebClient</h3><p>WebClient æ˜¯ä¸€ä¸ªéé˜»å¡çš„ã€å“åº”å¼çš„å®¢æˆ·ç«¯ï¼Œç”¨äºæ‰§è¡Œ HTTP è¯·æ±‚ã€‚ å®ƒåœ¨ 5.0 ä¸­å¼•å…¥ï¼Œæä¾›äº† RestTemplate çš„æ›¿ä»£æ–¹æ¡ˆï¼Œæ”¯æŒåŒæ­¥ã€å¼‚æ­¥å’Œæµå¼åœºæ™¯ã€‚ WebClient æ”¯æŒä»¥ä¸‹å†…å®¹:</p><ul><li>éé˜»å¡ I&#x2F;Oã€‚</li><li>Reactive Streams èƒŒå‹.</li><li>é«˜å¹¶å‘ï¼Œç¡¬ä»¶èµ„æºå°‘ã€‚</li><li>åˆ©ç”¨ Java 8 lambda çš„å‡½æ•°å¼ã€æµå¼çš„ APIã€‚</li><li>åŒæ­¥å’Œå¼‚æ­¥äº¤äº’ã€‚</li><li>æµå¼ä¼ è¾“åˆ°æœåŠ¡å™¨æˆ–ä»æœåŠ¡å™¨è¿›è¡Œæµå¼ä¼ è¾“ã€‚</li></ul><p>å‚é˜… Spring å®˜æ–¹æ–‡æ¡£ WebClient ç« èŠ‚è·å–æ›´å¤šç»†èŠ‚.</p><h3 id="1-2-RestTemplate"><a href="#1-2-RestTemplate" class="headerlink" title="1.2. RestTemplate"></a>1.2. RestTemplate</h3><p>RestTemplate åœ¨ HTTP å®¢æˆ·ç«¯åº“ä¸Šæä¾›äº†æ›´é«˜çº§åˆ«çš„ API,å®ƒä½¿å¾—åœ¨ä¸€è¡Œä¸­è°ƒç”¨ REST ç«¯ç‚¹å˜å¾—å®¹æ˜“. å®ƒæš´éœ²äº†ä»¥ä¸‹é‡è½½æ–¹æ³•ç»„:</p><blockquote><p>ä» 5.0 ç‰ˆæœ¬å¼€å§‹ï¼Œ RestTemplate å¤„äºç»´æŠ¤æ¨¡å¼ï¼Œ ä»¥ååªæœ‰å¾ˆå°çš„æ›´æ”¹å’Œé”™è¯¯è¯·æ±‚è¢«æ¥å—. è¯·è€ƒè™‘ä½¿ç”¨ WebClient API æ›¿ä»£.</p></blockquote><table><thead><tr><th>Method group</th><th>Description</th></tr></thead><tbody><tr><td>getForObject</td><td>é€šè¿‡ GET è·å–å“åº”.</td></tr><tr><td>getForEntity</td><td>ä½¿ç”¨ GET è·å– ResponseEntity (å³status, headerså’Œbody)</td></tr><tr><td>headForHeaders</td><td>ä½¿ç”¨ HEAD è·å–æ‰€æœ‰ headers</td></tr><tr><td>postForLocation</td><td>ä½¿ç”¨ POST åˆ›å»ºæ–°èµ„æº,å¹¶ä»å“åº”ä¸­è¿”å› Location è¯·æ±‚å¤´.</td></tr><tr><td>postForObject</td><td>ä½¿ç”¨ POST åˆ›å»ºæ–°èµ„æºå¹¶ä»å“åº”ä¸­è¿”å›è¡¨ç¤º.</td></tr><tr><td>postForEntity</td><td>ä½¿ç”¨ POST åˆ›å»ºæ–°èµ„æºå¹¶ä»å“åº”ä¸­è¿”å›è¡¨ç¤º.</td></tr><tr><td>put</td><td>ä½¿ç”¨ PUT åˆ›å»ºæˆ–æ›´æ–°èµ„æº.</td></tr><tr><td>patchForObject</td><td>ä½¿ç”¨ PATCH æ›´æ–°èµ„æºå¹¶ä»å“åº”ä¸­è¿”å›è¡¨ç¤º. è¯·æ³¨æ„,JDK HttpURLConnection ä¸æ”¯æŒ PATCH,ä½†Apache HttpComponents å’Œå…¶ä»–ä¸€æ ·.</td></tr><tr><td>delete</td><td>ä½¿ç”¨ DELETE åˆ é™¤æŒ‡å®š URI å¤„çš„èµ„æº.</td></tr><tr><td>optionsForAllow</td><td>ä½¿ç”¨ ALLOW æ£€ç´¢èµ„æºçš„å…è®¸ HTTP æ–¹æ³•.</td></tr><tr><td>exchange</td><td>ä¸Šè¿°æ–¹æ³•çš„æ›´é€šç”¨ (ä¸”ä¸å¤ªå›ºå®š) çš„ç‰ˆæœ¬,åœ¨éœ€è¦æ—¶æä¾›é¢å¤–çš„çµæ´»æ€§. å®ƒæ¥å— RequestEntity (åŒ…æ‹¬ HTTP æ–¹æ³•,URL,headers å’Œæ­£æ–‡ä½œä¸ºè¾“å…¥) å¹¶è¿”å› ResponseEntity.</td></tr><tr><td>è¿™äº›æ–¹æ³•å…è®¸ä½¿ç”¨ ParameterizedTypeReference è€Œä¸æ˜¯ Class æ¥æŒ‡å®šå…·æœ‰æ³›å‹çš„å“åº”ç±»å‹.</td><td></td></tr><tr><td>execute</td><td>æ‰§è¡Œè¯·æ±‚çš„æœ€é€šç”¨æ–¹å¼,é€šè¿‡å›è°ƒæ¥å£å®Œå…¨æ§åˆ¶è¯·æ±‚å‡†å¤‡å’Œå“åº”æå–.</td></tr></tbody></table><h4 id="1-2-1-åˆå§‹åŒ–"><a href="#1-2-1-åˆå§‹åŒ–" class="headerlink" title="1.2.1. åˆå§‹åŒ–"></a>1.2.1. åˆå§‹åŒ–</h4><p>é»˜è®¤æ„é€ å‡½æ•°ä½¿ç”¨ java.net.HttpURLConnection æ¥æ‰§è¡Œè¯·æ±‚. æ‚¨å¯ä»¥ä½¿ç”¨ ClientHttpRequestFactory çš„å®ç°åˆ‡æ¢åˆ°ä¸åŒçš„ HTTP åº“. å†…ç½®æ”¯æŒä»¥ä¸‹å†…å®¹:</p><ul><li>Apache HttpComponents</li><li>Netty</li><li>OkHttp</li></ul><p>ä¾‹å¦‚,è¦åˆ‡æ¢åˆ° Apache HttpComponents,æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤:</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs haxe">RestTemplate template = <span class="hljs-keyword">new</span> <span class="hljs-type">RestTemplate</span>(<span class="hljs-keyword">new</span> <span class="hljs-type">HttpComponentsClientHttpRequestFactory</span>());<br></code></pre></td></tr></table></figure><p>æ¯ä¸ª ClientHttpRequestFactory éƒ½æš´éœ²ç‰¹å®šäºåº•å±‚ HTTP å®¢æˆ·ç«¯åº“çš„é…ç½®é€‰é¡¹ - ä¾‹å¦‚,ç”¨äºå‡­æ®,è¿æ¥æ± å’Œå…¶ä»–è¯¦ç»†ä¿¡æ¯.</p><blockquote><p>è¯·æ³¨æ„,HTTP è¯·æ±‚çš„ java.net å®ç°åœ¨è®¿é—®è¡¨ç¤ºé”™è¯¯çš„å“åº”çš„çŠ¶æ€ (ä¾‹å¦‚ 401) æ—¶å¯èƒ½å¼•å‘å¼‚å¸¸. å¦‚æœè¿™æ˜¯ä¸€ä¸ªé—®é¢˜,è¯·åˆ‡æ¢åˆ°å¦ä¸€ä¸ª HTTP å®¢æˆ·ç«¯åº“.</p></blockquote><h5 id="URIs"><a href="#URIs" class="headerlink" title="URIs"></a>URIs</h5><p>è®¸å¤š RestTemplate æ–¹æ³•éƒ½æ¥å— URI æ¨¡æ¿å’Œ URI æ¨¡æ¿å˜é‡ï¼Œ ä½œä¸º String å˜é‡å‚æ•°æˆ– Map&lt;String,String&gt;. ä»¥ä¸‹ç¤ºä¾‹ä½¿ç”¨ String å˜é‡å‚æ•°:</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-type">String</span> result = restTemplate.<span class="hljs-built_in">getForObject</span>(<br><br>    <span class="hljs-string">&quot;https://example.com/hotels/&#123;hotel&#125;/bookings/&#123;booking&#125;&quot;</span>, <span class="hljs-type">String</span>.<span class="hljs-keyword">class</span>, <span class="hljs-string">&quot;42&quot;</span>, <span class="hljs-string">&quot;21&quot;</span>);<br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹ç¤ºä¾‹ä½¿ç”¨ Map&lt;String, String&gt;:</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript"><span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">String</span>&gt; vars = Collections.singletonMap(<span class="hljs-string">&quot;hotel&quot;</span>, <span class="hljs-string">&quot;42&quot;</span>);<br><span class="hljs-built_in">String</span> result = restTemplate.getForObject(    <span class="hljs-string">&quot;https://example.com/hotels/&#123;hotel&#125;/rooms/&#123;hotel&#125;&quot;</span>, <span class="hljs-built_in">String</span>.<span class="hljs-keyword">class</span>, vars);<br></code></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œ URI æ¨¡æ¿æ˜¯è‡ªåŠ¨ç¼–ç çš„ï¼Œ å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arduino">restTemplate.<span class="hljs-built_in">getForObject</span>(<span class="hljs-string">&quot;https://example.com/hotel list&quot;</span>, <span class="hljs-type">String</span>.<span class="hljs-keyword">class</span>);<br><span class="hljs-comment">// Results in request to &quot;https://example.com/hotel%20list&quot;</span><br></code></pre></td></tr></table></figure><p>æ‚¨å¯ä»¥ä½¿ç”¨ RestTemplate çš„ uriTemplateHandler å±æ€§æ¥è‡ªå®šä¹‰ URI çš„ç¼–ç æ–¹å¼. æˆ–è€…ï¼Œ æ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ª java.net.URI , å¹¶ä¸”ä½¿ç”¨ RestTemplate ä¸­æ¥å— URI å‚æ•°çš„æ–¹æ³•ä¹‹ä¸€. æœ‰å…³ä½¿ç”¨å’Œç¼–ç  URI çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œ è¯·å‚é˜… <a href="https://sca.aliyun.com/learn/spring/web-servlet/rest-clients/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-uri-building">URI Links</a>.</p><h5 id="Headers"><a href="#Headers" class="headerlink" title="Headers"></a>Headers</h5><p>ä½ å¯ä»¥ä½¿ç”¨ exchange() æ–¹æ³•æŒ‡å®šç‰¹æ®Šçš„è¯·æ±‚å¤´, å¦‚ä¸‹:</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-type">String</span> uriTemplate = <span class="hljs-string">&quot;https://example.com/hotels/&#123;hotel&#125;&quot;</span>;URI uri = UriComponentsBuilder.<span class="hljs-built_in">fromUriString</span>(uriTemplate).<span class="hljs-built_in">build</span>(<span class="hljs-number">42</span>);<br>RequestEntity&lt;Void&gt; requestEntity = RequestEntity.<span class="hljs-built_in">get</span>(uri).<span class="hljs-built_in">header</span>(<span class="hljs-string">&quot;MyRequestHeader&quot;</span>, <span class="hljs-string">&quot;MyValue&quot;</span>).<span class="hljs-built_in">build</span>();<br>ResponseEntity&lt;<span class="hljs-type">String</span>&gt; response = <span class="hljs-keyword">template</span>.<span class="hljs-built_in">exchange</span>(requestEntity, <span class="hljs-type">String</span>.<span class="hljs-keyword">class</span>);<br><span class="hljs-type">String</span> responseHeader = response.<span class="hljs-built_in">getHeaders</span>().<span class="hljs-built_in">getFirst</span>(<span class="hljs-string">&quot;MyResponseHeader&quot;</span>);<span class="hljs-type">String</span> body = response.<span class="hljs-built_in">getBody</span>();<br></code></pre></td></tr></table></figure><p>æ‚¨å¯ä»¥é€šè¿‡è®¸å¤šè¿”å› ResponseEntity çš„ RestTemplate æ–¹æ³•æ¥è·å–å“åº”å¤´.</p><h4 id="1-2-2-Body"><a href="#1-2-2-Body" class="headerlink" title="1.2.2. Body"></a>1.2.2. Body</h4><p>åœ¨ HttpMessageConverter çš„å¸®åŠ©ä¸‹ï¼Œ ä¼ é€’åˆ° RestTemplate æ–¹æ³•å’Œä» RestTemplate æ–¹æ³•è¿”å›çš„å¯¹è±¡ä¸åŸå§‹å†…å®¹è¿›è¡Œè½¬æ¢. åœ¨ POST è¯·æ±‚ä¸­ï¼Œ è¾“å…¥å¯¹è±¡è¢«åºåˆ—åŒ–åˆ°è¯·æ±‚ä¸»ä½“ï¼Œ å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º: URI location &#x3D; template.postForLocation(â€œ<a href="https://example.com/people%E2%80%9D">https://example.com/peopleâ€</a>, person); æ‚¨æ— éœ€æ˜¾å¼è®¾ç½®è¯·æ±‚çš„ Content-Type å¤´. åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œ æ‚¨å¯ä»¥æ‰¾åˆ°åŸºäºæºå¯¹è±¡ç±»å‹çš„å…¼å®¹æ¶ˆæ¯è½¬æ¢å™¨ï¼Œ å¹¶ä¸”æ‰€é€‰æ¶ˆæ¯è½¬æ¢å™¨ä¼šç›¸åº”åœ°è®¾ç½®å†…å®¹ç±»å‹. å¦‚æœ‰å¿…è¦ï¼Œ å¯ä»¥ä½¿ç”¨ exchange æ–¹æ³•æ˜¾å¼æä¾› Content-Type è¯·æ±‚å¤´ï¼Œ ä»è€Œå½±å“é€‰æ‹©å“ªç§æ¶ˆæ¯è½¬æ¢å™¨. åœ¨ GET ä¸Šï¼Œ å“åº”ä¸»ä½“ååºåˆ—åŒ–ä¸ºè¾“å‡º Objectï¼Œ å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º: Person person &#x3D; restTemplate.getForObject(â€œ<a href="https://example.com/people/%7Bid%7D%E2%80%9D">https://example.com/people/{id}â€</a>, Person.class, 42); ä¸éœ€è¦æ˜¾å¼è®¾ç½®è¯·æ±‚çš„ Accept å¤´. åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œ å¯ä»¥æ ¹æ®é¢„æœŸçš„å“åº”ç±»å‹æ‰¾åˆ°å…¼å®¹çš„æ¶ˆæ¯è½¬æ¢å™¨ï¼Œ è¿™æœ‰åŠ©äºå¡«å…… Accept å¤´. å¦‚æœ‰å¿…è¦ï¼Œ å¯ä»¥ä½¿ç”¨ exchange æ–¹æ³•æ˜¾å¼æä¾› Accept å¤´. é»˜è®¤æƒ…å†µä¸‹ï¼Œ RestTemplate æ³¨å†Œæ‰€æœ‰å†…ç½® <a href="https://sca.aliyun.com/learn/spring/web-servlet/rest-clients/?spm=0.29160081.0.0.51f92e5dCHrGI4#rest-message-conversion">æ¶ˆæ¯è½¬æ¢</a>ï¼Œ è¿™å–å†³äºç±»è·¯å¾„æ£€æŸ¥ï¼Œ è¿™äº›æ£€æŸ¥æœ‰åŠ©äºç¡®å®šå­˜åœ¨å“ªäº›å¯é€‰è½¬æ¢åº“. æ‚¨è¿˜å¯ä»¥å°†æ¶ˆæ¯è½¬æ¢å™¨è®¾ç½®ä¸ºæ˜¾å¼ä½¿ç”¨.</p><h4 id="1-2-3-æ¶ˆæ¯è½¬æ¢"><a href="#1-2-3-æ¶ˆæ¯è½¬æ¢" class="headerlink" title="1.2.3. æ¶ˆæ¯è½¬æ¢"></a>1.2.3. æ¶ˆæ¯è½¬æ¢</h4><p>WebFlux spring-web æ¨¡å—åŒ…å« HttpMessageConverter ï¼Œ ç”¨äºé€šè¿‡ InputStream å’Œ OutputStream è¯»å–å’Œå†™å…¥ HTTP è¯·æ±‚å’Œå“åº”æ­£æ–‡. åœ¨å®¢æˆ·ç«¯ (ä¾‹å¦‚ï¼Œ åœ¨ RestTemplate ä¸­) å’ŒæœåŠ¡å™¨ç«¯ (ä¾‹å¦‚ï¼Œ åœ¨ Spring MVC REST æ§åˆ¶å™¨ä¸­) ä½¿ç”¨ HttpMessageConverter å®ä¾‹. æ¡†æ¶ä¸­æä¾›äº†ä¸»è¦çš„åª’ä½“ (MIME) ç±»å‹çš„å…·ä½“å®ç°ï¼Œ é»˜è®¤æƒ…å†µä¸‹ï¼Œ è¿™äº›å®ç°åœ¨å®¢æˆ·ç«¯çš„ RestTemplate å’ŒæœåŠ¡å™¨çš„ RequestMappingHandlerAdapter è¿›è¡Œäº†æ³¨å†Œ (è¯·å‚é˜… <a href="https://sca.aliyun.com/learn/spring/web-servlet/rest-clients/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-config-message-converters">é…ç½®æ¶ˆæ¯è½¬æ¢å™¨</a>) . ä»¥ä¸‹å„èŠ‚ä»‹ç»äº† HttpMessageConverter çš„å®ç°. å¯¹äºæ‰€æœ‰è½¬æ¢å™¨ï¼Œ éƒ½ä½¿ç”¨é»˜è®¤çš„åª’ä½“ç±»å‹ï¼Œ ä½†æ˜¯æ‚¨å¯ä»¥é€šè¿‡è®¾ç½® supportedMediaTypes bean å±æ€§æ¥è¦†ç›–å®ƒ. ä¸‹è¡¨æè¿°äº†æ¯ç§å®ç°:</p><table><thead><tr><th>MessageConverter</th><th>Description</th></tr></thead><tbody><tr><td>StringHttpMessageConverter</td><td>ä¸€ä¸ª HttpMessageConverter å®ç°,å¯ä»¥ä» HTTP è¯·æ±‚å’Œå“åº”ä¸­è¯»å–å’Œå†™å…¥ String å®ä¾‹. é»˜è®¤æƒ…å†µä¸‹,æ­¤è½¬æ¢å™¨æ”¯æŒæ‰€æœ‰æ–‡æœ¬åª’ä½“ç±»å‹ (text&#x2F;*) ,å¹¶ä½¿ç”¨ Content-Type ä¸º text&#x2F;plain è¿›è¡Œå†™å…¥.</td></tr><tr><td>FormHttpMessageConverter</td><td>ä¸€ä¸ª HttpMessageConverter å®ç°,å¯ä»¥ä» HTTP è¯·æ±‚å’Œå“åº”ä¸­è¯»å–å’Œå†™å…¥è¡¨å•æ•°æ®. é»˜è®¤æƒ…å†µä¸‹,æ­¤è½¬æ¢å™¨è¯»å–å’Œå†™å…¥ application&#x2F;x-www-form-urlencoded åª’ä½“ç±»å‹. è¡¨å•æ•°æ®ä» MultiValueMap&lt;String, String&gt; è¯»å–å¹¶å†™å…¥. è½¬æ¢å™¨è¿˜å¯ä»¥å°† MultiValueMap&lt;String, String&gt; å†™å…¥ (ä½†ä¸èƒ½è¯») multipart æ•°æ®, ä» â€œMultiValueMap&lt;String,Object&gt;â€ è¯»å–çš„æ•°æ®. é»˜è®¤æƒ…å†µä¸‹, multipart&#x2F;form-data æ˜¯æ”¯æŒçš„. ä» Spring Framework 5.2 å¼€å§‹,å¯ä»¥æ”¯æŒå…¶ä»–çš„å¤šéƒ¨åˆ†å­ç±»å‹. ç¼–å†™è¡¨æ ¼æ•°æ®. æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯,è¯·æŸ¥é˜… Javadoc ä¸­çš„ FormHttpMessageConverter.</td></tr><tr><td>ByteArrayHttpMessageConverter</td><td>ä¸€ä¸ª HttpMessageConverter å®ç°,å¯ä»¥ä» HTTP è¯·æ±‚å’Œå“åº”ä¸­è¯»å–å’Œå†™å…¥å­—èŠ‚æ•°ç»„. é»˜è®¤æƒ…å†µä¸‹,æ­¤è½¬æ¢å™¨æ”¯æŒæ‰€æœ‰åª’ä½“ç±»å‹ (<strong>&#x2F;</strong>) ,å¹¶ä½¿ç”¨ Content-Type ä¸º application&#x2F;octet-stream è¿›è¡Œå†™å…¥. æ‚¨å¯ä»¥é€šè¿‡è®¾ç½® supportedMediaTypes å±æ€§å¹¶è¦†ç›– getContentType(byte[]) æ¥è¦†ç›–å®ƒ.</td></tr><tr><td>MarshallingHttpMessageConverter</td><td>ä¸€ä¸ª HttpMessageConverter å®ç°,å¯ä»¥ä½¿ç”¨ org.springframework.oxm åŒ…ä¸­çš„ Spring çš„ Marshaller å’Œ Unmarshaller æŠ½è±¡æ¥è¯»å†™ XML. è¯¥è½¬æ¢å™¨éœ€è¦ Marshaller å’Œ Unmarshaller æ‰èƒ½ä½¿ç”¨. æ‚¨å¯ä»¥é€šè¿‡æ„é€ å‡½æ•°æˆ– bean å±æ€§æ³¨å…¥è¿™äº›. é»˜è®¤æƒ…å†µä¸‹,æ­¤è½¬æ¢å™¨æ”¯æŒ text&#x2F;xml å’Œ application&#x2F;xml.</td></tr><tr><td>MappingJackson2HttpMessageConverter</td><td>ä¸€ä¸ª HttpMessageConverter å®ç°,å¯ä»¥ä½¿ç”¨ Jackson çš„ ObjectMapper è¯»å†™JSON. æ‚¨å¯ä»¥æ ¹æ®éœ€è¦é€šè¿‡ä½¿ç”¨ Jackson æä¾›çš„æ³¨è§£æ¥è‡ªå®šä¹‰ JSON æ˜ å°„. å½“æ‚¨éœ€è¦è¿›ä¸€æ­¥æ§åˆ¶æ—¶ (å¯¹äºéœ€è¦ä¸ºç‰¹å®šç±»å‹æä¾›è‡ªå®šä¹‰ JSON åºåˆ—åŒ–å™¨&#x2F;ååºåˆ—åŒ–å™¨çš„æƒ…å†µ) ,æ‚¨å¯ä»¥é€šè¿‡ ObjectMapper å±æ€§æ³¨å…¥è‡ªå®šä¹‰ ObjectMapper. é»˜è®¤æƒ…å†µä¸‹,æ­¤è½¬æ¢å™¨æ”¯æŒ application&#x2F;json.</td></tr><tr><td>MappingJackson2XmlHttpMessageConverter</td><td>ä¸€ä¸ª HttpMessageConverter å®ç°,å¯ä»¥ä½¿ç”¨ <a href="https://github.com/FasterXML/jackson-dataformat-xml">Jackson XML</a> æ‰©å±•çš„ XmlMapper è¯»å†™XML. æ‚¨å¯ä»¥æ ¹æ®éœ€è¦é€šè¿‡ä½¿ç”¨ JAXB æˆ– Jackson æä¾›çš„æ³¨è§£æ¥è‡ªå®šä¹‰XMLæ˜ å°„. å½“æ‚¨éœ€è¦è¿›ä¸€æ­¥æ§åˆ¶æ—¶ (å¯¹äºéœ€è¦ä¸ºç‰¹å®šç±»å‹æä¾›è‡ªå®šä¹‰ XML åºåˆ—åŒ–å™¨&#x2F;ååºåˆ—åŒ–å™¨çš„æƒ…å†µ) ,æ‚¨å¯ä»¥é€šè¿‡ ObjectMapper å±æ€§æ³¨å…¥è‡ªå®šä¹‰ XmlMapper. é»˜è®¤æƒ…å†µä¸‹,æ­¤è½¬æ¢å™¨æ”¯æŒ application&#x2F;xml.</td></tr><tr><td>SourceHttpMessageConverter</td><td>ä¸€ä¸ª HttpMessageConverter å®ç°,å¯ä»¥ä» HTTP è¯·æ±‚å’Œå“åº”ä¸­è¯»å–å’Œå†™å…¥ javax.xml.transform.Source. ä»…æ”¯æŒ DOMSource,SAXSource å’Œ StreamSource. é»˜è®¤æƒ…å†µä¸‹,æ­¤è½¬æ¢å™¨æ”¯æŒ text&#x2F;xml å’Œ application&#x2F;xml.</td></tr><tr><td>BufferedImageHttpMessageConverter</td><td>ä¸€ä¸ª HttpMessageConverter å®ç°,å¯ä»¥ä» HTTP è¯·æ±‚å’Œå“åº”ä¸­è¯»å–å’Œå†™å…¥ java.awt.image.BufferedImage. æ­¤è½¬æ¢å™¨è¯»å–å’Œå†™å…¥ Java I&#x2F;O API æ”¯æŒçš„åª’ä½“ç±»å‹.</td></tr></tbody></table><h4 id="1-2-4-Jackson-JSON-Views"><a href="#1-2-4-Jackson-JSON-Views" class="headerlink" title="1.2.4. Jackson JSON Views"></a>1.2.4. Jackson JSON Views</h4><p>æ‚¨å¯ä»¥æŒ‡å®š <a href="https://www.baeldung.com/jackson-json-view-annotation">Jackson JSON View</a> æ¥åºåˆ—åŒ–å¯¹è±¡å±æ€§çš„ä¸€éƒ¨åˆ†ï¼Œ å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs arduino">MappingJacksonValue value = <span class="hljs-keyword">new</span> <span class="hljs-built_in">MappingJacksonValue</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">User</span>(<span class="hljs-string">&quot;eric&quot;</span>, <span class="hljs-string">&quot;7!jd#h23&quot;</span>));value.<span class="hljs-built_in">setSerializationView</span>(User.WithoutPasswordView.<span class="hljs-keyword">class</span>);<br>RequestEntity&lt;MappingJacksonValue&gt; requestEntity =RequestEntity.<span class="hljs-built_in">post</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">URI</span>(<span class="hljs-string">&quot;https://example.com/user&quot;</span>)).<span class="hljs-built_in">body</span>(value);<br>ResponseEntity&lt;<span class="hljs-type">String</span>&gt; response = <span class="hljs-keyword">template</span>.<span class="hljs-built_in">exchange</span>(requestEntity, <span class="hljs-type">String</span>.<span class="hljs-keyword">class</span>);<br></code></pre></td></tr></table></figure><h4 id="1-2-5-Multipart"><a href="#1-2-5-Multipart" class="headerlink" title="1.2.5. Multipart"></a>1.2.5. Multipart</h4><p>è¦å‘é€ multipart dataï¼Œ æ‚¨éœ€è¦æä¾›ä¸€ä¸ª MultiValueMap&lt;String, Object&gt;ï¼Œ å…¶å€¼å¯èƒ½æ˜¯ä¸€ä¸ª Object çš„éƒ¨åˆ†å†…å®¹ï¼Œ ä¸€ä¸ª Resource çš„æ–‡ä»¶éƒ¨åˆ†ï¼Œ æˆ–ä¸€ä¸ª HttpEntity çš„éƒ¨åˆ†å†…å®¹çš„å¤´. ä¾‹å¦‚:</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs haxe">MultiValueMap&lt;<span class="hljs-keyword">String</span>, Object&gt; parts = <span class="hljs-keyword">new</span> <span class="hljs-type">LinkedMultiValueMap</span>&lt;&gt;();<br>parts.add(<span class="hljs-string">&quot;fieldPart&quot;</span>, <span class="hljs-string">&quot;fieldValue&quot;</span>);parts.add(<span class="hljs-string">&quot;filePart&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-type">FileSystemResource</span>(<span class="hljs-string">&quot;...logo.png&quot;</span>));parts.add(<span class="hljs-string">&quot;jsonPart&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-type">Person</span>(<span class="hljs-string">&quot;Jason&quot;</span>));<br>HttpHeaders headers = <span class="hljs-keyword">new</span> <span class="hljs-type">HttpHeaders</span>();headers.setContentType(MediaType.APPLICATION_XML);parts.add(<span class="hljs-string">&quot;xmlPart&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-type">HttpEntity</span>&lt;&gt;(myBean, headers));<br></code></pre></td></tr></table></figure><p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œ æ‚¨ä¸å¿…ä¸ºæ¯ä¸ªéƒ¨åˆ†æŒ‡å®š Content-Type å¤´. å†…å®¹ç±»å‹æ˜¯æ ¹æ®é€‰æ‹©ç”¨äºåºåˆ—åŒ–çš„ HttpMessageConverter è‡ªåŠ¨ç¡®å®šçš„ï¼Œ æˆ–è€…å¯¹äºåŸºäºæ–‡ä»¶æ‰©å±•åçš„ Resource æ˜¯è‡ªåŠ¨ç¡®å®šçš„. å¦‚æœ‰å¿…è¦ï¼Œ å¯ä»¥ä¸º MediaType æ˜¾å¼æä¾› HttpEntity åŒ…è£…å™¨.</p><p>ä¸€æ—¦ MultiValueMap å‡†å¤‡å°±ç»ªï¼Œ æ‚¨å¯ä»¥å°†å…¶ä¼ é€’ç»™ RestTemplateï¼Œ å¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs arduino">MultiValueMap&lt;<span class="hljs-type">String</span>, Object&gt; parts = ...;<br><br><span class="hljs-keyword">template</span>.<span class="hljs-built_in">postForObject</span>(<span class="hljs-string">&quot;https://example.com/upload&quot;</span>, parts, Void.<span class="hljs-keyword">class</span>);<br></code></pre></td></tr></table></figure><p>å¦‚æœ MultiValueMap åŒ…å«è‡³å°‘ä¸€ä¸ªé String å€¼ï¼Œ åˆ™ FormHttpMessageConverter å°† Content-Type è®¾ç½®ä¸º multipart&#x2F;form-data. å¦‚æœ MultiValueMap å…·æœ‰å­—ç¬¦ä¸²å€¼ï¼Œ åˆ™ Content-Type é»˜è®¤ä¸º application&#x2F;x-www-form-urlencoded. å¦‚æœ‰å¿…è¦ï¼Œ è¿˜å¯ä»¥æ˜¾å¼è®¾ç½® Content-Type.</p><h3 id="1-3-HTTP-Interface"><a href="#1-3-HTTP-Interface" class="headerlink" title="1.3. HTTP Interface"></a>1.3. HTTP Interface</h3><p>Spring æ¡†æ¶å…è®¸æ‚¨å°† HTTP æœåŠ¡å®šä¹‰ä¸ºå¸¦æœ‰ç”¨äº HTTP exchanges çš„æ³¨è§£æ–¹æ³•çš„ Java æ¥å£ã€‚ ç„¶åï¼Œæ‚¨å¯ä»¥ç”Ÿæˆä¸€ä¸ªå®ç°æ­¤æ¥å£å¹¶æ‰§è¡Œäº¤æ¢çš„ä»£ç†ã€‚ è¿™æœ‰åŠ©äºç®€åŒ– HTTP è¿œç¨‹è®¿é—®ï¼Œè¿™é€šå¸¸æ¶‰åŠåŒ…è£…ä½¿ç”¨åº•å±‚ HTTP å®¢æˆ·ç«¯çš„ç»†èŠ‚çš„å¤–è§‚ã€‚ é¦–å…ˆï¼Œç”¨ @HttpExchange æ–¹æ³•å£°æ˜ä¸€ä¸ªæ¥å£ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">interface</span> <span class="hljs-selector-tag">RepositoryService</span> &#123;<br>    <span class="hljs-variable">@GetExchange</span>(<span class="hljs-string">&quot;/repos/&#123;owner&#125;/&#123;repo&#125;&quot;</span>)    Repository <span class="hljs-built_in">getRepository</span>(<span class="hljs-variable">@PathVariable</span> String owner, <span class="hljs-variable">@PathVariable</span> String repo);<br>    <span class="hljs-comment">// more HTTP exchange methods...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ç¬¬äºŒï¼Œåˆ›å»ºä¸€ä¸ªå°†æ‰§è¡Œå£°æ˜çš„ HTTP äº¤æ¢çš„ä»£ç†ï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf">WebClient client <span class="hljs-operator">=</span> WebClient.builder().baseUrl(<span class="hljs-string">&quot;https://api.github.com/&quot;</span>).build()<span class="hljs-comment">;HttpServiceProxyFactory factory = HttpServiceProxyFactory.builder(WebClientAdapter.forClient(client)).build();</span><br>RepositoryService service <span class="hljs-operator">=</span> factory.createClient(RepositoryService.class)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>@HttpExchange æ”¯æŒåœ¨æ‰€æœ‰çš„æ–¹æ³•ä¸Šè¿›è¡Œæ³¨è§£ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@HttpExchange</span>(url = <span class="hljs-string">&quot;/repos/&#123;owner&#125;/&#123;repo&#125;&quot;</span>, accept = <span class="hljs-string">&quot;application/vnd.github.v3+json&quot;</span>)interface RepositoryService &#123;<br>    <span class="hljs-variable">@GetExchange</span>    Repository <span class="hljs-built_in">getRepository</span>(<span class="hljs-variable">@PathVariable</span> String owner, <span class="hljs-variable">@PathVariable</span> String repo);<br>    <span class="hljs-variable">@PatchExchange</span>(contentType = MediaType.APPLICATION_FORM_URLENCODED_VALUE)    void <span class="hljs-built_in">updateRepository</span>(<span class="hljs-variable">@PathVariable</span> String owner, <span class="hljs-variable">@PathVariable</span> String repo,                          <span class="hljs-variable">@RequestParam</span> String name, <span class="hljs-variable">@RequestParam</span> String description, <span class="hljs-variable">@RequestParam</span> String homepage);<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="1-3-1-æ–¹æ³•å‚æ•°"><a href="#1-3-1-æ–¹æ³•å‚æ•°" class="headerlink" title="1.3.1. æ–¹æ³•å‚æ•°"></a>1.3.1. æ–¹æ³•å‚æ•°</h4><p>å¸¦æ³¨è§£çš„ HTTP äº¤æ¢æ–¹æ³•æ”¯æŒå…·æœ‰ä»¥ä¸‹æ–¹æ³•å‚æ•°ï¼š</p><table><thead><tr><th>æ–¹æ³•å‚æ•°</th><th>æè¿°</th></tr></thead><tbody><tr><td>URI</td><td>åŠ¨æ€è®¾ç½®è¯·æ±‚çš„ URLï¼Œè¦†ç›–æ³¨è§£çš„ url å±æ€§ã€‚</td></tr><tr><td>HttpMethod</td><td>åŠ¨æ€è®¾ç½®è¯·æ±‚çš„ HTTP æ–¹æ³•ï¼Œè¦†ç›–æ³¨è§£çš„ method å±æ€§</td></tr><tr><td>@RequestHeader</td><td>æ·»åŠ è¯·æ±‚å¤´æˆ–å¤šä¸ªè¯·æ±‚å¤´ã€‚å‚æ•°å¯ä»¥æ˜¯ Map&lt;String, ?&gt; æˆ– MultiValueMap&lt;String, ?&gt; ï¼ˆå¤šä¸ªè¯·æ±‚å¤´ï¼‰ã€ Collection&lt;?&gt; æˆ–å•ä¸ªå€¼ã€‚ éå­—ç¬¦ä¸²å€¼æ”¯æŒç±»å‹è½¬æ¢ã€‚</td></tr><tr><td>@PathVariable</td><td>æ·»åŠ ä¸€ä¸ªå˜é‡ä»¥æ‰©å±•è¯·æ±‚ URL ä¸­çš„å ä½ç¬¦ã€‚ å‚æ•°å¯ä»¥æ˜¯å…·æœ‰å¤šä¸ªå˜é‡æˆ–å•ä¸ªå€¼çš„ Map&lt;String, ?&gt;ã€‚ éå­—ç¬¦ä¸²å€¼æ”¯æŒç±»å‹è½¬æ¢ã€‚</td></tr><tr><td>@RequestBody</td><td>å°†è¯·æ±‚çš„ä¸»ä½“ä½œä¸ºè¦åºåˆ—åŒ–çš„å¯¹è±¡æä¾›ï¼Œæˆ–è€… Reactive Streams Publisher æä¾›ï¼Œä¾‹å¦‚ Monoã€Flux æˆ–é€šè¿‡é…ç½®çš„ ReactiveAdapterRegistry æ”¯æŒçš„ä»»ä½•å…¶ä»–å¼‚æ­¥ç±»å‹ã€‚</td></tr><tr><td>@RequestParam</td><td>æ·»åŠ è¯·æ±‚å‚æ•°æˆ–å¤šä¸ªå‚æ•°ã€‚ å‚æ•°å¯ä»¥æ˜¯å…·æœ‰å¤šä¸ªå‚æ•°çš„ Map&lt;String, ?&gt; or MultiValueMap&lt;String, ?&gt; ã€Collection&lt;?&gt; æˆ–å•ä¸ªå€¼ã€‚ éå­—ç¬¦ä¸²å€¼æ”¯æŒç±»å‹è½¬æ¢ã€‚ å½“ â€œcontent-typeâ€ è®¾ç½®ä¸º â€œapplication&#x2F;x-www-form-urlencodedâ€ æ—¶ï¼Œè¯·æ±‚å‚æ•°åœ¨è¯·æ±‚ä½“ä¸­è¿›è¡Œç¼–ç ã€‚ å¦åˆ™ï¼Œå®ƒä»¬å°†ä½œä¸º URL æŸ¥è¯¢å‚æ•°æ·»åŠ ã€‚</td></tr><tr><td>@RequestPart</td><td>æ·»åŠ è¯·æ±‚éƒ¨åˆ†ï¼Œå¯ä»¥æ˜¯ Stringï¼ˆè¡¨å•å­—æ®µï¼‰ã€Resourceï¼ˆæ–‡ä»¶éƒ¨åˆ†ï¼‰ã€Objectï¼ˆè¦ç¼–ç çš„å®ä½“ï¼Œä¾‹å¦‚ JSONï¼‰ã€HttpEntityï¼ˆéƒ¨åˆ†å†…å®¹å’Œæ ‡å¤´ï¼‰ã€Spring Part æˆ– Reactive Streams Publisher ä»¥ä¸Šä»»ä½•ä¸€é¡¹ã€‚</td></tr><tr><td>@CookieValue</td><td>æ·»åŠ ä¸€ä¸ª cookie æˆ–å¤šä¸ª cookieã€‚ å‚æ•°å¯ä»¥æ˜¯å…·æœ‰å¤šä¸ª cookie çš„ Map&lt;String, ?&gt; æˆ– MultiValueMap&lt;String, ?&gt;ã€Collection&lt;?&gt; æˆ–å•ä¸ªå€¼ã€‚ éå­—ç¬¦ä¸²å€¼æ”¯æŒç±»å‹è½¬æ¢ã€‚</td></tr></tbody></table><h4 id="1-3-2-è¿”å›å€¼"><a href="#1-3-2-è¿”å›å€¼" class="headerlink" title="1.3.2. è¿”å›å€¼"></a>1.3.2. è¿”å›å€¼</h4><p>å¸¦æ³¨è§£çš„ HTTP äº¤æ¢æ–¹æ³•æ”¯æŒä»¥ä¸‹è¿”å›å€¼ï¼š:</p><table><thead><tr><th>æ–¹æ³•è¿”å›å€¼</th><th>æè¿°</th></tr></thead><tbody><tr><td>void, Mono</td><td>æ‰§è¡Œè¯·æ±‚ï¼Œä¸è¿”å›ä»»ä½•å†…å®¹</td></tr><tr><td>HttpHeaders, Mono</td><td>æ‰§è¡Œè¯·æ±‚ï¼Œè¿”å›å“åº”å¤´ï¼ˆå¦‚æœå­˜åœ¨ï¼‰</td></tr><tr><td>, Mono</td><td>æ‰§è¡Œè¯·æ±‚ï¼Œå°†å“åº”å†…å®¹è§£ç ä¸ºæŒ‡å®šç±»å‹çš„æµ</td></tr><tr><td>, Flux</td><td>æ‰§è¡Œè¯·æ±‚ï¼Œå°†å“åº”å†…å®¹è§£ç ä¸ºæŒ‡å®šç±»å‹çš„æµ</td></tr><tr><td>ResponseEntity, Mono<ResponseEntity></td><td>æ‰§è¡Œè¯·æ±‚ï¼Œå¹¶è¿”å›å…·æœ‰ status å’Œ headers çš„ ResponseEntityã€‚</td></tr><tr><td>ResponseEntity, Mono<ResponseEntity></td><td>æ‰§è¡Œè¯·æ±‚ï¼Œå°†å“åº”å†…å®¹è§£ç ä¸ºå£°æ˜çš„è¿”å›ç±»å‹ï¼Œå¹¶è¿”å›å…·æœ‰ status, headers å’Œè§£ç æ­£æ–‡çš„ ResponseEntityã€‚</td></tr><tr><td>Mono&lt;ResponseEntity<Flux></td><td>æ‰§è¡Œè¯·æ±‚ï¼Œå°†å“åº”å†…å®¹è§£ç ä¸ºå£°æ˜å…ƒç´ ç±»å‹çš„æµï¼Œå¹¶è¿”å›å…·æœ‰ status, headers å’Œè§£ç çš„å“åº”æ­£æ–‡æµçš„ ResponseEntityã€‚</td></tr></tbody></table><blockquote><p>æ‚¨è¿˜å¯ä»¥ä½¿ç”¨åœ¨ ReactiveAdapterRegistry ä¸­æ³¨å†Œçš„ä»»ä½•å…¶ä»–å¼‚æ­¥æˆ–ååº”ç±»å‹ã€‚</p></blockquote><h4 id="1-3-3-å¼‚å¸¸å¤„ç†"><a href="#1-3-3-å¼‚å¸¸å¤„ç†" class="headerlink" title="1.3.3. å¼‚å¸¸å¤„ç†"></a>1.3.3. å¼‚å¸¸å¤„ç†</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒWebClient ä¸º 4xx å’Œ 5xx HTTP çŠ¶æ€ä»£ç å¼•å‘ WebClientResponseExceptionã€‚ è¦å¯¹æ­¤è¿›è¡Œè‡ªå®šä¹‰ï¼Œæ‚¨å¯ä»¥æ³¨å†Œä¸€ä¸ªå“åº”çŠ¶æ€å¤„ç†ç¨‹åºï¼Œè¯¥å¤„ç†ç¨‹åºé€‚ç”¨äºé€šè¿‡å®¢æˆ·ç«¯æ‰§è¡Œçš„æ‰€æœ‰å“åº”ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">WebClient</span> <span class="hljs-variable">webClient</span> <span class="hljs-operator">=</span> WebClient.builder().defaultStatusHandler(HttpStatusCode::isError, resp -&gt; ...).build();<br><span class="hljs-type">WebClientAdapter</span> <span class="hljs-variable">clientAdapter</span> <span class="hljs-operator">=</span> WebClientAdapter.forClient(webClient);<span class="hljs-type">HttpServiceProxyFactory</span> <span class="hljs-variable">factory</span> <span class="hljs-operator">=</span> HttpServiceProxyFactory.builder(clientAdapter).build();<br></code></pre></td></tr></table></figure><p>æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯å’Œé€‰é¡¹ï¼Œä¾‹å¦‚ suppressing é”™è¯¯çŠ¶æ€ä»£ç ï¼Œè¯·å‚é˜… WebClient.Builder ä¸­ defaultStatusHandler çš„ Javadocã€‚</p><blockquote><p>Rod Johnson, Juergen Hoeller, Keith Donald, Colin Sampaleanu, Rob Harrop, Thomas Risberg, Alef Arendsen, Darren Davison, Dmitriy Kopylenko, Mark Pollack, Thierry Templier, Erwin Vervaet, Portia Tung, Ben Hale, Adrian Colyer, John Lewis, Costin Leau, Mark Fisher, Sam Brannen, Ramnivas Laddad, Arjen Poutsma, Chris Beams, Tareq Abedrabbo, Andy Clement, Dave Syer, Oliver Gierke, Rossen Stoyanchev, Phillip Webb, Rob Winch, Brian Clozel, Stephane Nicoll, Sebastien Deleuze, Jay Bryant, Mark Paluch</p></blockquote><blockquote><p>Copyright Â© 2002 - 2024 VMware, Inc. All Rights Reserved.</p></blockquote><blockquote><p>Copies of this document may be made for your own use and for distribution to others, provided that you do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically.</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>Spring æ•™ç¨‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Spring</tag>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Resources èµ„æº</title>
    <link href="/post/f5196226-0df7-4ea9-b4c1-bd505131031f/"/>
    <url>/post/f5196226-0df7-4ea9-b4c1-bd505131031f/</url>
    
    <content type="html"><![CDATA[<h1 id="Resources-èµ„æº"><a href="#Resources-èµ„æº" class="headerlink" title="Resources èµ„æº"></a>Resources èµ„æº</h1><p>Spring æ•™ç¨‹</p><hr><h2 id="4-èµ„æº"><a href="#4-èµ„æº" class="headerlink" title="4. èµ„æº"></a>4. èµ„æº</h2><p>æœ¬ç« ä»‹ç»Springå¦‚ä½•å¤„ç†èµ„æºä»¥åŠå¦‚ä½•åœ¨Springä¸­ä½¿ç”¨èµ„æºã€‚ å®ƒåŒ…æ‹¬ä»¥ä¸‹ä¸»é¢˜:</p><ul><li><a href="https://sca.aliyun.com/learn/spring/core/resources/?spm=0.29160081.0.0.51f92e5dCHrGI4#resources-introduction">ç®€ä»‹</a></li><li><a href="https://sca.aliyun.com/learn/spring/core/resources/?spm=0.29160081.0.0.51f92e5dCHrGI4#resources-resource">èµ„æºæ¥å£</a></li><li><a href="https://sca.aliyun.com/learn/spring/core/resources/?spm=0.29160081.0.0.51f92e5dCHrGI4#resources-implementations">å†…ç½®èµ„æºå®ç°</a></li><li><a href="https://sca.aliyun.com/learn/spring/core/resources/?spm=0.29160081.0.0.51f92e5dCHrGI4#resources-resourceloader"><code>ResourceLoader</code></a></li><li><a href="https://sca.aliyun.com/learn/spring/core/resources/?spm=0.29160081.0.0.51f92e5dCHrGI4#resources-resourceloaderaware"><code>ResourceLoaderAware</code> æ¥å£</a></li><li><a href="https://sca.aliyun.com/learn/spring/core/resources/?spm=0.29160081.0.0.51f92e5dCHrGI4#resources-as-dependencies">èµ„æºä¾èµ–</a></li><li><a href="https://sca.aliyun.com/learn/spring/core/resources/?spm=0.29160081.0.0.51f92e5dCHrGI4#resources-app-ctx">åº”ç”¨ä¸Šä¸‹æ–‡å’Œèµ„æºè·¯å¾„</a></li></ul><h3 id="4-1-ç®€ä»‹"><a href="#4-1-ç®€ä»‹" class="headerlink" title="4.1. ç®€ä»‹"></a>4.1. ç®€ä»‹</h3><p>é—æ†¾çš„æ˜¯ï¼ŒJavaçš„æ ‡å‡†<code>java.net.URL</code>ç±»å’Œå„ç§ <code>URL</code>å‰ç¼€çš„æ ‡å‡†å¤„ç†ç¨‹åºä¸è¶³ä»¥å®Œå…¨è®¿é—®åº•å±‚èµ„æºã€‚ä¾‹å¦‚ï¼Œæ²¡æœ‰æ ‡å‡†åŒ–çš„ <code>URL</code>å®ç°å¯ç”¨äºè®¿é—®éœ€è¦ä»ç±»è·¯å¾„æˆ–ç›¸å¯¹äº <code>ServletContext</code>è·å–çš„èµ„æºã€‚ è™½ç„¶å¯ä»¥ä¸ºä¸“ç”¨ <code>URL</code>å‰ç¼€æ³¨å†Œæ–°çš„å¤„ç†ç¨‹åºï¼ˆç±»ä¼¼äº<code>http:</code> :)è¿™æ ·çš„å‰ç¼€çš„ç°æœ‰å¤„ç†ç¨‹åºï¼Œä½†è¿™é€šå¸¸éå¸¸å¤æ‚ï¼Œå¹¶ä¸”<code>URL</code>æ¥å£ä»ç„¶ç¼ºå°‘ä¸€äº›ç†æƒ³çš„åŠŸèƒ½ï¼Œä¾‹å¦‚æ£€æŸ¥å½“å‰èµ„æºæ˜¯å¦å­˜åœ¨çš„æ–¹æ³•ã€‚</p><h3 id="4-2-èµ„æºæ¥å£"><a href="#4-2-èµ„æºæ¥å£" class="headerlink" title="4.2. èµ„æºæ¥å£"></a>4.2. èµ„æºæ¥å£</h3><p>Springçš„<code>Resource</code>æ¥å£çš„ç›®æ ‡æ˜¯æˆä¸ºä¸€ä¸ªæ›´å¼ºå¤§çš„æ¥å£ï¼Œç”¨äºæŠ½è±¡å¯¹åº•å±‚èµ„æºçš„è®¿é—®ã€‚ ä»¥ä¸‹æ¸…å•æ˜¾ç¤ºäº†<code>Resource</code>æ¥å£å®šä¹‰ï¼š</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Resource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">InputStreamSource</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">exists</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isOpen</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function">URL <span class="hljs-title">getURL</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>    <span class="hljs-function">File <span class="hljs-title">getFile</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>    <span class="hljs-function">Resource <span class="hljs-title">createRelative</span><span class="hljs-params">(String relativePath)</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>    <span class="hljs-function">String <span class="hljs-title">getFilename</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function">String <span class="hljs-title">getDescription</span><span class="hljs-params">()</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ­£å¦‚<code>Resource</code>æ¥å£çš„å®šä¹‰æ‰€ç¤ºï¼Œå®ƒæ‰©å±•äº†<code>InputStreamSource</code>æ¥å£ã€‚ ä»¥ä¸‹æ¸…å•æ˜¾ç¤ºäº†<code>InputStreamSource</code>æ¥å£çš„å®šä¹‰ï¼š</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">InputStreamSource</span> </span>&#123;<br>    <span class="hljs-function">InputStream <span class="hljs-title">getInputStream</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>Resource</code> æ¥å£ä¸­ä¸€äº›æœ€é‡è¦çš„æ–¹æ³•æ˜¯ï¼š</p><ul><li><code>getInputStream()</code>: ç”¨äºå®šä½å’Œæ‰“å¼€å½“å‰èµ„æº, è¿”å›å½“å‰èµ„æºçš„<code>InputStream</code> ï¼Œé¢„è®¡æ¯ä¸€æ¬¡è°ƒç”¨éƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„<code>InputStream</code>. å› æ­¤è°ƒç”¨è€…å¿…é¡»è‡ªè¡Œå…³é—­å½“å‰çš„è¾“å‡ºæµ.</li><li><code>exists()</code>: è¿”å›<code>boolean</code>å€¼ï¼Œè¡¨ç¤ºå½“å‰èµ„æºæ˜¯å¦å­˜åœ¨ã€‚</li><li><code>isOpen()</code>: è¿”å›<code>boolean</code>å€¼ï¼Œè¡¨ç¤ºå½“å‰èµ„æºæ˜¯å¦æœ‰å·²æ‰“å¼€çš„è¾“å…¥æµã€‚å¦‚æœä¸º <code>true</code>ï¼Œé‚£ä¹ˆ<code>InputStream</code>ä¸èƒ½è¢«å¤šæ¬¡è¯»å– ï¼Œåªèƒ½åœ¨ä¸€æ¬¡è¯»å–åå³å…³é—­ä»¥é˜²æ­¢å†…å­˜æ³„æ¼ã€‚é™¤äº†<code>InputStreamResource</code>å¤–ï¼Œå…¶ä»–å¸¸ç”¨Resourceå®ç°éƒ½ä¼šè¿”å›<code>false</code>ã€‚</li><li><code>getDescription()</code>: è¿”å›å½“å‰èµ„æºçš„æè¿°ï¼Œå½“å¤„ç†èµ„æºå‡ºé”™æ—¶ï¼Œèµ„æºçš„æè¿°ä¼šç”¨äºè¾“å‡ºé”™è¯¯çš„ä¿¡æ¯ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œèµ„æºçš„æè¿°æ˜¯ä¸€ä¸ªå®Œå…¨é™å®šçš„æ–‡ä»¶åç§°ï¼Œæˆ–è€…æ˜¯å½“å‰èµ„æºçš„çœŸå®URLã€‚</li></ul><p>å…¶ä»–æ–¹æ³•å…è®¸æ‚¨è·å–è¡¨ç¤ºèµ„æºçš„å®é™…<code>URL</code>æˆ–<code>File</code>å¯¹è±¡ï¼ˆå¦‚æœåº•å±‚å®ç°å…¼å®¹å¹¶æ”¯æŒè¯¥åŠŸèƒ½ï¼‰ã€‚</p><p>åœ¨Springé‡Œï¼Œ <code>Resource</code>æŠ½è±¡æœ‰ç€ç›¸å½“å¹¿æ³›çš„ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼Œå½“éœ€è¦æŸä¸ªèµ„æºæ—¶ï¼Œ <code>Resource</code>å¯ä»¥å½“ä½œæ–¹æ³•ç­¾åé‡Œçš„å‚æ•°ç±»å‹è¢«ä½¿ç”¨ã€‚åœ¨Spring APIä¸­ï¼Œæœ‰äº›æ–¹æ³•ï¼ˆä¾‹å¦‚å„ç§<code>ApplicationContext</code>å®ç°çš„æ„é€ å‡½æ•°ï¼‰ ä¼šç›´æ¥é‡‡ç”¨æ™®é€šæ ¼å¼çš„<code>String</code>è·¯å¾„æ¥åˆ›å»ºåˆé€‚çš„<code>Resource</code>ï¼Œè°ƒç”¨è€…ä¹Ÿå¯ä»¥é€šè¿‡åœ¨è·¯å¾„é‡Œå¸¦ä¸ŠæŒ‡å®šçš„å‰ç¼€æ¥åˆ›å»ºç‰¹å®šçš„<code>Resource</code>å®ç°ã€‚</p><p>ä¸ä½†Springå†…éƒ¨å’Œä½¿ç”¨Springçš„åº”ç”¨éƒ½å¤§é‡åœ°ä½¿ç”¨äº†<code>Resource</code>æ¥å£,è€Œä¸”å¼€å‘è€…åœ¨åº”ç”¨ä»£ç ä¸­å°†å®ƒä½œä¸ºä¸€ä¸ªé€šç”¨çš„å·¥å…·ç±»ä¹Ÿæ˜¯éå¸¸é€šç”¨çš„ã€‚å½“ä½ ä»…éœ€è¦ä½¿ç”¨åˆ°<code>Resource</code>æ¥å£å®ç°æ—¶ï¼Œ å¯ä»¥ç›´æ¥å¿½ç•¥Springçš„å…¶ä½™éƒ¨åˆ†.è™½ç„¶è¿™æ ·ä¼šä¸Springè€¦åˆ,ä½†æ˜¯ä¹Ÿåªæ˜¯è€¦åˆä¸€éƒ¨åˆ†è€Œå·²ã€‚ä½¿ç”¨è¿™äº›<code>Resource</code>å®ç°ä»£æ›¿åº•å±‚çš„è®¿é—®æ˜¯æå…¶ç¾å¥½çš„ã€‚è¿™ä¸å¼€å‘è€…å¼•å…¥å…¶ä»–åº“çš„ç›®çš„ä¹Ÿæ˜¯ä¸€æ ·çš„</p><p><code>Resource</code>æŠ½è±¡ä¸ä¼šå–ä»£åŠŸèƒ½ã€‚ å®ƒå°½å¯èƒ½åœ°åŒ…è£¹å®ƒã€‚ ä¾‹å¦‚ï¼Œ<code>UrlResource</code>åŒ…è£…<code>URL</code>å¹¶ä½¿ç”¨åŒ…è£…çš„URLæ¥å®Œæˆå…¶å·¥ä½œã€‚</p><h3 id="4-3-å†…ç½®çš„èµ„æºå®ç°"><a href="#4-3-å†…ç½®çš„èµ„æºå®ç°" class="headerlink" title="4.3. å†…ç½®çš„èµ„æºå®ç°"></a>4.3. å†…ç½®çš„èµ„æºå®ç°</h3><p>SpringåŒ…æ‹¬ä»¥ä¸‹<code>Resource</code>å®ç°:</p><ul><li><a href="https://sca.aliyun.com/learn/spring/core/resources/?spm=0.29160081.0.0.51f92e5dCHrGI4#resources-implementations-urlresource"><code>UrlResource</code></a></li><li><a href="https://sca.aliyun.com/learn/spring/core/resources/?spm=0.29160081.0.0.51f92e5dCHrGI4#resources-implementations-classpathresource"><code>ClassPathResource</code></a></li><li><a href="https://sca.aliyun.com/learn/spring/core/resources/?spm=0.29160081.0.0.51f92e5dCHrGI4#resources-implementations-filesystemresource"><code>FileSystemResource</code></a></li><li><a href="https://sca.aliyun.com/learn/spring/core/resources/?spm=0.29160081.0.0.51f92e5dCHrGI4#resources-implementations-servletcontextresource"><code>ServletContextResource</code></a></li><li><a href="https://sca.aliyun.com/learn/spring/core/resources/?spm=0.29160081.0.0.51f92e5dCHrGI4#resources-implementations-inputstreamresource"><code>InputStreamResource</code></a></li><li><a href="https://sca.aliyun.com/learn/spring/core/resources/?spm=0.29160081.0.0.51f92e5dCHrGI4#resources-implementations-bytearrayresource"><code>ByteArrayResource</code></a></li></ul><h4 id="4-3-1-UrlResource"><a href="#4-3-1-UrlResource" class="headerlink" title="4.3.1. UrlResource"></a>4.3.1. <code>UrlResource</code></h4><p><code>UrlResource</code> å°è£…äº†<code>java.net.URL</code>ç”¨æ¥è®¿é—®æ­£å¸¸URLçš„ä»»æ„å¯¹è±¡ã€‚ä¾‹å¦‚<code>file:</code> ï¼ŒHTTPç›®æ ‡ï¼ŒFTPç›®æ ‡ç­‰ã€‚æ‰€æœ‰çš„URLéƒ½å¯ä»¥ç”¨æ ‡å‡†åŒ–çš„å­—ç¬¦ä¸²æ¥è¡¨ç¤ºï¼Œä¾‹å¦‚é€šè¿‡æ­£ç¡®çš„æ ‡å‡†åŒ–å‰ç¼€ã€‚ å¯ä»¥ç”¨æ¥è¡¨ç¤ºå½“å‰URLçš„ç±»å‹ã€‚ è¿™åŒ…æ‹¬<code>file:</code>ï¼Œç”¨äºè®¿é—®æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ï¼Œ<code>http:</code> ï¼šç”¨äºé€šè¿‡HTTPåè®®è®¿é—®èµ„æºï¼Œ<code>ftp:</code>ï¼šç”¨äºé€šè¿‡FTPè®¿é—®èµ„æºï¼Œä»¥åŠå…¶ä»–ã€‚</p><p>é€šè¿‡javaä»£ç å¯ä»¥æ˜¾å¼åœ°ä½¿ç”¨<code>UrlResource</code>æ„é€ å‡½æ•°æ¥åˆ›å»º<code>UrlResource</code>ï¼Œä½†ä¹Ÿå¯ä»¥è°ƒç”¨APIæ–¹æ³•æ¥ä½¿ç”¨ä»£è¡¨è·¯å¾„çš„Stringå‚æ•°æ¥éšå¼åˆ›å»º<code>UrlResource</code>ã€‚ å¯¹äºåä¸€ç§æƒ…å†µï¼ŒJavaBeans <code>PropertyEditor</code>æœ€ç»ˆå†³å®šè¦åˆ›å»ºå“ªç§ç±»å‹çš„<code>Resource</code>ã€‚å¦‚æœè·¯å¾„å­—ç¬¦ä¸²åŒ…å«ä¼—æ‰€å‘¨çŸ¥çš„ï¼ˆå¯¹äºå®ƒï¼Œé‚£ä¹ˆï¼‰å‰ç¼€ï¼ˆä¾‹å¦‚ <code>classpath:</code>:)ï¼Œå®ƒä¼šä¸ºè¯¥å‰ç¼€åˆ›å»ºé€‚å½“çš„ä¸“ç”¨<code>Resource</code>ã€‚ ä½†æ˜¯ï¼Œå¦‚æœå®ƒæ— æ³•è¯†åˆ«å‰ç¼€ï¼Œåˆ™å‡å®šè¯¥å­—ç¬¦ä¸²æ˜¯æ ‡å‡†URLå­—ç¬¦ä¸²å¹¶åˆ›å»º<code>UrlResource</code>ã€‚</p><h4 id="4-3-2-ClassPathResource"><a href="#4-3-2-ClassPathResource" class="headerlink" title="4.3.2. ClassPathResource"></a>4.3.2. <code>ClassPathResource</code></h4><p>ClassPathResourceä»£è¡¨ä»ç±»è·¯å¾„ä¸­è·å–èµ„æºï¼Œå®ƒä½¿ç”¨çº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨ï¼ŒæŒ‡å®šç±»åŠ è½½å™¨æˆ–ç»™å®šclassç±»æ¥åŠ è½½èµ„æºã€‚</p><p>å½“ç±»è·¯å¾„ä¸Šèµ„æºå­˜äºæ–‡ä»¶ç³»ç»Ÿä¸­æ—¶ï¼Œ<code>ClassPathResource</code>æ”¯æŒä½¿ç”¨<code>java.io.File</code>æ¥è®¿é—®ã€‚ä½†æ˜¯å½“ç±»è·¯å¾„ä¸Šçš„èµ„æºä½äºæœªè§£å‹(æ²¡æœ‰è¢«Servletå¼•æ“æˆ–å…¶ä»–å¯è§£å‹çš„ç¯å¢ƒè§£å‹ï¼‰çš„jaråŒ…ä¸­æ—¶ï¼Œ <code>ClassPathResource</code>å°±ä¸å†æ”¯æŒä»¥<code>java.io.File</code>çš„å½¢å¼è®¿é—®ã€‚é‰´äºæ­¤ï¼ŒSpringä¸­å„ç§Resourceçš„å®ç°éƒ½æ”¯æŒä»¥<code>java.net.URL</code>çš„å½¢å¼è®¿é—®èµ„æºã€‚</p><p>å¯ä»¥æ˜¾å¼ä½¿ç”¨<code>ClassPathResource</code>æ„é€ å‡½æ•°æ¥åˆ›å»º<code>ClassPathResource</code>ï¼Œä½†æ˜¯æ›´å¤šæƒ…å†µä¸‹ï¼Œæ˜¯è°ƒç”¨APIæ–¹æ³•ä½¿ç”¨çš„ã€‚å³ä½¿ç”¨ä¸€ä¸ªä»£è¡¨è·¯å¾„çš„<code>String</code>å‚æ•°æ¥éšå¼åˆ›å»º<code>ClassPathResource</code>ã€‚ å¯¹äºåä¸€ç§æƒ…å†µï¼Œå°†ä¼šç”±JavaBeansçš„<code>PropertyEditor</code>æ¥è¯†åˆ«è·¯å¾„ä¸­<code>classpath:</code>å‰ç¼€ï¼Œå¹¶åˆ›å»º<code>ClassPathResource</code>ã€‚</p><h4 id="4-3-3-FileSystemResource"><a href="#4-3-3-FileSystemResource" class="headerlink" title="4.3.3. FileSystemResource"></a>4.3.3. <code>FileSystemResource</code></h4><p><code>FileSystemResource</code>æ˜¯ç”¨äºå¤„ç†<code>java.io.File</code>å’Œ<code>java.nio.file.Path</code>çš„å®ç°ï¼Œæ˜¾ç„¶ï¼Œå®ƒåŒæ—¶èƒ½è§£æä½œä¸º<code>File</code>å’Œä½œä¸º<code>URL</code>çš„èµ„æºã€‚</p><h4 id="4-3-4-ServletContextResource"><a href="#4-3-4-ServletContextResource" class="headerlink" title="4.3.4. ServletContextResource"></a>4.3.4. <code>ServletContextResource</code></h4><p>è¿™æ˜¯<code>ServletContext</code>èµ„æºçš„ <code>Resource</code>å®ç°ï¼Œç”¨äºè§£é‡Šç›¸å…³Webåº”ç”¨ç¨‹åºæ ¹ç›®å½•ä¸­çš„ç›¸å¯¹è·¯å¾„ã€‚</p><p>ServletContextResourceå®Œå…¨æ”¯æŒä»¥æµå’ŒURLçš„æ–¹å¼è®¿é—®èµ„æºï¼Œä½†åªæœ‰å½“Webé¡¹ç›®æ˜¯è§£å‹çš„ï¼ˆä¸æ˜¯ä»¥warç­‰å‹ç¼©åŒ…å½¢å¼å­˜åœ¨ï¼‰ï¼Œè€Œä¸”è¯¥ServletContextèµ„æºå¿…é¡»ä½äºæ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œ å®ƒæ”¯æŒä»¥<code>java.io.File</code>çš„æ–¹å¼è®¿é—®èµ„æºã€‚æ— è®ºå®ƒæ˜¯åœ¨æ–‡ä»¶ç³»ç»Ÿä¸Šæ‰©å±•è¿˜æ˜¯ç›´æ¥ä»JARæˆ–å…¶ä»–åœ°æ–¹ï¼ˆå¦‚æ•°æ®åº“ï¼‰ï¼ˆå¯ä»¥æƒ³è±¡ï¼‰è®¿é—®ï¼Œå®é™…ä¸Šéƒ½ä¾èµ–äºServletå®¹å™¨ã€‚</p><h4 id="4-3-5-InputStreamResource"><a href="#4-3-5-InputStreamResource" class="headerlink" title="4.3.5. InputStreamResource"></a>4.3.5. <code>InputStreamResource</code></h4><p><code>InputStreamResource</code>æ˜¯é’ˆå¯¹<code>InputStream</code>æä¾›çš„<code>Resource</code>å®ç°ã€‚åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¦‚æœç¡®å®æ— æ³•æ‰¾åˆ°åˆé€‚çš„<code>Resource</code>å®ç°æ—¶ï¼Œæ‰å»ä½¿ç”¨å®ƒã€‚ åŒæ—¶è¯·ä¼˜å…ˆé€‰æ‹©<code>ByteArrayResource</code>æˆ–å…¶ä»–åŸºäºæ–‡ä»¶çš„<code>Resource</code>å®ç°ï¼Œè¿«ä¸å¾—å·²çš„æ‰ä½¿ç”¨å®ƒã€‚</p><p>ä¸å…¶ä»–<code>Resource</code> å®ç°ç›¸æ¯”ï¼Œè¿™æ˜¯å·²æ‰“å¼€èµ„æºçš„æè¿°ç¬¦ã€‚ å› æ­¤ï¼Œå®ƒä»<code>isOpen()</code>è¿”å›<code>true</code>ã€‚</p><h4 id="4-3-6-ByteArrayResource"><a href="#4-3-6-ByteArrayResource" class="headerlink" title="4.3.6. ByteArrayResource"></a>4.3.6. <code>ByteArrayResource</code></h4><p>è¿™æ˜¯ç»™å®šå­—èŠ‚æ•°ç»„çš„<code>Resource</code>å®ç°ã€‚ å®ƒä¸ºç»™å®šçš„å­—èŠ‚æ•°ç»„åˆ›å»ºä¸€ä¸ª<code>ByteArrayInputStream</code>ã€‚</p><p>å½“éœ€è¦ä»å­—èŠ‚æ•°ç»„åŠ è½½å†…å®¹æ—¶ï¼ŒByteArrayResourceä¼šæ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œæ— éœ€æ±‚åŠ©äºå•ç‹¬ä½¿ç”¨çš„<code>InputStreamResource</code>ã€‚</p><h3 id="4-4-ResourceLoader"><a href="#4-4-ResourceLoader" class="headerlink" title="4.4.ResourceLoader"></a>4.4.<code>ResourceLoader</code></h3><p><code>ResourceLoader</code>æ¥å£ç”¨äºåŠ è½½<code>Resource</code>å¯¹è±¡ï¼Œæ¢å¥è¯è¯´ï¼Œå°±æ˜¯å½“ä¸€ä¸ªå¯¹è±¡éœ€è¦è·å–<code>Resource</code>å®ä¾‹æ—¶ï¼Œå¯ä»¥é€‰æ‹©å®ç°<code>ResourceLoader</code>æ¥å£ï¼Œä»¥ä¸‹æ¸…å•æ˜¾ç¤ºäº†<code>ResourceLoader</code>æ¥å£å®šä¹‰ï¼šã€‚</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-keyword">public</span> <span class="hljs-title class_"><span class="hljs-keyword">interface</span> <span class="hljs-title">ResourceLoader</span> </span>&#123;<br>    Resource getResource(<span class="hljs-keyword">String</span> location);<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰€æœ‰åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡éƒ½å®ç°<code>ResourceLoader</code>æ¥å£ã€‚ å› æ­¤ï¼Œå¯ä»¥ä½¿ç”¨æ‰€æœ‰åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡æ¥è·å– <code>Resource</code>å®ä¾‹ã€‚</p><p>å½“åœ¨ç‰¹æ®Šçš„åº”ç”¨ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨<code>getResource()</code>æ–¹æ³•ä»¥åŠæŒ‡å®šçš„è·¯å¾„æ²¡æœ‰ç‰¹æ®Šå‰ç¼€æ—¶ï¼Œå°†è¿”å›é€‚åˆè¯¥ç‰¹å®šåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡çš„<code>Resource</code>ç±»å‹ã€‚ ä¾‹å¦‚ï¼Œå‡è®¾é’ˆå¯¹<code>ClassPathXmlApplicationContext</code> å®ä¾‹æ‰§è¡Œäº†ä»¥ä¸‹ä»£ç ç‰‡æ®µï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">Resource template <span class="hljs-operator">=</span> ctx.getResource(<span class="hljs-string">&quot;some/resource/path/myTemplate.txt&quot;</span>)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>é’ˆå¯¹<code>ClassPathXmlApplicationContext</code>ï¼Œè¯¥ä»£ç è¿”å› <code>ClassPathResource</code>ã€‚å¦‚æœå¯¹<code>FileSystemXmlApplicationContext</code> å®ä¾‹æ‰§è¡Œç›¸åŒçš„æ–¹æ³•ï¼Œå®ƒå°†è¿”å›<code>FileSystemResource</code>ã€‚ å¯¹äº<code>WebApplicationContext</code>ï¼Œå®ƒå°†è¿”å›<code>ServletContextResource</code>ã€‚ å®ƒåŒæ ·ä¼šä¸ºæ¯ä¸ªä¸Šä¸‹æ–‡è¿”å›é€‚å½“çš„å¯¹è±¡ã€‚</p><p>å› æ­¤ï¼Œæ‚¨å¯ä»¥ä»¥é€‚åˆç‰¹å®šåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡çš„æ–¹å¼åŠ è½½èµ„æºã€‚</p><p>å¦ä¸€æ–¹é¢ï¼Œæ‚¨å¯ä»¥é€šè¿‡æŒ‡å®šç‰¹æ®Šçš„<code>classpath:</code>å‰ç¼€æ¥å¼ºåˆ¶ä½¿ç”¨<code>ClassPathResource</code>ï¼Œè€Œä¸ç®¡åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ç±»å‹å¦‚ä½•ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">Resource template <span class="hljs-operator">=</span> ctx.getResource(<span class="hljs-string">&quot;classpath:some/resource/path/myTemplate.txt&quot;</span>)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>åŒæ ·ï¼Œæ‚¨å¯ä»¥é€šè¿‡æŒ‡å®šä»»ä½•æ ‡å‡†<code>java.net.URL</code>å‰ç¼€æ¥å¼ºåˆ¶ä½¿ç”¨<code>UrlResource</code> ã€‚ ä»¥ä¸‹å¯¹ç¤ºä¾‹ä½¿ç”¨<code>file</code> å’Œ <code>http</code>å‰ç¼€ï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf">Resource template <span class="hljs-operator">=</span> ctx.getResource(<span class="hljs-string">&quot;file:///some/resource/path/myTemplate.txt&quot;</span>)<span class="hljs-comment">;</span><br>Resource template <span class="hljs-operator">=</span> ctx.getResource(<span class="hljs-string">&quot;http://myhost.com/resource/path/myTemplate.txt&quot;</span>)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>ä¸‹è¡¨æ€»ç»“äº†å°†ï¼š<code>String</code>å¯¹è±¡è½¬æ¢ä¸º<code>Resource</code>å¯¹è±¡çš„ç­–ç•¥:</p><p>Table 10.èµ„æºå­—ç¬¦ä¸²</p><table><thead><tr><th>å‰ç¼€</th><th>ç¤ºä¾‹</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td>classpath:</td><td><code>classpath:com/myapp/config.xml</code></td><td>ä»ç±»è·¯å¾„åŠ è½½</td></tr><tr><td>file:</td><td><a href="file:///data/config.xml">file:&#x2F;&#x2F;&#x2F;data&#x2F;config.xml</a></td><td>ä»æ–‡ä»¶ç³»ç»ŸåŠ è½½ä¸º<code>URL</code>ã€‚ å¦è¯·å‚è§<a href="https://sca.aliyun.com/learn/spring/core/resources/?spm=0.29160081.0.0.51f92e5dCHrGI4#resources-filesystemresource-caveats"><code>FileSystemResource</code> è­¦å‘Šã€‚</a></td></tr><tr><td>http:</td><td><a href="http://myserver/logo.png">http://myserver/logo.png</a></td><td>ä½œä¸º<code>URL</code>åŠ è½½ã€‚</td></tr><tr><td>(none)</td><td><code>/data/config.xml</code></td><td>å–å†³äºåº•å±‚çš„<code>ApplicationContext</code>ã€‚</td></tr></tbody></table><h3 id="4-5-ResourceLoaderAware-æ¥å£"><a href="#4-5-ResourceLoaderAware-æ¥å£" class="headerlink" title="4.5. ResourceLoaderAware æ¥å£"></a>4.5. <code>ResourceLoaderAware</code> æ¥å£</h3><p><code>ResourceLoaderAware</code>æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ ‡è¯†æ¥å£ï¼Œç”¨æ¥æä¾›<code>ResourceLoader</code>å¼•ç”¨çš„å¯¹è±¡ã€‚ä»¥ä¸‹æ¸…å•æ˜¾ç¤ºäº†<code>ResourceLoaderAware</code>æ¥å£çš„å®šä¹‰ï¼š</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-symbol">ResourceLoaderAware</span> &#123;<br>    <span class="hljs-built_in">void</span> setResourceLoader(ResourceLoader resourceLoader);&#125;<br></code></pre></td></tr></table></figure><p>å½“ç±»å®ç°<code>ResourceLoaderAware</code>å¹¶éƒ¨ç½²åˆ°åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ï¼ˆä½œä¸ºSpringç®¡ç†çš„beanï¼‰æ—¶ï¼Œå®ƒè¢«åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡è¯†åˆ«ä¸º<code>ResourceLoaderAware</code>ã€‚ ç„¶åï¼Œåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡è°ƒç”¨<code>setResourceLoader(ResourceLoader)</code>ï¼Œå°†å…¶è‡ªèº«ä½œä¸ºå‚æ•°æä¾›ï¼ˆè¯·è®°ä½ï¼ŒSpringä¸­çš„æ‰€æœ‰åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡éƒ½å®ç°äº†<code>ResourceLoader</code>æ¥å£ï¼‰ã€‚</p><p>ç”±äº<code>ApplicationContext</code>å®ç°äº†<code>ResourceLoader</code>ï¼Œå› æ­¤beanè¿˜å¯ä»¥å®ç° <code>ApplicationContextAware</code> æ¥å£å¹¶ç›´æ¥ä½¿ç”¨æä¾›çš„åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡æ¥åŠ è½½èµ„æºã€‚ ä½†æ˜¯ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœæ‚¨éœ€è¦ï¼Œæœ€å¥½ä½¿ç”¨ä¸“ç”¨çš„<code>ResourceLoader</code>æ¥å£ã€‚ ä»£ç åªèƒ½è€¦åˆåˆ°èµ„æºåŠ è½½æ¥å£ï¼ˆå¯ä»¥è¢«è®¤ä¸ºæ˜¯å®ç”¨ç¨‹åºæ¥å£ï¼‰ï¼Œè€Œä¸èƒ½è€¦åˆåˆ°æ•´ä¸ªSpring <code>ApplicationContext</code>æ¥å£ã€‚</p><p>ä»Spring 2.5å¼€å§‹ï¼Œé™¤äº†å®ç°<code>ResourceLoaderAware</code>æ¥å£ï¼Œè¿˜å¯ä»¥é‡‡å–å¦å¤–ä¸€ç§æ›¿ä»£æ–¹æ¡ˆ-ä¾èµ–<code>ResourceLoader</code>çš„è‡ªåŠ¨è£…é…ã€‚ â€œä¼ ç»Ÿâ€æ„é€ å‡½æ•°å’ŒbyType <a href="https://sca.aliyun.com/learn/spring/core/resources/?spm=0.29160081.0.0.51f92e5dCHrGI4#beans-factory-autowire">è‡ªåŠ¨è£…é…</a>æ¨¡å¼éƒ½æ”¯æŒå¯¹<code>ResourceLoader</code>çš„è£…é…ã€‚ å‰è€…æ˜¯ä»¥æ„é€ å‚æ•°çš„å½¢å¼è£…é…ï¼Œåè€…ä½œä¸ºsetteræ–¹æ³•çš„å‚æ•°å‚ä¸è£…é…ã€‚å¦‚æœä¸ºäº†è·å¾—æ›´å¤§çš„çµæ´»æ€§ï¼ˆåŒ…æ‹¬å±æ€§æ³¨å…¥çš„èƒ½åŠ›å’Œå¤šå‚æ–¹æ³•ï¼‰ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨åŸºäºæ³¨è§£çš„æ–°å‹æ³¨å…¥æ–¹å¼ã€‚ ä½¿ç”¨æ³¨è§£<code>@Autowired</code>æ ‡è¯†<code>ResourceLoader</code>å˜é‡ï¼Œä¾¿å¯å°†å…¶æ³¨å…¥åˆ°æˆå‘˜å±æ€§ã€æ„é€ å‚æ•°æˆ–æ–¹æ³•å‚æ•°ä¸­ã€‚è¿™äº›å‚æ•°éœ€è¦ResourceLoaderç±»å‹ã€‚ æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…ä½¿ç”¨<a href="https://sca.aliyun.com/learn/spring/core/resources/?spm=0.29160081.0.0.51f92e5dCHrGI4#beans-autowired-annotation">Using <code>@Autowired</code></a>ã€‚</p><h3 id="4-6-èµ„æºä¾èµ–"><a href="#4-6-èµ„æºä¾èµ–" class="headerlink" title="4.6. èµ„æºä¾èµ–"></a>4.6. èµ„æºä¾èµ–</h3><p>å¦‚æœbeanæœ¬èº«è¦é€šè¿‡æŸç§åŠ¨æ€è¿‡ç¨‹æ¥ç¡®å®šå’Œæä¾›èµ„æºè·¯å¾„ï¼Œé‚£ä¹ˆbeanä½¿ç”¨<code>ResourceLoader</code>æ¥å£æ¥åŠ è½½èµ„æºå°±å˜å¾—æ›´æœ‰æ„ä¹‰äº†ã€‚å‡å¦‚éœ€è¦åŠ è½½æŸç§ç±»å‹çš„æ¨¡æ¿ï¼Œå…¶ä¸­æ‰€éœ€çš„ç‰¹å®šèµ„æºå–å†³äºç”¨æˆ·çš„è§’è‰² ã€‚å¦‚æœèµ„æºæ˜¯é™æ€çš„ï¼Œé‚£ä¹ˆå®Œå…¨å¯ä»¥ä¸ä½¿ç”¨<code>ResourceLoader</code>æ¥å£ï¼Œåªéœ€è®©beanå…¬å¼€å®ƒéœ€è¦çš„<code>Resource</code>å±æ€§ï¼Œå¹¶æŒ‰ç…§é¢„æœŸæ³¨å…¥å±æ€§å³å¯ã€‚</p><p>æ˜¯ä»€ä¹ˆä½¿å¾—æ³¨å…¥è¿™äº›å±æ€§å˜å¾—å¦‚æ­¤ç®€å•ï¼Ÿæ˜¯å› ä¸ºæ‰€æœ‰åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡æ³¨å†Œå’Œä½¿ç”¨ä¸€ä¸ªç‰¹æ®Šçš„<code>PropertyEditor</code> JavaBeanï¼Œå®ƒå¯ä»¥å°† <code>String</code> pathsè½¬æ¢ä¸º<code>Resource</code>å¯¹è±¡ã€‚ å› æ­¤ï¼Œå¦‚æœ<code>myBean</code>æœ‰ä¸€ä¸ªç±»å‹ä¸º<code>Resource</code>çš„æ¨¡æ¿å±æ€§ï¼Œå®ƒå¯ä»¥ç”¨ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²é…ç½®è¯¥èµ„æºã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs abnf">&lt;bean id<span class="hljs-operator">=</span><span class="hljs-string">&quot;myBean&quot;</span> class<span class="hljs-operator">=</span><span class="hljs-string">&quot;...&quot;</span>&gt;<br><br>    &lt;property name<span class="hljs-operator">=</span><span class="hljs-string">&quot;template&quot;</span> value<span class="hljs-operator">=</span><span class="hljs-string">&quot;some/resource/path/myTemplate.txt&quot;</span>/&gt;<br><br>&lt;/bean&gt;<br></code></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œèµ„æºè·¯å¾„æ²¡æœ‰å‰ç¼€ã€‚ å› æ­¤ï¼Œå› ä¸ºåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡æœ¬èº«å°†ç”¨ä½œ<code>ResourceLoader</code>ï¼Œ æ‰€ä»¥èµ„æºæœ¬èº«é€šè¿‡<code>ClassPathResource</code>ï¼Œ<code>FileSystemResource</code>æˆ–<code>ServletContextResource</code>åŠ è½½ï¼Œå…·ä½“å–å†³äºä¸Šä¸‹æ–‡çš„ç¡®åˆ‡ç±»å‹ã€‚</p><p>å¦‚æœéœ€è¦å¼ºåˆ¶ä½¿ç”¨ç‰¹å®šçš„ <code>Resource</code>ç±»å‹ï¼Œåˆ™å¯ä»¥ä½¿ç”¨å‰ç¼€ã€‚ ä»¥ä¸‹ä¸¤ä¸ªç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•å¼ºåˆ¶<code>ClassPathResource</code>å’Œ<code>UrlResource</code>ï¼ˆåè€…ç”¨äºè®¿é—®æ–‡ä»¶ç³»ç»Ÿæ–‡ä»¶ï¼‰ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;property <span class="hljs-attribute">name</span>=<span class="hljs-string">&quot;template&quot;</span> <span class="hljs-attribute">value</span>=<span class="hljs-string">&quot;classpath:some/resource/path/myTemplate.txt&quot;</span>&gt;<br>&lt;property <span class="hljs-attribute">name</span>=<span class="hljs-string">&quot;template&quot;</span> <span class="hljs-attribute">value</span>=<span class="hljs-string">&quot;file:///some/resource/path/myTemplate.txt&quot;</span>/&gt;<br></code></pre></td></tr></table></figure><h3 id="4-7-åº”ç”¨ä¸Šä¸‹æ–‡å’Œèµ„æºè·¯å¾„"><a href="#4-7-åº”ç”¨ä¸Šä¸‹æ–‡å’Œèµ„æºè·¯å¾„" class="headerlink" title="4.7. åº”ç”¨ä¸Šä¸‹æ–‡å’Œèµ„æºè·¯å¾„"></a>4.7. åº”ç”¨ä¸Šä¸‹æ–‡å’Œèµ„æºè·¯å¾„</h3><p>æœ¬èŠ‚ä»‹ç»å¦‚ä½•ä½¿ç”¨èµ„æºåˆ›å»ºåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ï¼ŒåŒ…æ‹¬ä½¿ç”¨XMLçš„å¿«æ·æ–¹å¼ï¼Œå¦‚ä½•ä½¿ç”¨é€šé…ç¬¦ä»¥åŠå…¶ä»–è¯¦ç»†ä¿¡æ¯ã€‚</p><h4 id="4-7-1-æ„é€ åº”ç”¨ä¸Šä¸‹æ–‡"><a href="#4-7-1-æ„é€ åº”ç”¨ä¸Šä¸‹æ–‡" class="headerlink" title="4.7.1. æ„é€ åº”ç”¨ä¸Šä¸‹æ–‡"></a>4.7.1. æ„é€ åº”ç”¨ä¸Šä¸‹æ–‡</h4><p>åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡æ„é€ å‡½æ•°ï¼ˆå¯¹äºç‰¹å®šçš„åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ç±»å‹ï¼‰é€šå¸¸å°†å­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²æ•°ç»„ä½œä¸ºèµ„æºçš„ä½ç½®è·¯å¾„ï¼Œä¾‹å¦‚æ„æˆä¸Šä¸‹æ–‡å®šä¹‰çš„XMLæ–‡ä»¶ã€‚</p><p>å½“æŒ‡å®šçš„ä½ç½®è·¯å¾„æ²¡æœ‰å¸¦å‰ç¼€æ—¶ï¼Œé‚£ä¹ˆä»æŒ‡å®šä½ç½®è·¯å¾„åˆ›å»º<code>Resource</code>ç±»å‹ï¼ˆç”¨äºåç»­åŠ è½½beanå®šä¹‰ï¼‰ï¼Œå…·ä½“å–å†³äºæ‰€ä½¿ç”¨åº”ç”¨ä¸Šä¸‹æ–‡ã€‚ ä¾‹å¦‚ï¼Œè¯·è€ƒè™‘ä»¥ä¸‹ç¤ºä¾‹ï¼Œè¯¥ç¤ºä¾‹åˆ›å»º<code>ClassPathXmlApplicationContext</code>ï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">ApplicationContext ctx <span class="hljs-operator">=</span> new ClassPathXmlApplicationContext(<span class="hljs-string">&quot;conf/appContext.xml&quot;</span>)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>beanå®šä¹‰æ˜¯ä»ç±»è·¯å¾„åŠ è½½çš„ï¼Œå› ä¸ºä½¿ç”¨äº†<code>ClassPathResource</code>ã€‚ ä½†æ˜¯ï¼Œè¯·è€ƒè™‘ä»¥ä¸‹ç¤ºä¾‹ï¼Œè¯¥ç¤ºä¾‹åˆ›å»º <code>FileSystemXmlApplicationContext</code>ï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs abnf">ApplicationContext ctx <span class="hljs-operator">=</span><br><br>    new FileSystemXmlApplicationContext(<span class="hljs-string">&quot;conf/appContext.xml&quot;</span>)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œbeanå®šä¹‰æ˜¯ä»æ–‡ä»¶ç³»ç»Ÿä½ç½®åŠ è½½çš„ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç›¸å¯¹äºå½“å‰å·¥ä½œç›®å½•ï¼‰ã€‚</p><p>è‹¥ä½ç½®è·¯å¾„å¸¦æœ‰classpathå‰ç¼€æˆ–URLå‰ç¼€ï¼Œä¼šè¦†ç›–é»˜è®¤åˆ›å»ºçš„ç”¨äºåŠ è½½beanå®šä¹‰çš„<code>Resource</code>ç±»å‹ã€‚è¯·è€ƒè™‘ä»¥ä¸‹ç¤ºä¾‹ï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs abnf">ApplicationContext ctx <span class="hljs-operator">=</span><br><br>    new FileSystemXmlApplicationContext(<span class="hljs-string">&quot;classpath:conf/appContext.xml&quot;</span>)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨<code>FileSystemXmlApplicationContext</code>ä»ç±»è·¯å¾„åŠ è½½beanå®šä¹‰ã€‚ ä½†æ˜¯ï¼Œå®ƒä»ç„¶æ˜¯<code>FileSystemXmlApplicationContext</code>ã€‚ å¦‚æœå®ƒéšåç”¨ä½œ<code>ResourceLoader</code>ï¼Œåˆ™ä»»ä½•æœªåŠ å‰ç¼€çš„è·¯å¾„ä»è¢«è§†ä¸ºæ–‡ä»¶ç³»ç»Ÿè·¯å¾„ã€‚</p><h5 id="æ„é€ ClassPathXmlApplicationContextå®ä¾‹çš„å¿«æ·æ–¹å¼"><a href="#æ„é€ ClassPathXmlApplicationContextå®ä¾‹çš„å¿«æ·æ–¹å¼" class="headerlink" title="æ„é€ ClassPathXmlApplicationContextå®ä¾‹çš„å¿«æ·æ–¹å¼"></a>æ„é€ <code>ClassPathXmlApplicationContext</code>å®ä¾‹çš„å¿«æ·æ–¹å¼</h5><p><code>ClassPathXmlApplicationContext</code>æä¾›äº†å¤šä¸ªæ„é€ å‡½æ•°ï¼Œä»¥åˆ©äºå¿«æ·åˆ›å»º<code>ClassPathXmlApplicationContext</code>çš„å®ä¾‹ã€‚åŸºç¡€çš„æƒ³æ³•æ˜¯ï¼Œ ä½¿ç”¨åªåŒ…å«å¤šä¸ªXMLæ–‡ä»¶åï¼ˆä¸å¸¦è·¯å¾„ä¿¡æ¯ï¼‰çš„å­—ç¬¦ä¸²æ•°ç»„å’Œä¸€ä¸ªClasså‚æ•°çš„æ„é€ å™¨ï¼Œæ‰€çœç•¥è·¯å¾„ä¿¡æ¯<code>ClassPathXmlApplicationContext</code>ä¼šä»<code>Class</code>å‚æ•°ä¸­è·å–ã€‚</p><p>è¯·è€ƒè™‘ä»¥ä¸‹ç›®å½•å¸ƒå±€:</p><p>com&#x2F; foo&#x2F; services.xml daos.xml MessengerService.class</p><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•å®ä¾‹åŒ–ç”±åä¸º<code>services.xml</code>å’Œ<code>daos.xml</code>ï¼ˆä½äºç±»è·¯å¾„ä¸­ï¼‰çš„æ–‡ä»¶ä¸­å®šä¹‰çš„beanç»„æˆçš„<code>ClassPathXmlApplicationContext</code>å®ä¾‹ï¼š</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs arduino">ApplicationContext ctx = <span class="hljs-keyword">new</span> <span class="hljs-built_in">ClassPathXmlApplicationContext</span>(<br><br>    <span class="hljs-keyword">new</span> <span class="hljs-type">String</span>[] &#123;<span class="hljs-string">&quot;services.xml&quot;</span>, <span class="hljs-string">&quot;daos.xml&quot;</span>&#125;, MessengerService.<span class="hljs-keyword">class</span>);<br></code></pre></td></tr></table></figure><p>æœ‰å…³å„ç§æ„é€ å‡½æ•°çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://docs.spring.io/spring-framework/docs/5.1.3.BUILD-SNAPSHOT/javadoc-api/org/springframework/jca/context/SpringContextResourceAdapter.html"><code>ClassPathXmlApplicationContext</code></a>javadocã€‚</p><h4 id="4-7-2-ä½¿ç”¨é€šé…ç¬¦æ„é€ åº”ç”¨ä¸Šä¸‹æ–‡"><a href="#4-7-2-ä½¿ç”¨é€šé…ç¬¦æ„é€ åº”ç”¨ä¸Šä¸‹æ–‡" class="headerlink" title="4.7.2. ä½¿ç”¨é€šé…ç¬¦æ„é€ åº”ç”¨ä¸Šä¸‹æ–‡"></a>4.7.2. ä½¿ç”¨é€šé…ç¬¦æ„é€ åº”ç”¨ä¸Šä¸‹æ–‡</h4><p>ä»å‰æ–‡å¯çŸ¥ï¼Œåº”ç”¨ä¸Šä¸‹æ–‡æ„é€ å™¨çš„èµ„æºè·¯å¾„å¯ä»¥æ˜¯å•ä¸€çš„è·¯å¾„ï¼ˆå³ä¸€å¯¹ä¸€åœ°æ˜ å°„åˆ°ç›®æ ‡èµ„æºï¼‰ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨é«˜æ•ˆçš„é€šé…ç¬¦ã€‚å¯ä»¥åŒ…å«ç‰¹æ®Šçš„â€classpath*:â€œå‰ç¼€æˆ–anté£æ ¼çš„æ­£åˆ™è¡¨è¾¾å¼ï¼ˆä½¿ç”¨Springçš„PathMatcheræ¥åŒ¹é…ï¼‰ã€‚</p><p>é€šé…ç¬¦æœºåˆ¶å¯ç”¨äºç»„è£…åº”ç”¨ç¨‹åºçš„ç»„ä»¶ï¼Œåº”ç”¨ç¨‹åºé‡Œæ‰€æœ‰ç»„ä»¶éƒ½å¯ä»¥åœ¨ä¸€ä¸ªå…¬ç”¨çš„ä½ç½®è·¯å¾„å‘å¸ƒè‡ªå®šä¹‰çš„ä¸Šä¸‹æ–‡ç‰‡æ®µï¼Œé‚£ä¹ˆæœ€ç»ˆçš„åº”ç”¨ä¸Šä¸‹æ–‡å¯ä½¿ç”¨<code>classpath*:</code>ã€‚ åœ¨åŒä¸€è·¯å¾„å‰ç¼€ï¼ˆå‰é¢çš„å…¬ç”¨è·¯å¾„ï¼‰ä¸‹åˆ›å»ºï¼Œè¿™æ—¶æ‰€æœ‰ç»„ä»¶ä¸Šä¸‹æ–‡çš„ç‰‡æ®µéƒ½ä¼šè¢«è‡ªåŠ¨è£…é…ã€‚</p><p>è¯·æ³¨æ„ï¼Œæ­¤é€šé…ç¬¦ç‰¹å®šäºåœ¨åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡æ„é€ å‡½æ•°ä¸­ä½¿ç”¨èµ„æºè·¯å¾„ï¼ˆæˆ–ç›´æ¥ä½¿ç”¨ <code>PathMatcher</code>å®ç”¨ç¨‹åºç±»å±‚æ¬¡ç»“æ„æ—¶ï¼‰ï¼Œå¹¶åœ¨æ„é€ æ—¶è§£æã€‚ å®ƒä¸èµ„æºç±»å‹æœ¬èº«æ— å…³ã€‚ æ‚¨ä¸èƒ½ä½¿ç”¨<code>classpath*:</code>å‰ç¼€æ¥æ„é€ å®é™…çš„<code>Resource</code>,ï¼Œå› ä¸ºèµ„æºä¸€æ¬¡åªæŒ‡å‘ä¸€ä¸ªèµ„æºã€‚</p><h5 id="Anté£æ ¼æ¨¡å¼"><a href="#Anté£æ ¼æ¨¡å¼" class="headerlink" title="Anté£æ ¼æ¨¡å¼"></a>Anté£æ ¼æ¨¡å¼</h5><p>è·¯å¾„ä½ç½®å¯ä»¥åŒ…å«Antæ ·å¼æ¨¡å¼ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><p>&#x2F;WEB-INF&#x2F;<em>-context.xml com&#x2F;mycompany&#x2F;**&#x2F;applicationContext.xml file:C:&#x2F;some&#x2F;path&#x2F;</em>-context.xml classpath:com &#x2F;mycompany&#x2F;**&#x2F;applicationContext.xml</p><p>å½“è·¯å¾„ä½ç½®åŒ…å«Antæ ·å¼æ¨¡å¼æ—¶ï¼Œè§£æç¨‹åºéµå¾ªæ›´å¤æ‚çš„è¿‡ç¨‹æ¥å°è¯•è§£æé€šé…ç¬¦ã€‚è§£é‡Šå™¨ä¼šå…ˆä»ä½ç½®è·¯å¾„é‡Œè·å–æœ€é å‰çš„ä¸å¸¦é€šé…ç¬¦çš„è·¯å¾„ç‰‡æ®µï¼Œ å¹¶ä½¿ç”¨è¿™ä¸ªè·¯å¾„ç‰‡æ®µæ¥åˆ›å»ºä¸€ä¸ª<code>Resource</code>ï¼Œå¹¶ä»ä¸­è·å–ä¸€ä¸ªURLã€‚ å¦‚æœæ­¤URLä¸æ˜¯<code>jar:</code>URLæˆ–ç‰¹å®šäºå®¹å™¨çš„å˜ä½“ï¼ˆä¾‹å¦‚ï¼Œåœ¨WebLogicä¸­ä¸º<code>zip:</code>ï¼Œåœ¨WebSphereä¸­ä¸º<code>wsjar</code>ï¼Œç­‰ç­‰ï¼‰ åˆ™ä»Resourceé‡Œè·å–<code>java.io.File</code>å¯¹è±¡ï¼Œå¹¶é€šè¿‡å…¶éå†æ–‡ä»¶ç³»ç»Ÿã€‚è¿›è€Œè§£å†³ä½ç½®è·¯å¾„é‡Œé€šé…ç¬¦ã€‚ å¯¹äºjar URLï¼Œè§£æå™¨è¦ä¹ˆä»ä¸­è·å–<code>java.net.JarURLConnection</code>ï¼Œ è¦ä¹ˆæ‰‹åŠ¨è§£æjar URLï¼Œç„¶åéå†jaræ–‡ä»¶çš„å†…å®¹ä»¥è§£æé€šé…ç¬¦ã€‚</p><h6 id="å¯ç§»æ¤æ€§æ‰€å¸¦æ¥çš„å½±å“"><a href="#å¯ç§»æ¤æ€§æ‰€å¸¦æ¥çš„å½±å“" class="headerlink" title="å¯ç§»æ¤æ€§æ‰€å¸¦æ¥çš„å½±å“"></a>å¯ç§»æ¤æ€§æ‰€å¸¦æ¥çš„å½±å“</h6><p>å¦‚æœæŒ‡å®šçš„è·¯å¾„å®šä¸ºæ–‡ä»¶URLï¼ˆä¸ç®¡æ˜¯æ˜¾å¼è¿˜æ˜¯éšå¼çš„ï¼‰ï¼Œé¦–å…ˆé»˜è®¤çš„<code>ResourceLoader</code>å°±æ˜¯æ–‡ä»¶ç³»ç»Ÿï¼Œå…¶æ¬¡é€šé…ç¬¦ä½¿ç”¨ç¨‹åºå¯ä»¥å®Œç¾ç§»æ¤ã€‚</p><p>å¦‚æœæŒ‡å®šçš„è·¯å¾„æ˜¯ç±»è·¯å¾„ä½ç½®ï¼Œåˆ™è§£æå™¨å¿…é¡»é€šè¿‡ <code>Classloader.getResource()</code>æ–¹æ³•è°ƒç”¨è·å–æœ€åä¸€ä¸ªéé€šé…ç¬¦è·¯å¾„æ®µURLã€‚ å› ä¸ºè¿™åªæ˜¯è·¯å¾„çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆè€Œä¸æ˜¯æœ«å°¾çš„æ–‡ä»¶ï¼‰ï¼Œå®é™…ä¸Šå®ƒæ˜¯æœªå®šä¹‰çš„ï¼ˆåœ¨<code>ClassLoader</code> javadocä¸­ï¼‰ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹å¹¶ä¸èƒ½ç¡®å®šè¿”å›ä»€ä¹ˆæ ·çš„URLã€‚ å®é™…ä¸Šï¼Œå®ƒå§‹ç»ˆä¼šä½¿ç”¨<code>java.io.File</code>æ¥è§£æç›®å½•ï¼Œå…¶ä¸­ç±»è·¯å¾„èµ„æºä¼šè§£æåˆ°æ–‡ä»¶ç³»ç»Ÿçš„ä½ç½®æˆ–æŸç§ç±»å‹çš„jar URLï¼Œå…¶ä¸­ç±»è·¯å¾„èµ„æºè§£æä¸ºjaråŒ…çš„ä½ç½®ã€‚ ä½†æ˜¯ï¼Œè¿™ä¸ªæ“ä½œå°±ç¢°åˆ°äº†å¯ç§»æ¤çš„é—®é¢˜äº†ã€‚</p><p>å¦‚æœè·å–äº†æœ€åä¸€ä¸ªéé€šé…ç¬¦æ®µçš„jaråŒ…URLï¼Œè§£æå™¨å¿…é¡»èƒ½å¤Ÿä»ä¸­è·å–<code>java.net.JarURLConnection</code>ï¼Œæˆ–è€…æ‰‹åŠ¨è§£æjaråŒ…çš„URLï¼Œä»¥ä¾¿èƒ½å¤Ÿéå†jarçš„å†…å®¹ã€‚ å¹¶è§£æé€šé…ç¬¦ï¼Œè¿™é€‚ç”¨äºå¤§å¤šæ•°å·¥ä½œç¯å¢ƒï¼Œä½†åœ¨æŸäº›å…¶ä»–ç‰¹å®šç¯å¢ƒä¸­å°†ä¼šæœ‰é—®é¢˜ï¼Œæœ€åä¼šå¯¼è‡´è§£æå¤±è´¥ï¼Œæ‰€ä»¥å¼ºçƒˆå»ºè®®åœ¨ç‰¹å®šç¯å¢ƒä¸­å½»åº•æµ‹è¯•æ¥è‡ªjarèµ„æºçš„é€šé…ç¬¦è§£æï¼Œæµ‹è¯•æˆåŠŸä¹‹åå†å¯¹å…¶ä½œä¾èµ–ä½¿ç”¨ã€‚</p><h5 id="The-classpath-å‰ç¼€"><a href="#The-classpath-å‰ç¼€" class="headerlink" title="The classpath*: å‰ç¼€"></a>The <code>classpath*:</code> å‰ç¼€</h5><p>å½“æ„é€ åŸºäºXMLæ–‡ä»¶çš„åº”ç”¨ä¸Šä¸‹æ–‡æ—¶ï¼Œä½ç½®è·¯å¾„å¯ä»¥ä½¿ç”¨<code>classpath*:</code>å‰ç¼€ã€‚å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs abnf">ApplicationContext ctx <span class="hljs-operator">=</span><br><br>    new ClassPathXmlApplicationContext(<span class="hljs-string">&quot;classpath*:conf/appContext.xml&quot;</span>)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p><code>classpath*:</code>çš„ä½¿ç”¨è¡¨ç¤ºè¯¥ç±»è·¯å¾„ä¸‹æ‰€æœ‰åŒ¹é…æ–‡ä»¶åç§°çš„èµ„æºéƒ½ä¼šè¢«è·å–ï¼ˆæœ¬è´¨ä¸Šå°±æ˜¯è°ƒç”¨äº†<code>ClassLoader.getResources(â€¦)</code>æ–¹æ³•ï¼Œæ¥ç€å°†è·å–åˆ°çš„èµ„æºè£…é…æˆæœ€ç»ˆçš„åº”ç”¨ä¸Šä¸‹æ–‡ã€‚</p><p>é€šé…ç¬¦ç±»è·¯å¾„ä¾èµ–äºåº•å±‚ç±»åŠ è½½å™¨çš„<code>getResources()</code> æ–¹æ³•ã€‚ç”±äºç°åœ¨å¤§å¤šæ•°åº”ç”¨ç¨‹åºæœåŠ¡å™¨éƒ½æä¾›è‡ªå·±çš„ç±»åŠ è½½å™¨å®ç°ï¼Œå› æ­¤è¡Œä¸ºå¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†jaræ–‡ä»¶æ—¶ã€‚ è¦åœ¨æŒ‡å®šæœåŠ¡å™¨æµ‹è¯•<code>classpath*</code> æ˜¯å¦æœ‰æ•ˆï¼Œç®€å•ç‚¹å¯ä»¥ä½¿ç”¨<code>getClass().getClassLoader().getResources(&quot;&lt;someFileInsideTheJar&gt;&quot;)</code>æ¥åŠ è½½ç±»è·¯å¾„jaråŒ…é‡Œçš„æ–‡ä»¶ã€‚ å°è¯•åœ¨ä¸¤ä¸ªä¸åŒçš„è·¯å¾„åŠ è½½ç›¸åŒåç§°çš„æ–‡ä»¶ï¼Œå¦‚æœè¿”å›çš„ç»“æœä¸ä¸€è‡´ï¼Œå°±éœ€è¦æŸ¥çœ‹ä¸€ä¸‹æ­¤æœåŠ¡å™¨ä¸­ä¸classloaderè®¾ç½®ç›¸å…³çš„æ–‡æ¡£ã€‚</p><p>æ‚¨è¿˜å¯ä»¥å°†<code>classpath*:</code> å‰ç¼€ä¸ä½ç½®è·¯å¾„çš„å…¶ä½™éƒ¨åˆ†ä¸­çš„ <code>PathMatcher</code>æ¨¡å¼ç»„åˆåœ¨ä¸€èµ·ï¼ˆä¾‹å¦‚ï¼Œ<code>classpath*:META-INF/*-beans.xml</code>ï¼‰ã€‚ è¿™ç§æƒ…å†µçš„è§£æç­–ç•¥éå¸¸ç®€å•ï¼Œå–ä½ç½®è·¯å¾„æœ€é å‰çš„æ— é€šé…ç¬¦ç‰‡æ®µï¼Œç„¶åè°ƒç”¨<code>ClassLoader.getResources()</code>è·å–æ‰€æœ‰åŒ¹é…åˆ°çš„ç±»å±‚æ¬¡åŠ è½½å™¨åŠ è½½èµ„æºï¼Œéšåå°†<code>PathMatcher</code>çš„ç­–ç•¥åº”ç”¨äºæ¯ä¸€ä¸ªå¾—åˆ°çš„èµ„æºã€‚</p><h5 id="é€šé…ç¬¦çš„è¡¥å……è¯´æ˜"><a href="#é€šé…ç¬¦çš„è¡¥å……è¯´æ˜" class="headerlink" title="é€šé…ç¬¦çš„è¡¥å……è¯´æ˜"></a>é€šé…ç¬¦çš„è¡¥å……è¯´æ˜</h5><p>è¯·æ³¨æ„ï¼Œé™¤éæ‰€æœ‰ç›®æ ‡èµ„æºéƒ½å­˜åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œå¦åˆ™<code>classpath*:</code>ä¸Antæ ·å¼æ¨¡å¼ç»“åˆï¼Œéƒ½åªèƒ½åœ¨è‡³å°‘æœ‰ä¸€ä¸ªç¡®å®šäº†æ ¹è·¯å¾„çš„æƒ…å†µä¸‹ï¼Œæ‰èƒ½è¾¾åˆ°é¢„æœŸçš„æ•ˆæœã€‚ è¿™æ„å‘³ç€<code>classpath*:*.xml</code>ç­‰æ¨¡å¼å¯èƒ½æ— æ³•ä»jaræ–‡ä»¶çš„æ ¹ç›®å½•ä¸­æ£€ç´¢æ–‡ä»¶ï¼Œè€Œåªèƒ½ä»æ ¹ç›®å½•ä¸­çš„æ‰©å±•ç›®å½•ä¸­æ£€ç´¢æ–‡ä»¶ã€‚</p><p>é—®é¢˜çš„æ ¹æºæ˜¯JDKçš„<code>ClassLoader.getResources()</code>æ–¹æ³•çš„å±€é™æ€§ã€‚å½“å‘<code>ClassLoader.getResources()</code>ä¼ å…¥ç©ºä¸²æ—¶ï¼ˆè¡¨ç¤ºæœç´¢æ½œåœ¨çš„æ ¹ç›®å½•ï¼‰ï¼Œ åªèƒ½è·å–çš„æ–‡ä»¶ç³»ç»Ÿçš„ä½ç½®è·¯å¾„ï¼Œå³è·å–ä¸äº†jarä¸­æ–‡ä»¶çš„ä½ç½®è·¯å¾„ã€‚Springä¹Ÿä¼šè¯„ä¼°<code>URLClassLoader</code>è¿è¡Œæ—¶é…ç½®å’Œjaræ–‡ä»¶ä¸­çš„<code>java.class.path</code>æ¸…å•ï¼Œä½†è¿™ä¸èƒ½ä¿è¯å¯¼è‡´å¯ç§»æ¤è¡Œä¸ºã€‚</p><p>æ‰«æç±»è·¯å¾„åŒ…éœ€è¦åœ¨ç±»è·¯å¾„ä¸­å­˜åœ¨ç›¸åº”çš„ç›®å½•æ¡ç›®ã€‚ ä½¿ç”¨Antæ„å»ºJARæ—¶ï¼Œè¯·ä¸è¦æ¿€æ´»JARä»»åŠ¡çš„æ–‡ä»¶å¼€å…³ã€‚ æ­¤å¤–ï¼Œåœ¨æŸäº›ç¯å¢ƒä¸­ï¼Œç±»è·¯å¾„ç›®å½•å¯èƒ½ä¸ä¼šåŸºäºå®‰å…¨ç­–ç•¥å…¬å¼€ - ä¾‹å¦‚ï¼ŒJDK 1.7.0_45åŠæ›´é«˜ç‰ˆæœ¬ä¸Šçš„ç‹¬ç«‹åº”ç”¨ç¨‹åºï¼ˆéœ€è¦åœ¨æ¸…å•ä¸­è®¾ç½®â€™Trusted-Libraryâ€™ ã€‚ è¯·å‚é˜…<a href="https://stackoverflow.com/questions/19394570/java-jre-7u45-breaks-classloader-getresources">http://stackoverflow.com/questions/19394570/java-jre-7u45-breaks-classloader-getresources</a>)ï¼‰ã€‚</p><p>åœ¨JDK 9çš„æ¨¡å—è·¯å¾„ï¼ˆJigsawï¼‰ä¸Šï¼ŒSpringçš„ç±»è·¯å¾„æ‰«æé€šå¸¸æŒ‰é¢„æœŸå·¥ä½œã€‚ æ­¤å¤„å¼ºçƒˆå»ºè®®å°†èµ„æºæ”¾å…¥ä¸“ç”¨ç›®å½•ï¼Œé¿å…ä¸Šè¿°æœç´¢jaræ–‡ä»¶æ ¹çº§åˆ«çš„å¯ç§»æ¤æ€§é—®é¢˜ã€‚</p><p>å¦‚æœæœ‰å¤šä¸ªç±»è·¯å¾„ä¸Šéƒ½ç”¨æœç´¢åˆ°çš„æ ¹åŒ…ï¼Œé‚£ä¹ˆä½¿ç”¨<code>classpath:</code>å’Œanté£æ ¼æ¨¡å¼ä¸€èµ·æŒ‡å®šèµ„æºå¹¶ä¸ä¿è¯ä¼šæ‰¾åˆ°åŒ¹é…çš„èµ„æºã€‚è¯·è€ƒè™‘ä»¥ä¸‹èµ„æºä½ç½®ç¤ºä¾‹ï¼š</p><p>com&#x2F;mycompany&#x2F;package1&#x2F;service-context.xml</p><p>ç°åœ¨è€ƒè™‘ä¸€ä¸ªäººå¯èƒ½ç”¨æ¥å°è¯•æŸ¥æ‰¾è¯¥æ–‡ä»¶çš„Anté£æ ¼è·¯å¾„:</p><p>classpath:com &#x2F;mycompany&#x2F;**&#x2F;service-context.xml</p><p>è¿™æ ·çš„èµ„æºå¯èƒ½åªåœ¨ä¸€ä¸ªä½ç½®ï¼Œä½†æ˜¯å½“ä½¿ç”¨å‰é¢ä¾‹å­ä¹‹ç±»çš„è·¯å¾„æ¥å°è¯•è§£æå®ƒæ—¶ï¼Œè§£æå™¨ä¼šå¤„ç†<code>getResource(&quot;com/mycompany&quot;);</code>è¿”å›çš„ï¼ˆç¬¬ä¸€ä¸ªï¼‰URLã€‚ å½“åœ¨å¤šä¸ªç±»è·¯å¾„å­˜åœ¨åŸºç¡€åŒ…èŠ‚ç‚¹<code>&quot;com/mycompany&quot;</code>æ—¶(å¦‚åœ¨å¤šä¸ªjarå­˜åœ¨è¿™ä¸ªåŸºç¡€èŠ‚ç‚¹ï¼‰ï¼Œè§£æå™¨å°±ä¸ä¸€å®šä¼šæ‰¾åˆ°æŒ‡å®šèµ„æºã€‚å› æ­¤ï¼Œè¿™ç§æƒ…å†µä¸‹å»ºè®®ç»“åˆä½¿ç”¨<code>classpath*:</code> å’Œanté£æ ¼æ¨¡å¼ï¼Œ<code>classpath*:</code>ä¼šè®©è§£æå™¨å»æœç´¢æ‰€æœ‰åŒ…å«åŸºç¡€åŒ…èŠ‚ç‚¹çš„ç±»è·¯å¾„ã€‚</p><h4 id="4-7-3-FileSystemResource-çš„è­¦å‘Š"><a href="#4-7-3-FileSystemResource-çš„è­¦å‘Š" class="headerlink" title="4.7.3. FileSystemResource çš„è­¦å‘Š"></a>4.7.3. <code>FileSystemResource</code> çš„è­¦å‘Š</h4><p>å½“<code>FileSystemResource</code>ä¸<code>FileSystemApplicationContext</code>ä¹‹é—´æ²¡æœ‰è”ç³»ï¼ˆå³ï¼Œå½“<code>FileSystemApplicationContext</code>ä¸æ˜¯å®é™…çš„<code>ResourceLoader</code>æ—¶ï¼‰æ—¶ä¼šæŒ‰é¢„æœŸå¤„ç†ç»å¯¹è·¯å¾„å’Œç›¸å¯¹è·¯å¾„ã€‚ ç›¸å¯¹è·¯å¾„æ˜¯ç›¸å¯¹ä¸å½“å‰å·¥ä½œç›®å½•è€Œè¨€çš„ï¼Œè€Œç»å¯¹è·¯å¾„åˆ™æ˜¯ç›¸å¯¹æ–‡ä»¶ç³»ç»Ÿçš„æ ¹ç›®å½•è€Œè¨€çš„ã€‚</p><p>ä½†æ˜¯ï¼Œå‡ºäºå‘åå…¼å®¹æ€§ï¼ˆå†å²ï¼‰çš„åŸå› ï¼Œå½“<code>FileSystemApplicationContext</code>æ˜¯<code>ResourceLoader</code>æ—¶ï¼Œè¿™ä¼šå‘ç”Ÿå˜åŒ–ã€‚<code>FileSystemApplicationContext</code>å¼ºåˆ¶æ‰€æœ‰æœ‰è”ç³»çš„<code>FileSystemResource</code>å®ä¾‹å°†æ‰€æœ‰ä½ç½®è·¯å¾„è§†ä¸ºç›¸å¯¹è·¯å¾„ï¼Œ æ— è®ºå®ƒä»¬æ˜¯å¦ä»¥â€™&#x2F;â€˜å¼€å¤´ã€‚ å®é™…ä¸Šï¼Œè¿™æ„å‘³ç€ä»¥ä¸‹ç¤ºä¾‹æ˜¯ç­‰æ•ˆçš„ï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf">ApplicationContext ctx <span class="hljs-operator">=</span>    new FileSystemXmlApplicationContext(<span class="hljs-string">&quot;conf/context.xml&quot;</span>)<span class="hljs-comment">;</span><br>ApplicationContext ctx <span class="hljs-operator">=</span>    new FileSystemXmlApplicationContext(<span class="hljs-string">&quot;/conf/context.xml&quot;</span>)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹ç¤ºä¾‹ä¹Ÿæ˜¯ç­‰æ•ˆçš„ï¼ˆå³ä½¿å®ƒä»¬æœ‰æ‰€ä¸åŒï¼Œå› ä¸ºä¸€ä¸ªæ¡ˆä¾‹æ˜¯ç›¸å¯¹çš„è€Œå¦ä¸€ä¸ªæ¡ˆä¾‹æ˜¯ç»å¯¹çš„ï¼‰ï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf">FileSystemXmlApplicationContext ctx <span class="hljs-operator">=</span> ...<span class="hljs-comment">;ctx.getResource(&quot;some/resource/path/myTemplate.txt&quot;);</span><br>FileSystemXmlApplicationContext ctx <span class="hljs-operator">=</span> ...<span class="hljs-comment">;ctx.getResource(&quot;/some/resource/path/myTemplate.txt&quot;);</span><br></code></pre></td></tr></table></figure><p>å®é™…ä¸Šï¼Œå¦‚æœç¡®å®éœ€è¦ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œå»ºè®®æ”¾å¼ƒä½¿ç”¨<code>FileSystemResource</code>å’Œ<code>FileSystemXmlApplicationContext</code>ï¼Œè€Œå¼ºåˆ¶ä½¿ç”¨ <code>file:</code>çš„<code>UrlResource</code>ã€‚</p><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vhdl">// actual <span class="hljs-keyword">context</span> <span class="hljs-keyword">type</span> doesn<span class="hljs-symbol">&#x27;t</span> matter, the Resource will always be UrlResourcectx.getResource(<span class="hljs-string">&quot;file:///some/resource/path/myTemplate.txt&quot;</span>);<br>// <span class="hljs-keyword">force</span> this FileSystemXmlApplicationContext <span class="hljs-keyword">to</span> load its definition via a UrlResourceApplicationContext ctx =    <span class="hljs-keyword">new</span> FileSystemXmlApplicationContext(<span class="hljs-string">&quot;file:///conf/context.xml&quot;</span>);<br></code></pre></td></tr></table></figure><blockquote><p>Rod Johnson, Juergen Hoeller, Keith Donald, Colin Sampaleanu, Rob Harrop, Thomas Risberg, Alef Arendsen, Darren Davison, Dmitriy Kopylenko, Mark Pollack, Thierry Templier, Erwin Vervaet, Portia Tung, Ben Hale, Adrian Colyer, John Lewis, Costin Leau, Mark Fisher, Sam Brannen, Ramnivas Laddad, Arjen Poutsma, Chris Beams, Tareq Abedrabbo, Andy Clement, Dave Syer, Oliver Gierke, Rossen Stoyanchev, Phillip Webb, Rob Winch, Brian Clozel, Stephane Nicoll, Sebastien Deleuze, Jay Bryant, Mark Paluch</p></blockquote><blockquote><p>Copyright Â© 2002 - 2024 VMware, Inc. All Rights Reserved.</p></blockquote><blockquote><p>Copies of this document may be made for your own use and for distribution to others, provided that you do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically.</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>Spring æ•™ç¨‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Spring</tag>
      
      <tag>Resources</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Web MVC</title>
    <link href="/post/149aa27a-b2cf-4887-9632-da7bc1425bc8/"/>
    <url>/post/149aa27a-b2cf-4887-9632-da7bc1425bc8/</url>
    
    <content type="html"><![CDATA[<h3 id="Web-MVC"><a href="#Web-MVC" class="headerlink" title="Web MVC"></a>Web MVC</h3><p><code>hexo template generate by typora plugin templater</code></p><h1 id="Web-MVC-1"><a href="#Web-MVC-1" class="headerlink" title="Web MVC"></a>Web MVC</h1><p>Spring æ•™ç¨‹</p><hr><h2 id="1-Spring-Web-MVC"><a href="#1-Spring-Web-MVC" class="headerlink" title="1. Spring Web MVC"></a>1. Spring Web MVC</h2><p>Spring Web MVCæ˜¯æ„å»ºåœ¨Servlet APIä¸Šçš„åŸå§‹Webæ¡†æ¶ï¼Œä»ä¸€å¼€å§‹å°±åŒ…å«åœ¨Spring Frameworkä¸­ã€‚ æ­£å¼åç§° â€œSpring Web MVC,â€ æ¥è‡ªå…¶æºæ¨¡å—(<a href="https://github.com/spring-projects/spring-framework/tree/master/spring-webmvc"><code>spring-webmvc</code></a>)çš„åç§°ï¼Œä½†å®ƒé€šå¸¸è¢«ç§°ä¸ºâ€œSpring MVCâ€ã€‚</p><p>ä¸Spring Web MVCå¹¶è¡Œï¼ŒSpring Framework 5.0å¼•å…¥äº†ä¸€ä¸ªååº”å †æ ˆWebæ¡†æ¶ï¼Œå…¶åç§°â€œSpring WebFlux,â€ä¹ŸåŸºäºå…¶æºæ¨¡å—(<a href="https://github.com/spring-projects/spring-framework/tree/master/spring-webflux"><code>spring-webflux</code></a>)ã€‚ æœ¬èŠ‚ä»‹ç»Spring Web MVCã€‚ <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#spring-web-reactive">ä¸‹ä¸€èŠ‚</a>å°†ä»‹ç»Spring WebFluxã€‚.</p><p>æœ‰å…³åŸºæœ¬ä¿¡æ¯ä»¥åŠä¸Servletå®¹å™¨å’ŒJava EEç‰ˆæœ¬èŒƒå›´çš„å…¼å®¹æ€§ï¼Œè¯·å‚é˜…Spring Framework <a href="https://github.com/spring-projects/spring-framework/wiki/Spring-Framework-Versions">Wiki</a>ã€‚</p><h3 id="1-1-DispatcherServlet"><a href="#1-1-DispatcherServlet" class="headerlink" title="1.1. DispatcherServlet"></a>1.1. DispatcherServlet</h3><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-dispatcher-handler">ä¸Spring WebFluxç›¸åŒ</a></p><p>Spring MVCå’Œè®¸å¤šå…¶ä»–Webæ¡†æ¶ä¸€æ ·ï¼Œå›´ç»•å‰ç«¯æ§åˆ¶å™¨æ¨¡å¼è®¾è®¡ï¼Œå…¶ä¸­æ ¸å¿ƒ <code>Servlet``DispatcherServlet</code>ä¸ºè¯·æ±‚å¤„ç†æä¾›å…±äº«ç®—æ³•ï¼Œè€Œå®é™…å·¥ä½œç”±å¯é…ç½®å§”æ‰˜ç»„ä»¶æ‰§è¡Œã€‚ è¯¥æ¨¡å‹éå¸¸çµæ´»ï¼Œæ”¯æŒå¤šç§å·¥ä½œæµç¨‹ã€‚</p><p><code>DispatcherServlet</code>ä¸ä»»ä½• <code>Servlet</code>ä¸€æ ·ï¼Œéœ€è¦ä½¿ç”¨Javaé…ç½®æˆ– <code>web.xml</code>æ ¹æ®Servletè§„èŒƒè¿›è¡Œå£°æ˜å’Œæ˜ å°„ã€‚ åè¿‡æ¥ï¼Œ<code>DispatcherServlet</code>ä½¿ç”¨Springé…ç½®æ¥å‘ç°è¯·æ±‚æ˜ å°„ï¼Œè§†å›¾è§£æï¼Œå¼‚å¸¸å¤„ç† <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-servlet-special-bean-types">ç­‰ç­‰</a>æ‰€éœ€çš„å§”æ‰˜ç»„ä»¶ã€‚</p><p>ä¸‹é¢çš„Javaé…ç½®ç¤ºä¾‹æ³¨å†Œå¹¶åˆå§‹åŒ–<code>DispatcherServlet</code>ï¼Œå®ƒç”±Servletå®¹å™¨è‡ªåŠ¨æ£€æµ‹ï¼ˆè¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-container-config">Servlet Config</a>ï¼‰ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> MyWebApplicationInitializer implements WebApplicationInitializer &#123;<br>    @Override    <span class="hljs-built_in">public</span> <span class="hljs-type">void</span> onStartup(ServletContext servletCxt) &#123;<br>        // <span class="hljs-keyword">Load</span> Spring web application <span class="hljs-keyword">configuration</span>        AnnotationConfigWebApplicationContext ac = <span class="hljs-built_in">new</span> AnnotationConfigWebApplicationContext();        ac.register(AppConfig.<span class="hljs-keyword">class</span>);        ac.<span class="hljs-keyword">refresh</span>();<br>        // <span class="hljs-keyword">Create</span> <span class="hljs-keyword">and</span> register the DispatcherServlet        DispatcherServlet servlet = <span class="hljs-built_in">new</span> DispatcherServlet(ac);        ServletRegistration.Dynamic registration = servletCxt.addServlet(&quot;app&quot;, servlet);        registration.setLoadOnStartup(<span class="hljs-number">1</span>);        registration.addMapping(&quot;/app/*&quot;);    &#125;&#125;<br></code></pre></td></tr></table></figure><p>é™¤äº†ç›´æ¥ä½¿ç”¨ServletContext APIä¹‹å¤–ï¼Œæ‚¨è¿˜å¯ä»¥æ‰©å±•<code>AbstractAnnotationConfigDispatcherServletInitializer</code> å¹¶è¦†ç›–ç‰¹å®šæ–¹æ³•ï¼ˆè¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-servlet-context-hierarchy">Context Hierarchy</a>ä¸‹çš„ç¤ºä¾‹ï¼‰ã€‚</p><p>ä»¥ä¸‹<code>web.xml</code>é…ç½®ç¤ºä¾‹æ³¨å†Œå¹¶åˆå§‹åŒ–<code>DispatcherServlet</code>:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">web-app</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">listener</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="hljs-tag">&lt;/<span class="hljs-name">listener-class</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">listener</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">context-param</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>contextConfigLocation<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>/WEB-INF/app-context.xml<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">context-param</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>app<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>contextConfigLocation<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">load-on-startup</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">load-on-startup</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>app<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/app/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">web-app</span>&gt;</span><br></code></pre></td></tr></table></figure><p>Spring Bootéµå¾ªä¸åŒçš„åˆå§‹åŒ–é¡ºåºã€‚ Spring Bootä½¿ç”¨Springé…ç½®æ¥å¼•å¯¼è‡ªèº«å’ŒåµŒå…¥å¼Servletå®¹å™¨ï¼Œè€Œä¸æ˜¯æŒ‚é’©åˆ°Servletå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸã€‚ åœ¨Springé…ç½®ä¸­æ£€æµ‹<code>Filter</code> å’Œ<code>Servlet</code>å£°æ˜ï¼Œå¹¶åœ¨Servletå®¹å™¨ä¸­æ³¨å†Œã€‚ æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…[Spring Boot</p><p>documentation](<a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#boot-features-embedded-container)%E6%96%87%E6%A1%A3%E3%80%82">https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#boot-features-embedded-container)æ–‡æ¡£ã€‚</a></p><h4 id="1-1-1-ä¸Šä¸‹æ–‡å±‚æ¬¡ç»“æ„"><a href="#1-1-1-ä¸Šä¸‹æ–‡å±‚æ¬¡ç»“æ„" class="headerlink" title="1.1.1. ä¸Šä¸‹æ–‡å±‚æ¬¡ç»“æ„"></a>1.1.1. ä¸Šä¸‹æ–‡å±‚æ¬¡ç»“æ„</h4><p><code>DispatcherServlet</code>éœ€è¦ä¸€ä¸ª <code>WebApplicationContext</code>ï¼ˆApplicationContextçš„æ‰©å±•ï¼‰æ¥é…ç½®è‡ªå·±ã€‚ <code>WebApplicationContext</code>æœ‰ä¸€ä¸ªæŒ‡å‘<code>ServletContext</code>çš„é“¾æ¥ä»¥åŠä¸ä¹‹å…³è”çš„ <code>Servlet</code>ã€‚ å®ƒè¿˜ç»‘å®šåˆ°<code>ServletContext</code>ï¼Œå½“éœ€è¦è®¿é—®å®ƒæ—¶ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨<code>RequestContextUtils</code>ä¸Šçš„é™æ€æ–¹æ³•æ¥æŸ¥æ‰¾<code>WebApplicationContext</code>ã€‚</p><p>å¯¹äºè®¸å¤šåº”ç”¨ç¨‹åºï¼Œæ‹¥æœ‰ä¸€ä¸ªç®€å•çš„ <code>WebApplicationContext</code>å·²ç»è¶³å¤Ÿäº†ã€‚å®ƒä¹Ÿæœ‰ä¸€ä¸ªä¸Šä¸‹æ–‡å±‚æ¬¡ç»“æ„ï¼Œå…¶ä¸­æ ¹<code>WebApplicationContext</code>åœ¨å¤šä¸ª <code>DispatcherServlet</code>ï¼ˆæˆ–å…¶ä»– <code>Servlet</code>ï¼‰å®ä¾‹ä¹‹é—´å…±äº«ï¼Œ æ¯ä¸ªå®ä¾‹éƒ½æœ‰è‡ªå·±çš„å­<code>WebApplicationContext</code>é…ç½®ã€‚ æœ‰å…³ä¸Šä¸‹æ–‡å±‚æ¬¡ç»“æ„åŠŸèƒ½çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/core.html#context-introduction"><code>ApplicationContext</code>çš„å…¶ä»–åŠŸèƒ½</a>ã€‚</p><p>æ ¹WebApplicationContexté€šå¸¸åŒ…å«beanåŸºç¡€ç»“æ„ï¼Œä¾‹å¦‚éœ€è¦è·¨å¤šä¸ªServletå®ä¾‹å…±äº«çš„æ•°æ®å­˜å‚¨åº“å’Œä¸šåŠ¡æœåŠ¡ã€‚ è¿™äº›beanè¢«æœ‰æ•ˆç»§æ‰¿ï¼Œå¯ä»¥åœ¨ç‰¹å®šäº <code>Servlet</code>çš„å­<code>WebApplicationContext</code>ä¸­é‡å†™ï¼ˆå³é‡æ–°å£°æ˜ï¼‰ï¼Œå®ƒé€šå¸¸åŒ…å«ç»™å®š<code>Servlet</code>æœ¬åœ°çš„beanã€‚ ä¸‹å›¾æ˜¾ç¤ºäº†è¿™ç§å…³ç³»ï¼š</p><p>![mvc context hierarchy](Web MVC&#x2F;mvc-context-hierarchy.png)</p><p>ä»¥ä¸‹ç¤ºä¾‹é…ç½®<code>WebApplicationContext</code>å±‚æ¬¡ç»“æ„:</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs scala">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyWebAppInitializer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractAnnotationConfigDispatcherServletInitializer</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span>    <span class="hljs-keyword">protected</span> <span class="hljs-type">Class</span>&lt;?&gt;[] getRootConfigClasses() &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-type">Class</span>&lt;?&gt;[] &#123; <span class="hljs-type">RootConfig</span>.<span class="hljs-keyword">class</span> &#125;;    &#125;<br>    <span class="hljs-meta">@Override</span>    <span class="hljs-keyword">protected</span> <span class="hljs-type">Class</span>&lt;?&gt;[] getServletConfigClasses() &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-type">Class</span>&lt;?&gt;[] &#123; <span class="hljs-type">App1Config</span>.<span class="hljs-keyword">class</span> &#125;;    &#125;<br>    <span class="hljs-meta">@Override</span>    <span class="hljs-keyword">protected</span> <span class="hljs-type">String</span>[] getServletMappings() &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-type">String</span>[] &#123; <span class="hljs-string">&quot;/app1/*&quot;</span> &#125;;    &#125;&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœä¸éœ€è¦åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡å±‚æ¬¡ç»“æ„ï¼Œåˆ™åº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡<code>getRootConfigClasses()</code> è¿”å›æ‰€æœ‰é…ç½®ï¼Œå¹¶ä»<code>getServletConfigClasses()</code>è¿”å›<code>null</code>ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†<code>web.xml</code>é…ç½®ï¼ˆå’Œä¸Šé¢æ•ˆæœä¸€æ ·ï¼‰:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">web-app</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">listener</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="hljs-tag">&lt;/<span class="hljs-name">listener-class</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">listener</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">context-param</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>contextConfigLocation<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>/WEB-INF/root-context.xml<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">context-param</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>app1<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>contextConfigLocation<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>/WEB-INF/app1-context.xml<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">load-on-startup</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">load-on-startup</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>app1<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/app1/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">web-app</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å¦‚æœä¸éœ€è¦åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡å±‚æ¬¡ç»“æ„ï¼Œåˆ™åº”ç”¨ç¨‹åºå¯ä»¥ä»…é…ç½®â€œrootâ€ä¸Šä¸‹æ–‡ï¼Œå¹¶å°† <code>contextConfigLocation</code> Servletå‚æ•°ä¿ç•™ä¸ºç©ºã€‚</p><h4 id="1-1-2-ç‰¹æ®Šçš„Beanç±»å‹"><a href="#1-1-2-ç‰¹æ®Šçš„Beanç±»å‹" class="headerlink" title="1.1.2. ç‰¹æ®Šçš„Beanç±»å‹"></a>1.1.2. ç‰¹æ®Šçš„Beanç±»å‹</h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-special-bean-types">Same as in Spring WebFlux</a></p><p><code>DispatcherServlet</code> å§”æ‰˜ç‰¹æ®Šbeanå¤„ç†è¯·æ±‚å¹¶æ¸²æŸ“è§†å›¾ã€‚ â€œç‰¹æ®Šbeanâ€æ˜¯æŒ‡å®ç°WebFluxæ¡†æ¶çš„Springç®¡ç†çš„<code>Object</code>å®ä¾‹ã€‚ è¿™äº›é€šå¸¸å¸¦æœ‰å†…ç½®è”ç³»ï¼Œä½†æ‚¨å¯ä»¥è‡ªå®šä¹‰å…¶å±æ€§å¹¶æ‰©å±•æˆ–æ›¿æ¢å®ƒä»¬ã€‚</p><p>ä¸‹è¡¨åˆ—å‡ºäº†<code>DispatcherHandler</code>æ£€æµ‹åˆ°çš„ç‰¹æ®Šbean:</p><table><thead><tr><th>Bean ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>HandlerMapping</code></td><td>å°†è¯·æ±‚æ˜ å°„åˆ°å¤„ç†ç¨‹åºä»¥åŠç”¨äºé¢„å¤„ç†å’Œåå¤„ç†çš„<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-handlermapping-interceptor">æ‹¦æˆªå™¨</a>åˆ—è¡¨ã€‚ å…¶æ˜ å°„è§„åˆ™åŸºäºæŸäº›æ ‡å‡†ï¼Œå…¶ç»†èŠ‚å› <code>HandlerMapping</code>å®ç°è€Œå¼‚ã€‚ä¸¤ä¸ªä¸»è¦çš„<code>HandlerMapping</code>å®ç°æ˜¯<code>RequestMappingHandlerMapping</code>ï¼ˆå®ƒæ”¯æŒ<code>@RequestMapping</code>å¸¦æ³¨è§£çš„æ–¹æ³•ï¼‰ å’Œ<code>SimpleUrlHandlerMapping</code> ï¼ˆå®ƒç»´æŠ¤å¯¹å¤„ç†ç¨‹åºçš„URIè·¯å¾„æ¨¡å¼çš„æ˜¾å¼æ³¨å†Œï¼‰ã€‚</td></tr><tr><td><code>HandlerAdapter</code></td><td>æ— è®ºå®é™…è°ƒç”¨å¤„ç†ç¨‹åºå¦‚ä½•ï¼Œéƒ½å¯ä»¥å¸®åŠ©<code>DispatcherServlet</code> è°ƒç”¨æ˜ å°„åˆ°è¯·æ±‚çš„å¤„ç†ç¨‹åºã€‚ ä¾‹å¦‚ï¼Œè°ƒç”¨å¸¦æœ‰æ³¨è§£çš„æ§åˆ¶å™¨ï¼Œéœ€è¦ä»æ³¨è§£ä¸­è§£æä¸€äº›ä¿¡æ¯ã€‚ <code>HandlerAdapter</code>çš„ä¸»è¦ç›®çš„æ˜¯ä¿æŠ¤<code>DispatcherServlet</code>ä¸å—æ­¤ç±»ç»†èŠ‚çš„å½±å“ã€‚</td></tr><tr><td><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-exceptionhandlers"><code>HandlerExceptionResolver</code></a></td><td>è§£å†³å¼‚å¸¸çš„ç­–ç•¥ï¼Œä»–å¯ä»¥å°†æ•è·åˆ°çš„å¼‚å¸¸æ˜ å°„åˆ°å¤„ç†ç¨‹åºï¼ŒHTMLé”™è¯¯è§†å›¾æˆ–å…¶ä»–ç›®æ ‡ã€‚ è¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-exceptionhandlers">Exceptions</a>ã€‚</td></tr><tr><td><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-viewresolver"><code>ViewResolver</code></a></td><td>å°†ä»å¤„ç†ç¨‹åºè¿”å›çš„é€»è¾‘åŸºäº<code>String</code>çš„è§†å›¾åç§°è§£æä¸ºç”¨äºå‘ˆç°ç»™å“åº”çš„å®é™…<code>View</code>ã€‚ è¯·å‚é˜… <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-viewresolver">View Resolution</a> and <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-view">View Technologies</a>ã€‚</td></tr><tr><td><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-localeresolver"><code>LocaleResolver</code></a>, <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-timezone">LocaleContextResolver</a></td><td>è§£æå®¢æˆ·ç«¯æ­£åœ¨ä½¿ç”¨çš„ <code>Locale</code>ä»¥åŠå¯èƒ½çš„æ—¶åŒºï¼Œä»¥ä¾¿èƒ½å¤Ÿæä¾›å›½é™…åŒ–è§†å›¾ã€‚ è¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-localeresolver">Locale</a>ã€‚</td></tr><tr><td><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-themeresolver"><code>ThemeResolver</code></a></td><td>è§£å†³Webåº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨çš„ä¸»é¢˜ - ä¾‹å¦‚ï¼Œæä¾›ä¸ªæ€§åŒ–å¸ƒå±€ã€‚ è§<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-themeresolver">Themes</a>ã€‚</td></tr><tr><td><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-multipart"><code>MultipartResolver</code></a></td><td>è§£æmulti-partçš„è¯·æ±‚ï¼ˆä¾‹å¦‚ï¼šæµè§ˆå™¨è¡¨å•æ–‡ä»¶ä¸Šè½½ï¼‰ã€‚è¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-multipart">Multipart Resolver</a>ã€‚</td></tr><tr><td><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-flash-attributes"><code>FlashMapManager</code></a></td><td>å­˜å‚¨å’Œæ£€ç´¢â€œinputâ€ å’Œâ€œoutputâ€<code>FlashMap</code>ï¼Œå¯ç”¨äºå°†å±æ€§ä»ä¸€ä¸ªè¯·æ±‚ä¼ é€’åˆ°å¦ä¸€ä¸ªè¯·æ±‚ï¼Œé€šå¸¸æ˜¯é€šè¿‡é‡å®šå‘ã€‚ è¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-flash-attributes">Flash Attributes</a>ã€‚</td></tr></tbody></table><h4 id="1-1-3-Web-MVC-é…ç½®"><a href="#1-1-3-Web-MVC-é…ç½®" class="headerlink" title="1.1.3. Web MVC é…ç½®"></a>1.1.3. Web MVC é…ç½®</h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-framework-config">Same as in Spring WebFlux</a></p><p>å¯¹äºæ¯ç§ç±»å‹çš„<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-servlet-special-bean-types">ç‰¹æ®Šbean</a>ï¼Œ <code>DispatcherServlet</code>é¦–å…ˆä¼šæ£€æŸ¥<code>WebApplicationContext</code>ã€‚å¦‚æœæ²¡æœ‰åŒ¹é…çš„beanç±»å‹ï¼Œåˆ™ä¼šé€€å›æ£€æŸ¥<a href="https://github.com/spring-projects/spring-framework/blob/master/spring-webmvc/src/main/resources/org/springframework/web/servlet/DispatcherServlet.properties"><code>DispatcherServlet.properties</code></a>ã€‚</p><p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œ<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-config">MVC Config</a>æ˜¯æœ€ä½³èµ·ç‚¹ã€‚ å®ƒä»¥Javaæˆ–XMLå£°æ˜æ‰€éœ€çš„beanï¼Œå¹¶æä¾›æ›´é«˜çº§åˆ«çš„é…ç½®å›è°ƒAPIæ¥è‡ªå®šä¹‰å®ƒã€‚</p><p>Spring Bootä¾èµ–äºMVC Javaé…ç½®æ¥é…ç½®Spring MVCå¹¶æä¾›è®¸å¤šé¢å¤–çš„ä¾¿æ·é€‰é¡¹ã€‚</p><h4 id="1-1-4-Servlet-é…ç½®"><a href="#1-1-4-Servlet-é…ç½®" class="headerlink" title="1.1.4. Servlet é…ç½®"></a>1.1.4. Servlet é…ç½®</h4><p>åœ¨Servlet 3.0+ç¯å¢ƒä¸­ï¼Œæ‚¨å¯ä»¥é€‰æ‹©ä»¥ç¼–ç¨‹æ–¹å¼é…ç½®Servletå®¹å™¨ä½œä¸ºæ›¿ä»£æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥ä¸<code>web.xml</code>æ–‡ä»¶ç»“åˆä½¿ç”¨ã€‚ ä»¥ä¸‹ç¤ºä¾‹æ³¨å†Œ<code>DispatcherServlet</code>:</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-keyword">import</span> org.springframework.web.WebApplicationInitializer;<br><span class="hljs-keyword">public</span> <span class="hljs-title class_"><span class="hljs-keyword">class</span> <span class="hljs-title">MyWebApplicationInitializer</span> <span class="hljs-keyword"><span class="hljs-keyword">implements</span> <span class="hljs-type">WebApplicationInitializer</span></span> </span>&#123;<br>    <span class="hljs-meta">@Override    public void onStartup</span>(ServletContext container) &#123;        XmlWebApplicationContext appContext = <span class="hljs-keyword">new</span> <span class="hljs-type">XmlWebApplicationContext</span>();        appContext.setConfigLocation(<span class="hljs-string">&quot;/WEB-INF/spring/dispatcher-config.xml&quot;</span>);<br>        ServletRegistration.<span class="hljs-keyword">Dynamic</span> registration = container.addServlet(<span class="hljs-string">&quot;dispatcher&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-type">DispatcherServlet</span>(appContext));        registration.setLoadOnStartup(<span class="hljs-number">1</span>);        registration.addMapping(<span class="hljs-string">&quot;/&quot;</span>);    &#125;&#125;<br></code></pre></td></tr></table></figure><p><code>WebApplicationInitializer</code>æ˜¯Spring MVCæä¾›çš„ä¸€ä¸ªæ¥å£ï¼Œå®ç°æ­¤æ¥å£çš„ä»»ä½•Servlet 3å®¹å™¨éƒ½å¯è¢«æ£€æµ‹åˆ°å¹¶è‡ªåŠ¨åˆå§‹åŒ–ã€‚ <code>AbstractDispatcherServletInitializer</code>æŠ½è±¡ç±»å®ç°äº†<code>WebApplicationInitializer</code>æ¥å£ï¼Œé€šè¿‡é‡å†™æ–¹æ³•æ¥æŒ‡å®šservletæ˜ å°„å’Œ<code>DispatcherServlet</code> é…ç½®çš„åœ°å€ï¼Œ ä»è€Œæ›´æ–¹ä¾¿çš„æ³¨å†Œ<code>DispatcherServlet</code>ã€‚</p><p>å¯¹äºä½¿ç”¨åŸºäºJavaçš„Springé…ç½®çš„åº”ç”¨ç¨‹åºï¼Œå»ºè®®ä½¿ç”¨æ­¤æ–¹æ³•ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs scala">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyWebAppInitializer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractAnnotationConfigDispatcherServletInitializer</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span>    <span class="hljs-keyword">protected</span> <span class="hljs-type">Class</span>&lt;?&gt;[] getRootConfigClasses() &#123;        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;    &#125;<br>    <span class="hljs-meta">@Override</span>    <span class="hljs-keyword">protected</span> <span class="hljs-type">Class</span>&lt;?&gt;[] getServletConfigClasses() &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-type">Class</span>&lt;?&gt;[] &#123; <span class="hljs-type">MyWebConfig</span>.<span class="hljs-keyword">class</span> &#125;;    &#125;<br>    <span class="hljs-meta">@Override</span>    <span class="hljs-keyword">protected</span> <span class="hljs-type">String</span>[] getServletMappings() &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-type">String</span>[] &#123; <span class="hljs-string">&quot;/&quot;</span> &#125;;    &#125;&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœä½¿ç”¨åŸºäºXMLçš„Springé…ç½®ï¼Œåˆ™åº”ç›´æ¥ä»<code>AbstractDispatcherServletInitializer</code>æ‰©å±•ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs scala">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyWebAppInitializer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractDispatcherServletInitializer</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span>    <span class="hljs-keyword">protected</span> <span class="hljs-type">WebApplicationContext</span> createRootApplicationContext() &#123;        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;    &#125;<br>    <span class="hljs-meta">@Override</span>    <span class="hljs-keyword">protected</span> <span class="hljs-type">WebApplicationContext</span> createServletApplicationContext() &#123;        <span class="hljs-type">XmlWebApplicationContext</span> cxt = <span class="hljs-keyword">new</span> <span class="hljs-type">XmlWebApplicationContext</span>();        cxt.setConfigLocation(<span class="hljs-string">&quot;/WEB-INF/spring/dispatcher-config.xml&quot;</span>);        <span class="hljs-keyword">return</span> cxt;    &#125;<br>    <span class="hljs-meta">@Override</span>    <span class="hljs-keyword">protected</span> <span class="hljs-type">String</span>[] getServletMappings() &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-type">String</span>[] &#123; <span class="hljs-string">&quot;/&quot;</span> &#125;;    &#125;&#125;<br></code></pre></td></tr></table></figure><p><code>AbstractDispatcherServletInitializer</code>è¿˜æä¾›äº†ä¸€ç§ä¾¿æ·çš„æ–¹æ³•æ¥æ·»åŠ <code>Filter</code>å®ä¾‹å¹¶å°†å®ƒä»¬è‡ªåŠ¨æ˜ å°„åˆ°DispatcherServletï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs scala">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyWebAppInitializer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractDispatcherServletInitializer</span> </span>&#123;<br>    <span class="hljs-comment">// ...</span><br>    <span class="hljs-meta">@Override</span>    <span class="hljs-keyword">protected</span> <span class="hljs-type">Filter</span>[] getServletFilters() &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-type">Filter</span>[] &#123;            <span class="hljs-keyword">new</span> <span class="hljs-type">HiddenHttpMethodFilter</span>(), <span class="hljs-keyword">new</span> <span class="hljs-type">CharacterEncodingFilter</span>() &#125;;    &#125;&#125;<br></code></pre></td></tr></table></figure><p>æ¯ä¸ªè¿‡æ»¤å™¨éƒ½æ ¹æ®å…¶å…·ä½“ç±»å‹æ·»åŠ é»˜è®¤åç§°ï¼Œå¹¶è‡ªåŠ¨æ˜ å°„åˆ°<code>DispatcherServlet</code>ã€‚</p><p><code>AbstractDispatcherServletInitializer</code>çš„protectedæ–¹æ³•<code>isAsyncSupported</code>æä¾›äº†ä¸€ä¸ªå•ç‹¬çš„åœ°å€æ¥å¯ç”¨<code>DispatcherServlet</code> ä¸Šçš„å¼‚æ­¥æ”¯æŒä»¥åŠæ˜ å°„åˆ°å®ƒçš„æ‰€æœ‰è¿‡æ»¤å™¨ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤æ ‡å¿—è®¾ç½®ä¸º<code>true</code>ã€‚</p><p>æœ€åï¼Œå¦‚æœæ‚¨éœ€è¦è¿›ä¸€æ­¥è‡ªå®šä¹‰<code>DispatcherServlet</code>æœ¬èº«ï¼Œåˆ™å¯ä»¥è¦†ç›–<code>createDispatcherServlet</code>æ–¹æ³•ã€‚</p><h4 id="1-1-5-å¤„ç†æµç¨‹"><a href="#1-1-5-å¤„ç†æµç¨‹" class="headerlink" title="1.1.5. å¤„ç†æµç¨‹"></a>1.1.5. å¤„ç†æµç¨‹</h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-dispatcher-handler-sequence">Same as in Spring WebFlux</a></p><p><code>DispatcherServlet</code>æŒ‰å¦‚ä¸‹æ–¹å¼å¤„ç†è¯·æ±‚ï¼š</p><ul><li>é¦–å…ˆï¼Œæœç´¢åº”ç”¨çš„ä¸Šä¸‹æ–‡å¯¹è±¡<code>WebApplicationContext</code>ï¼Œå¹¶æŠŠå®ƒä½œä¸ºä¸€ä¸ªå±æ€§ï¼ˆattribute)ç»‘å®šåˆ°è¯¥è¯·æ±‚ä¸Šã€‚ä»¥ä¾¿è®©æ§åˆ¶å™¨å’Œå…¶ä»–ç»„ä»¶èƒ½ä½¿ç”¨å®ƒã€‚ å±æ€§çš„é”®åé»˜è®¤ä¸º<code>DispatcherServlet.WEB_APPLICATION_CONTEXT_ATTRIBUTE</code>ã€‚</li><li>å°†locale resolverç»‘å®šåˆ°è¯·æ±‚ä¸Šï¼Œå¹¶å…è®¸å…¶ä»–ç»„ä»¶è§£æå¤„ç†è¯·æ±‚æ—¶ä½¿ç”¨çš„è¯­è¨€ç¯å¢ƒï¼ˆæ¸²æŸ“è§†å›¾ï¼Œå‡†å¤‡æ•°æ®ç­‰ï¼‰ã€‚ å¦‚æœæ‚¨ä¸éœ€è¦åŒºåŸŸè§£æï¼Œåˆ™ä¸éœ€è¦locale resolverã€‚</li><li>å°†theme resolver ç»‘å®šåˆ°è¯·æ±‚ï¼Œä»¥å…è®¸è§†å›¾ç­‰ç»„ä»¶ç¡®å®šè¦ä½¿ç”¨çš„themesã€‚ å¦‚æœæ‚¨ä¸ä½¿ç”¨themesï¼Œåˆ™å¯ä»¥å¿½ç•¥å®ƒã€‚</li><li>å¦‚æœæŒ‡å®šmultipart æ–‡ä»¶å¤„ç†å™¨ï¼Œåˆ™ä¼šæ£€æŸ¥è¯·æ±‚çš„æ–‡ä»¶æ˜¯ä¸æ˜¯multipartsçš„ï¼Œ å¦‚æœæ˜¯ï¼Œè¯·æ±‚å°†åŒ…è£…åœ¨<code>MultipartHttpServletRequest</code>ä¸­ï¼Œ ä»¥ä¾¿å…¶ä»–ç»„ä»¶è¿›ä¸€æ­¥å¤„ç†ã€‚ æœ‰å…³<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-multipart">Multipart Resolver</a>çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-multipart">Multipart Resolver</a>ã€‚</li><li>ä¸ºè¯¥è¯·æ±‚æŸ¥æ‰¾ä¸€ä¸ªåˆé€‚çš„å¤„ç†å™¨ã€‚ å¦‚æœæ‰¾åˆ°å¤„ç†ç¨‹åºï¼Œåˆ™ä¸è¯¥å¤„ç†å™¨å…³è”çš„æ•´æ¡æ‰§è¡Œé“¾ï¼ˆå‰å¤„ç†å™¨ã€åå¤„ç†å™¨ã€æ§åˆ¶å™¨ç­‰ï¼‰éƒ½ä¼šè¢«æ‰§è¡Œï¼Œä»¥å®Œæˆç›¸åº”æ¨¡å‹çš„å‡†å¤‡æˆ–è§†å›¾çš„æ¸²æŸ“ã€‚ æˆ–è€…ï¼Œå¯¹äºå¸¦æ³¨è§£çš„æ§åˆ¶å™¨ï¼Œå¯ä»¥æ˜¾ç¤ºå“åº”ï¼ˆåœ¨ <code>HandlerAdapter</code>ä¸­ï¼‰è€Œä¸æ˜¯è¿”å›è§†å›¾ã€‚</li><li>å¦‚æœå¤„ç†å™¨è¿”å›æ¨¡å‹ï¼Œåˆ™æ¸²æŸ“è§†å›¾ã€‚ å¦‚æœæ²¡æœ‰è¿”å›æ¨¡å‹ï¼ˆå¯èƒ½æ˜¯ç”±äºå‰å¤„ç†å™¨æˆ–åå¤„ç†å™¨æ‹¦æˆªè¯·æ±‚ï¼Œå¯èƒ½æ˜¯å‡ºäºå®‰å…¨åŸå› ï¼‰ï¼Œåˆ™ä¸ä¼šæ¸²æŸ“ä»»ä½•è§†å›¾ï¼Œå› ä¸ºè¯¥è¯·æ±‚å¯èƒ½å·²ç»å®Œæˆã€‚</li></ul><p>åœ¨ <code>WebApplicationContext</code> ä¸­å£°æ˜çš„<code>HandlerExceptionResolver</code>ç”¨äºè§£å†³è¯·æ±‚å¤„ç†è¿‡ç¨‹ä¸­å¼•å‘çš„å¼‚å¸¸ã€‚è¿™äº›å¼‚å¸¸è§£æç¨‹åºå…è®¸ä½¿ç”¨è‡ªå®šä¹‰çš„é€»è¾‘æ¥è§£å†³ï¼Œæœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-exceptionhandlers">Exceptions</a> ã€‚</p><p>Springçš„ <code>DispatcherServlet</code>ä¹Ÿå…è®¸å¤„ç†å™¨è¿”å›Servlet APIè§„èŒƒä¸­å®šä¹‰çš„æœ€åä¿®æ”¹æ—¶é—´æˆ³ï¼ˆ<code>last-modification-date</code>ï¼‰å€¼ã€‚ç¡®å®šè¯·æ±‚æœ€åä¿®æ”¹æ—¶é—´çš„æ–¹å¼æ˜¯ç›´æˆªäº†å½“çš„ï¼š <code>DispatcherServlet</code>ä¼šå…ˆæŸ¥æ‰¾åˆé€‚çš„å¤„ç†æ˜ å°„æ¥æ‰¾åˆ°è¯·æ±‚å¯¹åº”çš„å¤„ç†å™¨ï¼Œç„¶åæ£€æµ‹å®ƒæ˜¯å¦å®ç°äº† <code>LastModified</code> æ¥å£ã€‚å¦‚æœæ˜¯çš„è¯ï¼Œåˆ™è°ƒç”¨æ¥å£çš„<code>long getLastModified(request)</code>æ–¹æ³•ï¼Œå¹¶å°†è¿”å›çš„å€¼ä¼ å›ç»™å®¢æˆ·ç«¯ã€‚</p><p>æ‚¨å¯ä»¥è‡ªå®šä¹‰é€šè¿‡<code>DispatcherServlet</code>çš„é…ç½®ã€‚å¯ä»¥åœ¨<code>web.xml</code>æ–‡ä»¶ä¸­ï¼Œå£°æ˜å…ƒç´ Servletçš„ä¸Šæ·»åŠ Servletçš„åˆå§‹åŒ–å‚æ•°ï¼ˆ<code>init-param</code>å…ƒç´ ï¼‰ã€‚ ä¸‹è¡¨åˆ—å‡ºäº†æ”¯æŒçš„å‚æ•°ï¼š</p><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>contextClass</code></td><td>å®ç°<code>ConfigurableWebApplicationContext</code>çš„ç±»ï¼Œç”±æ­¤ç±»é€šè¿‡æœ¬åœ°é…ç½®æ¥åˆå§‹åŒ– Servletå®ä¾‹ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨<code>XmlWebApplicationContext</code>ã€‚</td></tr><tr><td><code>contextConfigLocation</code></td><td>ä¸€ä¸ªæŒ‡å®šäº†ä¸Šä¸‹æ–‡é…ç½®æ–‡ä»¶è·¯å¾„çš„å­—ç¬¦ä¸²ï¼Œå¹¶ä¼ é€’ç»™ä¸Šä¸‹æ–‡å®ä¾‹ï¼ˆç”±<code>contextClass</code>æŒ‡å®šï¼‰ ã€‚è¯¥å­—ç¬¦ä¸²å¯èƒ½åŒ…å«å¤šä¸ªå­—ç¬¦ä¸²ï¼ˆä½¿ç”¨é€—å·ä½œä¸ºåˆ†éš”ç¬¦ï¼‰ä»¥æ”¯æŒå¤šä¸ªä¸Šä¸‹æ–‡ã€‚ å¯¹äºå…·æœ‰ä¸¤æ¬¡å®šä¹‰çš„beançš„å¤šä¸ªä¸Šä¸‹æ–‡ä½ç½®ï¼Œæœ€æ–°ä½ç½®ä¼˜å…ˆï¼ˆå³æœ€ååŠ è½½çš„ä¸ºå‡†ï¼‰ã€‚</td></tr><tr><td><code>namespace</code></td><td><code>WebApplicationContext</code>çš„å‘½åç©ºé—´ã€‚ é»˜è®¤ä¸º<code>[servlet-name]-servlet</code>ã€‚</td></tr><tr><td><code>throwExceptionIfNoHandlerFound</code></td><td>å½“æ²¡æœ‰æ‰¾åˆ°è¯·æ±‚çš„å¤„ç†ç¨‹åºæ—¶æ˜¯å¦æŠ›å‡º <code>NoHandlerFoundException</code>ã€‚ ç„¶åå¯ä»¥ä½¿ç”¨ <code>HandlerExceptionResolver</code>æ•è·å¼‚å¸¸ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨<code>@ExceptionHandler</code>æ§åˆ¶å™¨æ–¹æ³•ï¼‰å¹¶åƒå¤„ç†å…¶ä»–ä»»ä½•æ–¹æ³•ä¸€æ ·å¤„ç†å¼‚å¸¸ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤å‚æ•°è®¾ç½®ä¸º <code>false</code>ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>DispatcherServlet</code>å°†å“åº”çŠ¶æ€è®¾ç½®ä¸º404ï¼ˆNOT_FOUNDï¼‰ï¼Œè€Œä¸ä¼šå¼•å‘å¼‚å¸¸ã€‚è¯·æ³¨æ„ï¼Œå¦‚æœé…ç½®äº† <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-default-servlet-handler">é»˜è®¤servletå¤„ç†</a> ï¼Œåˆ™å§‹ç»ˆå°†æœªè§£æçš„è¯·æ±‚è½¬å‘åˆ°é»˜è®¤servletï¼Œå¹¶ä¸”æ°¸è¿œä¸ä¼šå¼•å‘404ã€‚</td></tr></tbody></table><h4 id="1-1-6-Interception"><a href="#1-1-6-Interception" class="headerlink" title="1.1.6. Interception"></a>1.1.6. Interception</h4><p>Springçš„å¤„ç†å™¨æ˜ å°„æœºåˆ¶åŒ…å«äº†å¤„ç†å™¨æ‹¦æˆªå™¨ï¼Œï¼Œå¯ä»¥å®ç° <code>HandlerMapping</code>ï¼Œæ‰€æœ‰ <code>HandlerMapping</code>å®ç°éƒ½æ”¯æŒå¤„ç†æ‹¦æˆªå™¨ï¼Œè¿™äº›æ‹¦æˆªå™¨åœ¨éœ€è¦ä¸ºç‰¹å®šç±»å‹çš„è¯·æ±‚åº”ç”¨ä¸€äº›åŠŸèƒ½æ—¶å¯èƒ½å¾ˆæœ‰ç”¨éå¸¸æœ‰ç”¨ï¼Œ ä¾‹å¦‚ï¼Œæ£€æŸ¥ç”¨æˆ·èº«ä»½ç­‰ï¼Œ<code>org.springframework.web.servlet</code>åŒ…ä¸­çš„ <code>HandlerInterceptor</code>å®ç°äº†ä¸‰ç§æ–¹æ³•ï¼Œæä¾›è¶³å¤Ÿçš„çµæ´»æ€§æ¥æ‰§è¡Œå„ç§é¢„å¤„ç†å’Œåå¤„ç†ï¼š</p><ul><li><code>preHandle(..)</code>: åœ¨æ‰§è¡Œå®é™…å¤„ç†ç¨‹åºä¹‹å‰</li><li><code>postHandle(..)</code>: åœ¨æ‰§è¡Œå®é™…å¤„ç†ç¨‹åºä¹‹å</li><li><code>afterCompletion(..)</code>: å®Œæˆè¯·æ±‚å</li></ul><p><code>preHandle(..)</code> æ–¹æ³•è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨æ­¤æ–¹æ³•æ¥ä¸­æ–­æˆ–ç»§ç»­æ‰§è¡Œé“¾çš„å¤„ç†ã€‚ å½“æ­¤æ–¹æ³•è¿”å› <code>true</code>æ—¶ï¼Œå¤„ç†ç¨‹åºæ‰§è¡Œé“¾ç»§ç»­ã€‚ å½“å®ƒè¿”å›falseæ—¶ï¼Œ<code>DispatcherServlet</code>å‡å®šæ‹¦æˆªå™¨æœ¬èº«å·²å¤„ç†è¯·æ±‚ï¼ˆä¾‹å¦‚ï¼Œå‘ˆç°é€‚å½“çš„è§†å›¾ï¼‰å¹¶ä¸”ä¸ç»§ç»­æ‰§è¡Œæ‰§è¡Œé“¾ä¸­çš„å…¶ä»–æ‹¦æˆªå™¨å’Œå®é™…å¤„ç†ç¨‹åºã€‚</p><p>æœ‰å…³å¦‚ä½•é…ç½®<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-config-interceptors">Interceptors</a> çš„ç¤ºä¾‹ï¼Œè¯·å‚é˜…MVCé…ç½®ä¸€èŠ‚ä¸­çš„æ‹¦æˆªå™¨ã€‚ æ‚¨è¿˜å¯ä»¥ä½¿ç”¨å„ä¸ª <code>HandlerMapping</code>å®ç°ä¸Šçš„setteræ–¹æ³•ç›´æ¥æ³¨å†Œå®ƒä»¬ã€‚</p><p>è¯·æ³¨æ„ï¼Œåœ¨HandlerAdapterå’ŒpostHandleä¹‹å‰ï¼Œå“åº”è¢«å†™å…¥å¹¶æäº¤ã€‚ <code>postHandle</code>å¯¹äº<code>@ResponseBody</code>å’ŒResponseEntityæ–¹æ³•ä¸å¤ªæœ‰ç”¨ï¼Œ è¿™æ„å‘³ç€å¯¹å“åº”è¿›è¡Œä»»ä½•æ›´æ”¹éƒ½ä¸ºæ—¶å·²æ™šï¼Œä¾‹å¦‚æ·»åŠ é¢å¤–çš„headerã€‚ å¯¹äºæ­¤ç±»æ–¹æ¡ˆï¼Œæ‚¨å¯ä»¥å®ç° <code>ResponseBodyAdvice</code>å¹¶å°†å…¶å£°æ˜ä¸º<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-controller-advice">Controller Advice</a>beanæˆ–ç›´æ¥åœ¨<code>RequestMappingHandlerAdapter</code>ä¸Šè¿›è¡Œé…ç½®ã€‚</p><h4 id="1-1-7-å¼‚å¸¸"><a href="#1-1-7-å¼‚å¸¸" class="headerlink" title="1.1.7. å¼‚å¸¸"></a>1.1.7. å¼‚å¸¸</h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-dispatcher-exceptions">Same as in Spring WebFlux</a></p><p>å¦‚æœåœ¨è¯·æ±‚æ˜ å°„æœŸé—´å‘ç”Ÿå¼‚å¸¸æˆ–ä»è¯·æ±‚å¤„ç†ç¨‹åºï¼ˆä¾‹å¦‚ <code>@Controller</code>ï¼‰æŠ›å‡ºå¼‚å¸¸ï¼Œ åˆ™<code>DispatcherServlet</code>å§”æ‰˜ç»™ <code>HandlerExceptionResolver</code> beanæ¥å¤„ç†å¹¶è§£å†³å¼‚å¸¸ï¼Œè¿™é€šå¸¸æ˜¯é”™è¯¯å“åº”ã€‚</p><p>ä¸‹è¡¨åˆ—å‡ºäº†å¯ç”¨çš„ <code>HandlerExceptionResolver</code> å®ç°ï¼š:</p><p>Table 2. HandlerExceptionResolver å®ç° ï¼š</p><table><thead><tr><th><code>HandlerExceptionResolver</code></th><th>Description</th></tr></thead><tbody><tr><td><code>SimpleMappingExceptionResolver</code></td><td>å¼‚å¸¸ç±»åç§°å’Œé”™è¯¯è§†å›¾åç§°ä¹‹é—´çš„æ˜ å°„ã€‚ ç”¨äºåœ¨æµè§ˆå™¨åº”ç”¨ç¨‹åºä¸­å‘ˆç°é”™è¯¯é¡µé¢ã€‚</td></tr><tr><td><a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/support/DefaultHandlerExceptionResolver.html"><code>DefaultHandlerExceptionResolver</code></a></td><td>è§£å†³Spring MVCå¼•å‘çš„å¼‚å¸¸å¹¶å°†å®ƒä»¬æ˜ å°„åˆ°HTTPçŠ¶æ€ä»£ç ã€‚ å¦è¯·å‚é˜…å¤‡ç”¨<code>ResponseEntityExceptionHandler</code>å’Œ<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-rest-exceptions">REST API exceptions</a>å¼‚å¸¸ã€‚</td></tr><tr><td><code>ResponseStatusExceptionResolver</code></td><td>ä½¿ç”¨<code>@ResponseStatus</code>æ³¨è§£è§£æå¼‚å¸¸ï¼Œå¹¶æ ¹æ®æ³¨è§£ä¸­çš„å€¼å°†å®ƒä»¬æ˜ å°„åˆ°HTTPçŠ¶æ€ä»£ç ã€‚</td></tr><tr><td><code>ExceptionHandlerExceptionResolver</code></td><td>é€šè¿‡åœ¨<code>@Controller</code>æˆ– <code>@ControllerAdvice</code>ç±»ä¸­è°ƒç”¨ <code>@ExceptionHandler</code>æ–¹æ³•æ¥è§£å†³å¼‚å¸¸ã€‚ è¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-exceptionhandler">@ExceptionHandler methods</a>æ–¹æ³•ã€‚</td></tr></tbody></table><h5 id="è§£æé“¾"><a href="#è§£æé“¾" class="headerlink" title="è§£æé“¾"></a>è§£æé“¾</h5><p>æ‚¨å¯ä»¥é€šè¿‡åœ¨Springé…ç½®ä¸­å£°æ˜å¤šä¸ª <code>HandlerExceptionResolver</code> beanå¹¶æ ¹æ®éœ€è¦è®¾ç½®å…¶é¡ºåºå±æ€§æ¥å½¢æˆå¼‚å¸¸è§£æé“¾ã€‚ <code>order</code>å±æ€§è¶Šé«˜ï¼Œå¼‚å¸¸è§£æå™¨å®šä½çš„è¶Šæ™šã€‚</p><p><code>HandlerExceptionResolver</code>çš„çº¦å®šæŒ‡å®šå®ƒå¯ä»¥è¿”å›:</p><ul><li>ä¸€ä¸ªæŒ‡å‘é”™è¯¯è§†å›¾çš„ <code>ModelAndView</code>ã€‚</li><li>å¦‚æœåœ¨è§£æç¨‹åºä¸­å¤„ç†å¼‚å¸¸ï¼Œåˆ™ä¸ºç©ºçš„<code>ModelAndView</code>ã€‚</li><li>å¦‚æœå¼‚å¸¸ä»æœªè§£æï¼Œåˆ™ä¸º <code>null</code>ï¼Œä»¥ä¾›åç»­è§£æå™¨å°è¯•ï¼Œå¦‚æœå¼‚å¸¸ä¿ç•™åœ¨æœ€åï¼Œåˆ™å…è®¸å†’æ³¡åˆ°Servletå®¹å™¨ã€‚.</li></ul><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-config">MVC Config</a>è‡ªåŠ¨å£°æ˜å†…ç½®çš„è§£æå™¨ï¼Œç”¨äºé»˜è®¤çš„Spring MVCå¼‚å¸¸ï¼Œ<code>@ResponseStatus</code> å¸¦æ³¨è§£çš„å¼‚å¸¸ï¼Œä»¥åŠå¯¹<code>@ExceptionHandler</code>æ–¹æ³•çš„æ”¯æŒã€‚ æ‚¨å¯ä»¥è‡ªå®šä¹‰è¯¥åˆ—è¡¨æˆ–æ›¿æ¢å®ƒã€‚</p><h5 id="å®¹å™¨é”™è¯¯é¡µé¢"><a href="#å®¹å™¨é”™è¯¯é¡µé¢" class="headerlink" title="å®¹å™¨é”™è¯¯é¡µé¢"></a>å®¹å™¨é”™è¯¯é¡µé¢</h5><p>å¦‚æœä»»ä½•<code>HandlerExceptionResolver</code>ä»æœªè§£æå¼‚å¸¸ï¼Œå¹¶ä¸”å› æ­¤å°†å…¶ä¼ æ’­ç»™servletå®¹å™¨æˆ–è€…å¦‚æœå“åº”çŠ¶æ€è®¾ç½®ä¸ºé”™è¯¯çŠ¶æ€ï¼ˆå³4xxï¼Œ5xxï¼‰ ï¼Œåˆ™Servletå®¹å™¨å¯ä»¥å‘ˆç°HTMLä¸­çš„é»˜è®¤é”™è¯¯é¡µé¢ã€‚ è¦è‡ªå®šä¹‰å®¹å™¨çš„é»˜è®¤é”™è¯¯é¡µé¢ï¼Œå¯ä»¥åœ¨ <code>web.xml</code>.ä¸­å£°æ˜é”™è¯¯é¡µé¢æ˜ å°„ã€‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œï¼š</p><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sas">&lt;<span class="hljs-keyword">error</span>-<span class="hljs-keyword">page</span>&gt;<br><br>    &lt;location&gt;/<span class="hljs-keyword">error</span>&lt;/location&gt;<br><br>&lt;/<span class="hljs-keyword">error</span>-<span class="hljs-keyword">page</span>&gt;<br></code></pre></td></tr></table></figure><p>æ ¹æ®å‰é¢çš„ç¤ºä¾‹ï¼Œå½“å¼‚å¸¸å†’æ³¡æˆ–å“åº”å…·æœ‰é”™è¯¯çŠ¶æ€æ—¶ï¼ŒServletå®¹å™¨ä¼šåœ¨å®¹å™¨å†…å¯¹é…ç½®çš„URLè¿›è¡ŒERRORè°ƒåº¦ï¼ˆä¾‹å¦‚ï¼Œ<code>/error</code>ï¼‰ã€‚ ç„¶åç”±<code>DispatcherServlet</code>å¤„ç†ï¼Œå¯èƒ½å°†å…¶æ˜ å°„åˆ° <code>@Controller</code>ï¼Œå¯ä»¥å®ç°è¯¥æ§ä»¶ä»¥è¿”å›å¸¦æœ‰æ¨¡å‹çš„é”™è¯¯è§†å›¾åç§°æˆ–å‘ˆç°JSONå“åº”ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livescript">@RestControllerpublic <span class="hljs-keyword">class</span> <span class="hljs-title class_">ErrorController</span> &#123;<br>    @RequestMapping(path = <span class="hljs-string">&quot;/error&quot;</span>)    public <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">Object</span>&gt; handle(HttpServletRequest request) &#123;        <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">Object</span>&gt; <span class="hljs-keyword">map</span> = <span class="hljs-keyword">new</span> HashMap&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">Object</span>&gt;();        <span class="hljs-keyword">map</span>.put(<span class="hljs-string">&quot;status&quot;</span>, request.getAttribute(<span class="hljs-string">&quot;javax.servlet.error.status_code&quot;</span>));        <span class="hljs-keyword">map</span>.put(<span class="hljs-string">&quot;reason&quot;</span>, request.getAttribute(<span class="hljs-string">&quot;javax.servlet.error.message&quot;</span>));        <span class="hljs-keyword">return</span> <span class="hljs-keyword">map</span>;    &#125;&#125;<br></code></pre></td></tr></table></figure><p>Servlet APIæ²¡æœ‰æä¾›åœ¨Javaä¸­åˆ›å»ºé”™è¯¯é¡µé¢æ˜ å°„çš„æ–¹æ³•ã€‚ ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥åŒæ—¶ä½¿ç”¨<code>WebApplicationInitializer</code>å’Œæœ€å°çš„ <code>web.xml</code>ã€‚</p><h4 id="1-1-8-è§†å›¾è§£æ"><a href="#1-1-8-è§†å›¾è§£æ" class="headerlink" title="1.1.8. è§†å›¾è§£æ"></a>1.1.8. è§†å›¾è§£æ</h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-viewresolution">Same as in Spring WebFlux</a></p><p>Spring MVCå®šä¹‰äº† <code>ViewResolver</code>å’Œ <code>View</code>æ¥å£ï¼Œä½¿æ‚¨å¯ä»¥åœ¨æµè§ˆå™¨ä¸­å‘ˆç°æ¨¡å‹ï¼Œè€Œæ— éœ€å°†æ‚¨ä¸ç‰¹å®šçš„è§†å›¾æŠ€æœ¯è”ç³»èµ·æ¥ã€‚ <code>ViewResolver</code>æä¾›è§†å›¾åç§°å’Œå®é™…è§†å›¾ä¹‹é—´çš„æ˜ å°„ã€‚ <code>View</code>æ¥å£è´Ÿè´£å‡†å¤‡è¯·æ±‚ï¼Œå¹¶å°†è¯·æ±‚çš„æ¸²æŸ“äº¤ç»™æŸç§å…·ä½“çš„è§†å›¾æŠ€æœ¯å®ç°ã€‚</p><p>ä¸‹è¡¨æä¾›äº†æœ‰å…³<code>ViewResolver</code>å±‚æ¬¡ç»“æ„çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼š:</p><p>Table 3. ViewResolver å®ç°</p><table><thead><tr><th>ViewResolver</th><th>Description</th></tr></thead><tbody><tr><td><code>AbstractCachingViewResolver</code></td><td><code>AbstractCachingViewResolver</code> çš„å­ç±»ç¼“å­˜å®ƒä»¬è§£æçš„è§†å›¾å®ä¾‹ã€‚ ç¼“å­˜å¯æé«˜æŸäº›è§†å›¾æŠ€æœ¯çš„æ€§èƒ½ã€‚ æ‚¨å¯ä»¥é€šè¿‡å°†<code>cache</code>å±æ€§è®¾ç½®ä¸º <code>false</code>.æ¥å…³é—­ç¼“å­˜ã€‚ æ­¤å¤–ï¼Œå¦‚æœå¿…é¡»åœ¨è¿è¡Œæ—¶åˆ·æ–°æŸä¸ªè§†å›¾ï¼ˆä¾‹å¦‚ï¼Œä¿®æ”¹FreeMarkeræ¨¡æ¿æ—¶ï¼‰ï¼Œåˆ™å¯ä»¥ä½¿ç”¨<code>removeFromCache(String viewName, Locale loc)</code> æ–¹æ³•ã€‚</td></tr><tr><td><code>XmlViewResolver</code></td><td>å®ç°<code>ViewResolver</code>ï¼Œå®ƒå¿…é¡»å’ŒSpringçš„XML beanå·¥å‚æœ‰ç›¸åŒçš„DTDä»¥ã€‚ é»˜è®¤é…ç½®æ–‡ä»¶æ˜¯<code>/WEB-INF/views.xml</code>ã€‚</td></tr><tr><td><code>ResourceBundleViewResolver</code></td><td><code>ViewResolver</code>çš„å®ç°ï¼Œå®ƒä½¿ç”¨ç”±bundleæ ¹è·¯å¾„æŒ‡å®šçš„<code>ResourceBundle</code>ä¸­çš„beanå®šä¹‰ä½œä¸ºé…ç½®ã€‚ å¯¹äºå®ƒåº”è¯¥è§£æçš„æ¯ä¸ªè§†å›¾ï¼Œå®ƒä½¿ç”¨å±æ€§<code>[viewname].(class)</code>çš„å€¼ä½œä¸ºè§†å›¾ç±»ï¼Œ å¹¶ä½¿ç”¨å±æ€§ <code>[viewname].url</code> çš„å€¼ä½œä¸ºè§†å›¾URLã€‚ æ‚¨å¯ä»¥åœ¨ <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-view">è§†å›¾æŠ€æœ¯</a>ä¸€ç« ä¸­æ‰¾åˆ°ç¤ºä¾‹ã€‚</td></tr><tr><td><code>UrlBasedViewResolver</code></td><td><code>ViewResolver</code>æ¥å£çš„ç®€å•å®ç°ï¼Œå®ƒä¸éœ€è¦å…¶ä»–ä»»ä½•æ˜¾å¼çš„æ˜ å°„è¯´æ˜ï¼Œè€Œç›´æ¥ä½¿ç”¨URLæ¥è§£æåˆ°é€»è¾‘è§†å›¾åã€‚ å¦‚æœæ‚¨çš„é€»è¾‘åç§°ä¸çœŸæ­£çš„è§†å›¾èµ„æºçš„åç§°åŒ¹é…ï¼Œåˆ™ä¸éœ€è¦ä»»ä½•æ˜ å°„ã€‚</td></tr><tr><td><code>InternalResourceViewResolver</code></td><td><code>UrlBasedViewResolver</code>çš„ä¾¿æ·å­ç±»ï¼Œæ”¯æŒ <code>InternalResourceView</code>ï¼ˆå®é™…ä¸Šæ˜¯Servletå’ŒJSPï¼‰å’Œå­ç±»ï¼Œå¦‚<code>JstlView</code> å’Œ <code>TilesView</code>ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨<code>setViewClass(..)</code>ä¸ºæ­¤è§£æç¨‹åºç”Ÿæˆçš„æ‰€æœ‰è§†å›¾æŒ‡å®šè§†å›¾ç±»ã€‚ æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/web/reactive/result/view/UrlBasedViewResolver.html"><code>UrlBasedViewResolver</code></a>javadocã€‚</td></tr><tr><td><code>FreeMarkerViewResolver</code></td><td><code>UrlBasedViewResolver</code> çš„ä¾¿æ·å­ç±»ï¼Œæ”¯æŒ <code>FreeMarkerView</code>åŠå…¶è‡ªå®šä¹‰å­ç±»ã€‚</td></tr><tr><td><code>ContentNegotiatingViewResolver</code></td><td>å®ç° <code>ViewResolver</code> æ¥å£ï¼Œè¯¥æ¥å£æ ¹æ®è¯·æ±‚æ–‡ä»¶åæˆ–Acceptå¤´è§£æè§†å›¾ã€‚ è¯·å‚é˜… <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-multiple-representations">Content Negotiation</a>ã€‚</td></tr></tbody></table><h5 id="å¤„ç†"><a href="#å¤„ç†" class="headerlink" title="å¤„ç†"></a>å¤„ç†</h5><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-viewresolution-handling">Same as in Spring WebFlux</a></p><p>æ‚¨å¯ä»¥åœ¨è§†å›¾è§£æå™¨é“¾ä¸­å£°æ˜å¤šä¸ªè§†å›¾è§£æå™¨ï¼Œå¹¶åœ¨å¿…è¦æ—¶é€šè¿‡è®¾ç½® <code>order</code>å±æ€§æ¥æŒ‡å®šæ’åºã€‚ è¯·è®°ä½ï¼Œorderå±æ€§è¶Šé«˜ï¼Œè§†å›¾è§£æå™¨åœ¨é“¾ä¸­çš„ä½ç½®è¶Šæ™šã€‚ .</p><p><code>ViewResolver</code> å¯ä»¥è¿”å›nullä»¥æŒ‡ç¤ºæ— æ³•æ‰¾åˆ°è¯¥è§†å›¾ã€‚ ä½†æ˜¯ï¼Œå¯¹äºJSPå’Œ<code>InternalResourceViewResolver</code>, ç¡®å®šJSPæ˜¯å¦å­˜åœ¨çš„å”¯ä¸€æ–¹æ³•æ˜¯é€šè¿‡<code>RequestDispatcher</code>æ‰§è¡Œè°ƒåº¦ã€‚ å› æ­¤ï¼Œæ‚¨å¿…é¡»å§‹ç»ˆå°†<code>InternalResourceViewResolver</code>é…ç½®ä¸ºè§†å›¾è§£æå™¨çš„æ•´ä½“é¡ºåºä¸­çš„æœ€åä¸€ä¸ªã€‚</p><p>é…ç½®è§†å›¾è§£æå°±åƒå°†<code>ViewResolver</code> beanæ·»åŠ åˆ°Springé…ç½®ä¸€æ ·ç®€å•ã€‚<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-config">MVC Config</a>ä¸º<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-config-view-resolvers">View Resolvers</a>æä¾›ä¸“ç”¨é…ç½®APIï¼Œå¹¶æ·»åŠ æ— é€»è¾‘è§†å›¾æ§åˆ¶å™¨ï¼ˆ<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-config-view-controller">View Controllers</a> ï¼‰ï¼Œè¿™äº›æ§åˆ¶å™¨å¯¹äºæ²¡æœ‰æ§åˆ¶å™¨é€»è¾‘çš„HTMLæ¨¡æ¿æ¸²æŸ“éå¸¸æœ‰ç”¨ã€‚</p><h5 id="é‡å®šå‘"><a href="#é‡å®šå‘" class="headerlink" title="é‡å®šå‘"></a>é‡å®šå‘</h5><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-redirecting-redirect-prefix">Same as in Spring WebFlux</a></p><p>æ‚¨å¯ä»¥åœ¨è§†å›¾ä¸­ä½¿ç”¨<code>redirect:</code>å‰ç¼€æ¥æ‰§è¡Œé‡å®šå‘ã€‚<code>UrlBasedViewResolver</code>ï¼ˆåŠå…¶å­ç±»ï¼‰å°†æ­¤è¯†åˆ«ä¸ºéœ€è¦é‡å®šå‘çš„æŒ‡ä»¤ã€‚ è§†å›¾åç§°çš„å…¶ä½™éƒ¨åˆ†æ˜¯é‡å®šå‘URLã€‚</p><p>æ§åˆ¶å™¨æœ¬èº«å¯ä»¥æ ¹æ®é€»è¾‘è§†å›¾åç§°è¿›è¡Œæ“ä½œã€‚ é€»è¾‘è§†å›¾åç§°ï¼ˆä¾‹å¦‚<code>redirect:/myapp/some/resource</code>ï¼‰ç›¸å¯¹äºå½“å‰Servletä¸Šä¸‹æ–‡é‡å®šå‘ï¼Œè€Œåç§°å¦‚<code>redirect:http://myhost.com/some/arbitrary/path</code>é‡å®šå‘åˆ°ç»å¯¹URLã€‚</p><p>è¯·æ³¨æ„ï¼Œå¦‚æœä½¿ç”¨<code>@ResponseStatus</code>æ³¨è§£æ§åˆ¶å™¨æ–¹æ³•ï¼Œåˆ™æ³¨è§£å€¼ä¼˜å…ˆäº <code>RedirectView</code>è®¾ç½®çš„å“åº”çŠ¶æ€ã€‚</p><h5 id="è½¬å‘"><a href="#è½¬å‘" class="headerlink" title="è½¬å‘"></a>è½¬å‘</h5><p>ä½ ä¹Ÿå¯ä»¥åœ¨è§†å›¾åç§°ä¸­ä½¿ç”¨<code>forward:</code>å‰ç¼€ï¼Œæ¥ä½œä¸º <code>UrlBasedViewResolver</code>å’Œå…¶å­ç±»æœ€ç»ˆè§£æçš„è§†å›¾åç§°ã€‚ è¿™å°†åˆ›å»ºä¸€ä¸ª <code>InternalResourceView</code>ï¼Œå®ƒæ‰§è¡Œ<code>RequestDispatcher.forward()</code>ã€‚ å› æ­¤ï¼Œæ­¤å‰ç¼€å¯¹äº <code>InternalResourceViewResolver</code>å’Œ<code>InternalResourceView</code>ï¼ˆå¯¹äºJSPï¼‰æ²¡æœ‰ç”¨ï¼Œä½†å¦‚æœæ‚¨ä½¿ç”¨å…¶ä»–è§†å›¾æŠ€æœ¯æ—¶ä»å¸Œæœ›å¼ºåˆ¶Servlet&#x2F;JSPå¼•æ“å¤„ç†èµ„æºçš„è½¬å‘ï¼Œåˆ™å®ƒå¯èƒ½ä¼šæœ‰æ‰€å¸®åŠ©ã€‚ è¯·æ³¨æ„ï¼Œæ‚¨ä¹Ÿå¯ä»¥é“¾æ¥å¤šä¸ªè§†å›¾è§£æå™¨ã€‚</p><h5 id="Content-Negotiation"><a href="#Content-Negotiation" class="headerlink" title="Content Negotiation"></a>Content Negotiation</h5><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-multiple-representations">Same as in Spring WebFlux</a></p><p><a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/web/servlet/view/ContentNegotiatingViewResolver.html"><code>ContentNegotiatingViewResolver</code></a>æœ¬èº«ä¸è§£æè§†å›¾ï¼Œè€Œæ˜¯å§”æ‰˜ç»™å…¶ä»–è§†å›¾è§£æå™¨ï¼Œå¹¶é€‰æ‹©ç±»ä¼¼äºå®¢æˆ·ç«¯è¯·æ±‚çš„è¡¨ç¤ºçš„è§†å›¾ã€‚ å¯ä»¥ä»<code>Accept</code>å¤´æˆ–æŸ¥è¯¢å‚æ•°ï¼ˆä¾‹å¦‚ï¼Œ <code>&quot;/path?format=pdf&quot;</code>ï¼‰ç¡®å®šè¡¨ç¤ºã€‚</p><p><code>ContentNegotiatingViewResolver</code>é€šè¿‡å°†è¯·æ±‚çš„åª’ä½“ç±»å‹ä¸å…¶æ¯ä¸ªViewResolverså…³è”çš„Viewæ”¯æŒçš„åª’ä½“ç±»å‹ï¼ˆä¹Ÿç§°ä¸º<code>Content-Type</code>ï¼‰è¿›è¡Œæ¯”è¾ƒï¼Œé€‰æ‹©é€‚å½“çš„ <code>View</code>æ¥å¤„ç†è¯·æ±‚ã€‚åˆ—è¡¨ä¸­å…·æœ‰å…¼å®¹Content-Typeçš„ç¬¬ä¸€ä¸ª<code>View</code>å°†è¡¨ç¤ºè¿”å›ç»™å®¢æˆ·ç«¯ã€‚ å¦‚æœ <code>ViewResolver</code>é“¾æ— æ³•æä¾›å…¼å®¹è§†å›¾ï¼Œåˆ™ä¼šæŸ¥è¯¢é€šè¿‡<code>DefaultViews</code> å±æ€§æŒ‡å®šçš„è§†å›¾åˆ—è¡¨ã€‚ åä¸€ä¸ªé€‰é¡¹é€‚ç”¨äºå•ä¸ªè§†å›¾ï¼Œå®ƒå¯ä»¥å‘ˆç°å½“å‰èµ„æºçš„é€‚å½“è¡¨ç¤ºï¼Œè€Œä¸ç®¡é€»è¾‘è§†å›¾åç§°å¦‚ä½•ã€‚ <code>Accept</code>å¤´å¯ä»¥åŒ…å«é€šé…ç¬¦ï¼ˆä¾‹å¦‚<code>text/*</code>ï¼‰ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>Content-Type</code>ä¸º<code>text/xml</code>çš„Viewæ˜¯å…¼å®¹åŒ¹é…ã€‚</p><p>æœ‰å…³é…ç½®è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-config">MVC Config</a> ä¸‹çš„<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-config-view-resolvers">View Resolvers</a> ã€‚</p><h4 id="1-1-9-Locale"><a href="#1-1-9-Locale" class="headerlink" title="1.1.9. Locale"></a>1.1.9. Locale</h4><p>æ­£å¦‚Spring Web MVCæ¡†æ¶æ‰€åšçš„é‚£æ ·ï¼ŒSpringæ¶æ„çš„å¤§å¤šæ•°éƒ¨åˆ†éƒ½æ”¯æŒå›½é™…åŒ–ã€‚ <code>DispatcherServlet</code>å…è®¸æ‚¨ä½¿ç”¨å®¢æˆ·ç«¯çš„è¯­è¨€ç¯å¢ƒè‡ªåŠ¨è§£ææ¶ˆæ¯ã€‚ è¿™æ˜¯é€šè¿‡<code>LocaleResolver</code>å¯¹è±¡å®Œæˆçš„ã€‚</p><p>å½“è¯·æ±‚è¿›å…¥æ—¶ï¼Œ<code>DispatcherServlet</code> ä¼šæŸ¥æ‰¾å½“å‰è¯­è¨€ç¯å¢ƒè§£æå™¨ï¼Œå¦‚æœæ‰¾åˆ°ï¼Œåˆ™ä¼šå°è¯•ä½¿ç”¨å®ƒæ¥è®¾ç½®è¯­è¨€ç¯å¢ƒã€‚ æ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨<code>RequestContext.getLocale()</code>æ–¹æ³•ï¼Œæ¥è·å–ç”±åŒºåŸŸè§£æå™¨è§£æåˆ°çš„ç»“æœã€‚</p><p>é™¤äº†è‡ªåŠ¨è§£æè¯­è¨€ç¯å¢ƒä¹‹å¤–ï¼Œæ‚¨è¿˜å¯ä»¥åœ¨å¤„ç†ç¨‹åºæ—¶æ·»åŠ æ‹¦æˆªå™¨ï¼ˆæœ‰å…³æ‹¦æˆªå™¨çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-handlermapping-interceptor">Interception</a> ï¼‰ï¼Œä»¥ä¾¿äºåœ¨ç‰¹å®šæƒ…å†µä¸‹æ›´æ”¹è¯­è¨€ç¯å¢ƒã€‚ä¾‹å¦‚ï¼ˆé€šè¿‡è¯·æ±‚ä¸­çš„å‚æ•°æ¥æ”¹å˜è¯­è¨€ç¯å¢ƒï¼‰</p><p>åŒºåŸŸè§£æå™¨å’Œæ‹¦æˆªå™¨åœ¨ <code>org.springframework.web.servlet.i18n</code>åŒ…ä¸­å®šä¹‰ï¼Œå¹¶ä»¥æ­£å¸¸æ–¹å¼åœ¨åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­è¿›è¡Œé…ç½®ã€‚ Springä¸­åŒ…å«ä»¥ä¸‹é€‰æ‹©çš„è¯­è¨€ç¯å¢ƒè§£æå™¨ã€‚</p><ul><li><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-timezone">Time Zone</a></li><li><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-localeresolver-acceptheader">Header Resolver</a></li><li><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-localeresolver-cookie">Cookie Resolver</a></li><li><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-localeresolver-session">Session Resolver</a></li><li><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-localeresolver-interceptor">Locale Interceptor</a></li></ul><h5 id="Time-Zone"><a href="#Time-Zone" class="headerlink" title="Time Zone"></a>Time Zone</h5><p>é™¤äº†è·å–å®¢æˆ·ç«¯çš„åŒºåŸŸè®¾ç½®å¤–ï¼Œäº†è§£å…¶æ—¶åŒºé€šå¸¸ä¹Ÿå¾ˆæœ‰ç”¨ã€‚ <code>LocaleContextResolver</code> æ¥å£æä¾›äº†<code>LocaleResolver</code>çš„æ‰©å±•ï¼Œå®ƒå…è®¸è§£æå™¨æä¾›æ›´ä¸°å¯Œçš„ <code>LocaleContext</code>ï¼Œå…¶ä¸­å¯èƒ½åŒ…å«æ—¶åŒºä¿¡æ¯ã€‚</p><p>å½“æ­¤è§£æå™¨å¯ç”¨æ—¶ï¼Œå¯ä»¥ä½¿ç”¨<code>RequestContext.getTimeZone()</code>æ–¹æ³•è·å–ç”¨æˆ·çš„<code>TimeZone</code>ã€‚ æ—¶åŒºä¿¡æ¯ç”±Springçš„<code>ConversionService</code>æ³¨å†Œçš„ä»»ä½•Date&#x2F;Time <code>Converter</code>å’Œ<code>Formatter</code> å¯¹è±¡è‡ªåŠ¨ä½¿ç”¨ã€‚</p><h5 id="Header-Resolver"><a href="#Header-Resolver" class="headerlink" title="Header Resolver"></a>Header Resolver</h5><p>æ­¤åŒºåŸŸè§£æå™¨æ£€æŸ¥å®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚ï¼ŒWebæµè§ˆå™¨ï¼‰å‘é€çš„è¯·æ±‚å¤´ä¸­çš„<code>accept-language</code>ã€‚ é€šå¸¸ï¼Œæ­¤å­—æ®µåŒ…å«å®¢æˆ·ç«¯æ“ä½œç³»ç»Ÿçš„åŒºåŸŸè®¾ç½®ã€‚ è¯·æ³¨æ„ï¼Œæ­¤è§£æå™¨ä¸æ”¯æŒæ—¶åŒºä¿¡æ¯ã€‚</p><h5 id="Cookie-Resolver"><a href="#Cookie-Resolver" class="headerlink" title="Cookie Resolver"></a>Cookie Resolver</h5><p>æ­¤åŒºåŸŸè§£æå™¨æ£€æŸ¥å®¢æˆ·ç«¯ä¸Šå¯èƒ½å­˜åœ¨çš„ <code>Cookie</code>ï¼Œä»¥æŸ¥çœ‹æ˜¯å¦æŒ‡å®šäº†<code>Locale</code>æˆ–<code>TimeZone</code>ã€‚ å¦‚æœæ˜¯ï¼Œåˆ™ä½¿ç”¨æŒ‡å®šçš„è¯¦ç»†ä¿¡æ¯ã€‚ é€šè¿‡ä½¿ç”¨æ­¤åŒºåŸŸè§£æå™¨çš„å±æ€§ï¼Œæ‚¨å¯ä»¥æŒ‡å®šcookieçš„åç§°ä»¥åŠå¤±æ•ˆæ—¶é—´ã€‚ ä»¥ä¸‹ç¤ºä¾‹å®šä¹‰<code>CookieLocaleResolver</code>ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;localeResolver&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.web.servlet.i18n.CookieLocaleResolver&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;cookieName&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;clientlanguage&quot;</span>/&gt;</span><br>    <span class="hljs-comment">&lt;!-- in seconds. If set to -1, the cookie is not persisted (deleted when browser shuts down) --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;cookieMaxAge&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;100000&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä¸‹è¡¨æè¿°äº† <code>CookieLocaleResolver</code>çš„å±æ€§ï¼š</p><p>Table 4. CookieLocaleResolver properties:</p><table><thead><tr><th>Property</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>cookieName</code></td><td>classname + LOCALE</td><td>cookieçš„åå­—</td></tr><tr><td><code>cookieMaxAge</code></td><td>Servlet container default</td><td>Cookieåœ¨å®¢æˆ·ç«¯ä¸ŠæŒç»­å­˜åœ¨çš„æœ€é•¿æ—¶é—´ã€‚ å¦‚æœæŒ‡å®š<code>-1</code>ï¼Œåˆ™ä¸ä¼šä¿ç•™cookieã€‚ å®ƒä»…åœ¨å®¢æˆ·ç«¯å…³é—­æµè§ˆå™¨ä¹‹å‰å¯ç”¨ã€‚</td></tr><tr><td><code>cookiePath</code></td><td>&#x2F;</td><td>é™åˆ¶cookieå¯¹æ‚¨ç½‘ç«™æŸä¸ªéƒ¨åˆ†çš„å¯è§æ€§ã€‚ å½“æŒ‡å®šäº† <code>cookiePath</code>æ—¶ï¼Œcookieä»…å¯¹è¯¥è·¯å¾„åŠå…¶ä¸‹æ–¹çš„è·¯å¾„å¯è§ã€‚</td></tr></tbody></table><h5 id="Session-Resolver"><a href="#Session-Resolver" class="headerlink" title="Session Resolver"></a>Session Resolver</h5><p>æ‚¨å¯ä»¥ä½¿ç”¨ <code>SessionLocaleResolver</code>ä»ä¸ç”¨æˆ·è¯·æ±‚å…³è”çš„Sessionä¸­è·å–<code>Locale</code> å’Œ<code>TimeZone</code>ã€‚ ä¸<code>CookieLocaleResolver</code>ç›¸æ¯”ï¼Œæ­¤ç­–ç•¥å°†æœ¬åœ°é€‰æ‹©çš„åŒºåŸŸè®¾ç½®å­˜å‚¨åœ¨Servletå®¹å™¨çš„ <code>HttpSession</code>ä¸­ã€‚ å› æ­¤ï¼Œè¿™äº›è®¾ç½®å¯¹äºæ¯ä¸ªä¼šè¯éƒ½æ˜¯ä¸´æ—¶çš„ï¼Œè¿™äº›è®¾ç½®åœ¨ä¼šè¯ç»“æŸæ—¶ä¼šä¸¢å¤±ã€‚</p><p>è¯·æ³¨æ„ï¼Œä¸å¤–éƒ¨ä¼šè¯ç®¡ç†æœºåˆ¶æ²¡æœ‰ç›´æ¥å…³ç³»ï¼Œä¾‹å¦‚Spring Sessioné¡¹ç›®ã€‚ æ­¤<code>SessionLocaleResolver</code> æ ¹æ®å½“å‰çš„<code>HttpServletRequest</code>è¯„ä¼°å’Œä¿®æ”¹ç›¸åº”çš„<code>HttpSession</code>å±æ€§ã€‚</p><h5 id="Locale-Interceptor"><a href="#Locale-Interceptor" class="headerlink" title="Locale Interceptor"></a>Locale Interceptor</h5><p>æ‚¨å¯ä»¥é€šè¿‡å°†<code>LocaleChangeInterceptor</code>æ·»åŠ åˆ°å…¶ä¸­ä¸€ä¸ª <code>HandlerMapping</code>å®šä¹‰æ¥å¯ç”¨è¯­è¨€ç¯å¢ƒçš„æ›´æ”¹ã€‚ å®ƒä¼šæ£€æµ‹è¯·æ±‚ä¸­çš„å‚æ•°å¹¶ç›¸åº”åœ°æ›´æ”¹è¯­è¨€ç¯å¢ƒï¼Œåœ¨ç¨‹åºçš„åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ <code>LocaleResolver</code> ä¸Šçš„<code>setLocale</code>æ–¹æ³•ã€‚ ä¸‹ä¸€ä¸ªç¤ºä¾‹æ˜¾ç¤ºï¼Œå½“è°ƒç”¨åŒ…å«åä¸º <code>siteLanguage</code>çš„å‚æ•°çš„æ‰€æœ‰<code>*.view</code>èµ„æºæ—¶æ›´æ”¹äº†åŒºåŸŸè®¾ç½®ã€‚ ä¾‹å¦‚ï¼Œå¯¹URLçš„è¯·æ±‚ <code>[http://www.sf.net/home.view?siteLanguage=nl](https://www.sf.net/home.view?siteLanguage=nl)</code>å°†ç½‘ç«™è¯­è¨€æ›´æ”¹ä¸ºè·å…°è¯­ã€‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•æ‹¦æˆªåŒºåŸŸè®¾ç½®:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;localeChangeInterceptor&quot;</span>        <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.web.servlet.i18n.LocaleChangeInterceptor&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;paramName&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;siteLanguage&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;localeResolver&quot;</span>        <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.web.servlet.i18n.CookieLocaleResolver&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;urlMapping&quot;</span>        <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.web.servlet.handler.SimpleUrlHandlerMapping&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;interceptors&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">bean</span>=<span class="hljs-string">&quot;localeChangeInterceptor&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;mappings&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>/**/*.view=someController<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="1-1-10-ä¸»é¢˜"><a href="#1-1-10-ä¸»é¢˜" class="headerlink" title="1.1.10. ä¸»é¢˜"></a>1.1.10. ä¸»é¢˜</h4><p>æ‚¨å¯ä»¥ä½¿ç”¨Spring Web MVCæ¡†æ¶è‡ªå¸¦çš„ä¸»é¢˜æ¥è®¾ç½®åº”ç”¨ç¨‹åºçš„æ•´ä½“å¤–è§‚ï¼Œä»è€Œå¢å¼ºç”¨æˆ·ä½“éªŒã€‚ ä¸»é¢˜æ˜¯é™æ€èµ„æºçš„é›†åˆï¼Œé€šå¸¸æ˜¯æ ·å¼è¡¨å’Œå›¾åƒï¼Œå®ƒä»¬ä¼šå½±å“åº”ç”¨ç¨‹åºçš„è§†è§‰æ ·å¼ã€‚</p><h5 id="å®šä¹‰ä¸€ä¸ªä¸»é¢˜"><a href="#å®šä¹‰ä¸€ä¸ªä¸»é¢˜" class="headerlink" title="å®šä¹‰ä¸€ä¸ªä¸»é¢˜"></a>å®šä¹‰ä¸€ä¸ªä¸»é¢˜</h5><p>è¦åœ¨Webåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ä¸»é¢˜ï¼Œå¿…é¡»è®¾ç½® <code>org.springframework.ui.context.ThemeSource</code>æ¥å£çš„å®ç°ã€‚ <code>WebApplicationContext</code>æ¥å£æ‰©å±•äº† <code>ThemeSource</code>ï¼Œ ä½†å°†å…¶èŒè´£å§”æ‰˜ç»™ä¸“ç”¨å®ç°ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œå§”æ‰˜æ˜¯ <code>org.springframework.ui.context.support.ResourceBundleThemeSource</code>çš„å®ç°ã€‚å®ƒä»ç±»è·¯å¾„çš„æ ¹ç›®å½•åŠ è½½å±æ€§æ–‡ä»¶ã€‚ è¦ä½¿ç”¨è‡ªå®šä¹‰ <code>ThemeSource</code>å®ç°æˆ–é…ç½® <code>ResourceBundleThemeSource</code>çš„åç§°å‰ç¼€ï¼Œå¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨ä¿ç•™åç§°<code>themeSource</code>æ³¨å†Œbeanã€‚ Webåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡è‡ªåŠ¨æ£€æµ‹å…·æœ‰è¯¥åç§°çš„beanå¹¶ä½¿ç”¨å®ƒã€‚</p><p>ä½¿ç”¨ <code>ResourceBundleThemeSource</code>æ—¶ï¼Œä¸»é¢˜åœ¨ç®€å•å±æ€§æ–‡ä»¶ä¸­å®šä¹‰ã€‚ å±æ€§æ–‡ä»¶åˆ—å‡ºæ„æˆä¸»é¢˜çš„èµ„æºï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><p>styleSheet&#x3D;&#x2F;themes&#x2F;cool&#x2F;style.css background&#x3D;&#x2F;themes&#x2F;cool&#x2F;img&#x2F;coolBg.jpg</p><p>å±æ€§çš„é”®æ˜¯ä»è§†å›¾ä»£ç å¼•ç”¨ä¸»é¢˜å…ƒç´ çš„åç§°ã€‚ å¯¹äºJSPï¼Œé€šå¸¸ä½¿ç”¨<code>spring:theme</code> è‡ªå®šä¹‰æ ‡ç­¾æ‰§è¡Œæ­¤æ“ä½œï¼Œè¯¥æ ‡è®°ä¸<code>spring:message</code>æ ‡ç­¾éå¸¸ç›¸ä¼¼ã€‚ ä»¥ä¸‹JSPç‰‡æ®µä½¿ç”¨ä¸Šä¸€ç¤ºä¾‹ä¸­å®šä¹‰çš„ä¸»é¢˜æ¥è‡ªå®šä¹‰å¤–è§‚ï¼š</p><figure class="highlight erb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs erb"><span class="language-xml">&lt;%</span><span class="language-ruby">@ taglib prefix=<span class="hljs-string">&quot;spring&quot;</span> uri=<span class="hljs-string">&quot;http://www.springframework.org/tags&quot;</span></span><span class="language-xml">%&gt;</span><br><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&lt;spring:theme code=&#x27;styleSheet&#x27;/&gt;&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/css&quot;</span>/&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;background=&lt;spring:theme code=&#x27;background&#x27;/&gt;&quot;</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">        ...</span><br><span class="language-xml"></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>ResourceBundleThemeSource</code>ä½¿ç”¨ç©ºçš„åç§°å‰ç¼€ã€‚ å› æ­¤ï¼Œä»ç±»è·¯å¾„çš„æ ¹åŠ è½½å±æ€§æ–‡ä»¶ã€‚ å› æ­¤ï¼Œæ‚¨å¯ä»¥å°†<code>cool.properties</code>ä¸»é¢˜å®šä¹‰æ”¾åœ¨ç±»è·¯å¾„æ ¹ç›®å½•çš„ç›®å½•ä¸­ï¼ˆä¾‹å¦‚ï¼Œåœ¨ <code>/WEB-INF/classes</code>ä¸­ï¼‰ã€‚ <code>ResourceBundleThemeSource</code>ä½¿ç”¨æ ‡å‡†çš„Javaèµ„æºåŒ…åŠ è½½æœºåˆ¶ï¼Œä»è€Œä½¿ä¸»é¢˜ä¹Ÿå…·æœ‰å›½é™…åŒ–ã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰ä¸€ä¸ª<code>/WEB-INF/classes/cool_nl.properties</code>ï¼Œå®ƒå¼•ç”¨ä¸€ä¸ªå¸¦æœ‰è·å…°æ–‡æœ¬çš„ç‰¹æ®ŠèƒŒæ™¯å›¾åƒã€‚</p><h5 id="è§£æä¸»é¢˜"><a href="#è§£æä¸»é¢˜" class="headerlink" title="è§£æä¸»é¢˜"></a>è§£æä¸»é¢˜</h5><p>å®šä¹‰ä¸»é¢˜åï¼Œ<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-themeresolver-defining">å¦‚ä¸Šä¸€èŠ‚æ‰€è¿°</a>ï¼Œæ‚¨å¯ä»¥å†³å®šä½¿ç”¨å“ªä¸ªä¸»é¢˜ã€‚ <code>DispatcherServlet</code>æŸ¥æ‰¾åä¸º<code>themeResolver</code>çš„beanï¼Œä»¥æ‰¾å‡ºè¦ä½¿ç”¨çš„<code>ThemeResolver</code>å®ç°ã€‚ ä¸»é¢˜è§£æå™¨çš„å·¥ä½œæ–¹å¼ä¸<code>LocaleResolver</code>çš„å·¥ä½œæ–¹å¼å¤§è‡´ç›¸åŒã€‚ å®ƒæ£€æµ‹ç”¨äºç‰¹å®šè¯·æ±‚çš„ä¸»é¢˜ï¼Œè¿˜å¯ä»¥æ›´æ”¹è¯·æ±‚çš„ä¸»é¢˜ã€‚ ä¸‹è¡¨æè¿°äº†Springæä¾›çš„ä¸»é¢˜è§£æå™¨ï¼š</p><p>Table 5. ThemeResolver implementations :</p><table><thead><tr><th>Class</th><th>Description</th></tr></thead><tbody><tr><td><code>FixedThemeResolver</code></td><td>é€‰æ‹©ä½¿ç”¨<code>defaultThemeName</code></td></tr><tr><td><code>SessionThemeResolver</code></td><td>ä¸»é¢˜åœ¨ç”¨æˆ·çš„HTTPä¼šè¯ä¸­ç»´æŠ¤ã€‚ å®ƒåªéœ€è¦ä¸ºæ¯ä¸ªä¼šè¯è®¾ç½®ä¸€æ¬¡ï¼Œä½†ä¸ä¼šåœ¨ä¼šè¯ä¹‹é—´ä¿ç•™ã€‚</td></tr><tr><td><code>CookieThemeResolver</code></td><td>æ‰€é€‰ä¸»é¢˜å­˜å‚¨åœ¨å®¢æˆ·ç«¯çš„cookieä¸­ã€‚</td></tr></tbody></table><p>Springè¿˜æä¾›äº†ä¸€ä¸ª<code>ThemeChangeInterceptor</code>ï¼Œå®ƒå…è®¸é€šè¿‡ç®€å•çš„è¯·æ±‚å‚æ•°å¯¹æ¯ä¸ªè¯·æ±‚è¿›è¡Œä¸»é¢˜æ›´æ”¹ã€‚</p><h4 id="1-1-11-Multipart-è§£æå™¨"><a href="#1-1-11-Multipart-è§£æå™¨" class="headerlink" title="1.1.11. Multipart è§£æå™¨"></a>1.1.11. Multipart è§£æå™¨</h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-multipart">Same as in Spring WebFlux</a></p><p><code>org.springframework.web.multipart</code> åŒ…ä¸­çš„ <code>MultipartResolver</code>æ˜¯ä¸€ç§ç”¨äºè§£æåŒ…æ‹¬æ–‡ä»¶ä¸Šä¼ åœ¨å†…çš„å¤šéƒ¨åˆ†è¯·æ±‚çš„ç­–ç•¥ã€‚ ä»–åŒ…å«äº†ä¸€ä¸ª<a href="https://jakarta.apache.org/commons/fileupload">Commons FileUpload</a> çš„å®ç°ï¼Œå¦ä¸€ä¸ªåŸºäºServlet 3.0å¤šéƒ¨åˆ†è¯·æ±‚è§£æã€‚</p><p>è¦å¯ç”¨å¤šéƒ¨åˆ†å¤„ç†ï¼ŒSpringçš„é…ç½®æ–‡ä»¶ä¸­ï¼Œåœ¨ <code>DispatcherServlet</code> é…ç½®åç§°ä¸º<code>multipartResolver</code>çš„<code>MultipartResolver</code> beanã€‚ <code>DispatcherServlet</code>ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶å°†å…¶åº”ç”¨äºè¯·æ±‚ä¸­ã€‚ å½“æ”¶åˆ°å†…å®¹ç±»å‹ä¸º<code>multipart/form-data</code>çš„POSTè¯·æ±‚æ—¶ï¼Œè§£æå™¨ä¼šè§£æå†…å®¹å¹¶å°†å½“å‰çš„<code>HttpServletRequest</code>åŒ…è£…ä¸º <code>MultipartHttpServletRequest</code>ï¼Œä»¥æä¾›å¯¹å·²è§£æéƒ¨åˆ†çš„è®¿é—®ï¼Œå¹¶å°†å…¶ä½œä¸ºè¯·æ±‚å‚æ•°å…¬å¼€ã€‚</p><h5 id="Apache-Commons-FileUpload"><a href="#Apache-Commons-FileUpload" class="headerlink" title="Apache Commons FileUpload"></a>Apache Commons <code>FileUpload</code></h5><p>è¦ä½¿ç”¨Apache Commons <code>FileUpload</code>ï¼Œæ‚¨å¯ä»¥é…ç½®åä¸º <code>multipartResolver</code>çš„<code>CommonsMultipartResolver</code>rç±»å‹çš„beanã€‚ æ‚¨è¿˜éœ€è¦æ·»åŠ <code>commons-fileupload</code>ä¾èµ–ã€‚</p><h5 id="Servlet-3-0"><a href="#Servlet-3-0" class="headerlink" title="Servlet 3.0"></a>Servlet 3.0</h5><p>éœ€è¦é€šè¿‡Servletå®¹å™¨é…ç½®å¯ç”¨Servlet 3.0å¤šéƒ¨åˆ†è§£æ:</p><ul><li>åœ¨Javaä¸­ï¼Œåœ¨æ³¨å†ŒServletæ—¶è®¾ç½® <code>MultipartConfigElement</code>ã€‚</li><li>åœ¨<code>web.xml</code>ä¸­ï¼Œå°†â€œ<code>&quot;&lt;multipart-config&gt;&quot;</code>â€éƒ¨åˆ†æ·»åŠ åˆ°servletå£°æ˜ä¸­ã€‚</li></ul><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•åœ¨æ³¨å†ŒServletæ—¶è®¾ç½® <code>MultipartConfigElement</code>:</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs scala">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppInitializer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractAnnotationConfigDispatcherServletInitializer</span> </span>&#123;<br>    <span class="hljs-comment">// ...</span><br>    <span class="hljs-meta">@Override</span>    <span class="hljs-keyword">protected</span> void customizeRegistration(<span class="hljs-type">ServletRegistration</span>.<span class="hljs-type">Dynamic</span> registration) &#123;<br>        <span class="hljs-comment">// Optionally also set maxFileSize, maxRequestSize, fileSizeThreshold        registration.setMultipartConfig(new MultipartConfigElement(&quot;/tmp&quot;));    &#125;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸€æ—¦æ‚¨é…ç½®å¥½Servlet 3.0ï¼Œæ‚¨å°±å¯ä»¥æ·»åŠ åä¸º<code>multipartResolver</code>çš„<code>StandardServletMultipartResolver</code>ç±»å‹çš„beanã€‚</p><h4 id="1-1-12-æ—¥å¿—"><a href="#1-1-12-æ—¥å¿—" class="headerlink" title="1.1.12. æ—¥å¿—"></a>1.1.12. æ—¥å¿—</h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-logging">Same as in Spring WebFlux</a></p><p>Spring MVCä¸­çš„DEBUGçº§åˆ«æ—¥å¿—è®°å½•æ—¨åœ¨å®ç°ç´§å‡‘ï¼Œç®€çº¦å’Œäººæ€§åŒ–ã€‚ å®ƒä¾§é‡äºé‚£äº›ä¸€æ¬¡åˆä¸€æ¬¡ä½¿ç”¨çš„é«˜ä»·å€¼ä¿¡æ¯ï¼Œå…¶ä»–çš„åªæœ‰åœ¨è°ƒè¯•ç‰¹å®šé—®é¢˜æ—¶æ‰æœ‰ç”¨ã€‚</p><p>TRACEçº§æ—¥å¿—è®°å½•é€šå¸¸éµå¾ªä¸DEBUGç›¸åŒçš„åŸåˆ™ï¼ˆä¾‹å¦‚ï¼Œä¸åº”è¯¥æ˜¯fire hoseï¼‰ï¼Œä½†å¯ä»¥ç”¨äºè°ƒè¯•ä»»ä½•é—®é¢˜ã€‚ æ­¤å¤–ï¼Œä¸€äº›æ—¥å¿—æ¶ˆæ¯å¯èƒ½åœ¨TRACEä¸DEBUGä¸­æ˜¾ç¤ºä¸åŒçš„è¯¦ç»†ç¨‹åº¦ã€‚</p><p>è‰¯å¥½çš„æ—¥å¿—è®°å½•æ¥è‡ªä½¿ç”¨æ—¥å¿—çš„ç»éªŒã€‚ å¦‚æœæ‚¨å‘ç°ä»»ä½•ä¸ç¬¦åˆæ—¢å®šç›®æ ‡çš„äº‹ä»¶ï¼Œè¯·å‘ŠçŸ¥æˆ‘ä»¬ã€‚</p><h5 id="æ•æ„Ÿæ•°æ®"><a href="#æ•æ„Ÿæ•°æ®" class="headerlink" title="æ•æ„Ÿæ•°æ®"></a>æ•æ„Ÿæ•°æ®</h5><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-logging-sensitive-data">Same as in Spring WebFlux</a></p><p>DEBUGå’ŒTRACEæ—¥å¿—è®°å½•å¯èƒ½ä¼šè®°å½•æ•æ„Ÿä¿¡æ¯ã€‚ è¿™å°±æ˜¯é»˜è®¤æƒ…å†µä¸‹å±è”½è¯·æ±‚å‚æ•°å’Œè¯·æ±‚å¤´çš„åŸå› ï¼Œå¹¶ä¸”å¿…é¡»é€šè¿‡ <code>DispatcherServlet</code>ä¸Šçš„ <code>enableLoggingRequestDetails</code>å±æ€§æ˜¾å¼å¯ç”¨å®ƒä»¬çš„å®Œæ•´æ—¥å¿—è®°å½•ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹è¯´æ˜å¦‚ä½•ä½¿ç”¨Javaé…ç½®æ‰§è¡Œæ­¤æ“ä½œï¼š</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs scala">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyInitializer</span>        <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractAnnotationConfigDispatcherServletInitializer</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span>    <span class="hljs-keyword">protected</span> <span class="hljs-type">Class</span>&lt;?&gt;[] getRootConfigClasses() &#123;        <span class="hljs-keyword">return</span> ... ;    &#125;<br>    <span class="hljs-meta">@Override</span>    <span class="hljs-keyword">protected</span> <span class="hljs-type">Class</span>&lt;?&gt;[] getServletConfigClasses() &#123;        <span class="hljs-keyword">return</span> ... ;    &#125;<br>    <span class="hljs-meta">@Override</span>    <span class="hljs-keyword">protected</span> <span class="hljs-type">String</span>[] getServletMappings() &#123;        <span class="hljs-keyword">return</span> ... ;    &#125;<br>    <span class="hljs-meta">@Override</span>    <span class="hljs-keyword">protected</span> void customizeRegistration(<span class="hljs-type">Dynamic</span> registration) &#123;        registration.setInitParameter(<span class="hljs-string">&quot;enableLoggingRequestDetails&quot;</span>, <span class="hljs-string">&quot;true&quot;</span>);    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="1-2-è¿‡æ»¤å™¨"><a href="#1-2-è¿‡æ»¤å™¨" class="headerlink" title="1.2. è¿‡æ»¤å™¨"></a>1.2. è¿‡æ»¤å™¨</h3><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-filters">Same as in Spring WebFlux</a></p><p><code>spring-web</code>æ¨¡å—æä¾›äº†ä¸€äº›æœ‰ç”¨çš„è¿‡æ»¤å™¨:</p><ul><li><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#filters-http-put">Form Dataï¼ˆè¡¨å•æ•°æ®ï¼‰</a></li><li><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#filters-forwarded-headers">Forwarded Headersï¼ˆè½¬å‘è¯·æ±‚å¤´ï¼‰</a></li><li><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#filters-shallow-etag">Shallow ETagï¼ˆï¼‰</a></li><li><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#filters-cors">CORS</a></li></ul><h4 id="1-2-1-è¡¨å•æ•°æ®"><a href="#1-2-1-è¡¨å•æ•°æ®" class="headerlink" title="1.2.1. è¡¨å•æ•°æ®"></a>1.2.1. è¡¨å•æ•°æ®</h4><p>æµè§ˆå™¨åªèƒ½é€šè¿‡HTTP GETæˆ–HTTP POSTæäº¤è¡¨å•æ•°æ®ï¼Œä½†éæµè§ˆå™¨å®¢æˆ·ç«¯ä¹Ÿå¯ä»¥ä½¿ç”¨HTTP PUTï¼ŒPATCHå’ŒDELETEæäº¤è¡¨å•æ•°æ®ã€‚ Servlet APIè¦æ±‚<code>ServletRequest.getParameter*()</code>æ–¹æ³•ä»…æ”¯æŒHTTP POSTçš„è¡¨å•å­—æ®µè®¿é—®ã€‚.</p><p><code>spring-web</code>æ¨¡å—æä¾› <code>FormContentFilter</code>è¿‡æ»¤å™¨æ¥æ‹¦æˆªHTTP PUTï¼ŒPATCHå’ŒDELETEè¯·æ±‚ï¼Œè¯·æ±‚ç±»å‹ä¸º <code>application/x-www-form-urlencoded</code>ï¼Œ <code>FormContentFilter</code>ä»è¯·æ±‚ä¸­è¯»å–è¡¨å•æ•°æ®ï¼Œ å¹¶åŒ…è£… <code>ServletRequest</code>ï¼Œç„¶åå¯ä»¥é€šè¿‡ <code>ServletRequest.getParameter*()</code>ç³»åˆ—æ–¹æ³•æä¾›è¡¨å•æ•°æ®ã€‚</p><h4 id="1-2-2-Forwarded-Headersï¼ˆè½¬å‘è¯·æ±‚å¤´ï¼‰"><a href="#1-2-2-Forwarded-Headersï¼ˆè½¬å‘è¯·æ±‚å¤´ï¼‰" class="headerlink" title="1.2.2. Forwarded Headersï¼ˆè½¬å‘è¯·æ±‚å¤´ï¼‰"></a>1.2.2. Forwarded Headersï¼ˆè½¬å‘è¯·æ±‚å¤´ï¼‰</h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-forwarded-headers">Same as in Spring WebFlux</a></p><p>å½“é€šè¿‡ä»£ç†ä¸»æœºæˆ–è€…ç«¯å£æˆ–è€…å…¶ä»–æ–¹æ¡ˆè¯·æ±‚æ—¶ï¼ˆä¾‹å¦‚ï¼Œè´Ÿè½½å‡è¡¡ï¼‰ï¼Œè¿™æ˜¯ï¼Œä»å®¢æˆ·ç«¯è§’åº¦çœ‹ï¼Œåˆ›å»ºæ­£ç¡®çš„ä¸»æœºï¼Œç«¯å£æˆ–è€…å…¶ä»–æ–¹æ¡ˆæˆä¸ºä¸€é¡¹æŒ‘æˆ˜ï¼Œ</p><p><a href="https://tools.ietf.org/html/rfc7239">RFC 7239</a> RFC 7239å®šä¹‰äº†ä»£ç†å¯ä»¥ç”¨æ¥æä¾›æœ‰å…³åŸå§‹è¯·æ±‚ä¿¡æ¯çš„è½¬å‘HTTPå¤´ã€‚ è¿˜æœ‰å…¶ä»–éæ ‡å‡†å¤´æ–‡ä»¶ï¼ŒåŒ…æ‹¬<code>X-Forwarded-Host</code>, <code>X-Forwarded-Port</code>, <code>X-Forwarded-Proto</code>, <code>X-Forwarded-Ssl</code>, å’Œ <code>X-Forwarded-Prefix</code>ã€‚</p><p><code>ForwardedHeaderFilter</code>æ˜¯ä¸€ä¸ªServletè¿‡æ»¤å™¨ï¼Œå®ƒæ ¹æ® <code>Forwarded</code> å¤´éƒ¨ä¿¡æ¯ä¿®æ”¹è¯·æ±‚çš„ä¸»æœºï¼Œç«¯å£å’Œæ–¹æ¡ˆï¼Œç„¶ååˆ é™¤è¯·æ±‚å¤´ã€‚</p><p>å½“è½¬å‘è¯·æ±‚å¤´æ—¶éœ€è¦æ³¨æ„çš„å®‰å…¨äº‹é¡¹ï¼Œå› ä¸ºåº”ç”¨ç¨‹åºæ— æ³•çŸ¥é“è¯·æ±‚å¤´æ˜¯ä»£ç†æŒ‰æˆ‘ä»¬æƒ³çš„é‚£æ ·æ·»åŠ è¿˜æ˜¯ç”±å®¢æˆ·ç«¯æ¶æ„æ·»åŠ ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆåº”è¯¥å°†ä¿¡ä»»è¾¹ç•Œçš„ä»£ç†é…ç½®ä¸ºåˆ é™¤æ¥è‡ªå¤–éƒ¨çš„ä¸å—ä¿¡ä»»çš„è½¬å‘è¯·æ±‚å¤´ã€‚ æ‚¨è¿˜å¯ä»¥ä½¿ç”¨<code>removeOnly=true</code>é…ç½®<code>ForwardedHeaderFilter</code>ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒä¼šåˆ é™¤ä½†ä¸ä½¿ç”¨æ ‡å¤´ã€‚</p><h4 id="1-2-3-Shallow-ETag"><a href="#1-2-3-Shallow-ETag" class="headerlink" title="1.2.3. Shallow ETag"></a>1.2.3. Shallow ETag</h4><p><code>ShallowEtagHeaderFilter</code>è¿‡æ»¤å™¨é€šè¿‡ç¼“å­˜å†™å…¥å“åº”çš„å†…å®¹å¹¶ä»ä¸­è®¡ç®—MD5å“ˆå¸Œæ¥åˆ›å»º â€œshallowâ€ETagã€‚ å®¢æˆ·ç«¯ä¸‹æ¬¡å‘é€æ—¶ï¼Œ å®ƒä¼šæ‰§è¡Œç›¸åŒæ“ä½œï¼Œä½†å®ƒä¹Ÿä¼šå°†è®¡ç®—å€¼ä¸<code>If-None-Match</code>è¯·æ±‚å¤´è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœä¸¤è€…ç›¸ç­‰ï¼Œåˆ™è¿”å›304ï¼ˆNOT_MODIFIEDï¼‰ã€‚</p><p>æ­¤ç­–ç•¥å¯ä»¥èŠ‚çœç½‘ç»œå¸¦å®½ï¼Œä½†ä¸èƒ½èŠ‚çœCPUï¼Œå› ä¸ºå¿…é¡»ä¸ºæ¯ä¸ªè¯·æ±‚è®¡ç®—å®Œæ•´å“åº”ã€‚ å‰é¢æè¿°çš„æ§åˆ¶å™¨çº§åˆ«çš„å…¶ä»–ç­–ç•¥å¯ä»¥é¿å…è®¡ç®—ã€‚ è¯·å‚é˜… <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-caching">HTTP Caching</a>ã€‚</p><p>æ­¤è¿‡æ»¤å™¨å…·æœ‰<code>writeWeakETag</code>å‚æ•°ï¼Œè¯¥å‚æ•°å°†è¿‡æ»¤å™¨é…ç½®ä¸ºå†™å…¥å¼±ETagï¼Œç±»ä¼¼äºä»¥ä¸‹å†…å®¹ï¼š<code>W/&quot;02a2d595e6ed9a0b24f027f2b63b134d6&quot;</code>ï¼ˆå¦‚<a href="https://tools.ietf.org/html/rfc7232#section-2.3">RFC 7232 Section 2.3</a>ï¼‰ã€‚</p><h4 id="1-2-4-CORS"><a href="#1-2-4-CORS" class="headerlink" title="1.2.4. CORS"></a>1.2.4. CORS</h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-filters-cors">Same as in Spring WebFlux</a></p><p>Spring MVCé€šè¿‡æ§åˆ¶å™¨ä¸Šçš„æ³¨è§£ä¸ºCORSé…ç½®æä¾›ç»†ç²’åº¦çš„æ”¯æŒã€‚ ä½†æ˜¯ï¼Œå½“ä¸Spring Securityä¸€èµ·ä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬å»ºè®®ä¾èµ–äºå¿…é¡»åœ¨Spring Securityçš„è¿‡æ»¤å™¨é“¾ä¹‹å‰é…ç½®çš„å†…ç½®<code>CorsFilter</code>ã€‚</p><p>æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-cors">CORS</a>å’Œ<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-cors-filter">CORS Filter</a> è¿‡æ»¤å™¨éƒ¨åˆ†ã€‚</p><h3 id="1-3-æ³¨è§£æ§åˆ¶å™¨"><a href="#1-3-æ³¨è§£æ§åˆ¶å™¨" class="headerlink" title="1.3. æ³¨è§£æ§åˆ¶å™¨"></a>1.3. æ³¨è§£æ§åˆ¶å™¨</h3><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-controller">Same as in Spring WebFlux</a></p><p>Spring MVCæä¾›äº†åŸºäºæ³¨è§£çš„ç¼–ç¨‹æ¨¡å‹ï¼Œå…¶ä¸­<code>@Controller</code> å’Œ <code>@RestController</code> ç»„ä»¶ä½¿ç”¨æ³¨è§£æ¥è¡¨ç¤ºè¯·æ±‚æ˜ å°„ã€è¯·æ±‚è¾“å…¥ã€å¼‚å¸¸å¤„ç†ç­‰ã€‚è¢«æ³¨è§£çš„æ§åˆ¶å™¨æ‹¥æœ‰çµæ´»çš„æ–¹æ³•ç­¾åï¼Œå¹¶ä¸”æ— éœ€æ‰©å±•åŸºç±»æˆ–å®ç°ç‰¹å®šçš„æ¥å£ã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†ç”±æ³¨è§£å®šä¹‰çš„æ§åˆ¶å™¨ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@Controllerpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloController</span> &#123;<br>    <span class="hljs-meta">@GetMapping(<span class="hljs-string">&quot;/hello&quot;</span>)</span>    <span class="hljs-keyword">public</span> String handle(Model model) &#123;        model.addAttribute(<span class="hljs-string">&quot;message&quot;</span>, <span class="hljs-string">&quot;Hello World!&quot;</span>);        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;index&quot;</span>;    &#125;&#125;<br></code></pre></td></tr></table></figure><p>åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œè¯¥æ–¹æ³•æ¥å—<code>Model</code>å¹¶å°†è§†å›¾åç§°ä½œä¸ºStringè¿”å›ï¼Œä½†æ˜¯å­˜åœ¨è®¸å¤šå…¶ä»–é€‰é¡¹ï¼Œæœ¬ç« ç¨åå°†å¯¹å…¶è¿›è¡Œè¯´æ˜ã€‚</p><p>æœ‰å…³<a href="https://spring.io/guides">spring.io</a>çš„æŒ‡å—å’Œæ•™ç¨‹ï¼Œè¯·ä½¿ç”¨æœ¬èŠ‚ä¸­ä»‹ç»çš„åŸºäºæ³¨è§£çš„ç¼–ç¨‹æ¨¡å‹ã€‚</p><h4 id="1-3-1-å£°æ˜"><a href="#1-3-1-å£°æ˜" class="headerlink" title="1.3.1. å£°æ˜"></a>1.3.1. å£°æ˜</h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-ann-controller">Same as in Spring WebFlux</a></p><p>æ‚¨å¯ä»¥åœ¨Servletçš„<code>WebApplicationContext</code>ä¸­ä½¿ç”¨æ ‡å‡†çš„Spring beanå®šä¹‰æ¥å®šä¹‰æ§åˆ¶å™¨beanã€‚<code>@Controller</code>æ¨¡æ¿å…è®¸è‡ªåŠ¨æ£€æµ‹ï¼Œ ä¸Springæ”¯æŒæ£€æµ‹ç±»è·¯å¾„ä¸­çš„<code>@Component</code>ç±»ä¸€æ ·ï¼Œå¹¶ä¼šè‡ªåŠ¨æ³¨å†Œbeanå®šä¹‰ã€‚å®ƒè¿˜å……å½“æ³¨è§£ç±»çš„æ¨¡æ¿ï¼Œè¡¨ç¤ºå®ƒå……å½“çš„æ˜¯Webç»„ä»¶çš„è§’è‰²ã€‚</p><p>è¦å¯ç”¨<code>@Controller</code> beançš„è‡ªåŠ¨æ£€æµ‹ï¼Œæ‚¨å¯ä»¥å°†ç»„ä»¶æ‰«ææ·»åŠ åˆ°Javaé…ç½®ä¸­ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Configuration</span><span class="hljs-variable">@ComponentScan</span>(<span class="hljs-string">&quot;org.example.web&quot;</span>)public class WebConfig &#123;<br>    <span class="hljs-comment">// ...&#125;</span><br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†ä¸å‰é¢ç¤ºä¾‹ç­‰æ•ˆçš„XMLé…ç½®:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span>    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>    <span class="hljs-attr">xmlns:p</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/p&quot;</span>    <span class="hljs-attr">xmlns:context</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/context&quot;</span>    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;        http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans.xsd        http://www.springframework.org/schema/context        http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">&quot;org.example.web&quot;</span>/&gt;</span><br>    <span class="hljs-comment">&lt;!-- ... --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><p><code>@RestController</code> æ˜¯ä¸€ä¸ª<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/core.html#beans-meta-annotations">ç»„åˆæ³¨è§£</a> ï¼Œå®ƒæœ¬èº«ç”±<code>@Controller</code> å’Œ <code>@ResponseBody</code>å…ƒæ³¨è§£ç»„æˆã€‚ å…¶æ¯ä¸ªæ–¹æ³•éƒ½ç»§æ‰¿ç±»å‹çº§åˆ«ï¼ˆtype-levelï¼‰çš„ <code>@ResponseBody</code>æ³¨è§£ï¼Œå› æ­¤ï¼Œç›´æ¥å†™å…¥å“åº”ä¸»ä½“ä¸è§†å›¾æ¸²æŸ“å’Œä½¿ç”¨HTMLæ¨¡æ¿ã€‚</p><h5 id="AOP-ä»£ç†"><a href="#AOP-ä»£ç†" class="headerlink" title="AOP ä»£ç†"></a>AOP ä»£ç†</h5><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ‚¨éœ€è¦åœ¨è¿è¡Œæ—¶ä½¿ç”¨AOPä»£ç†è£…é¥°æ§åˆ¶å™¨ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æƒ³åœ¨æ§åˆ¶å™¨ä¸Šç›´æ¥ä½¿ç”¨<code>@Transactional</code>æ³¨è§£ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯¹äºæ§åˆ¶å™¨è€Œè¨€ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨åŸºäºç±»çš„ä»£ç†ã€‚ è¿™é€šå¸¸ä¹Ÿæ˜¯æ§åˆ¶å™¨çš„é»˜è®¤é€‰æ‹©ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæ§åˆ¶å™¨æ²¡æœ‰å®ç°Spring Contextå›è°ƒçš„æ¥å£ ï¼ˆä¾‹å¦‚<code>InitializingBean</code>, <code>*Aware</code>ç­‰ï¼‰ï¼Œ åˆ™å¯èƒ½éœ€è¦æ˜¾å¼é…ç½®åŸºäºç±»çš„ä»£ç†ã€‚ ä¾‹å¦‚ï¼Œä½¿ç”¨ <code>&lt;tx:annotation-driven/&gt;</code>ï¼Œæ‚¨å¯ä»¥æ›´æ”¹ä¸º<code>&lt;tx:annotation-driven proxy-target-class=&quot;true&quot;/&gt;</code>ã€‚</p><h4 id="1-3-2-Request-Mapping"><a href="#1-3-2-Request-Mapping" class="headerlink" title="1.3.2. Request Mapping"></a>1.3.2. Request Mapping</h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-ann-requestmapping">Same as in Spring WebFlux</a></p><p><code>@RequestMapping</code>æ³¨è§£ç”¨äºå°†è¯·æ±‚æ˜ å°„åˆ°æ§åˆ¶å™¨æ–¹æ³•ã€‚å®ƒå…·æœ‰å„ç§å±æ€§ï¼Œå¯ä»¥é€šè¿‡URLã€HTTPæ–¹æ³•ã€è¯·æ±‚å‚æ•°ã€è¯·æ±‚å¤´å‚æ•°ï¼ˆheadersï¼‰å’Œåª’ä½“ç±»å‹è¿›è¡ŒåŒ¹é…ã€‚ å¯ä»¥åœ¨ç±»çº§åˆ«ä½¿ç”¨å®ƒæ¥è¡¨ç¤ºå…±äº«æ˜ å°„ï¼Œæˆ–åœ¨æ–¹æ³•çº§åˆ«ä¸Šç”¨äºç¼©å°åˆ°ç‰¹å®šçš„ç«¯ç‚¹æ˜ å°„èŒƒå›´ã€‚</p><p>è¿˜æœ‰<code>@RequestMapping</code>çš„HTTPæ–¹æ³•ç‰¹å®šçš„ç¼©å†™å˜é‡:</p><ul><li><code>@GetMapping</code></li><li><code>@PostMapping</code></li><li><code>@PutMapping</code></li><li><code>@DeleteMapping</code></li><li><code>@PatchMapping</code></li></ul><p>è¿™äº›ç®€æ´çš„æ³¨è§£æ˜¯<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-requestmapping-composed">è‡ªå®šä¹‰æ³¨è§£</a>ï¼Œå› ä¸ºï¼Œå¤§å¤šæ•°çš„æ§åˆ¶å™¨æ–¹æ³•åº”è¯¥æ˜ å°„åˆ°HTTPæ–¹æ³•è€Œä¸æ˜¯ä½¿ç”¨<code>@RequestMapping</code>ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ <code>@RequestMapping</code>å’Œæ‰€æœ‰HTTPæ–¹æ³•åŒ¹é…ã€‚åœ¨ç±»ä¸Šå®šä¹‰çš„ä»ç„¶éœ€è¦<code>@RequestMapping</code> æ¥è¡¨ç¤ºå…±äº«æ˜ å°„ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹å…·æœ‰ç±»å‹å’Œæ–¹æ³•çº§åˆ«æ˜ å°„:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@RestController</span><span class="hljs-variable">@RequestMapping</span>(<span class="hljs-string">&quot;/persons&quot;</span>)class PersonController &#123;<br>    <span class="hljs-variable">@GetMapping</span>(<span class="hljs-string">&quot;/&#123;id&#125;&quot;</span>)    public Person <span class="hljs-built_in">getPerson</span>(<span class="hljs-variable">@PathVariable</span> Long id) &#123;        <span class="hljs-comment">// ...    &#125;</span><br>    <span class="hljs-variable">@PostMapping</span>    <span class="hljs-variable">@ResponseStatus</span>(HttpStatus.CREATED)    public void <span class="hljs-built_in">add</span>(<span class="hljs-variable">@RequestBody</span> Person person) &#123;        <span class="hljs-comment">// ...    &#125;&#125;</span><br></code></pre></td></tr></table></figure><h5 id="URI-æ¨¡å¼åŒ¹é…"><a href="#URI-æ¨¡å¼åŒ¹é…" class="headerlink" title="URI æ¨¡å¼åŒ¹é…"></a>URI æ¨¡å¼åŒ¹é…</h5><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-ann-requestmapping-uri-templates">Same as in Spring WebFlux</a></p><p>ä½ å¯ä»¥ä½¿ç”¨globæ¨¡å¼å’Œé€šé…ç¬¦æ¥æ˜ å°„è¯·æ±‚:</p><ul><li><code>?</code> åŒ¹é…ä¸€ä¸ªå­—ç¬¦</li><li><code>*</code> åŒ¹é…è·¯å¾„æ®µä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦</li><li><code>**</code> åŒ¹é…0ä¸ªæˆ–å¤šä¸ªè·¯å¾„æ®µ</li></ul><p>æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ <code>@PathVariable</code>å£°æ˜URIå˜é‡å¹¶è®¿é—®å®ƒä»¬çš„å€¼ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@GetMapping</span>(<span class="hljs-string">&quot;/owners/&#123;ownerId&#125;/pets/&#123;petId&#125;&quot;</span>)<br><br>public Pet <span class="hljs-built_in">findPet</span>(<span class="hljs-variable">@PathVariable</span> Long ownerId, <span class="hljs-variable">@PathVariable</span> Long petId) &#123;<br><br>    <span class="hljs-comment">// ...</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p>æ‚¨å¯ä»¥åœ¨ç±»å’Œæ–¹æ³•çº§åˆ«å£°æ˜URIå˜é‡ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Controller</span><span class="hljs-variable">@RequestMapping</span>(<span class="hljs-string">&quot;/owners/&#123;ownerId&#125;&quot;</span>)public class OwnerController &#123;<br>    <span class="hljs-variable">@GetMapping</span>(<span class="hljs-string">&quot;/pets/&#123;petId&#125;&quot;</span>)    public Pet <span class="hljs-built_in">findPet</span>(<span class="hljs-variable">@PathVariable</span> Long ownerId, <span class="hljs-variable">@PathVariable</span> Long petId) &#123;        <span class="hljs-comment">// ...    &#125;&#125;</span><br></code></pre></td></tr></table></figure><p>URIå˜é‡ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºé€‚å½“çš„ç±»å‹ï¼Œæˆ–è€…å¼•å‘ <code>TypeMismatchException</code>ã€‚ é»˜è®¤æƒ…å†µä¸‹æ”¯æŒç®€å•ç±»å‹ï¼ˆ<code>int</code>, <code>long</code>, <code>Date</code>ç­‰ï¼‰ï¼Œæ‚¨ä¹Ÿå¯ä»¥æ³¨å†Œå¯¹ä»»ä½•å…¶ä»–æ•°æ®ç±»å‹çš„æ”¯æŒã€‚ è¯·å‚è§<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-typeconversion">Type Conversion</a> and <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-initbinder"><code>DataBinder</code></a>ã€‚</p><p>ä½ å¯ä»¥æ˜¾ç¤ºå‘½åURI å˜é‡(ä¾‹å¦‚, <code>@PathVariable(&quot;customId&quot;)</code>),ä½†æ˜¯å¦‚æœåç§°æ˜¯ç›¸åŒçš„ï¼Œå¹¶ä¸”ä»£ç æ˜¯ä½¿ç”¨è°ƒè¯•ä¿¡æ¯ç¼–è¯‘çš„ï¼Œæˆ–è€…åœ¨Java 8ä¸­ä½¿ç”¨<code>-parameters</code> ç¼–è¯‘å™¨æ ‡è®°ã€‚ åˆ™å¯ä»¥ä¿ç•™è¯¥è¯¦ç»†ä¿¡æ¯ã€‚</p><p>è¯­æ³•<code>&#123;varName:regex&#125;</code>å£°æ˜ä¸€ä¸ªå…·æœ‰æ­£åˆ™è¡¨è¾¾å¼çš„URIå˜é‡ï¼Œå…¶è¯­æ³•ä¸º<code>&#123;varName:regex&#125;</code>ã€‚ä¾‹å¦‚ï¼Œç»™å®šURL<code>&quot;/spring-web-3.0.5 .jar&quot;</code>ï¼Œä»¥ä¸‹æ–¹æ³•æå–åç§°ï¼Œç‰ˆæœ¬å’Œæ–‡ä»¶æ‰©å±•å:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@GetMapping</span>(<span class="hljs-string">&quot;/&#123;name:[a-z-]+&#125;-&#123;version:\\d\\.\\d\\.\\d&#125;&#123;ext:\\.[a-z]+&#125;&quot;</span>)<br><br>public void <span class="hljs-built_in">handle</span>(<span class="hljs-variable">@PathVariable</span> String version, <span class="hljs-variable">@PathVariable</span> String ext) &#123;<br><br>    <span class="hljs-comment">// ...</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p>URIè·¯å¾„æ¨¡å¼è¿˜å¯ä»¥åµŒå…¥<code>$&#123;â€¦&#125;</code>ï¼Œåœ¨å¯åŠ¨æ—¶é€šè¿‡<code>PropertyPlaceHolderConfigurer</code>è§£ææœ¬åœ°ã€ç³»ç»Ÿã€ç¯å¢ƒå’Œå…¶ä»–å±æ€§æºæ—¶è§£æçš„å ä½ç¬¦ã€‚ä¾‹å¦‚ï¼Œè¿™ç§æ¨¡å¼å¯ä»¥ä½¿ç”¨åŸºäºæŸäº›å¤–éƒ¨é…ç½®å¯¹åŸºURLè¿›è¡Œå‚æ•°åŒ–</p><p>Spring MVCä½¿ç”¨ <code>PathMatcher</code>è”ç³»å’Œ <code>AntPathMatcher</code>å®ç°ä½äº<code>spring-core</code> URIè·¯å¾„åŒ¹é…ã€‚</p><h5 id="æ¨¡å¼æ¯”è¾ƒ"><a href="#æ¨¡å¼æ¯”è¾ƒ" class="headerlink" title="æ¨¡å¼æ¯”è¾ƒ"></a>æ¨¡å¼æ¯”è¾ƒ</h5><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-ann-requestmapping-pattern-comparison">Same as in Spring WebFlux</a></p><p>å½“å¤šä¸ªæ¨¡å¼ä¸URLåŒ¹é…æ—¶ï¼Œå¿…é¡»å¯¹å®ƒä»¬è¿›è¡Œæ¯”è¾ƒä»¥æ‰¾åˆ°æœ€ä½³åŒ¹é…ã€‚ è¿™æ˜¯é€šè¿‡ä½¿ç”¨ <code>AntPathMatcher.getPatternComparator(String path)</code>æ¥å®Œæˆçš„ï¼Œå®ƒä¼šæŸ¥æ‰¾æ›´å…·ä½“çš„æ¨¡å¼ã€‚</p><p>å¦‚æœURIå˜é‡çš„æ•°é‡è¾ƒå°‘ä¸”å•ä¸ªé€šé…ç¬¦è®¡ä¸º1ä¸”åŒé€šé…ç¬¦è®¡ä¸º2ï¼Œé‚£ä¹ˆæ¨¡å¼å°±ä¸é‚£ä¹ˆå…·ä½“äº†ã€‚å¦‚æœæ¨¡å¼å¾—åˆ°çš„åˆ†æ•°ç›¸ç­‰ï¼Œé‚£ä¹ˆä¼šé€‰æ‹©è¾ƒé•¿çš„æ¨¡å¼åŒ¹é…ã€‚å¦‚æœåˆ†æ•°å’Œé•¿åº¦éƒ½ç›¸åŒï¼Œåˆ™ä¼šé€‰æ‹©æ‹¥æœ‰æ¯”é€šé…ç¬¦æ›´å¤šçš„URIå˜é‡çš„æ¨¡å¼ã€‚</p><p>é»˜è®¤æ˜ å°„æ¨¡å¼ï¼ˆ<code>/**</code>ï¼‰ä»è¯„åˆ†ä¸­æ’é™¤ï¼Œå¹¶å§‹ç»ˆæ’åœ¨æœ€åã€‚ æ­¤å¤–ï¼Œå‰ç¼€æ¨¡å¼ï¼ˆä¾‹å¦‚<code>/public/**</code>ï¼‰è¢«è®¤ä¸ºæ¯”æ²¡æœ‰åŒé€šé…ç¬¦çš„å…¶ä»–æ¨¡å¼æ›´ä¸å…·ä½“ã€‚</p><p>æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/util/AntPathMatcher.html"><code>AntPathMatcher</code></a> ä¸­çš„ <a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/util/AntPathMatcher.AntPatternComparator.html"><code>AntPatternComparator</code></a>ã€‚ æ‚¨å¯ä»¥è‡ªå®šä¹‰<a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/util/PathMatcher.html"><code>PathMatcher</code></a> çš„å®ç°. è¯·å‚é˜… é…ç½®ä¸­çš„<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-config-path-matching">Path Matching</a></p><h5 id="åç¼€åŒ¹é…"><a href="#åç¼€åŒ¹é…" class="headerlink" title="åç¼€åŒ¹é…"></a>åç¼€åŒ¹é…</h5><p>é»˜è®¤æƒ…å†µä¸‹,é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring MVCæ‰§è¡Œ<code>.*</code> åç¼€æ¨¡å¼åŒ¹é…ï¼Œä»¥ä¾¿æ˜ å°„åˆ° <code>/person</code>çš„æ§åˆ¶å™¨ä¹Ÿéšå¼æ˜ å°„åˆ° <code>/person.*</code>ã€‚è¿™é‡Œä½¿ç”¨æ–‡ä»¶æ‰©å±•åæ¥è§£é‡Šç”¨äºå“åº”çš„è¯·æ±‚å†…å®¹ç±»å‹ï¼ˆå³ï¼Œè€Œä¸æ˜¯ <code>Accept</code>è¯·æ±‚å¤´ï¼‰ - ä¾‹å¦‚ï¼Œ<code>/person.pdf</code>ï¼Œ<code>/person.xml</code>ç­‰ã€‚</p><p>å½“æµè§ˆå™¨ç”¨äºå‘é€éš¾ä»¥æŒç»­äº¤äº’çš„<code>Accept</code>å¤´æ—¶ï¼Œå¿…é¡»ä»¥è¿™ç§æ–¹å¼ä½¿ç”¨æ–‡ä»¶æ‰©å±•åã€‚ç›®å‰ï¼Œè¿™ä¸å†æ˜¯å¿…éœ€çš„ï¼Œåˆ¤æ–­ <code>Accept</code>å¤´åº”è¯¥æ˜¯é¦–é€‰ã€‚</p><p>éšç€æ—¶é—´çš„æ¨ç§»ï¼Œæ–‡ä»¶æ‰©å±•åçš„ä½¿ç”¨å·²ç»è¯æ˜æœ‰å¤šç§æ–¹å¼å­˜åœ¨é—®é¢˜ã€‚ å½“ä½¿ç”¨URIå˜é‡ï¼Œè·¯å¾„å‚æ•°å’ŒURIç¼–ç è¿›è¡Œè¦†ç›–æ—¶ï¼Œå®ƒå¯èƒ½ä¼šå¯¼è‡´æ­§ä¹‰ã€‚ æœ‰å…³åŸºäºURLçš„æˆæƒå’Œå®‰å…¨æ€§çš„æ¨ç†ï¼ˆæœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…ä¸‹ä¸€èŠ‚ï¼‰ä¹Ÿå˜å¾—æ›´åŠ å›°éš¾ã€‚</p><p>è¦å®Œå…¨ç¦ç”¨æ–‡ä»¶æ‰©å±•åï¼Œå¿…é¡»åŒæ—¶è®¾ç½®ä»¥ä¸‹ä¸¤é¡¹:</p><ul><li><code>useSuffixPatternMatching(false)</code>, see <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-config-path-matching">PathMatchConfigurer</a></li><li><code>favorPathExtension(false)</code>, see <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-config-content-negotiation">ContentNegotiationConfigurer</a></li></ul><p>åŸºäºURLçš„å†…å®¹åå•†ä»ç„¶æœ‰ç”¨ï¼ˆä¾‹å¦‚ï¼Œåœ¨æµè§ˆå™¨ä¸­é”®å…¥URLæ—¶ï¼‰ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨åŸºäºæŸ¥è¯¢å‚æ•°çš„ç­–ç•¥æ¥é¿å…æ–‡ä»¶æ‰©å±•åå¸¦æ¥çš„å¤§å¤šæ•°é—®é¢˜ã€‚ æˆ–è€…ï¼Œå¦‚æœå¿…é¡»ä½¿ç”¨æ–‡ä»¶æ‰©å±•åï¼Œè¯·è€ƒè™‘é€šè¿‡<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-config-content-negotiation">ContentNegotiationConfigurer</a>çš„<code>mediaTypes</code>å±æ€§å°†å®ƒä»¬é™åˆ¶ä¸ºæ˜¾å¼æ³¨å†Œçš„æ‰©å±•ååˆ—è¡¨ã€‚</p><h5 id="åç¼€åŒ¹é…å’ŒRFD"><a href="#åç¼€åŒ¹é…å’ŒRFD" class="headerlink" title="åç¼€åŒ¹é…å’ŒRFD"></a>åç¼€åŒ¹é…å’ŒRFD</h5><p>åå°„æ–‡ä»¶ä¸‹è½½ï¼ˆReflected file downloadï¼‰æ”»å‡»ä¸XSSç±»ä¼¼ï¼Œå› ä¸ºå®ƒä¾èµ–è¯·æ±‚è¾“å…¥ï¼Œä¾‹å¦‚æŸ¥è¯¢å‚æ•°ã€URIå˜é‡ï¼Œå¹¶ä¸”åœ¨å“åº”ä¸­è¢«åå°„ã€‚ä½†æ˜¯ï¼ŒRFDæ”»å‡»ä¸æ˜¯å°†JavaScriptæ’å…¥HTMLï¼Œè€Œæ˜¯ä¾èµ–æµè§ˆå™¨åˆ‡æ¢æ¥æ‰§è¡Œä¸‹è½½ï¼Œè¿›è€Œåœ¨ä¹‹åçš„åŒå‡»æ—¶å°†å“åº”ä½œä¸ºå¯æ‰§è¡Œè„šæœ¬å¤„ç†ã€‚</p><p>åœ¨Spring MVCä¸­ï¼Œ<code>@ResponseBody</code>å’Œ <code>ResponseEntity</code>æ–¹æ³•å­˜åœ¨é£é™©ï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥å‘ˆç°ä¸åŒçš„å†…å®¹ç±»å‹ï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡URLè·¯å¾„æ‰©å±•æ¥è¯·æ±‚ã€‚ ç¦ç”¨åç¼€æ¨¡å¼åŒ¹é…å¹¶ä½¿ç”¨è·¯å¾„æ‰©å±•è¿›è¡Œå†…å®¹åå•†å¯é™ä½é£é™©ï¼Œä½†ä¸è¶³ä»¥é˜²æ­¢RFDæ”»å‡»ã€‚</p><p>ä¸ºäº†é˜²æ­¢RFDæ”»å‡»ï¼Œåœ¨å‘ˆç°å“åº”ä¸»ä½“ä¹‹å‰ï¼Œéœ€è¦åœ¨Spring MVCæ·»åŠ  <code>Content-Disposition:inline;filename=f.txt</code>å¤´ç”¨äºæä¾›å›ºå®šå’Œå®‰å…¨çš„ä¸‹è½½æ–‡ä»¶ã€‚åªæœ‰åœ¨URLè·¯å¾„åŒ…å«çš„æ–‡ä»¶æ‰©å±•åä¸­æ—¢ä¸åŒ…å«ç™½åå•ï¼Œä¹Ÿæ²¡æœ‰ä¸ºå†…å®¹åå•†æ˜¾å¼æ³¨å†Œä»¥æ—¶ï¼Œæ‰éœ€è¦è¿™æ ·åšã€‚ ä½†æ˜¯ï¼Œåœ¨æµè§ˆå™¨ç›´æ¥é”®å…¥URLæ—¶ï¼Œå¯èƒ½ä¼šäº§ç”Ÿå‰¯ä½œç”¨ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæœ‰è®¸å¤šå¸¸è§çš„è·¯å¾„æ‰©å±•ç™½åå•ã€‚å…·æœ‰è‡ªå®šä¹‰<code>HttpMessageConverter</code>å®ç°çš„åº”ç”¨ç¨‹åºå¯ä»¥æ˜¾å¼æ³¨å†Œå†…å®¹åå•†çš„æ–‡ä»¶æ‰©å±•åï¼Œä»¥é¿å…ä¸ºè¿™äº›æ‰©å±•æ·»åŠ <code>Content-Disposition</code> å¤´ã€‚ è¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-config-content-negotiation">Content Types</a></p><p>æœ‰å…³RFDçš„å…¶ä»–å»ºè®®ï¼Œè¯·å‚é˜…<a href="https://pivotal.io/security/cve-2015-5211">CVE-2015-5211</a>ã€‚</p><h5 id="æ¶ˆè´¹è€…åª’ä½“ç±»å‹"><a href="#æ¶ˆè´¹è€…åª’ä½“ç±»å‹" class="headerlink" title="æ¶ˆè´¹è€…åª’ä½“ç±»å‹"></a>æ¶ˆè´¹è€…åª’ä½“ç±»å‹</h5><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-ann-requestmapping-consumes">Same as in Spring WebFlux</a></p><p>æ‚¨å¯ä»¥æ ¹æ®è¯·æ±‚çš„<code>Content-Type</code>ç¼©å°è¯·æ±‚æ˜ å°„èŒƒå›´ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@PostMapping</span>(path = <span class="hljs-string">&quot;/pets&quot;</span>, consumes = <span class="hljs-string">&quot;application/json&quot;</span>) (<span class="hljs-number">1</span>)<br><br>public void <span class="hljs-built_in">addPet</span>(<span class="hljs-variable">@RequestBody</span> Pet pet) &#123;<br><br>    <span class="hljs-comment">// ...</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>1</strong>ã€ä½¿ç”¨ <code>consumes</code>å±æ€§æ¥ç¼©å°å†…å®¹ç±»å‹çš„æ˜ å°„ã€‚</p><p><code>consumes</code>å±æ€§è¿˜æ”¯æŒå¦å®šè¡¨è¾¾å¼ - ä¾‹å¦‚ï¼Œ<code>!text/plain</code>è¡¨ç¤ºé™¤ <code>text/plain</code>ä¹‹å¤–çš„ä»»ä½•å†…å®¹ç±»å‹ã€‚</p><p>æ‚¨å¯ä»¥åœ¨ç±»çº§åˆ«å£°æ˜å…±äº« <code>consumes</code>å±æ€§ã€‚ ä½†æ˜¯ï¼Œä¸å¤§å¤šæ•°å…¶ä»–è¯·æ±‚æ˜ å°„å±æ€§ä¸åŒï¼Œåœ¨ç±»çº§åˆ«ä½¿ç”¨æ—¶ï¼Œæ–¹æ³•çº§åˆ«ä¼š <code>consumes</code> å±æ€§è¦†ç›–è€Œä¸æ˜¯æ‰©å±•ç±»çº§åˆ«å£°æ˜ã€‚</p><p><code>MediaType</code>ä¸ºå¸¸ç”¨åª’ä½“ç±»å‹æä¾›å¸¸é‡ï¼Œä¾‹å¦‚<code>APPLICATION_JSON_VALUE</code> and <code>APPLICATION_XML_VALUE</code>ã€‚</p><h5 id="ç”Ÿäº§è€…åª’ä½“ç±»å‹"><a href="#ç”Ÿäº§è€…åª’ä½“ç±»å‹" class="headerlink" title="ç”Ÿäº§è€…åª’ä½“ç±»å‹"></a>ç”Ÿäº§è€…åª’ä½“ç±»å‹</h5><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-ann-requestmapping-produces">Same as in Spring WebFlux</a></p><p>æ‚¨å¯ä»¥æ ¹æ®<code>Accept</code>è¯·æ±‚å¤´å’Œæ§åˆ¶å™¨æ–¹æ³•ç”Ÿæˆçš„å†…å®¹ç±»å‹åˆ—è¡¨æ¥ç¼©å°è¯·æ±‚æ˜ å°„ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@GetMapping</span>(path = <span class="hljs-string">&quot;/pets/&#123;petId&#125;&quot;</span>, produces = <span class="hljs-string">&quot;application/json;charset=UTF-8&quot;</span>) (<span class="hljs-number">1</span>)<br><br><span class="hljs-variable">@ResponseBody</span><br><br>public Pet <span class="hljs-built_in">getPet</span>(<span class="hljs-variable">@PathVariable</span> String petId) &#123;<br><br>    <span class="hljs-comment">// ...</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>1</strong></p><p>ä½¿ç”¨<code>produces</code>å±æ€§æ¥ç¼©å°å†…å®¹ç±»å‹çš„æ˜ å°„ã€‚</p><p>åª’ä½“ç±»å‹å¯ä»¥æŒ‡å®šå­—ç¬¦é›†ã€‚ æ”¯æŒå¦å®šè¡¨è¾¾å¼ - ä¾‹å¦‚ï¼Œ <code>!text/plain</code>è¡¨ç¤ºâ€text&#x2F;plainâ€ä»¥å¤–çš„ä»»ä½•å†…å®¹ç±»å‹ã€‚</p><p>å¯¹äºJSONå†…å®¹ç±»å‹ï¼Œå³ä½¿ <a href="https://tools.ietf.org/html/rfc7159#section-11">RFC7159</a>æ˜ç¡®å£°æ˜â€œæ²¡æœ‰ä¸ºæ­¤æ³¨å†Œå®šä¹‰charsetå‚æ•°â€ï¼Œä¹Ÿåº”æŒ‡å®šUTF-8å­—ç¬¦é›†ï¼Œå› ä¸ºæŸäº›æµè§ˆå™¨è¦æ±‚å®ƒæ­£ç¡®è§£é‡ŠUTF-8ç‰¹æ®Šå­—ç¬¦ã€‚</p><p>æ‚¨å¯ä»¥åœ¨ç±»çº§åˆ«å£°æ˜å…±äº«çš„<code>produces</code>å±æ€§ã€‚ ä½†æ˜¯ï¼Œä¸å¤§å¤šæ•°å…¶ä»–è¯·æ±‚æ˜ å°„å±æ€§ä¸åŒï¼Œåœ¨ç±»çº§åˆ«ä½¿ç”¨æ—¶ï¼Œæ–¹æ³•çº§åˆ«ä¼šç”Ÿæˆå±æ€§è¦†ç›–ï¼Œè€Œä¸æ˜¯æ‰©å±•ç±»çº§åˆ«å£°æ˜ã€‚</p><p><code>MediaType</code>ä¸ºå¸¸ç”¨åª’ä½“ç±»å‹æä¾›å¸¸é‡ï¼Œä¾‹å¦‚<code>APPLICATION_JSON_UTF8_VALUE</code> and <code>APPLICATION_XML_VALUE</code>ã€‚</p><h5 id="å‚æ•°-è¯·æ±‚å¤´"><a href="#å‚æ•°-è¯·æ±‚å¤´" class="headerlink" title="å‚æ•°, è¯·æ±‚å¤´"></a>å‚æ•°, è¯·æ±‚å¤´</h5><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-ann-requestmapping-params-and-headers">Same as in Spring WebFlux</a></p><p>æ‚¨å¯ä»¥æ ¹æ®è¯·æ±‚å‚æ•°æ¡ä»¶ç¼©å°è¯·æ±‚æ˜ å°„ã€‚ æ‚¨å¯ä»¥æµ‹è¯•æ˜¯å¦å­˜åœ¨è¯·æ±‚å‚æ•°ï¼ˆ<code>myParam</code>ï¼‰ï¼Œç¼ºå°‘ä¸€ä¸ªï¼ˆ<code>!myParam</code>ï¼‰æˆ–ç‰¹å®šå€¼ï¼ˆ<code>myParam=myValue</code>ï¼‰ã€‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•æµ‹è¯•ç‰¹å®šå€¼ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@GetMapping</span>(path = <span class="hljs-string">&quot;/pets/&#123;petId&#125;&quot;</span>, params = <span class="hljs-string">&quot;myParam=myValue&quot;</span>) (<span class="hljs-number">1</span>)<br><br>public void <span class="hljs-built_in">findPet</span>(<span class="hljs-variable">@PathVariable</span> String petId) &#123;<br><br>    <span class="hljs-comment">// ...</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>1</strong>ã€æµ‹è¯•<code>myParam</code>æ˜¯å¦ç­‰äº<code>myValue</code>ã€‚</p><p>æ‚¨è¿˜å¯ä»¥å°†å…¶ä¸è¯·æ±‚å¤´æ¡ä»¶ä¸€èµ·ä½¿ç”¨ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@GetMapping</span>(path = <span class="hljs-string">&quot;/pets&quot;</span>, headers = <span class="hljs-string">&quot;myHeader=myValue&quot;</span>) (<span class="hljs-number">1</span>)<br><br>public void <span class="hljs-built_in">findPet</span>(<span class="hljs-variable">@PathVariable</span> String petId) &#123;<br><br>    <span class="hljs-comment">// ...</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>1</strong>ã€Testing whether <code>myHeader</code> equals <code>myValue</code> ã€‚.</p><p>æ‚¨å¯ä»¥å°† <code>Content-Type</code>å’Œ <code>Accept</code> ä¸headersæ¡ä»¶åŒ¹é…ï¼Œä½†æœ€å¥½ä½¿ç”¨<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-requestmapping-consumes">consumes</a>å’Œ<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-requestmapping-produces">produces</a>æ›¿ä»£ã€‚</p><h5 id="HTTP-HEAD-OPTIONS"><a href="#HTTP-HEAD-OPTIONS" class="headerlink" title="HTTP HEAD, OPTIONS"></a>HTTP HEAD, OPTIONS</h5><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-ann-requestmapping-head-options">Same as in Spring WebFlux</a></p><p><code>@GetMapping</code> (å’Œ <code>@RequestMapping(method=HttpMethod.GET)</code>)ä¸€æ ·ï¼Œä¸ºäº†è¯·æ±‚æ˜ å°„çš„ç›®çš„ï¼Œé€æ˜åœ°æ”¯æŒHTTP HEADä»¥è¿›è¡Œè¯·æ±‚æ˜ å°„ã€‚æ§åˆ¶å™¨æ–¹æ³•æ— éœ€æ›´æ”¹ã€‚ åœ¨<code>javax.servlet.http.HttpServlet</code>ä¸­åº”ç”¨çš„å“åº”åŒ…ç¡®ä¿æœ‰<code>Content-Length</code>æ ‡å¤´å¹¶ä¸”è®¾ç½®ä¸ºå†™å…¥çš„å­—èŠ‚æ•°ï¼Œä½†å®é™…ä¸Šä¸ä¼šå†™å…¥å“åº”ã€‚</p><p><code>@GetMapping</code> (and <code>@RequestMapping(method=HttpMethod.GET)</code>)ä¸€æ ·ï¼Œä¸ºäº†è¯·æ±‚æ˜ å°„çš„ç›®çš„ï¼Œè¢«éšå¼æ˜ å°„åˆ°å¹¶æ”¯æŒHTTP HEADï¼Œå¤„ç†HTTP HEADè¯·æ±‚å°±åƒå®ƒæ˜¯HTTP GETä¸€æ ·ï¼Œä½†ä¸æ˜¯å†™å…¥æ­£æ–‡ï¼Œè€Œæ˜¯è®¡ç®—å­—èŠ‚æ•°å¹¶è®¾ç½® <code>Content-Length</code>å¤´ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒHTTP OPTIONSé€šè¿‡è®¾ç½®<code>Allow</code>å“åº”å¤´æ¥ä¸ºæ‰€æœ‰å…·æœ‰åŒ¹é…URLæ¨¡å¼çš„@RequestMappingæ–¹æ³•ä¸­åˆ—å‡ºçš„HTTPæ–¹æ³•åˆ—è¡¨æ¥å¤„ç†HTTPé€‰é¡¹ã€‚</p><p>å¯¹äºæ²¡æœ‰HTTPæ–¹æ³•å£°æ˜çš„<code>@RequestMapping</code>ï¼ŒAllowè¯·æ±‚å¤´å¯ä»¥è®¾ç½®ä¸º <code>GET,HEAD,POST,PUT,PATCH,DELETE,OPTIONS</code>ã€‚ æ§åˆ¶å™¨æ–¹æ³•åº”å§‹ç»ˆå£°æ˜æ”¯æŒçš„HTTPæ–¹æ³•ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡ä½¿ç”¨ç‰¹å®šäºHTTPæ–¹æ³•çš„å˜ä½“ï¼š<code>@GetMapping</code>, <code>@PostMapping</code>ç­‰ï¼‰ã€‚</p><p>æ‚¨å¯ä»¥å°† <code>@RequestMapping</code> æ–¹æ³•æ˜¾å¼æ˜ å°„åˆ°HTTP HEADå’ŒHTTP OPTIONSï¼Œä½†åœ¨å¸¸è§æƒ…å†µä¸‹è¿™ä¸æ˜¯å¿…éœ€çš„ã€‚</p><h5 id="è‡ªå®šä¹‰æ³¨è§£"><a href="#è‡ªå®šä¹‰æ³¨è§£" class="headerlink" title="è‡ªå®šä¹‰æ³¨è§£"></a>è‡ªå®šä¹‰æ³¨è§£</h5><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#mvc-ann-requestmapping-head-options">Same as in Spring WebFlux</a></p><p>Spring MVCæ”¯æŒä½¿ç”¨ <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/core.html#beans-meta-annotations">ç»„åˆæ³¨è§£</a>è¿›è¡Œè¯·æ±‚æ˜ å°„ã€‚ è¿™äº›æ³¨è§£æœ¬èº«æ˜¯ä½¿ç”¨ <code>@RequestMapping</code>è¿›è¡Œå…ƒæ³¨è§£çš„ï¼Œå¹¶ä¸”ç”¨äºé‡æ–°å£°æ˜å…·æœ‰æ›´çª„ï¼Œæ›´å…·ä½“ç›®çš„çš„ <code>@RequestMapping</code>å±æ€§çš„å­é›†ï¼ˆæˆ–å…¨éƒ¨ï¼‰ã€‚</p><p><code>@GetMapping</code>, <code>@PostMapping</code>, <code>@PutMapping</code>, <code>@DeleteMapping</code>, å’Œ <code>@PatchMapping</code> å°±æ˜¯ç»„åˆæ³¨è§£æœ€å¥½çš„ç¤ºä¾‹ï¼Œ æä¾›å®ƒä»¬æ˜¯å› ä¸ºï¼Œå¯ä»¥è¯´ï¼Œå¤§å¤šæ•°æ§åˆ¶å™¨æ–¹æ³•åº”è¯¥æ˜ å°„åˆ°ç‰¹å®šçš„HTTPæ–¹æ³•ï¼Œè€Œä¸æ˜¯ä½¿ç”¨<code>@RequestMapping</code>ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä¸æ‰€æœ‰HTTPæ–¹æ³•åŒ¹é…ã€‚ å¦‚æœæ‚¨éœ€è¦ç»„åˆæ³¨è§£çš„ç¤ºä¾‹ï¼Œè¯·æŸ¥çœ‹å¦‚ä½•å£°æ˜è¿™äº›æ³¨è§£ã€‚</p><p>Spring MVCè¿˜æ”¯æŒä½¿ç”¨è‡ªå®šä¹‰è¯·æ±‚åŒ¹é…é€»è¾‘çš„è‡ªå®šä¹‰è¯·æ±‚æ˜ å°„å±æ€§ã€‚è¿™æ˜¯ä¸€ä¸ªæ›´é«˜çº§çš„é€‰é¡¹ï¼Œéœ€è¦ç»§æ‰¿<code>RequestMappingHandlerMapping</code> å¹¶è¦†ç›–<code>getCustomMethodCondition</code> æ–¹æ³•ï¼Œ æ‚¨å¯ä»¥åœ¨å…¶ä¸­æ£€æŸ¥è‡ªå®šä¹‰å±æ€§å¹¶è¿”å›è‡ªå·±çš„<code>RequestCondition</code>ã€‚</p><h5 id="æ˜¾å¼æ³¨å†Œ"><a href="#æ˜¾å¼æ³¨å†Œ" class="headerlink" title="æ˜¾å¼æ³¨å†Œ"></a>æ˜¾å¼æ³¨å†Œ</h5><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-ann-requestmapping-registration">Same as in Spring WebFlux</a></p><p>æ‚¨å¯ä»¥ä»¥ç¼–ç¨‹æ–¹å¼æ³¨å†Œå¤„ç†ç¨‹åºæ–¹æ³•ï¼Œæ‚¨å¯ä»¥å°†å…¶ç”¨äºåŠ¨æ€æ³¨å†Œæˆ–é«˜çº§æƒ…å†µï¼Œä¾‹å¦‚ä¸åŒURLä¸‹çš„åŒä¸€å¤„ç†ç¨‹åºçš„ä¸åŒå®ä¾‹ã€‚ ä»¥ä¸‹ç¤ºä¾‹æ³¨å†Œå¤„ç†ç¨‹åºæ–¹æ³•ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">@Configurationpublic <span class="hljs-keyword">class</span> MyConfig &#123;<br>    @Autowired    <span class="hljs-built_in">public</span> <span class="hljs-type">void</span> setHandlerMapping(RequestMappingHandlerMapping <span class="hljs-keyword">mapping</span>, UserHandler <span class="hljs-keyword">handler</span>) (<span class="hljs-number">1</span>)            throws NoSuchMethodException &#123;<br>        RequestMappingInfo <span class="hljs-keyword">info</span> = RequestMappingInfo                .paths(&quot;/user/&#123;id&#125;&quot;).methods(RequestMethod.<span class="hljs-keyword">GET</span>).build(); (<span class="hljs-number">2</span>)<br>        <span class="hljs-keyword">Method</span> <span class="hljs-keyword">method</span> = UserHandler.<span class="hljs-keyword">class</span>.getMethod(&quot;getUser&quot;, Long.<span class="hljs-keyword">class</span>); (<span class="hljs-number">3</span>)<br>        <span class="hljs-keyword">mapping</span>.registerMapping(<span class="hljs-keyword">info</span>, <span class="hljs-keyword">handler</span>, <span class="hljs-keyword">method</span>); (<span class="hljs-number">4</span>)    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>1</strong>ã€ä¸ºæ§åˆ¶å™¨æ³¨å…¥ç›®æ ‡å¤„ç†ç¨‹åºå’Œå¤„ç†ç¨‹åºæ˜ å°„</p><p><strong>2</strong>ã€å‡†å¤‡æ˜ å°„å…ƒæ•°æ®çš„è¯·æ±‚ã€‚</p><p><strong>3</strong>ã€è·å–å¤„ç†ç¨‹åºæ–¹æ³•ã€‚</p><p><strong>4</strong>ã€æ·»åŠ æ³¨å†Œã€‚</p><h4 id="1-3-3-ç¨‹åºå¤„ç†æ–¹æ³•"><a href="#1-3-3-ç¨‹åºå¤„ç†æ–¹æ³•" class="headerlink" title="1.3.3. ç¨‹åºå¤„ç†æ–¹æ³•"></a>1.3.3. ç¨‹åºå¤„ç†æ–¹æ³•</h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-ann-methods">Same as in Spring WebFlux</a></p><p><code>@RequestMapping</code> å¤„ç†ç¨‹åºæ–¹æ³•å…·æœ‰çµæ´»çš„ç­¾å,å¯ä»¥ä»ä¸€ç³»åˆ—å—æ”¯æŒçš„æ§åˆ¶å™¨æ–¹æ³•å‚æ•°å’Œè¿”å›å€¼ä¸­è¿›è¡Œé€‰æ‹©.</p><h5 id="æ–¹æ³•å‚æ•°"><a href="#æ–¹æ³•å‚æ•°" class="headerlink" title="æ–¹æ³•å‚æ•°"></a>æ–¹æ³•å‚æ•°</h5><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-ann-arguments">Same as in Spring WebFlux</a></p><p>ä¸‹è¡¨æ˜¾ç¤ºäº†å—æ”¯æŒçš„æ§åˆ¶å™¨æ–¹æ³•å‚æ•°ï¼Œä»»ä½•å‚æ•°éƒ½ä¸æ”¯æŒå“åº”å¼(Reactive)ç±»å‹ã€‚</p><p>JDK 8â€™s <code>java.util.Optional</code> ä½œä¸ºæ–¹æ³•å‚æ•°æ¥æ”¯æŒçš„ï¼Œå®ƒä¸å…·æœ‰å¿…éœ€å±æ€§çš„æ³¨è§£(ä¾‹å¦‚<code>@RequestParam</code>, <code>@RequestHeader</code>ç­‰ç›¸ç»“åˆ)ã€‚ å¹¶ä¸”ç­‰åŒäº<code>required=false</code>ã€‚</p><table><thead><tr><th>æ§åˆ¶å™¨æ–¹æ³•å‚æ•°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>WebRequest</code>, <code>NativeWebRequest</code></td><td>æ— éœ€ç›´æ¥ä½¿ç”¨Servlet APIå³å¯è®¿é—®è¯·æ±‚å‚æ•°ä»¥åŠrequestå’Œsessionå±æ€§ã€‚</td></tr><tr><td><code>javax.servlet.ServletRequest</code>, <code>javax.servlet.ServletResponse</code></td><td>é€‰æ‹©ä»»ä½•ç‰¹å®šçš„è¯·æ±‚æˆ–å“åº”ç±»å‹ - ä¾‹å¦‚ï¼Œ<code>ServletRequest</code>, <code>HttpServletRequest</code>æˆ–Springçš„<code>MultipartRequest</code>, <code>MultipartHttpServletRequest</code>ã€‚</td></tr><tr><td><code>javax.servlet.http.HttpSession</code></td><td>å¼ºåˆ¶è¿›è¡Œä¼šè¯ã€‚ å› æ­¤ï¼Œæ­¤ç±»å‚æ•°æ°¸è¿œä¸å¯èƒ½ä¸º<code>null</code>. è¯·æ³¨æ„ï¼Œä¼šè¯è®¿é—®ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ å¦‚æœå…è®¸å¤šä¸ªè¯·æ±‚åŒæ—¶è®¿é—®ä¼šè¯ï¼Œè¯·è€ƒè™‘å°†<code>RequestMappingHandlerAdapter</code>å®ä¾‹çš„<code>synchronizeOnSession</code>æ ‡å¿—è®¾ç½®ä¸ºtrueã€‚</td></tr><tr><td><code>javax.servlet.http.PushBuilder</code></td><td>Spring4.0 pushç”Ÿæˆå™¨APIç”¨äºç¼–ç¨‹HTTP&#x2F;2èµ„æºæ¨é€ï¼Œ è¯·æ³¨æ„ï¼Œæ ¹æ®Servletè§„èŒƒï¼Œå¦‚æœå®¢æˆ·ç«¯ä¸æ”¯æŒè¯¥HTTP&#x2F;2åŠŸèƒ½ï¼Œåˆ™æ³¨å…¥çš„<code>PushBuilder</code>å®ä¾‹å¯ä»¥ä¸ºnullã€‚</td></tr><tr><td><code>java.security.Principal</code></td><td>å½“å‰ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ· - å¦‚æœå·²çŸ¥ï¼Œå¯èƒ½æ˜¯ç‰¹å®šçš„<code>Principal</code>å®ç°ç±»ã€‚</td></tr><tr><td><code>HttpMethod</code></td><td>è¯·æ±‚çš„HTTPæ–¹æ³•ã€‚</td></tr><tr><td><code>java.util.Locale</code></td><td>å½“å‰è¯·æ±‚åŒºåŸŸè®¾ç½®ï¼Œç”±æœ€å¯ç”¨çš„<code>LocaleResolver</code>ï¼ˆå®é™…ä¸Šæ˜¯å·²é…ç½®çš„ <code>LocaleResolver</code>æˆ–<code>LocaleContextResolver</code>ï¼‰ç¡®å®šã€‚</td></tr><tr><td><code>java.util.TimeZone</code> + <code>java.time.ZoneId</code></td><td>ä¸å½“å‰è¯·æ±‚å…³è”çš„æ—¶åŒºï¼Œç”±<code>LocaleContextResolver</code>ç¡®å®šã€‚</td></tr><tr><td><code>java.io.InputStream</code>, <code>java.io.Reader</code></td><td>ç”¨äºè®¿é—®Servlet APIå…¬å¼€çš„åŸå§‹è¯·æ±‚ä¸»ä½“ã€‚</td></tr><tr><td><code>java.io.OutputStream</code>, <code>java.io.Writer</code></td><td>ç”¨äºè®¿é—®Servlet APIå…¬å¼€çš„åŸå§‹å“åº”ä¸»ä½“ã€‚</td></tr><tr><td><code>@PathVariable</code></td><td>ç”¨äºè®¿é—®URIæ¨¡æ¿å˜é‡ã€‚ è¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-requestmapping-uri-templates">URIæ¨¡å¼</a>ã€‚</td></tr><tr><td><code>@MatrixVariable</code></td><td>ç”¨äºè®¿é—®URIè·¯å¾„æ®µä¸­çš„åç§° - å€¼å¯¹ã€‚ è¯·å‚è§<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-matrix-variables">çŸ©é˜µå˜é‡</a>ã€‚</td></tr><tr><td><code>@RequestParam</code></td><td>ç”¨äºè®¿é—®Servletè¯·æ±‚å‚æ•°ï¼ŒåŒ…æ‹¬å¤šéƒ¨åˆ†æ–‡ä»¶ã€‚ å‚æ•°å€¼å°†è½¬æ¢ä¸ºå£°æ˜çš„æ–¹æ³•å‚æ•°ç±»å‹ã€‚ è¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-requestparam"><code>@RequestParam</code></a>ä»¥åŠ<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-multipart-forms">Multipart</a>ã€‚ è¯·æ³¨æ„ï¼Œå¯¹äºç®€å•çš„å‚æ•°å€¼ï¼Œä½¿ç”¨<code>@RequestParam</code>æ˜¯å¯é€‰çš„ã€‚ è¯·å‚é˜…æœ¬è¡¨æœ«å°¾çš„â€œä»»ä½•å…¶ä»–å‚æ•°â€ã€‚</td></tr><tr><td><code>@RequestHeader</code></td><td>ç”¨äºè®¿é—®è¯·æ±‚å¤´ã€‚ å¤´çš„å€¼å°†è½¬æ¢ä¸ºå£°æ˜çš„æ–¹æ³•å‚æ•°ç±»å‹ã€‚ è¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-requestheader"><code>@RequestHeader</code></a>ã€‚</td></tr><tr><td><code>@CookieValue</code></td><td>ç”¨äºè®¿é—®cookieã€‚ Cookieå€¼å°†è½¬æ¢ä¸ºå£°æ˜çš„æ–¹æ³•å‚æ•°ç±»å‹ã€‚ è¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-cookievalue"><code>@CookieValue</code></a>ã€‚</td></tr><tr><td><code>@RequestBody</code></td><td>ç”¨äºè®¿é—®HTTPè¯·æ±‚æ­£æ–‡ã€‚ é€šè¿‡ä½¿ç”¨<code>HttpMessageConverter</code>å®ç°å°†æ­£æ–‡å†…å®¹è½¬æ¢ä¸ºå£°æ˜çš„æ–¹æ³•å‚æ•°ç±»å‹ã€‚ è¯·å‚é˜… <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-requestbody"><code>@RequestBody</code></a>ã€‚</td></tr><tr><td><code>HttpEntity&lt;B&gt;</code></td><td>ç”¨äºè®¿é—®è¯·æ±‚æ ‡å¤´å’Œæ­£æ–‡ã€‚ ä½¿ç”¨<code>HttpMessageConverter</code>è½¬æ¢æ­£æ–‡ã€‚ è§<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-httpentity">HttpEntity</a>ã€‚</td></tr><tr><td><code>@RequestPart</code></td><td>è¦è®¿é—®<code>multipart/form-data</code>è¯·æ±‚ä¸­çš„éƒ¨ä»¶ï¼Œè¯·ä½¿ç”¨<code>HttpMessageConverter</code>è½¬æ¢éƒ¨ä»¶çš„ä¸»ä½“ã€‚ è§<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-multipart-forms">Multipart</a>ã€‚</td></tr><tr><td><code>java.util.Map</code>, <code>org.springframework.ui.Model</code>, <code>org.springframework.ui.ModelMap</code></td><td>ç”¨äºè®¿é—®HTMLæ§åˆ¶å™¨ä¸­ä½¿ç”¨çš„æ¨¡å‹ï¼Œå¹¶å°†å…¶ä½œä¸ºè§†å›¾å‘ˆç°çš„ä¸€éƒ¨åˆ†æš´éœ²ç»™æ¨¡æ¿ã€‚</td></tr><tr><td><code>RedirectAttributes</code></td><td>æŒ‡å®šåœ¨é‡å®šå‘ï¼ˆå³ï¼Œè¦é™„åŠ åˆ°æŸ¥è¯¢å­—ç¬¦ä¸²ï¼‰æ—¶ä½¿ç”¨çš„å±æ€§ï¼Œä»¥åŠä¸´æ—¶å­˜å‚¨çš„flashå±æ€§ï¼Œç›´åˆ°é‡å®šå‘åçš„è¯·æ±‚ä¸ºæ­¢ã€‚ è¯·å‚é˜… <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-redirecting-passing-data">é‡å®šå‘å±æ€§</a>å’Œ<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-flash-attributes">Flashå±æ€§</a>ã€‚</td></tr><tr><td><code>@ModelAttribute</code></td><td>ç”¨äºè®¿é—®æ¨¡å‹ä¸­çš„ç°æœ‰å±æ€§ï¼ˆå¦‚æœä¸å­˜åœ¨åˆ™å®ä¾‹åŒ–ï¼‰ï¼Œå¹¶åº”ç”¨æ•°æ®ç»‘å®šå’ŒéªŒè¯ã€‚ è¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-modelattrib-method-args"><code>@ModelAttribute</code></a> ä»¥åŠ<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-modelattrib-methods">Model</a>å’Œ<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-initbinder"><code>DataBinder</code></a>ã€‚è¯·æ³¨æ„ï¼Œä½¿ç”¨<code>@ModelAttribute</code> æ˜¯å¯é€‰çš„ï¼ˆä¾‹å¦‚ï¼Œè®¾ç½®å…¶å±æ€§ï¼‰ã€‚ è¯·å‚é˜…æœ¬è¡¨æœ«å°¾çš„â€œä»»ä½•å…¶ä»–å‚æ•°â€ã€‚</td></tr><tr><td><code>Errors</code>, <code>BindingResult</code></td><td>ç”¨äºè®¿é—®æ¥è‡ªå‘½ä»¤å¯¹è±¡çš„éªŒè¯å’Œæ•°æ®ç»‘å®šçš„é”™è¯¯ï¼ˆå³ <code>@ModelAttribute</code>å‚æ•°ï¼‰æˆ–æ¥è‡ªéªŒè¯ <code>@RequestBody</code>æˆ– <code>@RequestPart</code> å‚æ•°çš„é”™è¯¯ã€‚ æ‚¨å¿…é¡»åœ¨ç»è¿‡éªŒè¯çš„æ–¹æ³•å‚æ•°åç«‹å³å£°æ˜<code>Errors</code>æˆ–<code>BindingResult</code>å‚æ•°ã€‚</td></tr><tr><td><code>SessionStatus</code> + class-level <code>@SessionAttributes</code></td><td>ç”¨äºæ ‡è®°è¡¨å•å¤„ç†å®Œæˆï¼Œä»è€Œè§¦å‘é€šè¿‡ç±»çº§åˆ«<code>@SessionAttributes</code>æ³¨è§£å£°æ˜çš„ä¼šè¯å±æ€§çš„æ¸…é™¤ã€‚ æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-sessionattributes"><code>@SessionAttributes</code></a>ã€‚</td></tr><tr><td><code>UriComponentsBuilder</code></td><td>ç”¨äºå‡†å¤‡ç›¸å¯¹äºå½“å‰è¯·æ±‚çš„ä¸»æœºï¼Œç«¯å£ï¼Œæ–¹æ¡ˆï¼Œä¸Šä¸‹æ–‡è·¯å¾„å’Œservletæ˜ å°„çš„æ–‡å­—éƒ¨åˆ†çš„URLã€‚ è¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-uri-building">URI Links</a>ã€‚</td></tr><tr><td><code>@SessionAttribute</code></td><td>ç”¨äºè®¿é—®ä»»ä½•ä¼šè¯å±æ€§ï¼Œä¸ç”±äºç±»çº§åˆ«<code>@SessionAttributes</code>å£°æ˜çš„ç»“æŸå½¢æˆå¯¹æ¯”ã€‚ æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-sessionattribute"><code>@SessionAttribute</code></a>ã€‚</td></tr><tr><td><code>@RequestAttribute</code></td><td>ç”¨äºè®¿é—®è¯·æ±‚å±æ€§ã€‚ æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-requestattrib"><code>@RequestAttribute</code></a>ã€‚</td></tr><tr><td>Any other argument</td><td>å¦‚æœæ–¹æ³•å‚æ•°ä¸æ­¤è¡¨ä¸­çš„ä»»ä½•å€¼ä¸åŒ¹é…ï¼Œå¹¶ä¸”å®ƒæ˜¯ä¸€ä¸ªç®€å•ç±»å‹ï¼ˆç”± <a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/beans/BeanUtils.html#isSimpleProperty-java.lang.Class-">BeanUtils#isSimpleProperty</a>ç¡®å®šï¼Œ åˆ™å®ƒè¢«è§£æä¸º <code>@RequestParam</code>ã€‚å¦åˆ™ï¼Œå®ƒå°†è¢«è§£æä¸º<code>@ModelAttribute</code>ã€‚</td></tr></tbody></table><h5 id="è¿”å›å€¼"><a href="#è¿”å›å€¼" class="headerlink" title="è¿”å›å€¼"></a>è¿”å›å€¼</h5><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-ann-return-types">Same as in Spring WebFlux</a></p><p>ä¸‹è¡¨æè¿°äº†æ”¯æŒçš„æ§åˆ¶å™¨æ–¹æ³•è¿”å›å€¼ã€‚ æ‰€æœ‰è¿”å›å€¼éƒ½æ”¯æŒå“åº”å¼ç±»å‹ã€‚</p><table><thead><tr><th>æ§åˆ¶å™¨æ–¹æ³•è¿”å›å€¼</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>@ResponseBody</code></td><td>è¿”å›å€¼é€šè¿‡<code>HttpMessageConverter</code>å®ç°è½¬æ¢å¹¶å†™å…¥å“åº”ã€‚ è¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-responsebody"><code>@ResponseBody</code></a>ã€‚</td></tr><tr><td><code>HttpEntity&lt;B&gt;</code>, <code>ResponseEntity&lt;B&gt;</code></td><td>æŒ‡å®šå®Œæ•´å“åº”ï¼ˆåŒ…æ‹¬HTTPå¤´å’Œä¸»ä½“ï¼‰çš„è¿”å›å€¼å°†é€šè¿‡ <code>HttpMessageConverter</code>å®ç°è½¬æ¢å¹¶å†™å…¥å“åº”ã€‚ è¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-responseentity">ResponseEntity</a>ã€‚</td></tr><tr><td><code>HttpHeaders</code></td><td>ç”¨äºè¿”å›å¸¦å¤´éƒ¨ä¿¡æ¯ä¸”æ²¡æœ‰æ­£æ–‡çš„å“åº”ã€‚</td></tr><tr><td><code>String</code></td><td>è¦ä½¿ç”¨<code>ViewResolver</code>å®ç°è§£æçš„è§†å›¾åç§°ï¼Œå¹¶ä¸éšå¼æ¨¡å‹ä¸€èµ·ä½¿ç”¨ - é€šè¿‡å‘½ä»¤å¯¹è±¡å’Œ <code>@ModelAttribute</code>æ–¹æ³•ç¡®å®šã€‚ å¤„ç†ç¨‹åºæ–¹æ³•è¿˜å¯ä»¥é€šè¿‡å£°æ˜ <code>Model</code>å‚æ•°ä»¥ç¼–ç¨‹æ–¹å¼ä¸°å¯Œæ¨¡å‹ï¼ˆè¯·å‚é˜… <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-requestmapping-registration">æ˜¾å¼æ³¨å†Œ</a>ï¼‰ã€‚</td></tr><tr><td><code>View</code></td><td>ç”¨äºä¸éšå¼æ¨¡å‹ä¸€èµ·å‘ˆç°çš„<code>View</code>å®ä¾‹ - é€šè¿‡å‘½ä»¤å¯¹è±¡å’Œ<code>@ModelAttribute</code>æ–¹æ³•ç¡®å®šã€‚ å¤„ç†ç¨‹åºæ–¹æ³•è¿˜å¯ä»¥é€šè¿‡å£°æ˜<code>Model</code>å‚æ•°ä»¥ç¼–ç¨‹æ–¹å¼ä¸°å¯Œæ¨¡å‹ï¼ˆè¯·å‚é˜… <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-requestmapping-registration">æ˜¾å¼æ³¨å†Œ</a>ï¼‰ã€‚</td></tr><tr><td><code>java.util.Map</code>, <code>org.springframework.ui.Model</code></td><td>è¦æ·»åŠ åˆ°éšå¼æ¨¡å‹çš„å±æ€§ï¼Œé€šè¿‡<code>RequestToViewNameTranslator</code>éšå¼ç¡®å®šè§†å›¾åç§°ã€‚</td></tr><tr><td><code>@ModelAttribute</code></td><td>è¦æ·»åŠ åˆ°æ¨¡å‹çš„å±æ€§ï¼Œé€šè¿‡<code>RequestToViewNameTranslator</code>éšå¼ç¡®å®šè§†å›¾åç§°ã€‚è¯·æ³¨æ„ï¼Œ<code>@ModelAttribute</code>æ˜¯å¯é€‰çš„ã€‚ è¯·å‚é˜…æœ¬è¡¨æœ«å°¾çš„â€œä»»ä½•å…¶ä»–è¿”å›å€¼â€ã€‚</td></tr><tr><td><code>ModelAndView</code> object</td><td>è¦ä½¿ç”¨çš„è§†å›¾å’Œæ¨¡å‹å±æ€§ï¼Œä»¥åŠï¼ˆå¯é€‰ï¼‰å“åº”çŠ¶æ€ã€‚</td></tr><tr><td><code>void</code></td><td>å¦‚æœå…·æœ‰<code>void</code>è¿”å›ç±»å‹ï¼ˆæˆ–è¿”å›å€¼ä¸º <code>null</code> ï¼‰çš„æ–¹æ³•ï¼Œå¦‚æœå®ƒè¿˜å…·æœ‰<code>ServletResponse</code>ï¼Œ<code>OutputStream</code>å‚æ•°æˆ–<code>@ResponseStatus</code>æ³¨è§£ï¼Œ åˆ™è®¤ä¸ºå·²å®Œå…¨å¤„ç†è¯¥å“åº”ã€‚ å¦‚æœæ§åˆ¶å™¨å·²è¿›è¡Œæ­£<code>ETag</code>æˆ–<code>lastModified</code> æ—¶é—´æˆ³æ£€æŸ¥ï¼Œåˆ™ä¹Ÿæ˜¯å¦‚æ­¤ï¼ˆæœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-caching-etag-lastmodified">Controllers</a>ï¼‰ã€‚å¦‚æœä»¥ä¸Šéƒ½ä¸æ˜¯çœŸçš„ï¼Œåˆ™<code>void</code>è¿”å›ç±»å‹ä¹Ÿå¯ä»¥æŒ‡ç¤ºRESTæ§åˆ¶å™¨çš„â€œæ— å“åº”ä¸»ä½“â€æˆ–HTMLæ§åˆ¶å™¨çš„é»˜è®¤è§†å›¾åç§°é€‰æ‹©ã€‚</td></tr><tr><td><code>DeferredResult&lt;V&gt;</code></td><td>ä»ä»»ä½•çº¿ç¨‹å¼‚æ­¥ç”Ÿæˆä»»ä½•å‰é¢çš„è¿”å›å€¼ - ä¾‹å¦‚ï¼Œç”±äºæŸäº›äº‹ä»¶æˆ–å›è°ƒã€‚ è¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-async">Asynchronous Requests</a> å’Œ <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-async-deferredresult"><code>DeferredResult</code></a>.</td></tr><tr><td><code>Callable&lt;V&gt;</code></td><td>åœ¨Spring MVCç®¡ç†çš„çº¿ç¨‹ä¸­å¼‚æ­¥ç”Ÿæˆä¸Šè¿°ä»»ä½•è¿”å›å€¼ã€‚ è¯·å‚é˜… <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-async">Asynchronous Requests</a> å’Œ <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-async-callable"><code>Callable</code></a>.</td></tr><tr><td><code>ListenableFuture&lt;V&gt;</code>, <code>java.util.concurrent.CompletionStage&lt;V&gt;</code>, <code>java.util.concurrent.CompletableFuture&lt;V&gt;</code></td><td>ä½œä¸ºæ›¿ä»£<code>DeferredResult</code>çš„ä¾¿æ·æ“ä½œï¼ˆä¾‹å¦‚ï¼Œå½“åº•å±‚æœåŠ¡è¿”å›å…¶ä¸­ä¸€ä¸ªæ—¶ï¼‰ã€‚</td></tr><tr><td><code>ResponseBodyEmitter</code>, <code>SseEmitter</code></td><td>ä½¿ç”¨<code>HttpMessageConverter</code>å®ç°ä»¥å¼‚æ­¥æ–¹å¼å‘é€å¯¹è±¡æµä»¥å†™å…¥å“åº”ã€‚ è¿˜æ”¯æŒ<code>ResponseEntity</code>çš„ä¸»ä½“ã€‚ è¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-async">Asynchronous Requests</a> and <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-async-http-streaming">HTTP Streaming</a>.</td></tr><tr><td><code>StreamingResponseBody</code></td><td>å¼‚æ­¥å†™å…¥å“åº”<code>OutputStream</code>ã€‚ è¿˜æ”¯æŒ<code>ResponseEntity</code>çš„ä¸»ä½“ã€‚ è¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-async">Asynchronous Requests</a> and <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-async-http-streaming">HTTP Streaming</a>.</td></tr><tr><td>Reactive typesâ€‰â€”â€‰Reactor, RxJava, or others through <code>ReactiveAdapterRegistry</code></td><td>ä½¿ç”¨multi-valueæµï¼ˆä¾‹å¦‚ï¼Œ<code>Flux</code>, <code>Observable</code>ï¼‰æ›¿ä»£<code>DeferredResult</code>æ”¶é›†åˆ°<code>List</code>ä¸­ã€‚å¯¹äºæµå¼åœºæ™¯(ä¾‹å¦‚, <code>text/event-stream</code>, <code>application/json+stream</code>), <code>SseEmitter</code> å’Œ <code>ResponseBodyEmitter</code> ä½¿ç”¨çš„æ˜¯åœ¨Spring MVC ç®¡ç†çš„çº¿ç¨‹ä¸Šæ‰§è¡Œ<code>ServletOutputStream</code>é˜»å¡I&#x2F;Oï¼Œè¿™æ˜¯ é’ˆå¯¹æ¯ä¸€ä¸ªWriteçš„ã€‚è¯·å‚é˜… <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-async">Asynchronous Requests</a> å’Œ <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-async-reactive-types">Reactive Types</a>.</td></tr><tr><td>Any other return value</td><td>ä»»ä½•ä¸æ­¤è¡¨ä¸­ä»»ä½•æ—©æœŸå€¼ä¸åŒ¹é…ä¸”è¿”å›å€¼ä¸º<code>String</code> æˆ–<code>void</code>çš„è¿”å›å€¼éƒ½è¢«è§†ä¸ºè§†å›¾åç§°ï¼ˆé€šè¿‡<code>RequestToViewNameTranslator</code>åº”ç”¨é»˜è®¤è§†å›¾åç§°é€‰æ‹©ï¼‰ï¼Œ å‰ææ˜¯å®ƒä¸æ˜¯ç®€å•ç±»å‹ï¼Œç”± <a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/beans/BeanUtils.html#isSimpleProperty-java.lang.Class-">BeanUtils#isSimpleProperty</a>ç¡®å®šï¼Œç®€å•ç±»å‹çš„å€¼ä»æœªè§£å†³ã€‚</td></tr></tbody></table><h5 id="ç±»å‹è½¬æ¢"><a href="#ç±»å‹è½¬æ¢" class="headerlink" title="ç±»å‹è½¬æ¢"></a>ç±»å‹è½¬æ¢</h5><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-ann-typeconversion">Same as in Spring WebFlux</a></p><p>å¦‚æœå‚æ•°å£°æ˜ä¸ºStringä»¥å¤–çš„å…¶ä»–å‚æ•°ï¼Œåˆ™è¡¨ç¤ºæŸäº›å¸¦æ³¨è§£çš„æ§åˆ¶å™¨æ–¹æ³•å‚æ•°ï¼ˆä¾‹å¦‚<code>@RequestParam</code>, <code>@RequestHeader</code>, <code>@PathVariable</code>, <code>@MatrixVariable</code>, å’Œ <code>@CookieValue</code>ï¼‰å¯èƒ½éœ€è¦è¿›è¡Œç±»å‹è½¬æ¢ã€‚</p><p>å¯¹äºæ­¤ç±»æƒ…å†µï¼Œå°†æ ¹æ®é…ç½®çš„è½¬æ¢å™¨è‡ªåŠ¨åº”ç”¨ç±»å‹è½¬æ¢ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ”¯æŒç®€å•ç±»å‹ï¼ˆ<code>int</code>, <code>long</code>, <code>Date</code>å’Œå…¶ä»–ï¼‰ã€‚ æ‚¨å¯ä»¥é€šè¿‡<code>WebDataBinder</code>ï¼ˆè¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-initbinder"><code>DataBinder</code></a>ï¼‰æˆ–ä½¿ç”¨<code>FormattingConversionService</code>æ³¨å†Œ<code>Formatters</code>æ¥è‡ªå®šä¹‰ç±»å‹è½¬æ¢ã€‚ è¯·å‚è§ <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/core.html#format">Spring Field Formatting</a>ã€‚</p><h5 id="çŸ©é˜µå˜é‡"><a href="#çŸ©é˜µå˜é‡" class="headerlink" title="çŸ©é˜µå˜é‡"></a>çŸ©é˜µå˜é‡</h5><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-ann-matrix-variables">Same as in Spring WebFlux</a></p><p><a href="https://tools.ietf.org/html/rfc3986#section-3.3">RFC 3986</a>è®¨è®ºäº†è·¯å¾„æ®µä¸­çš„æºå¸¦é”®å€¼å¯¹ã€‚ åœ¨Spring MVCä¸­ï¼Œæˆ‘ä»¬å°†é‚£äº›åŸºäºTim Berners-Leeçš„ <a href="https://www.w3.org/DesignIssues/MatrixURIs.html">â€œold postâ€</a> ç§°ä¸ºâ€œçŸ©é˜µå˜é‡â€ï¼Œä½†å®ƒä»¬ä¹Ÿå¯ä»¥ç§°ä¸ºURIè·¯å¾„å‚æ•°ã€‚</p><p>çŸ©é˜µå˜é‡å¯ä»¥åœ¨ä»»æ„è·¯å¾„æ®µè½ä¸­å‡ºç°ï¼Œæ¯å¯¹çŸ©é˜µå˜é‡ä¹‹é—´ä½¿ç”¨åˆ†å·éš”å¼€ï¼Œå¤šä¸ªå€¼å¯ä»¥ç”¨é€—å·éš”å¼€ï¼ˆä¾‹å¦‚ï¼Œ<code>/cars;color=red,green;year=2012</code>ï¼‰ï¼Œ ä¹Ÿå¯ä»¥é€šè¿‡é‡å¤çš„å˜é‡åç§°æŒ‡å®šå¤šä¸ªå€¼ï¼ˆä¾‹å¦‚ï¼Œ<code>color=red;color=green;color=blue</code>ï¼‰ã€‚</p><p>å¦‚æœURLæœ‰å¯èƒ½ä¼šåŒ…å«çŸ©é˜µå˜é‡ï¼Œé‚£ä¹ˆåœ¨è¯·æ±‚è·¯å¾„çš„æ˜ å°„é…ç½®ä¸Šå°±éœ€è¦ä½¿ç”¨URIæ¨¡æ¿æ¥ä½“ç°ã€‚è¿™æ ·æ‰èƒ½ç¡®ä¿è¯·æ±‚å¯ä»¥è¢«æ­£ç¡®åœ°æ˜ å°„ï¼Œè€Œä¸ç®¡çŸ©é˜µå˜é‡åœ¨URIä¸­æ˜¯å¦å‡ºç°ã€å‡ºç°çš„æ¬¡åºæ˜¯æ€æ ·çš„ç­‰ã€‚ä»¥ä¸‹ç¤ºä¾‹ä½¿ç”¨çŸ©é˜µå˜é‡ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-comment">// GET /pets/42;q=11;r=22</span><br><span class="hljs-variable">@GetMapping</span>(<span class="hljs-string">&quot;/pets/&#123;petId&#125;&quot;</span>)public void <span class="hljs-built_in">findPet</span>(<span class="hljs-variable">@PathVariable</span> String petId, <span class="hljs-variable">@MatrixVariable</span> int q) &#123;<br>    <span class="hljs-comment">// petId == 42    // q == 11&#125;</span><br></code></pre></td></tr></table></figure><p>ç”±äºä»»æ„è·¯å¾„æ®µè½ä¸­éƒ½å¯ä»¥å«æœ‰çŸ©é˜µå˜é‡ï¼Œåœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œå¼€å‘è€…éœ€è¦ç”¨æ›´ç²¾ç¡®çš„ä¿¡æ¯æ¥æŒ‡å®šçŸ©é˜µå˜é‡çš„ä½ç½®ã€‚ä»¥ä¸‹ç¤ºä¾‹è¯´æ˜å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-comment">// GET /owners/42;q=11/pets/21;q=22</span><br><span class="hljs-variable">@GetMapping</span>(<span class="hljs-string">&quot;/owners/&#123;ownerId&#125;/pets/&#123;petId&#125;&quot;</span>)public void <span class="hljs-built_in">findPet</span>(        <span class="hljs-variable">@MatrixVariable</span>(name=<span class="hljs-string">&quot;q&quot;</span>, pathVar=<span class="hljs-string">&quot;ownerId&quot;</span>) int q1,        <span class="hljs-variable">@MatrixVariable</span>(name=<span class="hljs-string">&quot;q&quot;</span>, pathVar=<span class="hljs-string">&quot;petId&quot;</span>) int q2) &#123;<br>    <span class="hljs-comment">// q1 == 11    // q2 == 22&#125;</span><br></code></pre></td></tr></table></figure><p>çŸ©é˜µå˜é‡å¯ä»¥å®šä¹‰ä¸ºå¯é€‰ï¼Œå¹¶æŒ‡å®šé»˜è®¤å€¼ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-comment">// GET /pets/42</span><br><span class="hljs-variable">@GetMapping</span>(<span class="hljs-string">&quot;/pets/&#123;petId&#125;&quot;</span>)public void <span class="hljs-built_in">findPet</span>(<span class="hljs-variable">@MatrixVariable</span>(required=false, defaultValue=<span class="hljs-string">&quot;1&quot;</span>) int q) &#123;<br>    <span class="hljs-comment">// q == 1&#125;</span><br></code></pre></td></tr></table></figure><p>è¦è·å–æ‰€æœ‰çŸ©é˜µå˜é‡ï¼Œå¯ä»¥ä½¿ç”¨<code>MultiValueMap</code>ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-comment">// GET /owners/42;q=11;r=12/pets/21;q=22;s=23</span><br><span class="hljs-variable">@GetMapping</span>(<span class="hljs-string">&quot;/owners/&#123;ownerId&#125;/pets/&#123;petId&#125;&quot;</span>)public void <span class="hljs-built_in">findPet</span>(        <span class="hljs-variable">@MatrixVariable</span> MultiValueMap&lt;String, String&gt; matrixVars,        <span class="hljs-variable">@MatrixVariable</span>(pathVar=<span class="hljs-string">&quot;petId&quot;</span>) MultiValueMap&lt;String, String&gt; petMatrixVars) &#123;<br>    <span class="hljs-comment">// matrixVars: [&quot;q&quot; : [11,22], &quot;r&quot; : 12, &quot;s&quot; : 23]    // petMatrixVars: [&quot;q&quot; : 22, &quot;s&quot; : 23]&#125;</span><br></code></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œæ‚¨éœ€è¦å¯ç”¨çŸ©é˜µå˜é‡çš„ä½¿ç”¨ã€‚ åœ¨MVC Javaé…ç½®ä¸­ï¼Œæ‚¨éœ€è¦é€šè¿‡ <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-config-path-matching">è·¯å¾„åŒ¹é…</a>å°†<code>removeSemicolonContent=false</code> è®¾ç½®ä¸º<code>UrlPathHelper</code>ã€‚ åœ¨MVC XMLå‘½åç©ºé—´ä¸­ï¼Œæ‚¨å¯ä»¥è®¾ç½®<code>&lt;mvc:annotation-driven enable-matrix-variables=&quot;true&quot;/&gt;</code>ã€‚</p><h5 id="RequestParam"><a href="#RequestParam" class="headerlink" title="@RequestParam"></a><code>@RequestParam</code></h5><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-ann-requestparam">Same as in Spring WebFlux</a></p><p>æ‚¨å¯ä»¥ä½¿ç”¨<code>@RequestParam</code>æ³¨è§£å°†Servletè¯·æ±‚å‚æ•°ï¼ˆå³æŸ¥è¯¢å‚æ•°æˆ–è¡¨å•æ•°æ®ï¼‰ç»‘å®šåˆ°æ§åˆ¶å™¨ä¸­çš„æ–¹æ³•å‚æ•°ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@Controller</span><span class="hljs-meta">@RequestMapping(<span class="hljs-string">&quot;/pets&quot;</span>)</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EditPetForm</span> &#123;<br>    <span class="hljs-comment">// ...</span><br>    <span class="hljs-meta">@GetMapping</span>    <span class="hljs-keyword">public</span> String setupForm(<span class="hljs-meta">@RequestParam(<span class="hljs-string">&quot;petId&quot;</span>)</span> int petId, Model model) &#123; (<span class="hljs-number">1</span>)        Pet pet = <span class="hljs-keyword">this</span>.clinic.loadPet(petId);        model.addAttribute(<span class="hljs-string">&quot;pet&quot;</span>, pet);        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;petForm&quot;</span>;    &#125;<br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>1</strong>ã€ä½¿ç”¨ <code>@RequestParam</code>ç»‘å®š<code>petId</code>ã€‚</p><p>è‹¥å‚æ•°ä½¿ç”¨äº†è¯¥æ³¨è§£ï¼Œåˆ™è¯¥å‚æ•°é»˜è®¤æ˜¯å¿…é¡»æä¾›çš„.ä½†æ‚¨å¯ä»¥é€šè¿‡å°†<code>@RequestParam</code>æ³¨è§£çš„<code>required</code>å±æ€§è®¾ç½®ä¸ºfalseæˆ–é€šè¿‡ä½¿ç”¨ <code>java.util.Optional</code>åŒ…è£…å™¨å£°æ˜å‚æ•°æ¥æŒ‡å®šæ–¹æ³•å‚æ•°æ˜¯å¯é€‰çš„ã€‚</p><p>å¦‚æœç›®æ ‡æ–¹æ³•å‚æ•°ç±»å‹ä¸æ˜¯<code>String</code>ï¼Œåˆ™ä¼šè‡ªåŠ¨åº”ç”¨ç±»å‹è½¬æ¢ã€‚ è¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-typeconversion">ç±»å‹è½¬æ¢</a>ã€‚</p><p>å°†å‚æ•°ç±»å‹å£°æ˜ä¸ºæ•°ç»„æˆ–åˆ—è¡¨å…è®¸ä¸ºåŒä¸€å‚æ•°åç§°è§£æå¤šä¸ªå‚æ•°å€¼ã€‚</p><p>å½“<code>@RequestParam</code>æ³¨è§£å£°æ˜ä¸º<code>Map&lt;String, String&gt;</code> æˆ–<code>MultiValueMap&lt;String, String&gt;</code>æ—¶ï¼Œ å¦‚æœæ³¨è§£ä¸­æœªæŒ‡å®šå‚æ•°åç§°ï¼Œåˆ™ä¼šä½¿ç”¨æ¯ä¸ªç»™å®šå‚æ•°åç§°çš„è¯·æ±‚å‚æ•°å€¼å¡«å……æ˜ å°„ã€‚</p><p>è¯·æ³¨æ„ï¼Œä½¿ç”¨<code>@RequestParam</code>æ˜¯å¯é€‰çš„ï¼ˆä¾‹å¦‚ï¼Œè®¾ç½®å…¶å±æ€§ï¼‰ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œ ä»»ä½•å±äºç®€å•å€¼ç±»å‹çš„å‚æ•°ï¼ˆç”±<a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/beans/BeanUtils.html#isSimpleProperty-java.lang.Class-">BeanUtils#isSimpleProperty</a>ç¡®å®šï¼‰å¹¶ä¸”æœªè¢«ä»»ä½•å…¶ä»–å‚æ•°è§£æå™¨è§£æï¼Œéƒ½è¢«è§†ä¸ºä½¿ç”¨<code>@RequestParam</code>è¿›è¡Œæ³¨è§£ã€‚</p><h5 id="RequestHeader"><a href="#RequestHeader" class="headerlink" title="@RequestHeader"></a><code>@RequestHeader</code></h5><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-ann-requestheader">Same as in Spring WebFlux</a></p><p>æ‚¨å¯ä»¥ä½¿ç”¨<code>@RequestHeader</code>æ³¨è§£å°†è¯·æ±‚æ ‡å¤´ç»‘å®šåˆ°æ§åˆ¶å™¨ä¸­çš„æ–¹æ³•å‚æ•°ã€‚</p><p>è€ƒè™‘ä»¥ä¸‹è¯·æ±‚ï¼Œè¯·æ±‚å¤´ä¸º:</p><p>Host localhost:8080 Accept text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9 Accept-Language fr,en-gb;q&#x3D;0.7,en;q&#x3D;0.3 Accept-Encoding gzip,deflate Accept-Charset ISO-8859-1,utf-8;q&#x3D;0.7,*;q&#x3D;0.7 Keep-Alive 300</p><p>ä»¥ä¸‹ç¤ºä¾‹è·å–<code>Accept-Encoding</code>å’Œ<code>Keep-Alive</code> å¤´çš„å€¼ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@GetMapping</span>(<span class="hljs-string">&quot;/demo&quot;</span>)<br><br>public void <span class="hljs-built_in">handle</span>(<br><br>        <span class="hljs-variable">@RequestHeader</span>(<span class="hljs-string">&quot;Accept-Encoding&quot;</span>) String encoding, (<span class="hljs-number">1</span>)<br><br>        <span class="hljs-variable">@RequestHeader</span>(<span class="hljs-string">&quot;Keep-Alive&quot;</span>) long keepAlive) &#123; (<span class="hljs-number">2</span>)<br><br>    <span class="hljs-comment">//...</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>1</strong>ã€è·å– <code>Accept-Encoding</code> å¤´éƒ¨ä¿¡æ¯.</p><p><strong>2</strong>ã€è·å– <code>Keep-Alive</code> å¤´éƒ¨ä¿¡æ¯.</p><p>å¦‚æœç›®æ ‡æ–¹æ³•å‚æ•°ç±»å‹ä¸æ˜¯<code>String</code>ï¼Œåˆ™ä¼šè‡ªåŠ¨åº”ç”¨ç±»å‹è½¬æ¢ã€‚ è¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-typeconversion">ç±»å‹è½¬æ¢</a>ã€‚</p><p>åœ¨<code>Map&lt;String, String&gt;</code>ï¼Œ<code>MultiValueMap&lt;String, String&gt;</code>æˆ–<code>HttpHeaders</code>å‚æ•°ä¸Šä½¿ç”¨ <code>@RequestHeader</code>æ³¨è§£æ—¶ï¼Œå°†ä½¿ç”¨æ‰€æœ‰è¯·æ±‚å¤´å€¼å¡«å……æ˜ å°„ã€‚</p><p>å†…ç½®æ”¯æŒå¯ç”¨äºå°†é€—å·åˆ†éš”çš„å­—ç¬¦ä¸²è½¬æ¢ä¸ºå­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²é›†æˆ–ç±»å‹è½¬æ¢ç³»ç»Ÿå·²çŸ¥çš„å…¶ä»–ç±»å‹ã€‚ ä¾‹å¦‚ï¼Œä½¿ç”¨ <code>@RequestHeader(&quot;Accept&quot;)</code> æ³¨è§£çš„æ–¹æ³•å‚æ•°å¯ä»¥æ˜¯<code>String</code>ç±»å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯<code>String[]</code>æˆ–<code>List&lt;String&gt;</code>ã€‚</p><h5 id="CookieValue"><a href="#CookieValue" class="headerlink" title="@CookieValue"></a><code>@CookieValue</code></h5><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-ann-cookievalue">Same as in Spring WebFlux</a></p><p>æ‚¨å¯ä»¥ä½¿ç”¨<code>@CookieValue</code>æ³¨è§£å°†HTTP cookieçš„å€¼ç»‘å®šåˆ°æ§åˆ¶å™¨ä¸­çš„æ–¹æ³•å‚æ•°ã€‚</p><p>è€ƒè™‘ä½¿ç”¨ä»¥ä¸‹cookieçš„è¯·æ±‚:</p><p>JSESSIONID&#x3D;415A4AC178C59DACE0B2C9CA727CDD84</p><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•è·å–cookieå€¼ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@GetMapping</span>(<span class="hljs-string">&quot;/demo&quot;</span>)<br><br>public void <span class="hljs-built_in">handle</span>(<span class="hljs-variable">@CookieValue</span>(<span class="hljs-string">&quot;JSESSIONID&quot;</span>) String cookie) &#123; (<span class="hljs-number">1</span>)<br><br>    <span class="hljs-comment">//...</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>1</strong>ã€è·å–<code>JSESSIONID</code> cookieçš„å€¼</p><p>å¦‚æœç›®æ ‡æ–¹æ³•å‚æ•°ç±»å‹ä¸æ˜¯<code>String</code>ï¼Œåˆ™è‡ªåŠ¨åº”ç”¨ç±»å‹è½¬æ¢ã€‚ è¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-typeconversion">ç±»å‹è½¬æ¢</a>ã€‚</p><h5 id="ModelAttribute"><a href="#ModelAttribute" class="headerlink" title="@ModelAttribute"></a><code>@ModelAttribute</code></h5><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-ann-modelattrib-method-args">Same as in Spring WebFlux</a></p><p>æ‚¨å¯ä»¥åœ¨æ–¹æ³•å‚æ•°ä¸Šä½¿ç”¨<code>@ModelAttribute</code>æ³¨è§£æ¥ä»æ¨¡å‹è®¿é—®å±æ€§ï¼Œæˆ–è€…å¦‚æœä¸å­˜åœ¨åˆ™å°†å…¶å®ä¾‹åŒ–ã€‚ modelå±æ€§è¿˜è¦†ç›–äº†åç§°ä¸å­—æ®µåç§°åŒ¹é…çš„HTTP Servletè¯·æ±‚å‚æ•°çš„å€¼ã€‚ è¿™ç§°ä¸ºæ•°æ®ç»‘å®šï¼Œå®ƒä½¿æ‚¨ä¸å¿…å¤„ç†è§£æå’Œè½¬æ¢å•ä¸ªæŸ¥è¯¢å‚æ•°å’Œè¡¨å•å­—æ®µã€‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@PostMapping</span>(<span class="hljs-string">&quot;/owners/&#123;ownerId&#125;/pets/&#123;petId&#125;/edit&quot;</span>)<br><br>public String <span class="hljs-built_in">processSubmit</span>(<span class="hljs-variable">@ModelAttribute</span> Pet pet) &#123; &#125; (<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure><p><strong>1</strong>ã€ç»‘å®šä¸€ä¸ª<code>Pet</code>çš„å®ä¾‹ã€‚</p><p>ä¸Šé¢çš„<code>Pet</code>å®ä¾‹è§£æå¦‚ä¸‹ï¼š:</p><ul><li>å®ƒå¯èƒ½æ¥è‡ªå·²ç»æ·»åŠ çš„<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-modelattrib-methods">Model</a>.</li><li>å®ƒå¯èƒ½å› ä¸º<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-sessionattributes"><code>@SessionAttributes</code></a>æ³¨è§£çš„ä½¿ç”¨å·²ç»å­˜åœ¨åœ¨modelä¸­.</li><li>å®ƒå¯èƒ½æ˜¯ç”±URIæ¨¡æ¿å˜é‡å’Œ<code>è½¬æ¢</code>ä¸­å–å¾—çš„ï¼ˆä¸‹é¢ä¼šè¯¦ç»†è®²è§£ï¼‰.</li><li>å®ƒå¯èƒ½æ˜¯è°ƒç”¨äº†è‡ªèº«çš„é»˜è®¤æ„é€ å™¨è¢«å®ä¾‹åŒ–å‡ºæ¥çš„.</li><li>ä»–å¯èƒ½ä»è°ƒç”¨å…·æœ‰ä¸Servletè¯·æ±‚å‚æ•°åŒ¹é…çš„å‚æ•°çš„â€œprimary constructorâ€ã€‚ å‚æ•°åç§°é€šè¿‡JavaBeans<code>@ConstructorProperties</code>æˆ–å­—èŠ‚ç ä¸­çš„è¿è¡Œæ—¶ä¿ç•™å‚æ•°åç§°ç¡®å®šã€‚</li></ul><p>è™½ç„¶é€šå¸¸ä½¿ç”¨<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-modelattrib-methods">Model</a>æ¥ä½¿ç”¨å±æ€§å¡«å……æ¨¡å‹ï¼Œä½†å¦ä¸€ç§æ›¿ä»£æ–¹æ³•æ˜¯ä¾èµ–äº<code>Converter&lt;String, T&gt;</code>å’ŒURIè·¯å¾„å˜é‡ã€‚ åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œmodelå±æ€§åç§°<code>account</code>åŒ¹é…URIè·¯å¾„å˜é‡ <code>account</code>ï¼Œå¹¶é€šè¿‡å°†Stringå­—ç¬¦ä¸²ä¼ é€’åˆ°å·²æ³¨å†Œçš„<code>Converter&lt;String, Account&gt;</code>è½¬æ¢å™¨æ¥åŠ è½½<code>Account</code> ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@PutMapping</span>(<span class="hljs-string">&quot;/accounts/&#123;account&#125;&quot;</span>)<br><br>public String <span class="hljs-built_in">save</span>(<span class="hljs-variable">@ModelAttribute</span>(<span class="hljs-string">&quot;account&quot;</span>) Account account) &#123;<br><br>    <span class="hljs-comment">// ...</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸‹ä¸€æ­¥å°±æ˜¯æ•°æ®çš„ç»‘å®šï¼Œ<code>WebDataBinder</code>ç±»èƒ½å°†è¯·æ±‚å‚æ•°ï¼ŒåŒ…æ‹¬å­—ç¬¦ä¸²çš„æŸ¥è¯¢å‚æ•°å’Œè¡¨å•å­—æ®µç­‰ï¼Œé€šè¿‡åç§°åŒ¹é…åˆ°modelçš„å±æ€§ä¸Šã€‚æˆåŠŸåŒ¹é…çš„å­—æ®µåœ¨éœ€è¦çš„æ—¶å€™ä¼šè¿›è¡Œä¸€æ¬¡ç±»å‹è½¬æ¢ï¼ˆä»Stringç±»å‹åˆ°ç›®æ ‡å­—æ®µçš„ç±»å‹ï¼‰ï¼Œç„¶åè¢«å¡«å……åˆ°modelå¯¹åº”çš„å±æ€§ä¸­ï¼Œ æœ‰å…³æ•°æ®ç»‘å®šï¼ˆå’ŒéªŒè¯ï¼‰çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/core.html#validation">Validation</a>ã€‚ æœ‰å…³è‡ªå®šä¹‰æ•°æ®ç»‘å®šçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-initbinder"><code>DataBinder</code></a>ã€‚</p><p>æ•°æ®ç»‘å®šå¯èƒ½å¯¼è‡´é”™è¯¯ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œä¼šå¼•å‘<code>BindException</code> ã€‚ ä½†æ˜¯ï¼Œè¦åœ¨æ§åˆ¶å™¨æ–¹æ³•ä¸­æ£€æŸ¥æ­¤ç±»é”™è¯¯ï¼Œå¯ä»¥åœ¨<code>@ModelAttribute</code>æ—è¾¹æ·»åŠ ä¸€ä¸ª<code>BindingResult</code>å‚æ•°ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">&quot;/owners/&#123;ownerId&#125;/pets/&#123;petId&#125;/edit&quot;</span>)<br><br><span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">processSubmit</span>(<span class="hljs-params"><span class="hljs-meta">@ModelAttribute</span>(<span class="hljs-string">&quot;pet&quot;</span>) Pet pet, BindingResult result</span>) &#123; (<span class="hljs-number">1</span>)<br><br>    <span class="hljs-keyword">if</span> (result.<span class="hljs-title function_">hasErrors</span>()) &#123;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;petForm&quot;</span>;<br><br>    &#125;<br><br>    <span class="hljs-comment">// ...</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>1</strong>ã€åœ¨<code>@ModelAttribute</code>æ—è¾¹æ·»åŠ  <code>BindingResult</code>ã€‚</p><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ‚¨å¯èƒ½å¸Œæœ›åœ¨æ²¡æœ‰æ•°æ®ç»‘å®šçš„æƒ…å†µä¸‹è®¿é—®modelå±æ€§ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œæ‚¨å¯ä»¥å°†modelæ³¨å…¥æ§åˆ¶å™¨å¹¶ç›´æ¥è®¿é—®å®ƒï¼Œæˆ–è€…è®¾ç½®<code>@ModelAttribute(binding=false)</code>ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@ModelAttributepublic</span> AccountForm <span class="hljs-built_in">setUpForm</span>() &#123;    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">AccountForm</span>();&#125;<br>@<span class="hljs-selector-tag">ModelAttributepublic</span> <span class="hljs-selector-tag">Account</span> <span class="hljs-selector-tag">findAccount</span>(<span class="hljs-variable">@PathVariable</span> String accountId) &#123;    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">accountRepository</span><span class="hljs-selector-class">.findOne</span>(accountId);&#125;<br>@<span class="hljs-selector-tag">PostMapping</span>(<span class="hljs-string">&quot;update&quot;</span>)<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">update</span>(<span class="hljs-variable">@Valid</span> AccountUpdateForm form, BindingResult result,        <span class="hljs-variable">@ModelAttribute</span>(binding=false) Account account) &#123; (<span class="hljs-number">1</span>)    <span class="hljs-comment">// ...&#125;</span><br></code></pre></td></tr></table></figure><p><strong>1</strong>ã€è®¾ç½® <code>@ModelAttribute(binding=false)</code>.</p><p>é€šè¿‡æ·»åŠ <code>javax.validation.Valid</code>æ³¨è§£æˆ–Springçš„<code>@Validated</code>æ³¨è§£ï¼ˆ<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/core.html#validation-beanvalidation">Bean validation</a>å’Œ<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/core.html#validation">Spring validation</a>ï¼‰ï¼Œæ‚¨å¯ä»¥åœ¨æ•°æ®ç»‘å®šåè‡ªåŠ¨åº”ç”¨éªŒè¯ã€‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">&quot;/owners/&#123;ownerId&#125;/pets/&#123;petId&#125;/edit&quot;</span>)<br><br><span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">processSubmit</span>(<span class="hljs-params"><span class="hljs-meta">@Valid</span> <span class="hljs-meta">@ModelAttribute</span>(<span class="hljs-string">&quot;pet&quot;</span>) Pet pet, BindingResult result</span>) &#123; (<span class="hljs-number">1</span>)<br><br>    <span class="hljs-keyword">if</span> (result.<span class="hljs-title function_">hasErrors</span>()) &#123;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;petForm&quot;</span>;<br><br>    &#125;<br><br>    <span class="hljs-comment">// ...</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>1</strong>ã€éªŒè¯ <code>Pet</code> å®ä¾‹.</p><p>è¯·æ³¨æ„ï¼Œä½¿ç”¨<code>@ModelAttribute</code>æ˜¯å¯é€‰çš„ï¼ˆä¾‹å¦‚ï¼Œè®¾ç½®å…¶å±æ€§ï¼‰ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œä»»ä½•éç®€å•å€¼ç±»å‹çš„å‚æ•°ï¼ˆç”±<a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/beans/BeanUtils.html#isSimpleProperty-java.lang.Class-">BeanUtils#isSimpleProperty</a>ç¡®å®šï¼‰å¹¶ä¸”æœªè¢«ä»»ä½•å…¶ä»–å‚æ•°è§£æå™¨è§£æï¼Œéƒ½è¢«è§†ä¸ºä½¿ç”¨<code>@ModelAttribute</code>è¿›è¡Œæ³¨è§£ã€‚</p><h5 id="SessionAttributes"><a href="#SessionAttributes" class="headerlink" title="@SessionAttributes"></a><code>@SessionAttributes</code></h5><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-ann-sessionattributes">Same as in Spring WebFlux</a></p><p><code>@SessionAttributes</code>ç”¨äºåœ¨è¯·æ±‚ä¹‹é—´çš„HTTP Servletä¼šè¯ä¸­å­˜å‚¨modelå±æ€§ã€‚ å®ƒæ˜¯ä¸€ä¸ªç±»å‹çº§åˆ«çš„æ³¨è§£ï¼Œç”¨äºå£°æ˜ç‰¹å®šæ§åˆ¶å™¨ä½¿ç”¨çš„ä¼šè¯å±æ€§ã€‚ è¿™é€šå¸¸åˆ—å‡ºmodelå±æ€§çš„åç§°æˆ–modelå±æ€§çš„ç±»å‹ï¼Œè¿™äº›å±æ€§åº”è¯¥é€æ˜åœ°å­˜å‚¨åœ¨ä¼šè¯ä¸­ä»¥ä¾›åç»­è®¿é—®è¯·æ±‚ä½¿ç”¨ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹ä½¿ç”¨<code>@SessionAttributes</code>æ³¨è§£:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Controller</span><br><br><span class="hljs-variable">@SessionAttributes</span>(<span class="hljs-string">&quot;pet&quot;</span>) (<span class="hljs-number">1</span>)<br><br>public class EditPetForm &#123;<br><br>    <span class="hljs-comment">// ...</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>1</strong>ã€Using the <code>@SessionAttributes</code> annotation.</p><p>åœ¨ç¬¬ä¸€ä¸ªè¯·æ±‚ä¸­ï¼Œå½“åç§°ä¸º<code>pet</code>çš„modelå±æ€§æ·»åŠ åˆ°æ¨¡å‹ä¸­æ—¶ï¼Œä»–ä¼šè‡ªåŠ¨ä¿å­˜åˆ°HTTP Servletä¼šè¯ä¸­ï¼Œå¹¶ä¿æŒä¸å˜ï¼Œç›´åˆ°å¦ä¸€ä¸ªæ§åˆ¶å™¨æ–¹æ³•ä½¿ç”¨<code>SessionStatus</code>æ–¹æ³•å‚æ•°æ¥æ¸…é™¤å­˜å‚¨ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Controller</span><span class="hljs-variable">@SessionAttributes</span>(<span class="hljs-string">&quot;pet&quot;</span>) (<span class="hljs-number">1</span>)public class EditPetForm &#123;<br>    <span class="hljs-comment">// ...</span><br>    <span class="hljs-variable">@PostMapping</span>(<span class="hljs-string">&quot;/pets/&#123;id&#125;&quot;</span>)    public String <span class="hljs-built_in">handle</span>(Pet pet, BindingResult errors, SessionStatus status) &#123;        <span class="hljs-selector-tag">if</span> (errors.hasErrors) &#123;            <span class="hljs-comment">// ...        &#125;            status.setComplete(); (2)            // ...        &#125;    &#125;&#125;</span><br></code></pre></td></tr></table></figure><p><strong>1</strong>ã€åœ¨Servletä¼šè¯ä¸­å­˜å‚¨<code>Pet</code>å€¼ã€‚</p><p><strong>2</strong>ã€åœ¨Servletä¼šè¯ä¸­æ¸…é™¤<code>Pet</code>å€¼ã€‚</p><h5 id="SessionAttribute"><a href="#SessionAttribute" class="headerlink" title="@SessionAttribute"></a><code>@SessionAttribute</code></h5><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-ann-sessionattribute">Same as in Spring WebFlux</a></p><p>å¦‚æœéœ€è¦è®¿é—®å·²å­˜åœ¨çš„è¢«å…¨å±€sessionå±æ€§ï¼Œä¾‹å¦‚åœ¨æ§åˆ¶å™¨ä¹‹å¤–ï¼ˆå¦‚é€šè¿‡è¿‡æ»¤å™¨ï¼‰çš„ï¼ˆå¯æœ‰å¯æ— ï¼‰ï¼Œè¯·åœ¨æ–¹æ³•å‚æ•°ä¸Šä½¿ç”¨<code>@SessionAttribute</code>æ³¨è§£ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@RequestMapping</span>(<span class="hljs-string">&quot;/&quot;</span>)<br><br>public String <span class="hljs-built_in">handle</span>(<span class="hljs-variable">@SessionAttribute</span> User user) &#123; (<span class="hljs-number">1</span>)<br><br>    <span class="hljs-comment">// ...</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>1</strong>ã€Using a <code>@SessionAttribute</code> annotation.</p><p>å¯¹äºéœ€è¦æ·»åŠ æˆ–åˆ é™¤ä¼šè¯å±æ€§çš„ç”¨ä¾‹ï¼Œè¯·è€ƒè™‘å°†<code>org.springframework.web.context.request.WebRequest</code>æˆ–<code>javax.servlet.http.HttpSession</code>æ³¨å…¥æ§åˆ¶å™¨æ–¹æ³•ã€‚</p><p>ä½œä¸ºæ§åˆ¶å™¨å·¥ä½œæµçš„ä¸€éƒ¨åˆ†ï¼Œåœ¨ä¼šè¯ä¸­ä¸´æ—¶å­˜å‚¨æ¨¡å‹å±æ€§çš„æ–¹æ³•å¯ä»¥ä½¿ç”¨<code>@SessionAttributes</code>ï¼Œè¯¦æƒ…è¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-sessionattributes"><code>@SessionAttributes</code></a>ã€‚</p><h5 id="RequestAttribute"><a href="#RequestAttribute" class="headerlink" title="@RequestAttribute"></a><code>@RequestAttribute</code></h5><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-ann-requestattrib">Same as in Spring WebFlux</a></p><p>ä¸<code>@SessionAttribute</code>ç±»ä¼¼ï¼Œ<code>@RequestAttribute</code>æ³¨è§£å¯ç”¨äºè®¿é—®ç”±è¿‡æ»¤å™¨ï¼ˆ<code>Filter</code>ï¼‰æˆ–æ‹¦æˆªå™¨ï¼ˆ<code>HandlerInterceptor</code>ï¼‰åˆ›å»ºçš„å·²å­˜åœ¨çš„è¯·æ±‚å±æ€§:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@GetMapping</span>(<span class="hljs-string">&quot;/&quot;</span>)<br><br>public String <span class="hljs-built_in">handle</span>(<span class="hljs-variable">@RequestAttribute</span> Client client) &#123; (<span class="hljs-number">1</span>)<br><br>    <span class="hljs-comment">// ...</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>1</strong>ã€Using the <code>@RequestAttribute</code> annotation.</p><h5 id="Redirect-å±æ€§"><a href="#Redirect-å±æ€§" class="headerlink" title="Redirect å±æ€§"></a>Redirect å±æ€§</h5><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰æ¨¡å‹å±æ€§éƒ½è¢«è§†ä¸ºåœ¨é‡å®šå‘URLä¸­å…¬å¼€ä¸ºURIæ¨¡æ¿å˜é‡ã€‚ åœ¨å…¶ä½™å±æ€§ä¸­ï¼ŒåŸå§‹ç±»å‹æˆ–é›†åˆæˆ–åŸºæœ¬ç±»å‹æ•°ç»„çš„å±æ€§å°†è‡ªåŠ¨é™„åŠ ä¸ºæŸ¥è¯¢å‚æ•°ã€‚</p><p>å¦‚æœä¸“é—¨ä¸ºé‡å®šå‘å‡†å¤‡äº†æ¨¡å‹å®ä¾‹ï¼ŒæœŸæœ›çš„ç»“æœåˆ™æ˜¯å°†åŸå§‹ç±»å‹å±æ€§ä½œä¸ºæŸ¥è¯¢å‚æ•°ã€‚ ä½†æ˜¯ï¼Œåœ¨å¸¦æ³¨è§£çš„æ§åˆ¶å™¨ä¸­ï¼Œä¸ºäº†æ¸²æŸ“ç›®çš„ï¼Œæ¨¡å‹å¯ä»¥åŒ…å«å…¶ä»–å±æ€§ï¼ˆä¾‹å¦‚ï¼Œä¸‹æ‹‰å­—æ®µå€¼ï¼‰ã€‚ ä¸ºäº†é¿å…åœ¨URLä¸­å‡ºç°æ­¤ç±»å±æ€§çš„å¯èƒ½æ€§ï¼Œ<code>@RequestMapping</code>æ–¹æ³•å¯ä»¥å£°æ˜<code>RedirectAttributes</code>ç±»å‹çš„å‚æ•°ï¼Œ å¹¶ä½¿ç”¨å®ƒæ¥æŒ‡å®šå¯ä¾›<code>RedirectView</code>ä½¿ç”¨çš„ç¡®åˆ‡å±æ€§ã€‚ å¦‚æœæ–¹æ³•é‡å®šå‘ï¼Œåˆ™ä½¿ç”¨<code>RedirectAttributes</code>çš„å†…å®¹ã€‚ å¦åˆ™ï¼Œä½¿ç”¨æ¨¡å‹çš„å†…å®¹ã€‚</p><p><code>RequestMappingHandlerAdapter</code>æä¾›äº†ä¸€ä¸ªåä¸º<code>ignoreDefaultModelOnRedirect</code>çš„æ ‡å¿—ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è¯¥æ ‡å¿—æŒ‡ç¤ºå¦‚æœæ§åˆ¶å™¨æ–¹æ³•é‡å®šå‘ï¼Œåˆ™æ°¸è¿œä¸åº”ä½¿ç”¨é»˜è®¤æ¨¡å‹çš„å†…å®¹ã€‚ ç›¸åï¼Œæ§åˆ¶å™¨æ–¹æ³•åº”å£°æ˜<code>RedirectAttributes</code>ç±»å‹çš„å±æ€§ï¼Œå¦‚æœä¸è¿™æ ·åšï¼Œåˆ™ä¸åº”å°†ä»»ä½•å±æ€§ä¼ é€’ç»™<code>RedirectView</code>ã€‚ MVCå‘½åç©ºé—´å’ŒMVC Javaé…ç½®éƒ½å°†æ­¤æ ‡å¿—è®¾ç½®ä¸º<code>false</code>ï¼Œä»¥ä¿æŒå‘åå…¼å®¹æ€§ã€‚ ä½†æ˜¯ï¼Œå¯¹äºæ–°åº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬å»ºè®®å°†å…¶è®¾ç½®ä¸º<code>true</code>ã€‚</p><p>è¯·æ³¨æ„ï¼Œæ‰©å±•é‡å®šå‘URLæ—¶ï¼Œå½“å‰è¯·æ±‚ä¸­çš„URIæ¨¡æ¿å˜é‡ä¼šè‡ªåŠ¨å¯ç”¨ï¼Œæ‚¨éœ€è¦é€šè¿‡ <code>Model</code>æˆ–<code>RedirectAttributes</code>æ˜¾å¼æ·»åŠ å®ƒä»¬ã€‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•å®šä¹‰é‡å®šå‘ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">&quot;/files/&#123;path&#125;&quot;</span>)<br><br><span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">upload</span>(<span class="hljs-params">...</span>) &#123;<br><br>    <span class="hljs-comment">// ...</span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:files/&#123;path&#125;&quot;</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>å°†æ•°æ®ä¼ é€’åˆ°é‡å®šå‘ç›®æ ‡çš„å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨flashå±æ€§ã€‚ ä¸å…¶ä»–é‡å®šå‘å±æ€§ä¸åŒï¼ŒFlashå±æ€§ä¿å­˜åœ¨HTTPä¼šè¯ä¸­ï¼ˆå› æ­¤ï¼Œä¸ä¼šå‡ºç°åœ¨URLä¸­ï¼‰ã€‚ æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-flash-attributes">Flash å±æ€§</a>ã€‚</p><h5 id="Flash-å±æ€§"><a href="#Flash-å±æ€§" class="headerlink" title="Flash å±æ€§"></a>Flash å±æ€§</h5><p>Flashå±æ€§ï¼ˆflash attributesï¼‰æä¾›äº†ä¸€ä¸ªè¯·æ±‚ä¸ºå¦ä¸€ä¸ªè¯·æ±‚å­˜å‚¨æœ‰ç”¨å±æ€§çš„æ–¹æ³•ã€‚è¿™åœ¨é‡å®šå‘çš„æ—¶å€™æœ€å¸¸ä½¿ç”¨ï¼Œæ¯”å¦‚å¸¸è§çš„POST&#x2F;REDIRECT&#x2F;GETæ¨¡å¼ã€‚ Flashå±æ€§ä¼šåœ¨é‡å®šå‘å‰è¢«æš‚æ—¶åœ°ä¿å­˜èµ·æ¥ï¼ˆé€šå¸¸æ˜¯ä¿å­˜åœ¨sessionä¸­ï¼‰ï¼Œé‡å®šå‘åä¼šé‡æ–°è¢«ä¸‹ä¸€ä¸ªè¯·æ±‚å–ç”¨å¹¶ç«‹å³ä»åŸä¿å­˜åœ°ç§»é™¤ã€‚</p><p>ä¸ºæ”¯æŒflashå±æ€§ï¼ŒSpring MVCæä¾›äº†ä¸¤ä¸ªæŠ½è±¡ã€‚ <code>FlashMap</code>è¢«ç”¨æ¥å­˜å‚¨flashå±æ€§ï¼Œè€Œç”¨<code>FlashMapManager</code>æ¥å­˜å‚¨ã€å–å›ã€ç®¡ç†<code>FlashMap</code>çš„å®ä¾‹ã€‚</p><p>å¯¹flashå±æ€§çš„æ”¯æŒé»˜è®¤æ˜¯å¯ç”¨â€œonâ€ çš„ï¼Œå¹¶ä¸éœ€è¦æ˜¾å¼å£°æ˜ï¼Œä¸è¿‡æ²¡ç”¨åˆ°å®ƒæ—¶å®ƒç»ä¸ä¼šä¸»åŠ¨åœ°å»åˆ›å»ºHTTPä¼šè¯ï¼ˆsessionï¼‰ã€‚å¯¹äºæ¯ä¸ªè¯·æ±‚ï¼Œæ¡†æ¶éƒ½ä¼šâ€œinputâ€ ä¸€ä¸ª<code>FlashMap</code>ï¼Œé‡Œé¢å­˜å‚¨äº†ä»ä¸Šä¸ªè¯·æ±‚ï¼ˆå¦‚æœæœ‰ï¼‰ä¿å­˜ä¸‹æ¥çš„å±æ€§ï¼›åŒæ—¶ï¼Œæ¯ä¸ªè¯·æ±‚ä¹Ÿä¼šâ€œoutputâ€<code>FlashMap</code>ï¼Œé‡Œé¢ä¿å­˜äº†è¦ç»™ä¸‹ä¸ªè¯·æ±‚ä½¿ç”¨çš„å±æ€§ã€‚ ä¸¤ä¸ª<code>FlashMap</code>å®ä¾‹åœ¨Spring MVCåº”ç”¨ä¸­çš„ä»»ä½•åœ°ç‚¹éƒ½å¯ä»¥é€šè¿‡<code>RequestContextUtils</code>å·¥å…·ç±»çš„é™æ€æ–¹æ³•å–å¾—ã€‚</p><p>æ§åˆ¶å™¨é€šå¸¸ä¸éœ€è¦ç›´æ¥æ¥è§¦<code>FlashMap</code>ã€‚ä¸€èˆ¬æ˜¯é€šè¿‡<code>@RequestMapping</code>æ–¹æ³•å»æ¥å—<code>RedirectAttributes</code>ç±»å‹çš„å‚æ•°ï¼Œç„¶åç›´æ¥åœ°å¾€å…¶ä¸­æ·»åŠ flashå±æ€§ã€‚ é€šè¿‡<code>RedirectAttributes</code>å¯¹è±¡æ·»åŠ è¿›å»çš„flashå±æ€§ä¼šè‡ªåŠ¨è¢«å¡«å……åˆ°è¯·æ±‚çš„â€œoutputâ€<code>FlashMap</code>å¯¹è±¡ä¸­å»ã€‚ç±»ä¼¼åœ°ï¼Œé‡å®šå‘åâ€œinputâ€çš„<code>FlashMap</code>å±æ€§ä¹Ÿä¼šè‡ªåŠ¨è¢«æ·»åŠ åˆ°æœåŠ¡é‡å®šå‘URLçš„æ§åˆ¶å™¨å‚æ•°Modelä¸­å»</p><p>åŒ¹é…è¯·æ±‚æ‰€ä½¿ç”¨çš„flashå±æ€§</p><p>flashå±æ€§çš„æ¦‚å¿µåœ¨å…¶ä»–è®¸å¤šçš„Webæ¡†æ¶ä¸­ä¹Ÿå­˜åœ¨ï¼Œå¹¶ä¸”å®è·µè¯æ˜æœ‰æ—¶å¯èƒ½ä¼šå¯¼è‡´å¹¶å‘ä¸Šçš„é—®é¢˜ã€‚è¿™æ˜¯å› ä¸ºä»å®šä¹‰ä¸Šè®²ï¼Œflashå±æ€§ä¿å­˜çš„æ—¶é—´æ˜¯åˆ°ä¸‹ä¸ªè¯·æ±‚æ¥æ”¶åˆ°ä¹‹å‰ã€‚ é—®é¢˜åœ¨äºï¼Œâ€œnextâ€è¯·æ±‚ä¸ä¸€å®šåˆšå¥½å°±æ˜¯éœ€è¦é‡å®šå‘åˆ°çš„é‚£ä¸ªè¯·æ±‚ï¼Œå®ƒæœ‰å¯èƒ½æ˜¯å…¶ä»–çš„å¼‚æ­¥è¯·æ±‚ï¼ˆæ¯”å¦‚pollingè¯·æ±‚æˆ–è€…èµ„æºè¯·æ±‚ç­‰ï¼‰ã€‚è¿™ä¼šå¯¼è‡´flashå±æ€§åœ¨åˆ°è¾¾çœŸæ­£çš„ç›®æ ‡è¯·æ±‚å‰å°±è¢«ç§»é™¤äº†ã€‚</p><p>ä¸ºäº†å‡å°‘è¿™ä¸ªé—®é¢˜å‘ç”Ÿçš„å¯èƒ½æ€§ï¼Œé‡å®šå‘è§†å›¾<code>RedirectView</code>ä¼šè‡ªåŠ¨ä¸ºä¸€ä¸ª<code>FlashMap</code>å®ä¾‹è®°å½•å…¶ç›®æ ‡é‡å®šå‘URLçš„è·¯å¾„å’ŒæŸ¥è¯¢å‚æ•°ã€‚ç„¶åï¼Œé»˜è®¤çš„<code>FlashMapManager</code>ä¼šåœ¨ä¸ºè¯·æ±‚æŸ¥æ‰¾å…¶è¯¥â€œinputâ€çš„<code>FlashMap</code>æ—¶ï¼ŒåŒ¹é…è¿™äº›ä¿¡æ¯ã€‚</p><p>è¿™å¹¶ä¸èƒ½å®Œå…¨è§£å†³é‡å®šå‘çš„å¹¶å‘é—®é¢˜ï¼Œä½†æå¤§ç¨‹åº¦åœ°å‡å°‘äº†è¿™ç§å¯èƒ½æ€§ï¼Œå› ä¸ºå®ƒå¯ä»¥ä»é‡å®šå‘URLå·²æœ‰çš„ä¿¡æ¯ä¸­æ¥åšåŒ¹é…ã€‚å› æ­¤ï¼Œä¸€èˆ¬åªæœ‰åœ¨é‡å®šå‘çš„åœºæ™¯ä¸‹ï¼Œæ‰æ¨èä½¿ç”¨flashå±æ€§ã€‚</p><h5 id="Multipart"><a href="#Multipart" class="headerlink" title="Multipart"></a>Multipart</h5><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-multipart-forms">Same as in Spring WebFlux</a></p><p>å¯ç”¨<code>MultipartResolver</code>åï¼Œå°†è§£æå…·æœ‰<code>multipart/form-data</code>çš„POSTè¯·æ±‚çš„å†…å®¹ï¼Œå¹¶å°†å…¶ä½œä¸ºå¸¸è§„è¯·æ±‚å‚æ•°è¿›è¡Œè®¿é—®ã€‚ ä»¥ä¸‹ç¤ºä¾‹è®¿é—®ä¸€ä¸ªå¸¸è§„è¡¨å•å­—æ®µå’Œä¸€ä¸ªä¸Šè½½æ–‡ä»¶ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Controllerpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FileUploadController</span> &#123;<br>    <span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">&quot;/form&quot;</span>)    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">handleFormUpload</span>(<span class="hljs-params"><span class="hljs-meta">@RequestParam</span>(<span class="hljs-string">&quot;name&quot;</span>) <span class="hljs-built_in">String</span> name,            <span class="hljs-meta">@RequestParam</span>(<span class="hljs-string">&quot;file&quot;</span>) MultipartFile file</span>) &#123;<br>        <span class="hljs-keyword">if</span> (!file.<span class="hljs-title function_">isEmpty</span>()) &#123;            byte[] bytes = file.<span class="hljs-title function_">getBytes</span>();            <span class="hljs-comment">// store the bytes somewhere            return &quot;redirect:uploadSuccess&quot;;        &#125;        return &quot;redirect:uploadFailure&quot;;    &#125;&#125;</span><br></code></pre></td></tr></table></figure><p>å°†å‚æ•°ç±»å‹å£°æ˜ä¸º<code>List&lt;MultipartFile&gt;</code>å…è®¸ä¸ºåŒä¸€å‚æ•°åç§°è§£æå¤šä¸ªæ–‡ä»¶ã€‚</p><p>å½“<code>@RequestParam</code>æ³¨è§£å£°æ˜ä¸º<code>Map&lt;String, MultipartFile&gt;</code>æˆ–<code>MultiValueMap&lt;String, MultipartFile&gt;</code>æ—¶ï¼Œå¦‚æœæ³¨è§£ä¸­æœªæŒ‡å®šå‚æ•°åç§°ï¼Œåˆ™ä¼šä½¿ç”¨æ¯ä¸ªç»™å®šå‚æ•°åç§°çš„å¤šéƒ¨åˆ†æ–‡ä»¶å¡«å……mapã€‚</p><p>ä½¿ç”¨Servlet 3.0å¤šéƒ¨åˆ†è§£æï¼Œæ‚¨ä¹Ÿå¯ä»¥å°† <code>javax.servlet.http.Part</code>è€Œä¸æ˜¯Springçš„<code>MultipartFile</code>å£°æ˜ä¸ºæ–¹æ³•å‚æ•°æˆ–é›†åˆå€¼ç±»å‹ã€‚</p><p>æ‚¨è¿˜å¯ä»¥å°†å¤šéƒ¨åˆ†å†…å®¹ç”¨ä½œç»‘å®šåˆ°<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-modelattrib-method-args">å‘½ä»¤å¯¹è±¡</a>çš„æ•°æ®çš„ä¸€éƒ¨åˆ†ã€‚ ä¾‹å¦‚ï¼Œå‰é¢ç¤ºä¾‹ä¸­çš„è¡¨å•å­—æ®µå’Œæ–‡ä»¶å¯ä»¥æ˜¯è¡¨å•å¯¹è±¡ä¸Šçš„å­—æ®µï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyForm</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> name;<br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">MultipartFile</span> file;<br>    <span class="hljs-regexp">//</span> ...&#125;<br><span class="hljs-variable">@Controllerpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FileUploadController</span> &#123;<br>    <span class="hljs-variable">@PostMapping</span>(<span class="hljs-string">&quot;/form&quot;</span>)    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> handleFormUpload(<span class="hljs-title class_">MyForm</span> form, <span class="hljs-title class_">BindingResult</span> errors) &#123;        <span class="hljs-keyword">if</span> (!form.getFile().isEmpty()) &#123;            byte[] bytes = form.getFile().getBytes();            <span class="hljs-regexp">//</span> store the bytes somewhere            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:uploadSuccess&quot;</span>;        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:uploadFailure&quot;</span>;    &#125;&#125;<br></code></pre></td></tr></table></figure><p>è¿˜å¯ä»¥åœ¨RESTfulæœåŠ¡æ–¹æ¡ˆä¸­ä»éæµè§ˆå™¨å®¢æˆ·ç«¯æäº¤å¤šéƒ¨åˆ†è¯·æ±‚ã€‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¸¦æœ‰JSONçš„æ–‡ä»¶ï¼š</p><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs fortran">POST /someUrlContent-<span class="hljs-keyword">Type</span>: multipart/mixed<br>--edt7Tfrdusa7r3lNQc79vXuhIIMlatb7PQg7VpContent-Disposition: <span class="hljs-keyword">form</span>-<span class="hljs-keyword">data</span>; <span class="hljs-keyword">name</span>=<span class="hljs-string">&quot;meta-data&quot;</span>Content-<span class="hljs-keyword">Type</span>: application/json; charset=UTF-<span class="hljs-number">8</span>Content-<span class="hljs-built_in">Transfer</span>-Encoding: <span class="hljs-number">8</span>bit<br>&#123;    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;value&quot;</span>&#125;--edt7Tfrdusa7r3lNQc79vXuhIIMlatb7PQg7VpContent-Disposition: <span class="hljs-keyword">form</span>-<span class="hljs-keyword">data</span>; <span class="hljs-keyword">name</span>=<span class="hljs-string">&quot;file-data&quot;</span>; filename=<span class="hljs-string">&quot;file.properties&quot;</span>Content-<span class="hljs-keyword">Type</span>: text/xmlContent-<span class="hljs-built_in">Transfer</span>-Encoding: <span class="hljs-number">8</span>bit... <span class="hljs-keyword">File</span> <span class="hljs-keyword">Data</span> ...<br></code></pre></td></tr></table></figure><p>å¯¹äºåç§°ä¸ºâ€meta-dataâ€ çš„éƒ¨åˆ†ï¼Œå¯ä»¥é€šè¿‡æ§åˆ¶å™¨æ–¹æ³•ä¸Šçš„<code>@RequestParam</code>String metadataå‚æ•°æ¥è·å¾—ã€‚ä½†å¯¹äºé‚£éƒ¨åˆ†è¯·æ±‚ä½“ä¸­ä¸ºJSONæ ¼å¼æ•°æ®çš„è¯·æ±‚ï¼Œ å¯èƒ½æ›´æƒ³é€šè¿‡æ¥å—ä¸€ä¸ªå¯¹åº”çš„å¼ºç±»å‹å¯¹è±¡ï¼Œå°±åƒ<code>@RequestBody</code>é€šè¿‡<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/integration.html#rest-message-conversion">HttpMessageConverter</a>å°†ä¸€èˆ¬è¯·æ±‚çš„è¯·æ±‚ä½“è½¬æ¢æˆä¸€ä¸ªå¯¹è±¡ä¸€æ ·ã€‚ä½¿ç”¨<code>@RequestPart</code>æ³¨è§£è®¿é—®å¤šéƒ¨åˆ†ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@PostMapping</span>(<span class="hljs-string">&quot;/&quot;</span>)<br><br>public String <span class="hljs-built_in">handle</span>(<span class="hljs-variable">@RequestPart</span>(<span class="hljs-string">&quot;meta-data&quot;</span>) MetaData metadata,<br><br>        <span class="hljs-variable">@RequestPart</span>(<span class="hljs-string">&quot;file-data&quot;</span>) MultipartFile file) &#123;<br><br>    <span class="hljs-comment">// ...</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p>æ‚¨å¯ä»¥å°†<code>@RequestPart</code>ä¸<code>javax.validation.Valid</code>ç»“åˆä½¿ç”¨ï¼Œæˆ–ä½¿ç”¨Springçš„<code>@Validated</code>æ³¨è§£ï¼Œè¿™ä¸¤ç§æ³¨è§£éƒ½ä¼šå¯¼è‡´åº”ç”¨æ ‡å‡†BeanéªŒè¯ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒéªŒè¯é”™è¯¯ä¼šå¯¼è‡´<code>MethodArgumentNotValidException</code>ï¼Œ å¹¶å°†å…¶è½¬æ¢ä¸º400ï¼ˆBAD_REQUESTï¼‰å“åº”ã€‚ æˆ–è€…ï¼Œæ‚¨å¯ä»¥é€šè¿‡<code>Errors</code> æˆ–<code>BindingResult</code> å‚æ•°åœ¨æ§åˆ¶å™¨å†…æœ¬åœ°å¤„ç†éªŒè¯é”™è¯¯ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@PostMapping</span>(<span class="hljs-string">&quot;/&quot;</span>)<br><br>public String <span class="hljs-built_in">handle</span>(<span class="hljs-variable">@Valid</span> <span class="hljs-variable">@RequestPart</span>(<span class="hljs-string">&quot;meta-data&quot;</span>) MetaData metadata,<br><br>        BindingResult result) &#123;<br><br>    <span class="hljs-comment">// ...</span><br><br>&#125;<br></code></pre></td></tr></table></figure><h5 id="RequestBody"><a href="#RequestBody" class="headerlink" title="@RequestBody"></a><code>@RequestBody</code></h5><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-ann-requestbody">Same as in Spring WebFlux</a></p><p>æ‚¨å¯ä»¥ä½¿ç”¨<code>@RequestBody</code>æ³¨è§£é€šè¿‡<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/integration.html#rest-message-conversion"><code>HttpMessageConverter</code></a>å°†è¯·æ±‚ä¸»ä½“è¯»å–å¹¶ååºåˆ—åŒ–ä¸º<code>Object</code>ã€‚ ä»¥ä¸‹ç¤ºä¾‹ä½¿ç”¨<code>@RequestBody</code>å‚æ•°:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@PostMapping</span>(<span class="hljs-string">&quot;/accounts&quot;</span>)<br><br>public void <span class="hljs-built_in">handle</span>(<span class="hljs-variable">@RequestBody</span> Account account) &#123;<br><br>    <span class="hljs-comment">// ...</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p>æ‚¨å¯ä»¥ä½¿ç”¨<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-config">MVC Config</a> çš„<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-config-message-converters">Message Converters</a>é€‰é¡¹æ¥é…ç½®æˆ–è‡ªå®šä¹‰æ¶ˆæ¯è½¬æ¢ã€‚</p><p>æ‚¨å¯ä»¥å°†<code>@RequestBody</code>ä¸<code>javax.validation.Valid</code>æˆ–Springçš„<code>@Validated</code> æ³¨è§£ç»“åˆä½¿ç”¨ï¼Œè¿™ä¸¤ç§æ³¨è§£éƒ½ä¼šå¯¼è‡´åº”ç”¨æ ‡å‡†BeanéªŒè¯ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒéªŒè¯é”™è¯¯ä¼šå¯¼è‡´ <code>MethodArgumentNotValidException</code>ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸º400ï¼ˆBAD_REQUESTï¼‰å“åº”ã€‚ æˆ–è€…ï¼Œæ‚¨å¯ä»¥é€šè¿‡<code>Errors</code>æˆ–<code>BindingResult</code>å‚æ•°åœ¨æ§åˆ¶å™¨å†…æœ¬åœ°å¤„ç†éªŒè¯é”™è¯¯ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@PostMapping</span>(<span class="hljs-string">&quot;/accounts&quot;</span>)<br><br>public void <span class="hljs-built_in">handle</span>(<span class="hljs-variable">@Valid</span> <span class="hljs-variable">@RequestBody</span> Account account, BindingResult result) &#123;<br><br>    <span class="hljs-comment">// ...</span><br><br>&#125;<br></code></pre></td></tr></table></figure><h5 id="HttpEntity"><a href="#HttpEntity" class="headerlink" title="HttpEntity"></a>HttpEntity</h5><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-ann-httpentity">Same as in Spring WebFlux</a></p><p><code>HttpEntity</code>ä¸ä½¿ç”¨<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-requestbody"><code>@RequestBody</code></a>æˆ–å¤šæˆ–å°‘æœ‰äº›ç±»ä¼¼ï¼Œä½†å®ƒåŸºäºä¸€ä¸ªå…¬å¼€è¯·æ±‚å¤´å’Œæ­£æ–‡çš„å®¹å™¨å¯¹è±¡ã€‚ ä»¥ä¸‹æ¸…å•æ˜¾ç¤ºäº†ä¸€ä¸ªç¤ºä¾‹:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">&quot;/accounts&quot;</span>)<br><br><span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">handle</span>(<span class="hljs-params">HttpEntity&lt;Account&gt; entity</span>) &#123;<br><br>    <span class="hljs-comment">// ...</span><br><br>&#125;<br></code></pre></td></tr></table></figure><h5 id="ResponseBody"><a href="#ResponseBody" class="headerlink" title="@ResponseBody"></a><code>@ResponseBody</code></h5><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-ann-responsebody">Same as in Spring WebFlux</a></p><p>æ‚¨å¯ä»¥åœ¨æ–¹æ³•ä¸Šä½¿ç”¨<code>@ResponseBody</code>æ³¨è§£ï¼Œä»¥é€šè¿‡<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/integration.html#rest-message-conversion">HttpMessageConverter</a>å°†è¿”å›åºåˆ—åŒ–åˆ°å“åº”ä¸»ä½“ã€‚ ä»¥ä¸‹æ¸…å•æ˜¾ç¤ºäº†ä¸€ä¸ªç¤ºä¾‹:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@GetMapping</span>(<span class="hljs-string">&quot;/accounts/&#123;id&#125;&quot;</span>)<br><br><span class="hljs-variable">@ResponseBody</span><br><br>public Account <span class="hljs-built_in">handle</span>() &#123;<br><br>    <span class="hljs-comment">// ...</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p>ç±»çº§åˆ«ä¹Ÿæ”¯æŒ<code>@ResponseBody</code> ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒç”±æ‰€æœ‰æ§åˆ¶å™¨æ–¹æ³•ç»§æ‰¿ã€‚ ä¾‹å¦‚<code>@RestController</code>çš„æ•ˆæœï¼Œå®ƒåªä¸è¿‡æ˜¯ä¸€ä¸ªç”¨<code>@Controller</code>å’Œ<code>@ResponseBody</code>æ ‡è®°çš„å…ƒæ³¨è§£ã€‚</p><p>æ‚¨å¯ä»¥å°†<code>@ResponseBody</code>ä¸reactiveç±»å‹ä¸€èµ·ä½¿ç”¨ã€‚ æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-async">å¼‚æ­¥è¯·æ±‚</a>å’Œ<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-async-reactive-types">Reactive ç±»å‹</a>ã€‚</p><p>æ‚¨å¯ä»¥ä½¿ç”¨<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-config">MVC Config</a>çš„ <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-config-message-converters">Message Converters</a>é€‰é¡¹æ¥é…ç½®æˆ–è‡ªå®šä¹‰æ¶ˆæ¯è½¬æ¢ã€‚</p><p>æ‚¨å¯ä»¥å°†<code>@ResponseBody</code>æ–¹æ³•ä¸JSONåºåˆ—åŒ–è§†å›¾ç»“åˆä½¿ç”¨ã€‚ æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-jackson">Jackson JSON</a>ã€‚</p><h5 id="ResponseEntity"><a href="#ResponseEntity" class="headerlink" title="ResponseEntity"></a>ResponseEntity</h5><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-ann-responseentity">Same as in Spring WebFlux</a></p><p><code>ResponseEntity</code>ä¸ <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-responsebody"><code>@ResponseBody</code></a> ç±»ä¼¼ï¼Œä½†å…·æœ‰çŠ¶æ€å’Œå“åº”å¤´ã€‚ ä¾‹å¦‚:</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs lasso">@GetMapping(<span class="hljs-string">&quot;/something&quot;</span>)<br><br><span class="hljs-keyword">public</span> ResponseEntity&lt;<span class="hljs-built_in">String</span>&gt; <span class="hljs-keyword">handle</span>() &#123;<br><br>    <span class="hljs-built_in">String</span> body = <span class="hljs-params">...</span> ;<br><br>    <span class="hljs-built_in">String</span> etag = <span class="hljs-params">...</span> ;<br><br>    <span class="hljs-keyword">return</span> ResponseEntity.ok().eTag(etag).build(body);<br><br>&#125;<br></code></pre></td></tr></table></figure><p>Spring MVCæ”¯æŒä½¿ç”¨å•å€¼<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-async-reactive-types">reactive type</a>å¼‚æ­¥ç”Ÿæˆ <code>ResponseEntity</code>ï¼Œand&#x2F;or ä¸»ä½“çš„å•å€¼å’Œå¤šå€¼reactiveç±»å‹ã€‚</p><h5 id="Jackson-JSON"><a href="#Jackson-JSON" class="headerlink" title="Jackson JSON"></a>Jackson JSON</h5><p>Springä¸ºJackson JSONåº“æä¾›æ”¯æŒã€‚</p><h6 id="Jackson-åºåˆ—åŒ–è§†å›¾"><a href="#Jackson-åºåˆ—åŒ–è§†å›¾" class="headerlink" title="Jackson åºåˆ—åŒ–è§†å›¾"></a>Jackson åºåˆ—åŒ–è§†å›¾</h6><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-ann-jsonview">Same as in Spring WebFlux</a></p><p>Spring MVCä¸º<a href="http://wiki.fasterxml.com/JacksonJsonViews">Jacksonçš„åºåˆ—åŒ–è§†å›¾</a>æä¾›å†…ç½®æ”¯æŒï¼Œå…è®¸ä»…æ¸²æŸ“Objectä¸­æ‰€æœ‰å­—æ®µçš„å­é›†ã€‚ ä¸ºäº†ä¸<code>@ResponseBody</code>æ§åˆ¶å™¨æ–¹æ³•æˆ–è€…è¿”å›<code>ResponseEntity</code>çš„æ§åˆ¶å™¨æ–¹æ³•ä¸€èµ·ä½¿ç”¨ï¼Œå¯ä»¥ç®€å•åœ°å°†<code>@JsonView</code>æ³¨è§£æ”¾åœ¨å‚æ•°ä¸Šï¼ŒæŒ‡å®šéœ€è¦ä½¿ç”¨çš„è§†å›¾ç±»æˆ–æ¥å£å³å¯ã€‚å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@RestControllerpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> &#123;<br>    <span class="hljs-meta">@GetMapping(<span class="hljs-string">&quot;/user&quot;</span>)</span>    <span class="hljs-meta">@JsonView(User.WithoutPasswordView.class)</span>    <span class="hljs-keyword">public</span> User getUser() &#123;        <span class="hljs-keyword">return</span> new User(<span class="hljs-string">&quot;eric&quot;</span>, <span class="hljs-string">&quot;7!jd#h23&quot;</span>);    &#125;&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">WithoutPasswordView</span> &#123;&#125;;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">WithPasswordView</span> <span class="hljs-title">extends</span> <span class="hljs-title">WithoutPasswordView</span> &#123;&#125;;<br>    <span class="hljs-keyword">private</span> String username;    <span class="hljs-keyword">private</span> String password;<br>    <span class="hljs-keyword">public</span> User() &#123;    &#125;<br>    <span class="hljs-keyword">public</span> User(String username, String password) &#123;        <span class="hljs-keyword">this</span>.username = username;        <span class="hljs-keyword">this</span>.password = password;    &#125;<br>    <span class="hljs-meta">@JsonView(WithoutPasswordView.class)</span>    <span class="hljs-keyword">public</span> String getUsername() &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.username;    &#125;<br>    <span class="hljs-meta">@JsonView(WithPasswordView.class)</span>    <span class="hljs-keyword">public</span> String getPassword() &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.password;    &#125;&#125;<br></code></pre></td></tr></table></figure><p><code>@JsonView</code>å…è®¸ä¸€ç»„è§†å›¾ç±»ï¼Œä½†æ¯ä¸ªæ§åˆ¶å™¨æ–¹æ³•åªèƒ½æŒ‡å®šä¸€ä¸ªã€‚ å¦‚æœéœ€è¦æ¿€æ´»å¤šä¸ªè§†å›¾ï¼Œå¯ä»¥ä½¿ç”¨å¤åˆæ¥å£ã€‚</p><p>å¯¹äºä¾èµ–è§†å›¾çš„æ§åˆ¶å™¨ï¼Œåªéœ€å°†åºåˆ—åŒ–è§†å›¾ç±»æ·»åŠ åˆ°modelä¸­å³å¯ã€‚å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-meta">@Controllerpublic</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractController</span> </span>&#123;<br>    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">&quot;/user&quot;</span>)    public <span class="hljs-type">String</span> getUser(<span class="hljs-type">Model</span> model) &#123;        model.addAttribute(<span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-type">User</span>(<span class="hljs-string">&quot;eric&quot;</span>, <span class="hljs-string">&quot;7!jd#h23&quot;</span>));        model.addAttribute(<span class="hljs-type">JsonView</span>.<span class="hljs-keyword">class</span>.getName(), <span class="hljs-type">User</span>.<span class="hljs-type">WithoutPasswordView</span>.<span class="hljs-keyword">class</span>);        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;userView&quot;</span>;    &#125;&#125;<br></code></pre></td></tr></table></figure><h4 id="1-3-4-Model"><a href="#1-3-4-Model" class="headerlink" title="1.3.4. Model"></a>1.3.4. Model</h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-ann-modelattrib-methods">Same as in Spring WebFlux</a></p><p>æ‚¨å¯ä»¥ä½¿ç”¨<code>@ModelAttribute</code> æ³¨è§£ï¼š</p><ul><li>åœ¨<code>@RequestMapping</code>æ–¹æ³•ä¸­çš„<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-modelattrib-method-args">æ–¹æ³•å‚æ•°</a>æ–¹æ³•å‚æ•°ï¼Œç”¨äºä»modelåˆ›å»ºæˆ–è®¿é—®Objectå¹¶é€šè¿‡<code>WebDataBinder</code>å°†å…¶ç»‘å®šåˆ°è¯·æ±‚ã€‚</li><li>ä½œä¸º <code>@Controller</code>æˆ–<code>@ControllerAdvice</code> ç±»ä¸­çš„æ–¹æ³•çº§æ³¨è§£ï¼Œæœ‰åŠ©äºåœ¨ä»»ä½• <code>@RequestMapping</code>æ–¹æ³•è°ƒç”¨ä¹‹å‰åˆå§‹åŒ–æ¨¡å‹ã€‚</li><li>åœ¨<code>@RequestMapping</code>æ–¹æ³•ä¸Šæ ‡è®°å…¶è¿”å›å€¼æ˜¯ä¸€ä¸ªæ¨¡å‹å±æ€§ã€‚</li></ul><p>æœ¬èŠ‚è®¨è®º<code>@ModelAttribute</code>æ³¨è§£å¯è¢«åº”ç”¨åœ¨æ–¹æ³•æˆ–æ–¹æ³•å‚æ•°ä¸Š - å‰é¢åˆ—è¡¨ä¸­çš„ç¬¬äºŒé¡¹ã€‚æ§åˆ¶å™¨å¯ä»¥åŒ…å«ä»»æ„æ•°é‡çš„ <code>@ModelAttribute</code>æ–¹æ³•ã€‚ åœ¨åŒä¸€æ§åˆ¶å™¨ä¸­çš„<code>@RequestMapping</code>æ–¹æ³•ä¹‹å‰è°ƒç”¨æ‰€æœ‰è¿™äº›æ–¹æ³•ã€‚ <code>@ModelAttribute</code>æ–¹æ³•ä¹Ÿå¯ä»¥é€šè¿‡<code>@ControllerAdvice</code>åœ¨æ§åˆ¶å™¨ä¹‹é—´å…±äº«ã€‚ æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-controller-advice">æ§åˆ¶å™¨ä¸Šçš„é€šçŸ¥</a> éƒ¨åˆ†ã€‚</p><p><code>@ModelAttribute</code>æ–¹æ³•å…·æœ‰çµæ´»çš„æ–¹æ³•ç­¾åã€‚ é™¤äº†ä¸<code>@ModelAttribute</code>æœ¬èº«æˆ–è¯·æ±‚ä½“ç›¸å…³çš„ä»»ä½•å†…å®¹å¤–ï¼Œå®ƒä»¬æ”¯æŒè®¸å¤šä¸<code>@RequestMapping</code>æ–¹æ³•ç›¸åŒçš„å‚æ•°ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†<code>@ModelAttribute</code> æ–¹æ³•ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@ModelAttribute</span><br><br>public void <span class="hljs-built_in">populateModel</span>(<span class="hljs-variable">@RequestParam</span> String number, Model model) &#123;<br><br>    <span class="hljs-selector-tag">model</span><span class="hljs-selector-class">.addAttribute</span>(accountRepository.<span class="hljs-built_in">findAccount</span>(number));<br><br>    <span class="hljs-comment">// add more ...</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹ç¤ºä¾‹ä»…æ·»åŠ ä¸€ä¸ªå±æ€§:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@ModelAttribute</span><br><br>public Account <span class="hljs-built_in">addAccount</span>(<span class="hljs-variable">@RequestParam</span> String number) &#123;<br><br>    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">accountRepository</span><span class="hljs-selector-class">.findAccount</span>(number);<br><br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœæœªæ˜ç¡®æŒ‡å®šåç§°ï¼Œæ¡†æ¶å°†æ ¹æ®å±æ€§çš„ç±»å‹ç»™äºˆä¸€ä¸ªé»˜è®¤åç§°ï¼Œå¦‚<a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/core/Conventions.html"><code>Conventions</code></a>çš„javadocä¸­æ‰€è¿°ã€‚ ä½ å¯ä»¥é€šè¿‡è®¾ç½®<code>@ModelAttribute</code>æ³¨è§£çš„å€¼æ¥æ”¹å˜é»˜è®¤å€¼ã€‚å½“å‘Modelä¸­ç›´æ¥æ·»åŠ å±æ€§æ—¶ï¼Œè¯·ä½¿ç”¨åˆé€‚çš„é‡è½½æ–¹æ³•<code>addAttribute</code>ã€‚</p><p><code>@ModelAttribute</code> æ³¨è§£ä¹Ÿå¯ä»¥è¢«ç”¨åœ¨<code>@RequestMapping</code>æ–¹æ³•ä¸Šï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œ<code>@RequestMapping</code>æ–¹æ³•çš„è¿”å›å€¼å°†ä¼šè¢«è§£é‡Šä¸ºmodelçš„ä¸€ä¸ªå±æ€§ï¼Œè€Œéä¸€ä¸ªè§†å›¾åã€‚ æ­¤æ—¶è§†å›¾åå°†ä»¥è§†å›¾å‘½åçº¦å®šæ¥æ–¹å¼æ¥å†³è®®ï¼Œä¸è¿”å›å€¼ä¸ºvoidçš„æ–¹æ³•æ‰€é‡‡ç”¨çš„å¤„ç†æ–¹æ³•ç±»ä¼¼ã€‚<code>@ModelAttribute</code> è¿˜å¯ä»¥è‡ªå®šä¹‰æ¨¡å‹å±æ€§åç§°ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@GetMapping</span>(<span class="hljs-string">&quot;/accounts/&#123;id&#125;&quot;</span>)<br><br><span class="hljs-variable">@ModelAttribute</span>(<span class="hljs-string">&quot;myAccount&quot;</span>)<br><br>public Account <span class="hljs-built_in">handle</span>() &#123;<br><br>    <span class="hljs-comment">// ...</span><br><br>    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">account</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="1-3-5-æ•°æ®ç»‘å®š"><a href="#1-3-5-æ•°æ®ç»‘å®š" class="headerlink" title="1.3.5. æ•°æ®ç»‘å®š"></a>1.3.5. <code>æ•°æ®ç»‘å®š</code></h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-ann-initbinder">Same as in Spring WebFlux</a></p><p><code>@Controller</code>æˆ–<code>@ControllerAdvice</code>ç±»å¯ä»¥ä½¿ç”¨<code>@InitBinder</code> æ–¹æ³•åˆå§‹åŒ–<code>WebDataBinder</code>çš„å®ä¾‹ï¼Œè€Œè¿™äº›æ–¹æ³•åˆå¯ä»¥ï¼š</p><ul><li>å°†è¯·æ±‚å‚æ•°ï¼ˆå³è¡¨å•æˆ–æŸ¥è¯¢æ•°æ®ï¼‰ç»‘å®šåˆ°æ¨¡å‹å¯¹è±¡ã€‚</li><li>å°†åŸºäºå­—ç¬¦ä¸²çš„è¯·æ±‚å€¼ï¼ˆä¾‹å¦‚è¯·æ±‚å‚æ•°ï¼Œè·¯å¾„å˜é‡ï¼Œè¯·æ±‚å¤´ï¼Œcookieç­‰ï¼‰è½¬æ¢ä¸ºç›®æ ‡ç±»å‹çš„æ§åˆ¶å™¨æ–¹æ³•å‚æ•°ã€‚</li><li>åœ¨å‘ˆç°HTMLè¡¨å•æ—¶å°†æ¨¡å‹å¯¹è±¡å€¼æ ¼å¼åŒ–ä¸º<code>String</code>å€¼ã€‚</li></ul><p><code>@InitBinder</code>æ–¹æ³•å¯ä»¥æ³¨å†Œç‰¹å®šäºæ§åˆ¶å™¨çš„<code>java.bean.PropertyEditor</code>æˆ–Spring <code>Converter</code>å’Œ<code>Formatter</code>ç»„ä»¶ã€‚ æ­¤å¤–ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-config-conversion">MVC config</a>åœ¨å…¨å±€å…±äº«çš„<code>FormattingConversionService</code>ä¸­æ³¨å†Œ<code>Converter</code>å’Œ<code>Formatter</code>ç±»å‹ã€‚</p><p><code>@InitBinder</code> æ–¹æ³•æ”¯æŒè®¸å¤šä¸<code>@RequestMapping</code>æ–¹æ³•ç›¸åŒçš„å‚æ•°ï¼Œä½†<code>@ModelAttribute</code>ï¼ˆå‘½ä»¤å¯¹è±¡ï¼‰å‚æ•°é™¤å¤–ã€‚ é€šå¸¸ï¼Œå®ƒä»¬ä½¿ç”¨<code>WebDataBinder</code>å‚æ•°ï¼ˆç”¨äºæ³¨å†Œï¼‰å’Œvoidè¿”å›å€¼è¿›è¡Œå£°æ˜ã€‚ ä»¥ä¸‹æ¸…å•æ˜¾ç¤ºäº†ä¸€ä¸ªç¤ºä¾‹:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Controllerpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FormController</span> &#123;<br>    <span class="hljs-meta">@InitBinder</span> (<span class="hljs-number">1</span>)    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">initBinder</span>(<span class="hljs-params">WebDataBinder binder</span>) &#123;        <span class="hljs-title class_">SimpleDateFormat</span> dateFormat = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>);        dateFormat.<span class="hljs-title function_">setLenient</span>(<span class="hljs-literal">false</span>);        binder.<span class="hljs-title function_">registerCustomEditor</span>(<span class="hljs-title class_">Date</span>.<span class="hljs-property">class</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomDateEditor</span>(dateFormat, <span class="hljs-literal">false</span>));    &#125;<br>    <span class="hljs-comment">// ...&#125;</span><br></code></pre></td></tr></table></figure><p><strong>1</strong>ã€Defining an <code>@InitBinder</code> method.</p><p>æˆ–è€…ï¼Œå½“ä½¿ç”¨åŸºäºFormatterçš„è®¾ç½®æ—¶ï¼Œæ‚¨å¯ä»¥é€šè¿‡å…±äº«çš„<code>FormattingConversionService</code>é‡å¤ä½¿ç”¨ç›¸åŒçš„æ–¹æ³•å¹¶æ³¨å†Œç‰¹å®šäºæ§åˆ¶å™¨çš„ <code>Formatter</code> å®ç°ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Controllerpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FormController</span> &#123;<br>    <span class="hljs-meta">@InitBinder</span> (<span class="hljs-number">1</span>)    <span class="hljs-keyword">protected</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">initBinder</span>(<span class="hljs-params">WebDataBinder binder</span>) &#123;        binder.<span class="hljs-title function_">addCustomFormatter</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">DateFormatter</span>(<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>));    &#125;<br>    <span class="hljs-comment">// ...&#125;</span><br></code></pre></td></tr></table></figure><p><strong>1</strong>ã€Defining an <code>@InitBinder</code> method on a custom formatter.</p><h4 id="1-3-6-å¼‚å¸¸"><a href="#1-3-6-å¼‚å¸¸" class="headerlink" title="1.3.6. å¼‚å¸¸"></a>1.3.6. å¼‚å¸¸</h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-ann-controller-exceptions">Same as in Spring WebFlux</a></p><p><code>@Controller</code> å’Œ <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-controller-advice">@ControllerAdvice</a>å¯ä»¥ä½¿ç”¨<code>@ExceptionHandler</code>æ–¹æ³•æ¥å¤„ç†æ¥è‡ªæ§åˆ¶å™¨æ–¹æ³•çš„å¼‚å¸¸ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Controllerpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleController</span> &#123;<br>    <span class="hljs-comment">// ...</span><br>    <span class="hljs-meta">@ExceptionHandler</span>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">ResponseEntity</span>&lt;<span class="hljs-title class_">String</span>&gt; <span class="hljs-title function_">handle</span>(<span class="hljs-params">IOException ex</span>) &#123;        <span class="hljs-comment">// ...    &#125;&#125;</span><br></code></pre></td></tr></table></figure><p>è¯¥å¼‚å¸¸å¯èƒ½ä¸é¡¶çº§å¼‚å¸¸ï¼ˆå³æŠ›å‡ºç›´æ¥<code>IOException</code>ï¼‰æˆ–é¡¶çº§åŒ…è£…å™¨ä¸­çš„å¼‚å¸¸ï¼ˆä¾‹å¦‚ï¼ŒåŒ…å«åœ¨ <code>IllegalStateException</code>å†…çš„<code>IOException</code>ï¼‰ç›¸åŒ¹é…ã€‚</p><p>å¯¹äºåŒ¹é…çš„å¼‚å¸¸ç±»å‹ï¼Œæœ€å¥½å°†ç›®æ ‡å¼‚å¸¸å£°æ˜ä¸ºæ–¹æ³•å‚æ•°ï¼Œå¦‚å‰é¢çš„ç¤ºä¾‹æ‰€ç¤ºã€‚å½“å¤šä¸ªå¼‚å¸¸æ–¹æ³•åŒ¹é…æ—¶ï¼Œæ ¹(root)å¼‚å¸¸åŒ¹é…é€šå¸¸ä¼˜å…ˆäºåŸå› (cause )å¼‚å¸¸åŒ¹é…ã€‚ æ›´å…·ä½“åœ°è¯´ï¼Œ<code>ExceptionDepthComparator</code> ç”¨äºæ ¹æ®æŠ›å‡ºçš„å¼‚å¸¸ç±»å‹çš„æ·±åº¦å¯¹å¼‚å¸¸è¿›è¡Œæ’åºã€‚</p><p>æ³¨è§£å£°æ˜å¯ä»¥ç¼©å°è¦åŒ¹é…çš„å¼‚å¸¸ç±»å‹ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs arduino">@<span class="hljs-built_in">ExceptionHandler</span>(&#123;FileSystemException.<span class="hljs-keyword">class</span>, RemoteException.<span class="hljs-keyword">class</span>&#125;)<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> ResponseEntity&lt;<span class="hljs-type">String</span>&gt; <span class="hljs-title">handle</span><span class="hljs-params">(IOException ex)</span> </span>&#123;<br><br>    <span class="hljs-comment">// ...</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p>æ‚¨ç”šè‡³å¯ä»¥ä½¿ç”¨ç‰¹å®šå¼‚å¸¸ç±»å‹åˆ—è¡¨ä¸­çš„éå¸¸é€šç”¨çš„å‚æ•°ç­¾åï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š:</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs arduino">@<span class="hljs-built_in">ExceptionHandler</span>(&#123;FileSystemException.<span class="hljs-keyword">class</span>, RemoteException.<span class="hljs-keyword">class</span>&#125;)<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> ResponseEntity&lt;<span class="hljs-type">String</span>&gt; <span class="hljs-title">handle</span><span class="hljs-params">(Exception ex)</span> </span>&#123;<br><br>    <span class="hljs-comment">// ...</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p>æ ¹(root)å’ŒåŸå› (cause )å¼‚å¸¸åŒ¹é…ä¹‹é—´çš„åŒºåˆ«å¯èƒ½æ˜¯ä»¤äººæƒŠè®¶çš„ã€‚</p><p>åœ¨å‰é¢æ˜¾ç¤ºçš„<code>IOException</code>å˜ä½“ä¸­ï¼Œé€šå¸¸ä½¿ç”¨å®é™…çš„<code>FileSystemException</code>æˆ–<code>RemoteException</code>å®ä¾‹ä½œä¸ºå‚æ•°è°ƒç”¨è¯¥æ–¹æ³•ï¼Œå› ä¸ºå®ƒä»¬éƒ½æ˜¯ä»<code>IOException</code>æ‰©å±•çš„ã€‚ ä½†æ˜¯ï¼Œå¦‚æœä»»ä½•æ­¤ç±»å¼‚å¸¸åœ¨åŒ…è£…å™¨å†…ä¼ æ’­ï¼Œè€Œè¯¥å¼‚å¸¸æœ¬èº«å°±æ˜¯<code>IOException</code>ï¼Œåˆ™ä¼ å…¥çš„å¼‚å¸¸å®ä¾‹å°±æ˜¯åŒ…è£…å™¨å¼‚å¸¸ã€‚</p><p>åœ¨<code>handle(Exception)</code>å˜ä½“ä¸­ï¼Œè¡Œä¸ºæ›´ç®€å•ã€‚ è¿™æ€»æ˜¯åœ¨åŒ…è£…åœºæ™¯ä¸­ä½¿ç”¨åŒ…è£…å™¨å¼‚å¸¸è°ƒç”¨ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹å¯ä»¥é€šè¿‡ <code>ex.getCause()</code>æ‰¾åˆ°å®é™…åŒ¹é…çš„å¼‚å¸¸ã€‚ ä¼ å…¥çš„å¼‚å¸¸ä»…åœ¨å®é™…çš„<code>FileSystemException</code>æˆ–<code>RemoteException</code>å®ä¾‹è¢«æŠ›å‡ºä¸ºé¡¶çº§å¼‚å¸¸æ—¶æ‰ä¼šå‘ç”Ÿã€‚</p><p>æˆ‘ä»¬é€šå¸¸å»ºè®®æ‚¨åœ¨å‚æ•°ç­¾åä¸­å°½å¯èƒ½å…·ä½“ï¼Œå‡å°‘rootå’Œcauseå¼‚å¸¸ç±»å‹ä¹‹é—´ä¸åŒ¹é…çš„å¯èƒ½æ€§ã€‚ è€ƒè™‘å°†å¤šåŒ¹é…æ–¹æ³•åˆ†è§£ä¸ºå•ç‹¬çš„<code>@ExceptionHandler</code>æ–¹æ³•ï¼Œæ¯ä¸ªæ–¹æ³•é€šè¿‡å…¶ç­¾ååŒ¹é…å•ä¸ªç‰¹å®šå¼‚å¸¸ç±»å‹ã€‚</p><p>åœ¨å…·æœ‰å¤šä¸ª<code>@ControllerAdvice</code>ç»„æˆä¸­ï¼Œæˆ‘ä»¬å»ºè®®åœ¨<code>@ControllerAdvice</code>ä¸Šå£°æ˜æ ¹å¼‚å¸¸æ˜ å°„ï¼Œå¹¶ä½¿ç”¨ç›¸åº”çš„é¡ºåºè¿›è¡Œä¼˜å…ˆçº§æ’åºã€‚ è™½ç„¶æ ¹å¼‚å¸¸åŒ¹é…ä¼˜å…ˆäºæŸä¸ªåŸå› ï¼Œä½†è¿™æ˜¯åœ¨ç»™å®šæ§åˆ¶å™¨æˆ– <code>@ControllerAdvice</code>ç±»çš„æ–¹æ³•ä¸­å®šä¹‰çš„ã€‚ è¿™æ„å‘³ç€ä¼˜å…ˆçº§è¾ƒé«˜çš„ <code>@ControllerAdvice</code> beanä¸Šçš„åŸå› åŒ¹é…ä¼˜å…ˆäºè¾ƒä½ä¼˜å…ˆçº§çš„ <code>@ControllerAdvice</code> beanä¸Šçš„ä»»ä½•åŒ¹é…ï¼ˆä¾‹å¦‚ï¼Œrootï¼‰ã€‚</p><p>æœ€åä½†åŒæ ·é‡è¦çš„æ˜¯ï¼Œ å¯ä»¥é€šè¿‡<code>@ExceptionHandler</code>æ–¹æ³•çš„å®ç°ï¼Œè®²å¼‚å¸¸ä»¥åŸå§‹çš„å½¢å¼é‡æ–°æŠ›å‡ºï¼Œå¹¶æä¾›ç»™ç‰¹å®šçš„å¼‚å¸¸å®ä¾‹ã€‚ è¿™åœ¨æ‚¨ä»…å¯¹æ ¹çº§åˆ«åŒ¹é…æˆ–åœ¨ç‰¹å®šä¸Šä¸‹æ–‡ä¸­æ— æ³•é™æ€ç¡®å®šçš„åŒ¹é…ä¸­æ„Ÿå…´è¶£çš„æƒ…å†µä¸‹éå¸¸æœ‰ç”¨ã€‚ é‡æ–°æŠ›å‡ºçš„å¼‚å¸¸é€šè¿‡åç»­çš„è§£æé“¾ä¼ æ’­ï¼Œå°±å¥½åƒç»™å®šçš„<code>@ExceptionHandler</code>æ–¹æ³•é¦–å…ˆä¸åŒ¹é…ä¸€æ ·ã€‚</p><p>Spring MVCä¸­å¯¹<code>@ExceptionHandler</code>æ–¹æ³•çš„æ”¯æŒæ˜¯åŸºäº<code>DispatcherServlet</code>çº§åˆ«çš„<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-exceptionhandlers">HandlerExceptionResolver</a>æœºåˆ¶æ„å»ºçš„ã€‚</p><h5 id="æ–¹æ³•å‚æ•°-1"><a href="#æ–¹æ³•å‚æ•°-1" class="headerlink" title="æ–¹æ³•å‚æ•°"></a>æ–¹æ³•å‚æ•°</h5><p><code>@ExceptionHandler</code> æ–¹æ³•æ”¯æŒä»¥ä¸‹å‚æ•°ï¼š</p><table><thead><tr><th>æ–¹æ³• å‚æ•°</th><th>æè¿°</th></tr></thead><tbody><tr><td>Exception type</td><td>ç”¨äºè®¿é—®å¼•å‘çš„å¼‚å¸¸ã€‚</td></tr><tr><td><code>HandlerMethod</code></td><td>è®¿é—®æ§åˆ¶å™¨æ–¹æ³•å¼•å‘çš„å¼‚å¸¸</td></tr><tr><td><code>WebRequest</code>, <code>NativeWebRequest</code></td><td>æ— éœ€ç›´æ¥ä½¿ç”¨Servlet APIå³å¯è®¿é—®è¯·æ±‚å‚æ•°ä»¥åŠè¯·æ±‚å’Œä¼šè¯å±æ€§ã€‚</td></tr><tr><td><code>javax.servlet.ServletRequest</code>, <code>javax.servlet.ServletResponse</code></td><td>é€‰æ‹©ä»»ä½•ç‰¹å®šçš„è¯·æ±‚æˆ–å“åº”ç±»å‹ï¼ˆä¾‹å¦‚ï¼Œ<code>ServletRequest</code> or <code>HttpServletRequest</code> or or Springâ€™s <code>MultipartRequest</code> or <code>MultipartHttpServletRequest</code>).</td></tr><tr><td><code>javax.servlet.http.HttpSession</code></td><td>å¼ºåˆ¶è¿›è¡Œä¼šè¯ã€‚ å› æ­¤ï¼Œè¿™æ ·çš„ç»“æœæ°¸è¿œä¸ä¼šæ˜¯<code>null</code>çš„ã€‚è¯·æ³¨æ„ï¼Œä¼šè¯è®¿é—®ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ å¦‚æœå…è®¸å¤šä¸ªè¯·æ±‚åŒæ—¶è®¿é—®ä¼šè¯ï¼Œè¯·è€ƒè™‘å°†<code>RequestMappingHandlerAdapter</code>å®ä¾‹çš„<code>synchronizeOnSession</code>æ ‡å¿—è®¾ç½®ä¸º<code>true</code>ã€‚</td></tr><tr><td><code>java.security.Principal</code></td><td>å½“å‰ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ· - å¦‚æœå·²çŸ¥ï¼Œå¯èƒ½æ˜¯ç‰¹å®šçš„ <code>Principal</code>å®ç°ç±»ã€‚</td></tr><tr><td><code>HttpMethod</code></td><td>è¯·æ±‚çš„HTTPæ–¹æ³•ã€‚</td></tr><tr><td><code>java.util.Locale</code></td><td>å½“å‰è¯·æ±‚åŒºåŸŸè®¾ç½®ï¼Œç”±æœ€å¯ç”¨çš„ <code>LocaleResolver</code>ï¼ˆå®é™…ä¸Šæ˜¯å·²é…ç½®çš„ <code>LocaleResolver</code>æˆ–<code>LocaleContextResolver</code>ï¼‰ç¡®å®šã€‚</td></tr><tr><td><code>java.util.TimeZone</code>, <code>java.time.ZoneId</code></td><td>ä¸å½“å‰è¯·æ±‚å…³è”çš„æ—¶åŒºï¼Œç”±<code>LocaleContextResolver</code>ç¡®å®šã€‚</td></tr><tr><td><code>java.io.OutputStream</code>, <code>java.io.Writer</code></td><td>ç”¨äºè®¿é—®Servlet APIå…¬å¼€çš„åŸå§‹å“åº”ä¸»ä½“ã€‚</td></tr><tr><td><code>java.util.Map</code>, <code>org.springframework.ui.Model</code>, <code>org.springframework.ui.ModelMap</code></td><td>ç”¨äºè®¿é—®æ¨¡å‹ä»¥è·å–é”™è¯¯å“åº”ã€‚ æ€»æ˜¯ä¸ºç©º.</td></tr><tr><td><code>RedirectAttributes</code></td><td>æŒ‡å®šåœ¨é‡å®šå‘çš„æƒ…å†µä¸‹ä½¿ç”¨çš„å±æ€§ - ï¼ˆå°†é™„åŠ åˆ°æŸ¥è¯¢å­—ç¬¦ä¸²ï¼‰å’Œä¸´æ—¶å­˜å‚¨çš„flashå±æ€§ï¼Œç›´åˆ°é‡å®šå‘åçš„è¯·æ±‚ä¸ºæ­¢ã€‚ è¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-redirecting-passing-data">Redirect å±æ€§</a>å’Œ<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-flash-attributes">Flash å±æ€§</a>ã€‚</td></tr><tr><td><code>@SessionAttribute</code></td><td>ç”¨äºè®¿é—®ä»»ä½•ä¼šè¯å±æ€§ï¼Œä¸ç”±äºç±»çº§åˆ«<code>@SessionAttributes</code>å£°æ˜çš„ç»“æŸå½¢æˆå¯¹æ¯”ã€‚ æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-sessionattribute"><code>@SessionAttribute</code></a>ã€‚</td></tr><tr><td><code>@RequestAttribute</code></td><td>ç”¨äºè®¿é—®è¯·æ±‚å±æ€§ã€‚ æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-requestattrib"><code>@RequestAttribute</code></a>ã€‚</td></tr></tbody></table><h5 id="è¿”å›å€¼-1"><a href="#è¿”å›å€¼-1" class="headerlink" title="è¿”å›å€¼"></a>è¿”å›å€¼</h5><p><code>@ExceptionHandler</code>æ–¹æ³•æ”¯æŒä»¥ä¸‹è¿”å›å€¼:</p><table><thead><tr><th>è¿”å›å€¼</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>@ResponseBody</code></td><td>è¿”å›å€¼é€šè¿‡<code>HttpMessageConverter</code>å®ç°è½¬æ¢å¹¶å†™å…¥å“åº”ã€‚ è¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-responsebody"><code>@ResponseBody</code></a>ã€‚</td></tr><tr><td><code>HttpEntity&lt;B&gt;</code>, <code>ResponseEntity&lt;B&gt;</code></td><td>æŒ‡å®šå®Œæ•´å“åº”ï¼ˆåŒ…æ‹¬HTTPå¤´å’Œä¸»ä½“ï¼‰çš„è¿”å›å€¼å°†é€šè¿‡ <code>HttpMessageConverter</code>å®ç°è½¬æ¢å¹¶å†™å…¥å“åº”ã€‚ è¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-responseentity">ResponseEntity</a>ã€‚</td></tr><tr><td><code>String</code></td><td>è¦ä½¿ç”¨<code>ViewResolver</code>å®ç°è§£æçš„è§†å›¾åç§°ï¼Œå¹¶ä¸éšå¼æ¨¡å‹ä¸€èµ·ä½¿ç”¨ - é€šè¿‡å‘½ä»¤å¯¹è±¡å’Œ <code>@ModelAttribute</code>æ–¹æ³•ç¡®å®šã€‚ å¤„ç†ç¨‹åºæ–¹æ³•è¿˜å¯ä»¥é€šè¿‡å£°æ˜ <code>Model</code>å‚æ•°ä»¥ç¼–ç¨‹æ–¹å¼ä¸°å¯Œæ¨¡å‹ï¼ˆè¯·å‚é˜… <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-requestmapping-registration">æ˜¾å¼æ³¨å†Œ</a>ï¼‰ã€‚</td></tr><tr><td><code>View</code></td><td>ç”¨äºä¸éšå¼æ¨¡å‹ä¸€èµ·å‘ˆç°çš„<code>View</code>å®ä¾‹ - é€šè¿‡å‘½ä»¤å¯¹è±¡å’Œ<code>@ModelAttribute</code>æ–¹æ³•ç¡®å®šã€‚ å¤„ç†ç¨‹åºæ–¹æ³•è¿˜å¯ä»¥é€šè¿‡å£°æ˜<code>Model</code>å‚æ•°ä»¥ç¼–ç¨‹æ–¹å¼ä¸°å¯Œæ¨¡å‹ï¼ˆè¯·å‚é˜… <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-requestmapping-registration">æ˜¾å¼æ³¨å†Œ</a>ï¼‰ã€‚</td></tr><tr><td><code>java.util.Map</code>, <code>org.springframework.ui.Model</code></td><td>è¦æ·»åŠ åˆ°éšå¼æ¨¡å‹çš„å±æ€§ï¼Œé€šè¿‡<code>RequestToViewNameTranslator</code>éšå¼ç¡®å®šè§†å›¾åç§°ã€‚</td></tr><tr><td><code>@ModelAttribute</code></td><td>è¦æ·»åŠ åˆ°æ¨¡å‹çš„å±æ€§ï¼Œé€šè¿‡éšå¼ç¡®å®šè§†å›¾åç§°ã€‚è¯·æ³¨æ„ï¼Œ<code>@ModelAttribute</code>æ˜¯å¯é€‰çš„ã€‚ è¯·å‚é˜…æœ¬è¡¨æœ«å°¾çš„â€œä»»ä½•å…¶ä»–è¿”å›å€¼â€ã€‚</td></tr><tr><td><code>ModelAndView</code> object</td><td>è¦ä½¿ç”¨çš„è§†å›¾å’Œæ¨¡å‹å±æ€§ï¼Œä»¥åŠï¼ˆå¯é€‰ï¼‰å“åº”çŠ¶æ€ã€‚</td></tr><tr><td><code>void</code></td><td>å¦‚æœå…·æœ‰<code>void</code>è¿”å›ç±»å‹ï¼ˆæˆ–è¿”å›å€¼ä¸º <code>null</code> ï¼‰çš„æ–¹æ³•ï¼Œå¦‚æœå®ƒè¿˜å…·æœ‰<code>ServletResponse</code>ï¼Œ<code>OutputStream</code>å‚æ•°æˆ–<code>@ResponseStatus</code>æ³¨è§£ï¼Œ åˆ™è®¤ä¸ºå·²å®Œå…¨å¤„ç†è¯¥å“åº”ã€‚ å¦‚æœæ§åˆ¶å™¨å·²è¿›è¡Œæ­£<code>ETag</code>æˆ–<code>lastModified</code> æ—¶é—´æˆ³æ£€æŸ¥ï¼Œåˆ™ä¹Ÿæ˜¯å¦‚æ­¤ï¼ˆæœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-caching-etag-lastmodified">Controllers</a>ï¼‰ã€‚ å¦‚æœä»¥ä¸Šéƒ½ä¸æ˜¯çœŸçš„ï¼Œåˆ™<code>void</code>è¿”å›ç±»å‹ä¹Ÿå¯ä»¥æŒ‡ç¤ºRESTæ§åˆ¶å™¨çš„â€œæ— å“åº”ä¸»ä½“â€æˆ–HTMLæ§åˆ¶å™¨çš„é»˜è®¤è§†å›¾åç§°é€‰æ‹©ã€‚</td></tr><tr><td>Any other return value</td><td>ä»»ä½•ä¸æ­¤è¡¨ä¸­ä»»ä½•æ—©æœŸå€¼ä¸åŒ¹é…ä¸”è¿”å›å€¼ä¸º<code>String</code> æˆ–<code>void</code>çš„è¿”å›å€¼éƒ½è¢«è§†ä¸ºè§†å›¾åç§°ï¼ˆé€šè¿‡<code>RequestToViewNameTranslator</code>åº”ç”¨é»˜è®¤è§†å›¾åç§°é€‰æ‹©ï¼‰ï¼Œ å‰ææ˜¯å®ƒä¸æ˜¯ç®€å•ç±»å‹ï¼Œç”± <a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/beans/BeanUtils.html#isSimpleProperty-java.lang.Class-">BeanUtils#isSimpleProperty</a>ç¡®å®šï¼Œç®€å•ç±»å‹çš„å€¼ä»æœªè§£å†³ã€‚</td></tr></tbody></table><h5 id="REST-API-å¼‚å¸¸"><a href="#REST-API-å¼‚å¸¸" class="headerlink" title="REST API å¼‚å¸¸"></a>REST API å¼‚å¸¸</h5><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-ann-rest-exceptions">Same as in Spring WebFlux</a></p><p>RESTæœåŠ¡çš„ä¸€ä¸ªå¸¸è§è¦æ±‚æ˜¯åœ¨å“åº”æ­£æ–‡ä¸­åŒ…å«é”™è¯¯è¯¦ç»†ä¿¡æ¯ã€‚ Spring Frameworkä¸ä¼šè‡ªåŠ¨æ‰§è¡Œæ­¤æ“ä½œï¼Œå› ä¸ºå“åº”æ­£æ–‡ä¸­çš„é”™è¯¯è¯¦ç»†ä¿¡æ¯çš„è¡¨ç¤ºæ˜¯ç‰¹å®šäºåº”ç”¨ç¨‹åºçš„ã€‚ ä½†æ˜¯ï¼Œ<code>@RestController</code>å¯ä»¥ä½¿ç”¨å¸¦æœ‰ResponseEntityè¿”å›å€¼çš„<code>@ExceptionHandler</code>æ–¹æ³•æ¥è®¾ç½®å“åº”çš„çŠ¶æ€å’Œæ­£æ–‡ã€‚ è¿™äº›æ–¹æ³•ä¹Ÿå¯ä»¥åœ¨<code>@ControllerAdvice</code>ç±»ä¸­å£°æ˜ï¼Œä»¥å…¨å±€åº”ç”¨å®ƒä»¬ã€‚</p><p>åœ¨å“åº”ä¸»ä½“ä¸­å®ç°å…·æœ‰é”™è¯¯è¯¦ç»†ä¿¡æ¯çš„å…¨å±€å¼‚å¸¸å¤„ç†çš„åº”ç”¨ç¨‹åºåº”è€ƒè™‘æ‰©å±•<a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/method/annotation/ResponseEntityExceptionHandler.html"><code>ResponseEntityExceptionHandler</code></a>ï¼Œ å®ƒæä¾›å¯¹Spring MVCå¼•å‘çš„å¼‚å¸¸çš„å¤„ç†ï¼Œå¹¶æä¾›é’©å­æ¥å®šåˆ¶å“åº”ä¸»ä½“ã€‚è¦ä½¿ç”¨å®ƒï¼Œè¯·åˆ›å»º<code>ResponseEntityExceptionHandler</code>çš„å­ç±»ï¼Œä½¿ç”¨<code>@ControllerAdvice</code>æ³¨è§£å®ƒï¼Œè¦†ç›–å¿…è¦çš„æ–¹æ³•ï¼Œå¹¶å°†å…¶å£°æ˜ä¸ºSpring beanã€‚</p><h4 id="1-3-7-æ§åˆ¶å™¨é€šçŸ¥"><a href="#1-3-7-æ§åˆ¶å™¨é€šçŸ¥" class="headerlink" title="1.3.7. æ§åˆ¶å™¨é€šçŸ¥"></a>1.3.7. æ§åˆ¶å™¨é€šçŸ¥</h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-ann-controller-advice">Same as in Spring WebFlux</a></p><p>é€šå¸¸ï¼Œåœ¨<code>@Controller</code>ç±»ä¸Šå£°æ˜<code>@ExceptionHandler</code>, <code>@InitBinder</code>, å’Œ <code>@ModelAttribute</code>æ³¨è§£ã€‚ å¦‚æœæ‚¨å¸Œæœ›æ­¤ç±»æ–¹æ³•æ›´å…¨å±€åœ°åº”ç”¨ï¼ˆè·¨æ§åˆ¶å™¨ï¼‰ï¼Œåˆ™å¯ä»¥åœ¨æ ‡æœ‰<code>@ControllerAdvice</code> æˆ– <code>@RestControllerAdvice</code>çš„ç±»ä¸­å£°æ˜å®ƒä»¬ã€‚</p><p><code>@ControllerAdvice``@Component</code>æ ‡è®°ï¼Œè¿™æ„å‘³ç€å¯ä»¥é€šè¿‡<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/core.html#beans-java-instantiating-container-scan">ç»„ä»¶æ‰«æ</a>å°†è¿™äº›ç±»æ³¨å†Œä¸ºSpring beanã€‚ <code>@RestControllerAdvice</code>ä¹Ÿæ˜¯ä¸€ä¸ªç”¨<code>@ControllerAdvice</code>å’Œ<code>@ResponseBody</code>æ ‡è®°çš„å…ƒæ³¨è§£ï¼Œè¿™å®é™…ä¸Šæ„å‘³ç€ <code>@ExceptionHandler</code> æ–¹æ³•é€šè¿‡æ¶ˆæ¯è½¬æ¢ï¼ˆä¸è§†å›¾åˆ†è¾¨ç‡æˆ–æ¨¡æ¿æ¸²æŸ“ç›¸å¯¹ï¼‰å‘ˆç°ç»™å“åº”ä¸»ä½“ã€‚</p><p>åœ¨å¯åŠ¨æ—¶ï¼Œ <code>@RequestMapping</code>å’Œ<code>@ExceptionHandler</code>æ–¹æ³•çš„åŸºç¡€ç»“æ„ç±»æ£€æµ‹ <code>@ControllerAdvice</code> ç±»å‹çš„Spring beanï¼Œç„¶ååœ¨è¿è¡Œæ—¶åº”ç”¨å®ƒä»¬çš„æ–¹æ³•ã€‚ å…¨å±€<code>@ExceptionHandler</code>æ–¹æ³•ï¼ˆæ¥è‡ª<code>@ControllerAdvice</code>ï¼‰åœ¨æœ¬åœ°æ–¹æ³•ä¹‹åï¼ˆæ¥è‡ª <code>@Controller</code>ï¼‰åº”ç”¨ã€‚ ç›¸æ¯”ä¹‹ä¸‹ï¼Œå…¨å±€<code>@ModelAttribute</code>å’Œ<code>@InitBinder</code>æ–¹æ³•åœ¨æœ¬åœ°æ–¹æ³•ä¹‹å‰åº”ç”¨ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>@ControllerAdvice</code>æ–¹æ³•é€‚ç”¨äºæ¯ä¸ªè¯·æ±‚ï¼ˆå³æ‰€æœ‰æ§åˆ¶å™¨ï¼‰ï¼Œä½†æ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨æ³¨è§£ä¸Šçš„å±æ€§å°†å…¶ç¼©å°åˆ°æ§åˆ¶å™¨çš„å­é›†ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">// Target <span class="hljs-keyword">all</span> Controllers annotated <span class="hljs-keyword">with</span> @RestController@ControllerAdvice(annotations = RestController.<span class="hljs-keyword">class</span>)<span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> ExampleAdvice1 &#123;&#125;<br>// Target <span class="hljs-keyword">all</span> Controllers <span class="hljs-keyword">within</span> specific packages@ControllerAdvice(&quot;org.example.controllers&quot;)<span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> ExampleAdvice2 &#123;&#125;<br>// Target <span class="hljs-keyword">all</span> Controllers assignable <span class="hljs-keyword">to</span> specific classes@ControllerAdvice(assignableTypes = &#123;ControllerInterface.<span class="hljs-keyword">class</span>, AbstractController.<span class="hljs-keyword">class</span>&#125;)<span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> ExampleAdvice3 &#123;&#125;<br></code></pre></td></tr></table></figure><p>å‰é¢ç¤ºä¾‹ä¸­çš„é€‰æ‹©å™¨åœ¨è¿è¡Œæ—¶è¿›è¡Œè¯„ä¼°ï¼Œå¦‚æœå¹¿æ³›ä½¿ç”¨ï¼Œå¯èƒ½ä¼šå¯¹æ€§èƒ½äº§ç”Ÿè´Ÿé¢å½±å“ã€‚ æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/web/bind/annotation/ControllerAdvice.html"><code>@ControllerAdvice</code></a> javadoc ã€‚</p><h3 id="1-4-URI-é“¾æ¥"><a href="#1-4-URI-é“¾æ¥" class="headerlink" title="1.4. URI é“¾æ¥"></a>1.4. URI é“¾æ¥</h3><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-uri-building">Same as in Spring WebFlux</a></p><p>æœ¬èŠ‚ä»‹ç»Spring Frameworkä¸­å¯ç”¨äºå¤„ç†URIçš„å„ç§é€‰é¡¹ã€‚</p><h4 id="1-4-1-UriComponents"><a href="#1-4-1-UriComponents" class="headerlink" title="1.4.1. UriComponents"></a>1.4.1. UriComponents</h4><p>Spring MVCå’ŒSpring WebFlux</p><p><code>UriComponentsBuilder</code> æœ‰åŠ©äºä»URIæ¨¡æ¿å˜é‡æ„å»ºURIã€‚ å¦‚ä¸‹ä¾‹æ‰€ç¤º:</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">UriComponents</span> uriComponents = UriComponentsBuilder        .fromUriString(<span class="hljs-string">&quot;http://example.com/hotels/&#123;hotel&#125;&quot;</span>)  (<span class="hljs-number">1</span>)        .queryParam(<span class="hljs-string">&quot;q&quot;</span>, <span class="hljs-string">&quot;&#123;q&#125;&quot;</span>)  (<span class="hljs-number">2</span>)        .encode() (<span class="hljs-number">3</span>)        .build(); (<span class="hljs-number">4</span>)<br><span class="hljs-attribute">URI</span> uri = uriComponents.expand(<span class="hljs-string">&quot;Westin&quot;</span>, <span class="hljs-string">&quot;123&quot;</span>).toUri();  (<span class="hljs-number">5</span>)<br></code></pre></td></tr></table></figure><p><strong>1</strong>ã€å¸¦æœ‰URIæ¨¡æ¿çš„é™æ€å·¥å‚æ–¹æ³•ã€‚</p><p><strong>2</strong>ã€æ·»åŠ æˆ–æ›¿æ¢URIç»„ä»¶ã€‚</p><p><strong>3</strong>ã€è¯·æ±‚ç¼–ç URIæ¨¡æ¿å’ŒURIå˜é‡ã€‚</p><p><strong>4</strong>ã€æ„å»ºä¸€ä¸ª<code>UriComponents</code>.</p><p><strong>5</strong>ã€æš´éœ²å˜é‡å¹¶è·å–<code>URI</code>.</p><p>å‰é¢çš„ç¤ºä¾‹å¯ä»¥åˆå¹¶åˆ°ä¸€ä¸ªé“¾ä¸­ï¼Œå¹¶ä½¿ç”¨<code>buildAndExpand</code>ç¼©çŸ­ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤º:</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">URI uri = UriComponentsBuilder<br><span class="hljs-meta"></span><br><span class="hljs-meta">        .fromUriString</span>(<span class="hljs-string">&quot;http://example.com/hotels/&#123;hotel&#125;&quot;</span>)<br><span class="hljs-meta"></span><br><span class="hljs-meta">        .queryParam</span>(<span class="hljs-string">&quot;q&quot;</span>, <span class="hljs-string">&quot;&#123;q&#125;&quot;</span>)<br><span class="hljs-meta"></span><br><span class="hljs-meta">        .encode</span>()<br><span class="hljs-meta"></span><br><span class="hljs-meta">        .buildAndExpand</span>(<span class="hljs-string">&quot;Westin&quot;</span>, <span class="hljs-string">&quot;123&quot;</span>)<br><span class="hljs-meta"></span><br><span class="hljs-meta">        .toUri</span>()<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>æ‚¨å¯ä»¥é€šè¿‡ç›´æ¥è½¬åˆ°URIï¼ˆè¿™æ„å‘³ç€ç¼–ç ï¼‰æ¥è¿›ä¸€æ­¥ç¼©çŸ­å®ƒï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">URI uri = UriComponentsBuilder<br><span class="hljs-meta"></span><br><span class="hljs-meta">        .fromUriString</span>(<span class="hljs-string">&quot;http://example.com/hotels/&#123;hotel&#125;&quot;</span>)<br><span class="hljs-meta"></span><br><span class="hljs-meta">        .queryParam</span>(<span class="hljs-string">&quot;q&quot;</span>, <span class="hljs-string">&quot;&#123;q&#125;&quot;</span>)<br><span class="hljs-meta"></span><br><span class="hljs-meta">        .build</span>(<span class="hljs-string">&quot;Westin&quot;</span>, <span class="hljs-string">&quot;123&quot;</span>)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>æ‚¨ä½¿ç”¨å®Œæ•´çš„URIæ¨¡æ¿è¿›ä¸€æ­¥ç¼©çŸ­å®ƒï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">URI uri = UriComponentsBuilder<br><span class="hljs-meta"></span><br><span class="hljs-meta">        .fromUriString</span>(<span class="hljs-string">&quot;http://example.com/hotels/&#123;hotel&#125;?q=&#123;q&#125;&quot;</span>)<br><span class="hljs-meta"></span><br><span class="hljs-meta">        .build</span>(<span class="hljs-string">&quot;Westin&quot;</span>, <span class="hljs-string">&quot;123&quot;</span>)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><h4 id="1-4-2-UriBuilder"><a href="#1-4-2-UriBuilder" class="headerlink" title="1.4.2. UriBuilder"></a>1.4.2. UriBuilder</h4><p>Spring MVCå’ŒSpring WebFlux</p><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#web-uricomponents"><code>UriComponentsBuilder</code></a> å®ç°äº† <code>UriBuilder</code>ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨<code>UriBuilderFactory</code>åˆ›å»ºä¸€ä¸ª <code>UriBuilder</code>ã€‚ <code>UriBuilderFactory</code>å’Œ<code>UriBuilder</code>ä¸€èµ·æä¾›äº†ä¸€ç§å¯æ’å…¥æœºåˆ¶ï¼Œå¯ä»¥æ ¹æ®å…±äº«é…ç½®ï¼ˆä¾‹å¦‚åŸºæœ¬URLï¼Œç¼–ç é¦–é€‰é¡¹å’Œå…¶ä»–è¯¦ç»†ä¿¡æ¯ï¼‰ä»URIæ¨¡æ¿æ„å»ºURIã€‚</p><p>æ‚¨å¯ä»¥ä½¿ç”¨UriBuilderFactoryé…ç½®<code>RestTemplate</code>å’Œ<code>WebClient</code>ã€‚ä¸ºè‡ªå®šä¹‰URIåšå‡†å¤‡ã€‚<code>DefaultUriBuilderFactory</code> æ˜¯<code>UriBuilderFactory</code> çš„é»˜è®¤å®ç°ï¼Œå®ƒåœ¨å†…éƒ¨ä½¿ç”¨<code>UriComponentsBuilder</code>å¹¶å…¬å¼€å…±äº«é…ç½®é€‰é¡¹ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•é…ç½®<code>RestTemplate</code>:</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">// import org.springframework.web.util.DefaultUriBuilderFactory.EncodingMode;</span><br><span class="hljs-built_in">String</span> baseUrl = <span class="hljs-string">&quot;http://example.org&quot;</span>;DefaultUriBuilderFactory <span class="hljs-keyword">factory</span> = <span class="hljs-keyword">new</span> DefaultUriBuilderFactory(baseUrl);<span class="hljs-keyword">factory</span>.setEncodingMode(EncodingMode.TEMPLATE_AND_VARIABLES);<br>RestTemplate restTemplate = <span class="hljs-keyword">new</span> RestTemplate();restTemplate.setUriTemplateHandler(<span class="hljs-keyword">factory</span>);<br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹ç¤ºä¾‹é…ç½®<code>WebClient</code>:</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">// import org.springframework.web.util.DefaultUriBuilderFactory.EncodingMode;</span><br><span class="hljs-built_in">String</span> baseUrl = <span class="hljs-string">&quot;http://example.org&quot;</span>;DefaultUriBuilderFactory <span class="hljs-keyword">factory</span> = <span class="hljs-keyword">new</span> DefaultUriBuilderFactory(baseUrl);<span class="hljs-keyword">factory</span>.setEncodingMode(EncodingMode.TEMPLATE_AND_VARIABLES);<br>WebClient client = WebClient.builder().uriBuilderFactory(<span class="hljs-keyword">factory</span>).build();<br></code></pre></td></tr></table></figure><p>æ­¤å¤–ï¼Œæ‚¨è¿˜å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>DefaultUriBuilderFactory</code> ã€‚ å®ƒç±»ä¼¼äºä½¿ç”¨<code>UriComponentsBuilder</code> ï¼Œä½†å®ƒä¸æ˜¯é™æ€å·¥å‚æ–¹æ³•ï¼Œè€Œæ˜¯ä¸€ä¸ªä¿å­˜é…ç½®å’Œé¦–é€‰é¡¹çš„å®é™…å®ä¾‹ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">baseUrl</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;http://example.com&quot;</span>;<span class="hljs-type">DefaultUriBuilderFactory</span> <span class="hljs-variable">uriBuilderFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultUriBuilderFactory</span>(baseUrl);<br><span class="hljs-type">URI</span> <span class="hljs-variable">uri</span> <span class="hljs-operator">=</span> uriBuilderFactory.uriString(<span class="hljs-string">&quot;/hotels/&#123;hotel&#125;&quot;</span>)        .queryParam(<span class="hljs-string">&quot;q&quot;</span>, <span class="hljs-string">&quot;&#123;q&#125;&quot;</span>)        .build(<span class="hljs-string">&quot;Westin&quot;</span>, <span class="hljs-string">&quot;123&quot;</span>);<br></code></pre></td></tr></table></figure><h4 id="1-4-3-URI-ç¼–ç "><a href="#1-4-3-URI-ç¼–ç " class="headerlink" title="1.4.3. URI ç¼–ç "></a>1.4.3. URI ç¼–ç </h4><p>Spring MVC å’Œ Spring WebFlux</p><p><code>UriComponentsBuilder</code>åœ¨ä¸¤ä¸ªçº§åˆ«å…¬å¼€ç¼–ç é€‰é¡¹ï¼š</p><ul><li><a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/web/util/UriComponentsBuilder.html#encode--">UriComponentsBuilder#encode()</a>: é¦–å…ˆå¯¹URIæ¨¡æ¿è¿›è¡Œé¢„ç¼–ç ï¼Œç„¶ååœ¨æ‰©å±•æ—¶ä¸¥æ ¼ç¼–ç URIå˜é‡ã€‚.</li><li><a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/web/util/UriComponents.html#encode--">UriComponents#encode()</a>: æ‰©å±•URIå˜é‡åå¯¹URIç»„ä»¶è¿›è¡Œç¼–ç ã€‚</li></ul><p>è¿™ä¸¤ä¸ªé€‰é¡¹éƒ½ä½¿ç”¨è½¬ä¹‰çš„å…«ä½å­—èŠ‚æ›¿æ¢éASCIIå’Œéæ³•å­—ç¬¦ã€‚ ä½†æ˜¯ï¼Œç¬¬ä¸€ä¸ªé€‰é¡¹è¿˜ä¼šæ›¿æ¢å‡ºç°åœ¨URIå˜é‡ä¸­çš„ä¿ç•™å«ä¹‰çš„å­—ç¬¦ã€‚</p><p>è€ƒè™‘â€;â€œï¼Œè¿™åœ¨è·¯å¾„ä¸­æ˜¯åˆæ³•çš„ä½†å…·æœ‰ä¿ç•™æ„ä¹‰ã€‚ç¬¬ä¸€ä¸ªé€‰é¡¹å–ä»£â€;â€œåœ¨URIå˜é‡ä¸­ä½¿ç”¨â€%3Bâ€ä½†åœ¨URIæ¨¡æ¿ä¸­æ²¡æœ‰ã€‚ ç›¸æ¯”ä¹‹ä¸‹ï¼Œç¬¬äºŒä¸ªé€‰é¡¹æ°¸è¿œä¸ä¼šæ›¿æ¢â€œ;â€ï¼Œå› ä¸ºå®ƒæ˜¯è·¯å¾„ä¸­çš„åˆæ³•å­—ç¬¦ã€‚</p><p>å¯¹äºå¤§å¤šæ•°æƒ…å†µï¼Œç¬¬ä¸€ä¸ªé€‰é¡¹å¯èƒ½ä¼šç»™å‡ºé¢„æœŸç»“æœï¼Œå› ä¸ºå®ƒå°†URIå˜é‡è§†ä¸ºå®Œå…¨ç¼–ç çš„ä¸é€æ˜æ•°æ®ï¼Œè€Œé€‰é¡¹2ä»…åœ¨URIå˜é‡æ•…æ„åŒ…å«ä¿ç•™å­—ç¬¦æ—¶æ‰æœ‰ç”¨ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹ä½¿ç”¨ç¬¬ä¸€ä¸ªé€‰é¡¹:</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs perl">URI uri = UriComponentsBuilder.fromPath(<span class="hljs-string">&quot;/hotel list/&#123;city&#125;&quot;</span>)            .queryParam(<span class="hljs-string">&quot;q&quot;</span>, <span class="hljs-string">&quot;&#123;q&#125;&quot;</span>)            .encode()            .buildAndExpand(<span class="hljs-string">&quot;New York&quot;</span>, <span class="hljs-string">&quot;foo+bar&quot;</span>)            .toUri();<br>    <span class="hljs-regexp">//</span> Result is <span class="hljs-string">&quot;/hotel%20list/New%20York?q=foo%2Bbar&quot;</span><br></code></pre></td></tr></table></figure><p>æ‚¨å¯ä»¥é€šè¿‡ç›´æ¥è½¬åˆ°URIï¼ˆè¿™æ„å‘³ç€ç¼–ç ï¼‰æ¥ç¼©çŸ­å‰é¢çš„ç¤ºä¾‹ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus">URI uri = UriComponentsBuilder<span class="hljs-selector-class">.fromPath</span>(<span class="hljs-string">&quot;/hotel list/&#123;city&#125;&quot;</span>)<br><br>            <span class="hljs-selector-class">.queryParam</span>(<span class="hljs-string">&quot;q&quot;</span>, <span class="hljs-string">&quot;&#123;q&#125;&quot;</span>)<br><br>            <span class="hljs-selector-class">.build</span>(<span class="hljs-string">&quot;New York&quot;</span>, <span class="hljs-string">&quot;foo+bar&quot;</span>)<br></code></pre></td></tr></table></figure><p>æ‚¨å¯ä»¥ä½¿ç”¨å®Œæ•´çš„URIæ¨¡æ¿è¿›ä¸€æ­¥ç¼©çŸ­å®ƒï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus">URI uri = UriComponentsBuilder<span class="hljs-selector-class">.fromPath</span>(<span class="hljs-string">&quot;/hotel list/&#123;city&#125;?q=&#123;q&#125;&quot;</span>)<br><br>            <span class="hljs-selector-class">.build</span>(<span class="hljs-string">&quot;New York&quot;</span>, <span class="hljs-string">&quot;foo+bar&quot;</span>)<br></code></pre></td></tr></table></figure><p><code>WebClient</code>å’Œ<code>RestTemplate</code>é€šè¿‡ <code>UriBuilderFactory</code>ç­–ç•¥åœ¨å†…éƒ¨å±•å¼€å’Œç¼–ç URIæ¨¡æ¿ã€‚ ä¸¤è€…éƒ½å¯ä»¥é…ç½®è‡ªå®šä¹‰ç­–ç•¥ã€‚ å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">String baseUrl = <span class="hljs-string">&quot;http://example.com&quot;</span>;DefaultUriBuilderFactory factory = new DefaultUriBuilderFactory<span class="hljs-params">(baseUrl)</span>factory.<span class="hljs-keyword">set</span>EncodingMode<span class="hljs-params">(EncodingMode.TEMPLATE_AND_VALUES)</span>;<br><span class="hljs-string">//</span> Customize the RestTemplate.<span class="hljs-string">.RestTemplate</span> restTemplate = new RestTemplate<span class="hljs-params">()</span>;restTemplate.<span class="hljs-keyword">set</span>UriTemplateHandler<span class="hljs-params">(factory)</span>;<br><span class="hljs-string">//</span> Customize the WebClient.<span class="hljs-string">.WebClient</span> client = WebClient.builder<span class="hljs-params">()</span><span class="hljs-string">.uriBuilderFactory</span><span class="hljs-params">(factory)</span><span class="hljs-string">.build</span><span class="hljs-params">()</span>;<br></code></pre></td></tr></table></figure><p><code>DefaultUriBuilderFactory</code>å®ç°åœ¨å†…éƒ¨ä½¿ç”¨<code>UriComponentsBuilder</code>æ¥å±•å¼€å’Œç¼–ç URIæ¨¡æ¿ã€‚ ä½œä¸ºå·¥å‚ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªå•ç‹¬çš„ä½ç½®æ¥é…ç½®ç¼–ç æ–¹æ³•ï¼ŒåŸºäºä»¥ä¸‹ç¼–ç æ¨¡å¼ä¹‹ä¸€ï¼š</p><ul><li><code>TEMPLATE_AND_VALUES</code>: ä½¿ç”¨<code>UriComponentsBuilder#encode()</code>ï¼ˆå¯¹åº”äºå‰é¢åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªé€‰é¡¹ï¼‰å¯¹URIæ¨¡æ¿è¿›è¡Œé¢„ç¼–ç ï¼Œå¹¶åœ¨å±•å¼€æ—¶ä¸¥æ ¼ç¼–ç URIå˜é‡ã€‚</li><li><code>VALUES_ONLY</code>: ä¸å¯¹URIæ¨¡æ¿è¿›è¡Œç¼–ç ï¼Œè€Œæ˜¯åœ¨å°†URIå˜é‡å±•å¼€åˆ°æ¨¡æ¿ä¹‹å‰ï¼Œé€šè¿‡<code>UriUtils#encodeUriUriVariables</code>å¯¹URIå˜é‡ä¸¥æ ¼ç¼–ç ã€‚</li><li><code>URI_COMPONENTS</code>: ä½¿ç”¨<code>UriComponents#encode()</code>ï¼ˆå¯¹åº”äºå‰é¢åˆ—è¡¨ä¸­çš„ç¬¬äºŒä¸ªé€‰é¡¹ï¼‰ï¼Œåœ¨URIå˜é‡å±•å¼€åå¯¹URIç»„ä»¶å€¼è¿›è¡Œç¼–ç ã€‚</li><li><code>NONE</code>: æ²¡æœ‰åº”ç”¨ç¼–ç ã€‚</li></ul><p>å‡ºäºå†å²åŸå› å’Œå‘åå…¼å®¹æ€§ï¼Œ<code>RestTemplate</code>è®¾ç½®ä¸º <code>EncodingMode.URI_COMPONENTS</code>ã€‚<code>WebClient</code> ä¾èµ–äº<code>DefaultUriBuilderFactory</code>ä¸­çš„é»˜è®¤å€¼ï¼Œ è¯¥å€¼å·²ä»5.0.xä¸­çš„ <code>EncodingMode.URI_COMPONENTS</code>æ›´æ”¹ä¸º5.1ä¸­çš„ <code>EncodingMode.TEMPLATE_AND_VALUES</code>ã€‚</p><h4 id="1-4-4-ç›¸å¯¹è¯·æ±‚"><a href="#1-4-4-ç›¸å¯¹è¯·æ±‚" class="headerlink" title="1.4.4. ç›¸å¯¹è¯·æ±‚"></a>1.4.4. ç›¸å¯¹è¯·æ±‚</h4><p>æ‚¨å¯ä»¥ä½¿ç”¨<code>ServletUriComponentsBuilder</code>åˆ›å»ºç›¸å¯¹äºå½“å‰è¯·æ±‚çš„URIï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> ...<br><span class="hljs-comment">// Re-uses host, scheme, port, path and query string...</span><br><span class="hljs-type">ServletUriComponentsBuilder</span> <span class="hljs-variable">ucb</span> <span class="hljs-operator">=</span> ServletUriComponentsBuilder.fromRequest(request)        .replaceQueryParam(<span class="hljs-string">&quot;accountId&quot;</span>, <span class="hljs-string">&quot;&#123;id&#125;&quot;</span>).build()        .expand(<span class="hljs-string">&quot;123&quot;</span>)        .encode();<br></code></pre></td></tr></table></figure><p>æ‚¨å¯ä»¥åˆ›å»ºç›¸å¯¹äºä¸Šä¸‹æ–‡è·¯å¾„çš„URIï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-comment">// Re-uses host, port and context path...</span><br>ServletUriComponentsBuilder ucb = ServletUriComponentsBuilder<span class="hljs-selector-class">.fromContextPath</span>(request)        <span class="hljs-selector-class">.path</span>(<span class="hljs-string">&quot;/accounts&quot;</span>)<span class="hljs-selector-class">.build</span>()<br></code></pre></td></tr></table></figure><p>æ‚¨å¯ä»¥åˆ›å»ºç›¸å¯¹äºServletçš„URIï¼ˆä¾‹å¦‚ï¼Œ<code>/main/*</code>ï¼‰ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-comment">// Re-uses host, port, context path, and Servlet prefix...</span><br>ServletUriComponentsBuilder ucb = ServletUriComponentsBuilder<span class="hljs-selector-class">.fromServletMapping</span>(request)        <span class="hljs-selector-class">.path</span>(<span class="hljs-string">&quot;/accounts&quot;</span>)<span class="hljs-selector-class">.build</span>()<br></code></pre></td></tr></table></figure><p>ä»5.1å¼€å§‹ï¼Œ<code>ServletUriComponentsBuilder</code>å¿½ç•¥æ¥è‡ª<code>Forwarded</code>å’Œ<code>X-Forwarded-*</code>å¤´éƒ¨çš„ä¿¡æ¯ï¼Œè¿™äº›å¤´éƒ¨ä¿¡æ¯æŒ‡å®šäº†å®¢æˆ·ç«¯å‘èµ·çš„åœ°å€ã€‚ è€ƒè™‘ä½¿ç”¨<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#filters-forwarded-headers"><code>ForwardedHeaderFilter</code></a>æ¥æå–å’Œä½¿ç”¨æˆ–ä¸¢å¼ƒæ­¤ç±»è¯·æ±‚å¤´ã€‚</p><h4 id="1-4-5-æ§åˆ¶å™¨é“¾æ¥"><a href="#1-4-5-æ§åˆ¶å™¨é“¾æ¥" class="headerlink" title="1.4.5. æ§åˆ¶å™¨é“¾æ¥"></a>1.4.5. æ§åˆ¶å™¨é“¾æ¥</h4><p>Spring MVCä¹Ÿæä¾›äº†æ„é€ æŒ‡å®šæ§åˆ¶å™¨æ–¹æ³•é“¾æ¥çš„æœºåˆ¶ã€‚ ä¾‹å¦‚ï¼Œä»¥ä¸‹MVCæ§åˆ¶å™¨å…è®¸åˆ›å»ºé“¾æ¥ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Controller</span><span class="hljs-variable">@RequestMapping</span>(<span class="hljs-string">&quot;/hotels/&#123;hotel&#125;&quot;</span>)public class BookingController &#123;<br>    <span class="hljs-variable">@GetMapping</span>(<span class="hljs-string">&quot;/bookings/&#123;booking&#125;&quot;</span>)    public ModelAndView <span class="hljs-built_in">getBooking</span>(<span class="hljs-variable">@PathVariable</span> Long booking) &#123;        <span class="hljs-comment">// ...    &#125;&#125;</span><br></code></pre></td></tr></table></figure><p>æ‚¨å¯ä»¥é€šè¿‡å¼•ç”¨æ–¹æ³•åå­—çš„åŠæ³•æ¥å‡†å¤‡ä¸€ä¸ªé“¾æ¥ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">UriComponents</span> uriComponents = MvcUriComponentsBuilder    .fromMethodName(BookingController.class, <span class="hljs-string">&quot;getBooking&quot;</span>, <span class="hljs-number">21</span>).buildAndExpand(<span class="hljs-number">42</span>);<br><span class="hljs-attribute">URI</span> uri = uriComponents.encode().toUri();<br></code></pre></td></tr></table></figure><p>åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œä¸ºæ–¹æ³•å‚æ•°å‡†å¤‡äº†å¡«å……å€¼ï¼ˆåœ¨æœ¬ä¾‹ä¸­ï¼Œlongå€¼ï¼š <code>21</code>ï¼‰ï¼Œä»¥ç”¨äºå¡«å……è·¯å¾„å˜é‡å¹¶æ’å…¥åˆ°URLä¸­ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬æä¾›äº†å€¼42ï¼Œæ¥å¡«å……ä»»ä½•å‰©ä½™çš„URIå˜é‡ï¼Œæ¯”å¦‚ä»ç±»å±‚çº§çš„è¯·æ±‚æ˜ å°„ä¸­ç»§æ‰¿æ¥çš„hotelå˜é‡ã€‚ å¦‚æœæ–¹æ³•è¿˜æœ‰æ›´å¤šçš„å‚æ•°ï¼Œä½ å¯ä»¥ä¸ºé‚£äº›ä¸éœ€è¦å‚ä¸URLæ„é€ çš„å˜é‡èµ‹äºˆnullå€¼ã€‚ é€šå¸¸ï¼Œåªæœ‰<code>@PathVariable</code>å’Œ<code>@RequestParam</code>å‚æ•°ä¸æ„é€ URLç›¸å…³ã€‚</p><p>è¿˜æœ‰å…¶ä»–æ–¹æ³•å¯ä»¥ä½¿ç”¨<code>MvcUriComponentsBuilder</code>ã€‚ ä¾‹å¦‚ï¼Œä¾‹å¦‚å¯ä»¥é€šè¿‡ç±»ä¼¼mockæ‰æµ‹è¯•å¯¹è±¡çš„æ–¹æ³•ï¼Œç”¨ä»£ç†æ¥é¿å…ç›´æ¥é€šè¿‡åå­—å¼•ç”¨ä¸€ä¸ªæ§åˆ¶ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼ˆè¯¥ç¤ºä¾‹å‡è®¾é™æ€å¯¼å…¥<code>MvcUriComponentsBuilder.on</code>ï¼‰ï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf">UriComponents uriComponents <span class="hljs-operator">=</span> MvcUriComponentsBuilder    .fromMethodCall(on(BookingController.class).getBooking(<span class="hljs-number">21</span>)).buildAndExpand(<span class="hljs-number">42</span>)<span class="hljs-comment">;</span><br>URI uri <span class="hljs-operator">=</span> uriComponents.encode().toUri()<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>Controller method signatures are limited in their design when they are supposed to be usable for link creation with <code>fromMethodCall</code>. Aside from needing a proper parameter signature, there is a technical limitation on the return type (namely, generating a runtime proxy for link builder invocations), so the return type must not be <code>final</code>. In particular, the common <code>String</code> return type for view names does not work here. You should use <code>ModelAndView</code> or even plain <code>Object</code> (with a <code>String</code> return value) instead.</p><p>ä¸Šé¢çš„ä»£ç ä¾‹å­ä¸­ä½¿ç”¨äº†<code>MvcUriComponentsBuilder</code>ç±»çš„é™æ€æ–¹æ³•ï¼Œå†…éƒ¨å®ç°ä¸­ï¼Œå®ƒä¾èµ–äº<code>ServletUriComponentsBuilder</code>æ¥ä»å½“å‰è¯·æ±‚ä¸­æŠ½å–schemaã€ä¸»æœºåã€ç«¯å£å·ã€contextè·¯å¾„å’ŒServletè·¯å¾„ï¼Œ å¹¶å‡†å¤‡ä¸€ä¸ªåŸºæœ¬URLã€‚å¤§å¤šæ•°æƒ…å†µä¸‹å®ƒèƒ½è‰¯å¥½å·¥ä½œï¼Œä½†æœ‰æ—¶è¿˜ä¸è¡Œï¼Œæ¯”å¦‚ï¼Œåœ¨å‡†å¤‡é“¾æ¥æ—¶ä½ å¯èƒ½åœ¨å½“å‰è¯·æ±‚çš„ä¸Šä¸‹æ–‡ï¼ˆcontextï¼‰ä¹‹å¤–ï¼ˆæ¯”å¦‚ï¼Œæ‰§è¡Œä¸€ä¸ªå‡†å¤‡é“¾æ¥linksçš„æ‰¹å¤„ç†ï¼‰ï¼Œæˆ–ä½ å¯èƒ½éœ€è¦ä¸ºè·¯å¾„æ’å…¥ä¸€ä¸ªå‰ç¼€ï¼ˆæ¯”å¦‚ä¸€ä¸ªåœ°åŒºæ€§å‰ç¼€ï¼Œå®ƒä»è¯·æ±‚ä¸­è¢«ç§»é™¤ï¼Œç„¶ååˆé‡æ–°è¢«æ’å…¥åˆ°é“¾æ¥ä¸­å»ï¼‰ã€‚</p><p>å¯¹äºä¸Šé¢æ‰€æçš„åœºæ™¯ï¼Œå¼€å‘è€…å¯ä»¥ä½¿ç”¨é‡è½½è¿‡çš„é™æ€æ–¹æ³•<code>fromXxx</code>ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ª<code>UriComponentsBuilder</code>å‚æ•°ï¼Œç„¶åä»ä¸­è·å–åŸºæœ¬URLä»¥ä¾¿ä½¿ç”¨ï¼Œæˆ–ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ä¸ªåŸºæœ¬URLåˆ›å»ºä¸€ä¸ª<code>MvcUriComponentsBuilder</code>å¯¹è±¡ï¼Œ ç„¶åä½¿ç”¨å®ä¾‹å¯¹è±¡çš„<code>withXxx</code>æ–¹æ³•ã€‚ä»¥ä¸‹åˆ—è¡¨ä½¿ç”¨ <code>withMethodCall</code>:</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf">UriComponentsBuilder base <span class="hljs-operator">=</span> ServletUriComponentsBuilder.fromCurrentContextPath().path(<span class="hljs-string">&quot;/en&quot;</span>)<span class="hljs-comment">;MvcUriComponentsBuilder builder = MvcUriComponentsBuilder.relativeTo(base);builder.withMethodCall(on(BookingController.class).getBooking(21)).buildAndExpand(42);</span><br>URI uri <span class="hljs-operator">=</span> uriComponents.encode().toUri()<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>ä»5.1å¼€å§‹ï¼Œ<code>MvcUriComponentsBuilder</code>å¿½ç•¥æ¥è‡ª<code>Forwarded</code> å’Œ<code>X-Forwarded-*</code>å¤´çš„ä¿¡æ¯ï¼Œè¿™äº›å¤´æŒ‡å®šäº†å®¢æˆ·ç«¯å‘èµ·çš„åœ°å€ã€‚ è€ƒè™‘ä½¿ç”¨ForwardedHeaderFilteræ¥æå–å’Œä½¿ç”¨æˆ–ä¸¢å¼ƒæ­¤ç±»æ ‡å¤´ã€‚</p><h4 id="1-4-6-è§†å›¾é“¾æ¥"><a href="#1-4-6-è§†å›¾é“¾æ¥" class="headerlink" title="1.4.6. è§†å›¾é“¾æ¥"></a>1.4.6. è§†å›¾é“¾æ¥</h4><p>åœ¨Thymeleafï¼ŒFreeMarkeræˆ–JSPç­‰è§†å›¾ä¸­ï¼Œæ‚¨å¯ä»¥é€šè¿‡å¼•ç”¨æ¯ä¸ªè¯·æ±‚æ˜ å°„çš„éšå¼æˆ–æ˜¾å¼æŒ‡å®šåç§°æ¥æ„å»ºæŒ‡å‘å¸¦æ³¨è§£æ§åˆ¶å™¨çš„é“¾æ¥ã€‚</p><p>è¯·è€ƒè™‘ä»¥ä¸‹ç¤ºä¾‹ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@RequestMapping</span>(<span class="hljs-string">&quot;/people/&#123;id&#125;/addresses&quot;</span>)public class PersonAddressController &#123;<br>    <span class="hljs-variable">@RequestMapping</span>(<span class="hljs-string">&quot;/&#123;country&#125;&quot;</span>)    public HttpEntity <span class="hljs-built_in">getAddress</span>(<span class="hljs-variable">@PathVariable</span> String country) &#123; ... &#125;&#125;<br></code></pre></td></tr></table></figure><p>ç»™å®šå‰é¢çš„æ§åˆ¶å™¨ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ–¹å¼å‡†å¤‡æ¥è‡ªJSPçš„é“¾æ¥ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dart">&lt;%@ taglib uri=<span class="hljs-string">&quot;http://www.springframework.org/tags&quot;</span> prefix=<span class="hljs-string">&quot;s&quot;</span> %&gt;<br><br>...<br><br>&lt;a href=<span class="hljs-string">&quot;<span class="hljs-subst">$&#123;s:mvcUrl(<span class="hljs-string">&#x27;PAC#getAddress&#x27;</span>).arg(<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;US&#x27;</span>).buildAndExpand(<span class="hljs-string">&#x27;123&#x27;</span>)&#125;</span>&quot;</span>&gt;Get Address&lt;/a&gt;<br></code></pre></td></tr></table></figure><p>å‰é¢çš„ç¤ºä¾‹ä¾èµ–äºSpringæ ‡ç­¾åº“ä¸­å£°æ˜çš„<code>mvcUrl</code>å‡½æ•°ï¼ˆå³ META-INF&#x2F;spring.tldï¼‰ï¼Œä½†å¯ä»¥å¾ˆå®¹æ˜“åœ°å®šä¹‰è‡ªå®šä¹‰å‡½æ•°æˆ–ä½¿ç”¨è‡ªå®šä¹‰æ ‡è®°æ–‡ä»¶ã€‚</p><p>è¿™æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œåœ¨å¯åŠ¨æ—¶ï¼Œæ¯ä¸ª<code>@RequestMapping</code> éƒ½é€šè¿‡<code>HandlerMethodMappingNamingStrategy</code>åˆ†é…ä¸€ä¸ªé»˜è®¤åç§°ï¼Œå…¶é»˜è®¤å®ç°ä½¿ç”¨ç±»çš„å¤§å†™å­—æ¯å’Œæ–¹æ³•åç§°ï¼ˆä¾‹å¦‚ï¼Œ <code>ThingController</code>ä¸­çš„<code>getThing</code>æ–¹æ³•å˜ä¸ºâ€TC#getThingâ€ï¼‰ã€‚å¦‚æœå­˜åœ¨åç§°å†²çªï¼Œåˆ™å¯ä»¥ä½¿ç”¨<code>@RequestMapping(name=&quot;..&quot;)</code>åˆ†é…æ˜¾å¼åç§°æˆ–å®ç°è‡ªå·±çš„<code>HandlerMethodMappingNamingStrategy</code>ã€‚</p><h3 id="1-5-å¼‚æ­¥è¯·æ±‚"><a href="#1-5-å¼‚æ­¥è¯·æ±‚" class="headerlink" title="1.5. å¼‚æ­¥è¯·æ±‚"></a>1.5. å¼‚æ­¥è¯·æ±‚</h3><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-async-vs-webflux">Compared to WebFlux</a></p><p>Spring MVCä¸Servlet 3.0å¼‚æ­¥è¯·æ±‚<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-async-processing">å¤„ç†</a>æœ‰å¹¿æ³›çš„é›†æˆï¼š</p><ul><li>åœ¨æ§åˆ¶å™¨æ–¹æ³•ä¸­è¿”å›<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-async-deferredresult"><code>DeferredResult</code></a>å’Œ<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-async-callable"><code>Callable</code></a>ï¼Œå¹¶ä¸ºå•ä¸ªå¼‚æ­¥è¿”å›å€¼æä¾›åŸºæœ¬æ”¯æŒã€‚</li><li>æ§åˆ¶å™¨å¯ä»¥<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-async-http-streaming">stream</a>å¤šä¸ªå€¼ï¼ŒåŒ…æ‹¬<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-async-sse">SSE</a> å’Œ<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-async-output-stream">raw data</a>ã€‚</li><li>æ§åˆ¶å™¨å¯ä»¥ä½¿ç”¨reactive clients å¹¶è¿”å›<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-async-reactive-types">reactive types</a>ä»¥è¿›è¡Œå“åº”å¤„ç†ã€‚</li></ul><h4 id="1-5-1-DeferredResult"><a href="#1-5-1-DeferredResult" class="headerlink" title="1.5.1. DeferredResult"></a>1.5.1. <code>DeferredResult</code></h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-async-vs-webflux">Compared to WebFlux</a></p><p>ä¸€æ—¦åœ¨Servletå®¹å™¨ä¸­<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-async-configuration">å¯ç”¨</a> äº†å¼‚æ­¥è¯·æ±‚å¤„ç†åŠŸèƒ½ï¼Œæ§åˆ¶å™¨æ–¹æ³•å°±å¯ä»¥ä½¿ç”¨ <code>DeferredResult</code>åŒ…è£…ä»»ä½•æ”¯æŒçš„æ§åˆ¶å™¨æ–¹æ³•è¿”å›å€¼ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">&quot;/quotes&quot;</span>)<span class="hljs-meta">@ResponseBodypublic</span> <span class="hljs-title class_">DeferredResult</span>&lt;<span class="hljs-title class_">String</span>&gt; <span class="hljs-title function_">quotes</span>(<span class="hljs-params"></span>) &#123;    <span class="hljs-title class_">DeferredResult</span>&lt;<span class="hljs-title class_">String</span>&gt; deferredResult = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DeferredResult</span>&lt;<span class="hljs-title class_">String</span>&gt;();    <span class="hljs-comment">// Save the deferredResult somewhere..    return deferredResult;&#125;</span><br><span class="hljs-comment">// From some other thread...deferredResult.setResult(data);</span><br></code></pre></td></tr></table></figure><p>æ§åˆ¶å™¨å¯ä»¥ä»ä¸åŒçš„çº¿ç¨‹å¼‚æ­¥ç”Ÿæˆè¿”å›å€¼ - ä¾‹å¦‚ï¼Œå“åº”å¤–éƒ¨äº‹ä»¶ï¼ˆJMSæ¶ˆæ¯ï¼‰ï¼Œè®¡åˆ’ä»»åŠ¡æˆ–å…¶ä»–äº‹ä»¶ã€‚</p><h4 id="1-5-2-Callable"><a href="#1-5-2-Callable" class="headerlink" title="1.5.2. Callable"></a>1.5.2. <code>Callable</code></h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-async-vs-webflux">Compared to WebFlux</a></p><p>æ§åˆ¶å™¨å¯ä»¥ä½¿ç”¨ <code>java.util.concurrent.Callable</code>åŒ…è£…ä»»ä½•æ”¯æŒçš„è¿”å›å€¼ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@PostMappingpublic</span> <span class="hljs-title class_">Callable</span>&lt;<span class="hljs-title class_">String</span>&gt; <span class="hljs-title function_">processUpload</span>(<span class="hljs-params">final MultipartFile file</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Callable</span>&lt;<span class="hljs-title class_">String</span>&gt;() &#123;        <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">call</span>() throws <span class="hljs-title class_">Exception</span> &#123;            <span class="hljs-comment">// ...            return &quot;someView&quot;;        &#125;    &#125;;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åå¯ä»¥é€šè¿‡é…ç½®çš„<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-async-configuration-spring-mvc">configured</a> <code>TaskExecutor</code>è¿è¡Œç»™å®šä»»åŠ¡æ¥è·å–è¿”å›å€¼ã€‚</p><h4 id="1-5-3-å¤„ç†è¿‡ç¨‹"><a href="#1-5-3-å¤„ç†è¿‡ç¨‹" class="headerlink" title="1.5.3. å¤„ç†è¿‡ç¨‹"></a>1.5.3. å¤„ç†è¿‡ç¨‹</h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-async-vs-webflux">Compared to WebFlux</a></p><p>ä»¥ä¸‹æ˜¯Servletå¼‚æ­¥è¯·æ±‚å¤„ç†çš„ç®€è¦æ¦‚è¿°:</p><ul><li>Servletè¯·æ±‚<code>ServletRequest</code>å¯ä»¥é€šè¿‡è°ƒç”¨ <code>request.startAsync()</code>æ–¹æ³•è€Œè¿›å…¥å¼‚æ­¥æ¨¡å¼ã€‚è¿™æ ·åšçš„ä¸»è¦ç»“æœå°±æ˜¯è¯¥Servletä»¥åŠæ‰€æœ‰çš„è¿‡æ»¤å™¨éƒ½å¯ä»¥ç»“æŸï¼Œä½†å…¶å“åº”ï¼ˆresponseï¼‰ä¼šç•™å¾…å¼‚æ­¥å¤„ç†ç»“æŸåå†è¿”å›è°ƒç”¨ã€‚</li><li><code>request.startAsync()</code> æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª<code>AsyncContext</code>å¯¹è±¡ ï¼Œå¯ç”¨å®ƒå¯¹å¼‚æ­¥å¤„ç†è¿›è¡Œè¿›ä¸€æ­¥çš„æ§åˆ¶å’Œæ“ä½œã€‚æ¯”å¦‚è¯´å®ƒä¹Ÿæä¾›äº†ä¸€ä¸ªä¸è½¬å‘ï¼ˆforwardï¼‰å¾ˆç›¸ä¼¼çš„<code>dispatch</code>æ–¹æ³•ï¼Œåªä¸è¿‡å®ƒå…è®¸åº”ç”¨æ¢å¤Servletå®¹å™¨çš„è¯·æ±‚å¤„ç†è¿›ç¨‹ã€‚</li><li><code>ServletRequest</code> æä¾›äº†è·å–å½“å‰<code>DispatcherType</code>çš„æ–¹å¼ï¼Œåè€…å¯ä»¥ç”¨æ¥åŒºåˆ«å½“å‰å¤„ç†çš„æ˜¯åŸå§‹è¯·æ±‚ã€å¼‚æ­¥åˆ†å‘è¯·æ±‚ã€è½¬å‘ã€æˆ–æ˜¯å…¶ä»–ç±»å‹çš„è¯·æ±‚åˆ†å‘ç±»å‹ã€‚</li></ul><p><code>DeferredResult</code> å¤„ç†çš„å·¥ä½œæ–¹å¼å¦‚ä¸‹ï¼š</p><ul><li>æ§åˆ¶å™¨å…ˆè¿”å›ä¸€ä¸ª<code>DeferredResult</code>å¯¹è±¡ï¼Œå¹¶æŠŠå®ƒå­˜å–åœ¨å†…å­˜ï¼ˆé˜Ÿåˆ—æˆ–åˆ—è¡¨ç­‰ï¼‰ä¸­ä»¥ä¾¿å­˜å–ã€‚</li><li>Spring MVCè°ƒç”¨<code>request.startAsync()</code>æ–¹æ³•ï¼Œå¼€å§‹è¿›è¡Œå¼‚æ­¥å¤„ç†ã€‚</li><li><code>DispatcherServlet</code>å’Œæ‰€æœ‰è¿‡æ»¤å™¨éƒ½é€€å‡ºServletå®¹å™¨çº¿ç¨‹ï¼Œä½†æ­¤æ—¶æ–¹æ³•çš„å“åº”å¯¹è±¡ä»æœªè¿”å›ã€‚</li><li>ç”±å¤„ç†è¯¥è¯·æ±‚çš„çº¿ç¨‹å¯¹<code>DeferredResult</code>è¿›è¡Œè®¾å€¼ï¼Œç„¶åSpringM VCä¼šé‡æ–°æŠŠè¯·æ±‚åˆ†æ´¾å›Servletå®¹å™¨ï¼Œæ¢å¤å¤„ç†ã€‚</li><li><code>DispatcherServlet</code>å†æ¬¡è¢«è°ƒç”¨, æ¢å¤å¯¹è¯¥å¼‚æ­¥è¿”å›ç»“æœçš„å¤„ç†ã€‚</li></ul><p><code>Callable</code>å¤„ç†çš„å·¥ä½œæ–¹å¼å¦‚ä¸‹ï¼š</p><ul><li>æ§åˆ¶å™¨å…ˆè¿”å›ä¸€ä¸ª<code>Callable</code>å¯¹è±¡.</li><li>Spring MVCè°ƒç”¨ <code>request.startAsync()</code>æ–¹æ³•ï¼Œå¼€å§‹è¿›è¡Œå¼‚æ­¥å¤„ç†ï¼Œå¹¶æŠŠè¯¥<code>Callable</code>å¯¹è±¡æäº¤ç»™å¦ä¸€ä¸ªç‹¬ç«‹çº¿ç¨‹çš„æ‰§è¡Œå™¨ <code>TaskExecutor</code>å¤„ç†ã€‚</li><li><code>DispatcherServlet</code>å’Œæ‰€æœ‰è¿‡æ»¤å™¨éƒ½é€€å‡ºServletå®¹å™¨çº¿ç¨‹ï¼Œä½†æ­¤æ—¶æ–¹æ³•çš„å“åº”å¯¹è±¡ä»æœªè¿”å›ã€‚</li><li><code>Callable</code>å¯¹è±¡æœ€ç»ˆäº§ç”Ÿä¸€ä¸ªè¿”å›ç»“æœï¼Œæ­¤æ—¶Spring MVCä¼šé‡æ–°æŠŠè¯·æ±‚åˆ†æ´¾å›Servletå®¹å™¨ï¼Œæ¢å¤å¤„ç†ã€‚</li><li><code>DispatcherServlet</code>å†æ¬¡è¢«è°ƒç”¨,æ¢å¤å¯¹<code>Callable</code>å¼‚æ­¥å¤„ç†æ‰€è¿”å›ç»“æœçš„å¤„ç†ã€‚</li></ul><p>å…³äºå¼•å…¥å¼‚æ­¥è¯·æ±‚å¤„ç†çš„èƒŒæ™¯å’ŒåŸå› ï¼Œä»¥åŠä»€ä¹ˆæ—¶å€™ä½¿ç”¨å®ƒï¼Œä¸ºä»€ä¹ˆä½¿ç”¨å¼‚æ­¥è¯·æ±‚å¤„ç†ç­‰é—®é¢˜ã€‚å¯ä»¥é˜…è¯»è¿™ä¸ªç³»åˆ—çš„<a href="https://spring.io/blog/2012/05/07/spring-mvc-3-2-preview-introducing-servlet-3-async-support">åšå®¢æ–‡ç« </a> ã€‚</p><h5 id="å¼‚å¸¸å¤„ç†"><a href="#å¼‚å¸¸å¤„ç†" class="headerlink" title="å¼‚å¸¸å¤„ç†"></a>å¼‚å¸¸å¤„ç†</h5><p>è‹¥æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ª<code>DeferredResult</code>å¯¹è±¡ï¼Œä½ å¯ä»¥é€‰æ‹©è°ƒExceptionå®ä¾‹çš„<code>setResult</code>æ–¹æ³•è¿˜æ˜¯<code>setErrorResult</code>æ–¹æ³•ã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼ŒSpring MVCéƒ½ä¼šå°†è¯·æ±‚å‘é€å›Servletå®¹å™¨ä»¥å®Œæˆå¤„ç†ã€‚ ç„¶åå°†å…¶è§†ä¸ºæ§åˆ¶å™¨æ–¹æ³•è¿”å›ç»™å®šå€¼æˆ–è€…å°±å¥½åƒå®ƒäº§ç”Ÿäº†ç»™å®šçš„å¼‚å¸¸ä¸€æ ·ã€‚ ç„¶åå¼‚å¸¸é€šè¿‡å¸¸è§„å¼‚å¸¸å¤„ç†æœºåˆ¶ï¼ˆä¾‹å¦‚ï¼Œè°ƒç”¨<code>@ExceptionHandler</code>æ–¹æ³•ï¼‰ã€‚æ›´å…·ä½“åœ°è¯´å‘¢ï¼Œå½“CallableæŠ›å‡ºå¼‚å¸¸æ—¶ï¼ŒSpring MVCä¼šæŠŠä¸€ä¸ªExceptionå¯¹è±¡åˆ†æ´¾ç»™Servletå®¹å™¨è¿›è¡Œå¤„ç†ï¼Œè€Œä¸æ˜¯æ­£å¸¸è¿”å›æ–¹æ³•çš„è¿”å›å€¼ï¼Œç„¶åå®¹å™¨æ¢å¤å¯¹æ­¤å¼‚æ­¥è¯·æ±‚å¼‚å¸¸çš„å¤„ç†ã€‚</p><p>å½“æ‚¨ä½¿ç”¨<code>Callable</code>æ—¶ï¼Œä¼šå‡ºç°ç±»ä¼¼çš„å¤„ç†é€»è¾‘ï¼Œä¸»è¦åŒºåˆ«åœ¨äºä»<code>Callable</code>è¿”å›ç»“æœï¼Œæˆ–è€…ç”±å®ƒå¼•å‘å¼‚å¸¸ã€‚</p><h5 id="æ‹¦æˆªå¼‚æ­¥è¯·æ±‚"><a href="#æ‹¦æˆªå¼‚æ­¥è¯·æ±‚" class="headerlink" title="æ‹¦æˆªå¼‚æ­¥è¯·æ±‚"></a>æ‹¦æˆªå¼‚æ­¥è¯·æ±‚</h5><p>å¤„ç†å™¨æ‹¦æˆªå™¨<code>HandlerInterceptor</code>å¯ä»¥å®ç°<code>AsyncHandlerInterceptor</code>æ¥å£æ‹¦æˆªå¼‚æ­¥è¯·æ±‚ï¼Œå› ä¸ºåœ¨å¼‚æ­¥è¯·æ±‚å¼€å§‹æ—¶ï¼Œè¢«è°ƒç”¨çš„å›è°ƒæ–¹æ³•æ˜¯è¯¥æ¥å£çš„<code>afterConcurrentHandlingStarted</code>æ–¹æ³•ï¼Œè€Œéä¸€èˆ¬çš„<code>postHandle</code>å’Œ<code>afterCompletion</code>æ–¹æ³•ã€‚</p><p>å¦‚æœéœ€è¦ä¸å¼‚æ­¥è¯·æ±‚å¤„ç†çš„ç”Ÿå‘½æµç¨‹æœ‰æ›´æ·±å…¥çš„é›†æˆï¼Œæ¯”å¦‚éœ€è¦å¤„ç†timeoutçš„äº‹ä»¶ç­‰ã€‚åˆ™<code>HandlerInterceptor</code>éœ€è¦æ³¨å†Œ<code>CallableProcessingInterceptor</code>æˆ–<code>DeferredResultProcessingInterceptor</code>æ‹¦æˆªå™¨ï¼Œ å…·ä½“çš„ç»†èŠ‚å¯ä»¥å‚è€ƒ <a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/web/servlet/AsyncHandlerInterceptor.html"><code>AsyncHandlerInterceptor</code></a>ç±»çš„Javaæ–‡æ¡£</p><p><code>DeferredResult</code>ç±»è¿˜æä¾›äº†<code>onTimeout(Runnable)</code> å’Œ <code>onCompletion(Runnable)</code> ç­‰å›è°ƒï¼Œ å…·ä½“çš„ç»†èŠ‚å¯ä»¥å‚è€ƒ<a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/web/context/request/async/DeferredResult.html"><code>DeferredResult</code></a>ç±»çš„Javaæ–‡æ¡£ <code>Callable</code>å¯ä»¥æ›¿ä»£<code>WebAsyncTask</code>ï¼Œå®ƒå…¬å¼€äº†è¶…æ—¶å’Œå®Œæˆå›è°ƒçš„å…¶ä»–æ–¹æ³•ã€‚</p><h5 id="Compared-to-WebFlux"><a href="#Compared-to-WebFlux" class="headerlink" title="Compared to WebFlux"></a>Compared to WebFlux</h5><p>The Servlet API was originally built for making a single pass through the Filter-Servlet chain. Asynchronous request processing, added in Servlet 3.0, lets applications exit the Filter-Servlet chain but leave the response open for further processing. The Spring MVC asynchronous support is built around that mechanism. When a controller returns a <code>DeferredResult</code>, the Filter-Servlet chain is exited, and the Servlet container thread is released. Later, when the <code>DeferredResult</code> is set, an <code>ASYNC</code> dispatch (to the same URL) is made, during which the controller is mapped again but, rather than invoking it, the <code>DeferredResult</code> value is used (as if the controller returned it) to resume processing.</p><p>By contrast, Spring WebFlux is neither built on the Servlet API, nor does it need such an asynchronous request processing feature, because it is asynchronous by design. Asynchronous handling is built into all framework contracts and is intrinsically supported through all stages of request processing.</p><p>From a programming model perspective, both Spring MVC and Spring WebFlux support asynchronous and <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-async-reactive-types">Reactive Types</a> as return values in controller methods. Spring MVC even supports streaming, including reactive back pressure. However, individual writes to the response remain blocking (and are performed on a separate thread), unlike WebFlux, which relies on non-blocking I&#x2F;O and does not need an extra thread for each write.</p><p>Another fundamental difference is that Spring MVC does not support asynchronous or reactive types in controller method arguments (for example, <code>@RequestBody</code>, <code>@RequestPart</code>, and others), nor does it have any explicit support for asynchronous and reactive types as model attributes. Spring WebFlux does support all that.</p><h4 id="1-5-4-HTTP-æµ"><a href="#1-5-4-HTTP-æµ" class="headerlink" title="1.5.4. HTTP æµ"></a>1.5.4. HTTP æµ</h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-codecs-streaming">Same as in Spring WebFlux</a></p><p>æ‚¨å¯ä»¥å°†<code>DeferredResult</code>å’Œ<code>Callable</code>ç”¨äºå•ä¸ªå¼‚æ­¥è¿”å›å€¼ã€‚ å¦‚æœè¦ç”Ÿæˆå¤šä¸ªå¼‚æ­¥å€¼å¹¶å°†å…¶å†™å…¥å“åº”ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ æœ¬èŠ‚ä»‹ç»å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œã€‚</p><h5 id="Objects"><a href="#Objects" class="headerlink" title="Objects"></a>Objects</h5><p>æ‚¨å¯ä»¥ä½¿ç”¨<code>ResponseBodyEmitter</code>è¿”å›å€¼æ¥ç”Ÿæˆå¯¹è±¡æµï¼Œå…¶ä¸­æ¯ä¸ªå¯¹è±¡éƒ½ä½¿ç”¨ <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/integration.html#rest-message-conversion"><code>HttpMessageConverter</code></a>è¿›è¡Œåºåˆ—åŒ–å¹¶å†™å…¥å“åº”ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/events&quot;)</span><span class="hljs-keyword">public</span> ResponseBodyEmitter <span class="hljs-title function_">handle</span><span class="hljs-params">()</span> &#123;    <span class="hljs-type">ResponseBodyEmitter</span> <span class="hljs-variable">emitter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResponseBodyEmitter</span>();    <span class="hljs-comment">// Save the emitter somewhere..    return emitter;&#125;</span><br><span class="hljs-comment">// In some other threademitter.send(&quot;Hello once&quot;);</span><br><span class="hljs-comment">// and again later onemitter.send(&quot;Hello again&quot;);</span><br><span class="hljs-comment">// and done at some pointemitter.complete();</span><br></code></pre></td></tr></table></figure><p><code>ResponseBodyEmitter</code>ä¹Ÿå¯ä»¥è¢«æ”¾åˆ°<code>ResponseEntity</code>ä½“é‡Œé¢ä½¿ç”¨ï¼Œè¿™å¯ä»¥å¯¹å“åº”çŠ¶æ€å’Œå“åº”å¤´åšä¸€äº›å®šåˆ¶ã€‚</p><p>å½“<code>emitter</code> æŠ›å‡º<code>IOException</code>æ—¶ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœè¿œç¨‹å®¢æˆ·ç«¯æ¶ˆå¤±ï¼‰ï¼Œåº”ç”¨ç¨‹åºä¸è´Ÿè´£æ¸…ç†è¿æ¥ï¼Œä¸åº”è°ƒç”¨<code>emitter.complete</code>æˆ–<code>emitter.completeWithError</code>ã€‚ ç›¸åï¼Œservletå®¹å™¨ä¼šè‡ªåŠ¨å¯åŠ¨<code>AsyncListener</code> é”™è¯¯é€šçŸ¥ï¼Œå…¶ä¸­Spring MVCè¿›è¡Œ <code>completeWithError</code>è°ƒç”¨ã€‚ åè¿‡æ¥ï¼Œæ­¤è°ƒç”¨ä¼šå¯¹åº”ç”¨ç¨‹åºæ‰§è¡Œä¸€æ¬¡æœ€ç»ˆ<code>ASYNC</code> è°ƒåº¦ï¼Œåœ¨æ­¤æœŸé—´ï¼ŒSpring MVCå°†è°ƒç”¨å·²é…ç½®çš„å¼‚å¸¸è§£æç¨‹åºå¹¶å®Œæˆè¯·æ±‚ã€‚</p><h5 id="SSE"><a href="#SSE" class="headerlink" title="SSE"></a>SSE</h5><p><code>SseEmitter</code> ï¼ˆ<code>ResponseBodyEmitter</code>çš„å­ç±»ï¼‰ä¸º<a href="https://www.w3.org/TR/eventsource/">Server-Sent Events</a>,æä¾›æ”¯æŒï¼Œå…¶ä¸­ä»æœåŠ¡å™¨å‘é€çš„äº‹ä»¶æ ¹æ®W3C SSEè§„èŒƒè¿›è¡Œæ ¼å¼åŒ–ã€‚ è¦ä»æ§åˆ¶å™¨ç”ŸæˆSSEæµï¼Œè¯·è¿”å›<code>SseEmitter</code>ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(path=&quot;/events&quot;, produces=MediaType.TEXT_EVENT_STREAM_VALUE)</span><span class="hljs-keyword">public</span> SseEmitter <span class="hljs-title function_">handle</span><span class="hljs-params">()</span> &#123;    <span class="hljs-type">SseEmitter</span> <span class="hljs-variable">emitter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SseEmitter</span>();    <span class="hljs-comment">// Save the emitter somewhere..    return emitter;&#125;</span><br><span class="hljs-comment">// In some other threademitter.send(&quot;Hello once&quot;);</span><br><span class="hljs-comment">// and again later onemitter.send(&quot;Hello again&quot;);</span><br><span class="hljs-comment">// and done at some pointemitter.complete();</span><br></code></pre></td></tr></table></figure><p>è™½ç„¶SSEæ˜¯æµå¼ä¼ è¾“åˆ°æµè§ˆå™¨çš„ä¸»è¦é€‰é¡¹ï¼Œä½†è¯·æ³¨æ„Internet Explorerä¸æ”¯æŒServer-Sent Eventsã€‚ è€ƒè™‘å°†Springçš„<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#websocket">WebSocket messaging</a>ä¼ é€’ä¸é’ˆå¯¹å„ç§æµè§ˆå™¨çš„ <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#websocket-fallback">SockJS fallback</a> ä¼ è¾“ï¼ˆåŒ…æ‹¬SSEï¼‰ä¸€èµ·ä½¿ç”¨ã€‚</p><p>æœ‰å…³å¼‚å¸¸å¤„ç†çš„è¯´æ˜ï¼Œå¦è¯·å‚è§<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-async-objects">ä¸Šä¸€èŠ‚</a> ã€‚</p><h5 id="Raw-Data"><a href="#Raw-Data" class="headerlink" title="Raw Data"></a>Raw Data</h5><p>æœ‰æ—¶ï¼Œè·³è¿‡æ¶ˆæ¯è½¬æ¢çš„é˜¶æ®µï¼Œç›´æ¥æŠŠæ•°æ®å†™å›å“åº”çš„è¾“å‡ºæµ<code>OutputStream</code>å¯èƒ½æ›´æœ‰æ•ˆï¼Œæ¯”å¦‚æ–‡ä»¶ä¸‹è½½è¿™æ ·çš„åœºæ™¯ï¼Œè¿™å¯ä»¥é€šè¿‡è¿”å›ä¸€ä¸ª<code>StreamingResponseBody</code>ç±»å‹çš„å¯¹è±¡æ¥å®ç°ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">&quot;/download&quot;</span>)<br><br><span class="hljs-keyword">public</span> <span class="hljs-function">StreamingResponseBody <span class="hljs-title">handle</span><span class="hljs-params">()</span> </span>&#123;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> StreamingResponseBody() &#123;<br><br>        <span class="hljs-meta">@Override</span><br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">writeTo</span><span class="hljs-params">(OutputStream outputStream)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br><br>            <span class="hljs-comment">// write...</span><br><br>        &#125;<br><br>    &#125;;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>StreamingResponseBody</code>ä¹Ÿå¯ä»¥è¢«æ”¾åˆ°<code>ResponseEntity</code> ä½“é‡Œé¢ä½¿ç”¨ï¼Œè¿™å¯ä»¥å¯¹å“åº”çŠ¶æ€å’Œå“åº”å¤´åšä¸€äº›å®šåˆ¶ã€‚</p><h4 id="1-5-5-Reactive-Typesï¼ˆå“åº”å¼ç±»å‹ï¼‰"><a href="#1-5-5-Reactive-Typesï¼ˆå“åº”å¼ç±»å‹ï¼‰" class="headerlink" title="1.5.5. Reactive Typesï¼ˆå“åº”å¼ç±»å‹ï¼‰"></a>1.5.5. Reactive Typesï¼ˆå“åº”å¼ç±»å‹ï¼‰</h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-codecs-streaming">Same as in Spring WebFlux</a></p><p>å¦‚æœä½¿ç”¨<code>spring-webflux</code>ä¸­çš„å“åº”å¼<code>WebClient</code>ï¼Œæˆ–å…¶ä»–å®¢æˆ·ç«¯ï¼ˆä¹Ÿå¯ä»¥é˜…è¯»WebFluxéƒ¨åˆ†ä¸­çš„<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-reactive-libraries">Reactive Libraries</a>ï¼‰ï¼Œåˆæˆ–è€…æ˜¯å¸¦å“åº”å¼æ”¯æŒçš„æ•°æ®å­˜å‚¨ï¼Œå¼€å‘è€…å¯ä»¥ç›´æ¥ä»Spring MVCæ§åˆ¶å™¨æ–¹æ³•è¿”å›å“åº”å¼ç±»å‹ã€‚ p&gt;</p><p>Reactive è¿”å›å€¼çš„å¤„ç†æ–¹å¼å¦‚ä¸‹:</p><ul><li>å¦‚æœè¿”å›ç±»å‹æœ‰single-valueæµçš„è¯­ä¹‰ï¼Œå¦‚Reactor<code>Mono</code>æˆ–RxJava <code>Single</code>ï¼Œé‚£ä¹ˆå®ƒæ˜¯é€‚é…å¹¶ç­‰æ•ˆäº <code>DeferredResult</code>ã€‚</li><li>å¦‚æœè¿”å›ç±»å‹æœ‰multi-valueæµçš„è¯­ä¹‰ï¼Œå¦‚Reactor <code>Flux</code>æˆ–RxJava <code>Observable</code>ï¼Œå¹¶ä¸”å¦‚æœåª’ä½“ç±»å‹ä¹Ÿè¡¨ç¤ºä¸ºæµï¼Œï¼ˆä¾‹å¦‚ï¼Œ<code>application/stream+json</code>æˆ–<code>text/event-stream</code>ï¼‰ã€‚ åˆ™å®ƒæ˜¯é€‚é…å¹¶ç­‰æ•ˆäºä½¿ç”¨<code>ResponseBodyEmitter</code>æˆ– <code>SseEmitter</code>ã€‚è¿˜å¯ä»¥è¿”å›<code>Flux&lt;ServerSentEvent&gt;</code>æˆ– <code>Observable&lt;ServerSentEvent&gt;</code>ã€‚</li><li>å¦‚æœè¿”å›ç±»å‹multi-valueæµçš„è¯­ä¹‰ï¼Œä½†åª’ä½“ç±»å‹å¹¶ä¸è¡¨ç¤ºä¸ºæµã€‚ä¾‹å¦‚<code>application/json</code>ï¼Œåˆ™å®ƒæ˜¯é€‚é…å¹¶ç­‰æ•ˆäºä½¿ç”¨<code>DeferredResult&lt;List&lt;?&gt;&gt;</code>ã€‚</li></ul><p>Spring MVCå¯¹ä½¿ç”¨ä¸­çš„å“åº”å¼åº“è¿›è¡Œäº†é€‚é… â€“ ä¾‹å¦‚ï¼Œé¢„è®¡æœ‰å¤šå°‘å€¼ï¼Œè¿™æ˜¯åœ¨<code>spring-core</code>åŒ…çš„<a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/core/ReactiveAdapterRegistry.html"><code>ReactiveAdapterRegistry</code></a> çš„å¸®åŠ©ä¸‹å®Œæˆçš„ã€‚ å®ƒä¸ºå“åº”å¼å’Œå¼‚æ­¥ç±»å‹æä¾›å¯æ’æ‹”çš„æ”¯æŒã€‚æ³¨å†Œè¡¨å†…ç½®äº†å¯¹RxJavaçš„æ”¯æŒï¼Œä½†å…¶ä»–å¯ä»¥æ³¨å†Œã€‚</p><p>å¯¹äºæµå¼ä¼ è¾“åˆ°å“åº”ï¼Œæ”¯æŒå“åº”å¼å“åº”ï¼Œä½†æ˜¯å¯¹å“åº”çš„å†™å…¥ä»ç„¶æ˜¯é˜»å¡çš„ï¼Œå¹¶ä¸”é€šè¿‡<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-async-configuration-spring-mvc">é…ç½®</a> çš„<code>TaskExecutor</code>åœ¨å•ç‹¬çš„çº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œ ä»¥é¿å…é˜»å¡ä¸Šæ¸¸æºï¼ˆä¾‹å¦‚ä»<code>WebClient</code>è¿”å›çš„<code>Flux</code>ï¼‰ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>SimpleAsyncTaskExecutor</code>ç”¨äºé˜»å¡å†™å…¥ï¼Œä½†åœ¨åŠ è½½æ—¶ä¸é€‚ç”¨ã€‚ å¦‚æœè®¡åˆ’ä½¿ç”¨å“åº”ç±»å‹è¿›è¡Œæµå¼å¤„ç†ï¼Œåˆ™åº”ä½¿ç”¨MVCé…ç½®æ¥é…ç½®ä»»åŠ¡æ‰§è¡Œç¨‹åºã€‚</p><h4 id="1-5-6-æ–­å¼€"><a href="#1-5-6-æ–­å¼€" class="headerlink" title="1.5.6. æ–­å¼€"></a>1.5.6. æ–­å¼€</h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-codecs-streaming">Same as in Spring WebFlux</a></p><p>å½“è¿œç¨‹å®¢æˆ·ç«¯æ¶ˆå¤±æ—¶ï¼ŒServlet APIä¸æä¾›ä»»ä½•é€šçŸ¥ã€‚ å› æ­¤ï¼Œåœ¨é€šè¿‡streamä¼ è¾“åˆ°å“åº”æ—¶ï¼Œæ— è®ºæ˜¯é€šè¿‡<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-async-sse">SseEmitter</a>è¿˜æ˜¯&lt;&lt;mvc-ann-async-reactive-types,reactive types&gt;ï¼Œå®šæœŸå‘é€æ•°æ®éƒ½å¾ˆé‡è¦ï¼Œ å› ä¸ºå¦‚æœå®¢æˆ·ç«¯æ–­å¼€è¿æ¥ï¼Œå†™å…¥å°†å¤±è´¥ã€‚ å‘é€å¯ä»¥é‡‡ç”¨ç©ºï¼ˆä»…é™æ³¨è§£ï¼‰SSEäº‹ä»¶æˆ–å¦ä¸€æ–¹å¿…é¡»è§£é‡Šä¸ºå¿ƒè·³å¹¶å¿½ç•¥çš„ä»»ä½•å…¶ä»–æ•°æ®çš„å½¢å¼ã€‚</p><p>æˆ–è€…ï¼Œè€ƒè™‘ä½¿ç”¨å…·æœ‰å†…ç½®å¿ƒè·³æœºåˆ¶çš„Webæ¶ˆæ¯ä¼ é€’è§£å†³æ–¹æ¡ˆï¼ˆä¾‹å¦‚åŸºäºWebSocketçš„<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#websocket-stomp">STOMP</a>æˆ–å…·æœ‰<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#websocket-fallback">SockJS</a>çš„WebSocketï¼‰ã€‚</p><h4 id="1-5-7-é…ç½®"><a href="#1-5-7-é…ç½®" class="headerlink" title="1.5.7. é…ç½®"></a>1.5.7. é…ç½®</h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-async-vs-webflux">Compared to WebFlux</a></p><p>å¿…é¡»åœ¨Servletå®¹å™¨çº§åˆ«å¯ç”¨å¼‚æ­¥è¯·æ±‚å¤„ç†åŠŸèƒ½ã€‚ MVCé…ç½®è¿˜å…¬å¼€äº†å¼‚æ­¥è¯·æ±‚çš„å‡ ä¸ªé€‰é¡¹ã€‚</p><h5 id="Servlet-å®¹å™¨"><a href="#Servlet-å®¹å™¨" class="headerlink" title="Servlet å®¹å™¨"></a>Servlet å®¹å™¨</h5><p>Filterå’ŒServletå£°æ˜å…·æœ‰<code>asyncSupported</code>æ ‡å¿—ï¼Œéœ€è¦å°†å…¶è®¾ç½®ä¸º<code>true</code>ä»¥å¯ç”¨å¼‚æ­¥è¯·æ±‚å¤„ç†ã€‚ æ­¤å¤–ï¼Œåº”å£°æ˜Filteræ˜ å°„ä»¥å¤„ç†<code>ASYNC</code> <code>javax.servlet.DispatchType</code>ã€‚</p><p>åœ¨Javaé…ç½®ä¸­ï¼Œå½“æ‚¨ä½¿ç”¨<code>AbstractAnnotationConfigDispatcherServletInitializer</code>åˆå§‹åŒ–Servletå®¹å™¨æ—¶ï¼Œè¿™å°†è‡ªåŠ¨å®Œæˆã€‚</p><p>åœ¨<code>web.xml</code> é…ç½®ä¸­ï¼Œæ‚¨å¯ä»¥å°†<code>&lt;async-supported&gt;true&lt;/async-supported&gt;</code> æ·»åŠ åˆ°<code>DispatcherServlet</code>å’Œ<code>Filter</code>å£°æ˜ï¼Œå¹¶æ·»åŠ <code>&lt;dispatcher&gt;ASYNC&lt;/dispatcher&gt;</code>ä»¥è¿‡æ»¤æ˜ å°„ã€‚</p><h5 id="Spring-MVC"><a href="#Spring-MVC" class="headerlink" title="Spring MVC"></a>Spring MVC</h5><p>MVCé…ç½®å…¬å¼€ä»¥ä¸‹ä¸å¼‚æ­¥è¯·æ±‚å¤„ç†ç›¸å…³çš„é€‰é¡¹ï¼š</p><ul><li>Java configuration:åœ¨<code>WebMvcConfigurer</code>ä¸Šä½¿ç”¨<code>configureAsyncSupport</code>å›è°ƒã€‚</li><li>XML namespace:ä½¿ç”¨ <code>&lt;mvc:annotation-driven&gt;</code>ä¸‹çš„<code>&lt;async-support&gt;</code>å…ƒç´ ã€‚</li></ul><p>æ‚¨å¯ä»¥é…ç½®ä»¥ä¸‹å†…å®¹ï¼š</p><ul><li>å¼‚æ­¥è¯·æ±‚çš„é»˜è®¤è¶…æ—¶å€¼ï¼ˆå¦‚æœæœªè®¾ç½®ï¼‰å–å†³äºåº•å±‚Servletå®¹å™¨ï¼ˆä¾‹å¦‚ï¼ŒTomcatä¸Šçš„10ç§’ï¼‰ã€‚</li><li><code>AsyncTaskExecutor</code>ç”¨äºåœ¨ä½¿ç”¨<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-async-reactive-types">Reactive Types</a>è¿›è¡Œæµå¼å¤„ç†æ—¶é˜»æ­¢å†™å…¥ï¼Œä»¥åŠç”¨äºæ‰§è¡Œä»æ§åˆ¶å™¨æ–¹æ³•è¿”å›çš„<code>Callable</code>å®ä¾‹ã€‚ å¦‚æœæ‚¨ä½¿ç”¨reactive typesè¿›è¡Œæµå¼ä¼ è¾“æˆ–è€…å…·æœ‰è¿”å›<code>Callable</code>çš„æ§åˆ¶å™¨æ–¹æ³•ï¼Œ æˆ‘ä»¬å¼ºçƒˆå»ºè®®æ‚¨é…ç½®æ­¤å±æ€§ï¼Œå› ä¸ºé»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒæ˜¯<code>SimpleAsyncTaskExecutor</code>ã€‚</li><li><code>DeferredResultProcessingInterceptor</code>å®ç°å’Œ<code>CallableProcessingInterceptor</code>å®ç°ã€‚</li></ul><p>è¯·æ³¨æ„ï¼Œæ‚¨è¿˜å¯ä»¥åœ¨<code>DeferredResult</code>ï¼Œ <code>ResponseBodyEmitter</code>å’Œ<code>SseEmitter</code>ä¸Šè®¾ç½®é»˜è®¤è¶…æ—¶å€¼ã€‚ å¯¹äº<code>Callable</code>ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<code>WebAsyncTask</code> æ¥æä¾›è¶…æ—¶å€¼ã€‚</p><h3 id="1-6-CORS"><a href="#1-6-CORS" class="headerlink" title="1.6. CORS"></a>1.6. CORS</h3><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-cors">Same as in Spring WebFlux</a></p><p>Spring MVCå…è®¸æ‚¨å¤„ç†CORSï¼ˆè·¨æºèµ„æºå…±äº«ï¼‰ã€‚ æœ¬èŠ‚ä»‹ç»å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œã€‚</p><h4 id="1-6-1-ç®€ä»‹"><a href="#1-6-1-ç®€ä»‹" class="headerlink" title="1.6.1. ç®€ä»‹"></a>1.6.1. ç®€ä»‹</h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-cors-intro">Same as in Spring WebFlux</a></p><p>å‡ºäºå®‰å…¨åŸå› ï¼Œæµè§ˆå™¨ç¦æ­¢å¯¹å½“å‰æºå¤–çš„èµ„æºè¿›è¡ŒAJAXè°ƒç”¨ã€‚ ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥å°†æ‚¨çš„é“¶è¡Œå¸æˆ·æ”¾åœ¨ä¸€ä¸ªæ ‡ç­¾é¡µä¸­ï¼Œå°†evil.comæ”¾åœ¨å¦ä¸€ä¸ªæ ‡ç­¾é¡µä¸­ã€‚ æ¥è‡ªevil.comçš„è„šæœ¬ä¸åº”è¯¥ä½¿ç”¨æ‚¨çš„å‡­æ®å‘æ‚¨çš„é“¶è¡ŒAPIå‘å‡ºAJAXè¯·æ±‚ - ä¾‹å¦‚ä»æ‚¨çš„å¸æˆ·ä¸­æå–èµ„é‡‘ï¼</p><p>Cross-Origin Resource Sharing (CORS) æ˜¯<a href="https://caniuse.com/#feat=cors">å¤§å¤šæ•°æµè§ˆå™¨</a> å®ç°çš„<a href="https://www.w3.org/TR/cors/">W3Cè§„èŒƒ</a>ï¼Œå®ƒå…è®¸ä»¥çµæ´»çš„æ–¹å¼æŒ‡å®šå“ªäº›ç±»å‹çš„è·¨åŸŸè¯·æ±‚è¢«æˆæƒï¼Œ è€Œä¸æ˜¯ä½¿ç”¨ä¸€äº›å®‰å…¨ç¨‹åº¦è¾ƒä½ã€åŠŸèƒ½è¾ƒå·®çš„å®ç°(å¦‚IFRAMEæˆ–JSONP)ã€‚</p><h4 id="1-6-2-å¤„ç†"><a href="#1-6-2-å¤„ç†" class="headerlink" title="1.6.2. å¤„ç†"></a>1.6.2. å¤„ç†</h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-cors-processing">Same as in Spring WebFlux</a></p><p>CORSè§„èŒƒåŒºåˆ†äº†é¢„æ£€æŸ¥ï¼Œç®€å•å’Œå®é™…è¯·æ±‚ã€‚ è¦äº†è§£CORSçš„å·¥ä½œåŸç†ï¼Œæ‚¨å¯ä»¥<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">&gt;é˜…è¯»æœ¬æ–‡</a>ä»¥åŠå…¶ä»–è®¸å¤šå†…å®¹ï¼Œæˆ–è€…æŸ¥çœ‹è§„èŒƒä»¥è·å–æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚</p><p>Spring MVC <code>HandlerMapping</code>ä¸ºå®ç°CORSæä¾›å†…ç½®æ”¯æŒã€‚æˆåŠŸå°†è¯·æ±‚æ˜ å°„åˆ°å¤„ç†ç¨‹åºåï¼Œ<code>HandlerMapping</code> å®ç°æ£€æŸ¥ç»™å®šè¯·æ±‚å’Œå¤„ç†ç¨‹åºçš„CORSé…ç½®å¹¶é‡‡å–è¿›ä¸€æ­¥æ“ä½œã€‚ ç›´æ¥å¤„ç†é¢„æ£€æŸ¥è¯·æ±‚ï¼ŒåŒæ—¶æ‹¦æˆªï¼ŒéªŒè¯ç®€å•å’Œå®é™…çš„CORSè¯·æ±‚ï¼Œå¹¶è®¾ç½®æ‰€éœ€çš„CORSå“åº”å¤´ã€‚</p><p>ä¸ºäº†å¯ç”¨è·¨æºè¯·æ±‚ï¼ˆå³ï¼Œå­˜åœ¨<code>Origin</code>å¤´å¹¶ä¸”ä¸è¯·æ±‚çš„ä¸»æœºä¸åŒï¼‰ï¼Œæ‚¨éœ€è¦å…·æœ‰ä¸€äº›æ˜¾å¼å£°æ˜çš„CORSé…ç½®ã€‚ å¦‚æœæœªæ‰¾åˆ°åŒ¹é…çš„CORSé…ç½®ï¼Œåˆ™æ‹’ç»é¢„æ£€è¯·æ±‚ã€‚ æ²¡æœ‰CORSå¤´æ·»åŠ åˆ°ç®€å•å’Œå®é™…CORSè¯·æ±‚çš„å“åº”ä¸­ï¼Œå› æ­¤æµè§ˆå™¨æ‹’ç»å®ƒä»¬ã€‚</p><p>å¯ä»¥ä½¿ç”¨åŸºäºURLæ¨¡å¼çš„<code>CorsConfiguration</code>æ˜ å°„å•ç‹¬ <a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/web/servlet/handler/AbstractHandlerMapping.html#setCorsConfigurations-java.util.Map-">é…ç½®</a>æ¯ä¸ª<code>HandlerMapping</code>ã€‚ åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåº”ç”¨ç¨‹åºä½¿ç”¨MVC Javaé…ç½®æˆ–XMLå‘½åç©ºé—´æ¥å£°æ˜æ­¤ç±»æ˜ å°„ï¼Œè¿™ä¼šå¯¼è‡´å°†å•ä¸ªå…¨å±€æ˜ å°„ä¼ é€’ç»™æ‰€æœ‰<code>HandlerMappping</code> å®ä¾‹ã€‚</p><p>æ‚¨å¯ä»¥å°†<code>HandlerMapping</code>çº§åˆ«çš„å…¨å±€CORSé…ç½®ä¸æ›´ç»†ç²’åº¦çš„å¤„ç†ç¨‹åºçº§CORSé…ç½®ç›¸ç»“åˆã€‚ ä¾‹å¦‚ï¼Œå¸¦æ³¨è§£çš„æ§åˆ¶å™¨å¯ä»¥ä½¿ç”¨ç±»æˆ–æ–¹æ³•çº§åˆ«çš„<code>@CrossOrigin</code>æ³¨è§£ï¼ˆå…¶ä»–å¤„ç†ç¨‹åºå¯ä»¥å®ç°<code>CorsConfigurationSource</code>ï¼‰ã€‚</p><p>ç»„åˆå…¨å±€å’Œæœ¬åœ°é…ç½®çš„è§„åˆ™é€šå¸¸æ˜¯é™„åŠ çš„ - ä¾‹å¦‚ï¼Œæ‰€æœ‰å…¨å±€å’Œæ‰€æœ‰æœ¬åœ°æºã€‚ å¯¹äºåªèƒ½æ¥å—å•ä¸ªå€¼çš„å±æ€§ï¼ˆä¾‹å¦‚ <code>allowCredentials</code> å’Œ <code>maxAge</code>ï¼‰ï¼Œ æœ¬åœ°ä¼šè¦†ç›–å…¨å±€å€¼ã€‚ æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/web/cors/CorsConfiguration.html#combine-org.springframework.web.cors.CorsConfiguration-"><code>CorsConfiguration#combine(CorsConfiguration)</code></a>ã€‚</p><p>è¦ä»sourceä¸­äº†è§£æ›´å¤šä¿¡æ¯æˆ–è¿›è¡Œé«˜çº§è‡ªå®šä¹‰ï¼Œè¯·æŸ¥çœ‹åé¢çš„ä»£ç :</p><ul><li><code>CorsConfiguration</code></li><li><code>CorsProcessor</code>, <code>DefaultCorsProcessor</code></li><li><code>AbstractHandlerMapping</code></li></ul><h4 id="1-6-3-CrossOrigin"><a href="#1-6-3-CrossOrigin" class="headerlink" title="1.6.3. @CrossOrigin"></a>1.6.3. <code>@CrossOrigin</code></h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-cors-controller">Same as in Spring WebFlux</a></p><p>åœ¨å¸¦æ³¨è§£çš„æ§åˆ¶å™¨æ–¹æ³•ä¸Šä½¿ç”¨<a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/web/bind/annotation/CrossOrigin.html"><code>@CrossOrigin</code></a>æ³¨è§£å¯ç”¨è·¨æºè¯·æ±‚ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@RestController</span><span class="hljs-variable">@RequestMapping</span>(<span class="hljs-string">&quot;/account&quot;</span>)public class AccountController &#123;<br>    <span class="hljs-variable">@CrossOrigin</span>    <span class="hljs-variable">@GetMapping</span>(<span class="hljs-string">&quot;/&#123;id&#125;&quot;</span>)    public Account <span class="hljs-built_in">retrieve</span>(<span class="hljs-variable">@PathVariable</span> Long id) &#123;        <span class="hljs-comment">// ...    &#125;</span><br>    <span class="hljs-variable">@DeleteMapping</span>(<span class="hljs-string">&quot;/&#123;id&#125;&quot;</span>)    public void <span class="hljs-built_in">remove</span>(<span class="hljs-variable">@PathVariable</span> Long id) &#123;        <span class="hljs-comment">// ...    &#125;&#125;</span><br></code></pre></td></tr></table></figure><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>@CrossOrigin</code>å…è®¸ï¼š</p><ul><li>All origins.</li><li>All headers.</li><li>All HTTP methodsï¼ˆå¯ä»¥æ˜ å°„åˆ°æ§åˆ¶å™¨çš„æ–¹æ³•ï¼‰</li></ul><p>é»˜è®¤æƒ…å†µä¸‹ä¸å¯ç”¨<code>allowedCredentials</code>ï¼Œå› ä¸ºå®ƒå»ºç«‹äº†ä¸€ä¸ªä¿¡ä»»çº§åˆ«ï¼Œè¯¥ä¿¡ä»»çº§åˆ«å…¬å¼€æ•æ„Ÿçš„ç”¨æˆ·ç‰¹å®šä¿¡æ¯ï¼ˆä¾‹å¦‚cookieå’ŒCSRFä»¤ç‰Œï¼‰ï¼Œå¹¶ä¸”åªåº”åœ¨é€‚å½“çš„åœ°æ–¹ä½¿ç”¨ã€‚</p><p><code>maxAge</code> è®¾ç½®ä¸º30 åˆ†é’Ÿ.</p><p><code>@CrossOrigin</code>åœ¨ç±»çº§åˆ«ä¹Ÿå—æ”¯æŒï¼Œå¹¶ä¸”ç”±æ‰€æœ‰æ–¹æ³•ç»§æ‰¿ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@CrossOrigin</span>(origins = <span class="hljs-string">&quot;http://domain2.com&quot;</span>, maxAge = <span class="hljs-number">3600</span>)<span class="hljs-variable">@RestController</span><span class="hljs-variable">@RequestMapping</span>(<span class="hljs-string">&quot;/account&quot;</span>)public class AccountController &#123;<br>    <span class="hljs-variable">@GetMapping</span>(<span class="hljs-string">&quot;/&#123;id&#125;&quot;</span>)    public Account <span class="hljs-built_in">retrieve</span>(<span class="hljs-variable">@PathVariable</span> Long id) &#123;        <span class="hljs-comment">// ...    &#125;</span><br>    <span class="hljs-variable">@DeleteMapping</span>(<span class="hljs-string">&quot;/&#123;id&#125;&quot;</span>)    public void <span class="hljs-built_in">remove</span>(<span class="hljs-variable">@PathVariable</span> Long id) &#123;        <span class="hljs-comment">// ...    &#125;&#125;</span><br></code></pre></td></tr></table></figure><p>æ‚¨å¯ä»¥åœ¨ç±»çº§åˆ«å’Œæ–¹æ³•çº§åˆ«ä½¿ç”¨<code>@CrossOrigin</code> ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@CrossOrigin</span>(maxAge = <span class="hljs-number">3600</span>)<span class="hljs-variable">@RestController</span><span class="hljs-variable">@RequestMapping</span>(<span class="hljs-string">&quot;/account&quot;</span>)public class AccountController &#123;<br>    <span class="hljs-variable">@CrossOrigin</span>(<span class="hljs-string">&quot;http://domain2.com&quot;</span>)    <span class="hljs-variable">@GetMapping</span>(<span class="hljs-string">&quot;/&#123;id&#125;&quot;</span>)    public Account <span class="hljs-built_in">retrieve</span>(<span class="hljs-variable">@PathVariable</span> Long id) &#123;        <span class="hljs-comment">// ...    &#125;</span><br>    <span class="hljs-variable">@DeleteMapping</span>(<span class="hljs-string">&quot;/&#123;id&#125;&quot;</span>)    public void <span class="hljs-built_in">remove</span>(<span class="hljs-variable">@PathVariable</span> Long id) &#123;        <span class="hljs-comment">// ...    &#125;&#125;</span><br></code></pre></td></tr></table></figure><h4 id="1-6-4-å…¨å±€é…ç½®"><a href="#1-6-4-å…¨å±€é…ç½®" class="headerlink" title="1.6.4. å…¨å±€é…ç½®"></a>1.6.4. å…¨å±€é…ç½®</h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-cors-global">Same as in Spring WebFlux</a></p><p>é™¤äº†ç»†ç²’åº¦ï¼ŒåŸºäºæ³¨è§£çš„é…ç½®ä»¥å¤–ï¼Œæ‚¨å¯èƒ½è¿˜å¸Œæœ›å®šä¹‰ä¸€äº›å…¨å±€CORSé…ç½®ã€‚æ‚¨å¯ä»¥åœ¨ä»»ä½•<code>HandlerMapping</code>ä¸Šå•ç‹¬è®¾ç½®åŸºäºURLçš„ <code>CorsConfiguration</code>æ˜ å°„ã€‚ ä½†æ˜¯ï¼Œå¤§å¤šæ•°åº”ç”¨ç¨‹åºä½¿ç”¨MVC Javaé…ç½®æˆ–MVC XNMå‘½åç©ºé—´æ¥æ‰§è¡Œæ­¤æ“ä½œã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå…¨å±€é…ç½®å¯ç”¨ä»¥ä¸‹å†…å®¹ï¼š</p><ul><li>All origins.</li><li>All headers.</li><li><code>GET</code>, <code>HEAD</code>, and <code>POST</code> methods.</li></ul><p>é»˜è®¤æƒ…å†µä¸‹ä¸å¯ç”¨<code>allowedCredentials</code>ï¼Œå› ä¸ºå®ƒå»ºç«‹äº†ä¸€ä¸ªä¿¡ä»»çº§åˆ«ï¼Œè¯¥ä¿¡ä»»çº§åˆ«å…¬å¼€æ•æ„Ÿçš„ç”¨æˆ·ç‰¹å®šä¿¡æ¯ï¼ˆä¾‹å¦‚cookieå’ŒCSRFä»¤ç‰Œï¼‰ï¼Œå¹¶ä¸”åªåº”åœ¨é€‚å½“çš„åœ°æ–¹ä½¿ç”¨ã€‚</p><p><code>maxAge</code> è®¾ç½®ä¸º30åˆ†é’Ÿ.</p><h5 id="Java-é…ç½®"><a href="#Java-é…ç½®" class="headerlink" title="Java é…ç½®"></a>Java é…ç½®</h5><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-cors-global">Same as in Spring WebFlux</a></p><p>è¦åœ¨MVC Javaé…ç½®ä¸­å¯ç”¨CORSï¼Œå¯ä»¥ä½¿ç”¨<code>CorsRegistry</code>å›è°ƒï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Configuration</span><span class="hljs-variable">@EnableWebMvcpublic</span> class WebConfig implements WebMvcConfigurer &#123;<br>    <span class="hljs-variable">@Override</span>    public void <span class="hljs-built_in">addCorsMappings</span>(CorsRegistry registry) &#123;<br>        <span class="hljs-selector-tag">registry</span><span class="hljs-selector-class">.addMapping</span>(<span class="hljs-string">&quot;/api/**&quot;</span>)            <span class="hljs-selector-class">.allowedOrigins</span>(<span class="hljs-string">&quot;http://domain2.com&quot;</span>)            <span class="hljs-selector-class">.allowedMethods</span>(<span class="hljs-string">&quot;PUT&quot;</span>, <span class="hljs-string">&quot;DELETE&quot;</span>)            <span class="hljs-selector-class">.allowedHeaders</span>(<span class="hljs-string">&quot;header1&quot;</span>, <span class="hljs-string">&quot;header2&quot;</span>, <span class="hljs-string">&quot;header3&quot;</span>)            <span class="hljs-selector-class">.exposedHeaders</span>(<span class="hljs-string">&quot;header1&quot;</span>, <span class="hljs-string">&quot;header2&quot;</span>)            <span class="hljs-selector-class">.allowCredentials</span>(true)<span class="hljs-selector-class">.maxAge</span>(<span class="hljs-number">3600</span>);<br>        <span class="hljs-comment">// Add more mappings...    &#125;&#125;</span><br></code></pre></td></tr></table></figure><h5 id="XML-é…ç½®"><a href="#XML-é…ç½®" class="headerlink" title="XML é…ç½®"></a>XML é…ç½®</h5><p>è¦åœ¨XMLå‘½åç©ºé—´ä¸­å¯ç”¨CORSï¼Œå¯ä»¥ä½¿ç”¨<code>&lt;mvc:cors&gt;</code>å…ƒç´ ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mvc:cors</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">mvc:mapping</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/api/**&quot;</span>        <span class="hljs-attr">allowed-origins</span>=<span class="hljs-string">&quot;http://domain1.com, http://domain2.com&quot;</span>        <span class="hljs-attr">allowed-methods</span>=<span class="hljs-string">&quot;GET, PUT&quot;</span>        <span class="hljs-attr">allowed-headers</span>=<span class="hljs-string">&quot;header1, header2, header3&quot;</span>        <span class="hljs-attr">exposed-headers</span>=<span class="hljs-string">&quot;header1, header2&quot;</span> <span class="hljs-attr">allow-credentials</span>=<span class="hljs-string">&quot;true&quot;</span>        <span class="hljs-attr">max-age</span>=<span class="hljs-string">&quot;123&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">mvc:mapping</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/resources/**&quot;</span>        <span class="hljs-attr">allowed-origins</span>=<span class="hljs-string">&quot;http://domain1.com&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mvc:cors</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="1-6-5-CORS-è¿‡æ»¤å™¨"><a href="#1-6-5-CORS-è¿‡æ»¤å™¨" class="headerlink" title="1.6.5. CORS è¿‡æ»¤å™¨"></a>1.6.5. CORS è¿‡æ»¤å™¨</h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-cors-webfilter">Same as in Spring WebFlux</a></p><p>æ‚¨å¯ä»¥é€šè¿‡å†…ç½®çš„ <a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/web/filter/CorsFilter.html"><code>CorsFilter</code></a>åº”ç”¨CORSæ”¯æŒã€‚</p><p>å¦‚æœæ‚¨å°è¯•å°†<code>CorsFilter</code> ä¸Spring Securityä¸€èµ·ä½¿ç”¨ï¼Œè¯·è®°ä½Spring Security<a href="https://docs.spring.io/spring-security/site/docs/current/reference/htmlsingle/#cors">å†…ç½®äº†å¯¹CORSçš„æ”¯æŒ</a>ã€‚</p><p>è¦é…ç½®è¿‡æ»¤å™¨ï¼Œè¯·å°†<code>CorsConfigurationSource</code>ä¼ é€’ç»™å…¶æ„é€ å‡½æ•°ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs arduino">CorsConfiguration config = <span class="hljs-keyword">new</span> <span class="hljs-built_in">CorsConfiguration</span>();<br><span class="hljs-comment">// Possibly...// config.applyPermitDefaultValues()</span><br>config.<span class="hljs-built_in">setAllowCredentials</span>(<span class="hljs-literal">true</span>);config.<span class="hljs-built_in">addAllowedOrigin</span>(<span class="hljs-string">&quot;http://domain1.com&quot;</span>);config.<span class="hljs-built_in">addAllowedHeader</span>(<span class="hljs-string">&quot;*&quot;</span>);config.<span class="hljs-built_in">addAllowedMethod</span>(<span class="hljs-string">&quot;*&quot;</span>);<br>UrlBasedCorsConfigurationSource source = <span class="hljs-keyword">new</span> <span class="hljs-built_in">UrlBasedCorsConfigurationSource</span>();source.<span class="hljs-built_in">registerCorsConfiguration</span>(<span class="hljs-string">&quot;/**&quot;</span>, config);<br>CorsFilter filter = <span class="hljs-keyword">new</span> <span class="hljs-built_in">CorsFilter</span>(source);<br></code></pre></td></tr></table></figure><h3 id="1-7-Web-å®‰å…¨"><a href="#1-7-Web-å®‰å…¨" class="headerlink" title="1.7. Web å®‰å…¨"></a>1.7. Web å®‰å…¨</h3><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-web-security">Same as in Spring WebFlux</a></p><p>Spring Securityé¡¹ç›®ä¸ºä¿æŠ¤Webåº”ç”¨ç¨‹åºå…å—æ¶æ„æ”»å‡»æä¾›æ”¯æŒã€‚ è¯·å‚é˜…<a href="https://projects.spring.io/spring-security/">Spring Security</a>å‚è€ƒæ–‡æ¡£ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li><a href="https://docs.spring.io/spring-security/site/docs/current/reference/html5/#mvc">Spring MVC Security</a></li><li><a href="https://docs.spring.io/spring-security/site/docs/current/reference/html5/#test-mockmvc">Spring MVC Test Support</a></li><li><a href="https://docs.spring.io/spring-security/site/docs/current/reference/html5/#csrf">CSRF protection</a></li><li><a href="https://docs.spring.io/spring-security/site/docs/current/reference/html5/#headers">Security Response Headers</a></li></ul><p><a href="http://hdiv.org/">HDIV</a> æ˜¯å¦ä¸€ä¸ªä¸Spring MVCé›†æˆçš„Webå®‰å…¨æ¡†æ¶ã€‚</p><h3 id="1-8-HTTP-ç¼“å­˜"><a href="#1-8-HTTP-ç¼“å­˜" class="headerlink" title="1.8. HTTP ç¼“å­˜"></a>1.8. HTTP ç¼“å­˜</h3><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-caching">Same as in Spring WebFlux</a></p><p>HTTPç¼“å­˜å¯ä»¥æ˜¾ç€æé«˜Webåº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚HTTPç¼“å­˜å›´ç»• <code>Cache-Control</code> å“åº”å¤´ï¼Œéšåæ˜¯æ¡ä»¶è¯·æ±‚å¤´ï¼ˆä¾‹å¦‚<code>Last-Modified</code>å’Œ<code>ETag</code>ï¼‰ã€‚ HTTPçš„å“åº”å¤´<code>Cache-Control</code>ä¸»è¦å¸®åŠ©ç§æœ‰ç¼“å­˜ï¼ˆæ¯”å¦‚æµè§ˆå™¨ç«¯ç¼“å­˜ï¼‰å’Œå…¬å…±ç¼“å­˜ï¼ˆæ¯”å¦‚ä»£ç†ç«¯ç¼“å­˜ï¼‰äº†è§£å®ƒä»¬åº”è¯¥å¦‚æœç¼“å­˜HTTPå“åº”ã€‚å¦‚æœå†…å®¹æœªæ›´æ”¹ï¼Œåˆ™<code>ETag</code>å¤´ç”¨äºç”Ÿæˆæ¡ä»¶è¯·æ±‚ï¼Œ è¯¥æ¡ä»¶è¯·æ±‚å¯èƒ½å¯¼è‡´304ï¼ˆNOT_MODIFIEDï¼‰æ²¡æœ‰æ­£æ–‡ã€‚å¯ä»¥è®¤ä¸ºå®ƒæ˜¯<code>Last-Modified</code>å¤´çš„ä¸€ä¸ªæ›´ç²¾ç»†çš„åç»­ç‰ˆæœ¬ã€‚</p><p>æœ¬èŠ‚ä»‹ç»Spring Web MVCä¸­å¯ç”¨çš„ä¸HTTPç¼“å­˜ç›¸å…³çš„é€‰é¡¹ã€‚</p><h4 id="1-8-1-CacheControl"><a href="#1-8-1-CacheControl" class="headerlink" title="1.8.1. CacheControl"></a>1.8.1. <code>CacheControl</code></h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-caching-cachecontrol">Same as in Spring WebFlux</a></p><p><a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/http/CacheControl.html"><code>CacheControl</code></a>æ”¯æŒé…ç½®ä¸<code>Cache-Control</code>æ ‡å¤´ç›¸å…³çš„è®¾ç½®ï¼Œå¹¶åœ¨è®¸å¤šåœ°æ–¹è¢«æ¥å—ä¸ºå‚æ•°ï¼š</p><ul><li><a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/WebContentInterceptor.html"><code>WebContentInterceptor</code></a></li><li><a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/web/servlet/support/WebContentGenerator.html"><code>WebContentGenerator</code></a></li><li><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-caching-etag-lastmodified">Controllers</a></li><li><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-caching-static-resources">Static Resources</a></li></ul><p>è™½ç„¶<a href="https://tools.ietf.org/html/rfc7234#section-5.2.2">RFC 7234</a>æè¿°äº†<code>Cache-Control</code>å“åº”å¤´çš„æ‰€æœ‰å¯èƒ½çš„æŒ‡ä»¤ï¼Œä½†<code>CacheControl</code>ç±»å‹é‡‡ç”¨é¢å‘ç”¨ä¾‹çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¾§é‡äºå¸¸è§åœºæ™¯ï¼š</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-string">//</span> Cache for an hour - <span class="hljs-string">&quot;Cache-Control: max-age=3600&quot;</span>CacheControl ccCacheOneHour = CacheControl.maxAge<span class="hljs-params">(1, TimeUnit.HOURS)</span>;<br><span class="hljs-string">//</span> Prevent caching - <span class="hljs-string">&quot;Cache-Control: no-store&quot;</span>CacheControl ccNoStore = CacheControl.noStore<span class="hljs-params">()</span>;<br><span class="hljs-string">//</span> Cache for ten days in public and private caches,<span class="hljs-string">//</span> public caches should not transform the response// <span class="hljs-string">&quot;Cache-Control: max-age=864000, public, no-transform&quot;</span>CacheControl ccCustom = CacheControl.maxAge<span class="hljs-params">(10, TimeUnit.DAYS)</span><span class="hljs-string">.noTransform</span><span class="hljs-params">()</span><span class="hljs-string">.cachePublic</span><span class="hljs-params">()</span>;<br></code></pre></td></tr></table></figure><p><code>WebContentGenerator</code>è¿˜æ¥å—ä¸€ä¸ªæ›´ç®€å•çš„<code>cachePeriod</code>å±æ€§ï¼ˆä»¥ç§’ä¸ºå•ä½å®šä¹‰ï¼‰ï¼Œå…¶å·¥ä½œæ–¹å¼å¦‚ä¸‹ï¼š</p><ul><li>A <code>-1</code> å€¼ä¸ä¼šç”Ÿæˆ<code>Cache-Control</code> çš„å“åº”å¤´ã€‚</li><li>A <code>0</code>å€¼å°†é˜²æ­¢ç¼“å­˜ä½¿ç”¨<code>&#39;Cache-Control: no-store&#39;</code> æŒ‡ä»¤.</li><li>An <code>n &gt; 0</code> ä¸€ä¸ªå¤§äº0çš„å€¼å°†ç¼“å­˜ç»™å®šçš„å“åº”åœ¨<code>n</code>ç§’ä½¿ç”¨<code>&#39;Cache-Control: max-age=n&#39;</code></li></ul><h4 id="1-8-2-Controllers"><a href="#1-8-2-Controllers" class="headerlink" title="1.8.2. Controllers"></a>1.8.2. Controllers</h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-caching-etag-lastmodified">Same as in Spring WebFlux</a></p><p>æ§åˆ¶å™¨å¯ä»¥æ·»åŠ å¯¹HTTPç¼“å­˜çš„æ˜¾å¼æ”¯æŒã€‚ æˆ‘ä»¬å»ºè®®è¿™æ ·åšï¼Œå› ä¸ºèµ„æºçš„<code>lastModified</code>æˆ–<code>ETag</code>å€¼éœ€è¦å…ˆè®¡ç®—æ‰èƒ½ä¸æ¡ä»¶è¯·æ±‚å¤´è¿›è¡Œæ¯”è¾ƒã€‚ æ§åˆ¶å™¨å¯ä»¥å‘<code>ResponseEntity</code>æ·»åŠ <code>ETag</code>å¤´å’Œ<code>Cache-Control</code>è®¾ç½®ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/book/&#123;id&#125;&quot;)</span><span class="hljs-keyword">public</span> ResponseEntity&lt;Book&gt; <span class="hljs-title function_">showBook</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> &#123;<br>    <span class="hljs-type">Book</span> <span class="hljs-variable">book</span> <span class="hljs-operator">=</span> findBook(id);    <span class="hljs-type">String</span> <span class="hljs-variable">version</span> <span class="hljs-operator">=</span> book.getVersion();<br>    <span class="hljs-keyword">return</span> ResponseEntity            .ok()            .cacheControl(CacheControl.maxAge(<span class="hljs-number">30</span>, TimeUnit.DAYS))            .eTag(version) <span class="hljs-comment">// lastModified is also available            .body(book);&#125;</span><br></code></pre></td></tr></table></figure><p>å¦‚æœä¸æ¡ä»¶è¯·æ±‚å¤´çš„æ¯”è¾ƒè¡¨æ˜å†…å®¹æœªæ›´æ”¹ï¼Œåˆ™å‰é¢çš„ç¤ºä¾‹å‘é€å¸¦æœ‰ç©ºå“åº”ä½“çš„304ï¼ˆNOT_MODIFIEDï¼‰å“åº”ã€‚ å¦åˆ™ï¼Œ<code>ETag</code> å’Œ<code>Cache-Control</code>æ ‡å¤´å°†æ·»åŠ åˆ°å“åº”ä¸­ã€‚</p><p>æ‚¨è¿˜å¯ä»¥å¯¹æ§åˆ¶å™¨ä¸­çš„æ¡ä»¶è¯·æ±‚å¤´è¿›è¡Œæ£€æŸ¥ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@RequestMappingpublic</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">myHandleMethod</span>(<span class="hljs-params">WebRequest webRequest, Model model</span>) &#123;<br>    long eTag = ... (<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">if</span> (request.<span class="hljs-title function_">checkNotModified</span>(eTag)) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; (<span class="hljs-number">2</span>)    &#125;<br>    model.<span class="hljs-title function_">addAttribute</span>(...); (<span class="hljs-number">3</span>)    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;myViewName&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><p><strong>1</strong>ã€ç‰¹å®šäºåº”ç”¨çš„è®¡ç®—ã€‚</p><p><strong>2</strong>ã€å“åº”å·²è®¾ç½®ä¸º304ï¼ˆNOT_MODIFIEDï¼‰ - æ— éœ€è¿›ä¸€æ­¥å¤„ç†ã€‚</p><p><strong>3</strong>ã€ç»§ç»­è¯·æ±‚å¤„ç†ã€‚</p><p>æœ‰ä¸‰ç§å˜ä½“å¯ç”¨äºæ£€æŸ¥é’ˆå¯¹<code>eTag</code>å€¼ï¼Œ<code>lastModified</code>å€¼æˆ–ä¸¤è€…çš„æ¡ä»¶è¯·æ±‚ã€‚ å¯¹äºæ¡ä»¶<code>GET</code>å’Œ<code>HEAD</code>è¯·æ±‚ï¼Œ æ‚¨å¯ä»¥å°†å“åº”è®¾ç½®ä¸º304ï¼ˆNOT_MODIFIEDï¼‰ã€‚å¯¹äº<code>POST</code>, <code>PUT</code>, and <code>DELETE</code>ï¼Œæ‚¨å¯ä»¥å°†å“åº”è®¾ç½®ä¸º409ï¼ˆPRECONDITION_FAILEDï¼‰ï¼Œä»¥é˜²æ­¢å¹¶å‘ä¿®æ”¹ã€‚</p><h4 id="1-8-3-é™æ€èµ„æº"><a href="#1-8-3-é™æ€èµ„æº" class="headerlink" title="1.8.3. é™æ€èµ„æº"></a>1.8.3. é™æ€èµ„æº</h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-caching-static-resources">Same as in Spring WebFlux</a></p><p>æ‚¨åº”è¯¥ä½¿ç”¨<code>Cache-Control</code> å’Œæ¡ä»¶å“åº”å¤´æ¥æä¾›é™æ€èµ„æºï¼Œä»¥è·å¾—æœ€ä½³æ€§èƒ½ã€‚ è¯·å‚é˜…æœ‰å…³é…ç½®<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-config-static-resources">é™æ€èµ„æº</a>çš„éƒ¨åˆ†ã€‚</p><h4 id="1-8-4-ETag-è¿‡æ»¤å™¨"><a href="#1-8-4-ETag-è¿‡æ»¤å™¨" class="headerlink" title="1.8.4. ETag è¿‡æ»¤å™¨"></a>1.8.4. <code>ETag</code> è¿‡æ»¤å™¨</h4><p>æ‚¨å¯ä»¥ä½¿ç”¨<code>ShallowEtagHeaderFilter</code>æ·»åŠ ä»å“åº”å†…å®¹è®¡ç®—çš„â€œshallowâ€ eTagå€¼ï¼Œä»è€ŒèŠ‚çœå¸¦å®½ä½†ä¸èŠ‚çœCPUæ—¶é—´ã€‚ è§ <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#filters-shallow-etag">Shallow ETag</a>ã€‚</p><h3 id="1-9-è§†å›¾æŠ€æœ¯"><a href="#1-9-è§†å›¾æŠ€æœ¯" class="headerlink" title="1.9. è§†å›¾æŠ€æœ¯"></a>1.9. è§†å›¾æŠ€æœ¯</h3><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-view">Same as in Spring WebFlux</a></p><p>æ— è®ºæ‚¨å†³å®šä½¿ç”¨Thymeleafï¼ŒGroovyæ ‡è®°æ¨¡æ¿ï¼ŒJSPè¿˜æ˜¯å…¶ä»–æŠ€æœ¯ï¼ŒSpring MVCä¸­è§†å›¾æŠ€æœ¯çš„ä½¿ç”¨éƒ½æ˜¯å¯æ’æ‹”çš„ï¼Œ ä¸»è¦æ˜¯é…ç½®æ›´æ”¹çš„é—®é¢˜ã€‚ æœ¬ç« ä»‹ç»äº†ä¸Spring MVCé›†æˆçš„è§†å›¾æŠ€æœ¯ã€‚ æˆ‘ä»¬å‡è®¾æ‚¨å·²ç»ç†Ÿæ‚‰<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-viewresolver">è§£æè§†å›¾</a>ã€‚</p><h4 id="1-9-1-Thymeleaf"><a href="#1-9-1-Thymeleaf" class="headerlink" title="1.9.1. Thymeleaf"></a>1.9.1. Thymeleaf</h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-view-thymeleaf">Same as in Spring WebFlux</a></p><p>Thymeleafæ˜¯ä¸€ä¸ªç°ä»£æœåŠ¡å™¨ç«¯Javaæ¨¡æ¿å¼•æ“ï¼Œå®ƒå¼ºè°ƒå¯ä»¥é€šè¿‡åŒå‡»åœ¨æµè§ˆå™¨ä¸­é¢„è§ˆçš„è‡ªç„¶HTMLæ¨¡æ¿ï¼Œè¿™å¯¹äºUIæ¨¡æ¿çš„ç‹¬ç«‹å·¥ä½œï¼ˆä¾‹å¦‚ï¼Œç”±è®¾è®¡äººå‘˜ï¼‰éå¸¸æœ‰ç”¨ï¼Œè€Œæ— éœ€è¿è¡ŒæœåŠ¡å™¨ã€‚ å¦‚æœæ‚¨æƒ³è¦æ›¿æ¢JSPï¼ŒThymeleafæä¾›äº†ä¸€ç»„æœ€å¹¿æ³›çš„åŠŸèƒ½ï¼Œä½¿è¿™ç§è½¬æ¢æ›´å®¹æ˜“ã€‚ Thymeleafç§¯æå¼€å‘å’Œç»´æŠ¤ã€‚ æœ‰å…³æ›´å®Œæ•´çš„ä»‹ç»ï¼Œè¯·å‚é˜…<a href="http://www.thymeleaf.org/">Thymeleaf</a>é¡¹ç›®ä¸»é¡µã€‚</p><p>Thymeleafä¸Spring MVCçš„é›†æˆç”±Thymeleafé¡¹ç›®ç®¡ç†ã€‚ é…ç½®æ¶‰åŠä¸€äº›beanå£°æ˜ï¼Œ ä¾‹å¦‚<code>ServletContextTemplateResolver</code>, <code>SpringTemplateEngine</code>, å’Œ <code>ThymeleafViewResolver</code>.ã€‚ æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="http://www.thymeleaf.org/documentation.html">Thymeleaf+Spring</a>ã€‚</p><h4 id="1-9-2-FreeMarker"><a href="#1-9-2-FreeMarker" class="headerlink" title="1.9.2. FreeMarker"></a>1.9.2. FreeMarker</h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-view-freemarker">Same as in Spring WebFlux</a></p><p><a href="http://www.freemarker.org/">Apache FreeMarker</a> æ˜¯ä¸€ä¸ªæ¨¡æ¿å¼•æ“ï¼Œç”¨äºç”Ÿæˆä»HTMLåˆ°ç”µå­é‚®ä»¶å’Œå…¶ä»–çš„ä»»ä½•ç±»å‹çš„æ–‡æœ¬è¾“å‡ºã€‚ Spring Frameworkæœ‰ä¸€ä¸ªå†…ç½®çš„é›†æˆï¼Œå¯ä»¥å°†Spring MVCä¸FreeMarkeræ¨¡æ¿ç»“åˆä½¿ç”¨ã€‚</p><h5 id="è§†å›¾é…ç½®"><a href="#è§†å›¾é…ç½®" class="headerlink" title="è§†å›¾é…ç½®"></a>è§†å›¾é…ç½®</h5><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-view-freemarker-contextconfig">Same as in Spring WebFlux</a></p><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•å°†FreeMarkeré…ç½®ä¸ºè§†å›¾æŠ€æœ¯ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@EnableWebMvcpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span> &#123;<br>    <span class="hljs-meta">@Override</span>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">configureViewResolvers</span>(<span class="hljs-params">ViewResolverRegistry registry</span>) &#123;        registry.<span class="hljs-title function_">freemarker</span>();    &#125;<br>    <span class="hljs-comment">// Configure FreeMarker...</span><br>    <span class="hljs-meta">@Bean</span>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">FreeMarkerConfigurer</span> <span class="hljs-title function_">freeMarkerConfigurer</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-title class_">FreeMarkerConfigurer</span> configurer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FreeMarkerConfigurer</span>();        configurer.<span class="hljs-title function_">setTemplateLoaderPath</span>(<span class="hljs-string">&quot;/WEB-INF/freemarker&quot;</span>);        <span class="hljs-keyword">return</span> configurer;    &#125;&#125;<br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•åœ¨XMLä¸­é…ç½®ç›¸åŒçš„å†…å®¹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mvc:annotation-driven</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mvc:view-resolvers</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">mvc:freemarker</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mvc:view-resolvers</span>&gt;</span><br><span class="hljs-comment">&lt;!-- Configure FreeMarker... --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">mvc:freemarker-configurer</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">mvc:template-loader-path</span> <span class="hljs-attr">location</span>=<span class="hljs-string">&quot;/WEB-INF/freemarker&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mvc:freemarker-configurer</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æˆ–è€…ï¼Œæ‚¨ä¹Ÿå¯ä»¥å£°æ˜<code>FreeMarkerConfigurer</code> beanä»¥å®Œå…¨æ§åˆ¶æ‰€æœ‰å±æ€§ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs abnf">&lt;bean id<span class="hljs-operator">=</span><span class="hljs-string">&quot;freemarkerConfig&quot;</span> class<span class="hljs-operator">=</span><span class="hljs-string">&quot;org.springframework.web.servlet.view.freemarker.FreeMarkerConfigurer&quot;</span>&gt;<br><br>    &lt;property name<span class="hljs-operator">=</span><span class="hljs-string">&quot;templateLoaderPath&quot;</span> value<span class="hljs-operator">=</span><span class="hljs-string">&quot;/WEB-INF/freemarker/&quot;</span>/&gt;<br><br>&lt;/bean&gt;<br></code></pre></td></tr></table></figure><p>æ¨¡æ¿éœ€è¦å­˜å‚¨åœ¨ä¸Šé¢æ‰€ç¤ºçš„FreeMarkerConfigureræŒ‡å®šçš„ç›®å½•ä¸­ï¼Œæ ¹æ®å‰é¢çš„é…ç½®ï¼Œå¦‚æœæ‚¨çš„æ§åˆ¶å™¨è¿”å›<code>welcome</code>è§†å›¾åç§°ï¼Œè§£æå™¨å°†æŸ¥æ‰¾<code>/WEB-INF/freemarker/welcome.ftl</code>æ¨¡æ¿ã€‚</p><h5 id="FreeMarker-é…ç½®"><a href="#FreeMarker-é…ç½®" class="headerlink" title="FreeMarker é…ç½®"></a>FreeMarker é…ç½®</h5><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-views-freemarker">Same as in Spring WebFlux</a></p><p>é€šè¿‡è®¾ç½®<code>FreeMarkerConfigurer</code> beanå¯ä»¥å°†FreeMarkerçš„â€™Settingsâ€™ å’Œ â€˜SharedVariablesâ€™ å€¼ç›´æ¥ä¼ é€’Springç®¡ç†çš„FreeMarkerå¯¹è±¡ã€‚ <code>freemarkerSettings</code>å±æ€§éœ€è¦<code>java.util.Properties</code>å¯¹è±¡ã€‚ è€Œ<code>freemarkerVariables</code>å±æ€§éœ€è¦<code>java.util.Map</code>ã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf">&lt;bean id<span class="hljs-operator">=</span><span class="hljs-string">&quot;freemarkerConfig&quot;</span> class<span class="hljs-operator">=</span><span class="hljs-string">&quot;org.springframework.web.servlet.view.freemarker.FreeMarkerConfigurer&quot;</span>&gt;    &lt;property name<span class="hljs-operator">=</span><span class="hljs-string">&quot;templateLoaderPath&quot;</span> value<span class="hljs-operator">=</span><span class="hljs-string">&quot;/WEB-INF/freemarker/&quot;</span>/&gt;    &lt;property name<span class="hljs-operator">=</span><span class="hljs-string">&quot;freemarkerVariables&quot;</span>&gt;        &lt;map&gt;            &lt;entry key<span class="hljs-operator">=</span><span class="hljs-string">&quot;xml_escape&quot;</span> value-ref<span class="hljs-operator">=</span><span class="hljs-string">&quot;fmXmlEscape&quot;</span>/&gt;        &lt;/map&gt;    &lt;/property&gt;&lt;/bean&gt;<br>&lt;bean id<span class="hljs-operator">=</span><span class="hljs-string">&quot;fmXmlEscape&quot;</span> class<span class="hljs-operator">=</span><span class="hljs-string">&quot;freemarker.template.utility.XmlEscape&quot;</span>/&gt;<br></code></pre></td></tr></table></figure><p>æœ‰å…³æ›´å¤šçš„Configurationå†…å®¹çš„<code>è®¾ç½®</code>å’Œå˜é‡å¯ä»¥æŸ¥çœ‹FreeMarkeræ–‡æ¡£</p><h5 id="è¡¨å•å¤„ç†"><a href="#è¡¨å•å¤„ç†" class="headerlink" title="è¡¨å•å¤„ç†"></a>è¡¨å•å¤„ç†</h5><p>Springæœ¬èº«æä¾›äº†ç”¨äºJSPçš„æ ‡ç­¾åº“ï¼Œå…¶ä¸­åŒ…å«ï¼ˆå½“ç„¶è¿˜æœ‰å¾ˆå¤šï¼‰<code>&lt;spring:bind/&gt;</code>æ ‡ç­¾ï¼Œè¿™ä¸ªæ ‡ç­¾ç”¨æ¥å±•ç¤ºä»Webä¸Šçš„<code>éªŒè¯å™¨</code>æˆ–ä¸šåŠ¡å±‚æŠ›å‡ºçš„å¤±è´¥éªŒè¯è¡¨å•ã€‚ Springè¿˜æ”¯æŒFreeMarkerä¸­çš„ç›¸åŒåŠŸèƒ½ï¼Œå¹¶æä¾›äº†æ–¹ä¾¿çš„å®æ¥ç”Ÿæˆè¡¨å•è¾“å…¥å…ƒç´ ã€‚</p><h6 id="ç»‘å®šå®å‘½ä»¤"><a href="#ç»‘å®šå®å‘½ä»¤" class="headerlink" title="ç»‘å®šå®å‘½ä»¤"></a>ç»‘å®šå®å‘½ä»¤</h6><p><code>spring-webmvc.jar</code> åŒ…æ–‡ä»¶åŒ…å«Velocityå’ŒFreeMarkerçš„ä¸€ç»„æ ‡å‡†å®ï¼Œå› æ­¤ä¸¤è€…éƒ½é€‚ç”¨ã€‚</p><p>Springåº“ä¸­å®šä¹‰çš„æŸäº›å®è¢«è®¤ä¸ºæ˜¯å†…éƒ¨çš„(ç§æœ‰çš„ï¼‰ï¼Œä½†åœ¨å®å®šä¹‰ä¸­ä¸å­˜åœ¨è¿™æ ·çš„èŒƒå›´ï¼Œå…¶å®æ‰€æœ‰å®éƒ½å¯ä»¥åœ¨è°ƒç”¨ä»£ç å’Œç”¨æˆ·æ¨¡æ¿æ—¶çœ‹åˆ°ã€‚ä»¥ä¸‹å„èŠ‚ä»…é›†ä¸­äºéœ€è¦ä»æ¨¡æ¿ä¸­ç›´æ¥è°ƒç”¨çš„å®ï¼Œ å¦‚æœå¸Œæœ›ç›´æ¥æŸ¥çœ‹å®ä»£ç ï¼Œ é‚£ä¹ˆå¯ä»¥çœ‹æ–‡ä»¶<code>spring.ftl</code>ï¼Œå®šä¹‰åœ¨<code>org.springframework.web.servlet.view.freemarker</code>åŒ…ä¸­ã€‚</p><h6 id="ç®€å•çš„ç»‘å®š"><a href="#ç®€å•çš„ç»‘å®š" class="headerlink" title="ç®€å•çš„ç»‘å®š"></a>ç®€å•çš„ç»‘å®š</h6><p>HTMLè¡¨å•(vmæˆ–ftlæ¨¡æ¿),å……å½“äº†Spring MVCæ§åˆ¶å™¨çš„è¡¨å•è§†å›¾,å¯ä»¥ä½¿ç”¨ç±»ä¼¼ä¸‹é¢çš„ä»£ç ç»‘å®šå­—æ®µå€¼,ä¹Ÿå¯ä»¥ç±»ä¼¼JSPé‚£æ ·åœ¨æ¯ä¸ªè¾“å…¥å­—æ®µåé¢æ·»åŠ é”™è¯¯ä¿¡æ¯. ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†ä¹‹å‰é…ç½®çš„personFormè§†å›¾ï¼š</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml"><span class="hljs-comment">&lt;!-- freemarker macros have to be imported into a namespace. We strongly</span></span><br><span class="hljs-comment"><span class="language-xml"></span></span><br><span class="hljs-comment"><span class="language-xml">recommend sticking to &#x27;spring&#x27; --&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">&lt;#import &quot;/spring.ftl&quot; as spring/&gt;</span><br><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">    ...</span><br><span class="language-xml"></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;POST&quot;</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">        Name:</span><br><span class="language-xml"></span><br><span class="language-xml">        &lt;@spring.bind &quot;myModelObject.name&quot;/&gt;</span><br><span class="language-xml"></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml"></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;spring.status.expression&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml"></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;spring.status.value?html&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">        &lt;#list spring.status.errorMessages as error&gt; <span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;error&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span> &lt;/#list&gt;</span><br><span class="language-xml"></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">        ...</span><br><span class="language-xml"></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;submit&quot;</span>/&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">    ...</span><br><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p><code>&lt;@spring.bind&gt;</code>éœ€è¦ä¸€ä¸ªåŒ…å«å‘½ä»¤å¯¹è±¡çš„ â€˜pathâ€™ å‚æ•°ï¼ˆé»˜è®¤æ˜¯â€™commandâ€™,é™¤éåœ¨<code>FormController</code>å±æ€§ä¸­è¢«æ”¹å˜äº†ï¼‰ï¼Œåé¢è·Ÿç€å†™éœ€è¦ç»‘å®šåˆ°å‘½ä»¤å¯¹è±¡ä¸Šçš„å­—æ®µå. å¯ä»¥ä½¿ç”¨åµŒå¥—å­—æ®µ,ä¾‹å¦‚ <code>command.address.street</code>,ç»‘å®šå®å¯ä»¥åœ¨<code>web.xml</code>ä¸­è®¾ç½®ServletContextçš„å‚æ•°<code>defaultHtmlEscape</code>ï¼Œç”¨äºå®šä¹‰HTMLçš„è½¬ä¹‰è¡Œä¸ºã€‚</p><p><code>&lt;@spring.bindEscaped&gt;</code> å®å‘½ä»¤æ˜¯å¯é€‰çš„ï¼Œå®ƒæ¥æ”¶ç¬¬äºŒä¸ªå‚æ•°å¹¶æ˜¾å¼åœ°æŒ‡å®šæ˜¯å¦åº”åœ¨çŠ¶æ€é”™è¯¯æ¶ˆæ¯æˆ–å€¼ä¸­ä½¿ç”¨HTMLè½¬ä¹‰ã€‚æŒ‰éœ€è®¾ç½®ä¸º<code>true</code>æˆ–<code>false</code>ï¼Œè¿˜æœ‰å¾ˆå¤šå…¶å®ƒçš„å®ï¼Œå®ƒä»¬å°†åœ¨ä¸‹ä¸€èŠ‚ä¸­ä»‹ç»ã€‚</p><h6 id="è¾“å…¥å®å‘½ä»¤"><a href="#è¾“å…¥å®å‘½ä»¤" class="headerlink" title="è¾“å…¥å®å‘½ä»¤"></a>è¾“å…¥å®å‘½ä»¤</h6><p>Velocityå’ŒFreeMarkeréƒ½ä½¿ç”¨å®ç®€åŒ–äº†ç»‘å®šå’Œè¡¨å•çš„ç”Ÿæˆï¼ˆåŒ…æ‹¬éªŒè¯é”™è¯¯çš„æ˜¾ç¤ºï¼‰ï¼Œæ²¡æœ‰å¿…è¦ä½¿ç”¨è¿™äº›å®æ¥ç”Ÿæˆè¡¨å•è¾“å…¥å­—æ®µï¼Œå®é™…ä¸Šä»–ä»¬éƒ½å¯ä»¥ç›´æ¥ç»‘å®šåœ¨ç®€å•çš„HTMLä¸­ï¼Œå¹¶ä¸”å¯æ··åˆä½¿ç”¨ã€‚</p><p>ä¸‹è¡¨ä¸­çš„å¯ç”¨å®æ˜¾ç¤ºäº†FTLå®šä¹‰å’Œæ¯ä¸ªå‚æ•°åˆ—è¡¨ï¼š</p><p>Table 6. å®å‘½ä»¤å®šä¹‰è¡¨</p><table><thead><tr><th>å®å‘½ä»¤</th><th>FTL å®šä¹‰è¡¨</th></tr></thead><tbody><tr><td><code>message</code>ï¼ˆæ ¹æ®ä»£ç å‚æ•°ä»èµ„æºåŒ…ä¸­è¾“å‡ºå­—ç¬¦ä¸²ï¼‰</td><td>&lt;@spring.message code&#x2F;&gt;</td></tr><tr><td><code>messageText</code> ï¼ˆæ ¹æ®ä»£ç å‚æ•°ä»èµ„æºåŒ…ä¸­è¾“å‡ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¤±è´¥åˆ™ä½¿ç”¨é»˜è®¤å‚æ•°çš„å€¼ï¼‰</td><td>&lt;@spring.messageText code, text&#x2F;&gt;</td></tr><tr><td><code>url</code>ï¼ˆä½¿ç”¨åº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡æ ¹ä½œä¸ºç›¸å¯¹URLçš„å‰ç¼€ï¼‰</td><td>&lt;@spring.url relativeUrl&#x2F;&gt;</td></tr><tr><td><code>formInput</code> (æ ‡å‡†è¾“å…¥åŸŸç”¨æˆ·æ”¶é›†ç”¨æˆ·ä¿¡æ¯)</td><td>&lt;@spring.formInput path, attributes, fieldType&#x2F;&gt;</td></tr><tr><td><code>formHiddenInput</code> (ç”¨äºæäº¤è‚¥è¾“å…¥åŸŸçš„éšè—å­—æ®µ)</td><td>&lt;@spring.formHiddenInput path, attributes&#x2F;&gt;</td></tr><tr><td><code>formPasswordInput</code> (ç”¨æˆ·æ”¶é›†å¯†ç çš„æ ‡å‡†è¾“å…¥å­—æ®µï¼Œè¯·æ³¨æ„ï¼Œæ­¤ç±»å‹çš„å­—æ®µä¸­ä¸ä¼šå¡«å……ä»»ä½•å€¼)</td><td>&lt;@spring.formPasswordInput path, attributes&#x2F;&gt;</td></tr><tr><td><code>formTextarea</code> (å¤§æ–‡æœ¬åŸŸï¼Œç”¨äºæ”¶é›†å¤§è€Œè‡ªç”±çš„æ–‡æœ¬è¾“å…¥)</td><td>&lt;@spring.formTextarea path, attributes&#x2F;&gt;</td></tr><tr><td><code>formSingleSelect</code> (ä¸‹æ‹‰é€‰é¡¹æ¡†ï¼Œå¯ä»¥é€‰æ‹©ä¸€ä¸ªå¿…éœ€çš„å€¼)</td><td>&lt;@spring.formSingleSelect path, options, attributes&#x2F;&gt;</td></tr><tr><td><code>formMultiSelect</code> (ä¸€ä¸ªé€‰é¡¹åˆ—è¡¨æ¡†ï¼Œå…è®¸ç”¨æˆ·é€‰æ‹©0æˆ–æ›´å¤šå€¼)</td><td>&lt;@spring.formMultiSelect path, options, attributes&#x2F;&gt;</td></tr><tr><td><code>formRadioButtons</code> (å•é€‰æŒ‰é’®ï¼Œå¯ä»¥ä»å¯ç”¨é€‰é¡¹ä¸­è¿›è¡Œå•ä¸ªé€‰æ‹©)</td><td>&lt;@spring.formRadioButtons path, options separator, attributes&#x2F;&gt;</td></tr><tr><td><code>formCheckboxes</code> (ä¸€ç»„å…è®¸é€‰æ‹©0æˆ–æ›´å¤šå€¼çš„å¤é€‰æ¡†)</td><td>&lt;@spring.formCheckboxes path, options, separator, attributes&#x2F;&gt;</td></tr><tr><td><code>formCheckbox</code> (å•ä¸ªå¤é€‰æ¡†)</td><td>&lt;@spring.formCheckbox path, attributes&#x2F;&gt;</td></tr><tr><td><code>showErrors</code> (ç®€åŒ–ç»‘å®šå­—æ®µçš„éªŒè¯é”™è¯¯æ˜¾ç¤º)</td><td>&lt;@spring.showErrors separator, classOrStyle&#x2F;&gt;</td></tr></tbody></table><ul><li>åœ¨FTLï¼ˆFreeMarkerï¼‰ä¸­, <code>formHiddenInput</code> å’Œ <code>formPasswordInput</code> è¿™ä¸¤ä¸ªå®å®é™…ä¸Šå¹¶ä¸éœ€è¦ï¼Œå› ä¸ºå¯ä»¥ä½¿ç”¨æ™®é€šçš„ <code>formInput</code>å®ã€‚å°†<code>hidden</code> æˆ– <code>password</code>æŒ‡å®šä¸º<code>fieldType</code> å‚æ•°çš„å€¼</li></ul><p>ä¸Šè¿°ä»»ä½•å®çš„å‚æ•°éƒ½å…·æœ‰ä¸€è‡´çš„å«ä¹‰</p><ul><li><code>è·¯å¾„</code>: è¦ç»‘å®šåˆ°çš„å­—æ®µçš„åç§°ï¼ˆä¾‹å¦‚ â€œcommand.nameâ€ï¼‰</li><li><code>é€‰é¡¹</code>: å¯ä»è¾“å…¥å­—æ®µä¸­é€‰æ‹©çš„æ‰€æœ‰å¯ç”¨å€¼çš„æ˜ å°„ï¼Œmapçš„é”®è¡¨ç¤ºä»è¡¨å•POSTåå¾—åˆ°çš„å¯¹è±¡çš„å€¼ï¼ˆå·²ç»‘å®šçš„ï¼‰ï¼ŒMapå¯¹è±¡ä¿å­˜è¿™äº›é”®ç”¨äºè¿”å›å€¼åèƒ½åœ¨è¡¨å•ä¸Šæ˜¾ç¤ºå‡ºæ¥ã€‚ é€šå¸¸è¿™æ ·mapç”±æ§åˆ¶å™¨æä¾›æ•°æ®ï¼Œä»»ä½•mapéƒ½å¯ä»¥å®ç°æŒ‰éœ€ä½¿ç”¨ï¼Œå¯ä»¥ä½¿ç”¨<code>SortedMap</code>ï¼Œä¾‹å¦‚ <code>TreeMap</code>å’Œé€‚å½“çš„<code>Comparator</code>ä¸ºæ‰€æœ‰çš„å€¼æ’åºï¼Œä½¿ç”¨æ¥è‡ª<code>commons-collections</code>åŒ…ä¸­çš„ <code>LinkedHashMap</code> æˆ– <code>LinkedMap</code>ä¹Ÿæ˜¯ç›¸åŒçš„åŸç†ã€‚</li><li><code>åˆ†éš”ç¬¦</code>:å¤šä¸ªé€‰é¡¹å¯ä»¥ä½œä¸ºå…ƒç´ ï¼ˆå•é€‰æŒ‰é’®æˆ–å¤é€‰æ¡†ï¼‰å¯ä»¥ä½¿ç”¨æ ‡ç­¾å¯¹å­—ç¬¦åºåˆ—è¿›è¡Œåˆ†éš”ï¼ˆä¾‹å¦‚<code>&lt;br&gt;</code>ï¼‰ã€‚</li><li><code>å±æ€§</code>: HTMLæ ‡ç­¾æœ¬èº«ä¸­å¯ä»¥åŒ…å«ä»»æ„æ ‡ç­¾æˆ–æ–‡æœ¬çš„é™„åŠ å­—ç¬¦ä¸²ã€‚å­—ç¬¦ä¸²ä¸ä¸Šé¢çš„å®åˆ†åˆ«å¯¹åº”ï¼Œä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªæ–‡æœ¬å­—æ®µæä¾›å±æ€§â€™rows&#x3D;â€œ5â€ cols&#x3D;â€œ60â€œâ€˜å­—æ®µï¼Œ ä¹Ÿå¯ä»¥æ·»åŠ cssï¼Œä¾‹å¦‚â€™style&#x3D;â€œborder:1px solid silverâ€â€˜ã€‚</li><li><code>classOrStyle</code>: å¯¹äº<code>showErrors</code> å®, å¯ä»¥ä½¿ç”¨<code>span</code>æ ‡ç­¾åŒ…è£…æ¯ä¸ªé”™è¯¯çš„CSSç±»çš„åç§°ã€‚å¦‚æœæœªæä¾›ä»»ä½•ä¿¡æ¯ (æˆ–è¯¥å€¼ä¸ºç©ºï¼‰ï¼Œåˆ™é”™è¯¯å°†åŒ…å«åœ¨<code>&lt;b&gt;&lt;/b&gt;</code> æ ‡ç­¾ä¸­</li></ul><p>ä»¥ä¸‹éƒ¨åˆ†æ¦‚è¿°äº†å®çš„ç¤ºä¾‹ï¼ˆä¸€äº›åœ¨FTLä¸­ï¼Œä¸€äº›åœ¨VTLä¸­ï¼‰ã€‚ å¦‚æœä¸¤ç§è¯­è¨€ä¹‹é—´å­˜åœ¨ä½¿ç”¨å·®å¼‚ï¼Œåˆ™ä¼šåœ¨è¯´æ˜ä¸­å¯¹å…¶è¿›è¡Œè¯´æ˜ã€‚</p><p>è¾“å…¥åŸŸ</p><p><code>formInput</code>å®é‡‡ç”¨ <code>path</code> å‚æ•°ï¼ˆ<code>command.name</code>ï¼‰å’Œé™„åŠ å±æ€§å‚æ•°ï¼ˆåœ¨ä¸‹ä¸€ä¸ªç¤ºä¾‹ä¸­ä¸ºç©ºï¼‰ã€‚å®ä¸æ‰€æœ‰å…¶ä»–è¡¨å•ç”Ÿæˆå®ä¸€èµ·åœ¨pathå‚æ•°ä¸Šæ‰§è¡Œéšå¼Springç»‘å®šã€‚åœ¨å‡ºç°æ–°ç»‘å®šä¹‹å‰ï¼Œ å‰ä¸€ä¸ªç»‘å®šä»ç„¶æœ‰æ•ˆï¼Œå› æ­¤<code>showErrors</code> å®ä¸éœ€è¦å†æ¬¡ä¼ é€’pathå‚æ•°ï¼Œå®ƒåªå¯¹ä¸Šæ¬¡ä¸ºå…¶åˆ›å»ºç»‘å®šçš„ä»»ä½•å­—æ®µè¿›è¡Œæ“ä½œã€‚</p><p><code>showErrors</code>å®é‡‡ç”¨åˆ†éš”ç¬¦å‚æ•°(å°†ç”¨äºåˆ†éš”ç»™å®šå­—æ®µä¸Šçš„å¤šä¸ªé”™è¯¯çš„å­—ç¬¦ï¼ŒåŒæ—¶è¿˜æ¥å—ç¬¬äºŒä¸ªå‚æ•°ï¼šç±»åæˆ–æ ·å¼å±æ€§ã€‚è¯·æ³¨æ„ï¼ŒFreeMarkerèƒ½å¤Ÿä¸ºå±æ€§å‚æ•°æŒ‡å®šé»˜è®¤å€¼ï¼Œè¿™ä¸Velocityä¸åŒï¼Œ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•ä½¿ç”¨ <code>formInput</code>å’Œ <code>showWErrors</code>å®ï¼šï¼š</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs aspectj">&lt;<span class="hljs-meta">@spring</span>.formInput <span class="hljs-string">&quot;command.name&quot;</span>/&gt;<br><br>&lt;<span class="hljs-meta">@spring</span>.showErrors <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>/&gt;<br></code></pre></td></tr></table></figure><p>ä¸‹ä¸€ä¸ªç¤ºä¾‹æ˜¾ç¤ºè¡¨å•ç‰‡æ®µçš„è¾“å‡ºï¼Œç”Ÿæˆåç§°å­—æ®µå¹¶åœ¨æäº¤è¡¨å•ååœ¨å­—æ®µä¸­æ²¡æœ‰å€¼æ—¶æ˜¾ç¤ºéªŒè¯é”™è¯¯ã€‚ éªŒè¯é€šè¿‡Springçš„éªŒè¯æ¡†æ¶è¿›è¡Œã€‚</p><p>ç”Ÿæˆçš„HTMLç±»ä¼¼äºä»¥ä¸‹ç¤ºä¾‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml">Name:<br><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>required<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><br></code></pre></td></tr></table></figure><p><code>formTextarea</code> å®ç±»ä¼¼äº<code>formInput</code>å®ï¼Œè¿æ¥æ”¶çš„å‚æ•°éƒ½æ˜¯ç›¸åŒçš„ã€‚é€šå¸¸ï¼Œç¬¬äºŒä¸ªå‚æ•°ï¼ˆå±æ€§ï¼‰å°†è¢«ä½¿ç”¨ç”¨äºä¼ é€’æ ¼å¼ä¿¡æ¯æˆ–<code>rows</code>å’Œ<code>cols</code> çš„å±æ€§ã€‚</p><p>é€‰æ‹©å­—æ®µ</p><p>æœ‰å››ä¸ªå­—æ®µå®å¯ä»¥ç”¨äºç”Ÿäº§HTMLè¡¨å•ä¸­çš„å…¬å…±UIå€¼ä½œä¸ºé€‰æ‹©çš„è¾“å…¥ï¼š</p><ul><li><code>formSingleSelect</code></li><li><code>formMultiSelect</code></li><li><code>formRadioButtons</code></li><li><code>formCheckboxes</code></li></ul><p>è¿™å››ä¸ªå®éƒ½å¯ä»¥ä»è¡¨å•å­—æ®µä¸­æ¥æ”¶<code>Map</code>ï¼Œå…¶å®éœ€è¦çš„å°±æ˜¯æ ‡ç­¾çš„å€¼ã€‚å½“ç„¶å€¼å’Œæ ‡ç­¾æ˜¯å¯ä»¥å–ç›¸åŒçš„åã€‚</p><p>ä¸‹ä¸€ä¸ªä¾‹å­æ˜¯FTLä¸­çš„å•é€‰æŒ‰é’®ã€‚è¡¨å•ä½¿ç”¨â€™Londonâ€™ä½œä¸ºè¿™ä¸ªå­—æ®µçš„é»˜è®¤å€¼ï¼Œå› æ­¤ä¸éœ€ç”¨è¿›è¡ŒéªŒè¯ã€‚å½“æ¸²æŸ“è¡¨å•æ—¶ï¼Œè¦é€‰æ‹©çš„æ•´ä¸ªåŸå¸‚åˆ—è¡¨éƒ½åœ¨â€™cityMapâ€™ä¸­ï¼ŒcityMapæ˜¯æ•°æ®æ¨¡å‹ã€‚ä»¥ä¸‹æ¸…å•æ˜¾ç¤ºäº†è¯¥ç¤ºä¾‹ï¼š</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs llvm">...<br><br>Town:<br><br>&lt;<span class="hljs-title">@spring.formRadioButtons</span> <span class="hljs-string">&quot;command.address.town&quot;</span><span class="hljs-punctuation">,</span> cityMap<span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;&quot;</span>/&gt;&lt;<span class="hljs-keyword">br</span>&gt;&lt;<span class="hljs-keyword">br</span>&gt;<br></code></pre></td></tr></table></figure><p>å‰é¢çš„åˆ—è¡¨å‘ˆç°ä¸€è¡Œå•é€‰æŒ‰é’®ï¼Œä¸€ä¸ªç”¨äº<code>cityMap</code>ä¸­çš„æ¯ä¸ªå€¼ï¼Œå¹¶ä½¿ç”¨åˆ†éš”ç¬¦<code>&quot;&quot;</code>ã€‚æ²¡æœ‰æä¾›å…¶ä»–å±æ€§ï¼ˆç¼ºå°‘å®çš„æœ€åä¸€ä¸ªå‚æ•°ï¼‰ã€‚cityMapå¯¹Mapä¸­çš„æ¯ä¸ªé”®å€¼å¯¹ä½¿ç”¨ç›¸åŒçš„<code>String</code>ã€‚ æ˜ å°„çš„é”®æ˜¯è¡¨å•å®é™…æäº¤ä¸ºPOSTedè¯·æ±‚å‚æ•°çš„é”®ã€‚ mapå€¼æ˜¯ç”¨æˆ·çœ‹åˆ°çš„æ ‡ç­¾ã€‚ åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œç»™å®šä¸€ä¸ªåŒ…å«ä¸‰ä¸ªä¼—æ‰€å‘¨çŸ¥çš„åŸå¸‚çš„åˆ—è¡¨ä»¥åŠè¡¨å•æ”¯æŒå¯¹è±¡ä¸­çš„é»˜è®¤å€¼ï¼ŒHTMLç±»ä¼¼äºä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs lua">Town:<br><br>&lt;<span class="hljs-built_in">input</span> <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;radio&quot;</span> name=<span class="hljs-string">&quot;address.town&quot;</span> value=<span class="hljs-string">&quot;London&quot;</span>&gt;London&lt;/<span class="hljs-built_in">input</span>&gt;<br><br>&lt;<span class="hljs-built_in">input</span> <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;radio&quot;</span> name=<span class="hljs-string">&quot;address.town&quot;</span> value=<span class="hljs-string">&quot;Paris&quot;</span> checked=<span class="hljs-string">&quot;checked&quot;</span>&gt;Paris&lt;/<span class="hljs-built_in">input</span>&gt;<br><br>&lt;<span class="hljs-built_in">input</span> <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;radio&quot;</span> name=<span class="hljs-string">&quot;address.town&quot;</span> value=<span class="hljs-string">&quot;New York&quot;</span>&gt;New York&lt;/<span class="hljs-built_in">input</span>&gt;<br></code></pre></td></tr></table></figure><p>å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºå¸Œæœ›é€šè¿‡å†…éƒ¨ä»£ç æ¥å¤„ç†åŸå¸‚ï¼Œå¯ä»¥å†™ä¸€ä¸ªnameä¸ºcityMapçš„Mapä¼ é€’ç»™æ¨¡æ¿ï¼Œå¦‚ä¸‹é¢çš„ä¾‹å­ï¼š</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs lasso"><span class="hljs-keyword">protected</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">String</span>&gt; referenceData(HttpServletRequest request) throws Exception &#123;    <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">String</span>&gt; cityMap = <span class="hljs-literal">new</span> LinkedHashMap&lt;&gt;();    cityMap.put(<span class="hljs-string">&quot;LDN&quot;</span>, <span class="hljs-string">&quot;London&quot;</span>);    cityMap.put(<span class="hljs-string">&quot;PRS&quot;</span>, <span class="hljs-string">&quot;Paris&quot;</span>);    cityMap.put(<span class="hljs-string">&quot;NYC&quot;</span>, <span class="hljs-string">&quot;New York&quot;</span>);<br>    <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">String</span>&gt; model = <span class="hljs-literal">new</span> HashMap&lt;&gt;();    model.put(<span class="hljs-string">&quot;cityMap&quot;</span>, cityMap);    <span class="hljs-keyword">return</span> model;&#125;<br></code></pre></td></tr></table></figure><p>ä»£ç å°†æŒ‰ä½ çš„è®¾ç½®è¾“å‡ºï¼Œå¯ä»¥çœ‹åˆ°æ›´å¤šçš„åŸå¸‚åå­—ã€‚</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs lua">Town:<br><br>&lt;<span class="hljs-built_in">input</span> <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;radio&quot;</span> name=<span class="hljs-string">&quot;address.town&quot;</span> value=<span class="hljs-string">&quot;LDN&quot;</span>&gt;London&lt;/<span class="hljs-built_in">input</span>&gt;<br><br>&lt;<span class="hljs-built_in">input</span> <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;radio&quot;</span> name=<span class="hljs-string">&quot;address.town&quot;</span> value=<span class="hljs-string">&quot;PRS&quot;</span> checked=<span class="hljs-string">&quot;checked&quot;</span>&gt;Paris&lt;/<span class="hljs-built_in">input</span>&gt;<br><br>&lt;<span class="hljs-built_in">input</span> <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;radio&quot;</span> name=<span class="hljs-string">&quot;address.town&quot;</span> value=<span class="hljs-string">&quot;NYC&quot;</span>&gt;New York&lt;/<span class="hljs-built_in">input</span>&gt;<br></code></pre></td></tr></table></figure><h6 id="HTML-è½¬ä¹‰"><a href="#HTML-è½¬ä¹‰" class="headerlink" title="HTML è½¬ä¹‰"></a>HTML è½¬ä¹‰</h6><p>ç”±äºHTMLçš„ç‰ˆæœ¬é—®é¢˜ï¼Œä¸Šé¢çš„è¡¨å•å®åœ¨HTMLçš„4.01ç‰ˆæœ¬ä¸­éœ€è¦ä½¿ç”¨åˆ°è½¬ä¹‰ï¼Œè½¬ä¹‰å¯ä»¥åœ¨<code>web.xml</code>ä¸­é€šè¿‡Springçš„ç»‘å®šæ¥å®šä¹‰ã€‚ä¸ºäº†ä½¿æ ‡ç­¾éµå®ˆXHTMLçš„è§„å®šä»¥åŠè¦†ç›–é»˜è®¤çš„HTMLè½¬ä¹‰å€¼ï¼Œ å¯ä»¥åœ¨æ¨¡æ¿ä¸­å®šä¹‰ä¸¤ä¸ªå˜é‡ï¼ˆæˆ–è€…ä½¿ä½ çš„æ¨¡å‹è®¾ç½®ä¸ºæ¨¡æ¿å¯è§å½¢å¼ï¼‰ã€‚åœ¨æ¨¡æ¿ä¸­æŒ‡å®šçš„ä¼˜ç‚¹æ˜¯ï¼šå®ƒä»¬å¯ä»¥åœ¨æ¨¡æ¿å¤„ç†åæ›´æ”¹ä¸ºä¸åŒçš„å€¼ï¼Œä»¥ä¾¿ä¸ºè¡¨å•ä¸­çš„ä¸åŒå­—æ®µæä¾›ä¸åŒçš„è¡Œä¸ºã€‚</p><p>è¦åˆ‡æ¢ä¸ºæ ‡è®°çš„XHTMLåˆè§„æ€§ï¼Œè¯·ä¸ºåä¸º<code>xhtmlCompliant</code>çš„æ¨¡å‹æˆ–ä¸Šä¸‹æ–‡å˜é‡æŒ‡å®šå€¼<code>true</code> ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs clean">&lt;#-- for FreeMarker --&gt;<br><br>&lt;#assign xhtmlCompliant = true&gt;<br></code></pre></td></tr></table></figure><p>å¤„ç†å®Œè¯¥æŒ‡ä»¤åï¼ŒSpringå®ç”Ÿæˆçš„ä»»ä½•å…ƒç´ ç°åœ¨éƒ½ç¬¦åˆXHTMLæ ‡å‡†ã€‚</p><p>ä»¥ç±»ä¼¼çš„æ–¹å¼ï¼Œæ‚¨å¯ä»¥æŒ‡å®šæ¯ä¸ªå­—æ®µçš„HTMLè½¬ä¹‰ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xl">&lt;#-- <span class="hljs-function"><span class="hljs-title">until</span> this point, default HTML escaping <span class="hljs-keyword">is</span> used --&gt;</span><br>&lt;#<span class="hljs-function"><span class="hljs-title">assign</span> htmlEscape = <span class="hljs-literal">true</span>&gt;&lt;#-- next field will use HTML escaping --&gt;</span>&lt;@spring.formInput <span class="hljs-string">&quot;command.name&quot;</span>/&gt;<br>&lt;#<span class="hljs-function"><span class="hljs-title">assign</span> htmlEscape = <span class="hljs-literal">false</span> <span class="hljs-built_in">in</span> spring&gt;&lt;#-- all future fields will be bound <span class="hljs-keyword">with</span> HTML escaping off --&gt;</span><br></code></pre></td></tr></table></figure><h4 id="1-9-3-Groovy-Markup"><a href="#1-9-3-Groovy-Markup" class="headerlink" title="1.9.3. Groovy Markup"></a>1.9.3. Groovy Markup</h4><p><a href="http://groovy-lang.org/templating.html#_the_markuptemplateengine">Groovyæ ‡è®°æ¨¡æ¿å¼•æ“</a>ä¸»è¦ç”¨äºç”Ÿæˆç±»ä¼¼XMLçš„æ ‡è®°ï¼ˆXMLï¼ŒXHTMLï¼ŒHTML5ç­‰ï¼‰ï¼Œä½†æ‚¨å¯ä»¥ä½¿ç”¨å®ƒæ¥ç”Ÿæˆä»»ä½•åŸºäºæ–‡æœ¬çš„å†…å®¹ã€‚ Spring Frameworkæœ‰ä¸€ä¸ªå†…ç½®çš„é›†æˆï¼Œå¯ä»¥å°†Spring MVCä¸Groovy Markupç»“åˆä½¿ç”¨ã€‚</p><p>ç›®å‰è¦æ±‚ä½¿ç”¨Groovy 2.3.1+çš„ç‰ˆæœ¬.</p><h5 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h5><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•é…ç½®Groovyæ ‡è®°æ¨¡æ¿å¼•æ“ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@EnableWebMvcpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span> &#123;<br>    <span class="hljs-meta">@Override</span>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">configureViewResolvers</span>(<span class="hljs-params">ViewResolverRegistry registry</span>) &#123;        registry.<span class="hljs-title function_">groovy</span>();    &#125;<br>    <span class="hljs-comment">// Configure the Groovy Markup Template Engine...</span><br>    <span class="hljs-meta">@Bean</span>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">GroovyMarkupConfigurer</span> <span class="hljs-title function_">groovyMarkupConfigurer</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-title class_">GroovyMarkupConfigurer</span> configurer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GroovyMarkupConfigurer</span>();        configurer.<span class="hljs-title function_">setResourceLoaderPath</span>(<span class="hljs-string">&quot;/WEB-INF/&quot;</span>);        <span class="hljs-keyword">return</span> configurer;    &#125;&#125;<br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•åœ¨XMLä¸­é…ç½®ç›¸åŒçš„å†…å®¹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mvc:annotation-driven</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mvc:view-resolvers</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">mvc:groovy</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mvc:view-resolvers</span>&gt;</span><br><span class="hljs-comment">&lt;!-- Configure the Groovy Markup Template Engine... --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">mvc:groovy-configurer</span> <span class="hljs-attr">resource-loader-path</span>=<span class="hljs-string">&quot;/WEB-INF/&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><h5 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h5><p>ä¸ä¼ ç»Ÿçš„æ¨¡æ¿å¼•æ“ä¸åŒï¼ŒGroovyæ˜¯ä¾èµ–äºä½¿ç”¨ç”Ÿæˆå™¨è¯­æ³•çš„DSLã€‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†HTMLé¡µé¢çš„ç¤ºä¾‹æ¨¡æ¿ï¼š</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-variable">yieldUnescaped</span> <span class="hljs-string">&#x27;&lt;!DOCTYPE html&gt;&#x27;</span><br><br><span class="hljs-function"><span class="hljs-title">html</span>(<span class="hljs-variable">lang</span>:<span class="hljs-string">&#x27;en&#x27;</span>) &#123;</span><br><span class="hljs-function"></span><br><span class="hljs-function">    <span class="hljs-variable">head</span> &#123;</span><br><span class="hljs-function"></span><br><span class="hljs-function">        <span class="hljs-title">meta</span>(<span class="hljs-string">&#x27;http-equiv&#x27;</span>:<span class="hljs-string">&#x27;&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;&#x27;</span>)</span><br><br>        <span class="hljs-function"><span class="hljs-title">title</span>(<span class="hljs-string">&#x27;My page&#x27;</span>)</span><br><br>    &#125;<br><br>    <span class="hljs-variable">body</span> &#123;<br><br>        <span class="hljs-function"><span class="hljs-title">p</span>(<span class="hljs-string">&#x27;This is an example of HTML contents&#x27;</span>)</span><br><br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="1-9-4-è„šæœ¬è§†å›¾"><a href="#1-9-4-è„šæœ¬è§†å›¾" class="headerlink" title="1.9.4. è„šæœ¬è§†å›¾"></a>1.9.4. è„šæœ¬è§†å›¾</h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-view-script">Same as in Spring WebFlux</a></p><p>Spring Frameworkæœ‰ä¸€ä¸ªå†…ç½®çš„é›†æˆï¼Œå¯ä»¥å°†Spring MVCä¸ä»»ä½•å¯ä»¥åœ¨<a href="https://www.jcp.org/en/jsr/detail?id=223">JSR-223</a> Javaè„šæœ¬å¼•æ“ä¹‹ä¸Šè¿è¡Œçš„æ¨¡æ¿åº“ä¸€èµ·ä½¿ç”¨ã€‚ æˆ‘ä»¬åœ¨ä¸åŒçš„è„šæœ¬å¼•æ“ä¸Šæµ‹è¯•äº†ä»¥ä¸‹æ¨¡æ¿åº“ï¼š:</p><p>Scripting Library</p><p>Scripting Engine</p><p><a href="http://handlebarsjs.com/">Handlebars</a></p><p><a href="http://openjdk.java.net/projects/nashorn/">Nashorn</a></p><p><a href="https://mustache.github.io/">Mustache</a></p><p><a href="http://openjdk.java.net/projects/nashorn/">Nashorn</a></p><p><a href="https://facebook.github.io/react/">React</a></p><p><a href="http://openjdk.java.net/projects/nashorn/">Nashorn</a></p><p><a href="http://www.embeddedjs.com/">EJS</a></p><p><a href="http://openjdk.java.net/projects/nashorn/">Nashorn</a></p><p><a href="http://www.stuartellis.eu/articles/erb/">ERB</a></p><p><a href="http://jruby.org/">JRuby</a></p><p><a href="https://docs.python.org/2/library/string.html#template-strings">String templates</a></p><p><a href="http://www.jython.org/">Jython</a></p><p><a href="https://github.com/sdeleuze/kotlin-script-templating">Kotlin Script templating</a></p><p><a href="https://kotlinlang.org/">Kotlin</a></p><p>é›†æˆä»»ä½•å…¶ä»–è„šæœ¬å¼•æ“çš„åŸºæœ¬è§„åˆ™æ˜¯å®ƒå¿…é¡»å®ç°<code>ScriptEngine</code> å’Œ<code>Invocable</code> æ¥å£ã€‚</p><h5 id="è¦æ±‚"><a href="#è¦æ±‚" class="headerlink" title="è¦æ±‚"></a>è¦æ±‚</h5><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-view-script-dependencies">Same as in Spring WebFlux</a></p><p>æ‚¨éœ€è¦åœ¨ç±»è·¯å¾„ä¸Šå®‰è£…è„šæœ¬å¼•æ“ï¼Œå…¶è¯¦ç»†ä¿¡æ¯å› è„šæœ¬å¼•æ“è€Œå¼‚:</p><ul><li>The <a href="http://openjdk.java.net/projects/nashorn/">Nashorn</a> Javascriptå¼•æ“æä¾›äº†å†…ç½®çš„Java 8+ã€‚å¼ºçƒˆå»ºè®®ä½¿ç”¨æœ€æ–°çš„å¯ç”¨æ›´æ–°ç‰ˆæœ¬ã€‚</li><li>ä¸ºäº†è·å¾—<a href="http://jruby.org/">JRuby</a> æ”¯æŒï¼Œåº”æ·»åŠ JRubyä¾èµ–æ€§</li><li>ä¸ºäº†è·å¾—<a href="http://www.jython.org/">Jython</a>æ”¯æŒï¼Œåº”æ·»åŠ Jythonä¾èµ–æ€§ã€‚</li><li><code>org.jetbrains.kotlin:kotlin-script-util</code>ä¾èµ–é¡¹å’ŒåŒ…å«åœ¨ <code>META-INF/services/javax.script.ScriptEngineFactory</code>æ–‡ä»¶é‡Œçš„<code>org.jetbrains.kotlin.script.jsr223.KotlinJsr223JvmLocalScriptEngineFactory</code>è¡Œåº”æ·»åŠ åˆ°Kotlinè„šæœ¬æ”¯æŒä¸­ã€‚ æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://github.com/sdeleuze/kotlin-script-templating">æ­¤ç¤ºä¾‹</a>ã€‚</li></ul><p>è¿˜éœ€è¦ä¸ºåŸºäºè„šæœ¬çš„æ¨¡æ¿å¼•æ“æ·»åŠ ä¾èµ–é¡¹ã€‚ä¾‹å¦‚ï¼Œå¯¹äºjavascriptï¼Œå¯ä»¥ä½¿ç”¨<a href="http://www.webjars.org/">WebJars</a>ã€‚</p><h5 id="è„šæœ¬æ¨¡æ¿"><a href="#è„šæœ¬æ¨¡æ¿" class="headerlink" title="è„šæœ¬æ¨¡æ¿"></a>è„šæœ¬æ¨¡æ¿</h5><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-script-integrate">Same as in Spring WebFlux</a></p><p>æ‚¨å¯ä»¥å£°æ˜<code>ScriptTemplateConfigurer</code>beanä»¥æŒ‡å®šè¦ä½¿ç”¨çš„è„šæœ¬å¼•æ“ï¼Œè¦åŠ è½½çš„è„šæœ¬æ–‡ä»¶ï¼Œè¦è°ƒç”¨ä»¥å‘ˆç°æ¨¡æ¿çš„å‡½æ•°ï¼Œç­‰ç­‰ã€‚ ä»¥ä¸‹ç¤ºä¾‹ä½¿ç”¨Mustacheæ¨¡æ¿å’ŒNashorn JavaScriptå¼•æ“ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@EnableWebMvcpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span> &#123;<br>    <span class="hljs-meta">@Override</span>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">configureViewResolvers</span>(<span class="hljs-params">ViewResolverRegistry registry</span>) &#123;        registry.<span class="hljs-title function_">scriptTemplate</span>();    &#125;<br>    <span class="hljs-meta">@Bean</span>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">ScriptTemplateConfigurer</span> <span class="hljs-title function_">configurer</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-title class_">ScriptTemplateConfigurer</span> configurer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ScriptTemplateConfigurer</span>();        configurer.<span class="hljs-title function_">setEngineName</span>(<span class="hljs-string">&quot;nashorn&quot;</span>);        configurer.<span class="hljs-title function_">setScripts</span>(<span class="hljs-string">&quot;mustache.js&quot;</span>);        configurer.<span class="hljs-title function_">setRenderObject</span>(<span class="hljs-string">&quot;Mustache&quot;</span>);        configurer.<span class="hljs-title function_">setRenderFunction</span>(<span class="hljs-string">&quot;render&quot;</span>);        <span class="hljs-keyword">return</span> configurer;    &#125;&#125;<br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†XMLä¸­çš„ç›¸åŒæ’åˆ—ï¼š:</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">&lt;mvc:annotation-driven/&gt;<br>&lt;mvc:<span class="hljs-keyword">view</span>-resolvers&gt;    &lt;mvc:script-<span class="hljs-keyword">template</span>/&gt;&lt;/mvc:<span class="hljs-keyword">view</span>-resolvers&gt;<br>&lt;mvc:script-<span class="hljs-keyword">template</span>-configurer engine-<span class="hljs-type">name</span>=&quot;nashorn&quot; render-<span class="hljs-keyword">object</span>=&quot;Mustache&quot; render-<span class="hljs-keyword">function</span>=&quot;render&quot;&gt;    &lt;mvc:script <span class="hljs-keyword">location</span>=&quot;mustache.js&quot;/&gt;&lt;/mvc:script-<span class="hljs-keyword">template</span>-configurer&gt;<br></code></pre></td></tr></table></figure><p>å¯¹äºJavaå’ŒXMLé…ç½®ï¼Œæ§åˆ¶å™¨çœ‹èµ·æ¥æ²¡æœ‰ä»€ä¹ˆä¸åŒï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@Controllerpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SampleController</span> &#123;<br>    <span class="hljs-meta">@GetMapping(<span class="hljs-string">&quot;/sample&quot;</span>)</span>    <span class="hljs-keyword">public</span> String test(Model model) &#123;        model.addObject(<span class="hljs-string">&quot;title&quot;</span>, <span class="hljs-string">&quot;Sample title&quot;</span>);        model.addObject(<span class="hljs-string">&quot;body&quot;</span>, <span class="hljs-string">&quot;Sample body&quot;</span>);        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;template&quot;</span>;    &#125;&#125;<br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†Mustacheæ¨¡æ¿ï¼š</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">title</span>&#125;&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">body</span>&#125;&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ä»¥ä¸‹å‚æ•°è°ƒç”¨renderå‡½æ•°ï¼š</p><ul><li><code>String template</code>: æ¨¡æ¿å†…å®¹</li><li><code>Map model</code>: è§†å›¾æ¨¡å‹</li><li><code>RenderingContext renderingContext</code>: <a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/web/servlet/view/script/RenderingContext.html"><code>RenderingContext</code></a>ï¼Œæä¾›å¯¹åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ï¼ŒåŒºåŸŸè®¾ç½®ï¼Œæ¨¡æ¿åŠ è½½å™¨å’ŒURLçš„è®¿é—®ï¼ˆè‡ª5.0èµ·ï¼‰ã€‚</li></ul><p><code>Mustache.render()</code> æ–¹æ³•ä¼šä¸æœ¬åœ°å…¼å®¹ï¼Œå› æ­¤å¯ä»¥ç›´æ¥è°ƒç”¨ã€‚</p><p>å¦‚æœæ¨¡æ¿åŒ–æŠ€æœ¯éœ€è¦è‡ªå®šä¹‰ï¼Œåˆ™å¯ä»¥æä¾›å®ç°è‡ªå®šä¹‰æ¸²æŸ“å‡½æ•°çš„è„šæœ¬ã€‚ä¾‹å¦‚ï¼Œ<a href="http://handlebarsjs.com/">Handlerbars</a>éœ€è¦åœ¨ä½¿ç”¨æ¨¡æ¿ä¹‹å‰è¿›è¡Œç¼–è¯‘ï¼Œå¹¶ä¸”éœ€è¦ä½¿ç”¨ <a href="https://en.wikipedia.org/wiki/Polyfill">polyfill</a>ä»¥æ¨¡æ‹ŸæœåŠ¡å™¨ç«¯è„šæœ¬å¼•æ“ä¸­ä¸å¯ç”¨çš„æŸäº›æµè§ˆå™¨åŠŸèƒ½ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@EnableWebMvcpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span> &#123;<br>    <span class="hljs-meta">@Override</span>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">configureViewResolvers</span>(<span class="hljs-params">ViewResolverRegistry registry</span>) &#123;        registry.<span class="hljs-title function_">scriptTemplate</span>();    &#125;<br>    <span class="hljs-meta">@Bean</span>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">ScriptTemplateConfigurer</span> <span class="hljs-title function_">configurer</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-title class_">ScriptTemplateConfigurer</span> configurer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ScriptTemplateConfigurer</span>();        configurer.<span class="hljs-title function_">setEngineName</span>(<span class="hljs-string">&quot;nashorn&quot;</span>);        configurer.<span class="hljs-title function_">setScripts</span>(<span class="hljs-string">&quot;polyfill.js&quot;</span>, <span class="hljs-string">&quot;handlebars.js&quot;</span>, <span class="hljs-string">&quot;render.js&quot;</span>);        configurer.<span class="hljs-title function_">setRenderFunction</span>(<span class="hljs-string">&quot;render&quot;</span>);        configurer.<span class="hljs-title function_">setSharedEngine</span>(<span class="hljs-literal">false</span>);        <span class="hljs-keyword">return</span> configurer;    &#125;&#125;<br></code></pre></td></tr></table></figure><p>å½“è¦æ±‚éçº¿ç¨‹å®‰å…¨åœ°ä½¿ç”¨è„šæœ¬å¼•æ“æ—¶ï¼Œéœ€è¦å°†<code>sharedEngine</code>çš„å±æ€§è®¾ç½®ä¸º <code>false</code> ï¼Œå› ä¸ºæ¨¡æ¿åº“ä¸æ˜¯ä¸ºäº†å¹¶å‘è€Œè®¾è®¡çš„ï¼Œå…·ä½“å¯ä»¥çœ‹è¿è¡Œåœ¨Nashornä¸Šçš„Handlerbarsæˆ–reactã€‚æ®æ­¤ï¼Œéœ€è¦Java 8u60+çš„ç‰ˆæœ¬æ¥ä¿®å¤è¿™ä¸ª <a href="https://bugs.openjdk.java.net/browse/JDK-8076099">bug</a>ã€‚</p><p><code>polyfill.js</code> åªéœ€å®šä¹‰ä¸€ä¸ªwindowå¯¹è±¡ï¼Œå°±å¯ä»¥è¢«Handlerbarsè¿è¡Œï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">var window <span class="hljs-operator">=</span> &#123;&#125;<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>è„šæœ¬<code>render.js</code>ä¼šåœ¨ä½¿ç”¨è¯¥æ¨¡æ¿ä¹‹å‰è¢«ç¼–è¯‘ï¼Œä¸€ä¸ªå¥½çš„äº§å“åº”å½“ä¿å­˜å’Œé‡ç”¨æ¨¡æ¿ï¼ˆä½¿ç”¨ç¼“å­˜çš„æ–¹æ³•ï¼‰ï¼Œè¿™æ ·é«˜æ•ˆäº›ã€‚è¿™å¯ä»¥åœ¨è„šæœ¬ä¸­å®Œæˆï¼Œå¹¶ä¸”å¯ä»¥è‡ªå®šä¹‰å®ƒ(ä¾‹å¦‚ç®¡ç†æ¨¡æ¿å¼•æ“é…ç½®ã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œï¼š</p><figure class="highlight wren"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs wren"><span class="hljs-variable">function</span> <span class="hljs-title function_">render</span>(<span class="hljs-params">template</span>, <span class="hljs-params">model</span>) &#123;<br><br>    <span class="hljs-keyword">var</span> <span class="hljs-variable">compiledTemplate</span> <span class="hljs-operator">=</span> <span class="hljs-title class_">Handlebars</span>.<span class="hljs-property">compile</span>(<span class="hljs-variable">template</span>);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">compiledTemplate</span>(<span class="hljs-variable">model</span>);<br><br>&#125;<br></code></pre></td></tr></table></figure><p>æœ‰å…³æ›´å¤šé…ç½®ç¤ºä¾‹ï¼Œè¯·æŸ¥çœ‹Spring Frameworkå•å…ƒæµ‹è¯•ï¼Œ<a href="https://github.com/spring-projects/spring-framework/tree/master/spring-webmvc/src/test/java/org/springframework/web/servlet/view/script">Java</a>å’Œ<a href="https://github.com/spring-projects/spring-framework/tree/master/spring-webmvc/src/test/resources/org/springframework/web/servlet/view/script">resources</a>ã€‚</p><h4 id="1-9-5-JSP-å’Œ-JSTL"><a href="#1-9-5-JSP-å’Œ-JSTL" class="headerlink" title="1.9.5. JSP å’Œ JSTL"></a>1.9.5. JSP å’Œ JSTL</h4><p>Springä¸ºJSPå’ŒJSTLè§†å›¾æä¾›äº†ä¸€äº›ç°æˆçš„è§£å†³æ–¹æ¡ˆ</p><h5 id="è§†å›¾è§£æ"><a href="#è§†å›¾è§£æ" class="headerlink" title="è§†å›¾è§£æ"></a>è§†å›¾è§£æ</h5><p>ä½¿ç”¨JSPè¿›è¡Œå¼€å‘æ—¶ï¼Œå¯ä»¥å£°æ˜<code>InternalResourceViewResolver</code>æˆ–<code>ResourceBundleViewResolver</code> beanã€‚</p><p><code>ResourceBundleViewResolver</code>ä¾èµ–äºå±æ€§æ–‡ä»¶æ¥å®šä¹‰æ˜ å°„åˆ°ç±»å’ŒURLçš„è§†å›¾åç§°ã€‚ä½¿ç”¨<code>ResourceBundleViewResolver</code>ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»…ä½¿ç”¨ä¸€ä¸ªè§£æå™¨æ¥æ··åˆä¸åŒç±»å‹çš„è§†å›¾ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- the ResourceBundleViewResolver --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;viewResolver&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.web.servlet.view.ResourceBundleViewResolver&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;basename&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;views&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br># And a sample properties file is uses (views.properties in WEB-INF/classes):welcome.(class)=org.springframework.web.servlet.view.JstlViewwelcome.url=/WEB-INF/jsp/welcome.jsp<br>productList.(class)=org.springframework.web.servlet.view.JstlViewproductList.url=/WEB-INF/jsp/productlist.jsp<br></code></pre></td></tr></table></figure><p><code>InternalResourceBundleViewResolver</code>ä¹Ÿå¯ç”¨äºJSPã€‚ ä½œä¸ºæœ€ä½³å®è·µï¼Œæˆ‘ä»¬å¼ºçƒˆå»ºè®®å°†JSPæ–‡ä»¶æ”¾åœ¨<code>&#39;WEB-INF&#39;</code>ç›®å½•ä¸‹çš„ç›®å½•ä¸­ï¼Œä»¥ä¾¿å®¢æˆ·ç«¯æ— æ³•ç›´æ¥è®¿é—®ã€‚</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs abnf">&lt;bean id<span class="hljs-operator">=</span><span class="hljs-string">&quot;viewResolver&quot;</span> class<span class="hljs-operator">=</span><span class="hljs-string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;<br><br>    &lt;property name<span class="hljs-operator">=</span><span class="hljs-string">&quot;viewClass&quot;</span> value<span class="hljs-operator">=</span><span class="hljs-string">&quot;org.springframework.web.servlet.view.JstlView&quot;</span>/&gt;<br><br>    &lt;property name<span class="hljs-operator">=</span><span class="hljs-string">&quot;prefix&quot;</span> value<span class="hljs-operator">=</span><span class="hljs-string">&quot;/WEB-INF/jsp/&quot;</span>/&gt;<br><br>    &lt;property name<span class="hljs-operator">=</span><span class="hljs-string">&quot;suffix&quot;</span> value<span class="hljs-operator">=</span><span class="hljs-string">&quot;.jsp&quot;</span>/&gt;<br><br>&lt;/bean&gt;<br></code></pre></td></tr></table></figure><h5 id="JSPs-å’Œ-JSTL"><a href="#JSPs-å’Œ-JSTL" class="headerlink" title="JSPs å’Œ JSTL"></a>JSPs å’Œ JSTL</h5><p>å½“ä½¿ç”¨Javaæ ‡å‡†æ ‡è®°åº“æ—¶ï¼Œå¿…é¡»ä½¿ç”¨ç‰¹æ®Šçš„è§†å›¾ç±»<code>JstlView</code>ï¼Œå› ä¸ºJSTLéœ€è¦ä¸€äº›å‡†å¤‡å·¥ä½œï¼Œä¾‹å¦‚I18NåŠŸèƒ½ã€‚</p><h5 id="Springçš„JSPæ ‡ç­¾åº“"><a href="#Springçš„JSPæ ‡ç­¾åº“" class="headerlink" title="Springçš„JSPæ ‡ç­¾åº“"></a>Springçš„JSPæ ‡ç­¾åº“</h5><p>Springæä¾›äº†è¯·æ±‚å‚æ•°ä¸å‘½ä»¤å¯¹è±¡çš„æ•°æ®ç»‘å®šï¼Œå¦‚å‰é¢ç« èŠ‚æ‰€è¿°ã€‚ä¸ºäº†æ–¹ä¾¿å¼€å‘JSPé¡µé¢ï¼Œç»“åˆè¿™äº›æ•°æ®ç»‘å®šåŠŸèƒ½ï¼ŒSpringæä¾›äº†ä¸€äº›ä½¿äº‹æƒ…å˜å¾—æ›´å®¹æ˜“çš„æ ‡è®°ã€‚æ‰€æœ‰çš„Springæ ‡è®°éƒ½haveHTMLè½¬ä¹‰åŠŸèƒ½ä»¥å¯ç”¨æˆ–ç¦ç”¨å­—ç¬¦è½¬ä¹‰ã€‚</p><p>æ ‡ç­¾åº“æè¿°ç¬¦(TLD) åœ¨<code>spring-webmvc.jar</code>åŒ…ä¸­ã€‚æ›´å¤šçš„ä¿¡æ¯ï¼Œè¯·æµè§ˆ<a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/web/servlet/tags/package-summary.html#package.description">APIå‚è€ƒ</a>æˆ–æŸ¥çœ‹æ ‡ç­¾åº“è¯´æ˜ã€‚</p><h5 id="Springçš„è¡¨å•æ ‡ç­¾åº“"><a href="#Springçš„è¡¨å•æ ‡ç­¾åº“" class="headerlink" title="Springçš„è¡¨å•æ ‡ç­¾åº“"></a>Springçš„è¡¨å•æ ‡ç­¾åº“</h5><p>ä»2.0ç‰ˆæœ¬å¼€å§‹, Springåœ¨ä½¿ç”¨JSPå’ŒSpring Web MVCæ—¶ä¸ºå¤„ç†è¡¨å•å…ƒç´ æä¾›äº†ä¸€å¥—å®Œæ•´çš„æ•°æ®ç»‘å®šè¯†åˆ«æ ‡ç­¾ã€‚æ¯ä¸ªæ ‡ç­¾éƒ½æ”¯æŒå…¶ç›¸åº”çš„HTMLæ ‡ç­¾å¯¹åº”çš„å±æ€§é›†ï¼Œä½¿æ ‡ç­¾ç†Ÿæ‚‰å’Œç›´è§‚åœ°ä½¿ç”¨ï¼Œæ ‡ç­¾ç”Ÿæˆçš„HTML 4.01&#x2F;XHTML 1.0å…¼å®¹ã€‚</p><p>ä¸åŒäºå…¶ä»–çš„è¡¨å•æˆ–è¾“å…¥æ ‡ç­¾åº“ï¼ŒSpringçš„è¡¨å•æ ‡ç­¾åº“æ˜¯é›†æˆåœ¨Spring Web MVCä¸­ï¼Œæ ‡ç­¾å¯ä»¥ä½¿ç”¨æ§åˆ¶å™¨å¤„ç†çš„å‘½ä»¤å¯¹è±¡å’Œå¼•ç”¨æ•°æ®ã€‚å› æ­¤åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­å°†ä¼šçœ‹åˆ°ï¼Œè¡¨å•æ ‡ç­¾ä½¿å¾—JSPæ›´åŠ æ–¹ä¾¿å¼€å‘ã€é˜…è¯»å’Œç»´æŠ¤ã€‚</p><p>è®©æˆ‘ä»¬æµè§ˆä¸€ä¸‹è¡¨å•æ ‡ç­¾ï¼Œçœ‹çœ‹å¦‚ä½•ä½¿ç”¨æ¯ä¸ªæ ‡ç­¾çš„ä¾‹å­ã€‚å…¶ä¸­å·²ç»åŒ…æ‹¬äº†ç”Ÿæˆçš„HTMLç‰‡æ®µï¼Œè€ŒæŸäº›æ ‡ç­¾éœ€è¦è¿›ä¸€æ­¥çš„è®¨è®ºã€‚</p><h6 id="é…ç½®-1"><a href="#é…ç½®-1" class="headerlink" title="é…ç½®"></a>é…ç½®</h6><p>è¡¨å•æ ‡ç­¾åº“æ†ç»‘åœ¨<code>spring-webmvc.jar</code>ä¸­. åº“æè¿°ç¬¦åå­—ä¸º<code>spring-form.tld</code>.</p><p>å¦‚æœéœ€è¦ä½¿ç”¨åˆ°è¿™äº›æ ‡ç­¾ï¼Œåœ¨JSPé¡µé¢çš„å¤´éƒ¨å¿…é¡»æ·»åŠ å¯¹åº”çš„æ ‡ç­¾åº“</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">&lt;<span class="hljs-meta">%</span>@ taglib prefix=<span class="hljs-string">&quot;form&quot;</span> uri=<span class="hljs-string">&quot;http://www.springframework.org/tags/form&quot;</span> <span class="hljs-meta">%</span>&gt;<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ <code>form</code>æ˜¯åé¢å¼•ç”¨æ ‡ç­¾çš„å‰ç¼€ã€‚</p><h6 id="è¡¨å•æ ‡ç­¾"><a href="#è¡¨å•æ ‡ç­¾" class="headerlink" title="è¡¨å•æ ‡ç­¾"></a>è¡¨å•æ ‡ç­¾</h6><p>æ ‡ç­¾â€™formâ€™ç»‘å®šäº†å¼•ç”¨åº“çš„å†…éƒ¨æ ‡ç­¾ï¼Œå¯ä»¥è¢«HTMLè§£æã€‚å®ƒå°†å‘½ä»¤å¯¹è±¡æ”¾åœ¨<code>PageContext</code>ä¸­ï¼Œä»¥ä¾¿å¯ä»¥é€šè¿‡å†…éƒ¨æ ‡è®°è®¿é—®å‘½ä»¤å¯¹è±¡ã€‚æ­¤åº“ä¸­çš„æ‰€æœ‰å…¶ä»–æ ‡è®°éƒ½æ˜¯<code>form</code>æ ‡è®°çš„åµŒå¥—æ ‡è®°ã€‚</p><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåä¸º <code>User</code>çš„åŸŸå¯¹è±¡ã€‚ å®ƒæ˜¯ä¸€ä¸ªJavaBeanï¼Œå…·æœ‰<code>firstName</code>å’Œ<code>lastName</code>ç­‰å±æ€§ã€‚æˆ‘ä»¬å°†ä½¿ç”¨å®ƒä½œä¸ºè¡¨å•æ§åˆ¶å™¨çš„å½¢å¼æ”¯æŒå¯¹è±¡ï¼Œè¾“å‡ºç»™ <code>form.jsp</code>ã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†form.jspçš„æ˜¾ç¤ºï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">form:form</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>First Name:<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">form:input</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;firstName&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>Last Name:<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">form:input</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;lastName&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">colspan</span>=<span class="hljs-string">&quot;2&quot;</span>&gt;</span><br><br>                <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Save Changes&quot;</span>/&gt;</span><br><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">form:form</span>&gt;</span><br></code></pre></td></tr></table></figure><p><code>firstName</code>å’Œ<code>lastName</code> å€¼ä¼šä»é¡µé¢æ§åˆ¶å™¨æ”¾ç½®åœ¨<code>PageContext</code>çš„å‘½ä»¤å¯¹è±¡ä¸­æŸ¥æ‰¾ã€‚æ›´å¤šå¤æ‚çš„ä¾‹å­éƒ½æ˜¯è¿™æ ·å»¶ä¼¸çš„ï¼Œé‡ç‚¹å°±æ˜¯å†…éƒ¨æ ‡ç­¾æ˜¯å¦‚ä½•ä¸è¡¨å•æ ‡ç­¾ä¸€èµ·ä½¿ç”¨çš„ã€‚</p><p>ä»¥ä¸‹æ¸…å•æ˜¾ç¤ºäº†ç”Ÿæˆçš„HTMLï¼Œå®ƒçœ‹èµ·æ¥åƒæ ‡å‡†æ ¼å¼ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;POST&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>First Name:<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;firstName&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Harry&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>Last Name:<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;lastName&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Potter&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">colspan</span>=<span class="hljs-string">&quot;2&quot;</span>&gt;</span><br><br>                <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Save Changes&quot;</span>/&gt;</span><br><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä¹‹å‰çš„JSPå‡è®¾è¡¨å•çš„å˜é‡åæ˜¯<code>command</code>ã€‚å¦‚æœå¯¹è±¡å·²ç»å°è£…åˆ°å¦ä¸€ä¸ªåç§°ä¸­äº†ï¼Œè¡¨å•ä¹Ÿæ”¯æŒä»è‡ªå®šä¹‰åç§°ä¸­ç»‘å®šå˜é‡ï¼ˆè¿™æ˜¯æœ€ä½³å®è·µï¼‰ã€‚å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">form:form</span> <span class="hljs-attr">modelAttribute</span>=<span class="hljs-string">&quot;user&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>First Name:<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">form:input</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;firstName&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>Last Name:<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">form:input</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;lastName&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">colspan</span>=<span class="hljs-string">&quot;2&quot;</span>&gt;</span><br><br>                <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Save Changes&quot;</span>/&gt;</span><br><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">form:form</span>&gt;</span><br></code></pre></td></tr></table></figure><h6 id="è¾“å…¥æ ‡ç­¾"><a href="#è¾“å…¥æ ‡ç­¾" class="headerlink" title="è¾“å…¥æ ‡ç­¾"></a>è¾“å…¥æ ‡ç­¾</h6><p>è¿™ä¸ªæ ‡ç­¾å…¶å®å°±æ˜¯HTMLçš„<code>input</code>æ ‡ç­¾ï¼ˆå½“ç„¶æ˜¯è§£æåçš„ï¼‰ï¼Œæ­¤æ ‡ç­¾æˆ–é»˜è®¤ç»‘å®šå€¼å’Œ <code>type=&#39;text&#39;</code>å±æ€§ã€‚æœ‰å…³æ­¤çš„ç¤ºä¾‹ï¼Œè¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-view-jsp-formtaglib-formtag">è¡¨å•æ ‡ç­¾</a>ã€‚ æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ç‰¹å®šäºHTML5çš„ç±»å‹ï¼Œä¾‹å¦‚<code>email</code>, <code>tel</code>, <code>date</code>ç­‰ã€‚</p><h6 id="å¤é€‰æ¡†æ ‡ç­¾"><a href="#å¤é€‰æ¡†æ ‡ç­¾" class="headerlink" title="å¤é€‰æ¡†æ ‡ç­¾"></a>å¤é€‰æ¡†æ ‡ç­¾</h6><p>å¤é€‰æ¡†ä¹Ÿä¼šè§£ææˆHTMLçš„è¾“å…¥æ ‡ç­¾ã€‚</p><p>å‡è®¾<code>User</code>å¯¹è±¡æ‹¥æœ‰æ–°é—»è®¢é˜…å’Œçˆ±å¥½åˆ—è¡¨å±æ€§ï¼Œæ˜¾ç¤ºäº†<code>Preferences</code>ç±»ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Preferences</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-built_in">boolean</span> receiveNewsletter;    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span>[] interests;    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> favouriteWord;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">isReceiveNewsletter</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-keyword">return</span> receiveNewsletter;    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setReceiveNewsletter</span>(<span class="hljs-params"><span class="hljs-built_in">boolean</span> receiveNewsletter</span>) &#123;        <span class="hljs-variable language_">this</span>.<span class="hljs-property">receiveNewsletter</span> = receiveNewsletter;    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span>[] <span class="hljs-title function_">getInterests</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-keyword">return</span> interests;    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setInterests</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] interests</span>) &#123;        <span class="hljs-variable language_">this</span>.<span class="hljs-property">interests</span> = interests;    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getFavouriteWord</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-keyword">return</span> favouriteWord;    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setFavouriteWord</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> favouriteWord</span>) &#123;        <span class="hljs-variable language_">this</span>.<span class="hljs-property">favouriteWord</span> = favouriteWord;    &#125;&#125;<br></code></pre></td></tr></table></figure><p>ç›¸åº”çš„<code>form.jsp</code> å¯èƒ½ç±»ä¼¼äºä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight vbscript-html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vbscript-html"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">form:form</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>Subscribe to newsletter?:<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>            </span><span class="language-vbscript">&lt;%-- Approach <span class="hljs-number">1</span>: <span class="hljs-keyword">Property</span> <span class="hljs-keyword">is</span> of type java.lang.Boolean --%&gt;</span><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">form:checkbox</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;preferences.receiveNewsletter&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>Interests:<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>            </span><span class="language-vbscript">&lt;%-- Approach <span class="hljs-number">2</span>: <span class="hljs-keyword">Property</span> <span class="hljs-keyword">is</span> of an array <span class="hljs-keyword">or</span> of type java.util.Collection --%&gt;</span><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>                Quidditch: <span class="hljs-tag">&lt;<span class="hljs-name">form:checkbox</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;preferences.interests&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Quidditch&quot;</span>/&gt;</span>                Herbology: <span class="hljs-tag">&lt;<span class="hljs-name">form:checkbox</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;preferences.interests&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Herbology&quot;</span>/&gt;</span>                Defence Against the Dark Arts: <span class="hljs-tag">&lt;<span class="hljs-name">form:checkbox</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;preferences.interests&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Defence Against the Dark Arts&quot;</span>/&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>Favourite Word:<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>            </span><span class="language-vbscript">&lt;%-- Approach <span class="hljs-number">3</span>: <span class="hljs-keyword">Property</span> <span class="hljs-keyword">is</span> of type java.lang.Object --%&gt;</span><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>                Magic: <span class="hljs-tag">&lt;<span class="hljs-name">form:checkbox</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;preferences.favouriteWord&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Magic&quot;</span>/&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">form:form</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p>checkboxæ ‡ç­¾æœ‰ä¸‰ç§æ–¹æ³•ï¼Œå¯æ»¡è¶³æ‚¨çš„æ‰€æœ‰å¤é€‰æ¡†éœ€æ±‚ã€‚</p><ul><li>æ–¹æ³•ä¸€: å½“ç»‘å®šå€¼ä¸º<code>java.lang.Boolean</code>,å¦‚æœç»‘å®šå€¼ä¸º <code>true</code>ã€‚åˆ™<code>input(checkbox)</code>è¢«æ ‡è®°ä¸º<code>checked</code> ã€‚valueå±æ€§å¯¹åº”äº<code>setValue(Object)</code>çš„å€¼ï¼ˆå½“ç„¶æ˜¯è§£æåçš„ï¼‰ã€‚</li><li>æ–¹æ³•äºŒ: å½“ç»‘å®šå€¼æ˜¯<code>array</code> æˆ–<code>java.util.Collection</code>,å¦‚æœç»‘å®šé›†åˆä¸­å­˜åœ¨å·²é…ç½®çš„ <code>setValue(Object)</code> åˆ™è¾“å…¥ï¼ˆå¤é€‰æ¡†ï¼‰å°†æ ‡è®°ä¸ºå·²é€‰ä¸­ã€‚ã€‚</li><li>æ–¹æ³•ä¸‰: å¯¹äºä»»ä½•å…¶ä»–ç»‘å®šå€¼ç±»å‹, å¦‚æœé…ç½®çš„<code>setValue(Object)</code>ç­‰äºç»‘å®šå€¼ï¼Œåˆ™<code>input(checkbox)</code>è¢«æ ‡è®°ä¸ºå·²é€‰ä¸­ã€‚</li></ul><p>è¯·æ³¨æ„ï¼Œæ— è®ºé‡‡ç”¨ä½•ç§æ–¹æ³•ï¼Œéƒ½ä¼šç”Ÿæˆç›¸åŒçš„HTMLç»“æ„ã€‚ ä»¥ä¸‹HTMLä»£ç æ®µå®šä¹‰äº†ä¸€äº›å¤é€‰æ¡†ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">&lt;tr&gt;<br><br>    &lt;td&gt;Interests:&lt;/td&gt;<br><br>    &lt;td&gt;<br><br>        Quidditch: &lt;<span class="hljs-keyword">input</span> <span class="hljs-type">name</span>=&quot;preferences.interests&quot; <span class="hljs-keyword">type</span>=&quot;checkbox&quot; <span class="hljs-keyword">value</span>=&quot;Quidditch&quot;/&gt;<br><br>        &lt;<span class="hljs-keyword">input</span> <span class="hljs-keyword">type</span>=&quot;hidden&quot; <span class="hljs-keyword">value</span>=&quot;1&quot; <span class="hljs-type">name</span>=&quot;_preferences.interests&quot;/&gt;<br><br>        Herbology: &lt;<span class="hljs-keyword">input</span> <span class="hljs-type">name</span>=&quot;preferences.interests&quot; <span class="hljs-keyword">type</span>=&quot;checkbox&quot; <span class="hljs-keyword">value</span>=&quot;Herbology&quot;/&gt;<br><br>        &lt;<span class="hljs-keyword">input</span> <span class="hljs-keyword">type</span>=&quot;hidden&quot; <span class="hljs-keyword">value</span>=&quot;1&quot; <span class="hljs-type">name</span>=&quot;_preferences.interests&quot;/&gt;<br><br>        Defence Against the Dark Arts: &lt;<span class="hljs-keyword">input</span> <span class="hljs-type">name</span>=&quot;preferences.interests&quot; <span class="hljs-keyword">type</span>=&quot;checkbox&quot; <span class="hljs-keyword">value</span>=&quot;Defence Against the Dark Arts&quot;/&gt;<br><br>        &lt;<span class="hljs-keyword">input</span> <span class="hljs-keyword">type</span>=&quot;hidden&quot; <span class="hljs-keyword">value</span>=&quot;1&quot; <span class="hljs-type">name</span>=&quot;_preferences.interests&quot;/&gt;<br><br>    &lt;/td&gt;<br><br>&lt;/tr&gt;<br></code></pre></td></tr></table></figure><p>å¯èƒ½ä¸å¸Œæœ›çœ‹åˆ°çš„æ˜¯æ¯ä¸ªå¤é€‰æ¡†åéƒ½é™„åŠ éšè—åŸŸï¼Œå¦‚æœhtmlé¡µä¸­çš„å¤é€‰æ¡†ä¸€ä¸ªéƒ½æ²¡æœ‰é€‰ä¸­ï¼Œåˆ™åœ¨æäº¤è¡¨å•åï¼Œå®ƒçš„å€¼å°†ä¸ä¼šä½œä¸ºHTTPè¯·æ±‚å‚æ•°çš„ä¸€éƒ¨åˆ†å‘é€åˆ°æœåŠ¡å™¨ï¼Œå› æ­¤ä¸ºäº†ä½¿Springè¡¨å•æ•°æ®ç»‘å®šå·¥ä½œã€‚ éœ€è¦åœ¨htmlä¸­ä½¿ç”¨æ­¤å¥‡æ€ªçš„å˜é€šæ–¹æ³•ã€‚å¤é€‰æ¡†æ ‡è®°éµå¾ªç°æœ‰çš„Springçº¦å®šï¼Œå…¶ä¸­åŒ…æ‹¬æ¯ä¸ªå¤é€‰æ¡†éƒ½ä»¥ä¸‹åˆ’çº¿<code>_</code>ä¸ºå‰ç¼€çš„éšè—å‚æ•°ã€‚é€šè¿‡è¿™æ ·åšï¼Œå¯ä»¥æœ‰æ•ˆåœ°å‘Šè¯‰Springâ€è¯¥å¤é€‰æ¡†åœ¨è¡¨å•ä¸­æ˜¯å¯è§çš„,å¹¶ä¸”å¸Œæœ›å°†è¡¨å•æ•°æ®ç»‘å®šåˆ°å…¶ä¸Šçš„å¯¹è±¡èƒ½å¤Ÿåæ˜ å¤é€‰æ¡†çš„çŠ¶æ€â€.</p><h6 id="å¤é€‰æ¡†æ ‡ç­¾-1"><a href="#å¤é€‰æ¡†æ ‡ç­¾-1" class="headerlink" title="å¤é€‰æ¡†æ ‡ç­¾"></a>å¤é€‰æ¡†æ ‡ç­¾</h6><p>checkboxæ ‡ç­¾ç›¸å½“äºå¤šä¸ªHTMLçš„inputæ ‡ç­¾</p><p>ä¸Šä¸€ä¸ªä¾‹å­å±•ç¤ºäº†å¤é€‰æ¡†æ ‡ç­¾çš„ç”Ÿæˆã€‚æœ‰æ—¶å€™ï¼Œä¸å¸Œæœ›åœ¨JSPé¡µé¢ä¸­åˆ—å‡ºUserçš„æ‰€æœ‰çˆ±å¥½ã€‚ä½ æ›´å¸Œæœ›åœ¨è¿è¡Œæä¾›å¯é€‰çš„åˆ—è¡¨ï¼Œå¹¶ä¼ é€’ç»™å¤é€‰æ¡†æ ‡ç­¾ã€‚è¿™æ˜¯å¤é€‰æ¡†æ ‡è®°çš„ç”¨é€”ã€‚ å¯ä»¥ä¼ å…¥ä¸€ä¸ªæ•°ç»„ã€ ä¸€ä¸ªåˆ—è¡¨æˆ–ä¸€ä¸ªåŒ…å«<code>items</code>å±æ€§ä¸­çš„å¯ç”¨é€‰é¡¹çš„Mapã€‚ç»‘å®šå±æ€§é€šå¸¸æ˜¯ä¸€ä¸ªé›†åˆï¼Œå› æ­¤å®ƒå¯ä»¥ä¿å­˜ç”¨æˆ·é€‰æ‹©çš„å¤šä¸ªå€¼ã€‚ä¸‹é¢æ˜¯ä½¿ç”¨æ­¤æ ‡ç­¾çš„JSPç¤ºä¾‹</p><figure class="highlight vbscript-html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs vbscript-html"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">form:form</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>Interests:<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">                </span><span class="language-vbscript">&lt;%-- <span class="hljs-keyword">Property</span> <span class="hljs-keyword">is</span> of an array <span class="hljs-keyword">or</span> of type java.util.Collection --%&gt;</span><span class="language-xml"></span><br><span class="language-xml"></span><br><span class="language-xml">                <span class="hljs-tag">&lt;<span class="hljs-name">form:checkboxes</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;preferences.interests&quot;</span> <span class="hljs-attr">items</span>=<span class="hljs-string">&quot;$&#123;interestList&#125;&quot;</span>/&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">form:form</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p>æœ¬å®ä¾‹å‡å®š<code>interestList</code>æ˜¯ä¸€ä¸ªæ¨¡å‹çš„å±æ€§<code>List</code>ï¼ŒåŒ…å«éœ€è¦çš„å­—ç¬¦ä¸²å€¼ã€‚åœ¨ä½¿ç”¨MAPçš„æƒ…å†µä¸‹ï¼ŒMapçš„keyå°†ç”¨ä½œå€¼ï¼Œmapçš„valueå°†ç”¨ä½œè¦æ˜¾ç¤ºçš„æ ‡ç­¾ã€‚è¿˜å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨<code>itemValue</code>å’Œä½¿ç”¨<code>itemLabel</code>çš„æ ‡ç­¾ä½œä¸ºè¯¥å€¼æä¾›å±æ€§åç§°ã€‚</p><h6 id="å•é€‰æ¡†æ ‡ç­¾"><a href="#å•é€‰æ¡†æ ‡ç­¾" class="headerlink" title="å•é€‰æ¡†æ ‡ç­¾"></a>å•é€‰æ¡†æ ‡ç­¾</h6><p>è¿˜æœ‰ä¸€ä¸ªå¯ä»¥è§£ææˆHTMLinputæ ‡ç­¾çš„æ˜¯radioæ ‡ç­¾</p><p>radioå¾ˆç®€å•ï¼Œæä¾›å¤šä¸ªå€¼ï¼Œä½†æ˜¯ä¸€æ¬¡åªèƒ½é€‰å…¶ä¸­ä¸€ä¸ªã€‚å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>Sex:<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><br><br>        Male: <span class="hljs-tag">&lt;<span class="hljs-name">form:radiobutton</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;sex&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;M&quot;</span>/&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><br><br>        Female: <span class="hljs-tag">&lt;<span class="hljs-name">form:radiobutton</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;sex&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;F&quot;</span>/&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br></code></pre></td></tr></table></figure><h6 id="å•é€‰æ ‡ç­¾-radiobuttons"><a href="#å•é€‰æ ‡ç­¾-radiobuttons" class="headerlink" title="å•é€‰æ ‡ç­¾ radiobuttons"></a>å•é€‰æ ‡ç­¾ <code>radiobuttons</code></h6><p>è¿™ä¸ªå½¢å¼çš„<code>radio</code>ä¹Ÿå¯ä»¥è§£ææˆHTMLçš„<code>input</code>æ ‡ç­¾ï¼Œåªæ˜¯å®ƒæ˜¯å¤šä¸ªå•é€‰ã€‚</p><p>å°±åƒä¸Šé¢çš„<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-view-jsp-formtaglib-checkboxestag"><code>checkboxes</code> æ ‡ç­¾</a>ä¸€æ ·ï¼Œå¯èƒ½å¸Œæœ›å°†å¯ç”¨é€‰é¡¹ä½œä¸ºè¿è¡Œæ—¶å˜é‡ä¼ å…¥ã€‚å¯¹äºæ­¤ç”¨æ³•ï¼Œå¯ä»¥ä½¿ç”¨å•é€‰æ ‡ç­¾ã€‚å¯ä»¥ä¼ å…¥ä¸€ä¸ªæ•°ç»„ã€ä¸€ä¸ªåˆ—è¡¨æˆ–ä¸€ä¸ªåŒ…å« <code>items</code>å±æ€§çš„Mapã€‚å¦‚æœä½¿ç”¨mapï¼Œmapçš„keyå°†ä½¿ç”¨ä½œä¸ºå€¼å¹¶ä¸”mapçš„å€¼å°†ä½¿ç”¨ä½œä¸ºæ ‡ç­¾æ¥æ˜¾ç¤ºã€‚è¿˜å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨<code>itemValue</code>å’Œä½¿ç”¨<code>itemLabel</code>çš„æ ‡ç­¾ä½œä¸ºè¯¥å€¼æä¾›å±æ€§åç§°ã€‚</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>Sex:<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">form:radiobuttons</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;sex&quot;</span> <span class="hljs-attr">items</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;sexOptions&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span></span><br></code></pre></td></tr></table></figure><h6 id="å¯†ç æ¡†æ ‡ç­¾"><a href="#å¯†ç æ¡†æ ‡ç­¾" class="headerlink" title="å¯†ç æ¡†æ ‡ç­¾"></a>å¯†ç æ¡†æ ‡ç­¾</h6><p><code>password</code> æ ‡ç­¾é¡µä¼šè§£ææˆHTMLçš„<code>input</code>æ ‡ç­¾ åªæ˜¯å®ƒæœ‰è‡ªå·±çš„ç‰¹æ€§ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>Password:<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">form:password</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;password&quot;</span>/&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br></code></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œå¯†ç å€¼æ˜¯ä¸å¯è§çš„ã€‚å¦‚æœå¸Œæœ›å¯†ç å€¼å¯è§ï¼Œéœ€è¦è®¾ç½®<code>showPassword</code>å±æ€§ä¸º<code>true</code>ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>Password:<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">form:password</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;^76525bvHGq&quot;</span> <span class="hljs-attr">showPassword</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br></code></pre></td></tr></table></figure><h6 id="é€‰æ‹©æ ‡ç­¾"><a href="#é€‰æ‹©æ ‡ç­¾" class="headerlink" title="é€‰æ‹©æ ‡ç­¾"></a>é€‰æ‹©æ ‡ç­¾</h6><p>Tè¿™ä¸ªæ ‡ç­¾å°±æ˜¯HTMLçš„selectå…ƒç´ ã€‚æ”¯æŒå•å±‚é€‰é¡¹æˆ–åµŒå¥—é€‰é¡¹çš„é€‰æ‹©ï¼Œæ•°æ®åˆ©ç”¨é¡¹æ¥ç»‘å®šã€‚</p><p>è®©æˆ‘ä»¬å‡è®¾<code>User</code>ï¼Œä»–æœ‰ä¸€ä¸ªæŠ€èƒ½åˆ—è¡¨å¦‚ä¸‹:</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>Skills:<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">form:select</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;skills&quot;</span> <span class="hljs-attr">items</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;skills&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p>å¦‚æœUseré€‰ä¸­çš„æŠ€èƒ½æ˜¯Herbologyï¼Œé‚£ä¹ˆè¿™ä¸ªSkillsçš„HTMLæºä»£ç æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>Skills:<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;skills&quot;</span> <span class="hljs-attr">multiple</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Potions&quot;</span>&gt;</span>Potions<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Herbology&quot;</span> <span class="hljs-attr">selected</span>=<span class="hljs-string">&quot;selected&quot;</span>&gt;</span>Herbology<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Quidditch&quot;</span>&gt;</span>Quidditch<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br></code></pre></td></tr></table></figure><h6 id="é€‰é¡¹æ ‡ç­¾"><a href="#é€‰é¡¹æ ‡ç­¾" class="headerlink" title="é€‰é¡¹æ ‡ç­¾"></a>é€‰é¡¹æ ‡ç­¾</h6><p>è¿™ä¸ªæ ‡ç­¾å°±æ˜¯HTMLçš„option(é…åˆselectä¸­ï¼‰å…ƒç´ ã€‚å®ƒä¼šå¯¹è¢«ç»‘å®šçš„å€¼è®¾ç½®å±æ€§ä¸ºselectedï¼Œä»¥ä¸‹HTMLæ˜¾ç¤ºäº†å®ƒçš„å…¸å‹è¾“å‡ºï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>House:<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">form:select</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;house&quot;</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">form:option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Gryffindor&quot;</span>/&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">form:option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Hufflepuff&quot;</span>/&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">form:option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Ravenclaw&quot;</span>/&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">form:option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Slytherin&quot;</span>/&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">form:select</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å¦‚æœUserçš„å®¶æ˜¯åœ¨Gryffindorï¼Œé‚£ä¹ˆHouseçš„HTMLæºä»£ç é•¿è¿™æ ·ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>House:<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;house&quot;</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Gryffindor&quot;</span> <span class="hljs-attr">selected</span>=<span class="hljs-string">&quot;selected&quot;</span>&gt;</span>Gryffindor<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span> (1)<br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Hufflepuff&quot;</span>&gt;</span>Hufflepuff<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Ravenclaw&quot;</span>&gt;</span>Ravenclaw<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Slytherin&quot;</span>&gt;</span>Slytherin<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>1</strong>ã€è¯·æ³¨æ„æ·»åŠ æ‰€é€‰å±æ€§ã€‚</p><h6 id="é€‰é¡¹æ ‡ç­¾-1"><a href="#é€‰é¡¹æ ‡ç­¾-1" class="headerlink" title="é€‰é¡¹æ ‡ç­¾"></a>é€‰é¡¹æ ‡ç­¾</h6><p>è¿™ä¸ªæ ‡ç­¾å°±æ˜¯HTMLçš„option(é…åˆselectä¸­)å…ƒç´ ,ä½†æ˜¯å®ƒå¤„ç†çš„æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œå®ƒä¼šå¯¹è¢«ç»‘å®šçš„å€¼è®¾ç½®å±æ€§ä¸ºselectedï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>Country:<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">form:select</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;country&quot;</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">form:option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;-&quot;</span> <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;--Please Select&quot;</span>/&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">form:options</span> <span class="hljs-attr">items</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;countryList&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span> <span class="hljs-attr">itemValue</span>=<span class="hljs-string">&quot;code&quot;</span> <span class="hljs-attr">itemLabel</span>=<span class="hljs-string">&quot;name&quot;</span>/&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">form:select</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p>å¦‚æœUserä½åœ¨UKï¼Œé‚£ä¹ˆCountryçš„HTMLæºä»£ç é•¿è¿™è¿™æ ·:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>Country:<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;country&quot;</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;-&quot;</span>&gt;</span>--Please Select<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;AT&quot;</span>&gt;</span>Austria<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;UK&quot;</span> <span class="hljs-attr">selected</span>=<span class="hljs-string">&quot;selected&quot;</span>&gt;</span>United Kingdom<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span> (1)<br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;US&quot;</span>&gt;</span>United States<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>1</strong>ã€Note the addition of a <code>selected</code> attribute.</p><p>çœ‹ä¸Šé¢çš„ä¸¤ä¸ªä¾‹å­ï¼Œ <code>option</code>å’Œ<code>options</code>æ ‡ç­¾éƒ½ç”Ÿæˆäº†ç›¸åŒçš„æ ‡å‡†çš„HTMLï¼Œä½†å…è®¸ä½ åœ¨JSPä¸­æ˜¾å¼åœ°æŒ‰éœ€æ˜¾ç¤ºå±æ€§å€¼ï¼Œä¾‹å¦‚é»˜è®¤çš„å­—ç¬¦ä¸²åœ¨ä¾‹å­ä¸­æ˜¯â€â€” Please Selectâ€ï¼ˆå°±æ˜¯é»˜è®¤çš„ï¼Œé€‰æ‹©ä¸ºç©ºçš„é‚£ä¸ªï¼Œè¿™ä¸ªå¾ˆæœ‰ç”¨ï¼‰ã€‚</p><p><code>items</code>å±æ€§é€šå¸¸ä½¿ç”¨é¡¹å¯¹è±¡çš„é›†åˆæˆ–æ•°ç»„å¡«å……ï¼Œ <code>itemValue</code>å’Œ<code>itemLabel</code>å°±æ˜¯å¯¹åº”æŒ‡å®šbeanå¯¹è±¡çš„å±æ€§ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œå¯¹è±¡å°†è¢«è½¬æˆå­—ç¬¦ä¸²ã€‚æˆ–è€…ï¼Œ å¯ä»¥å®šä¹‰ä¸€ä¸ªMapçš„itemsï¼Œ<code>Map</code>çš„keyå¯¹åº”é€‰é¡¹å€¼ï¼Œvalueå¯¹åº”é€‰é¡¹æ ‡ç­¾ã€‚å¦‚æœå¦‚æœ<code>itemValue</code>å’Œ<code>itemLabel</code>éƒ½è¢«æŒ‡å®šäº†ï¼Œé‚£ä¹ˆitemå€¼å±æ€§å¯¹åº”keyï¼Œitemæ ‡ç­¾å±æ€§å¯¹åº”valueã€‚</p><h6 id="æ–‡æœ¬æ¡†æ ‡ç­¾"><a href="#æ–‡æœ¬æ¡†æ ‡ç­¾" class="headerlink" title="æ–‡æœ¬æ¡†æ ‡ç­¾"></a>æ–‡æœ¬æ¡†æ ‡ç­¾</h6><p>è¿™ä¸ªæ ‡ç­¾è§£ææˆHTMLä¸­çš„<code>textarea</code>æ ‡ç­¾ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>Notes:<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">form:textarea</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;notes&quot;</span> <span class="hljs-attr">rows</span>=<span class="hljs-string">&quot;3&quot;</span> <span class="hljs-attr">cols</span>=<span class="hljs-string">&quot;20&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">form:errors</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;notes&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br></code></pre></td></tr></table></figure><h6 id="éšè—æ ‡ç­¾"><a href="#éšè—æ ‡ç­¾" class="headerlink" title="éšè—æ ‡ç­¾"></a>éšè—æ ‡ç­¾</h6><p><code>hidden</code>æ ‡ç­¾è§£æä¸ºHTMLçš„<code>hidden</code>ï¼Œç”¨åœ¨<code>input</code> æ ‡ç­¾ä¸­ç”¨äºæš—ä¸­ç»‘å®šå€¼ï¼Œç›®çš„å¾ˆæ˜æ˜¾å°±æ˜¯éšè—ï¼Œå¦‚ä¸‹</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;form:hidden <span class="hljs-attribute">path</span>=<span class="hljs-string">&quot;house&quot;</span>/&gt;<br></code></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬é€‰æ‹©<code>house</code>å€¼ä½œä¸ºéšè—åŸŸæäº¤, HTMLé•¿è¿™æ ·:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;input <span class="hljs-attribute">name</span>=<span class="hljs-string">&quot;house&quot;</span> <span class="hljs-attribute">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attribute">value</span>=<span class="hljs-string">&quot;Gryffindor&quot;</span>/&gt;<br></code></pre></td></tr></table></figure><h6 id="é”™è¯¯æ ‡ç­¾"><a href="#é”™è¯¯æ ‡ç­¾" class="headerlink" title="é”™è¯¯æ ‡ç­¾"></a>é”™è¯¯æ ‡ç­¾</h6><p>è¿™ä¸ªæ ‡ç­¾ä¼šåœ¨HTMLçš„ <code>span</code>æ ‡ç­¾ä¸­å±•ç¤ºé”™è¯¯ï¼Œå®ƒæä¾›å¯¹åœ¨æ§åˆ¶å™¨ä¸­åˆ›å»ºçš„é”™è¯¯çš„è®¿é—®ï¼Œæˆ–å¯¹ä¸æ§åˆ¶å™¨å…³è”çš„ä»»ä½•éªŒè¯ç¨‹åºåˆ›å»ºçš„å‡ºé”™ä¿¡æ¯è¿›è¡Œæ˜¾ç¤ºã€‚</p><p>å‡è®¾æˆ‘ä»¬å¸Œæœ›åœ¨æäº¤è¡¨å•åæ˜¾ç¤º <code>firstName</code> å’Œ <code>lastName</code>å­—æ®µçš„æ‰€æœ‰é”™è¯¯ä¿¡æ¯ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªéªŒè¯å™¨çš„å®ä¾‹çš„ <code>User</code> ç±»ç§°ä¸º<code>UserValidator</code>ã€‚å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> UserValidator implements <span class="hljs-keyword">Validator</span> &#123;<br>    <span class="hljs-built_in">public</span> <span class="hljs-type">boolean</span> supports(<span class="hljs-keyword">Class</span> candidate) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">User</span>.<span class="hljs-keyword">class</span>.isAssignableFrom(candidate);    &#125;<br>    <span class="hljs-built_in">public</span> <span class="hljs-type">void</span> <span class="hljs-keyword">validate</span>(<span class="hljs-keyword">Object</span> obj, Errors errors) &#123;        ValidationUtils.rejectIfEmptyOrWhitespace(errors, &quot;firstName&quot;, &quot;required&quot;, &quot;Field is required.&quot;);        ValidationUtils.rejectIfEmptyOrWhitespace(errors, &quot;lastName&quot;, &quot;required&quot;, &quot;Field is required.&quot;);    &#125;&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ª <code>form.jsp</code>çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">form:form</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>First Name:<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">form:input</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;firstName&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>            &lt;%-- Show errors for firstName field --%&gt;            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">form:errors</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;firstName&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>Last Name:<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">form:input</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;lastName&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>            &lt;%-- Show errors for lastName field --%&gt;            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">form:errors</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;lastName&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">colspan</span>=<span class="hljs-string">&quot;3&quot;</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Save Changes&quot;</span>/&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">form:form</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬å°†<code>firstName</code> å’Œ <code>lastName</code>çš„åŸŸè®¾ç½®ç©ºå€¼å¹¶æäº¤ï¼Œåˆ™htmlçœ‹èµ·æ¥æ˜¯è¿™æ ·çš„:</p><figure class="highlight vbscript-html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vbscript-html"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;POST&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>First Name:<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;firstName&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>            </span><span class="language-vbscript">&lt;%-- Associated errors <span class="hljs-keyword">to</span> firstName field displayed --%&gt;</span><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;firstName.errors&quot;</span>&gt;</span>Field is required.<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>Last Name:<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;lastName&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>            </span><span class="language-vbscript">&lt;%-- Associated errors <span class="hljs-keyword">to</span> lastName field displayed --%&gt;</span><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;lastName.errors&quot;</span>&gt;</span>Field is required.<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">colspan</span>=<span class="hljs-string">&quot;3&quot;</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Save Changes&quot;</span>/&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬è¦æ˜¾ç¤ºç»™å®šé¡µé¢çš„æ•´ä¸ªé”™è¯¯åˆ—è¡¨ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿä¸‹é¢çš„ç¤ºä¾‹æ˜¾ç¤ºäº†é”™è¯¯æ ‡è®°è¿˜æ”¯æŒä¸€äº›åŸºæœ¬çš„é€šç”¨åŠŸèƒ½</p><ul><li><code>path=&quot;*&quot;</code>: å±•ç¤ºæ‰€æœ‰çš„é”™è¯¯.</li><li><code>path=&quot;lastName&quot;</code>: å±•ç¤º<code>lastName</code>åŸŸçš„æ‰€æœ‰é”™è¯¯</li><li>å¦‚æœ <code>path</code> è¢«çœç•¥ï¼Œåªä¼šæ˜¾ç¤ºå½“å‰å¯¹è±¡çš„é”™è¯¯ã€‚</li></ul><p>ä¸‹é¢çš„ç¤ºä¾‹å°†æ˜¾ç¤ºé¡µé¢é¡¶éƒ¨çš„é”™è¯¯åˆ—è¡¨ï¼Œåè·Ÿå­—æ®µæ—è¾¹çš„ç‰¹å®šäºå­—æ®µçš„é”™è¯¯ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">form:form</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">form:errors</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;*&quot;</span> <span class="hljs-attr">cssClass</span>=<span class="hljs-string">&quot;errorBox&quot;</span>/&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>First Name:<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">form:input</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;firstName&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">form:errors</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;firstName&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>Last Name:<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">form:input</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;lastName&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">form:errors</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;lastName&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">colspan</span>=<span class="hljs-string">&quot;3&quot;</span>&gt;</span><br><br>                <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Save Changes&quot;</span>/&gt;</span><br><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">form:form</span>&gt;</span><br></code></pre></td></tr></table></figure><p>htmlçœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;POST&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;*.errors&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;errorBox&quot;</span>&gt;</span>Field is required.<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>Field is required.<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>First Name:<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;firstName&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;firstName.errors&quot;</span>&gt;</span>Field is required.<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>Last Name:<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;lastName&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;lastName.errors&quot;</span>&gt;</span>Field is required.<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">colspan</span>=<span class="hljs-string">&quot;3&quot;</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Save Changes&quot;</span>/&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br></code></pre></td></tr></table></figure><p>The <code>spring-form.tld</code> tag library descriptor (TLD) is included in the <code>spring-webmvc.jar</code>. For a comprehensive reference on individual tags, browse the <a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/web/servlet/tags/form/package-summary.html#package.description">API reference</a> or see the tag library description.</p><h6 id="HTTPæ–¹æ³•è½¬æ¢"><a href="#HTTPæ–¹æ³•è½¬æ¢" class="headerlink" title="HTTPæ–¹æ³•è½¬æ¢"></a>HTTPæ–¹æ³•è½¬æ¢</h6><p>RESTçš„ä¸€ä¸ªå…³é”®åŸåˆ™æ˜¯ä½¿ç”¨ç»Ÿä¸€çš„æ¥å£ã€‚è¿™æ„å‘³ç€æ‰€æœ‰èµ„æº(URL)éƒ½å¯ä»¥ä½¿ç”¨ç›¸åŒçš„å››ç§HTTPæ–¹æ³•è¿›è¡Œæ“ä½œGET, PUT, POST,å’Œ DELETEã€‚å¯¹äºæ¯ä¸ªæ–¹æ³•ï¼ŒHTTPè§„èŒƒéƒ½å®šä¹‰äº†ç²¾ç¡®çš„è¯­ä¹‰ã€‚ä¾‹å¦‚ï¼Œ GETåº”è¯¥å§‹ç»ˆæ˜¯ä¸€ä¸ªå®‰å…¨çš„æ“ä½œï¼Œè¿™æ„å‘³ç€å®ƒå¯¹æœåŠ¡å™¨çš„æ•°æ®æ²¡æœ‰ä»»ä½•å½±å“ã€‚è€ŒPUTæˆ–DELETEåº”è¯¥æ˜¯å¹‚ç­‰çš„ï¼Œè¿™æ„å‘³ç€å¯ä»¥åå¤é‡å¤è¿™äº›æ“ä½œï¼Œå…¶æœ€ç»ˆç»“æœåº”è¯¥æ˜¯ç›¸åŒçš„ã€‚è™½ç„¶HTTPå®šä¹‰äº†è¿™å››ç§æ–¹æ³•ï¼Œä½†æ˜¯HTMLåªæ”¯æŒä¸¤ä¸ªï¼šGETå’ŒPOSTï¼Œ å¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸¤ç§å¯èƒ½çš„è§£å†³æ–¹æ³•ï¼š1ï¼Œå¯ä»¥ä½¿ç”¨JavaScriptæ¥æ‰§è¡ŒPUTæˆ–DELETEã€‚æˆ–è€…2ï¼Œç®€å•åœ°ç”¨â€œrealâ€çš„æ–¹å¼ä½œä¸ºé™„åŠ å‚æ•°(ä½œä¸ºHTMLè¡¨å•ä¸­çš„éšè—è¾“å…¥å­—æ®µ)è¿›è¡ŒPOSTã€‚åè€…æ˜¯ä½¿ç”¨Springçš„<code>HiddenHttpMethodFilter</code>åšçš„ã€‚ è¿™ä¸ªè¿‡æ»¤å™¨æ˜¯ä¸€ä¸ªç®€å•çš„Servletè¿‡æ»¤å™¨ï¼Œå› æ­¤å®ƒå¯ä»¥ä¸ä»»ä½•Webæ¡†æ¶(ä¸ä»…ä»…æ˜¯Spring MVC)ç»“åˆä½¿ç”¨ï¼Œåªéœ€å°†æ­¤ç­›é€‰å™¨æ·»åŠ åˆ° web.xml,å¹¶å°†å…·æœ‰éšè—åŸŸ<code>_method</code>å‚æ•°è½¬æ¢ä¸ºç›¸åº”çš„HTTPæ–¹æ³•è¯·æ±‚ã€‚</p><p>ä¸ºäº†æ”¯æŒHTTPæ–¹æ³•è½¬æ¢ï¼ŒSpring MVCè¡¨å•æ ‡ç­¾è¢«é‡æ–°è®¾è®¡æ¥æ”¯æŒè®¾ç½®HTTPæ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œæ›´æ–°åçš„Petclinicç¤ºä¾‹æœ‰ä»¥ä¸‹åˆ¤æ–­ï¼š</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">&lt;form:form method=<span class="hljs-string">&quot;delete&quot;</span>&gt;<br><br>    &lt;p <span class="hljs-keyword">class</span>=&quot;<span class="hljs-symbol">submit</span>&quot;&gt;&lt;<span class="hljs-symbol">input</span> <span class="hljs-symbol">type</span>=&quot;<span class="hljs-symbol">submit</span>&quot; <span class="hljs-symbol">value</span>=&quot;<span class="hljs-symbol">Delete</span> <span class="hljs-symbol">Pet</span>&quot;/&gt;&lt;/<span class="hljs-symbol">p</span>&gt;<br><br>&lt;/<span class="hljs-symbol">form:<span class="hljs-symbol">form</span></span>&gt;<br></code></pre></td></tr></table></figure><p>å®é™…ä¸Šå®ƒå°±æ˜¯ä¸€ä¸ªHTTP POSTï¼ŒDELETEæ–¹æ³•åªæ˜¯éšè—åœ¨è¯·æ±‚å‚æ•°ä¸­çš„å‡æ­£ç»æ–¹æ³•è€Œå·²ï¼Œè¿™ä¸ªDELETEå°†è¢«å®šä¹‰åœ¨web.xmlçš„ <code>HiddenHttpMethodFilter</code>æ¥å¤„ç†,å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">&lt;<span class="hljs-keyword">filter</span>&gt;    &lt;<span class="hljs-keyword">filter</span>-<span class="hljs-type">name</span>&gt;httpMethodFilter&lt;/<span class="hljs-keyword">filter</span>-<span class="hljs-type">name</span>&gt;    &lt;<span class="hljs-keyword">filter</span>-<span class="hljs-keyword">class</span>&gt;org.springframework.web.<span class="hljs-keyword">filter</span>.HiddenHttpMethodFilter&lt;/<span class="hljs-keyword">filter</span>-<span class="hljs-keyword">class</span>&gt;&lt;/<span class="hljs-keyword">filter</span>&gt;<br>&lt;<span class="hljs-keyword">filter</span>-<span class="hljs-keyword">mapping</span>&gt;    &lt;<span class="hljs-keyword">filter</span>-<span class="hljs-type">name</span>&gt;httpMethodFilter&lt;/<span class="hljs-keyword">filter</span>-<span class="hljs-type">name</span>&gt;    &lt;servlet-<span class="hljs-type">name</span>&gt;petclinic&lt;/servlet-<span class="hljs-type">name</span>&gt;&lt;/<span class="hljs-keyword">filter</span>-<span class="hljs-keyword">mapping</span>&gt;<br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†ç›¸åº”çš„<code>@Controller</code>æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(method = RequestMethod.DELETE)</span><br><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">deletePet</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> <span class="hljs-type">int</span> ownerId, <span class="hljs-meta">@PathVariable</span> <span class="hljs-type">int</span> petId)</span> &#123;<br><br>    <span class="hljs-built_in">this</span>.clinic.deletePet(petId);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:/owners/&quot;</span> + ownerId;<br><br>&#125;<br></code></pre></td></tr></table></figure><h6 id="HTML5æ ‡ç­¾"><a href="#HTML5æ ‡ç­¾" class="headerlink" title="HTML5æ ‡ç­¾"></a>HTML5æ ‡ç­¾</h6><p>è¡¨å•æ ‡ç­¾åº“å…è®¸è¾“å…¥åŠ¨æ€å±æ€§ï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥è¾“å…¥ä»»ä½•HTML5çš„ç‰¹å®šå±æ€§ã€‚</p><p>è¡¨å•<code>input</code>æ ‡ç­¾æ”¯æŒè¾“å…¥æ–‡æœ¬ä»¥å¤–çš„ç±»å‹å±æ€§ã€‚ ä»–å…è®¸HTML5å®šä¹‰è¾“å…¥ç±»å‹ï¼Œä¾‹å¦‚<code>email</code>, <code>date</code>,<code>range</code>ç­‰ã€‚ è¯·æ³¨æ„ï¼Œå› ä¸ºtextæ˜¯é»˜è®¤ç±»å‹ï¼Œå› æ­¤ä¸éœ€è¦è¾“å…¥<code>type=&#39;text&#39;</code></p><h4 id="1-9-6-Tiles"><a href="#1-9-6-Tiles" class="headerlink" title="1.9.6. Tiles"></a>1.9.6. Tiles</h4><p>Spring Webåº”ç”¨è¿˜å¯ä»¥é›†æˆTilesï¼Œå°±åƒå…¶å®ƒè§†å›¾æŠ€æœ¯ä¸€æ ·ã€‚ä¸‹é¢å°†æè¿°æ€æ ·é›†æˆã€‚</p><p>æœ¬èŠ‚é‡ç‚¹ä»‹ç»Springåœ¨<code>org.springframework.web.servlet.view.tiles3</code>åŒ…ä¸­å¯¹Tilesç‰ˆæœ¬3çš„æ”¯æŒã€‚</p><h5 id="ä¾èµ–"><a href="#ä¾èµ–" class="headerlink" title="ä¾èµ–"></a>ä¾èµ–</h5><p>ä¸ºäº†èƒ½å¤Ÿä½¿ç”¨Tilesï¼Œæ‚¨å¿…é¡»åœ¨Tiles 3.0.1æˆ–æ›´é«˜ç‰ˆæœ¬ä¸Šæ·»åŠ ä¾èµ–é¡¹åŠå…¶å¯¹é¡¹ç›®çš„<a href="https://tiles.apache.org/framework/dependency-management.html">ä¼ é€’ä¾èµ–æ€§</a>ã€‚</p><h5 id="é…ç½®-2"><a href="#é…ç½®-2" class="headerlink" title="é…ç½®"></a>é…ç½®</h5><p>ä¸ºäº†èƒ½å¤Ÿä½¿ç”¨Tilesï¼Œæ‚¨å¿…é¡»ä½¿ç”¨åŒ…å«å®šä¹‰çš„æ–‡ä»¶å¯¹å…¶è¿›è¡Œé…ç½®ï¼ˆæœ‰å…³å®šä¹‰å’Œå…¶ä»–Tilesæ¦‚å¿µçš„åŸºæœ¬ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://tiles.apache.org/">http://tiles.apache.org</a>ï¼‰ã€‚ åœ¨Springä¸­ï¼Œè¿™æ˜¯é€šè¿‡ä½¿ç”¨ <code>TilesConfigurer</code>å®Œæˆçš„ã€‚ ä»¥ä¸‹ç¤ºä¾‹<code>ApplicationContext</code>é…ç½®æ˜¾ç¤ºäº†å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;tilesConfigurer&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.web.servlet.view.tiles3.TilesConfigurer&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;definitions&quot;</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>/WEB-INF/defs/general.xml<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>/WEB-INF/defs/widgets.xml<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>/WEB-INF/defs/administrator.xml<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>/WEB-INF/defs/customer.xml<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>/WEB-INF/defs/templates.xml<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„Tileså®šä¹‰äº†äº”ä¸ªæ–‡ä»¶ï¼Œéƒ½ä½äº<code>WEB-INF/defs</code> æ–‡ä»¶å¤¹ä¸­ã€‚åœ¨åˆå§‹åŒ–<code>WebApplicationContext</code>æ—¶ ï¼Œæ–‡ä»¶å°†è¢«åŠ è½½ï¼Œå®šä¹‰å·¥å‚å°†è¢«åˆå§‹åŒ–ã€‚å®Œæˆæ­¤æ“ä½œä¹‹åï¼Œåœ¨Spring Webåº”ç”¨ç¨‹åºä¸­ï¼Œå®šä¹‰æ–‡ä»¶ä¸­åŒ…å«çš„Tileså¯ä»¥ç”¨ä½œè§†å›¾ã€‚ ä¹‹åSpringä½¿ç”¨Tilesä¸ä½¿ç”¨å…¶ä»–è§†å›¾æ˜¯ä¸€æ ·çš„ï¼šé€šè¿‡<code>ViewResolver</code>è§£æï¼Œ<code>ViewResolver</code>å¯ä»¥é€‰æ‹©<code>UrlBasedViewResolver</code>æˆ–<code>ResourceBundleViewResolver</code>ã€‚</p><p>æ‚¨å¯ä»¥é€šè¿‡æ·»åŠ ä¸‹åˆ’çº¿ç„¶åæ·»åŠ åŒºåŸŸè®¾ç½®æ¥æŒ‡å®šç‰¹å®šäºåŒºåŸŸè®¾ç½®çš„Tileså®šä¹‰ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;tilesConfigurer&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.web.servlet.view.tiles3.TilesConfigurer&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;definitions&quot;</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>/WEB-INF/defs/tiles.xml<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>/WEB-INF/defs/tiles_fr_FR.xml<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ä¸Šè¿°é…ç½®ï¼Œ<code>tiles_fr_FR.xml</code>ç”¨äºå…·æœ‰ <code>fr_FR</code>è¯­è¨€ç¯å¢ƒçš„è¯·æ±‚ï¼Œé»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨<code>tiles.xml</code>ã€‚</p><p>ç”±äºä¸‹åˆ’çº¿ç”¨äºè¡¨ç¤ºåŒºåŸŸè®¾ç½®ï¼Œå› æ­¤æˆ‘ä»¬å»ºè®®ä¸è¦åœ¨Tileså®šä¹‰çš„æ–‡ä»¶åä¸­ä½¿ç”¨å®ƒä»¬ã€‚</p><h6 id="UrlBasedViewResolver"><a href="#UrlBasedViewResolver" class="headerlink" title="UrlBasedViewResolver"></a><code>UrlBasedViewResolver</code></h6><p><code>UrlBasedViewResolver</code>å¯¹ç»™å®šçš„<code>viewClass</code>è¿›è¡Œå®ä¾‹åŒ–ï¼Œå³ä¼šè§£ææ‰€æœ‰çš„è§†å›¾ã€‚ ä»¥ä¸‹beanå®šä¹‰äº†<code>UrlBasedViewResolver</code>ï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs abnf">&lt;bean id<span class="hljs-operator">=</span><span class="hljs-string">&quot;viewResolver&quot;</span> class<span class="hljs-operator">=</span><span class="hljs-string">&quot;org.springframework.web.servlet.view.UrlBasedViewResolver&quot;</span>&gt;<br><br>    &lt;property name<span class="hljs-operator">=</span><span class="hljs-string">&quot;viewClass&quot;</span> value<span class="hljs-operator">=</span><span class="hljs-string">&quot;org.springframework.web.servlet.view.tiles3.TilesView&quot;</span>/&gt;<br><br>&lt;/bean&gt;<br></code></pre></td></tr></table></figure><h6 id="ResourceBundleViewResolver"><a href="#ResourceBundleViewResolver" class="headerlink" title="ResourceBundleViewResolver"></a><code>ResourceBundleViewResolver</code></h6><p><code>ResourceBundleViewResolver</code>å¿…é¡»æä¾›ä¸€ä¸ªåŒ…å«viewnameså’Œviewclassesçš„å±æ€§æ–‡ä»¶ã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†<code>ResourceBundleViewResolver</code>çš„beanå®šä¹‰ä»¥åŠç›¸åº”çš„è§†å›¾åç§°å’Œè§†å›¾ç±»ï¼ˆå–è‡ªPet Clinicç¤ºä¾‹ï¼‰ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus">&lt;bean id=<span class="hljs-string">&quot;viewResolver&quot;</span> class=<span class="hljs-string">&quot;org.springframework.web.servlet.view.ResourceBundleViewResolver&quot;</span>&gt;    &lt;property name=<span class="hljs-string">&quot;basename&quot;</span> value=<span class="hljs-string">&quot;views&quot;</span>/&gt;&lt;/bean&gt;<br>..<span class="hljs-selector-class">.welcomeView</span>.(class)=org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.servlet</span><span class="hljs-selector-class">.view</span><span class="hljs-selector-class">.tiles3</span><span class="hljs-selector-class">.TilesViewwelcomeView</span>.url=welcome (this is the name of <span class="hljs-selector-tag">a</span> Tiles definition)<br>vetsView.(class)=org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.servlet</span><span class="hljs-selector-class">.view</span><span class="hljs-selector-class">.tiles3</span><span class="hljs-selector-class">.TilesViewvetsView</span>.url=vetsView (again, this is the name of <span class="hljs-selector-tag">a</span> Tiles definition)<br>findOwnersForm.(class)=org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.servlet</span><span class="hljs-selector-class">.view</span><span class="hljs-selector-class">.JstlViewfindOwnersForm</span>.url=/WEB-INF/jsp/findOwners<span class="hljs-selector-class">.jsp</span>...<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨<code>ResourceBundleViewResolver</code>æ—¶ï¼Œå¯ä»¥è½»æ¾æ··åˆä½¿ç”¨ä¸åŒçš„è§†å›¾æŠ€æœ¯ã€‚</p><p>è¯·æ³¨æ„ï¼Œ <code>TilesView</code> ç±»æ”¯æŒJSTLï¼ˆJSPæ ‡å‡†æ ‡è®°åº“ï¼‰ã€‚</p><h6 id="SimpleSpringPreparerFactory-å’Œ-SpringBeanPreparerFactory"><a href="#SimpleSpringPreparerFactory-å’Œ-SpringBeanPreparerFactory" class="headerlink" title="SimpleSpringPreparerFactory å’Œ SpringBeanPreparerFactory"></a><code>SimpleSpringPreparerFactory</code> å’Œ <code>SpringBeanPreparerFactory</code></h6><p>ä½œä¸ºä¸€ä¸ªé«˜çº§åŠŸèƒ½ï¼ŒSpringè¿˜æ”¯æŒä¸¤ä¸ªç‰¹æ®Šçš„Tiles <code>PreparerFactory</code>å®ç°ï¼Œæœ‰å…³å¦‚ä½•åœ¨Tileså®šä¹‰æ–‡ä»¶ä¸­ä½¿ç”¨<code>ViewPreparer</code>å¼•ç”¨çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…Tilesæ–‡æ¡£ã€‚</p><p>æ‚¨å¯ä»¥æŒ‡å®šSimpleSpringPreparerFactoryä»¥åŸºäºæŒ‡å®šçš„preparerç±»è‡ªåŠ¨è£…é…ViewPreparerå®ä¾‹ï¼Œåº”ç”¨Springçš„å®¹å™¨å›è°ƒä»¥åŠåº”ç”¨å·²é…ç½®çš„Spring BeanPostProcessorsã€‚ å¦‚æœå·²æ¿€æ´»Springçš„ä¸Šä¸‹æ–‡èŒƒå›´æ³¨é‡Šé…ç½®ï¼Œåˆ™ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶åº”ç”¨ViewPreparerç±»ä¸­çš„æ³¨é‡Šã€‚ è¯·æ³¨æ„ï¼Œè¿™éœ€è¦Tileså®šä¹‰æ–‡ä»¶ä¸­çš„preparerç±»ï¼Œä½œä¸ºé»˜è®¤çš„PreparerFactoryã€‚</p><p>æ‚¨å¯ä»¥æŒ‡å®š<code>SpringBeanPreparerFactory</code>æ¥æ“ä½œæŒ‡å®šçš„prepareråç§°ï¼ˆè€Œä¸æ˜¯ç±»ï¼‰ï¼Œä»DispatcherServletçš„åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­è·å–ç›¸åº”çš„Spring beanã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®Œæ•´çš„beanåˆ›å»ºè¿‡ç¨‹æ§åˆ¶ç€Springåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ï¼Œå…è®¸ä½¿ç”¨æ˜¾å¼ä¾èµ–é¡¹æ³¨å…¥é…ç½®ï¼Œä½œç”¨åŸŸbeanç­‰ã€‚ è¯·æ³¨æ„ï¼Œæ‚¨éœ€è¦ä¸ºæ¯ä¸ªprepareråç§°å®šä¹‰ä¸€ä¸ªSpring beanå®šä¹‰ï¼ˆåœ¨Tileså®šä¹‰ä¸­ä½¿ç”¨ï¼‰ã€‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•åœ¨<code>TilesConfigurer</code>ä¸Šå®šä¹‰ä¸€ä¸ª <code>SpringBeanPreparerFactory</code>å±æ€§é›†ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;tilesConfigurer&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.web.servlet.view.tiles3.TilesConfigurer&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;definitions&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>/WEB-INF/defs/general.xml<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>/WEB-INF/defs/widgets.xml<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>/WEB-INF/defs/administrator.xml<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>/WEB-INF/defs/customer.xml<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>/WEB-INF/defs/templates.xml<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- resolving preparer names as Spring bean definition names --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;preparerFactoryClass&quot;</span>            <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;org.springframework.web.servlet.view.tiles3.SpringBeanPreparerFactory&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="1-9-7-RSS-å’Œ-Atom"><a href="#1-9-7-RSS-å’Œ-Atom" class="headerlink" title="1.9.7. RSS å’Œ Atom"></a>1.9.7. RSS å’Œ Atom</h4><p><code>AbstractAtomFeedView</code>å’Œ<code>AbstractRssFeedView</code>éƒ½ç»§æ‰¿è‡ª<code>AbstractFeedView</code>åŸºç±»ï¼Œåˆ†åˆ«ç”¨äºæä¾›Atomå’ŒRSS Feedè§†å›¾ã€‚ å®ƒä»¬åŸºäºjava.netçš„<a href="https://rome.dev.java.net/">ROME</a>é¡¹ç›®ï¼Œä½äº<code>org.springframework.web.servlet.view.feed</code>åŒ…ä¸­ã€‚</p><p><code>AbstractAtomFeedView</code> è¦æ±‚å®ç°<code>buildFeedEntries()</code> æ–¹æ³•ï¼Œå¹¶å¯é€‰æ‹©é‡å†™ <code>buildFeedMetadata()</code> æ–¹æ³•(é»˜è®¤å®ç°ä¸ºç©º).ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œï¼š</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs scala">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SampleContentAtomView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractAtomFeedView</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span>    <span class="hljs-keyword">protected</span> void buildFeedMetadata(<span class="hljs-type">Map</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Object</span>&gt; model,            <span class="hljs-type">Feed</span> feed, <span class="hljs-type">HttpServletRequest</span> request) &#123;        <span class="hljs-comment">// implementation omitted    &#125;</span><br>    <span class="hljs-meta">@Override</span>    <span class="hljs-keyword">protected</span> <span class="hljs-type">List</span>&lt;<span class="hljs-type">Entry</span>&gt; buildFeedEntries(<span class="hljs-type">Map</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Object</span>&gt; model,            <span class="hljs-type">HttpServletRequest</span> request, <span class="hljs-type">HttpServletResponse</span> response) <span class="hljs-keyword">throws</span> <span class="hljs-type">Exception</span> &#123;        <span class="hljs-comment">// implementation omitted    &#125;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ç±»ä¼¼çš„è¦æ±‚é€‚ç”¨äºå®ç°<code>AbstractRssFeedView</code>ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs scala">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SampleContentAtomView</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractRssFeedView</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span>    <span class="hljs-keyword">protected</span> void buildFeedMetadata(<span class="hljs-type">Map</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Object</span>&gt; model,            <span class="hljs-type">Channel</span> feed, <span class="hljs-type">HttpServletRequest</span> request) &#123;        <span class="hljs-comment">// implementation omitted    &#125;</span><br>    <span class="hljs-meta">@Override</span>    <span class="hljs-keyword">protected</span> <span class="hljs-type">List</span>&lt;<span class="hljs-type">Item</span>&gt; buildFeedItems(<span class="hljs-type">Map</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Object</span>&gt; model,            <span class="hljs-type">HttpServletRequest</span> request, <span class="hljs-type">HttpServletResponse</span> response) <span class="hljs-keyword">throws</span> <span class="hljs-type">Exception</span> &#123;        <span class="hljs-comment">// implementation omitted    &#125;&#125;</span><br></code></pre></td></tr></table></figure><p><code>buildFeedItems()</code> å’Œ <code>buildFeedEntries()</code>æ–¹æ³•åœ¨HTTPè¯·æ±‚ä¸­ä¼ é€’ï¼Œä»¥é˜²éœ€è¦è®¿é—®åŒºåŸŸè®¾ç½®ã€‚ä»…ä¸ºcookieæˆ–å…¶ä»–httpå¤´çš„è®¾ç½®ä¼ é€’httpå“åº”ã€‚è¯¥feedå°†åœ¨æ–¹æ³•è¿”å›åè‡ªåŠ¨å†™å…¥å“åº”å¯¹è±¡ã€‚</p><p>æœ‰å…³åˆ›å»ºAtomè§†å›¾çš„ç¤ºä¾‹ï¼Œè¯·å‚é˜…Alef Arendsençš„Spring Team Blog <a href="https://spring.io/blog/2009/03/16/adding-an-atom-view-to-an-application-using-spring-s-rest-support">æ¡ç›®</a>.</p><h4 id="1-9-8-PDF-å’Œ-Excel"><a href="#1-9-8-PDF-å’Œ-Excel" class="headerlink" title="1.9.8. PDF å’Œ Excel"></a>1.9.8. PDF å’Œ Excel</h4><p>Springæä¾›äº†è¿”å›HTMLä»¥å¤–çš„è¾“å‡ºçš„æ–¹æ³•ï¼ŒåŒ…æ‹¬PDFå’ŒExcelç”µå­è¡¨æ ¼ã€‚ æœ¬èŠ‚ä»‹ç»å¦‚ä½•ä½¿ç”¨è¿™äº›åŠŸèƒ½ã€‚</p><h5 id="æ–‡æ¡£è§†å›¾ç®€ä»‹"><a href="#æ–‡æ¡£è§†å›¾ç®€ä»‹" class="headerlink" title="æ–‡æ¡£è§†å›¾ç®€ä»‹"></a>æ–‡æ¡£è§†å›¾ç®€ä»‹</h5><p>è¿”å›HTMLé¡µå¹¶ä¸æ€»æ˜¯ç”¨æˆ·æŸ¥çœ‹æ¨¡å‹è¾“å‡ºçš„æœ€ä½³æ–¹å¼ï¼ŒSpringè®©å¼€å‘è€…å¯ä»¥ä»æ¨¡å‹æ•°æ®åŠ¨æ€ç”ŸæˆPDFæ–‡æ¡£æˆ–Excelç”µå­è¡¨æ ¼ã€‚è¯¥æ–‡æ¡£æ˜¯è§†å›¾ï¼Œå°†ä»å…·æœ‰æ­£ç¡®å†…å®¹ç±»å‹çš„æœåŠ¡å™¨æµå¼ä¼ è¾“åˆ°HTMLï¼Œä½¿å®¢æˆ·ç«¯PCèƒ½å¤Ÿè¿è¡Œå…¶ç”µå­è¡¨æ ¼æˆ–PDFæŸ¥çœ‹å™¨åº”ç”¨ç¨‹åºä»¥è¿›è¡Œå“åº”ã€‚</p><p>è¦ä½¿ç”¨Excelè§†å›¾ï¼Œéœ€è¦å°†Apache POIåº“æ·»åŠ åˆ°ç±»è·¯å¾„ä¸­ã€‚å¯¹äºPDFç”Ÿæˆï¼Œæ‚¨éœ€è¦æ·»åŠ ï¼ˆæœ€å¥½ï¼‰OpenPDFåº“ã€‚</p><p>å¦‚æœå¯èƒ½ï¼Œæ‚¨åº”è¯¥ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„åŸºç¡€æ–‡æ¡£ç”Ÿæˆåº“ã€‚ ç‰¹åˆ«æ˜¯ï¼Œæˆ‘ä»¬å¼ºçƒˆå»ºè®®ä½¿ç”¨OpenPDFï¼ˆä¾‹å¦‚ï¼ŒOpenPDF 1.0.5ï¼‰è€Œä¸æ˜¯è¿‡æ—¶çš„åŸå§‹iText 2.1.7ï¼Œå› ä¸ºOpenPDFæ˜¯ä¸»åŠ¨ç»´æŠ¤çš„ï¼Œå¹¶ä¿®å¤äº†ä¸å—ä¿¡ä»»çš„PDFå†…å®¹çš„é‡è¦æ¼æ´ã€‚</p><h5 id="PDF-è§†å›¾"><a href="#PDF-è§†å›¾" class="headerlink" title="PDF è§†å›¾"></a>PDF è§†å›¾</h5><p>å•è¯åˆ—è¡¨çš„ç®€å•PDFè§†å›¾å¯ä»¥æ‰©å±•<code>org.springframework.web.servlet.view.document.AbstractPdfView</code>å¹¶å®ç°<code>buildPdfDocument()</code> æ–¹æ³•ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs scala">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PdfWordList</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractPdfView</span> </span>&#123;<br>    <span class="hljs-keyword">protected</span> void buildPdfDocument(<span class="hljs-type">Map</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Object</span>&gt; model, <span class="hljs-type">Document</span> doc, <span class="hljs-type">PdfWriter</span> writer,            <span class="hljs-type">HttpServletRequest</span> request, <span class="hljs-type">HttpServletResponse</span> response) <span class="hljs-keyword">throws</span> <span class="hljs-type">Exception</span> &#123;<br>        <span class="hljs-type">List</span>&lt;<span class="hljs-type">String</span>&gt; words = (<span class="hljs-type">List</span>&lt;<span class="hljs-type">String</span>&gt;) model.get(<span class="hljs-string">&quot;wordList&quot;</span>);        <span class="hljs-keyword">for</span> (<span class="hljs-type">String</span> word : words) &#123;            doc.add(<span class="hljs-keyword">new</span> <span class="hljs-type">Paragraph</span>(word));        &#125;    &#125;&#125;<br></code></pre></td></tr></table></figure><p>æ§åˆ¶å™¨å¯ä»¥ä»å¤–éƒ¨è§†å›¾å®šä¹‰ï¼ˆé€šè¿‡åç§°å¼•ç”¨å®ƒï¼‰è¿”å›è¿™æ ·çš„è§†å›¾ï¼Œä¹Ÿå¯ä»¥ä»å¤„ç†ç¨‹åºæ–¹æ³•è¿”å›<code>View</code>å®ä¾‹ã€‚</p><h5 id="Excel-è§†å›¾"><a href="#Excel-è§†å›¾" class="headerlink" title="Excel è§†å›¾"></a>Excel è§†å›¾</h5><p>ä»Spring Framework 4.2å¼€å§‹ï¼Œ<code>org.springframework.web.servlet.view.document.AbstractXlsView</code> ä½œä¸ºExcelè§†å›¾çš„åŸºç±»æä¾›ã€‚ å®ƒåŸºäºApache POIï¼Œå…·æœ‰ä¸“é—¨çš„å­ç±»ï¼ˆ<code>AbstractXlsxStreamingView</code>å’Œ<code>AbstractExcelView</code>ï¼‰ï¼Œå–ä»£äº†è¿‡æ—¶çš„<code>AbstractXlsxView</code>ç±»ã€‚</p><p>ç¼–ç¨‹æ¨¡å‹ç±»ä¼¼äº <code>AbstractPdfView</code>ï¼Œ<code>buildExcelDocument()</code>ä½œä¸ºæ ¸å¿ƒæ¨¡æ¿æ–¹æ³•ï¼Œæ§åˆ¶å™¨èƒ½å¤Ÿä»å¤–éƒ¨å®šä¹‰ï¼ˆé€šè¿‡åç§°ï¼‰è¿”å›è¿™æ ·çš„è§†å›¾ï¼Œæˆ–è€…ä»å¤„ç†ç¨‹åºæ–¹æ³•è¿”å›<code>View</code>å®ä¾‹ã€‚</p><h4 id="1-9-9-Jackson"><a href="#1-9-9-Jackson" class="headerlink" title="1.9.9. Jackson"></a>1.9.9. Jackson</h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-view-httpmessagewriter">Same as in Spring WebFlux</a></p><p>Springä¸ºJackson JSONåº“æä¾›æ”¯æŒã€‚</p><h5 id="åŸºäºJackson-çš„JSON-è§†å›¾"><a href="#åŸºäºJackson-çš„JSON-è§†å›¾" class="headerlink" title="åŸºäºJackson çš„JSON è§†å›¾"></a>åŸºäºJackson çš„JSON è§†å›¾</h5><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-view-httpmessagewriter">Same as in Spring WebFlux</a></p><p><code>MappingJackson2JsonView</code>ä½¿ç”¨Jacksonåº“çš„<code>ObjectMapper</code>å°†å“åº”å†…å®¹å‘ˆç°ä¸ºJSONã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¨¡å‹æ˜ å°„çš„å…¨éƒ¨å†…å®¹ï¼ˆç‰¹å®šäºæ¡†æ¶çš„ç±»é™¤å¤–ï¼‰éƒ½ç¼–ç ä¸ºJSONã€‚ å¯¹äºéœ€è¦è¿‡æ»¤Mapå†…å®¹çš„æƒ…å†µï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<code>modelKeys</code>å±æ€§æŒ‡å®šè¦ç¼–ç çš„ç‰¹å®šæ¨¡å‹å±æ€§é›†ã€‚ æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ <code>extractValueFromSingleKeyModel</code>å±æ€§å°†single-keyæ¨¡å‹ä¸­çš„å€¼ç›´æ¥æå–å’Œåºåˆ—åŒ–ï¼Œè€Œä¸æ˜¯ä½œä¸ºæ¨¡å‹å±æ€§çš„æ˜ å°„ã€‚</p><p>æ‚¨å¯ä»¥ä½¿ç”¨Jacksonæä¾›çš„æ³¨è§£æ ¹æ®éœ€è¦è‡ªå®šä¹‰JSONæ˜ å°„ã€‚ å½“æ‚¨éœ€è¦è¿›ä¸€æ­¥æ§åˆ¶æ—¶ï¼Œå¯ä»¥é€šè¿‡ <code>ObjectMapper</code>å±æ€§æ³¨å…¥è‡ªå®šä¹‰<code>ObjectMapper</code>ï¼Œä»¥ç”¨äºéœ€è¦ä¸ºç‰¹å®šç±»å‹æä¾›è‡ªå®šä¹‰JSONåºåˆ—åŒ–ç¨‹åºå’Œååºåˆ—åŒ–ç¨‹åºçš„æƒ…å†µã€‚</p><h5 id="åŸºäºJacksonçš„XMLè§†å›¾"><a href="#åŸºäºJacksonçš„XMLè§†å›¾" class="headerlink" title="åŸºäºJacksonçš„XMLè§†å›¾"></a>åŸºäºJacksonçš„XMLè§†å›¾</h5><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-view-httpmessagewriter">Same as in Spring WebFlux</a></p><p><code>MappingJackson2XmlView</code>ä½¿ç”¨<a href="https://github.com/FasterXML/jackson-dataformat-xml">Jackson XMLæ‰©å±•çš„</a> <code>XmlMapper</code>å°†å“åº”å†…å®¹å‘ˆç°ä¸ºXMLã€‚ å¦‚æœæ¨¡å‹åŒ…å«å¤šä¸ªæ¡ç›®ï¼Œåˆ™åº”ä½¿ç”¨<code>modelKey</code>beanå±æ€§æ˜¾å¼è®¾ç½®è¦åºåˆ—åŒ–çš„å¯¹è±¡ã€‚ å¦‚æœæ¨¡å‹åŒ…å«å•ä¸ªæ¡ç›®ï¼Œåˆ™ä¼šè‡ªåŠ¨åºåˆ—åŒ–ã€‚</p><p>æ‚¨å¯ä»¥ä½¿ç”¨JAXBæˆ–Jacksonæä¾›çš„æ³¨è§£æ ¹æ®éœ€è¦è‡ªå®šä¹‰XMLæ˜ å°„ã€‚ å½“æ‚¨éœ€è¦è¿›ä¸€æ­¥æ§åˆ¶æ—¶ï¼Œå¯ä»¥é€šè¿‡<code>ObjectMapper</code>å±æ€§æ³¨å…¥è‡ªå®šä¹‰<code>XmlMapper</code>ï¼Œä»¥ä¾¿è‡ªå®šä¹‰XMLéœ€è¦ä¸ºç‰¹å®šç±»å‹æä¾›åºåˆ—åŒ–ç¨‹åºå’Œååºåˆ—åŒ–ç¨‹åºã€‚</p><h4 id="1-9-10-XMLç¼–ç»„"><a href="#1-9-10-XMLç¼–ç»„" class="headerlink" title="1.9.10. XMLç¼–ç»„"></a>1.9.10. XMLç¼–ç»„</h4><p><code>MarshallingView</code>ä½¿ç”¨XML <code>Marshaller</code>ï¼ˆåœ¨<code>org.springframework.oxm</code>åŒ…ä¸­å®šä¹‰ï¼‰å°†å“åº”å†…å®¹å‘ˆç°ä¸ºXMLã€‚ æ‚¨å¯ä»¥ä½¿ç”¨ <code>MarshallingView</code> å®ä¾‹çš„ <code>modelKey</code> beanå±æ€§æ˜¾å¼è®¾ç½®è¦ç¼–ç»„çš„å¯¹è±¡ã€‚ æˆ–è€…ï¼Œè§†å›¾ä¼šè¿­ä»£æ‰€æœ‰æ¨¡å‹å±æ€§ï¼Œå¹¶å°é€<code>Marshaller</code>æ”¯æŒçš„ç¬¬ä¸€ç§ç±»å‹ã€‚ æœ‰å…³<code>org.springframework.oxm</code>åŒ…ä¸­åŠŸèƒ½çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…ä½¿ç”¨ <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/data-access.html#oxm">Marshalling XML using O&#x2F;X Mappers</a>ã€‚</p><h4 id="1-9-11-XSLTè§†å›¾"><a href="#1-9-11-XSLTè§†å›¾" class="headerlink" title="1.9.11. XSLTè§†å›¾"></a>1.9.11. XSLTè§†å›¾</h4><p>XSLTæ˜¯ä¸€ä¸ªç”¨äºè½¬æ¢XMLçš„è¯­è¨€,èƒ½å¤Ÿåœ¨webçš„è§†å›¾æŠ€æœ¯ä¸­ä½¿ç”¨.å¦‚æœåº”ç”¨éœ€è¦å¤„ç†XMLï¼ˆæˆ–è€…å°†æ¨¡å‹è½¬æ¢ä¸ºXMLï¼‰ï¼Œé‚£ä¹ˆXSLTæ˜¯ä¸€ä¸ªå¾ˆé€‚åˆçš„è§†å›¾æŠ€æœ¯ã€‚ä»¥ä¸‹éƒ¨åˆ†æ˜¾ç¤ºå¦‚ä½•å°†XMLæ–‡æ¡£ç”Ÿæˆä¸ºæ¨¡å‹æ•°æ®ï¼Œå¹¶åœ¨Spring Web MVCåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨XSLTè¿›è¡Œè½¬æ¢ã€‚</p><p>è¿™ä¸ªä¾‹å­æ˜¯ä¸€ä¸ªç®€å•çš„Springåº”ç”¨ç¨‹åºï¼Œå®ƒåœ¨Controllerä¸­åˆ›å»ºä¸€ä¸ªå•è¯åˆ—è¡¨å¹¶å°†å®ƒä»¬æ·»åŠ åˆ°æ¨¡å‹æ˜ å°„ä¸­ã€‚è¯¥æ˜ å°„ä¸ä½¿ç”¨çš„XSLTè§†å›¾åç§°ä¸€èµ·è¿”å›ã€‚æœ‰å…³Spring Web MVCæ§åˆ¶å™¨æ¥å£çš„è¯¦ç»†ä¿¡æ¯ï¼Œ è¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-controller">å¸¦æ³¨è§£çš„æ§åˆ¶å™¨</a>ã€‚ XSLTæ§åˆ¶å™¨å°†å•è¯åˆ—è¡¨è½¬æ¢ä¸ºå‡†å¤‡è½¬æ¢çš„ç®€å•XMLæ–‡æ¡£ã€‚</p><h5 id="Beans"><a href="#Beans" class="headerlink" title="Beans"></a>Beans</h5><p>Configurationé…ç½®æ˜¯Springåº”ç”¨ç¨‹åºçš„æ ‡é…ï¼ŒMVCé…ç½®å¿…é¡»å®šä¹‰<code>XsltViewResolver</code> beanå’Œå¸¸è§„MVCæ³¨è§£é…ç½®ï¼Œä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@EnableWebMvc</span><span class="hljs-meta">@ComponentScan</span><span class="hljs-meta">@Configurationpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span> &#123;<br>    <span class="hljs-meta">@Bean</span>    <span class="hljs-keyword">public</span> XsltViewResolver <span class="hljs-title function_">xsltViewResolver</span><span class="hljs-params">()</span> &#123;        <span class="hljs-type">XsltViewResolver</span> <span class="hljs-variable">viewResolver</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">XsltViewResolver</span>();        viewResolver.setPrefix(<span class="hljs-string">&quot;/WEB-INF/xsl/&quot;</span>);        viewResolver.setSuffix(<span class="hljs-string">&quot;.xslt&quot;</span>);        <span class="hljs-keyword">return</span> viewResolver;    &#125;&#125;<br></code></pre></td></tr></table></figure><h5 id="æ§åˆ¶å™¨"><a href="#æ§åˆ¶å™¨" class="headerlink" title="æ§åˆ¶å™¨"></a>æ§åˆ¶å™¨</h5><p>å¹¶ä¸”æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ§åˆ¶å™¨ï¼Œç”¨æ¥å¤„ç†å•è¯çš„ç”Ÿæˆé€»è¾‘ã€‚</p><p>æ§åˆ¶å™¨é€»è¾‘å°è£…åœ¨<code>@Controller</code> ç±»ä¸­ï¼Œå¤„ç†ç¨‹åºæ–¹æ³•å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-meta">@Controllerpublic</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">XsltController</span> </span>&#123;<br>    <span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">&quot;/&quot;</span>)    public <span class="hljs-built_in">String</span> home(Model model) throws Exception &#123;        Document <span class="hljs-built_in">document</span> = DocumentBuilderFactory.newInstance().newDocumentBuilder().newDocument();        <span class="hljs-built_in">Element</span> root = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">&quot;wordList&quot;</span>);<br>        <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">String</span>&gt; words = Arrays.asList(<span class="hljs-string">&quot;Hello&quot;</span>, <span class="hljs-string">&quot;Spring&quot;</span>, <span class="hljs-string">&quot;Framework&quot;</span>);        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">String</span> word : words) &#123;            <span class="hljs-built_in">Element</span> wordNode = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">&quot;word&quot;</span>);            Text textNode = <span class="hljs-built_in">document</span>.createTextNode(word);            wordNode.appendChild(textNode);            root.appendChild(wordNode);        &#125;<br>        model.addAttribute(<span class="hljs-string">&quot;wordList&quot;</span>, root);        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;home&quot;</span>;    &#125;&#125;<br></code></pre></td></tr></table></figure><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åªåˆ›å»ºäº†ä¸€ä¸ªDOMæ–‡æ¡£å¹¶å°†å…¶æ·»åŠ åˆ°æ¨¡å‹æ˜ å°„ä¸­ã€‚ è¯·æ³¨æ„ï¼Œæ‚¨è¿˜å¯ä»¥å°†XMLæ–‡ä»¶ä½œä¸º<code>Resource</code> åŠ è½½ï¼Œå¹¶ä½¿ç”¨å®ƒè€Œä¸æ˜¯è‡ªå®šä¹‰DOMæ–‡æ¡£ã€‚</p><p>å½“ç„¶ï¼Œæœ‰è½¯ä»¶åŒ…å¯ä»¥è‡ªåŠ¨ â€˜domifyâ€™å¯¹è±¡å›¾ï¼Œåœ¨Springä¸­ï¼Œæ‚¨å¯ä»¥å®Œå…¨çµæ´»åœ°ä»¥æ‚¨é€‰æ‹©çš„ä»»ä½•æ–¹å¼ä»æ¨¡å‹ä¸­åˆ›å»ºDOMã€‚è¿™å¯ä»¥é˜²æ­¢XMLåœ¨æ¨¡å‹æ•°æ®çš„ç»“æ„ä¸­æ‰®æ¼”å¤ªå¤§çš„è§’è‰²ï¼Œè¿™åœ¨ä½¿ç”¨å·¥å…·ç®¡ç†DOMåŒ–è¿‡ç¨‹æ—¶æ˜¯ä¸€ç§å±é™©ã€‚ã€‚</p><h5 id="è½¬æ¢"><a href="#è½¬æ¢" class="headerlink" title="è½¬æ¢"></a>è½¬æ¢</h5><p>æœ€å, <code>XsltViewResolver</code> å°†è§£æâ€œhomeâ€ XSLT æ¨¡æ¿æ–‡ä»¶ï¼Œå¹¶å°†DOMæ–‡æ¡£åˆå¹¶åˆ°å…¶ä¸­ä»¥ç”Ÿæˆæ‰€éœ€è§†å›¾ã€‚ä¾‹å¦‚<code>XsltViewResolver</code>é…ç½®æ‰€ç¤ºï¼ŒXSLTæ¨¡æ¿åœ¨<code>WEB-INF/xsl</code>ç›®å½•ä¸­çš„<code>war</code>æ–‡ä»¶ä¸­ï¼Œ å¹¶ä»¥<code>xslt</code>æ–‡ä»¶æ‰©å±•åç»“æŸã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†XSLTè½¬æ¢ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;utf-8&quot;</span>?&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">xsl:stylesheet</span> <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;1.0&quot;</span> <span class="hljs-attr">xmlns:xsl</span>=<span class="hljs-string">&quot;http://www.w3.org/1999/XSL/Transform&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">xsl:output</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;html&quot;</span> <span class="hljs-attr">omit-xml-declaration</span>=<span class="hljs-string">&quot;yes&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">xsl:template</span> <span class="hljs-attr">match</span>=<span class="hljs-string">&quot;/&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Hello!<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>My First Words<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>                    <span class="hljs-tag">&lt;<span class="hljs-name">xsl:apply-templates</span>/&gt;</span>                <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">xsl:template</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">xsl:template</span> <span class="hljs-attr">match</span>=<span class="hljs-string">&quot;word&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">xsl:value-of</span> <span class="hljs-attr">select</span>=<span class="hljs-string">&quot;.&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">xsl:template</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">xsl:stylesheet</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä¸Šè¿°è½¬æ¢å‘ˆç°ä¸ºä»¥ä¸‹HTMLï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">META</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;Content-Type&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Hello!<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>My First Words<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>Hello<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>Spring<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>Framework<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="1-10-MVC-é…ç½®"><a href="#1-10-MVC-é…ç½®" class="headerlink" title="1.10. MVC é…ç½®"></a>1.10. MVC é…ç½®</h3><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-config">Same as in Spring WebFlux</a></p><p>MVC Javaé…ç½®å’ŒMVCå‘½åç©ºé—´æä¾›äº†é€‚ç”¨äºå¤§å¤šæ•°åº”ç”¨ç¨‹åºçš„é»˜è®¤é…ç½®ä»¥åŠé…ç½®APIæ¥å¯¹å…¶è¿›è¡Œè‡ªå®šä¹‰ã€‚</p><p>æœ‰å…³é…ç½®APIä¸­æ²¡æœ‰çš„é«˜çº§è‡ªå®šä¹‰è®¾ç½®è¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-config-advanced-java">é«˜çº§ Java é…ç½®</a> å’Œ <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-config-advanced-xml">é«˜çº§ XML é…ç½®</a>.</p><p>æ‚¨æ— éœ€äº†è§£MVC Javaé…ç½®å’ŒMVCå‘½åç©ºé—´åˆ›å»ºçš„åŸºç¡€beanã€‚ å¦‚æœæ‚¨æƒ³äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…ç‰¹æ®ŠBeanç±»å‹å’ŒWeb MVCé…ç½®ã€‚<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-servlet-special-bean-types">ç‰¹æ®ŠBeanç±»å‹</a> å’Œ <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-servlet-config">Web MVCé…ç½®</a>.</p><h4 id="1-10-1-å¯ç”¨-MVC-é…ç½®"><a href="#1-10-1-å¯ç”¨-MVC-é…ç½®" class="headerlink" title="1.10.1. å¯ç”¨ MVC é…ç½®"></a>1.10.1. å¯ç”¨ MVC é…ç½®</h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-config-enable">Same as in Spring WebFlux</a></p><p>åœ¨Javaé…ç½®ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<code>@EnableWebMvc</code> æ³¨è§£å¯ç”¨MVCé…ç½®ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Configuration</span><br><br><span class="hljs-variable">@EnableWebMvc</span><br><br>public class WebConfig &#123;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨XMLé…ç½®ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<code>&lt;mvc:annotation-driven&gt;</code> å…ƒç´ æ¥å¯ç”¨MVCé…ç½®ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span>    <span class="hljs-attr">xmlns:mvc</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/mvc&quot;</span>    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;        http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans.xsd        http://www.springframework.org/schema/mvc        http://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">mvc:annotation-driven</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å‰é¢çš„ç¤ºä¾‹æ³¨å†Œäº†è®¸å¤šSpring MVCåŸºç¡€ç»“æ„beanï¼Œå¹¶é€‚åº”ç±»è·¯å¾„ä¸Šå¯ç”¨çš„ä¾èµ–é¡¹ï¼ˆä¾‹å¦‚ï¼ŒJSONï¼ŒXMLç­‰çš„æœ‰æ•ˆè´Ÿè½½è½¬æ¢å™¨ï¼‰ã€‚</p><h4 id="1-10-2-MVC-é…ç½®-API"><a href="#1-10-2-MVC-é…ç½®-API" class="headerlink" title="1.10.2. MVC é…ç½® API"></a>1.10.2. MVC é…ç½® API</h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-config-customize">Same as in Spring WebFlux</a></p><p>åœ¨Javaé…ç½®ä¸­ï¼Œæ‚¨å¯ä»¥å®ç°<code>WebMvcConfigurer</code>æ¥å£ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Configuration</span><span class="hljs-variable">@EnableWebMvcpublic</span> class WebConfig implements WebMvcConfigurer &#123;<br>    <span class="hljs-comment">// Implement configuration methods...&#125;</span><br></code></pre></td></tr></table></figure><p>åœ¨XMLä¸­ï¼Œæ‚¨å¯ä»¥æ£€æŸ¥<code>&lt;mvc:annotation-driven/&gt;</code>çš„å±æ€§å’Œå­å…ƒç´ ã€‚ æ‚¨å¯ä»¥æŸ¥çœ‹<a href="https://schema.spring.io/mvc/spring-mvc.xsd">Spring MVC XML schema</a> æˆ–ä½¿ç”¨IDEçš„ä»£ç å®ŒæˆåŠŸèƒ½æ¥å‘ç°å¯ç”¨çš„å±æ€§å’Œå­å…ƒç´ ã€‚</p><h4 id="1-10-3-ç±»å‹è½¬æ¢"><a href="#1-10-3-ç±»å‹è½¬æ¢" class="headerlink" title="1.10.3. ç±»å‹è½¬æ¢"></a>1.10.3. ç±»å‹è½¬æ¢</h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-config-conversion">Same as in Spring WebFlux</a></p><p>æ•°å­—çš„ <code>Number</code>ç±»å‹å’Œæ—¥æœŸ<code>Date</code> ç±»å‹çš„æ ¼å¼åŒ–æ˜¯é»˜è®¤å®‰è£…äº†çš„ï¼ŒåŒ…æ‹¬<code>@NumberFormat</code>æ³¨è§£å’Œ<code>@DateTimeFormat</code>æ³¨è§£ï¼Œå¦‚æœç±»è·¯å¾„ä¸­å­˜åœ¨Joda-Timeï¼Œåˆ™è¿˜ä¼šå®‰è£…å¯¹Joda-Timeæ ¼å¼åº“çš„å®Œå…¨æ”¯æŒã€‚</p><p>åœ¨Javaé…ç½®ä¸­ï¼Œæ‚¨å¯ä»¥æ³¨å†Œè‡ªå®šä¹‰æ ¼å¼åŒ–ç¨‹åºå’Œè½¬æ¢å™¨ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Configuration</span><span class="hljs-variable">@EnableWebMvcpublic</span> class WebConfig implements WebMvcConfigurer &#123;<br>    <span class="hljs-variable">@Override</span>    public void <span class="hljs-built_in">addFormatters</span>(FormatterRegistry registry) &#123;        <span class="hljs-comment">// ...    &#125;&#125;</span><br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•åœ¨XMLä¸­å®ç°ç›¸åŒçš„é…ç½®ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span>    <span class="hljs-attr">xmlns:mvc</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/mvc&quot;</span>    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;        http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans.xsd        http://www.springframework.org/schema/mvc        http://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">mvc:annotation-driven</span> <span class="hljs-attr">conversion-service</span>=<span class="hljs-string">&quot;conversionService&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;conversionService&quot;</span>            <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.format.support.FormattingConversionServiceFactoryBean&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;converters&quot;</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">set</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.example.MyConverter&quot;</span>/&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">set</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;formatters&quot;</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">set</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.example.MyFormatter&quot;</span>/&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.example.MyAnnotationFormatterFactory&quot;</span>/&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">set</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;formatterRegistrars&quot;</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">set</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.example.MyFormatterRegistrar&quot;</span>/&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">set</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æœ‰å…³ä½•æ—¶ä½¿ç”¨FormatterRegistrarå®ç°çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/core.html#format-FormatterRegistrar-SPI"><code>FormatterRegistrar</code> SPI</a>å’Œ <code>FormattingConversionServiceFactoryBean</code>ã€‚</p><h4 id="1-10-4-éªŒè¯"><a href="#1-10-4-éªŒè¯" class="headerlink" title="1.10.4. éªŒè¯"></a>1.10.4. éªŒè¯</h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-config-validation">Same as in Spring WebFlux</a></p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœç±»è·¯å¾„ä¸Šå­˜åœ¨<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/core.html#validation-beanvalidation-overview">Bean Validation</a>(ä¾‹å¦‚Hibernate Validatorï¼‰ï¼Œåˆ™ <code>LocalValidatorFactoryBean</code>å°†æ³¨å†Œä¸ºå…¨å±€<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/core.html#validator">Validator</a> ã€‚ ä»¥ä¾¿ä¸ <code>@Valid</code> å’Œ <code>Validated</code> ä¸€èµ·ä½¿ç”¨å¹¶åœ¨æ§åˆ¶å™¨æ–¹æ³•å‚æ•°ä¸Šè¿›è¡ŒéªŒè¯ã€‚</p><p>åœ¨Javaé…ç½®ä¸­ï¼Œæ‚¨å¯ä»¥è‡ªå®šä¹‰å…¨å±€<code>Validator</code>å®ä¾‹ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Configuration</span><span class="hljs-variable">@EnableWebMvcpublic</span> class WebConfig implements WebMvcConfigurer &#123;<br>    <span class="hljs-variable">@Override</span>    public Validator <span class="hljs-built_in">getValidator</span>(); &#123;        <span class="hljs-comment">// ...    &#125;&#125;</span><br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•åœ¨XMLä¸­å®ç°ç›¸åŒçš„é…ç½®:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span>    <span class="hljs-attr">xmlns:mvc</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/mvc&quot;</span>    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;        http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans.xsd        http://www.springframework.org/schema/mvc        http://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">mvc:annotation-driven</span> <span class="hljs-attr">validator</span>=<span class="hljs-string">&quot;globalValidator&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œæ‚¨è¿˜å¯ä»¥åœ¨æœ¬åœ°æ³¨å†Œ<code>Validator</code>å®ç°ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Controllerpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyController</span> &#123;<br>    <span class="hljs-meta">@InitBinder</span>    <span class="hljs-keyword">protected</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">initBinder</span>(<span class="hljs-params">WebDataBinder binder</span>) &#123;        binder.<span class="hljs-title function_">addValidators</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FooValidator</span>());    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœéœ€è¦åœ¨æŸå¤„æ³¨å…¥<code>LocalValidatorFactoryBean</code>ï¼Œè¯·åˆ›å»ºä¸€ä¸ªbeanå¹¶ä½¿ç”¨<code>@Primary</code>æ ‡è®°å®ƒï¼Œä»¥é¿å…ä¸MVCé…ç½®ä¸­å£°æ˜çš„é‚£ä¸ªå†²çªã€‚</p><h4 id="1-10-5-æ‹¦æˆªå™¨"><a href="#1-10-5-æ‹¦æˆªå™¨" class="headerlink" title="1.10.5. æ‹¦æˆªå™¨"></a>1.10.5. æ‹¦æˆªå™¨</h4><p>åœ¨Javaé…ç½®ä¸­ï¼Œæ³¨å†Œæ‹¦æˆªå™¨åº”ç”¨äºä¼ å…¥çš„è¯·æ±‚ã€‚å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Configuration</span><span class="hljs-variable">@EnableWebMvcpublic</span> class WebConfig implements WebMvcConfigurer &#123;<br>    <span class="hljs-variable">@Override</span>    public void <span class="hljs-built_in">addInterceptors</span>(InterceptorRegistry registry) &#123;        <span class="hljs-selector-tag">registry</span><span class="hljs-selector-class">.addInterceptor</span>(new <span class="hljs-built_in">LocaleChangeInterceptor</span>());        <span class="hljs-selector-tag">registry</span><span class="hljs-selector-class">.addInterceptor</span>(new <span class="hljs-built_in">ThemeChangeInterceptor</span>())<span class="hljs-selector-class">.addPathPatterns</span>(<span class="hljs-string">&quot;/**&quot;</span>)<span class="hljs-selector-class">.excludePathPatterns</span>(<span class="hljs-string">&quot;/admin/**&quot;</span>);        <span class="hljs-selector-tag">registry</span><span class="hljs-selector-class">.addInterceptor</span>(new <span class="hljs-built_in">SecurityInterceptor</span>())<span class="hljs-selector-class">.addPathPatterns</span>(<span class="hljs-string">&quot;/secure/*&quot;</span>);    &#125;&#125;<br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•åœ¨XMLä¸­å®ç°ç›¸åŒçš„é…ç½®ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mvc:interceptors</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.web.servlet.i18n.LocaleChangeInterceptor&quot;</span>/&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">mvc:interceptor</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">mvc:mapping</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/**&quot;</span>/&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">mvc:exclude-mapping</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/admin/**&quot;</span>/&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.web.servlet.theme.ThemeChangeInterceptor&quot;</span>/&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">mvc:interceptor</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">mvc:interceptor</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">mvc:mapping</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/secure/*&quot;</span>/&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.example.SecurityInterceptor&quot;</span>/&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">mvc:interceptor</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">mvc:interceptors</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="1-10-6-å†…å®¹ç±»å‹"><a href="#1-10-6-å†…å®¹ç±»å‹" class="headerlink" title="1.10.6. å†…å®¹ç±»å‹"></a>1.10.6. å†…å®¹ç±»å‹</h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-config-content-negotiation">Same as in Spring WebFlux</a></p><p>æ‚¨å¯ä»¥é…ç½®Spring MVCå¦‚ä½•æ ¹æ®è¯·æ±‚ç¡®å®šæ‰€è¯·æ±‚çš„åª’ä½“ç±»å‹ï¼ˆä¾‹å¦‚ï¼Œ<code>Accept</code>å¤´ï¼ŒURLè·¯å¾„æ‰©å±•ï¼ŒæŸ¥è¯¢å‚æ•°ç­‰ï¼‰ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œé¦–å…ˆæ£€æŸ¥URLè·¯å¾„æ‰©å±• - å°† <code>json</code>, <code>xml</code>, <code>rss</code>, å’Œ <code>atom</code>æ³¨å†Œä¸ºå·²çŸ¥æ‰©å±•ï¼ˆå–å†³äºç±»è·¯å¾„ä¾èµ–æ€§ï¼‰ã€‚ ç¬¬äºŒä¸ªæ£€æŸ¥ <code>Accept</code>å¤´ã€‚</p><p>å°†è¿™äº›é»˜è®¤å€¼æ›´æ”¹ä¸ºåªæ¥å—<code>Accept</code>å¤´ï¼Œå¹¶ä¸”å¦‚æœå¿…é¡»ä½¿ç”¨åŸºäºå†…å®¹ç±»å‹è§£æï¼Œè¯·è€ƒè™‘è·¯å¾„æ‰©å±•ä¸Šçš„æŸ¥è¯¢å‚æ•°ç­–ç•¥ã€‚ æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-requestmapping-suffix-pattern-match">åç¼€åŒ¹é…</a> and <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-requestmapping-rfd">åç¼€åŒ¹é…ä»¥åŠRFD</a>ã€‚</p><p>åœ¨Javaé…ç½®ä¸­ï¼Œæ‚¨å¯ä»¥è‡ªå®šä¹‰è¯·æ±‚çš„å†…å®¹ç±»å‹è§£æï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Configuration</span><span class="hljs-variable">@EnableWebMvcpublic</span> class WebConfig implements WebMvcConfigurer &#123;<br>    <span class="hljs-variable">@Override</span>    public void <span class="hljs-built_in">configureContentNegotiation</span>(ContentNegotiationConfigurer configurer) &#123;        <span class="hljs-selector-tag">configurer</span><span class="hljs-selector-class">.mediaType</span>(<span class="hljs-string">&quot;json&quot;</span>, MediaType.APPLICATION_JSON);        <span class="hljs-selector-tag">configurer</span><span class="hljs-selector-class">.mediaType</span>(<span class="hljs-string">&quot;xml&quot;</span>, MediaType.APPLICATION_XML);    &#125;&#125;<br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•åœ¨XMLä¸­å®ç°ç›¸åŒçš„é…ç½®ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mvc:annotation-driven</span> <span class="hljs-attr">content-negotiation-manager</span>=<span class="hljs-string">&quot;contentNegotiationManager&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;contentNegotiationManager&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.web.accept.ContentNegotiationManagerFactoryBean&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;mediaTypes&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>            json=application/json            xml=application/xml        <span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="1-10-7-æ¶ˆæ¯è½¬æ¢"><a href="#1-10-7-æ¶ˆæ¯è½¬æ¢" class="headerlink" title="1.10.7. æ¶ˆæ¯è½¬æ¢"></a>1.10.7. æ¶ˆæ¯è½¬æ¢</h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-config-message-codecs">Same as in Spring WebFlux</a></p><p>ä½¿ç”¨MVC Javaç¼–ç¨‹é…ç½®æ–¹å¼æ—¶ï¼Œå¦‚æœæƒ³æ›¿æ¢Spring MVCæä¾›çš„é»˜è®¤è½¬æ¢å™¨ï¼Œå®Œå…¨å®šåˆ¶è‡ªå·±çš„<code>HttpMessageConverter</code> ï¼Œè¿™å¯ä»¥é€šè¿‡è¦†å†™<a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/web/servlet/config/annotation/WebMvcConfigurer.html#configureMessageConverters-java.util.List-"><code>configureMessageConverters()</code></a>æ–¹æ³•æ¥å®ç°ã€‚ å¦‚æœåªæ˜¯æƒ³è‡ªå®šä¹‰ï¼Œæˆ–è€…æƒ³åœ¨é»˜è®¤è½¬æ¢å™¨ä¹‹å¤–å†æ·»åŠ å…¶ä»–çš„è½¬æ¢å™¨ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡è¦†å†™<a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/web/servlet/config/annotation/WebMvcConfigurer.html#extendMessageConverters-java.util.List-"><code>extendMessageConverters()</code></a>æ–¹æ³•æ¥å®ç°ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹ä½¿ç”¨è‡ªå®šä¹‰çš„<code>ObjectMapper</code>è€Œä¸æ˜¯é»˜è®¤çš„<code>ObjectMapper</code>æ·»åŠ XMLå’ŒJackson JSONè½¬æ¢å™¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@EnableWebMvcpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebConfiguration</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span> &#123;<br>    <span class="hljs-meta">@Override</span>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configureMessageConverters</span><span class="hljs-params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> &#123;        <span class="hljs-type">Jackson2ObjectMapperBuilder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jackson2ObjectMapperBuilder</span>()                .indentOutput(<span class="hljs-literal">true</span>)                .dateFormat(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>))                .modulesToInstall(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ParameterNamesModule</span>());        converters.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MappingJackson2HttpMessageConverter</span>(builder.build()));        converters.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MappingJackson2XmlHttpMessageConverter</span>(builder.createXmlMapper(<span class="hljs-literal">true</span>).build()));    &#125;&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ<a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/http/converter/json/Jackson2ObjectMapperBuilder.html"><code>Jackson2ObjectMapperBuilder</code></a> ç”¨äºä¸º <code>MappingJackson2HttpMessageConverter</code> å’Œ<code>MappingJackson2XmlHttpMessageConverter</code> è½¬æ¢å™¨åˆ›å»ºå…¬å…±çš„é…ç½®ï¼Œæ¯”å¦‚å¯ç”¨tabç¼©è¿›ã€å®šåˆ¶çš„æ—¥æœŸæ ¼å¼ï¼Œå¹¶æ³¨å†Œäº†æ¨¡å— <a href="https://github.com/FasterXML/jackson-module-parameter-names"><code>jackson-module-parameter-names</code></a>ç”¨äºè·å–å‚æ•°åï¼ˆJava 8æ–°å¢çš„ç‰¹æ€§ï¼‰ã€‚</p><p>è¯¥builderä¼šä½¿ç”¨ä»¥ä¸‹çš„é»˜è®¤å±æ€§å¯¹Jacksonè¿›è¡Œé…ç½®</p><ul><li><a href="https://fasterxml.github.io/jackson-databind/javadoc/2.6/com/fasterxml/jackson/databind/DeserializationFeature.html#FAIL_ON_UNKNOWN_PROPERTIES"><code>DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES</code></a> is disabled.</li><li><a href="https://fasterxml.github.io/jackson-databind/javadoc/2.6/com/fasterxml/jackson/databind/MapperFeature.html#DEFAULT_VIEW_INCLUSION"><code>MapperFeature.DEFAULT_VIEW_INCLUSION</code></a> is disabled.</li></ul><p>åŒæ—¶ï¼Œå¦‚æœæ£€æµ‹åˆ°åœ¨classpathè·¯å¾„ä¸‹å­˜åœ¨è¿™äº›æ¨¡å—ï¼Œè¯¥builderä¹Ÿä¼šè‡ªåŠ¨åœ°æ³¨å†Œå®ƒä»¬ã€‚</p><ul><li><a href="https://github.com/FasterXML/jackson-datatype-jdk7">jackson-datatype-jdk7</a>: Support for Java 7 types, such as <code>java.nio.file.Path</code>.</li><li><a href="https://github.com/FasterXML/jackson-datatype-joda">jackson-datatype-joda</a>: Support for Joda-Time types.</li><li><a href="https://github.com/FasterXML/jackson-datatype-jsr310">jackson-datatype-jsr310</a>: Support for Java 8 Date and Time API types.</li><li><a href="https://github.com/FasterXML/jackson-datatype-jdk8">jackson-datatype-jdk8</a>: Support for other Java 8 types, such as <code>Optional</code>.</li></ul><p>é™¤äº†<a href="https://search.maven.org/#search|ga|1|a%3A%22jackson-dataformat-xml%22"><code>jackson-dataformat-xml</code></a> ä¹‹å¤–ï¼Œè¦å¯ç”¨Jackson XMLçš„tabç¼©è¿›è¿˜éœ€è¦[<code>woodstox-core-asl</code>](<a href="https://search.maven.org/#search|gav|1|g%3A%22org.codehaus.woodstox">https://search.maven.org/#search|gav|1|g%3A&quot;org.codehaus.woodstox</a>â€œ AND a%3Aâ€woodstox-core-aslâ€)ä¾èµ–ã€‚</p><p>è¿˜æœ‰å…¶ä»–æœ‰ç”¨çš„Jacksonæ¨¡å—å¯ä»¥ä½¿ç”¨</p><ul><li><a href="https://github.com/zalando/jackson-datatype-money">jackson-datatype-money</a>: æä¾›äº†å¯¹<code>javax.money</code> ç±»å‹çš„æ”¯æŒï¼ˆéå®˜æ–¹æ¨¡å—ï¼‰</li><li><a href="https://github.com/FasterXML/jackson-datatype-hibernate">jackson-datatype-hibernate</a>:æä¾›äº†Hibernateç›¸å…³çš„ç±»å‹å’Œå±æ€§æ”¯æŒï¼ˆåŒ…å«æ‡’åŠ è½½aspectsï¼‰</li></ul><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•åœ¨XMLä¸­å®ç°ç›¸åŒçš„é…ç½®ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mvc:annotation-driven</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">mvc:message-converters</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.http.converter.json.MappingJackson2HttpMessageConverter&quot;</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;objectMapper&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;objectMapper&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.http.converter.xml.MappingJackson2XmlHttpMessageConverter&quot;</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;objectMapper&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;xmlMapper&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">mvc:message-converters</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mvc:annotation-driven</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;objectMapper&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.http.converter.json.Jackson2ObjectMapperFactoryBean&quot;</span>      <span class="hljs-attr">p:indentOutput</span>=<span class="hljs-string">&quot;true&quot;</span>      <span class="hljs-attr">p:simpleDateFormat</span>=<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>      <span class="hljs-attr">p:modulesToInstall</span>=<span class="hljs-string">&quot;com.fasterxml.jackson.module.paramnames.ParameterNamesModule&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;xmlMapper&quot;</span> <span class="hljs-attr">parent</span>=<span class="hljs-string">&quot;objectMapper&quot;</span> <span class="hljs-attr">p:createXmlMapper</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><h4 id="1-10-8-è§†å›¾æ§åˆ¶å™¨"><a href="#1-10-8-è§†å›¾æ§åˆ¶å™¨" class="headerlink" title="1.10.8. è§†å›¾æ§åˆ¶å™¨"></a>1.10.8. è§†å›¾æ§åˆ¶å™¨</h4><p>ä»¥ä¸‹çš„ä¸€æ®µä»£ç ç›¸å½“äºå®šä¹‰<code>ParameterizableViewController</code> è§†å›¾æ§åˆ¶å™¨çš„å¿«æ·æ–¹å¼ï¼Œè¯¥æ§åˆ¶å™¨ä¼šç«‹å³å°†è¯·æ±‚è½¬å‘ï¼ˆforwardsï¼‰ç»™è§†å›¾ã€‚è¯·ç¡®ä¿ä»…åœ¨ä»¥ä¸‹æƒ…æ™¯ä¸‹æ‰ä½¿ç”¨è¿™ä¸ªç±»ï¼šå½“æ§åˆ¶å™¨é™¤äº†å°†è§†å›¾æ¸²æŸ“åˆ°å“åº”ä¸­å¤–ä¸éœ€è¦æ‰§è¡Œä»»ä½•é€»è¾‘æ—¶ã€‚</p><p>ä»¥ä¸‹Javaé…ç½®ç¤ºä¾‹å°†å¯¹ <code>/</code>çš„è¯·æ±‚è½¬å‘ç»™åä¸º<code>home</code>çš„è§†å›¾:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Configuration</span><span class="hljs-variable">@EnableWebMvcpublic</span> class WebConfig implements WebMvcConfigurer &#123;<br>    <span class="hljs-variable">@Override</span>    public void <span class="hljs-built_in">addViewControllers</span>(ViewControllerRegistry registry) &#123;        <span class="hljs-selector-tag">registry</span><span class="hljs-selector-class">.addViewController</span>(<span class="hljs-string">&quot;/&quot;</span>)<span class="hljs-selector-class">.setViewName</span>(<span class="hljs-string">&quot;home&quot;</span>);    &#125;&#125;<br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹ç¤ºä¾‹ä¸å‰é¢çš„ç¤ºä¾‹å®ç°ç›¸åŒçš„åŠŸèƒ½ï¼Œä½†ä½¿ç”¨XMLï¼Œé€šè¿‡ä½¿ç”¨<code>&lt;mvc:view-controller&gt;</code>å…ƒç´ :</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">&lt;mvc:<span class="hljs-keyword">view</span>-controller <span class="hljs-type">path</span>=&quot;/&quot; <span class="hljs-keyword">view</span>-<span class="hljs-type">name</span>=&quot;home&quot;/&gt;<br></code></pre></td></tr></table></figure><h4 id="1-10-9-è§†å›¾è§£æå™¨"><a href="#1-10-9-è§†å›¾è§£æå™¨" class="headerlink" title="1.10.9. è§†å›¾è§£æå™¨"></a>1.10.9. è§†å›¾è§£æå™¨</h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-config-view-resolvers">Same as in Spring WebFlux</a></p><p>MVCæä¾›çš„é…ç½®ç®€åŒ–äº†è§†å›¾è§£æå™¨çš„æ³¨å†Œå·¥ä½œ</p><p>ä»¥ä¸‹Javaé…ç½®ç¤ºä¾‹ä½¿ç”¨JSPå’ŒJacksonä½œä¸ºJSONå‘ˆç°çš„é»˜è®¤è§†å›¾æ¥é…ç½®å†…å®¹åå•†è§†å›¾è§£æï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Configuration</span><span class="hljs-variable">@EnableWebMvcpublic</span> class WebConfig implements WebMvcConfigurer &#123;<br>    <span class="hljs-variable">@Override</span>    public void <span class="hljs-built_in">configureViewResolvers</span>(ViewResolverRegistry registry) &#123;        <span class="hljs-selector-tag">registry</span><span class="hljs-selector-class">.enableContentNegotiation</span>(new <span class="hljs-built_in">MappingJackson2JsonView</span>());        <span class="hljs-selector-tag">registry</span><span class="hljs-selector-class">.jsp</span>();    &#125;&#125;<br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•åœ¨XMLä¸­å®ç°ç›¸åŒçš„é…ç½®ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mvc:view-resolvers</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">mvc:content-negotiation</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">mvc:default-views</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.web.servlet.view.json.MappingJackson2JsonView&quot;</span>/&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">mvc:default-views</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">mvc:content-negotiation</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">mvc:jsp</span>/&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">mvc:view-resolvers</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä½†è¯·æ³¨æ„ï¼ŒFreeMarkerï¼ŒTilesï¼ŒGroovy Markupå’Œè„šæœ¬æ¨¡æ¿ä¹Ÿéœ€è¦é…ç½®åº•å±‚è§†å›¾æŠ€æœ¯ã€‚</p><p>MVCåç§°ç©ºé—´æä¾›ä¸“ç”¨å…ƒç´ ã€‚ ä»¥ä¸‹ç¤ºä¾‹é€‚ç”¨äºFreeMarkerï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mvc:view-resolvers</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">mvc:content-negotiation</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">mvc:default-views</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.web.servlet.view.json.MappingJackson2JsonView&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">mvc:default-views</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">mvc:content-negotiation</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">mvc:freemarker</span> <span class="hljs-attr">cache</span>=<span class="hljs-string">&quot;false&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mvc:view-resolvers</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mvc:freemarker-configurer</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">mvc:template-loader-path</span> <span class="hljs-attr">location</span>=<span class="hljs-string">&quot;/freemarker&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mvc:freemarker-configurer</span>&gt;</span><br></code></pre></td></tr></table></figure><p>åœ¨Javaé…ç½®ä¸­ï¼Œæ‚¨å¯ä»¥æ·»åŠ ç›¸åº”çš„<code>Configurer</code> beanï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@EnableWebMvcpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span> &#123;<br>    <span class="hljs-meta">@Override</span>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">configureViewResolvers</span>(<span class="hljs-params">ViewResolverRegistry registry</span>) &#123;        registry.<span class="hljs-title function_">enableContentNegotiation</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MappingJackson2JsonView</span>());        registry.<span class="hljs-title function_">freeMarker</span>().<span class="hljs-title function_">cache</span>(<span class="hljs-literal">false</span>);    &#125;<br>    <span class="hljs-meta">@Bean</span>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">FreeMarkerConfigurer</span> <span class="hljs-title function_">freeMarkerConfigurer</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-title class_">FreeMarkerConfigurer</span> configurer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FreeMarkerConfigurer</span>();        configurer.<span class="hljs-title function_">setTemplateLoaderPath</span>(<span class="hljs-string">&quot;/freemarker&quot;</span>);        <span class="hljs-keyword">return</span> configurer;    &#125;&#125;<br></code></pre></td></tr></table></figure><h4 id="1-10-10-é™æ€èµ„æº"><a href="#1-10-10-é™æ€èµ„æº" class="headerlink" title="1.10.10. é™æ€èµ„æº"></a>1.10.10. é™æ€èµ„æº</h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-config-static-resources">Same as in Spring WebFlux</a></p><p>æ­¤é€‰é¡¹æä¾›äº†ä¸€ç§ä» <a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/core/io/Resource.html"><code>èµ„æº</code></a>åº“ä½ç½®åˆ—è¡¨ä¸­ä½¿ç”¨é™æ€èµ„æºçš„ä¾¿æ·æ–¹æ³•</p><p>åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œç»™å®šä»¥ <code>/resources</code>å¼€å¤´çš„è¯·æ±‚ï¼Œç›¸å¯¹è·¯å¾„ç”¨äºåœ¨Webåº”ç”¨ç¨‹åºæ ¹ç›®å½•ä¸‹æˆ–åœ¨æˆ–åœ¨<code>/static</code>ä¸‹çš„ç±»è·¯å¾„ä¸ŠæŸ¥æ‰¾å’Œæä¾›ç›¸å¯¹äº<code>/public</code>çš„é™æ€èµ„æºã€‚ èµ„æºçš„æœ‰æ•ˆæœŸä¸º1å¹´ï¼Œä»¥ç¡®ä¿æœ€å¤§ç¨‹åº¦åœ°ä½¿ç”¨æµè§ˆå™¨ç¼“å­˜ï¼Œå¹¶å‡å°‘æµè§ˆå™¨å‘å‡ºçš„HTTPè¯·æ±‚ã€‚å¦‚æœè¿”å› <code>304</code>çŠ¶æ€ä»£ç ï¼Œ<code>Last-Modified</code> å¤´ä¹Ÿä¼šè®¡ç®—åˆ°ã€‚</p><p>ä»¥ä¸‹æ¸…å•æ˜¾ç¤ºäº†å¦‚ä½•ä½¿ç”¨Javaé…ç½®æ‰§è¡Œæ­¤æ“ä½œ:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Configuration</span><span class="hljs-variable">@EnableWebMvcpublic</span> class WebConfig implements WebMvcConfigurer &#123;<br>    <span class="hljs-variable">@Override</span>    public void <span class="hljs-built_in">addResourceHandlers</span>(ResourceHandlerRegistry registry) &#123;        <span class="hljs-selector-tag">registry</span><span class="hljs-selector-class">.addResourceHandler</span>(<span class="hljs-string">&quot;/resources/**&quot;</span>)            <span class="hljs-selector-class">.addResourceLocations</span>(<span class="hljs-string">&quot;/public&quot;</span>, <span class="hljs-string">&quot;classpath:/static/&quot;</span>)            <span class="hljs-selector-class">.setCachePeriod</span>(<span class="hljs-number">31556926</span>);    &#125;&#125;<br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•åœ¨XMLä¸­å®ç°ç›¸åŒçš„é…ç½®ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;mvc:resources <span class="hljs-attribute">mapping</span>=<span class="hljs-string">&quot;/resources/**&quot;</span><br><br>    <span class="hljs-attribute">location</span>=<span class="hljs-string">&quot;/public, classpath:/static/&quot;</span><br><br>    <span class="hljs-attribute">cache-period</span>=<span class="hljs-string">&quot;31556926&quot;</span> /&gt;<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹ <a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-caching-static-resources">é™æ€èµ„æºçš„HTTPç¼“å­˜æ”¯æŒ</a>.</p><p>èµ„æºå¤„ç†è¿˜æ”¯æŒä¸€ç³»åˆ— <a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/web/servlet/resource/ResourceResolver.html"><code>ResourceResolver</code></a> å®ç° å’Œ <a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/web/servlet/resource/ResourceTransformer.html"><code>ResourceTransformer</code></a> å®ç°, å¯ç”¨äºåˆ›å»ºç”¨äºä½¿ç”¨ä¼˜åŒ–èµ„æºçš„å·¥å…·</p><p><code>VersionResourceResolver</code>å¯ç”¨äºåŸºäºå†…å®¹ã€å›ºå®šåº”ç”¨ç¨‹åºç‰ˆæœ¬æˆ–å…¶ä»–çš„MD5å“ˆå¸Œè®¡ç®—çš„ç‰ˆæœ¬åŒ–èµ„æºurlã€‚<code>ContentVersionStrategy</code>(MD5 hash)æ–¹æ³•æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œ æœ‰ä¸€äº›å€¼å¾—æ³¨æ„çš„ä¾‹å¤–ï¼Œä¾‹å¦‚ä¸æ¨¡å—åŠ è½½å™¨ä¸€èµ·ä½¿ç”¨çš„JavaScriptèµ„æºã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•åœ¨Javaé…ç½®ä¸­ä½¿ç”¨ <code>VersionResourceResolver</code>ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Configuration</span><span class="hljs-variable">@EnableWebMvcpublic</span> class WebConfig implements WebMvcConfigurer &#123;<br>    <span class="hljs-variable">@Override</span>    public void <span class="hljs-built_in">addResourceHandlers</span>(ResourceHandlerRegistry registry) &#123;        <span class="hljs-selector-tag">registry</span><span class="hljs-selector-class">.addResourceHandler</span>(<span class="hljs-string">&quot;/resources/**&quot;</span>)                <span class="hljs-selector-class">.addResourceLocations</span>(<span class="hljs-string">&quot;/public/&quot;</span>)                <span class="hljs-selector-class">.resourceChain</span>(true)                <span class="hljs-selector-class">.addResolver</span>(new <span class="hljs-built_in">VersionResourceResolver</span>().<span class="hljs-built_in">addContentVersionStrategy</span>(<span class="hljs-string">&quot;/**&quot;</span>));    &#125;&#125;<br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•åœ¨XMLä¸­å®ç°ç›¸åŒçš„é…ç½®ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mvc:resources</span> <span class="hljs-attr">mapping</span>=<span class="hljs-string">&quot;/resources/**&quot;</span> <span class="hljs-attr">location</span>=<span class="hljs-string">&quot;/public/&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">mvc:resource-chain</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">mvc:resource-cache</span>/&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">mvc:resolvers</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">mvc:version-resolver</span>&gt;</span><br><br>                <span class="hljs-tag">&lt;<span class="hljs-name">mvc:content-version-strategy</span> <span class="hljs-attr">patterns</span>=<span class="hljs-string">&quot;/**&quot;</span>/&gt;</span><br><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">mvc:version-resolver</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">mvc:resolvers</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">mvc:resource-chain</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">mvc:resources</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æ‚¨å¯ä»¥ä½¿ç”¨<code>ResourceUrlProvider</code>æ¥é‡å†™URLå¹¶åº”ç”¨å®Œæ•´çš„è§£æå™¨å’Œè½¬æ¢å™¨é“¾ï¼Œä¾‹å¦‚æ’å…¥ç‰ˆæœ¬ã€‚MVCé…ç½®æä¾›äº† <code>ResourceUrlProvider</code> beanï¼Œå› æ­¤å¯ä»¥å°†å…¶æ³¨å…¥åˆ°å…¶ä»–ç”¨æˆ·ã€‚ æ‚¨è¿˜å¯ä»¥ä½¿ç”¨<code>ResourceUrlEncodingFilter</code> çš„Thymeleafã€jspã€FreeMarkerå’Œå…¶ä»–ä¾èµ–äº<code>HttpServletResponse#encodeURL</code>çš„URLæ ‡è®°æ¥åšé‡å†™è½¬æ¢ã€‚</p><p>è¯·æ³¨æ„ï¼Œå½“åŒæ—¶ä½¿ç”¨<code>EncodedResourceResolver</code>ï¼ˆä¾‹å¦‚ï¼Œç”¨äºæä¾›gzippedæˆ–brotliç¼–ç çš„èµ„æºï¼‰å’Œ<code>VersionedResourceResolver</code>æ—¶ï¼Œå¿…é¡»æŒ‰æ­¤é¡ºåºæ³¨å†Œå®ƒä»¬ã€‚ è¿™å¯ç¡®ä¿å§‹ç»ˆåŸºäºæœªç¼–ç çš„æ–‡ä»¶å¯é åœ°è®¡ç®—åŸºäºå†…å®¹çš„ç‰ˆæœ¬ã€‚</p><p><a href="http://www.webjars.org/documentation">WebJars</a>ä¹Ÿæ”¯æŒä½¿ç”¨<code>WebJarsResourceResolver</code>å’Œè‡ªåŠ¨æ³¨å†Œï¼Œå½“ <code>org.webjars:webjars-locator</code>å­˜åœ¨äºç±»è·¯å¾„ä¸­æ—¶ã€‚è§£æå™¨å¯ä»¥é‡å†™URLæ¥åŒ…å«jarçš„ç‰ˆæœ¬ï¼Œä¹Ÿå¯ä»¥ä¸ä¼ å…¥çš„URLåŒ¹é…ï¼Œè€Œä¸éœ€è¦ç‰ˆæœ¬ ã€‚ ä¾‹å¦‚ï¼Œ <code>/jquery/jquery.min.js</code> åˆ° <code>/jquery/1.2.0/jquery.min.js</code>ã€‚</p><h4 id="1-10-11-é»˜è®¤-Servlet"><a href="#1-10-11-é»˜è®¤-Servlet" class="headerlink" title="1.10.11. é»˜è®¤ Servlet"></a>1.10.11. é»˜è®¤ Servlet</h4><p>è¿™äº›é…ç½®å…è®¸å°†<code>DispatcherServlet</code>æ˜ å°„åˆ°<code>/</code>è·¯å¾„ï¼ˆä¹Ÿå³è¦†ç›–äº†å®¹å™¨é»˜è®¤Servletçš„æ˜ å°„ï¼‰ï¼Œä½†ä¾ç„¶ä¿ç•™å®¹å™¨é»˜è®¤çš„Servletä»¥å¤„ç†é™æ€èµ„æºçš„è¯·æ±‚ã€‚è¿™å¯ä»¥é€šè¿‡é…ç½®ä¸€ä¸ªURLæ˜ å°„åˆ° <code>/**</code> çš„å¤„ç†å™¨<code>DefaultServletHttpRequestHandler</code>æ¥å®ç°ï¼Œå¹¶ä¸”è¯¥å¤„ç†å™¨åœ¨å…¶ä»–æ‰€æœ‰URLæ˜ å°„å…³ç³»ä¸­ä¼˜å…ˆçº§åº”è¯¥æ˜¯æœ€ä½çš„ã€‚</p><p>è¯¥å¤„ç†å™¨ä¼šå°†æ‰€æœ‰è¯·æ±‚è½¬å‘ï¼ˆforwardï¼‰åˆ°é»˜è®¤çš„Servletï¼Œå› æ­¤éœ€è¦ä¿è¯å®ƒåœ¨æ‰€æœ‰URLå¤„ç†å™¨æ˜ å°„<code>HandlerMappings</code>çš„æœ€åã€‚å¦‚æœä½ æ˜¯é€šè¿‡<code>&lt;mvc:annotation-driven&gt;</code>çš„æ–¹å¼è¿›è¡Œé…ç½®ï¼Œ æˆ–è‡ªå®šä¹‰ <code>HandlerMapping</code> å®ä¾‹ï¼Œé‚£ä¹ˆéœ€è¦ç¡®ä¿è¯¥å¤„ç†å™¨<code>order</code>å±æ€§çš„å€¼æ¯”<code>DefaultServletHttpRequestHandler</code>çš„æ¬¡åºå€¼<code>Integer.MAX_VALUE</code>å°ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•ä½¿ç”¨é»˜è®¤è®¾ç½®å¯ç”¨è¯¥åŠŸèƒ½ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Configuration</span><span class="hljs-variable">@EnableWebMvcpublic</span> class WebConfig implements WebMvcConfigurer &#123;<br>    <span class="hljs-variable">@Override</span>    public void <span class="hljs-built_in">configureDefaultServletHandling</span>(DefaultServletHandlerConfigurer configurer) &#123;        <span class="hljs-selector-tag">configurer</span><span class="hljs-selector-class">.enable</span>();    &#125;&#125;<br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•åœ¨XMLä¸­å®ç°ç›¸åŒçš„é…ç½®ï¼š</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs aspectj">&lt;mvc:<span class="hljs-keyword">default</span>-servlet-<span class="hljs-keyword">handler</span>/&gt;<br></code></pre></td></tr></table></figure><p>ä¸è¿‡éœ€è¦æ³¨æ„ï¼Œè¦†å†™äº†<code>/</code>çš„Servletæ˜ å°„åï¼Œé»˜è®¤Servletçš„<code>RequestDispatcher</code>å°±å¿…é¡»é€šè¿‡åå­—è€Œéè·¯å¾„æ¥å–å¾—äº†ã€‚ <code>DefaultServletHttpRequestHandler</code>ä¼šå°è¯•åœ¨å®¹å™¨åˆå§‹åŒ–çš„æ—¶å€™è‡ªåŠ¨æ£€æµ‹é»˜è®¤Servletï¼Œ è¿™é‡Œå®ƒä½¿ç”¨çš„æ˜¯ä¸€ä»½ä¸»æµServletå®¹å™¨ï¼ˆåŒ…æ‹¬Tomcat, Jetty, GlassFish, JBoss, Resin, WebLogic, and WebSphereï¼‰å·²çŸ¥çš„åç§°åˆ—è¡¨ã€‚å¦‚æœé»˜è®¤Servletè¢«é…ç½®äº†ä¸€ä¸ªå…¶ä»–çš„åå­—ï¼Œæˆ–è€…ä½¿ç”¨äº†ä¸€ä¸ªåˆ—è¡¨é‡Œæœªæä¾›é»˜è®¤Servletåç§°çš„å®¹å™¨ï¼Œé‚£ä¹ˆé»˜è®¤Servletçš„åç§°å¿…é¡»è¢«æ˜¾å¼æŒ‡å®šï¼Œæ­£å¦‚ä¸‹é¢ä»£ç æ‰€ç¤ºï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Configuration</span><span class="hljs-variable">@EnableWebMvcpublic</span> class WebConfig implements WebMvcConfigurer &#123;<br>    <span class="hljs-variable">@Override</span>    public void <span class="hljs-built_in">configureDefaultServletHandling</span>(DefaultServletHandlerConfigurer configurer) &#123;        <span class="hljs-selector-tag">configurer</span><span class="hljs-selector-class">.enable</span>(<span class="hljs-string">&quot;myCustomDefaultServlet&quot;</span>);    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•åœ¨XMLä¸­å®ç°ç›¸åŒçš„é…ç½®ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">&lt;mvc:<span class="hljs-keyword">default</span>-servlet-<span class="hljs-keyword">handler</span> <span class="hljs-keyword">default</span>-servlet-<span class="hljs-type">name</span>=&quot;myCustomDefaultServlet&quot;/&gt;<br></code></pre></td></tr></table></figure><h4 id="1-10-12-è·¯å¾„åŒ¹é…"><a href="#1-10-12-è·¯å¾„åŒ¹é…" class="headerlink" title="1.10.12. è·¯å¾„åŒ¹é…"></a>1.10.12. è·¯å¾„åŒ¹é…</h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-config-path-matching">Same as in Spring WebFlux</a></p><p>æ‚¨å¯ä»¥è‡ªå®šä¹‰ä¸è·¯å¾„åŒ¹é…å’ŒURLå¤„ç†ç›¸å…³çš„é€‰é¡¹ã€‚ æœ‰å…³å„ä¸ªé€‰é¡¹çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="https://docs.spring.io/spring-framework/docs/5.1.3.RELEASE/javadoc-api/org/springframework/web/servlet/config/annotation/PathMatchConfigurer.html"><code>PathMatchConfigurer</code></a> javadoc.</p><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•åœ¨Javaé…ç½®ä¸­è‡ªå®šä¹‰è·¯å¾„åŒ¹é…ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@EnableWebMvcpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span> &#123;<br>    <span class="hljs-meta">@Override</span>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">configurePathMatch</span>(<span class="hljs-params">PathMatchConfigurer configurer</span>) &#123;        configurer            .<span class="hljs-title function_">setUseSuffixPatternMatch</span>(<span class="hljs-literal">true</span>)            .<span class="hljs-title function_">setUseTrailingSlashMatch</span>(<span class="hljs-literal">false</span>)            .<span class="hljs-title function_">setUseRegisteredSuffixPatternMatch</span>(<span class="hljs-literal">true</span>)            .<span class="hljs-title function_">setPathMatcher</span>(<span class="hljs-title function_">antPathMatcher</span>())            .<span class="hljs-title function_">setUrlPathHelper</span>(<span class="hljs-title function_">urlPathHelper</span>())            .<span class="hljs-title function_">addPathPrefix</span>(<span class="hljs-string">&quot;/api&quot;</span>,                    <span class="hljs-title class_">HandlerTypePredicate</span>.<span class="hljs-title function_">forAnnotation</span>(<span class="hljs-title class_">RestController</span>.<span class="hljs-property">class</span>));    &#125;<br>    <span class="hljs-meta">@Bean</span>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">UrlPathHelper</span> <span class="hljs-title function_">urlPathHelper</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-comment">//...    &#125;</span><br>    <span class="hljs-meta">@Bean</span>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">PathMatcher</span> <span class="hljs-title function_">antPathMatcher</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-comment">//...    &#125;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•åœ¨XMLä¸­å®ç°ç›¸åŒçš„é…ç½®ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;mvc:annotation-driven&gt;    &lt;mvc:path-matching        <span class="hljs-attribute">suffix-pattern</span>=<span class="hljs-string">&quot;true&quot;</span>        <span class="hljs-attribute">trailing-slash</span>=<span class="hljs-string">&quot;false&quot;</span>        <span class="hljs-attribute">registered-suffixes-only</span>=<span class="hljs-string">&quot;true&quot;</span>        <span class="hljs-attribute">path-helper</span>=<span class="hljs-string">&quot;pathHelper&quot;</span>        <span class="hljs-attribute">path-matcher</span>=<span class="hljs-string">&quot;pathMatcher&quot;</span>/&gt;&lt;/mvc:annotation-driven&gt;<br>&lt;bean <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;pathHelper&quot;</span> <span class="hljs-attribute">class</span>=<span class="hljs-string">&quot;org.example.app.MyPathHelper&quot;</span>/&gt;&lt;bean <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;pathMatcher&quot;</span> <span class="hljs-attribute">class</span>=<span class="hljs-string">&quot;org.example.app.MyPathMatcher&quot;</span>/&gt;<br></code></pre></td></tr></table></figure><h4 id="1-10-13-é«˜çº§-Java-é…ç½®"><a href="#1-10-13-é«˜çº§-Java-é…ç½®" class="headerlink" title="1.10.13. é«˜çº§ Java é…ç½®"></a>1.10.13. é«˜çº§ Java é…ç½®</h4><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-config-advanced-java">Same as in Spring WebFlux</a></p><p><code>@EnableWebMvc</code> å¯¼å…¥ <code>DelegatingWebMvcConfiguration</code>, å…¶ä¸­:</p><ul><li>ä¸ºSpring MVCåº”ç”¨ç¨‹åºæä¾›äº†é»˜è®¤çš„Springé…ç½®</li><li>æ£€æµ‹åˆ°å¹¶å§”æ´¾åˆ°<code>WebMvcConfigurer</code>çš„è‡ªå®šä¹‰è¯¥é…ç½®</li></ul><p>å¯¹äºé«˜çº§æ¨¡å¼ï¼Œè¯·åˆ é™¤<code>@EnableWebMvc</code>å¹¶ç›´æ¥ä» <code>DelegatingWebMvcConfiguration</code>ç»§æ‰¿ ï¼Œè€Œä¸æ˜¯å®ç°<code>WebMvcConfigurer</code>ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-meta">@Configurationpublic</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">DelegatingWebMvcConfiguration</span> </span>&#123;<br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥åœ¨<code>WebConfig</code>ä¸­ä¿ç•™ç°æœ‰çš„æ–¹æ³•ï¼Œä½†ç°åœ¨ä¹Ÿå¯ä»¥é‡å†™åŸºç±»ä¸­çš„beanå£°æ˜ï¼Œå¹¶ä¸”åœ¨ç±»è·¯å¾„ä¸Šä»ç„¶å¯ä»¥æœ‰ä»»æ„æ•°é‡çš„å…¶ä»–<code>WebMvcConfigurer</code> ã€‚</p><h4 id="1-10-14-é«˜çº§-XML-é…ç½®"><a href="#1-10-14-é«˜çº§-XML-é…ç½®" class="headerlink" title="1.10.14. é«˜çº§ XML é…ç½®"></a>1.10.14. é«˜çº§ XML é…ç½®</h4><p>MVCå‘½åç©ºé—´æ²¡æœ‰é«˜çº§æ¨¡å¼ï¼Œå¦‚æœéœ€è¦è‡ªå®šä¹‰æ— æ³•æ›´æ”¹çš„beanä¸Šçš„å±æ€§ï¼Œå¯ä»¥ä½¿ç”¨ <code>ApplicationContext</code>çš„<code>BeanPostProcessor</code>ç”Ÿå‘½å‘¨æœŸæŒ‚é’©ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Componentpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyPostProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BeanPostProcessor</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Object</span> <span class="hljs-title function_">postProcessBeforeInitialization</span>(<span class="hljs-title class_">Object</span> bean, <span class="hljs-title class_">String</span> name) throws <span class="hljs-title class_">BeansException</span> &#123;        <span class="hljs-comment">// ...    &#125;&#125;</span><br></code></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œ<code>MyPostProcessor</code>éœ€è¦ç”¨XMLæ˜¾å¼å£°æ˜ä¸ºbeanï¼Œæˆ–é€šè¿‡ <code>&lt;component-scan/&gt;</code>å£°æ˜æ£€æµ‹ã€‚</p><h3 id="1-11-HTTP-2"><a href="#1-11-HTTP-2" class="headerlink" title="1.11. HTTP&#x2F;2"></a>1.11. HTTP&#x2F;2</h3><p><a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/web-reactive.html#webflux-http2">Same as in Spring WebFlux</a></p><p>Servlet 4å®¹å™¨éœ€è¦æ”¯æŒHTTP&#x2F;2ï¼ŒSpring Framework 5ä¸Servlet API 4å…¼å®¹ã€‚ä»ç¼–ç¨‹æ¨¡å‹çš„è§’åº¦æ¥çœ‹ï¼Œåº”ç”¨ç¨‹åºä¸éœ€è¦ç‰¹å®šçš„ä»»ä½•æ“ä½œã€‚ ä½†æ˜¯ï¼Œå­˜åœ¨ä¸æœåŠ¡å™¨é…ç½®ç›¸å…³çš„æ³¨æ„äº‹é¡¹ã€‚ æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="https://github.com/spring-projects/spring-framework/wiki/HTTP-2-support">HTTP&#x2F;2 wiki é¡µé¢ã€‚</a></p><p>Servlet APIç¡®å®å…¬å¼€äº†ä¸€ä¸ªä¸HTTP&#x2F;2ç›¸å…³çš„æ„é€ ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨<code>javax.servlet.http.PushBuilder</code> ä¸»åŠ¨å°†èµ„æºæ¨é€åˆ°å®¢æˆ·ç«¯ï¼Œå¹¶ä¸”å®ƒè¢«æ”¯æŒä½œä¸º <code>@RequestMapping</code>æ–¹æ³•çš„<a href="https://sca.aliyun.com/learn/spring/web-servlet/mvc/?spm=0.29160081.0.0.51f92e5dCHrGI4#mvc-ann-arguments">æ–¹æ³•å‚æ•°</a>ã€‚</p><blockquote><p>Rod Johnson, Juergen Hoeller, Keith Donald, Colin Sampaleanu, Rob Harrop, Thomas Risberg, Alef Arendsen, Darren Davison, Dmitriy Kopylenko, Mark Pollack, Thierry Templier, Erwin Vervaet, Portia Tung, Ben Hale, Adrian Colyer, John Lewis, Costin Leau, Mark Fisher, Sam Brannen, Ramnivas Laddad, Arjen Poutsma, Chris Beams, Tareq Abedrabbo, Andy Clement, Dave Syer, Oliver Gierke, Rossen Stoyanchev, Phillip Webb, Rob Winch, Brian Clozel, Stephane Nicoll, Sebastien Deleuze, Jay Bryant, Mark Paluch</p></blockquote><blockquote><p>Copyright Â© 2002 - 2024 VMware, Inc. All Rights Reserved.</p></blockquote><blockquote><p>Copies of this document may be made for your own use and for distribution to others, provided that you do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically.</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>åç«¯</category>
      
      <category>Java</category>
      
      <category>Spring æ•™ç¨‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Spring</tag>
      
      <tag>web</tag>
      
      <tag>MVC</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>AOPç¼–ç¨‹ (ä¸‹)</title>
    <link href="/post/cd1cf2a8-69fa-49fb-a09a-5fb5fa406040/"/>
    <url>/post/cd1cf2a8-69fa-49fb-a09a-5fb5fa406040/</url>
    
    <content type="html"><![CDATA[<h1 id="AOP-ç¼–ç¨‹-ä¸‹"><a href="#AOP-ç¼–ç¨‹-ä¸‹" class="headerlink" title="AOP ç¼–ç¨‹(ä¸‹)"></a>AOP ç¼–ç¨‹(ä¸‹)</h1><p>Spring æ•™ç¨‹</p><hr><h2 id="3-Spring-AOP-APIs"><a href="#3-Spring-AOP-APIs" class="headerlink" title="3. Spring AOP APIs"></a>3. Spring AOP APIs</h2><p>å‰ä¸€ç« ä»‹ç»äº†Springä½¿ç”¨@AspectJå’ŒåŸºäºschemaçš„åˆ‡é¢å®šä¹‰å¯¹AOPçš„æ”¯æŒã€‚ åœ¨æœ¬ç« ä¸­ï¼Œå°†è®¨è®ºSpring 1.2åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨çš„è¾ƒåº•å±‚çš„Spring AOP APIå’ŒAOPæ”¯æŒã€‚ å¯¹äºæ–°çš„åº”ç”¨ç¨‹åºï¼Œæ¨èä½¿ç”¨å‰ä¸€ç« ä¸­ä»‹ç»çš„Spring 2.0å’Œæ›´é«˜ç‰ˆæœ¬çš„AOPæ”¯æŒï¼Œä½†æ˜¯åœ¨ä½¿ç”¨ç°æœ‰åº”ç”¨ç¨‹åºæˆ–é˜…è¯»ä¹¦ç±å’Œæ–‡ç« æ—¶ï¼Œæ‚¨å¯èƒ½ä¼šé‡åˆ°Spring 1.2æ–¹å¼çš„ç¤ºä¾‹. Spring 5ä»ç„¶å‘åå…¼å®¹äº†Spring 1.2ã€‚æœ¬ç« ä¸­æè¿°çš„æ‰€æœ‰å†…å®¹åœ¨Spring 5ä¸­éƒ½å¾—åˆ°äº†å®Œå…¨æ”¯æŒã€‚</p><h3 id="3-1-Springä¸­çš„åˆ‡ç‚¹API"><a href="#3-1-Springä¸­çš„åˆ‡ç‚¹API" class="headerlink" title="3.1. Springä¸­çš„åˆ‡ç‚¹API"></a>3.1. Springä¸­çš„åˆ‡ç‚¹API</h3><p>æœ¬èŠ‚æè¿°äº†Springå¦‚ä½•å¤„ç†åˆ‡ç‚¹çš„å…³é”®æ¦‚å¿µã€‚</p><h4 id="3-1-1-æ¦‚å¿µ"><a href="#3-1-1-æ¦‚å¿µ" class="headerlink" title="3.1.1. æ¦‚å¿µ"></a>3.1.1. æ¦‚å¿µ</h4><p>Springçš„åˆ‡ç‚¹æ¨¡å¼èƒ½å¤Ÿè®©åˆ‡ç‚¹ç‹¬ç«‹äºé€šçŸ¥ç±»å‹ã€‚é’ˆå¯¹ä¸åŒçš„é€šçŸ¥ä½¿ç”¨ç›¸åŒçš„åˆ‡ç‚¹æ˜¯å¯èƒ½çš„ã€‚</p><p><code>org.springframework.aop.Pointcut</code> æ¥å£æ˜¯åˆ‡ç‚¹çš„ä¸»è¦æ¥å£ï¼Œç”¨äºç‰¹å®šç±»å’Œæ–¹æ³•çš„ç›®æ ‡é€šçŸ¥ã€‚å®Œæ•´çš„æ¥å£å¦‚ä¸‹:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">Pointcut</span> &#123;<br>    <span class="hljs-function">ClassFilter <span class="hljs-title">getClassFilter</span>()</span>;<br>    <span class="hljs-function">MethodMatcher <span class="hljs-title">getMethodMatcher</span>()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>å°†<code>Pointcut</code>æ¥å£åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œå…è®¸é‡ç”¨ç±»å’Œæ–¹æ³•åŒ¹é…éƒ¨åˆ†ï¼Œä»¥åŠç»†ç²’åº¦çš„ç»„åˆæ“ä½œï¼ˆä¾‹å¦‚ä¸å¦ä¸€ä¸ªæ–¹æ³•åŒ¹é…å™¨æ‰§è¡Œâ€œunionâ€ï¼‰ã€‚</p><p><code>ClassFilter</code>æ¥å£æ˜¯ç”¨æ¥é™åˆ¶åˆ‡ç‚¹çš„ä¸€ç»„ç»™å®šçš„ç›®æ ‡ç±»ã€‚å¦‚æœ<code>matches()</code>æ–¹æ³•æ€»æ˜¯è¿”å›trueï¼Œé‚£ä¹ˆè¡¨ç¤ºæ‰€æœ‰çš„ç›®æ ‡ç±»éƒ½å°†åŒ¹é…ã€‚ä»¥ä¸‹æ¸…å•æ˜¾ç¤ºäº†<code>ClassFilter</code>æ¥å£å®šä¹‰:</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-symbol">ClassFilter</span> &#123;<br>    <span class="hljs-built_in">bool</span>ean matches(Class clazz);&#125;<br></code></pre></td></tr></table></figure><p><code>MethodMatcher</code> æ¥å£é€šå¸¸æ›´é‡è¦ã€‚å®Œæ•´çš„æ¥å£å¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-built_in">public</span> interface MethodMatcher &#123;<br>    <span class="hljs-type">boolean</span> matches(<span class="hljs-keyword">Method</span> m, <span class="hljs-keyword">Class</span> targetClass);<br>    <span class="hljs-type">boolean</span> isRuntime();<br>    <span class="hljs-type">boolean</span> matches(<span class="hljs-keyword">Method</span> m, <span class="hljs-keyword">Class</span> targetClass, <span class="hljs-keyword">Object</span>[] args);&#125;<br></code></pre></td></tr></table></figure><p><code>matches(Method, Class)</code>æ–¹æ³•ç”¨äºæµ‹è¯•æ­¤åˆ‡ç‚¹æ˜¯å¦æ›¾ç»åŒ¹é…åˆ°ç›®æ ‡ç±»ä¸Šçš„ç»™å®šæ–¹æ³•ã€‚åœ¨åˆ›å»ºAOPä»£ç†æ—¶å¯ä»¥æ‰§è¡Œæ­¤è¯„ä¼°ï¼Œä»¥é¿å…éœ€è¦å¯¹æ¯ä¸ªæ–¹æ³•è°ƒç”¨è¿›è¡Œæµ‹è¯•ã€‚ å¦‚æœå¯¹äºç»™å®šæ–¹æ³•ï¼Œè¿™ä¸ªåŒå‚æ•° <code>matches</code>æ–¹æ³•è¿”å›<code>true</code>ï¼Œå¹¶ä¸”MethodMatcherçš„ <code>isRuntime()</code>æ–¹æ³•ä¹Ÿè¿”å›trueã€‚ åˆ™åœ¨æ¯æ¬¡æ–¹æ³•è°ƒç”¨æ—¶éƒ½ä¼šè°ƒç”¨ä¸‰å‚æ•°<code>matches</code>æ–¹æ³•ã€‚è¿™ä½¿åˆ‡ç‚¹èƒ½å¤Ÿåœ¨ç›®æ ‡é€šçŸ¥æ‰§è¡Œä¹‹å‰ï¼ŒæŸ¥çœ‹ä¼ é€’ç»™æ–¹æ³•è°ƒç”¨çš„å‚æ•°ã€‚</p><p>å¤§å¤šæ•°<code>MethodMatcher</code>å®ç°éƒ½æ˜¯é™æ€çš„ï¼Œè¿™æ„å‘³ç€å®ƒä»¬çš„ <code>isRuntime()</code>æ–¹æ³•è¿”å›<code>false</code>ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ°¸è¿œä¸ä¼šè°ƒç”¨ä¸‰å‚æ•°<code>matches</code>æ–¹æ³•ã€‚</p><p>å¦‚æœå¯ä»¥ï¼Œè¯·å°è¯•å°†åˆ‡ç‚¹è®¾ä¸ºé™æ€çš„ï¼Œä»è€Œå…è®¸AOPæ¡†æ¶åœ¨åˆ›å»ºAOPä»£ç†æ—¶ç¼“å­˜å¯¹åˆ‡ç‚¹è¯„ä¼°çš„ç»“æœã€‚</p><h4 id="3-1-2-åˆ‡ç‚¹çš„æ“ä½œ"><a href="#3-1-2-åˆ‡ç‚¹çš„æ“ä½œ" class="headerlink" title="3.1.2. åˆ‡ç‚¹çš„æ“ä½œ"></a>3.1.2. åˆ‡ç‚¹çš„æ“ä½œ</h4><p>Springæ”¯æŒå¯¹åˆ‡ç‚¹çš„å„ç§æ“ä½œï¼Œç‰¹åˆ«æ˜¯å¹¶é›†å’Œäº¤é›†</p><p>å¹¶é›†æ„å‘³ç€è¿™ä¸ªæ–¹æ³•åªè¦æœ‰ä¸€ä¸ªåˆ‡ç‚¹åŒ¹é…ï¼Œäº¤é›†æ„å‘³ç€è¿™ä¸ªæ–¹æ³•éœ€è¦æ‰€æœ‰çš„åˆ‡ç‚¹éƒ½åŒ¹é…ã€‚ å¹¶é›†ä½¿ç”¨å¾—æ›´å¹¿ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<code>org.springframework.aop.support.Pointcuts</code>ç±»ä¸­çš„é™æ€æ–¹æ³•æˆ–åœ¨åŒä¸€ä¸ªåŒ…ä¸­ä½¿ç”¨<code>ComposablePointcut</code>ç±»æ¥ç»„åˆåˆ‡ ç‚¹ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨AspectJçš„åˆ‡ç‚¹è¡¨è¾¾å¼å¾€å¾€æ˜¯æ›´ç®€å•çš„æ–¹å¼ã€‚</p><h4 id="3-1-3-AspectJåˆ‡ç‚¹è¡¨è¾¾å¼"><a href="#3-1-3-AspectJåˆ‡ç‚¹è¡¨è¾¾å¼" class="headerlink" title="3.1.3. AspectJåˆ‡ç‚¹è¡¨è¾¾å¼"></a>3.1.3. AspectJåˆ‡ç‚¹è¡¨è¾¾å¼</h4><p>è‡ª 2.0ä»¥æ¥, ï¼ŒSpringä½¿ç”¨çš„æœ€é‡è¦çš„åˆ‡ç‚¹ç±»å‹æ˜¯<code>org.springframework.aop.aspectj.AspectJExpressionPointcut</code>ã€‚è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨AspectJæä¾›çš„åº“æ¥è§£æAspectJåˆ‡ç‚¹è¡¨è¾¾å¼å­—ç¬¦ä¸²çš„åˆ‡ç‚¹ã€‚</p><p>æœ‰å…³æ”¯æŒçš„AspectJåˆ‡ç‚¹è¯­ä¹‰çš„è®¨è®ºï¼Œ <a href="https://sca.aliyun.com/learn/spring/core/aop-api/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop">è¯·å‚è§ä¸Šä¸€ç« </a></p><h4 id="3-1-4-æ–¹ä¾¿çš„åˆ‡ç‚¹å®ç°"><a href="#3-1-4-æ–¹ä¾¿çš„åˆ‡ç‚¹å®ç°" class="headerlink" title="3.1.4.æ–¹ä¾¿çš„åˆ‡ç‚¹å®ç°"></a>3.1.4.æ–¹ä¾¿çš„åˆ‡ç‚¹å®ç°</h4><p>Springæä¾›äº†å‡ ä¸ªæ–¹ä¾¿çš„åˆ‡ç‚¹å®ç°ï¼Œæ‚¨å¯ä»¥ç›´æ¥ä½¿ç”¨å…¶ä¸­ä¸€äº›ã€‚å…¶ä»–çš„ç›®çš„æ˜¯åœ¨ç‰¹å®šäºåº”ç”¨ç¨‹åºçš„åˆ‡ç‚¹ä¸­è¿›è¡Œå­ç±»åŒ–ã€‚ Others are intended to be subclassed in application-specific pointcuts.</p><h5 id="é™æ€åˆ‡ç‚¹"><a href="#é™æ€åˆ‡ç‚¹" class="headerlink" title="é™æ€åˆ‡ç‚¹"></a>é™æ€åˆ‡ç‚¹</h5><p>é™æ€åˆ‡ç‚¹æ˜¯åŸºäºæ–¹æ³•å’Œç›®æ ‡ç±»çš„ï¼Œè€Œä¸”æ— æ³•è€ƒè™‘è¯¥æ–¹æ³•çš„å‚æ•°ã€‚é™æ€åˆ‡ç‚¹åœ¨å¤§å¤šæ•°çš„ä½¿ç”¨ä¸Šæ˜¯å……åˆ†çš„ã€æœ€å¥½çš„ã€‚åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œ Springå¯èƒ½åªè®¡ç®—ä¸€æ¬¡é™æ€åˆ‡ç‚¹ï¼Œåœ¨è¿™ä¹‹åï¼Œæ— éœ€åœ¨ä½¿ç”¨æ¯ä¸ªæ–¹æ³•è°ƒç”¨æ—¶éƒ½è¯„ä¼°åˆ‡ç‚¹ã€‚</p><p>æœ¬èŠ‚çš„å…¶ä½™éƒ¨åˆ†æè¿°äº†Springä¸­åŒ…å«çš„ä¸€äº›é™æ€åˆ‡ç‚¹å®ç°ã€‚</p><h6 id="æ­£åˆ™è¡¨è¾¾å¼åˆ‡ç‚¹"><a href="#æ­£åˆ™è¡¨è¾¾å¼åˆ‡ç‚¹" class="headerlink" title="æ­£åˆ™è¡¨è¾¾å¼åˆ‡ç‚¹"></a>æ­£åˆ™è¡¨è¾¾å¼åˆ‡ç‚¹</h6><p>æŒ‡å®šé™æ€åˆ‡å…¥ç‚¹çš„ä¸€ä¸ªæ˜¾è€Œæ˜“è§çš„å®ç°æ˜¯æ­£åˆ™è¡¨è¾¾å¼ï¼Œå‡ ä¸ªåŸºäºSpringçš„AOPæ¡†æ¶è®©è¿™æˆä¸ºå¯èƒ½ã€‚ <code>org.springframework.aop.support.JdkRegexpMethodPointcut</code>æ˜¯ä¸€ä¸ªé€šç”¨çš„æ­£åˆ™è¡¨è¾¾å¼åˆ‡ç‚¹ï¼Œå®ƒä½¿ç”¨JDKä¸­çš„æ­£åˆ™è¡¨è¾¾å¼æ”¯æŒã€‚</p><p>ä½¿ç”¨<code>JdkRegexpMethodPointcut</code>ç±»ï¼Œå¯ä»¥æä¾›ä¸€ä¸ªåŒ¹é…çš„Stringsåˆ—è¡¨ã€‚å¦‚æœå…¶ä¸­ä»»æ„ä¸€ä¸ªéƒ½æ˜¯åŒ¹é…çš„ï¼Œåˆ™åˆ‡ç‚¹å°†è®¡ç®—å°†ä¸ºtrueï¼ˆå› æ­¤ï¼Œç»“æœå®é™…ä¸Šæ˜¯è¿™äº›åˆ‡ç‚¹çš„å¹¶é›†ï¼‰ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•ä½¿ç”¨<code>JdkRegexpMethodPointcut</code>:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;settersAndAbsquatulatePointcut&quot;</span></span><br><span class="hljs-tag"></span><br><span class="hljs-tag">        <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.aop.support.JdkRegexpMethodPointcut&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;patterns&quot;</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>.*set.*<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>.*absquatulate<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p>Springæä¾›äº†ä¸€ä¸ªæ–¹ä¾¿ä½¿ç”¨çš„ç±» -<code>RegexpMethodPointcutAdvisor</code>ã€‚ å®ƒå…è®¸å¼•ç”¨<code>Advice</code>ï¼ˆè®°ä½<code>Advice</code>å¯èƒ½æ˜¯ä¸€ä¸ªæ‹¦æˆªå™¨ã€å‰ç½®é€šçŸ¥ã€å¼‚å¸¸é€šçŸ¥ç­‰ç­‰ï¼‰ã€‚ è€Œåœ¨è¿™ä¸ªç±»çš„åé¢ï¼ŒSpringä¹Ÿæ˜¯ä½¿ç”¨<code>JdkRegexpMethodPointcut</code>ç±»çš„ã€‚ä½¿ç”¨<code>RegexpMethodPointcutAdvisor</code>æ¥ç®€åŒ–ç»‡å…¥ï¼Œç”¨ä½œbeanå°è£…çš„åˆ‡ç‚¹å’Œé€šçŸ¥ã€‚å¦‚ä¸‹ä¾‹æ‰€ç¤º:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;settersAndAbsquatulateAdvisor&quot;</span></span><br><span class="hljs-tag"></span><br><span class="hljs-tag">        <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.aop.support.RegexpMethodPointcutAdvisor&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;advice&quot;</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">bean</span>=<span class="hljs-string">&quot;beanNameOfAopAllianceInterceptor&quot;</span>/&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;patterns&quot;</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>.*set.*<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>.*absquatulate<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æ‚¨å¯ä»¥å°†<code>RegexpMethodPointcutAdvisor</code> ä¸ä»»ä½•<code>Advice</code>ç±»å‹ä¸€èµ·ä½¿ç”¨ã€‚</p><h6 id="åŸºäºå±æ€§çš„åˆ‡ç‚¹"><a href="#åŸºäºå±æ€§çš„åˆ‡ç‚¹" class="headerlink" title="åŸºäºå±æ€§çš„åˆ‡ç‚¹"></a>åŸºäºå±æ€§çš„åˆ‡ç‚¹</h6><p>é™æ€åˆ‡ç‚¹çš„ä¸€ä¸ªé‡è¦ç‰¹å¾æ˜¯å…ƒæ•°æ®é©±åŠ¨çš„åˆ‡ç‚¹ã€‚å®ƒå°†ä½¿ç”¨å…ƒæ•°æ®å±æ€§çš„å€¼ï¼Œé€šå¸¸æ˜¯ä½¿ç”¨æºç­‰çº§çš„å…ƒæ•°æ®ã€‚</p><h5 id="åŠ¨æ€çš„åˆ‡ç‚¹"><a href="#åŠ¨æ€çš„åˆ‡ç‚¹" class="headerlink" title="åŠ¨æ€çš„åˆ‡ç‚¹"></a>åŠ¨æ€çš„åˆ‡ç‚¹</h5><p>ä¸é™æ€åˆ‡ç‚¹ç›¸æ¯”ï¼ŒåŠ¨æ€åˆ‡ç‚¹çš„è¯„ä¼°æˆæœ¬æ›´é«˜ã€‚å®ƒä»¬è€ƒè™‘äº†æ–¹æ³•å‚æ•°å’Œé™æ€ä¿¡æ¯ã€‚ è¿™æ„å‘³ç€å¿…é¡»ä½¿ç”¨æ¯ä¸ªæ–¹æ³•è°ƒç”¨æ¥è¯„ä¼°å®ƒä»¬ï¼Œå¹¶ä¸”ä¸èƒ½ç¼“å­˜ç»“æœï¼Œå› ä¸ºå‚æ•°ä¼šæœ‰æ‰€ä¸åŒã€‚</p><p>ä¸»è¦çš„ä¾‹å­æ˜¯<code>control flow</code> åˆ‡ç‚¹</p><h6 id="æ§åˆ¶æµåˆ‡ç‚¹"><a href="#æ§åˆ¶æµåˆ‡ç‚¹" class="headerlink" title="æ§åˆ¶æµåˆ‡ç‚¹"></a>æ§åˆ¶æµåˆ‡ç‚¹</h6><p>Springæ§åˆ¶æµåˆ‡ç‚¹åœ¨æ¦‚å¿µä¸Šç±»ä¼¼äºAspectJçš„<code>cflow</code>åˆ‡ç‚¹ï¼Œè™½ç„¶åŠŸèƒ½ä¸å¤Ÿå®ƒçš„å¼ºå¤§ ï¼ˆç›®å‰æ²¡æœ‰åŠæ³•æŒ‡å®šåˆ‡ç‚¹åœ¨å¦ä¸€ä¸ªåˆ‡ç‚¹åŒ¹é…çš„è¿æ¥ç‚¹ä¸‹é¢æ‰§è¡Œï¼‰ã€‚ æ§åˆ¶æµåˆ‡ç‚¹ä¸å½“å‰è°ƒç”¨çš„æ ˆç›¸åŒ¹é…ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè¿æ¥ç‚¹æ˜¯ç”±<code>com.mycompany.web</code>åŒ…ä¸­çš„æ–¹æ³•æˆ–<code>SomeCaller</code>ç±»è°ƒç”¨çš„ï¼Œåˆ™å¯èƒ½ä¼šè§¦å‘å®ƒã€‚ ä½¿ç”¨ <code>org.springframework.aop.support.ControlFlowPointcut</code>ç±»æŒ‡å®šæ§åˆ¶æµåˆ‡ç‚¹ã€‚</p><p>åœ¨è¿è¡Œæ—¶è¯„ä¼°æ§åˆ¶æµåˆ‡ç‚¹çš„æˆæœ¬è¿œè¿œé«˜äºå…¶ä»–åŠ¨æ€åˆ‡ç‚¹ã€‚ åœ¨Java 1.4ä¸­ï¼Œæˆæœ¬å¤§çº¦æ˜¯å…¶ä»–åŠ¨æ€åˆ‡å…¥ç‚¹çš„äº”å€ã€‚</p><h4 id="3-1-5-åˆ‡ç‚¹è¶…ç±»"><a href="#3-1-5-åˆ‡ç‚¹è¶…ç±»" class="headerlink" title="3.1.5. åˆ‡ç‚¹è¶…ç±»"></a>3.1.5. åˆ‡ç‚¹è¶…ç±»</h4><p>Springæä¾›äº†ç›¸å½“æœ‰ç”¨çš„åˆ‡ç‚¹è¶…ç±»,å¸®åŠ©å¼€å‘è€…å®ç°è‡ªå®šä¹‰åˆ‡ç‚¹.</p><p>å› ä¸ºé™æ€åˆ‡ç‚¹æœ€æœ‰ç”¨,æ‰€ä»¥å¯èƒ½ä¼šç»§æ‰¿<code>StaticMethodMatcherPointcut</code>.ç¼–å†™å­ç±»ã€‚ è¿™éœ€è¦åªå®ç°ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼ˆå°½ç®¡æ‚¨å¯ä»¥è¦†ç›–å…¶ä»–æ–¹æ³•æ¥è‡ªå®šä¹‰è¡Œä¸ºï¼‰ã€‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•å­ç±»åŒ– <code>StaticMethodMatcherPointcut</code>:</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestStaticPointcut</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StaticMethodMatcherPointcut</span> </span>&#123;<br>    public boolean matches(<span class="hljs-type">Method</span> m, <span class="hljs-type">Class</span> targetClass) &#123;        <span class="hljs-comment">// return true if custom criteria match    &#125;&#125;</span><br></code></pre></td></tr></table></figure><p>è¿™ä¹Ÿæ˜¯åŠ¨æ€åˆ‡ç‚¹çš„è¶…ç±»</p><p>æ‚¨å¯ä»¥åœ¨Spring 1.0 RC2åŠæ›´é«˜ç‰ˆæœ¬ä¸­ä½¿ç”¨ä»»ä½•é€šçŸ¥ç±»å‹çš„è‡ªå®šä¹‰åˆ‡ç‚¹ã€‚</p><h4 id="3-1-6-è‡ªå®šä¹‰åˆ‡ç‚¹"><a href="#3-1-6-è‡ªå®šä¹‰åˆ‡ç‚¹" class="headerlink" title="3.1.6.è‡ªå®šä¹‰åˆ‡ç‚¹"></a>3.1.6.è‡ªå®šä¹‰åˆ‡ç‚¹</h4><p>ç”±äºSpring AOPä¸­çš„åˆ‡ç‚¹æ˜¯Javaç±»,è€Œä¸æ˜¯è¯­è¨€åŠŸèƒ½(å¦‚AspectJ),å› æ­¤å¯ä»¥å£°æ˜è‡ªå®šä¹‰åˆ‡ç‚¹,æ— è®ºæ˜¯é™æ€çš„è¿˜æ˜¯åŠ¨æ€çš„.Springä¸­çš„è‡ªå®šä¹‰åˆ‡ç‚¹å¯ä»¥æ˜¯ä»»æ„å¤æ‚çš„ã€‚ ä½†æ˜¯,å°½é‡å»ºè®®ä½¿ç”¨AspectJåˆ‡ç‚¹è¡¨è¾¾å¼è¯­è¨€ã€‚</p><p>Later versions of Spring may offer support for â€œsemantic pointcutsâ€ as offered by JACâ€‰â€”â€‰for example, â€œall methods that change instance variables in the target object.â€</p><h3 id="3-2-Springçš„é€šçŸ¥API"><a href="#3-2-Springçš„é€šçŸ¥API" class="headerlink" title="3.2. Springçš„é€šçŸ¥API"></a>3.2. Springçš„é€šçŸ¥API</h3><p>æ¥ä¸‹æ¥ä»‹ç»Spring AOPæ˜¯æ€ä¹ˆæ ·å¤„ç†é€šçŸ¥çš„</p><h4 id="3-2-1-é€šçŸ¥çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#3-2-1-é€šçŸ¥çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="3.2.1. é€šçŸ¥çš„ç”Ÿå‘½å‘¨æœŸ"></a>3.2.1. é€šçŸ¥çš„ç”Ÿå‘½å‘¨æœŸ</h4><p>æ¯ä¸ªé€šçŸ¥éƒ½æ˜¯Spring bean.é€šçŸ¥å®ä¾‹å¯ä»¥åœ¨æ‰€æœ‰é€šçŸ¥å¯¹è±¡ä¹‹é—´å…±äº«ï¼Œæˆ–è€…å¯¹æ¯ä¸ªé€šçŸ¥å¯¹è±¡éƒ½æ˜¯å”¯ä¸€çš„ã€‚ è¿™å¯¹åº”äºæ¯ä¸ªç±»æˆ–æ¯ä¸ªå®ä¾‹çš„é€šçŸ¥ã€‚</p><p>å•ç±»ï¼ˆPer-class) é€šçŸ¥æ˜¯æœ€å¸¸ç”¨çš„ã€‚å®ƒé€‚ç”¨äºè¯¸å¦‚äº‹åŠ¡é€šçŸ¥è€…ä¹‹ç±»çš„ä¸€èˆ¬æ€§é€šçŸ¥ã€‚å®ƒä¸ä¾èµ–äºä»£ç†å¯¹è±¡çš„çŠ¶æ€æˆ–æ·»åŠ æ–°çŠ¶æ€ï¼Œå®ƒä»¬åªæ˜¯å¯¹æ–¹æ³•å’Œå‚æ•°äº§ç”Ÿä½œç”¨.</p><p>å•å®ä¾‹ï¼ˆPer-instanceï¼‰çš„é€šçŸ¥é€‚åˆäºå¼•å…¥,ä»¥æ”¯æŒæ··åˆä½¿ç”¨.åœ¨è¿™ç§æƒ…å†µä¸‹,é€šçŸ¥å°†çŠ¶æ€æ·»åŠ åˆ°ä»£ç†å¯¹è±¡ä¸­ã€‚</p><p>åœ¨åŒä¸€ä¸ªAOPä»£ç†ä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ··åˆå…±äº«çš„å’Œå•å®ä¾‹çš„é€šçŸ¥ã€‚</p><h4 id="3-2-2-Springä¸­çš„é€šçŸ¥ç±»å‹"><a href="#3-2-2-Springä¸­çš„é€šçŸ¥ç±»å‹" class="headerlink" title="3.2.2. Springä¸­çš„é€šçŸ¥ç±»å‹"></a>3.2.2. Springä¸­çš„é€šçŸ¥ç±»å‹</h4><p>Springæä¾›äº†å‡ ç§é€šçŸ¥ç±»å‹ï¼Œå¹¶ä¸”å¯ä»¥æ‰©å±•ä»¥æ”¯æŒä»»æ„é€šçŸ¥ç±»å‹ã€‚ æœ¬èŠ‚ä»‹ç»åŸºæœ¬æ¦‚å¿µå’Œæ ‡å‡†é€šçŸ¥ç±»å‹ã€‚</p><h5 id="æ‹¦æˆªç¯ç»•é€šçŸ¥"><a href="#æ‹¦æˆªç¯ç»•é€šçŸ¥" class="headerlink" title="æ‹¦æˆªç¯ç»•é€šçŸ¥"></a>æ‹¦æˆªç¯ç»•é€šçŸ¥</h5><p>åœ¨Springä¸­,æœ€åŸºç¡€çš„é€šçŸ¥ç±»å‹æ˜¯æ‹¦æˆªç¯ç»•é€šçŸ¥.</p><p>Springä½¿ç”¨æ–¹æ³•æ‹¦æˆªæ¥æ»¡è¶³AOP<code>Alliance</code> æ¥å£çš„è¦æ±‚. <code>MethodInterceptor</code>å®ç°ç¯ç»•é€šçŸ¥åº”è¯¥å®ç°ä»¥ä¸‹æ¥å£:</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-symbol">MethodInterceptor</span> <span class="hljs-symbol">extends</span> <span class="hljs-symbol">Interceptor</span> &#123;<br>    Object invoke(MethodInvocation invocation) throws Throwable;&#125;<br></code></pre></td></tr></table></figure><p><code>invoke()</code> æ–¹æ³•çš„å‚æ•°<code>MethodInvocation</code> å…¬å¼€äº†å°†è¦è¢«è§¦å‘çš„æ–¹æ³•,ç›®æ ‡è¿æ¥ç‚¹,AOPä»£ç†,ä»¥åŠæ–¹æ³•çš„å‚æ•°ã€‚<code>invoke()</code> æ–¹æ³•åº”è¯¥è¿”å›è°ƒç”¨çš„ç»“æœï¼šè¿æ¥ç‚¹çš„è¿”å›å€¼ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†ä¸€ä¸ªç®€å•çš„<code>MethodInterceptor</code>å®ç°:</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> DebugInterceptor implements MethodInterceptor &#123;<br>    <span class="hljs-built_in">public</span> <span class="hljs-keyword">Object</span> invoke(MethodInvocation invocation) throws Throwable &#123;        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(&quot;Before: invocation=[&quot; + invocation + &quot;]&quot;);        <span class="hljs-keyword">Object</span> rval = invocation.proceed();        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(&quot;Invocation returned&quot;);        <span class="hljs-keyword">return</span> rval;    &#125;&#125;<br></code></pre></td></tr></table></figure><p>è¯·æ³¨æ„å¯¹<code>MethodInvocation</code>çš„<code>proceed()</code>æ–¹æ³•çš„è°ƒç”¨ã€‚proceedä»æ‹¦æˆªå™¨é“¾ä¸Šè¿›å…¥è¿æ¥ç‚¹ã€‚å¤§å¤šæ•°æ‹¦æˆªå™¨è°ƒç”¨æ­¤æ–¹æ³•å¹¶è¿”å›å…¶è¿”å›å€¼ã€‚ä½†æ˜¯ï¼Œ ä¸ä»»æ„çš„ç¯ç»•é€šçŸ¥ä¸€æ ·ï¼Œ <code>MethodInterceptor</code>å¯ä»¥è¿”å›ä¸åŒçš„å€¼æˆ–å¼•å‘å¼‚å¸¸ï¼Œè€Œä¸æ˜¯è°ƒç”¨proceedæ–¹æ³•ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ²¡æœ‰å……åˆ†çš„ç†ç”±ï¼Œæ‚¨ä¸å¸Œæœ›è¿™æ ·åšã€‚</p><p><code>MethodInterceptor</code> æä¾›ä¸å…¶ä»–AOP Allianceå…¼å®¹çš„AOPå®ç°ã€‚æœ¬èŠ‚å…¶ä½™éƒ¨åˆ†è®¨è®ºçš„å…¶ä»–é€šçŸ¥ç±»å‹å®ç°äº†å¸¸è§çš„AOPæ¦‚å¿µï¼Œä½†è¿™ç‰¹å®šäºä½¿ç”¨Springçš„æ–¹å¼ã€‚ å°½ç®¡ä½¿ç”¨æœ€å…·ä½“çš„é€šçŸ¥ç±»å‹åˆ‡é¢æ€»æ˜¯æœ‰ä¼˜åŠ¿çš„ï¼Œä½†å¦‚æœå¸Œæœ›åœ¨å¦ä¸€ä¸ªAOPæ¡†æ¶ä¸­è¿è¡Œè¯¥åˆ‡é¢é¢ï¼Œï¼Œåˆ™åº”åšæŒä½¿ç”¨<code>MethodInterceptor</code>çš„é€šçŸ¥ã€‚è¯·æ³¨æ„ï¼Œç›®å‰åˆ‡ç‚¹ä¸ä¼šåœ¨æ¡†æ¶ä¹‹é—´è¿›è¡Œäº¤äº’æ“ä½œï¼Œ å¹¶ä¸”ç›®å‰çš„AOP Allianceå¹¶æ²¡æœ‰å®šä¹‰åˆ‡ç‚¹æ¥å£ã€‚</p><h5 id="å‰ç½®é€šçŸ¥"><a href="#å‰ç½®é€šçŸ¥" class="headerlink" title="å‰ç½®é€šçŸ¥"></a>å‰ç½®é€šçŸ¥</h5><p>å‰ç½®é€šçŸ¥æ˜¯ä¸€ç§ç®€å•çš„é€šçŸ¥ï¼Œå®ƒå¹¶ä¸éœ€è¦<code>MethodInvocation</code>å¯¹è±¡ï¼Œå› ä¸ºå®ƒåªä¼šåœ¨æ‰§è¡Œæ–¹æ³•å‰è°ƒç”¨ã€‚</p><p>å‰ç½®é€šçŸ¥çš„ä¸»è¦ä¼˜åŠ¿å°±æ˜¯å®ƒæ²¡æœ‰å¿…è¦å»è§¦å‘<code>proceed()</code>æ–¹æ³•ï¼Œå› æ­¤å½“æ‹¦æˆªå™¨é“¾å¤±è´¥æ—¶å¯¹å®ƒæ˜¯æ²¡æœ‰å½±å“çš„ã€‚</p><p>ä»¥ä¸‹æ¸…å•æ˜¾ç¤ºäº†<code>MethodBeforeAdvice</code>æ¥å£:</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">MethodBeforeAdvice</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BeforeAdvice</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">before</span><span class="hljs-params">(Method m, Object[] args, Object <span class="hljs-keyword">target</span>)</span> <span class="hljs-keyword">throws</span> Throwable</span>;&#125;<br></code></pre></td></tr></table></figure><p>(Springçš„APIè®¾è®¡å…è®¸å‰ç½®é€šçŸ¥ä½¿ç”¨åœ¨åŸŸä¸Šï¼Œå°½ç®¡é€šå¸¸æ˜¯é€‚ç”¨äºå­—æ®µæ‹¦æˆªçš„ï¼Œè€Œ Springä¹Ÿä¸å¯èƒ½å®ç°å®ƒï¼‰ã€‚</p><p>æ³¨æ„beforeæ–¹æ³•çš„è¿”å›ç±»å‹æ˜¯<code>void</code>çš„ã€‚å‰ç½®é€šçŸ¥å¯ä»¥åœ¨è¿æ¥ç‚¹æ‰§è¡Œä¹‹å‰æ’å…¥è‡ªå®šä¹‰è¡Œä¸ºï¼Œä½†ä¸èƒ½æ›´æ”¹è¿”å›å€¼ã€‚å¦‚æœå‰ç½®é€šçŸ¥æŠ›å‡ºäº†å¼‚å¸¸ï¼Œ å°†ä¼šä¸­æ­¢æ‹¦æˆªå™¨é“¾çš„è¿›ä¸€æ­¥æ‰§è¡Œï¼Œè¯¥å¼‚å¸¸å°†ä¼šä¼ å›ç»™æ‹¦æˆªå™¨é“¾ã€‚å¦‚æœå®ƒæ ‡è®°äº†uncheckedï¼Œæˆ–è€…æ˜¯åœ¨è§¦å‘æ–¹æ³•çš„ç­¾åä¸Šï¼Œé‚£ä¹ˆå®ƒå°†ç›´æ¥ä¼ é€’ç»™å®¢æˆ·ç«¯ã€‚å¦åˆ™ï¼Œå®ƒç”±AOPä»£ç†åŒ…è£…åœ¨æœªç»æ£€æŸ¥çš„å¼‚å¸¸ä¸­ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†Springä¸­çš„å‰ç½®é€šçŸ¥ï¼Œè¯¥é€šçŸ¥è®¡ç®—æ‰€æœ‰æ–¹æ³•è°ƒç”¨:</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CountingBeforeAdvice</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">MethodBeforeAdvice</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> count;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">before</span><span class="hljs-params">(Method m, Object[] args, Object <span class="hljs-keyword">target</span>)</span> <span class="hljs-keyword">throws</span> Throwable </span>&#123;        ++count;    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getCount</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> count;    &#125;&#125;<br></code></pre></td></tr></table></figure><p>å‰ç½®é€šçŸ¥å¯ä»¥ç”¨åœ¨ä»»æ„çš„åˆ‡ç‚¹ä¸Š</p><h5 id="å¼‚å¸¸é€šçŸ¥"><a href="#å¼‚å¸¸é€šçŸ¥" class="headerlink" title="å¼‚å¸¸é€šçŸ¥"></a>å¼‚å¸¸é€šçŸ¥</h5><p>å¼‚å¸¸é€šçŸ¥æ˜¯åœ¨è¿æ¥ç‚¹è¿”å›åè§¦å‘çš„ï¼Œå‰ææ˜¯è¿æ¥ç‚¹æŠ›å‡ºäº†å¼‚å¸¸ã€‚Springæä¾›äº†ç±»å‹åŒ–çš„æŠ›å‡ºé€šçŸ¥ã€‚è¯·æ³¨æ„ï¼Œè¿™æ„å‘³ç€<code>org.springframework.aop.ThrowsAdvice</code>æ¥å£ä¸åŒ…å«ä»»ä½•æ–¹æ³•ã€‚ å®ƒåªæ˜¯æ ‡è¯†ç»™å®šå¯¹è±¡å®ç°ä¸€ä¸ªæˆ–å¤šä¸ªç±»å‹åŒ–å¼‚å¸¸é€šçŸ¥æ–¹æ³•çš„æ ‡è¯†æ¥å£,è¿™äº›åº”è¯¥æ˜¯ä»¥ä¸‹å½¢å¼:</p><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs oxygene">afterThrowing([<span class="hljs-keyword">Method</span>, <span class="hljs-title function_">args</span>, <span class="hljs-title function_">target</span>], <span class="hljs-title function_">subclassOfThrowable</span>)<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•åªæœ‰æœ€åä¸€ä¸ªå‚æ•°æ˜¯å¿…éœ€çš„ã€‚æ–¹æ³•ç­¾åå¯ä»¥æœ‰ä¸€ä¸ªæˆ–å››ä¸ªå‚æ•°ï¼Œå…·ä½“å–å†³äºé€šçŸ¥æ–¹æ³•æ˜¯å¦å¯¹æ–¹æ³•å’Œå‚æ•°æœ‰å½±å“ã€‚ æ¥ä¸‹æ¥çš„ä¸¤ä¸ªåˆ—è¡¨æ˜¾ç¤ºäº†ä½œä¸ºå¼‚å¸¸é€šçŸ¥ç¤ºä¾‹çš„ç±»ã€‚.</p><p>å¦‚æœæŠ›å‡º<code>RemoteException</code>ï¼ˆåŒ…æ‹¬å­ç±»ï¼‰ï¼Œåˆ™è°ƒç”¨ä»¥ä¸‹é€šçŸ¥:</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-symbol">RemoteThrowsAdvice</span> <span class="hljs-symbol">implements</span> <span class="hljs-symbol">ThrowsAdvice</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> afterThrowing(RemoteException ex) throws Throwable &#123;        <span class="hljs-comment">// Do something with remote exception    &#125;&#125;</span><br></code></pre></td></tr></table></figure><p>ä¸å‰é¢çš„é€šçŸ¥ä¸åŒï¼Œä¸‹ä¸€ä¸ªç¤ºä¾‹å£°æ˜äº†å››ä¸ªå‚æ•°ï¼Œä»¥ä¾¿å®ƒå¯ä»¥è®¿é—®è¢«è°ƒç”¨çš„æ–¹æ³•ï¼Œæ–¹æ³•å‚æ•°å’Œç›®æ ‡å¯¹è±¡ã€‚ å¦‚æœæŠ›å‡º<code>ServletException</code>ï¼Œåˆ™è°ƒç”¨ä»¥ä¸‹é€šçŸ¥ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServletThrowsAdviceWithArguments</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ThrowsAdvice</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">afterThrowing</span>(<span class="hljs-params">Method m, <span class="hljs-built_in">Object</span>[] args, <span class="hljs-built_in">Object</span> target, ServletException ex</span>) &#123;        <span class="hljs-comment">// Do something with all arguments    &#125;&#125;</span><br></code></pre></td></tr></table></figure><p>æœ€åçš„ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•åœ¨å•ä¸ªç±»ä¸­ä½¿ç”¨è¿™ä¸¤ç§æ–¹æ³•,å®ƒèƒ½å¤„ç†<code>RemoteException</code>å’Œ<code>ServletException</code>å¼‚å¸¸ã€‚ä»»ä½•æ•°é‡çš„å¼‚å¸¸é€šçŸ¥æ–¹æ³•éƒ½å¯ä»¥åœ¨å•ä¸ªç±»ä¸­è¿›è¡Œç»„åˆã€‚ä»¥ä¸‹æ¸…å•æ˜¾ç¤ºäº†æœ€åä¸€ä¸ªç¤ºä¾‹:</p><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs oxygene"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> CombinedThrowsAdvice <span class="hljs-keyword">implements</span> ThrowsAdvice <span class="hljs-comment">&#123;</span><br><span class="hljs-comment">    public void afterThrowing(RemoteException ex) throws Throwable &#123;        // Do something with remote exception    &#125;</span><br>    <span class="hljs-keyword">public</span> void afterThrowing(<span class="hljs-keyword">Method</span> <span class="hljs-title function_">m</span>, <span class="hljs-title function_">Object</span>[] <span class="hljs-title function_">args</span>, <span class="hljs-title function_">Object</span> <span class="hljs-title function_">target</span>, <span class="hljs-title function_">ServletException</span> <span class="hljs-title function_">ex</span>) <span class="hljs-comment">&#123;        // Do something with all arguments    &#125;</span>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœå¼‚å¸¸é€šçŸ¥æ–¹æ³•å¼•å‘äº†å¼‚å¸¸ï¼Œé‚£ä¹ˆå®ƒå°†ä¼šé‡å†™åŸå§‹çš„å¼‚å¸¸ï¼ˆå³æ›´æ”¹ä¸ºå‘ç”¨æˆ·æŠ›å‡ºå¼‚å¸¸ï¼‰ã€‚è¦†ç›–å¼‚å¸¸é€šå¸¸æ˜¯RuntimeExceptionï¼Œå®ƒä¸ä»»ä½•æ–¹æ³•ç­¾åå…¼å®¹ã€‚ ä½†æ˜¯ï¼Œå¦‚æœå¼‚å¸¸é€šçŸ¥æ–¹æ³•å¼•å‘äº†checkedå¼‚å¸¸ï¼Œé‚£ä¹ˆå®ƒå¿…é¡»ä¸ç›®æ ‡æ–¹æ³•çš„å·²å£°æ˜çš„å¼‚å¸¸ç›¸åŒ¹é…ï¼Œå› æ­¤åœ¨æŸç§ç¨‹åº¦ä¸Šè€¦åˆåˆ°ç‰¹å®šçš„ç›®æ ‡æ–¹æ³•ç­¾åã€‚ä¸è¦æŠ›å‡ºä¸ç›®æ ‡æ–¹æ³•ç­¾åä¸å…¼å®¹çš„æœªå£°æ˜çš„checkedå¼‚å¸¸ï¼</p><p>å¼‚å¸¸é€šçŸ¥å¯ä»¥è¢«ç”¨åœ¨ä»»æ„åˆ‡ç‚¹ä¸Š</p><h5 id="åç½®è¿”å›é€šçŸ¥"><a href="#åç½®è¿”å›é€šçŸ¥" class="headerlink" title="åç½®è¿”å›é€šçŸ¥"></a>åç½®è¿”å›é€šçŸ¥</h5><p>Springä¸­ä½¿ç”¨åç½®è¿”å›é€šçŸ¥å¿…éœ€å®ç°<code>org.springframework.aop.AfterReturningAdvice</code> æ¥å£, å¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">AfterReturningAdvice</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Advice</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">afterReturning</span><span class="hljs-params">(Object returnValue, Method m, Object[] args, Object <span class="hljs-keyword">target</span>)</span>            <span class="hljs-keyword">throws</span> Throwable</span>;&#125;<br></code></pre></td></tr></table></figure><p>åç½®è¿”å›é€šçŸ¥å¯ä»¥è®¿é—®è¿”å›å€¼ï¼ˆä¸èƒ½ä¿®æ”¹ï¼‰ã€è°ƒç”¨çš„æ–¹æ³•ã€æ–¹æ³•å‚æ•°å’Œç›®æ ‡ã€‚</p><p>ä¸‹é¢ä¾‹å­çš„åç½®è¿”å›é€šçŸ¥ä¼šç»Ÿè®¡æ‰€æœ‰æˆåŠŸçš„ã€ä¸å¼•å‘å¼‚å¸¸çš„æ–¹æ³•è°ƒç”¨æ¬¡æ•°:</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CountingAfterReturningAdvice</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">AfterReturningAdvice</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> count;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">afterReturning</span><span class="hljs-params">(Object returnValue, Method m, Object[] args, Object <span class="hljs-keyword">target</span>)</span>            <span class="hljs-keyword">throws</span> Throwable </span>&#123;        ++count;    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getCount</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> count;    &#125;&#125;<br></code></pre></td></tr></table></figure><p>æ­¤é€šçŸ¥ä¸ä¼šæ›´æ”¹æ‰§è¡Œè·¯å¾„ï¼Œå¦‚æœæŠ›å‡ºå¼‚å¸¸ï¼Œå°†æŠ›å‡ºæ‹¦æˆªå™¨é“¾è€Œä¸æ˜¯è¿”å›å€¼ã€‚</p><p>åç½®è¿”å›é€šçŸ¥èƒ½è¢«ä»»ä½•åˆ‡ç‚¹ä½¿ç”¨</p><h5 id="å¼•å…¥é€šçŸ¥"><a href="#å¼•å…¥é€šçŸ¥" class="headerlink" title="å¼•å…¥é€šçŸ¥"></a>å¼•å…¥é€šçŸ¥</h5><p>Springå°†å¼•å…¥é€šçŸ¥çœ‹ä½œæ˜¯ä¸€ç§ç‰¹æ®Šçš„æ‹¦æˆªå™¨é€šçŸ¥</p><p>å¼•å…¥é€šçŸ¥éœ€è¦<code>IntroductionAdvisor</code> å’Œ<code>IntroductionInterceptor</code>ï¼Œä»–ä»¬éƒ½å®ç°äº†ä¸‹é¢çš„æ¥å£:</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-symbol">IntroductionInterceptor</span> <span class="hljs-symbol">extends</span> <span class="hljs-symbol">MethodInterceptor</span> &#123;<br>    <span class="hljs-built_in">bool</span>ean implementsInterface(Class <span class="hljs-built_in">int</span>f);&#125;<br></code></pre></td></tr></table></figure><p>ä»AOP Alliance <code>MethodInterceptor</code>æ¥å£ç»§æ‰¿çš„<code>invoke()</code>æ–¹æ³•ä¹Ÿéƒ½å¿…é¡»å®ç°å¼•å…¥ã€‚å³å¦‚æœinvokedæ–¹æ³•æ˜¯ä¸€ä¸ªå¼•å…¥æ¥å£ï¼Œ å¼•å…¥æ‹¦æˆªå™¨å°†ä¼šè´Ÿè´£å¤„ç†è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨-å®ƒæ— æ³•è§¦å‘<code>proceed()</code>ã€‚</p><p>å¼•å…¥é€šçŸ¥ä¸èƒ½ä¸ä»»ä½•åˆ‡ç‚¹ä¸€èµ·ä½¿ç”¨ï¼Œå› ä¸ºå®ƒåªé€‚ç”¨äºç±»çº§åˆ«ï¼Œè€Œä¸æ˜¯æ–¹æ³•çº§åˆ«ã€‚å¼€å‘è€…åªèƒ½ä½¿ç”¨<code>IntroductionAdvisor</code>çš„å¼•å…¥é€šçŸ¥ï¼Œå®ƒå…·æœ‰ä»¥ä¸‹æ–¹æ³•:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IntroductionAdvisor</span> <span class="hljs-title">extends</span> <span class="hljs-title">Advisor</span>, <span class="hljs-title">IntroductionInfo</span> &#123;<br>    <span class="hljs-function">ClassFilter <span class="hljs-title">getClassFilter</span>()</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">validateInterfaces</span>() throws IllegalArgumentException</span>;&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IntroductionInfo</span> &#123;<br>    <span class="hljs-function">Class[] <span class="hljs-title">getInterfaces</span>()</span>;&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œå¦‚æœæ²¡æœ‰ä¸<code>MethodMatcher</code> ç›¸å…³çš„å¼•å…¥é€šçŸ¥ç±»ã€‚ä¹Ÿå°±ä¸ä¼šæœ‰<code>Pointcut</code> ã€‚æ­¤æ—¶ï¼Œåªæœ‰filteringç±»æ˜¯ç¬¦åˆé€»è¾‘çš„ã€‚</p><p><code>getInterfaces()</code>æ–¹æ³•è¿”å›é€šçŸ¥è€…çš„å¼•å…¥æ¥å£</p><p><code>validateInterfaces()</code>æ–¹æ³•åœ¨å†…éƒ¨ä½¿ç”¨ï¼Œå¯ä»¥æŸ¥çœ‹å¼•å…¥æ¥å£æ˜¯å¦å¯ä»¥ç”±é…ç½®çš„ <code>IntroductionInterceptor</code>å®ç°ã€‚</p><p>è€ƒè™‘Springæµ‹è¯•å¥—ä»¶ä¸­çš„ä¸€ä¸ªç¤ºä¾‹ï¼Œå¹¶å‡è®¾æˆ‘ä»¬è¦å°†ä»¥ä¸‹æ¥å£å¼•å…¥ä¸€ä¸ªæˆ–å¤šä¸ªå¯¹è±¡:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">Lockable</span> &#123;<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">lock</span>()</span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">unlock</span>()</span>;<br><br>    <span class="hljs-function">boolean <span class="hljs-title">locked</span>()</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªè¯´æ˜æ˜¯æ··åˆå‹çš„ã€‚æˆ‘ä»¬å¸Œæœ›å¯ä»¥å°†æ— è®ºæ˜¯ä»€ä¹ˆç±»å‹çš„é€šçŸ¥å¯¹è±¡éƒ½è½¬æˆ<code>Lockable</code>,è¿™æ ·å¯ä»¥è°ƒç”¨å®ƒçš„lockå’Œunlockæ–¹æ³•ã€‚å¦‚æœè°ƒç”¨çš„æ˜¯<code>lock()</code>æ–¹æ³•ï¼Œå¸Œæœ›æ‰€æœ‰çš„setteræ–¹æ³•éƒ½æŠ›å‡ºLockedExceptionå¼‚å¸¸ã€‚ å› æ­¤ï¼Œå¯ä»¥æ·»åŠ ä¸€ä¸ªåˆ‡é¢ï¼Œå®ƒæä¾›äº†å¯¹è±¡ä¸å¯å˜çš„èƒ½åŠ›ï¼Œè€Œä¸éœ€è¦å¯¹å®ƒæœ‰ä»»ä½•äº†è§£ã€‚AOPçš„ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­t: a good example of AOP.</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¯ä»¥å®Œæˆç¹é‡å·¥ä½œçš„<code>IntroductionInterceptor</code>ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ‰©å±•äº†<code>org.springframework.aop.support.DelegatingIntroductionInterceptor</code>ç±»æ›´æ–¹ä¾¿ã€‚ æˆ‘ä»¬å¯ä»¥ç›´æ¥å®ç°<code>IntroductionInterceptor</code>ï¼Œä½†ä½¿ç”¨<code>DelegatingIntroductionInterceptor</code>æœ€é€‚åˆå¤§å¤šæ•°æƒ…å†µã€‚</p><p><code>DelegatingIntroductionInterceptor</code> è®¾è®¡æ˜¯ä¸ºäº†å°†å¼•å…¥å§”æ‰˜è®©ç»™å¼•å…¥æ¥å£çœŸæ­£çš„å®ç°ç±»ï¼Œä»è€Œéšè—äº†æ‹¦æˆªå™¨å»åšè¿™ä¸ªäº‹ã€‚å¯ä»¥ä½¿ç”¨æ„é€ å‡½æ•°å‚æ•°å°†å§”æ‰˜è®¾ç½®ä¸ºä»»ä½•å¯¹è±¡ã€‚ é»˜è®¤å§”æ‰˜ï¼ˆå½“ä½¿ç”¨æ— å‚æ•°æ„é€ å‡½æ•°æ—¶ï¼‰æ—¶æ˜¯ <code>this</code>çš„ã€‚ å› æ­¤ï¼Œåœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œ å§”æ‰˜æ˜¯<code>DelegatingIntroductionInterceptor</code> ä¸­çš„<code>LockMixin</code>å­ç±»ã€‚ ç»™å®šä¸€ä¸ªå§”æ‰˜ (é»˜è®¤æ˜¯å®ƒæœ¬èº«ï¼‰ï¼Œ <code>DelegatingIntroductionInterceptor</code>å®ä¾‹å°†æŸ¥æ‰¾å§”æ‰˜(é<code>IntroductionInterceptor</code>ï¼‰å®ç°çš„æ‰€æœ‰æ¥å£ï¼Œå¹¶æ”¯æŒå¯¹å…¶ä¸­ä»»ä½•ä¸€ä¸ªçš„å¼•å…¥ã€‚å­ç±»(å¦‚ <code>LockMixin</code>ï¼‰å¯ä»¥è°ƒç”¨ <code>suppressInterface(Class intf)</code>æ–¹æ³•æ¥æ§åˆ¶ä¸åº”è¯¥å…¬å¼€çš„æ¥å£ã€‚ ä½†æ˜¯ï¼Œæ— è®º <code>IntroductionInterceptor</code>å‡†å¤‡æ”¯æŒå¤šå°‘æ¥å£ï¼Œä½¿ç”¨<code>IntroductionAdvisor</code>éƒ½å¯ä»¥æ§åˆ¶å®é™…å…¬å¼€çš„æ¥å£ã€‚å¼•å…¥æ¥å£å°†éšè—ç›®æ ‡å¯¹åŒä¸€æ¥å£çš„ä»»ä½•å®ç°ã€‚</p><p>å› æ­¤ï¼Œ <code>LockMixin</code> æ‰©å±•äº†<code>DelegatingIntroductionInterceptor</code>å¹¶å®ç°äº†<code>Lockable</code> æœ¬èº«ã€‚ è¶…ç±»è‡ªåŠ¨é€‰æ‹©å¯ä»¥æ”¯æŒ<code>Lockable</code> å¼•å…¥ï¼Œå› æ­¤æˆ‘ä»¬ä¸éœ€è¦æŒ‡å®šã€‚ æˆ‘ä»¬å¯ä»¥ç”¨è¿™ç§æ–¹å¼å¼•å…¥ä»»æ„æ•°é‡çš„æ¥å£ã€‚</p><p>è¯·æ³¨æ„ä½¿ç”¨<code>locked</code> å®ä¾‹å˜é‡ï¼Œè¿™æœ‰æ•ˆåœ°å°†é™„åŠ çŠ¶æ€æ·»åŠ åˆ°ç›®æ ‡å¯¹è±¡ä¸­ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†ç¤ºä¾‹<code>LockMixin</code>ç±»:</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LockMixin</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">DelegatingIntroductionInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Lockable</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> locked;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">lock</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">this</span>.locked = <span class="hljs-keyword">true</span>;    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">unlock</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">this</span>.locked = <span class="hljs-keyword">false</span>;    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">locked</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.locked;    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function">Object <span class="hljs-title">invoke</span><span class="hljs-params">(MethodInvocation invocation)</span> <span class="hljs-keyword">throws</span> Throwable </span>&#123;        <span class="hljs-keyword">if</span> (locked() &amp;&amp; invocation.getMethod().getName().indexOf(<span class="hljs-string">&quot;set&quot;</span>) == <span class="hljs-number">0</span>) &#123;            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> LockedException();        &#125;        <span class="hljs-function"><span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.<span class="hljs-title">invoke</span><span class="hljs-params">(invocation)</span></span>;    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é€šå¸¸ï¼Œæ‚¨ä¸éœ€è¦è¦†ç›–<code>invoke()</code>æ–¹æ³•ã€‚ <code>DelegatingIntroductionInterceptor</code>å®ç°ï¼ˆå¦‚æœå¼•å…¥æ–¹æ³•åˆ™è°ƒç”¨<code>delegate</code>æ–¹æ³•ï¼Œå¦åˆ™å°±å¯¹è¿æ¥ç‚¹è¿›è¡Œæ“ä½œï¼‰é€šå¸¸å°±è¶³å¤Ÿäº†ã€‚ åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ªæ£€æŸ¥ï¼šå¦‚æœå¤„äºé”å®šæ¨¡å¼ï¼Œåˆ™ä¸èƒ½è°ƒç”¨setteræ–¹æ³•ã€‚</p><p>å¼•å…¥é€šçŸ¥è€…æ˜¯éå¸¸ç®€å•çš„ï¼Œå®ƒéœ€è¦åšçš„æ‰€æœ‰äº‹æƒ…å°±æ˜¯æŒæœ‰ä¸€ä¸ªç‹¬ç‰¹çš„<code>LockMixin</code>å®ä¾‹ï¼Œå¹¶æŒ‡å®šå¼•å…¥æ¥å£ ã€‚ åœ¨ä¾‹å­ä¸­å°±æ˜¯ <code>Lockable</code>ã€‚ ä¸€ä¸ªæ›´å¤æ‚çš„ç¤ºä¾‹å¯èƒ½ä¼šå¼•ç”¨å¼•å…¥æ‹¦æˆªå™¨ ï¼ˆè¢«å®šä¹‰ä¸ºåŸå‹ï¼‰ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ²¡æœ‰ä¸<code>LockMixin</code>ç›¸å…³çš„é…ç½®ï¼Œå› æ­¤æˆ‘ä»¬ä½¿ç”¨<code>new</code>åˆ›å»ºå®ƒã€‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†æˆ‘ä»¬çš„<code>LockMixinAdvisor</code>ç±»:</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs scala">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LockMixinAdvisor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">DefaultIntroductionAdvisor</span> </span>&#123;<br>    public <span class="hljs-type">LockMixinAdvisor</span>() &#123;        <span class="hljs-keyword">super</span>(<span class="hljs-keyword">new</span> <span class="hljs-type">LockMixin</span>(), <span class="hljs-type">Lockable</span>.<span class="hljs-keyword">class</span>);    &#125;&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥éå¸¸ç®€å•åœ°åº”ç”¨è¿™ä¸ªé€šçŸ¥è€…ï¼Œå› ä¸ºå®ƒä¸éœ€è¦é…ç½®ã€‚ï¼ˆä½†æ˜¯ï¼Œæ²¡æœ‰<code>IntroductionAdvisor</code>å°±ä¸å¯èƒ½ä½¿ç”¨<code>IntroductionInterceptor</code>ã€‚ï¼‰ä¸é€šå¸¸çš„å¼•å…¥ä¸€æ ·ï¼Œ é€šçŸ¥è€…å¿…é¡»æ˜¯ä¸ªå•å®ä¾‹ï¼ˆper-instanceï¼‰ï¼Œå› ä¸ºå®ƒæ˜¯æœ‰çŠ¶æ€çš„ã€‚éœ€è¦ä¸ºæ¯ä¸ªé€šçŸ¥çš„å¯¹è±¡åˆ›å»ºæ¯ä¸€ä¸ªä¸åŒçš„<code>LockMixinAdvisor</code>å®ä¾‹å’Œ<code>LockMixin</code>ã€‚é€šçŸ¥è€…ä¹ŸåŒ…æ‹¬é€šçŸ¥å¯¹è±¡çŠ¶æ€çš„ä¸€éƒ¨åˆ†</p><p>å¯ä»¥ä½¿ç”¨ <code>Advised.addAdvisor()</code>æ–¹æ³•æˆ–åœ¨åœ¨XMLé…ç½®ä¸­ï¼ˆæ¨èæ­¤æ³•ï¼‰ç¼–å†™é€šçŸ¥è€…ï¼Œè¿™ä¸å…¶ä»–ä»»ä½•çš„é€šçŸ¥è€…ä¸€æ ·ã€‚ä¸‹é¢è®¨è®ºçš„æ‰€æœ‰ä»£ç†åˆ›å»ºé€‰é¡¹ï¼Œ åŒ…æ‹¬è‡ªåŠ¨ä»£ç†åˆ›å»ºï¼Œéƒ½æ­£ç¡®å¤„ç†äº†å¼•å…¥å’Œæœ‰çŠ¶æ€çš„mixinã€‚</p><h3 id="3-3-Springä¸­é€šçŸ¥è€…çš„API"><a href="#3-3-Springä¸­é€šçŸ¥è€…çš„API" class="headerlink" title="3.3.Springä¸­é€šçŸ¥è€…çš„API"></a>3.3.Springä¸­é€šçŸ¥è€…çš„API</h3><p>åœ¨Springä¸­ï¼Œä¸€ä¸ªé€šçŸ¥è€…å°±æ˜¯ä¸€ä¸ªåˆ‡é¢ï¼Œä¸€ä¸ªä»…åŒ…å«ä¸å•ä¸ªé€šçŸ¥å¯¹è±¡å…³è”çš„åˆ‡ç‚¹è¡¨è¾¾å¼ã€‚</p><p>é™¤äº†å¼•å…¥æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ä¾‹å­å¤–ï¼Œé€šçŸ¥è€…èƒ½å¤Ÿç”¨äºæ‰€æœ‰çš„é€šçŸ¥ä¸Šã€‚<code>org.springframework.aop.support.DefaultPointcutAdvisor</code>ç±»æ˜¯æœ€å¸¸ä½¿ç”¨çš„é€šçŸ¥è€…ç±»ã€‚ å®ƒå¯ä»¥ä¸<code>MethodInterceptor</code>, <code>BeforeAdvice</code>æˆ–<code>ThrowsAdvice</code>ä¸€èµ·ä½¿ç”¨ã€‚</p><p>åœ¨åŒä¸€ä¸ªAOPä»£ç†ä¸­ï¼Œå¯ä»¥åœ¨Springä¸­æ··åˆä½¿ç”¨é€šçŸ¥è€…å’Œé€šçŸ¥ç±»å‹ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªä»£ç†é…ç½®ä¸­åŒæ—¶ä½¿ç”¨ç¯ç»•é€šçŸ¥ã€å¼‚å¸¸é€šçŸ¥å’Œå‰ç½®é€šçŸ¥ã€‚Springè‡ªåŠ¨åˆ›å»ºå¿…è¦çš„æ‹¦æˆªé“¾ã€‚</p><h3 id="3-4-ä½¿ç”¨ProxyFactoryBeanæ¥åˆ›å»ºAOPä»£ç†"><a href="#3-4-ä½¿ç”¨ProxyFactoryBeanæ¥åˆ›å»ºAOPä»£ç†" class="headerlink" title="3.4. ä½¿ç”¨ProxyFactoryBeanæ¥åˆ›å»ºAOPä»£ç†"></a>3.4. ä½¿ç”¨<code>ProxyFactoryBean</code>æ¥åˆ›å»ºAOPä»£ç†</h3><p>å¦‚æœä½ ä¸ºä¸šåŠ¡å¯¹è±¡ä½¿ç”¨Spring IoCå®¹å™¨ï¼ˆä¸€ä¸ª <code>ApplicationContext</code> æˆ– <code>BeanFactory</code>ï¼‰ï¼ˆåŒæ—¶ä¹Ÿåº”è¯¥è¿™ä¹ˆåšï¼ï¼‰ï¼Œ é‚£ä¹ˆå¯èƒ½å¸Œæœ›ç”¨åˆ°å…¶ä¸­ä¸€ä¸ªSpringçš„AOP <code>FactoryBean</code>ã€‚ ï¼ˆè¯·è®°ä½ï¼Œå·¥å‚beanå¼•å…¥äº†ä¸€ä¸ªé—´æ¥å±‚ï¼Œè®©å®ƒåˆ›å»ºä¸€ä¸ªä¸åŒç±»å‹çš„å¯¹è±¡ã€‚ï¼‰</p><p>Spring AOPæ”¯æŒä¹Ÿä½¿ç”¨åˆ°äº†å·¥å‚bean</p><p>åœ¨Springä¸­åˆ›å»ºAOPä»£ç†çš„åŸºæœ¬æ–¹æ³•æ˜¯ä½¿ç”¨<code>org.springframework.aop.framework.ProxyFactoryBean</code>. è¿™å°†å®Œå…¨æ§åˆ¶åˆ‡ç‚¹å’Œåº”ç”¨çš„é€šçŸ¥åŠé¡ºåºã€‚ ä½†æ˜¯ï¼Œå¦‚æœä¸éœ€è¦è¿™æ ·çš„æ§åˆ¶ï¼Œå¯ä»¥æœ‰æ›´ç®€å•çš„é€‰é¡¹ã€‚</p><h4 id="3-4-1-åŸºç¡€è®¾ç½®"><a href="#3-4-1-åŸºç¡€è®¾ç½®" class="headerlink" title="3.4.1. åŸºç¡€è®¾ç½®"></a>3.4.1. åŸºç¡€è®¾ç½®</h4><p><code>ProxyFactoryBean</code>ä¸å…¶ä»–Spring <code>FactoryBean</code> çš„å®ç°ä¸€æ ·ï¼Œå¼•å…¥äº†ä¸€ä¸ªé—´æ¥å±‚ã€‚å¦‚æœå®šä¹‰äº†ä¸€ä¸ªåä¸º<code>foo</code>çš„<code>ProxyFactoryBean</code>ï¼Œ é‚£ä¹ˆå¼•ç”¨<code>foo</code>çš„å¯¹è±¡ä¸æ˜¯<code>ProxyFactoryBean</code>å®ä¾‹æœ¬èº«ï¼Œè€Œæ˜¯ç”±<code>ProxyFactoryBean</code> å®ç°çš„<code>getObject()</code> æ–¹æ³•åˆ›å»ºçš„å¯¹è±¡ã€‚æ­¤æ–¹æ³•å°†åˆ›å»ºä¸€ä¸ªç”¨äºåŒ…è£…ç›®æ ‡å¯¹è±¡çš„AOPä»£ç†</p><p>ä½¿ç”¨<code>ProxyFactoryBean</code>æˆ–å¦ä¸€ä¸ªIoCè¯†åˆ«ç±»æ¥åˆ›å»ºAOPä»£ç†çš„æœ€é‡è¦çš„å¥½å¤„ä¹‹ä¸€æ˜¯ï¼Œå®ƒæ„å‘³ç€å»ºè®®å’Œåˆ‡ç‚¹ä¹Ÿå¯ä»¥ç”±IoCå®¹å™¨ç®¡ç†ã€‚è¿™æ˜¯ä¸€ä¸ªå¼ºå¤§çš„åŠŸèƒ½ï¼Œèƒ½å¤Ÿå®ç°å…¶ä»–AOPæ¡†æ¶æ— æ³•å®ç°çš„æ–¹æ³•ã€‚ ä¾‹å¦‚ï¼Œé€šçŸ¥æœ¬èº«å¯ä»¥å¼•ç”¨åº”ç”¨ç¨‹åºå¯¹è±¡ï¼ˆé™¤äº†ç›®æ ‡ï¼Œå®ƒåº”è¯¥åœ¨ä»»ä½•AOPæ¡†æ¶ä¸­å¯ç”¨ï¼‰ï¼Œè¿™å¾—ç›Šäºä¾èµ–æ³¨å…¥æä¾›çš„æ‰€æœ‰å¯æ’å…¥åŠŸèƒ½ã€‚</p><h4 id="3-4-2-JavaBean-å±æ€§"><a href="#3-4-2-JavaBean-å±æ€§" class="headerlink" title="3.4.2. JavaBean å±æ€§"></a>3.4.2. JavaBean å±æ€§</h4><p>ä¸Springæä¾›çš„å¤§å¤šæ•°<code>FactoryBean</code> å®ç°ä¸€æ ·ï¼Œ<code>ProxyFactoryBean</code>ç±»æœ¬èº«å°±æ˜¯ä¸€ä¸ªJavaBeanã€‚ å…¶å±æ€§ç”¨äº:</p><ul><li>æŒ‡å®šéœ€è¦ä»£ç†çš„ç›®æ ‡</li><li>æŒ‡å®šæ˜¯å¦ä½¿ç”¨CGLIBï¼ˆç¨åä»‹ç»ï¼Œå¦è¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/core/aop-api/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-pfb-proxy-types">åŸºäºJDKå’ŒCGLIBçš„ä»£ç†</a>ï¼‰ã€‚</li></ul><p>ä¸€äº›å…³é”®å±æ€§ç»§æ‰¿è‡ª<code>org.springframework.aop.framework.ProxyConfig</code>ï¼ˆSpringä¸­æ‰€æœ‰AOPä»£ç†å·¥å‚çš„è¶…ç±»ï¼‰ã€‚ è¿™äº›å…³é”®å±æ€§åŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š</p><ul><li><code>proxyTargetClass</code>: å¦‚æœç›®æ ‡ç±»éœ€è¦ä»£ç†ï¼Œè€Œä¸æ˜¯ç›®æ ‡ç±»çš„æ¥å£æ—¶ï¼Œåˆ™ä¸º<code>true</code>ã€‚å¦‚æœæ­¤å±æ€§å€¼è®¾ç½®ä¸ºtrueï¼Œåˆ™ä¼šåˆ›å»ºCGLIBä»£ç†ï¼ˆä½†å¦è¯·å‚é˜… <a href="https://sca.aliyun.com/learn/spring/core/aop-api/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-pfb-proxy-types">åŸºäºJDKå’ŒCGLIBçš„ä»£ç†</a>ï¼‰ã€‚</li><li><code>optimize</code>:æ§åˆ¶æ˜¯å¦å°†è¿›ä¸€æ­¥ä¼˜åŒ–ä½¿ç”¨CGLIBåˆ›å»ºçš„ä»£ç†ã€‚é™¤éå®Œå…¨äº†è§£ç›¸å…³çš„AOPä»£ç†å¦‚ä½•å¤„ç†ä¼˜åŒ–ï¼Œå¦åˆ™ä¸åº”è‰ç‡åœ°ä½¿ç”¨æ­¤è®¾ç½®ã€‚ç›®å‰è¿™åªç”¨äºCGLIBä»£ç†ï¼Œå®ƒå¯¹JDKåŠ¨æ€ä»£ç†ä¸èµ·ä½œç”¨ã€‚</li><li><code>frozen</code>: å¦‚æœä»£ç†é…ç½®è¢«<code>frozen</code>,åˆ™ä¸å†å…è®¸å¯¹é…ç½®è¿›è¡Œæ›´æ”¹ã€‚è¿™æ—¢å¯ä»¥ä½œä¸ºä¸€ç§è½»å¾®çš„ä¼˜åŒ–ï¼Œä¹Ÿé€‚ç”¨äºå½“ä¸å¸Œæœ›è°ƒç”¨æ–¹åœ¨åˆ›å»ºä»£ç†åèƒ½å¤Ÿæ“ä½œä»£ç†ï¼ˆé€šè¿‡<code>Advised</code>æ¥å£ï¼‰ çš„æƒ…å†µã€‚ æ­¤å±æ€§çš„é»˜è®¤å€¼ä¸º <code>false</code>ï¼Œå› æ­¤å¦‚æœå…è®¸æ·»åŠ å…¶ä»–çš„é€šçŸ¥çš„è¯å¯ä»¥æ›´æ”¹ã€‚</li><li><code>exposeProxy</code>: ç¡®å®šå½“å‰ä»£ç†æ˜¯å¦åº”åœ¨<code>ThreadLocal</code>ä¸­å…¬å¼€ï¼Œä»¥ä¾¿ç›®æ ‡å¯ä»¥è®¿é—®å®ƒã€‚å¦‚æœç›®æ ‡éœ€è¦è·å–ä»£ç†ï¼Œå¹¶ä¸”<code>exposeProxy</code>å±æ€§è®¾ç½®ä¸º<code>true</code>ã€‚ åˆ™ç›®æ ‡å¯ä»¥ä½¿ç”¨<code>AopContext.currentProxy()</code>æ–¹æ³•ã€‚</li></ul><p><code>ProxyFactoryBean</code>ç‰¹æœ‰çš„å…¶ä»–å±æ€§åŒ…æ‹¬ä»¥ä¸‹å†…å®¹:</p><ul><li><p><code>proxyInterfaces</code>:å­—ç¬¦ä¸²æ¥å£åç§°çš„æ•°ç»„ã€‚å¦‚æœæœªæä¾›æ­¤é¡¹ï¼Œå°†ä½¿ç”¨ç›®æ ‡ç±»çš„CGLIBä»£ç†ï¼ˆ <a href="https://sca.aliyun.com/learn/spring/core/aop-api/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-pfb-proxy-types">åŸºäºJDKå’ŒCGLIBçš„ä»£ç†</a>ï¼‰ã€‚</p></li><li><p><code>interceptorNames</code>:è¦æä¾›çš„é€šçŸ¥è€…ã€æ‹¦æˆªå™¨æˆ–å…¶ä»–é€šçŸ¥åç§°çš„å­—ç¬¦ä¸²æ•°ç»„ã€‚åœ¨å…ˆåˆ°å…ˆå¾—çš„æœåŠ¡åŸºç¡€ä¸Šï¼ŒOrderingï¼ˆé¡ºåºï¼‰æ˜¯é‡è¦çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªæ‹¦æˆªå™¨å°†é¦–å…ˆæ‹¦æˆªè°ƒç”¨ã€‚</p><p>è¿™äº›åç§°æ˜¯å½“å‰å·¥å‚ä¸­çš„beanåç§°ï¼ŒåŒ…æ‹¬æ¥è‡ªä¸Šçº§å·¥å‚çš„beanåç§°ã€‚ä¸èƒ½åœ¨è¿™é‡ŒæåŠbeançš„å¼•ç”¨ï¼Œå› ä¸ºè¿™æ ·åšä¼šå¯¼è‡´<code>ProxyFactoryBean</code>å¿½ç•¥é€šçŸ¥çš„å•ä¾‹ã€‚</p><p>å¯ä»¥è¿½åŠ ä¸€ä¸ªå¸¦æœ‰æ˜Ÿå·(<code>*</code>)çš„æ‹¦æˆªå™¨åç§°ã€‚è¿™å°†å¯¼è‡´åº”ç”¨ç¨‹åºä¸­çš„æ‰€æœ‰è¢«*åŒ¹é…çš„é€šçŸ¥è€…beançš„åç§°éƒ½ä¼šè¢«åŒ¹é…ä¸Šã€‚ æ‚¨å¯ä»¥åœ¨<a href="https://sca.aliyun.com/learn/spring/core/aop-api/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-global-advisors">ä½¿ç”¨å…¨å±€é€šçŸ¥è€…</a>ä¸­æ‰¾åˆ°ä½¿ç”¨æ­¤åŠŸèƒ½çš„ç¤ºä¾‹ã€‚</p></li><li><p>singleton:å·¥å‚å¼ºåˆ¶è¿”å›å•ä¸ªå¯¹è±¡ï¼Œæ— è®ºè°ƒç”¨<code>getObject()</code> æ–¹æ³•å¤šå°‘æ¬¡ã€‚å‡ ä¸ª<code>FactoryBean</code>çš„å®ç°éƒ½æä¾›äº†è¿™æ ·çš„æ–¹æ³•ã€‚é»˜è®¤å€¼æ˜¯<code>true</code>ã€‚ å¦‚æœæƒ³ä½¿ç”¨æœ‰çŠ¶æ€çš„é€šçŸ¥ã€‚ä¾‹å¦‚ï¼Œå¯¹äºæœ‰çŠ¶æ€çš„mixins - ä½¿ç”¨åŸå‹å»ºè®®ä»¥åŠå•ä¾‹å€¼<code>false</code>ã€‚</p></li></ul><h4 id="3-4-3-åŸºäºJDKå’ŒåŸºäºCGLIBçš„ä»£ç†"><a href="#3-4-3-åŸºäºJDKå’ŒåŸºäºCGLIBçš„ä»£ç†" class="headerlink" title="3.4.3. åŸºäºJDKå’ŒåŸºäºCGLIBçš„ä»£ç†"></a>3.4.3. åŸºäºJDKå’ŒåŸºäºCGLIBçš„ä»£ç†</h4><p>æœ¬èŠ‚æ˜¯å…³äº<code>ProxyFactoryBean</code>å¦‚ä½•ä¸ºç‰¹å®šç›®æ ‡å¯¹è±¡ï¼ˆå³å°†è¢«ä»£ç†ï¼‰é€‰æ‹©åˆ›å»ºåŸºäºJDKæˆ–CGLIBçš„ä»£ç†çš„æƒå¨æ€§æ–‡æ¡£ã€‚</p><p><code>ProxyFactoryBean</code>å…³äºåˆ›å»ºåŸºäºJDKæˆ–CGLIBçš„ä»£ç†çš„è¡Œä¸ºåœ¨Springçš„1.2.xå’Œ2.0ç‰ˆæœ¬ä¹‹é—´å‘ç”Ÿäº†å˜åŒ–ã€‚ ç°åœ¨ï¼Œ <code>ProxyFactoryBean</code>åœ¨è‡ªåŠ¨æ£€æµ‹æ¥å£æ–¹é¢è¡¨ç°å‡ºä¸ <code>TransactionProxyFactoryBean</code>ç±»ç›¸ä¼¼çš„è¯­ä¹‰ã€‚</p><p>å¦‚æœè¦ä»£ç†çš„ç›®æ ‡å¯¹è±¡çš„ç±»ï¼ˆä»¥ä¸‹ç®€ç§°ä¸ºç›®æ ‡ç±»ï¼‰æœªå®ç°ä»»ä½•æ¥å£ï¼Œåˆ™åˆ›å»ºåŸºäºCGLIBçš„ä»£ç†ã€‚è¿™æ˜¯æœ€ç®€å•çš„æ–¹æ¡ˆï¼Œå› ä¸ºJDKä»£ç†æ˜¯åŸºäºæ¥å£çš„ï¼Œæ²¡æœ‰æ¥å£æ„å‘³ç€ç”šè‡³ä¸å¯èƒ½è¿›è¡ŒJDKä»£ç†ã€‚ ä¸€ä¸ªç®€å•çš„ä¾‹å­æ˜¯æ’å…¥ç›®æ ‡beanï¼Œå¹¶é€šè¿‡<code>interceptorNames</code>å±æ€§æŒ‡å®šæ‹¦æˆªå™¨åˆ—è¡¨ã€‚è¯·æ³¨æ„ï¼Œå³ä½¿<code>ProxyFactoryBean</code>çš„ <code>proxyTargetClass</code>å±æ€§è¢«è®¾ç½®ä¸º<code>false</code>ï¼Œä¹Ÿä¼šåˆ›å»ºCGLIBçš„ä»£ç†ã€‚ ï¼ˆæ˜¾ç„¶ï¼Œè¿™ä¸ªfalseæ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œæœ€å¥½ä»beanå®šä¹‰ä¸­åˆ é™¤ï¼Œå› ä¸ºå®ƒå……å…¶é‡æ˜¯å†—ä½™çš„ï¼Œè€Œä¸”æ˜¯æœ€å®¹æ˜“äº§ç”Ÿæ··ä¹±ï¼‰ã€‚</p><p>å¦‚æœç›®æ ‡ç±»å®ç°äº†ä¸€ä¸ªï¼ˆæˆ–å¤šä¸ªï¼‰æ¥å£ï¼Œé‚£ä¹ˆæ‰€åˆ›å»ºä»£ç†çš„ç±»å‹å–å†³äº <code>ProxyFactoryBean</code>çš„é…ç½®ã€‚</p><p>å¦‚æœ<code>ProxyFactoryBean</code>çš„<code>proxyTargetClass</code>å±æ€§å·²è®¾ç½®ä¸º<code>true</code>ï¼Œåˆ™ä¼šåˆ›å»ºåŸºäºCGLIBçš„ä»£ç†ã€‚è¿™æ˜¯æœ‰é“ç†çš„ï¼Œå¹¶ä¸”ç¬¦åˆæœ€å°‘æƒŠå–œçš„åŸåˆ™ã€‚ å³ä½¿<code>ProxyFactoryBean</code>çš„<code>proxyInterfaces</code>å±æ€§å·²è®¾ç½®ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªå®Œå…¨é™å®šçš„æ¥å£åç§°ï¼Œ<code>proxyTargetClass</code>å±æ€§è®¾ç½®ä¸º<code>true</code>è¿™ä¸€äº‹å®ä¹Ÿä¼šå¯¼è‡´åŸºäºCGLIBçš„ä»£ç†ç”Ÿæ•ˆã€‚</p><p>å¦‚æœ<code>ProxyFactoryBean</code>çš„ <code>proxyInterfaces</code>å±æ€§å·²è®¾ç½®ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªå®Œå…¨é™å®šçš„æ¥å£åç§°ï¼Œåˆ™ä¼šåˆ›å»ºåŸºäºJDKçš„ä»£ç†ã€‚åˆ›å»ºçš„ä»£ç†å®ç°<code>proxyInterfaces</code>å±æ€§ä¸­æŒ‡å®šçš„æ‰€æœ‰æ¥å£ã€‚ å¦‚æœç›®æ ‡ç±»æ°å¥½å®ç°äº†æ¯”<code>proxyInterfaces</code>å±æ€§ä¸­æŒ‡å®šçš„æ›´å¤šçš„æ¥å£ï¼Œé‚£ä¹ˆè¿™ä¸€åˆ‡éƒ½å¾ˆå¥½ï¼Œä½†æ˜¯è¿™äº›é™„åŠ æ¥å£å°†ä¸ä¼šç”±è¿”å›çš„ä»£ç†å®ç°ã€‚</p><p>å¦‚æœ<code>ProxyFactoryBean</code>çš„<code>proxyInterfaces</code>å±æ€§å…·æœ‰æ²¡æœ‰è¢«è®¾ç½®ï¼Œè€Œç›®æ ‡ç±»ç¡®å®å®ç°ä¸€ä¸ªæˆ–å¤šä¸ªæ¥å£ï¼Œåˆ™ <code>ProxyFactoryBean</code>å°†è‡ªåŠ¨æ£€æµ‹é€‰æ‹©ï¼Œå½“ç›®æ ‡ç±»å®é™…ä¸Šè‡³å°‘å®ç°ä¸€ä¸ªæ¥å£ã€‚ å°†åˆ›å»ºJDKä»£ç†ã€‚å®é™…ä¸Šä»£ç†çš„æ¥å£å°†æ˜¯ç›®æ ‡ç±»å®ç°çš„æ‰€æœ‰æ¥å£ã€‚äº‹å®ä¸Šï¼Œè¿™ä¸ç®€å•åœ°æä¾›äº†ç›®æ ‡ç±»å®ç°åˆ° <code>proxyInterfaces</code> å±æ€§çš„æ¯ä¸ªæ¥å£çš„åˆ—è¡¨ç›¸åŒã€‚ä½†æ˜¯ï¼Œè¿™æ˜æ˜¾å‡è½»äº†è´Ÿæ‹…ï¼Œè¿˜é¿å…é…ç½®é”™è¯¯ã€‚</p><h4 id="3-4-4-ä»£ç†æ¥å£"><a href="#3-4-4-ä»£ç†æ¥å£" class="headerlink" title="3.4.4. ä»£ç†æ¥å£"></a>3.4.4. ä»£ç†æ¥å£</h4><p>é¦–å…ˆçœ‹ä¸€ä¸‹<code>ProxyFactoryBean</code> ç®€å•çš„ä¾‹å­ï¼Œè¿™ä¸ªä¾‹å­åŒ…å«:</p><ul><li>å°†è¢«ä»£ç†çš„ç›®æ ‡beanï¼Œä¸‹é¢ç¤ºä¾‹ä¸­çš„ <code>personTarget</code> beanå®šä¹‰</li><li>ä¸€ä¸ªé€šçŸ¥è€…å’Œä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œç”¨äºæä¾›é€šçŸ¥.</li><li>æŒ‡å®šç›®æ ‡å¯¹è±¡( <code>personTarget</code> bean)çš„AOPä»£ç†beanå’Œè¦ä»£ç†çš„æ¥å£ï¼Œä»¥åŠè¦åº”ç”¨çš„é€šçŸ¥ã€‚</li></ul><p>ä»¥ä¸‹æ¸…å•æ˜¾ç¤ºäº†è¯¥ç¤ºä¾‹:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;personTarget&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.mycompany.PersonImpl&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Tony&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;age&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;51&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;myAdvisor&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.mycompany.MyAdvisor&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;someProperty&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Custom string property value&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;debugInterceptor&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.aop.interceptor.DebugInterceptor&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;person&quot;</span>    <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.aop.framework.ProxyFactoryBean&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;proxyInterfaces&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.mycompany.Person&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;target&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;personTarget&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;interceptorNames&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>myAdvisor<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>debugInterceptor<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æ³¨æ„<code>interceptorNames</code>å±æ€§æ˜¯ä¸€ä¸ª<code>String</code>åˆ—è¡¨ï¼Œæ”¾æ‹¦æˆªå™¨beançš„åå­—æˆ–åœ¨å½“å‰å·¥å‚ä¸­çš„é€šçŸ¥è€…ã€‚é€šçŸ¥è€…ã€æ‹¦æˆªå™¨ã€å‰ç½®ã€åç½®è¿”å›å’Œå¼‚å¸¸é€šçŸ¥çš„å¯¹è±¡å¯ä»¥è¢«ä½¿ç”¨ã€‚é€šçŸ¥è€…æ˜¯æŒ‰é¡ºåºæ’åˆ—ã€‚</p><p>æ‚¨å¯èƒ½æƒ³çŸ¥é“ä¸ºä»€ä¹ˆåˆ—è¡¨ä¸åŒ…å«beanå¼•ç”¨ï¼Ÿç†ç”±æ˜¯å¦‚æœ<code>ProxyFactoryBean</code>çš„å•ä¾‹å±æ€§è¢«è®¾ç½®ä¸º<code>false</code>ï¼Œå®ƒå¿…é¡»èƒ½å¤Ÿè¿”å›ç‹¬ç«‹çš„ä»£ç†å®ä¾‹ã€‚å¦‚æœä»»æ„çš„é€šçŸ¥è€…æœ¬èº«æ˜¯åŸå‹çš„ï¼Œ é‚£ä¹ˆå°±éœ€è¦è¿”å›ä¸€ä¸ªç‹¬ç«‹çš„å®ä¾‹ï¼Œæ‰€ä»¥æœ‰å¿…è¦ä»å·¥å‚è·å¾—åŸå‹å®ä¾‹ã€‚ åªä¿å­˜ä¸€ä¸ªå¼•ç”¨æ˜¯ä¸å¤Ÿçš„ã€‚</p><p>å‰é¢æ˜¾ç¤ºçš„<code>person</code> beanå®šä¹‰å¯ä»¥ç”¨æ¥ä»£æ›¿<code>Person</code>å®ç°ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">Person person <span class="hljs-operator">=</span> (Person) factory.getBean(<span class="hljs-string">&quot;person&quot;</span>)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>ä¸æ™®é€šJavaå¯¹è±¡ä¸€æ ·ï¼ŒåŒä¸€IoCä¸Šä¸‹æ–‡ä¸­çš„å…¶ä»–beanå¯ä»¥è¡¨è¾¾å¯¹å®ƒçš„å¼ºç±»å‹ä¾èµ–ã€‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œ:</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs applescript">&lt;bean <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;personUser&quot;</span> <span class="hljs-built_in">class</span>=<span class="hljs-string">&quot;com.mycompany.PersonUser&quot;</span>&gt;<br><br>    &lt;<span class="hljs-keyword">property</span> <span class="hljs-built_in">name</span>=<span class="hljs-string">&quot;person&quot;</span>&gt;&lt;<span class="hljs-keyword">ref</span> bean=<span class="hljs-string">&quot;person&quot;</span>/&gt;&lt;/<span class="hljs-keyword">property</span>&gt;<br><br>&lt;/bean&gt;<br></code></pre></td></tr></table></figure><p>æ­¤ç¤ºä¾‹ä¸­çš„<code>PersonUser</code>ç±»å°†å…¬å¼€ç±»å‹ä¸º <code>Person</code>çš„å±æ€§ã€‚å°±å®ƒè€Œè¨€ï¼Œå¯ä»¥é€æ˜åœ°ä½¿ç”¨AOPä»£ç†æ¥ä»£æ›¿â€œrealâ€çš„personå®ç°ã€‚ä½†æ˜¯ï¼Œå®ƒçš„ç±»å°†æ˜¯åŠ¨æ€ä»£ç†ç±»ã€‚ å¯ä»¥å°†å…¶è½¬æ¢ä¸º<code>Advised</code>çš„æ¥å£ï¼ˆå¦‚ä¸‹æ‰€è¿°ï¼‰ï¼š</p><p>é€šè¿‡ä½¿ç”¨åŒ¿åå†…éƒ¨beanå¯ä»¥éšè—ç›®æ ‡å’Œä»£ç†ä¹‹å‰çš„åŒºåˆ«ï¼Œåªæœ‰<code>ProxyFactoryBean</code>çš„å®šä¹‰æ˜¯ä¸åŒçš„ï¼ŒåŒ…å«é€šçŸ¥åªæ˜¯è€ƒè™‘åˆ°å®Œæ•´æ€§ã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•ä½¿ç”¨åŒ¿åå†…éƒ¨beanï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;myAdvisor&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.mycompany.MyAdvisor&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;someProperty&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Custom string property value&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;debugInterceptor&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.aop.interceptor.DebugInterceptor&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;person&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.aop.framework.ProxyFactoryBean&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;proxyInterfaces&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.mycompany.Person&quot;</span>/&gt;</span>    <span class="hljs-comment">&lt;!-- Use inner bean, not local reference to target --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;target&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.mycompany.PersonImpl&quot;</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Tony&quot;</span>/&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;age&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;51&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;interceptorNames&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>myAdvisor<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>debugInterceptor<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p>è¿™æ ·åšçš„å¥½å¤„æ˜¯åªæœ‰ä¸€ä¸ª<code>Person</code>ç±»å‹çš„å¯¹è±¡ï¼Œå¦‚æœæƒ³é˜»æ­¢åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡çš„ç”¨æˆ·è·å¾—å¯¹un-advisedå¯¹è±¡çš„å¼•ç”¨ï¼Œæˆ–è€…éœ€è¦é¿å…ä½¿ç”¨Spring IoCè‡ªåŠ¨è£…é…çš„ä»»ä½•å«ç³Šä¸æ¸…çš„æƒ…å†µï¼Œ é‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°±å¾ˆæœ‰ç”¨ã€‚<code>ProxyFactoryBean</code>å®šä¹‰æ˜¯è‡ªåŒ…å«çš„ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªå¥½å¤„ã€‚ä½†æ˜¯ï¼Œæœ‰æ—¶èƒ½å¤Ÿä»å·¥å‚è·å¾—un-advisedç›®æ ‡å¯èƒ½æ˜¯ä¸€ä¸ªä¼˜åŠ¿ï¼ˆä¾‹å¦‚ï¼Œåœ¨æŸäº›æµ‹è¯•åœºæ™¯ä¸­ï¼‰ã€‚ã€‚</p><h4 id="3-4-5-ä»£ç†ç±»"><a href="#3-4-5-ä»£ç†ç±»" class="headerlink" title="3.4.5. ä»£ç†ç±»"></a>3.4.5. ä»£ç†ç±»</h4><p>å¦‚æœéœ€è¦ä»£ç†ä¸€ä¸ªç±»è€Œä¸æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªæ¥å£ï¼Œåˆè¯¥æ€ä¹ˆåŠ?</p><p>è€ƒè™‘ä¸Šé¢çš„ä¾‹å­ï¼Œæ²¡æœ‰<code>Person</code>æ¥å£ï¼Œéœ€è¦ç»™ä¸€ä¸ªæ²¡æœ‰å®ç°ä»»ä½•ä¸šåŠ¡æ¥å£çš„<code>Person</code>ç±»æä¾›é€šçŸ¥ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥å°†Springé…ç½®ä¸ºä½¿ç”¨CGLIBä»£ç†è€Œä¸æ˜¯åŠ¨æ€ä»£ç†ã€‚ ç®€å•è®¾ç½®<code>ProxyFactoryBean</code>çš„<code>proxyTargetClass</code>å±æ€§ä¸º<code>true</code>ã€‚å°½ç®¡æœ€ä½³å®è·µæ˜¯é¢å‘æ¥å£ç¼–ç¨‹ï¼Œä¸æ˜¯ç±»ã€‚ä½†åœ¨å¤„ç†é—ç•™ä»£ç æ—¶ï¼Œ é€šçŸ¥ä¸å®ç°æ¥å£çš„ç±»çš„èƒ½åŠ›å¯èƒ½ä¼šéå¸¸æœ‰ç”¨ï¼ˆä¸€èˆ¬æ¥è¯´ï¼ŒSpringä¸æ˜¯è§„å®šæ€§çš„ã€‚è™½ç„¶å®ƒå¯ä»¥å¾ˆå®¹æ˜“åœ°åº”ç”¨å¥½çš„å®è·µï¼Œä½†å®ƒé¿å…å¼ºåˆ¶ä½¿ç”¨ç‰¹å®šçš„æ–¹æ³•ï¼‰ã€‚</p><p>å¦‚æœä½ æ„¿æ„ï¼Œå³ä½¿æœ‰æ¥å£ï¼Œä¹Ÿå¯ä»¥å¼ºåˆ¶ä½¿ç”¨CGLIBä»£ç†ã€‚</p><p>CGLIBä»£ç†çš„åŸç†æ˜¯åœ¨è¿è¡Œæ—¶ç”Ÿæˆç›®æ ‡ç±»çš„å­ç±»ã€‚Springé…ç½®è¿™ä¸ªç”Ÿæˆçš„å­ç±»ç”¨äº†å§”æ‰˜çš„æ–¹æ³•æ¥è°ƒç”¨åŸå§‹çš„å¯¹è±¡ï¼Œåœ¨é€šçŸ¥çš„ç¼–ç»‡ä¸­ï¼Œå­ç±»è¢«ç”¨äºå®ç°è£…é¥°è€…æ¨¡å¼ã€‚</p><p>CGLIBä»£ç†é€šå¸¸å¯¹äºç”¨æˆ·åº”å½“æ˜¯é€æ˜çš„ï¼Œç„¶è€Œè¿˜æœ‰éœ€è€ƒè™‘ä¸€äº›é—®é¢˜ï¼š</p><ul><li><code>Final</code>æ–¹æ³•ä¸èƒ½è¢«advisedï¼Œå› ä¸ºå®ƒä»¬ä¸èƒ½è¢«è¦†ç›–ã€‚</li><li>æ— éœ€æ·»åŠ CGLIBåˆ°é¡¹ç›®çš„ç±»è·¯å¾„ä¸­ï¼Œä»Spring 3.2å¼€å§‹ï¼ŒCGLIBè¢«é‡æ–°æ‰“åŒ…å¹¶åŒ…å«åœ¨spring-core JARä¸­ã€‚æ¢å¥è¯è¯´ï¼ŒåŸºäºCGLIBçš„AOPâ€œå¼€ç®±å³ç”¨â€ï¼ŒJDKåŠ¨æ€ä»£ç†ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</li></ul><p>CGLIBä»£ç†å’ŒåŠ¨æ€ä»£ç†ä¹‹é—´å‡ ä¹æ²¡æœ‰æ€§èƒ½å·®å¼‚ã€‚ ä»Spring 1.0å¼€å§‹ï¼ŒåŠ¨æ€ä»£ç†ç•¥å¿«ä¸€äº›ã€‚ ä½†æ˜¯ï¼Œè¿™å¯èƒ½ä¼šåœ¨æœªæ¥å‘ç”Ÿå˜åŒ–ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ€§èƒ½ä¸åº”è¯¥æ˜¯å†³å®šæ€§çš„è€ƒè™‘å› ç´ ã€‚</p><h4 id="3-4-6-ä½¿ç”¨å…¨å±€çš„é€šçŸ¥è€…"><a href="#3-4-6-ä½¿ç”¨å…¨å±€çš„é€šçŸ¥è€…" class="headerlink" title="3.4.6. ä½¿ç”¨å…¨å±€çš„é€šçŸ¥è€…"></a>3.4.6. ä½¿ç”¨å…¨å±€çš„é€šçŸ¥è€…</h4><p>é€šè¿‡å°†æ˜Ÿå·è¿½åŠ åˆ°æ‹¦æˆªå™¨åç§°ä¸Šï¼Œæ‰€æœ‰ä¸æ˜Ÿå·å‰é¢éƒ¨åˆ†åŒ¹é…çš„beanåç§°çš„é€šçŸ¥è€…éƒ½å°†æ·»åŠ åˆ°é€šçŸ¥è€…é“¾ä¸­ã€‚å¦‚æœéœ€è¦æ·»åŠ ä¸€ç»„æ ‡å‡†çš„å…¨å±€ï¼ˆ â€œglobalâ€ï¼‰é€šçŸ¥è€…ï¼Œè¿™å¯èƒ½ä¼šæ´¾ä¸Šç”¨åœºã€‚ä»¥ä¸‹ç¤ºä¾‹å®šä¹‰äº†ä¸¤ä¸ªå…¨å±€çš„é€šçŸ¥è€…ç¨‹åºï¼š</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript">&lt;bean <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;proxy&quot;</span> <span class="hljs-built_in">class</span>=<span class="hljs-string">&quot;org.springframework.aop.framework.ProxyFactoryBean&quot;</span>&gt;    &lt;<span class="hljs-keyword">property</span> <span class="hljs-built_in">name</span>=<span class="hljs-string">&quot;target&quot;</span> <span class="hljs-keyword">ref</span>=<span class="hljs-string">&quot;service&quot;</span>/&gt;    &lt;<span class="hljs-keyword">property</span> <span class="hljs-built_in">name</span>=<span class="hljs-string">&quot;interceptorNames&quot;</span>&gt;        &lt;<span class="hljs-built_in">list</span>&gt;            &lt;value&gt;<span class="hljs-keyword">global</span>*&lt;/value&gt;        &lt;/<span class="hljs-built_in">list</span>&gt;    &lt;/<span class="hljs-keyword">property</span>&gt;&lt;/bean&gt;<br>&lt;bean <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;global_debug&quot;</span> <span class="hljs-built_in">class</span>=<span class="hljs-string">&quot;org.springframework.aop.interceptor.DebugInterceptor&quot;</span>/&gt;&lt;bean <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;global_performance&quot;</span> <span class="hljs-built_in">class</span>=<span class="hljs-string">&quot;org.springframework.aop.interceptor.PerformanceMonitorInterceptor&quot;</span>/&gt;<br></code></pre></td></tr></table></figure><h3 id="3-5-ç®€æ˜çš„ä»£ç†å®šä¹‰"><a href="#3-5-ç®€æ˜çš„ä»£ç†å®šä¹‰" class="headerlink" title="3.5. ç®€æ˜çš„ä»£ç†å®šä¹‰"></a>3.5. ç®€æ˜çš„ä»£ç†å®šä¹‰</h3><p>ç‰¹åˆ«æ˜¯åœ¨å®šä¹‰äº‹åŠ¡ä»£ç†æ—¶ï¼Œæœ€ç»ˆå¯èƒ½ä¼šå®šä¹‰äº†è®¸å¤šç±»ä¼¼çš„ä»£ç†ã€‚ä½¿ç”¨çˆ¶çº§å’Œå­çº§beanå®šä¹‰ä»¥åŠå†…éƒ¨beanå®šä¹‰å¯ä»¥ä½¿ä»£ç†å®šä¹‰å˜å¾—æ›´ç®€æ´å’Œæ›´ç®€æ˜ã€‚</p><p>é¦–å…ˆä¸ºä»£ç†åˆ›å»ºä¸€ä¸ªçˆ¶çº§çš„ã€æ¨¡æ¿çš„beanå®šä¹‰:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;txProxyTemplate&quot;</span> <span class="hljs-attr">abstract</span>=<span class="hljs-string">&quot;true&quot;</span></span><br><span class="hljs-tag"></span><br><span class="hljs-tag">        <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.transaction.interceptor.TransactionProxyFactoryBean&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;transactionManager&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;transactionManager&quot;</span>/&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;transactionAttributes&quot;</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">props</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">prop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;*&quot;</span>&gt;</span>PROPAGATION_REQUIRED<span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">props</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å®ƒæœ¬èº«æ˜¯æ°¸è¿œä¸ä¼šè¢«å®ä¾‹åŒ–çš„ï¼Œå› æ­¤å®ƒå®é™…ä¸Šå¯èƒ½æ˜¯ä¸å®Œæ•´çš„ã€‚ç„¶åï¼Œæ¯ä¸ªéœ€è¦åˆ›å»ºçš„ä»£ç†éƒ½æ˜¯åªæ˜¯ä¸€ä¸ªå­çº§çš„beanå®šä¹‰ï¼Œå®ƒå°†ä»£ç†çš„ç›®æ ‡åŒ…è£…ä¸ºå†…éƒ¨beanå®šä¹‰ï¼Œå› ä¸ºç›®æ ‡æ°¸è¿œä¸ä¼šå•ç‹¬ä½¿ç”¨ã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†è¿™æ ·çš„å­bean:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;myService&quot;</span> <span class="hljs-attr">parent</span>=<span class="hljs-string">&quot;txProxyTemplate&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;target&quot;</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.samples.MyServiceImpl&quot;</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æ‚¨å¯ä»¥è¦†ç›–çˆ¶æ¨¡æ¿ä¸­çš„å±æ€§ã€‚ åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œäº‹åŠ¡ä¼ æ’­è®¾ç½®å¦‚ä¸‹:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;mySpecialService&quot;</span> <span class="hljs-attr">parent</span>=<span class="hljs-string">&quot;txProxyTemplate&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;target&quot;</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.samples.MySpecialServiceImpl&quot;</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;transactionAttributes&quot;</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">props</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">prop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;get*&quot;</span>&gt;</span>PROPAGATION_REQUIRED,readOnly<span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">prop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;find*&quot;</span>&gt;</span>PROPAGATION_REQUIRED,readOnly<span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">prop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;load*&quot;</span>&gt;</span>PROPAGATION_REQUIRED,readOnly<span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">prop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;store*&quot;</span>&gt;</span>PROPAGATION_REQUIRED<span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">props</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œé€šè¿‡ä½¿ç”¨<code>abstract</code>å±æ€§æ˜¾å¼åœ°å°†çˆ¶çº§çš„beanå®šä¹‰æ ‡è®°ä¸ºæŠ½è±¡çš„ï¼ˆ<code>abstract</code>ï¼‰ï¼Œ<a href="https://sca.aliyun.com/learn/spring/core/aop-api/?spm=0.29160081.0.0.51f92e5dCHrGI4#beans-child-bean-definitions">å¦‚å‰æ‰€è¿°</a>ï¼Œè¿™æ ·å®ƒå°±ä¸ä¼šè¢«å®ä¾‹åŒ–ã€‚åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ï¼ˆä½†ä¸æ˜¯ç®€å•çš„beanå·¥å‚ï¼‰å°†é»˜è®¤æå‰å®ä¾‹åŒ–æ‰€æœ‰çš„å•ä¾‹ã€‚ å› æ­¤ï¼Œé‡è¦çš„æ˜¯ï¼ˆè‡³å°‘å¯¹äºå•ä¾‹beanï¼‰ï¼Œå¦‚æœæœ‰ä¸€ä¸ªï¼ˆçˆ¶çº§ï¼‰beanå®šä¹‰ï¼Œåªæ‰“ç®—å°†å®ƒç”¨ä½œæ¨¡æ¿ï¼Œè€Œè¿™ä¸ªå®šä¹‰æŒ‡å®šä¸€ä¸ªç±»ï¼Œå¿…é¡»ç¡®ä¿å°†æŠ½è±¡ï¼ˆ<code>abstract</code>ï¼‰å±æ€§è®¾ç½®ä¸º<code>true</code>ï¼Œ å¦åˆ™åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡å°†å®é™…å°è¯•æå‰å®ä¾‹åŒ–å®ƒã€‚</p><h3 id="3-6-ä½¿ç”¨ProxyFactoryç¼–ç¨‹åˆ›å»ºAOPä»£ç†"><a href="#3-6-ä½¿ç”¨ProxyFactoryç¼–ç¨‹åˆ›å»ºAOPä»£ç†" class="headerlink" title="3.6. ä½¿ç”¨ProxyFactoryç¼–ç¨‹åˆ›å»ºAOPä»£ç†"></a>3.6. ä½¿ç”¨<code>ProxyFactory</code>ç¼–ç¨‹åˆ›å»ºAOPä»£ç†</h3><p>ä½¿ç”¨Springä»¥ç¼–ç¨‹çš„æ–¹å¼åˆ›å»ºAOPä»£ç†æ˜¯å¾ˆå®¹æ˜“çš„ã€‚è¿™æ ·å…è®¸åœ¨ä¸ä¾èµ–äºSpring IoCçš„æƒ…å†µä¸‹ä½¿ç”¨Spring AOPã€‚</p><p>ç›®æ ‡å¯¹è±¡å®ç°çš„æ¥å£å°†è‡ªåŠ¨ä»£ç†ã€‚ä¸‹é¢çš„ä»£ç æ˜¾ç¤ºäº†ä½¿ç”¨ä¸€ä¸ªæ‹¦æˆªå™¨å’Œä¸€ä¸ªé€šçŸ¥è€…åˆ›å»ºç›®æ ‡å¯¹è±¡çš„ä»£ç†çš„è¿‡ç¨‹ï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs abnf">ProxyFactory factory <span class="hljs-operator">=</span> new ProxyFactory(myBusinessInterfaceImpl)<span class="hljs-comment">;</span><br><br>factory.addAdvice(myMethodInterceptor)<span class="hljs-comment">;</span><br><br>factory.addAdvisor(myAdvisor)<span class="hljs-comment">;</span><br><br>MyBusinessInterface tb <span class="hljs-operator">=</span> (MyBusinessInterface) factory.getProxy()<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>ç¬¬ä¸€æ­¥æ˜¯æ„å»ºä¸€ä¸ªç±»å‹ä¸º<code>org.springframework.aop.framework.ProxyFactory</code>çš„å¯¹è±¡ã€‚å¯ä»¥ä½¿ç”¨ç›®æ ‡å¯¹è±¡åˆ›å»ºæ­¤å¯¹è±¡ã€‚ å¦‚å‰é¢çš„ç¤ºä¾‹æ‰€ç¤ºï¼Œæˆ–è€…åœ¨æŒ‡å®šçš„æ¥å£ä¸­è¿›è¡Œä»£ç†è€Œä¸æ˜¯æ„é€ å™¨ã€‚</p><p>å¼€å‘è€…å¯ä»¥æ·»åŠ é€šçŸ¥ï¼ˆä½¿ç”¨æ‹¦æˆªå™¨ä½œä¸ºä¸€ç§ä¸“ç”¨çš„é€šçŸ¥ï¼‰å’Œ&#x2F;æˆ–é€šçŸ¥è€…ï¼Œå¹¶åœ¨<code>ProxyFactory</code>çš„ç”Ÿå‘½å‘¨æœŸä¸­è¿›è¡Œæ“ä½œã€‚å¦‚æœæ·»åŠ <code>IntroductionInterceptionAroundAdvisor</code>ï¼Œåˆ™å¯ä»¥ä½¿ä»£ç†å®ç°å…¶ä»–æ¥å£ã€‚</p><p><code>ProxyFactory</code>ä¸Šè¿˜æœ‰ä¸€äº›ä¾¿æ·çš„æ–¹æ³•ï¼ˆä»<code>AdvisedSupport</code>ç±»ç»§æ‰¿çš„ï¼‰ï¼Œå…è®¸å¼€å‘è€…æ·»åŠ å…¶ä»–é€šçŸ¥ç±»å‹ï¼Œä¾‹å¦‚å‰ç½®å’Œå¼‚å¸¸é€šçŸ¥ã€‚<code>AdvisedSupport</code>æ˜¯<code>ProxyFactory</code>å’Œ<code>ProxyFactoryBean</code>çš„è¶…ç±»</p><p>å°†AOPä»£ç†åˆ›å»ºä¸IoCæ¡†æ¶é›†æˆæ˜¯å¤šæ•°åº”ç”¨ç¨‹åºçš„æœ€ä½³å®è·µï¼Œå› æ­¤å¼ºçƒˆå»ºè®®ä»Javaä»£ç ä¸­å¤–éƒ¨é…ç½®ä½¿ç”¨AOPã€‚</p><h3 id="3-7-å¤„ç†è¢«é€šçŸ¥å¯¹è±¡"><a href="#3-7-å¤„ç†è¢«é€šçŸ¥å¯¹è±¡" class="headerlink" title="3.7.å¤„ç†è¢«é€šçŸ¥å¯¹è±¡"></a>3.7.å¤„ç†è¢«é€šçŸ¥å¯¹è±¡</h3><p><code>org.springframework.aop.framework.Advised</code>æ¥å£å¯¹å®ƒä»¬è¿›è¡Œæ“ä½œã€‚ä»»ä½•AOPä»£ç†éƒ½å¯ä»¥è½¬æ¢åˆ°è¿™ä¸ªæ¥å£ï¼Œæ— è®ºå®ƒå®ç°äº†å“ªä¸ªæ¥å£ã€‚æ­¤æ¥å£åŒ…æ‹¬ä»¥ä¸‹æ–¹æ³•ï¼š</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs aspectj">Advisor[] getAdvisors();<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">addAdvice</span><span class="hljs-params">(Advice advice)</span> <span class="hljs-keyword">throws</span> AopConfigException</span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">addAdvice</span><span class="hljs-params">(<span class="hljs-keyword">int</span> pos, Advice advice)</span> <span class="hljs-keyword">throws</span> AopConfigException</span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">addAdvisor</span><span class="hljs-params">(Advisor advisor)</span> <span class="hljs-keyword">throws</span> AopConfigException</span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">addAdvisor</span><span class="hljs-params">(<span class="hljs-keyword">int</span> pos, Advisor advisor)</span> <span class="hljs-keyword">throws</span> AopConfigException</span>;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">indexOf</span><span class="hljs-params">(Advisor advisor)</span></span>;<br><span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">removeAdvisor</span><span class="hljs-params">(Advisor advisor)</span> <span class="hljs-keyword">throws</span> AopConfigException</span>;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">removeAdvisor</span><span class="hljs-params">(<span class="hljs-keyword">int</span> index)</span> <span class="hljs-keyword">throws</span> AopConfigException</span>;<br><span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">replaceAdvisor</span><span class="hljs-params">(Advisor a, Advisor b)</span> <span class="hljs-keyword">throws</span> AopConfigException</span>;<br><span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isFrozen</span><span class="hljs-params">()</span></span>;<br></code></pre></td></tr></table></figure><p><code>getAdvisors()</code> æ–¹æ³•å°†è¿”å›å·²æ·»åŠ åˆ°å·¥å‚ä¸­çš„æ¯ä¸ª<code>Advisor</code>ã€æ‹¦æˆªå™¨æˆ–å…¶ä»–é€šçŸ¥ç±»å‹çš„é€šçŸ¥è€…ã€‚å¦‚æœæ·»åŠ äº†<code>Advisor</code>ï¼Œé‚£ä¹ˆè¿™ä¸ªç´¢å¼•ä¸­çš„è¿”å›çš„é€šçŸ¥è€…å°†æ˜¯æ·»åŠ çš„å¯¹è±¡ã€‚ å¦‚æœæ·»åŠ äº†æ‹¦æˆªå™¨æˆ–å…¶ä»–é€šçŸ¥ç±»å‹ï¼Œé‚£ä¹ˆSpringå°†åœ¨é€šçŸ¥è€…ä¸­å°†ä¸€ä¸ªæ€»æ˜¯è¿”å›<code>true</code>çš„åˆ‡ç‚¹å°è£…ã€‚å› æ­¤ï¼Œå¦‚æœæ·»åŠ äº† <code>MethodInterceptor</code>ï¼Œåˆ™è¿”å›çš„é€šçŸ¥è€…å°†æ˜¯ <code>DefaultPointcutAdvisor</code>è¿”å›æ¥çš„<code>MethodInterceptor</code>å’Œä¸æ‰€æœ‰ç±»å’Œæ–¹æ³•åŒ¹é…çš„åˆ‡ç‚¹ã€‚</p><p><code>addAdvisor()</code>æ–¹æ³•å¯ç”¨äºæ·»åŠ ä»»æ„çš„<code>Advisor</code>ã€‚é€šå¸¸ï¼ŒæŒæœ‰åˆ‡ç‚¹å’Œé€šçŸ¥çš„é€šçŸ¥è€…æ˜¯é€šç”¨çš„<code>DefaultPointcutAdvisor</code>ç±»ï¼Œå®ƒå¯ä»¥ç”¨äºä»»æ„é€šçŸ¥æˆ–åˆ‡ç‚¹ï¼ˆä½†ä¸èƒ½ç”¨äºå¼•å…¥ï¼‰ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ å³ä½¿å·²ç»åˆ›å»ºäº†ä»£ç†ï¼Œä¹Ÿå¯ä»¥æ·»åŠ æˆ–åˆ é™¤é€šçŸ¥è€…æˆ–æ‹¦æˆªå™¨ã€‚å”¯ä¸€çš„é™åˆ¶æ˜¯æ— æ³•æ·»åŠ æˆ–åˆ é™¤å¼•å…¥é€šçŸ¥è€…ï¼Œå› ä¸ºæ¥è‡ªå·¥å‚çš„ç°æœ‰ä»£ç†å°†ä¸ä¼šå±•ç¤ºæ¥å£çš„å˜åŒ–ã€‚ (å¼€å‘è€…å¯ä»¥ä»å·¥å‚è·å–æ–°çš„ä»£ç†ï¼Œä»¥é¿å…è¿™ç§é—®é¢˜ï¼‰ã€‚</p><p>å°†AOPä»£ç†è½¬æ¢ä¸ºé€šçŸ¥æ¥å£å¹¶æ£€æŸ¥å’Œæ“ä½œå…¶é€šçŸ¥çš„ç®€å•ç¤ºä¾‹ :</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">Advised advised = (Advised) myObject;Advisor[] advisors = advised.getAdvisors();<span class="hljs-type">int</span> oldAdvisorCount = advisors.length;<span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(oldAdvisorCount + &quot; advisors&quot;);<br>// <span class="hljs-keyword">Add</span> an advice <span class="hljs-keyword">like</span> an interceptor <span class="hljs-keyword">without</span> a pointcut// Will match <span class="hljs-keyword">all</span> proxied methods// Can use <span class="hljs-keyword">for</span> interceptors, <span class="hljs-keyword">before</span>, <span class="hljs-keyword">after</span> <span class="hljs-keyword">returning</span> <span class="hljs-keyword">or</span> throws adviceadvised.addAdvice(<span class="hljs-built_in">new</span> DebugInterceptor());<br>// <span class="hljs-keyword">Add</span> selective advice <span class="hljs-keyword">using</span> a pointcutadvised.addAdvisor(<span class="hljs-built_in">new</span> DefaultPointcutAdvisor(mySpecialPointcut, myAdvice));<br>assertEquals(&quot;Added two advisors&quot;, oldAdvisorCount + <span class="hljs-number">2</span>, advised.getAdvisors().length);<br></code></pre></td></tr></table></figure><p>åœ¨ç”Ÿäº§ä¸­ä¿®æ”¹ä¸šåŠ¡å¯¹è±¡çš„é€šçŸ¥æ˜¯å¦å¯å–(æ²¡æœ‰åŒå…³è¯­ï¼‰æ˜¯å€¼å¾—æ€€ç–‘çš„ï¼Œå°½ç®¡å®ƒæ˜¯åˆæ³•çš„ä½¿ç”¨æ¡ˆä¾‹ã€‚ä½†æ˜¯ï¼Œå®ƒå¯èƒ½åœ¨å¼€å‘ä¸­éå¸¸æœ‰ç”¨ï¼ˆä¾‹å¦‚ï¼Œåœ¨æµ‹è¯•ä¸­ï¼‰ã€‚æœ‰æ—¶å‘ç°èƒ½å¤Ÿä»¥æ‹¦æˆªå™¨æˆ–å…¶ä»–é€šçŸ¥çš„å½¢å¼æ·»åŠ æµ‹è¯•ä»£ç ä¹Ÿéå¸¸æœ‰ç”¨ï¼Œ å¯ä»¥åœ¨éœ€è¦æµ‹è¯•çš„æ–¹æ³•è°ƒç”¨ä¸­è·å–ã€‚ï¼ˆä¾‹å¦‚ï¼Œé€šçŸ¥å¯ä»¥è¿›å…¥ä¸ºè¯¥æ–¹æ³•åˆ›å»ºçš„äº‹åŠ¡ä¸­ï¼›ä¾‹å¦‚ï¼Œåœ¨æ ‡è®°è¦å›æ»šçš„äº‹åŠ¡ä¹‹å‰è¿è¡Œsqlä»¥æ£€æŸ¥æ•°æ®åº“æ˜¯å¦å·²æ­£ç¡®æ›´æ–°ï¼‰ã€‚</p><p>æ ¹æ®æ‚¨åˆ›å»ºä»£ç†çš„æ–¹å¼ï¼Œé€šå¸¸å¯ä»¥è®¾ç½®<code>frozen</code> æ ‡å¿—ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé€šçŸ¥çš„ <code>isFrozen()</code> æ–¹æ³•å°†è¿”å›<code>true</code>ï¼Œä»»ä½•é€šè¿‡æ·»åŠ æˆ–åˆ é™¤ä¿®æ”¹é€šçŸ¥çš„å°è¯•éƒ½å°†å¯¼è‡´<code>AopConfigException</code>å¼‚å¸¸ã€‚ åœ¨æŸäº›æƒ…å†µä¸‹å†»ç»“é€šçŸ¥çš„å¯¹è±¡çŠ¶æ€çš„åŠŸèƒ½å¾ˆæœ‰ç”¨ï¼ˆä¾‹å¦‚ï¼Œé˜²æ­¢è°ƒç”¨ä»£ç åˆ é™¤å®‰å…¨æ‹¦æˆªå™¨ï¼‰ã€‚å¦‚æœå·²çŸ¥çš„è¿è¡Œæ—¶é€šçŸ¥ä¸éœ€è¦ä¿®æ”¹çš„è¯ï¼Œå®ƒä¹Ÿå¯ä»¥åœ¨Spring 1.1ä¸­ä½¿ç”¨ä»¥è·å¾—æœ€å¥½çš„ä¼˜åŒ–ã€‚</p><h3 id="3-8-ä½¿ç”¨è‡ªåŠ¨ä»£ç†åŠŸèƒ½"><a href="#3-8-ä½¿ç”¨è‡ªåŠ¨ä»£ç†åŠŸèƒ½" class="headerlink" title="3.8. ä½¿ç”¨è‡ªåŠ¨ä»£ç†åŠŸèƒ½"></a>3.8. ä½¿ç”¨è‡ªåŠ¨ä»£ç†åŠŸèƒ½</h3><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä¸Šé¢çš„ç« èŠ‚å·²ç»ä»‹ç»äº†ä½¿ç”¨<code>ProxyFactoryBean</code>æˆ–ç±»ä¼¼çš„å·¥å‚beanæ˜¾å¼åœ°åˆ›å»ºAOPä»£ç†ã€‚</p><p>Springè¿˜æ”¯æŒä½¿ç”¨ â€œauto-proxyâ€ï¼ˆè‡ªåŠ¨ä»£ç†ï¼‰ çš„beanå®šä¹‰, å…è®¸è‡ªåŠ¨ä»£ç†é€‰æ‹©beanå®šä¹‰.è¿™æ˜¯å»ºç«‹åœ¨Springçš„â€™s â€œbean post processorâ€åŸºç¡€ä¸Šçš„ï¼Œå®ƒå…è®¸ä¿®æ”¹ä»»ä½•beanå®šä¹‰ä½œä¸ºå®¹å™¨åŠ è½½ã€‚</p><p>åœ¨è¿™ä¸ªæ¨¡å¼ä¸‹ï¼Œå¯ä»¥åœ¨XML beanå®šä¹‰æ–‡ä»¶ä¸­è®¾ç½®ä¸€äº›ç‰¹æ®Šçš„beanå®šä¹‰ï¼Œç”¨æ¥é…ç½®åŸºç¡€çš„è‡ªåŠ¨ä»£ç†ã€‚è¿™å…è®¸å¼€å‘è€…åªéœ€å£°æ˜ç¬¦åˆè‡ªåŠ¨ä»£ç†çš„ç›®æ ‡å³å¯ï¼Œå¼€å‘è€…æ— éœ€ä½¿ç”¨<code>ProxyFactoryBean</code>ã€‚</p><p>æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼š:</p><ul><li>ä½¿ç”¨åœ¨å½“å‰ä¸Šä¸‹æ–‡ä¸­å¼•ç”¨ç‰¹å®šbeançš„è‡ªåŠ¨ä»£ç†åˆ›å»ºå™¨</li><li>è‡ªåŠ¨ä»£ç†åˆ›å»ºçš„ä¸€ä¸ªç‰¹ä¾‹å€¼å¾—å•ç‹¬è€ƒè™‘ï¼šç”±æºä»£ç çº§åˆ«çš„å…ƒæ•°æ®å±æ€§é©±åŠ¨çš„è‡ªåŠ¨ä»£ç†åˆ›å»ºã€‚</li></ul><h4 id="3-8-1-è‡ªåŠ¨ä»£ç†beançš„å®šä¹‰"><a href="#3-8-1-è‡ªåŠ¨ä»£ç†beançš„å®šä¹‰" class="headerlink" title="3.8.1. è‡ªåŠ¨ä»£ç†beançš„å®šä¹‰"></a>3.8.1. è‡ªåŠ¨ä»£ç†beançš„å®šä¹‰</h4><p>æœ¬èŠ‚ä»‹ç»<code>org.springframework.aop.framework.autoproxy</code> åŒ…æä¾›çš„è‡ªåŠ¨ä»£ç†åˆ›å»ºå™¨ã€‚</p><h5 id="BeanNameAutoProxyCreator"><a href="#BeanNameAutoProxyCreator" class="headerlink" title="BeanNameAutoProxyCreator"></a><code>BeanNameAutoProxyCreator</code></h5><p><code>BeanNameAutoProxyCreator</code>ç±»æ˜¯ä¸€ä¸ª<code>BeanPostProcessor</code>çš„å®ç°ï¼Œå®ƒä¼šè‡ªåŠ¨ä¸ºå…·æœ‰åŒ¹é…æ–‡æœ¬å€¼æˆ–é€šé…ç¬¦çš„åç§°çš„beanåˆ›å»ºAOPä»£ç†ã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•åˆ›å»º<code>BeanNameAutoProxyCreator</code> beanï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.aop.framework.autoproxy.BeanNameAutoProxyCreator&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;beanNames&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;jdk*,onlyJdk&quot;</span>/&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;interceptorNames&quot;</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>myInterceptor<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä¸<code>ProxyFactoryBean</code>ä¸€æ ·ï¼Œå®ƒæ‹¥æœ‰<code>interceptorNames</code>å±æ€§è€Œä¸æ˜¯æŒæœ‰æ‹¦æˆªå™¨åˆ—è¡¨ï¼Œä»¥ä¾¿ä¸ºåŸå‹é€šçŸ¥è€…æä¾›æ­£ç¡®çš„è¡Œä¸ºã€‚é€šçŸ¥è€…å’Œä»»æ„çš„é€šçŸ¥ç±»å‹éƒ½å¯å‘½åä¸ºâ€œinterceptorsâ€ã€‚</p><p>ä¸æ™®é€šçš„è‡ªåŠ¨ä»£ç†ä¸€æ ·ï¼Œä½¿ç”¨<code>BeanNameAutoProxyCreator</code>çš„ä¸»è¦ç›®çš„æ˜¯èƒ½å°†ç›¸åŒçš„é…ç½®åŒæ—¶æˆ–å…±äº«åœ°åº”ç”¨äºå¤šä¸ªå¯¹è±¡ï¼Œæ­¤æ—¶é…ç½®æ˜¯æœ€å°‘çš„ã€‚ å°†å£°æ˜æ€§äº‹åŠ¡åº”ç”¨äºå¤šä¸ªå¯¹è±¡æ˜¯å¾ˆæ™®éçš„ä¾‹å­ã€‚</p><p>åœ¨ä¸Šä¾‹ä¸­ï¼Œåç§°åŒ¹é…çš„Beanå®šä¹‰ï¼ˆä¾‹å¦‚<code>jdkMyBean</code> å’Œ <code>onlyJdk</code>ï¼‰æ˜¯å¸¦æœ‰ç›®æ ‡ç±»çš„ã€æ™®é€šçš„ã€è€å¼çš„beanå®šä¹‰ã€‚ AOPä»£ç†ç”±<code>BeanNameAutoProxyCreator</code>è‡ªåŠ¨åˆ›å»ºã€‚ç›¸åŒçš„é€šçŸ¥ä¹Ÿé€‚ç”¨äºæ‰€æœ‰åŒ¹é…åˆ°çš„beanã€‚æ³¨æ„ï¼Œå¦‚æœä½¿ç”¨é€šçŸ¥ç€ï¼ˆè€Œä¸æ˜¯ä¸Šè¿°ç¤ºä¾‹ä¸­çš„æ‹¦æˆªå™¨ï¼‰ï¼Œé‚£ä¹ˆåˆ‡ç‚¹å¯èƒ½éšbeançš„ä¸åŒç”¨å¤„è€Œå˜åŒ–ã€‚</p><h5 id="DefaultAdvisorAutoProxyCreator"><a href="#DefaultAdvisorAutoProxyCreator" class="headerlink" title="DefaultAdvisorAutoProxyCreator"></a><code>DefaultAdvisorAutoProxyCreator</code></h5><p><code>DefaultAdvisorAutoProxyCreator</code>æ˜¯å¦ä¸€ä¸ªæ›´é€šç”¨ã€åŠŸèƒ½æ›´å¼ºå¤§çš„è‡ªåŠ¨ä»£ç†åˆ›å»ºå™¨ã€‚å®ƒä¼šåœ¨å½“å‰çš„ä¸Šä¸‹æ–‡ä¸­è‡ªåŠ¨ç”¨äºç¬¦åˆæ¡ä»¶çš„é€šçŸ¥è€…ï¼Œè€Œæ— éœ€åœ¨è‡ªåŠ¨ä»£ç†é€šçŸ¥è€…çš„beanå®šä¹‰ä¸­åŒ…å«ç‰¹å®šçš„beanåç§°ã€‚ å®ƒå…·æœ‰<code>BeanNameAutoProxyCreator</code>ç›¸åŒçš„é…ç½®ï¼Œä»¥åŠé¿å…é‡å¤å®šä¹‰çš„æœ‰ç‚¹ã€‚.</p><p>ä½¿ç”¨æ­¤æœºåˆ¶æ¶‰åŠ:</p><ul><li>æŒ‡å®š<code>DefaultAdvisorAutoProxyCreator</code> beanå®šä¹‰</li><li>åœ¨ç›¸åŒæˆ–ç›¸å…³ä¸Šä¸‹æ–‡ä¸­æŒ‡å®šä»»æ„æ•°é‡çš„é€šçŸ¥è€…ã€‚æ³¨æ„ï¼Œè¿™é‡Œå¿…é¡»æ˜¯é€šçŸ¥è€…ï¼Œè€Œä¸æ˜¯æ‹¦æˆªå™¨æˆ–å…¶ä»–é€šçŸ¥ç±»å‹ã€‚è¿™ç§çº¦æŸæ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºå¿…é¡»å¼•å…¥å¯¹åˆ‡ç‚¹çš„è¯„ä¼°ï¼Œ ä»¥æ£€æŸ¥æ¯ä¸ªé€šçŸ¥æ˜¯å¦ç¬¦åˆå€™é€‰beanå®šä¹‰çš„è¦æ±‚ã€‚</li></ul><p><code>DefaultAdvisorAutoProxyCreator</code>å°†è‡ªåŠ¨è¯„ä¼°åŒ…å«åœ¨æ¯ä¸ªé€šçŸ¥è€…ä¸­çš„åˆ‡ç‚¹ï¼Œä»¥æŸ¥çœ‹å®ƒæ˜¯å¦é€‚ç”¨äºæ¯ä¸ªä¸šåŠ¡å¯¹è±¡ï¼ˆå¦‚ç¤ºä¾‹ä¸­çš„<code>businessObject1</code> å’Œ <code>businessObject2</code> ï¼‰çš„é€šçŸ¥ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚</p><p>è¿™æ„å‘³ç€å¯ä»¥å°†ä»»æ„æ•°é‡çš„é€šçŸ¥è€…è‡ªåŠ¨ç”¨äºæ¯ä¸ªä¸šåŠ¡å¯¹è±¡ã€‚å¦‚æœä»»æ„é€šçŸ¥è€…éƒ½æ²¡æœ‰ä¸€ä¸ªåˆ‡ç‚¹ä¸ä¸šåŠ¡å¯¹è±¡ä¸­çš„ä»»ä½•æ–¹æ³•åŒ¹é…ï¼Œé‚£ä¹ˆå¯¹è±¡å°†ä¸ä¼šè¢«ä»£ç†ã€‚å½“ä¸ºæ–°çš„ä¸šåŠ¡å¯¹è±¡æ·»åŠ äº†beanå®šä¹‰æ—¶ï¼Œå¦‚æœéœ€è¦è¿™äº›å¯¹è±¡éƒ½å°†è¢«è‡ªåŠ¨ä»£ç†ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œè‡ªåŠ¨ä»£ç†å…·æœ‰ä½¿è°ƒç”¨æ–¹æˆ–ä¾èµ–é¡¹æ— æ³•è·å–un-advisedå¯¹è±¡çš„ä¼˜ç‚¹ã€‚åœ¨è¿™ä¸ª<code>ApplicationContext</code>è°ƒç”¨<code>getBean(&quot;businessObject1&quot;)</code>æ–¹æ³•å°†è¿”å›AOPä»£ç†ï¼Œ è€Œä¸æ˜¯ç›®æ ‡ä¸šåŠ¡å¯¹è±¡ã€‚ï¼ˆå‰é¢æ˜¾ç¤ºçš„ â€œinner beanâ€ è¯­ä¹‰ä¹Ÿæä¾›äº†è¿™ç§å¥½å¤„ï¼‰ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹åˆ›å»ºä¸€ä¸ª<code>DefaultAdvisorAutoProxyCreator</code> beanä»¥åŠæœ¬èŠ‚ä¸­è®¨è®ºçš„å…¶ä»–å…ƒç´ :</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.transaction.interceptor.TransactionAttributeSourceAdvisor&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;transactionInterceptor&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;transactionInterceptor&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;customAdvisor&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.mycompany.MyAdvisor&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;businessObject1&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.mycompany.BusinessObject1&quot;</span>&gt;</span>    <span class="hljs-comment">&lt;!-- Properties omitted --&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;businessObject2&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.mycompany.BusinessObject2&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><p>å¦‚æœå¸Œæœ›å¯¹å¤šä¸ªä¸šåŠ¡å¯¹è±¡é€‚ç”¨ç›¸åŒçš„é€šçŸ¥ï¼Œé‚£ä¹ˆ<code>DefaultAdvisorAutoProxyCreator</code>ç±»ä¼šæ˜¾å¾—éå¸¸æœ‰ç”¨ã€‚ä¸€æ—¦åŸºç¡€æ¶æ„å·²å®šä¹‰ï¼Œå°±å¯ä»¥ç®€å•åœ°æ·»åŠ æ–°çš„ä¸šåŠ¡å¯¹è±¡ï¼Œ è€Œä¸å¿…å†è®¾ç½®ç‰¹å®šçš„ä»£ç†é…ç½®ã€‚è¿˜å¯ä»¥å¾ˆå®¹æ˜“åœ°åˆ é™¤å…¶ä»–åˆ‡é¢ï¼Œä¾‹å¦‚è·Ÿè¸ªæˆ–æ€§èƒ½ç›‘è§†åˆ‡é¢ ï¼Œ è¿™æ ·å¯¹é…ç½®çš„æ›´æ”¹æœ€å°ã€‚</p><p><code>DefaultAdvisorAutoProxyCreator</code>æä¾›å¯¹è¿‡æ»¤å™¨ï¼ˆfilteringï¼‰çš„æ”¯æŒï¼ˆä½¿ç”¨å‘½åçº¦å®šï¼Œä»¥ä¾¿åªè¯„ä¼°æŸäº›é€šçŸ¥è€…ï¼Œå…è®¸åœ¨åŒä¸€å·¥å‚ä¸­ä½¿ç”¨å¤šä¸ªä¸åŒé…ç½®çš„AdvisorAutoProxyCreatorsï¼‰å’Œæ’åºã€‚ é€šçŸ¥è€…å¯ä»¥å®ç°<code>org.springframework.core.Ordered</code>æ¥å£ï¼Œä»¥ç¡®ä¿æ­£ç¡®çš„æ’åºï¼Œå¦‚æœéœ€è¦æ’åºçš„è¯ã€‚ ä¸Šé¢çš„ä¾‹å­ä¸­ä½¿ç”¨çš„<code>TransactionAttributeSourceAdvisor</code>ç±»å…·æœ‰å…·æœ‰å¯é…ç½®çš„æ’åºå€¼ï¼Œ é»˜è®¤çš„è®¾ç½®æ˜¯æ— åºçš„ã€‚</p><h3 id="3-9-ä½¿ç”¨TargetSourceå®ç°"><a href="#3-9-ä½¿ç”¨TargetSourceå®ç°" class="headerlink" title="3.9. ä½¿ç”¨TargetSourceå®ç°"></a>3.9. ä½¿ç”¨<code>TargetSource</code>å®ç°</h3><p>Springæä¾›äº†<code>TargetSource</code>æ¦‚å¿µï¼Œå®šä¹‰åœ¨ <code>org.springframework.aop.TargetSource</code> æ¥å£ä¸­ã€‚ è¿™ä¸ªæ¥å£ç”¨äºè¿”å›ç›®æ ‡å¯¹è±¡å®ç°çš„è¿æ¥ç‚¹ã€‚ æ¯æ¬¡AOPä»£ç†å¤„ç†æ–¹æ³•è°ƒç”¨æ—¶ï¼Œéƒ½ä¼šè¦æ±‚ç›®æ ‡å®ä¾‹è¿›è¡Œ <code>TargetSource</code>å®ç°ã€‚</p><p>ä½¿ç”¨Spring AOPçš„å¼€å‘è€…é€šå¸¸æ— éœ€ç›´æ¥ä½¿ç”¨<code>TargetSource</code>ï¼Œä¸€èˆ¬éƒ½æ˜¯æä¾›äº†æ”¯æŒæ± ï¼Œçƒ­éƒ¨ç½²å’Œç”¨äºå…¶ä»–å¤æ‚ç›®æ ‡çš„å¼ºå¤§æ‰‹æ®µã€‚ ä¾‹å¦‚ï¼Œæ± åŒ–çš„<code>TargetSource</code>å¯ä»¥ä¸ºæ¯ä¸ªè°ƒç”¨è¿”å›ä¸€ä¸ªä¸åŒçš„ç›®æ ‡å®ä¾‹ï¼Œå¹¶ä½¿ç”¨ä¸€ä¸ªæ± æ¥ç®¡ç†å®ä¾‹ã€‚</p><p>å¦‚æœæœªæŒ‡å®š<code>TargetSource</code>ï¼Œåˆ™ä½¿ç”¨é»˜è®¤å®ç°æ¥åŒ…è£…æœ¬åœ°å¯¹è±¡ã€‚ æ¯æ¬¡è°ƒç”¨éƒ½ä¼šè¿”å›ç›¸åŒçš„ç›®æ ‡ï¼ˆæ­£å¦‚æ‚¨æ‰€æœŸæœ›çš„é‚£æ ·ï¼‰ã€‚</p><p>å°†ä¸‹æ¥ä»‹ç»Springæä¾›çš„æ ‡å‡†ç›®æ ‡æºï¼ˆtarget sourcesï¼‰ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨ã€‚</p><p>å½“ä½¿ç”¨è‡ªå®šä¹‰çš„target source,ç›®æ ‡é€šå¸¸éœ€è¦é…ç½®æˆåŸå‹è€Œä¸æ˜¯å•ä¾‹çš„beanå®šä¹‰ã€‚ è¿™å…è®¸SpringæŒ‰éœ€æ—¶åˆ›å»ºæ–°çš„ç›®æ ‡å®ä¾‹</p><h4 id="3-9-1-Hot-swappable-Target-Sources"><a href="#3-9-1-Hot-swappable-Target-Sources" class="headerlink" title="3.9.1. Hot-swappable Target Sources"></a>3.9.1. Hot-swappable Target Sources</h4><p><code>org.springframework.aop.target.HotSwappableTargetSource</code> çš„å­˜åœ¨æ˜¯ä¸ºäº†å…è®¸åˆ‡æ¢AOPä»£ç†çš„ç›®æ ‡ã€‚</p><p>æ”¹å˜ç›®æ ‡æºçš„ç›®æ ‡ä¼šç«‹å³æœ‰æ•ˆï¼Œ<code>HotSwappableTargetSource</code>æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p><p>å¯ä»¥é€šè¿‡HotSwappableTargetSourceä¸Šçš„<code>swap()</code>æ–¹æ³•æ›´æ”¹ç›®æ ‡ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs abnf">HotSwappableTargetSource swapper <span class="hljs-operator">=</span> (HotSwappableTargetSource) beanFactory.getBean(<span class="hljs-string">&quot;swapper&quot;</span>)<span class="hljs-comment">;</span><br><br>Object oldTarget <span class="hljs-operator">=</span> swapper.swap(newTarget)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†æ‰€éœ€çš„XMLå®šä¹‰:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;bean <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;initialTarget&quot;</span> <span class="hljs-attribute">class</span>=<span class="hljs-string">&quot;mycompany.OldTarget&quot;</span>/&gt;<br>&lt;bean <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;swapper&quot;</span> <span class="hljs-attribute">class</span>=<span class="hljs-string">&quot;org.springframework.aop.target.HotSwappableTargetSource&quot;</span>&gt;    &lt;constructor-arg <span class="hljs-attribute">ref</span>=<span class="hljs-string">&quot;initialTarget&quot;</span>/&gt;&lt;/bean&gt;<br>&lt;bean <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;swappable&quot;</span> <span class="hljs-attribute">class</span>=<span class="hljs-string">&quot;org.springframework.aop.framework.ProxyFactoryBean&quot;</span>&gt;    &lt;property <span class="hljs-attribute">name</span>=<span class="hljs-string">&quot;targetSource&quot;</span> <span class="hljs-attribute">ref</span>=<span class="hljs-string">&quot;swapper&quot;</span>/&gt;&lt;/bean&gt;<br></code></pre></td></tr></table></figure><p>å‰é¢çš„<code>swap()</code>æ–¹æ³•æ”¹å˜äº†swappable beançš„ç›®æ ‡ã€‚æŒæœ‰å¯¹è¯¥beanå¼•ç”¨çš„å®¢æˆ·ç«¯å°†ä¸ä¼šå¯Ÿè§‰åˆ°ç›®æ ‡çš„æ›´æ”¹ï¼Œä½†ä¼šé©¬ä¸Šå¼€å§‹å¤„ç†æ–°ç›®æ ‡ã€‚</p><p>è™½ç„¶è¿™ä¸ªä¾‹å­æ²¡æœ‰æ·»åŠ ä»»ä½•é€šçŸ¥ ï¼Œ ä¹Ÿæ²¡æœ‰å¿…è¦æ·»åŠ é€šçŸ¥æ¥ä½¿ç”¨<code>TargetSource</code>ï¼Œå½“ç„¶ä»»æ„çš„ <code>TargetSource</code>éƒ½å¯ä»¥å’Œä»»æ„çš„é€šçŸ¥ä¸€èµ·ä½¿ç”¨ã€‚</p><h4 id="3-9-2-åˆ›å»ºç›®æ ‡æºæ± "><a href="#3-9-2-åˆ›å»ºç›®æ ‡æºæ± " class="headerlink" title="3.9.2. åˆ›å»ºç›®æ ‡æºæ± "></a>3.9.2. åˆ›å»ºç›®æ ‡æºæ± </h4><p>ä½¿ç”¨æ± åŒ–çš„ç›®æ ‡æºä¸ºæ— çŠ¶æ€ä¼šè¯EJBæä¾›äº†ç±»ä¼¼çš„ç¼–ç¨‹æ¨¡å‹ï¼Œå®ƒç»´æŠ¤äº†ç›¸åŒå®ä¾‹æ± ï¼Œè°ƒç”¨æ–¹æ³•å°†ä¼šé‡Šæ”¾æ± ä¸­çš„å¯¹è±¡ã€‚</p><p>Springæ± å’ŒSLSBæ± æœ‰ä¸€ä¸ªå…³é”®çš„åŒºåˆ«æ˜¯ï¼šSpringæ± å¯ä»¥åº”ç”¨äºä»»æ„POJOã€‚å’ŒSpringä¸€æ ·ï¼Œè¿™ä¸ªæœåŠ¡å¯ä»¥ä»¥éä¾µå…¥çš„æ–¹å¼åº”ç”¨ã€‚</p><p>Springä¸ºCommons Pool 2.2ï¼Œæä¾›äº†å¼€ç®±å³ç”¨çš„æ”¯æŒï¼Œå®ƒæä¾›äº†ä¸€ä¸ªç›¸å½“é«˜æ•ˆçš„æ± åŒ–å®ç°ã€‚å¼€å‘è€…éœ€è¦åœ¨åº”ç”¨ç¨‹åºçš„ç±»è·¯å¾„ä¸Šæ·»åŠ  <code>commons-pool</code>çš„jaråŒ…æ¥å¯ç”¨æ­¤åŠŸèƒ½ã€‚ ä¹Ÿå¯ä»¥å¯¹<code>org.springframework.aop.target.AbstractPoolingTargetSource</code> to support any otherè¿›è¡Œå­ç±»åŒ–æ¥æ”¯æŒä»»æ„å…¶å®ƒæ± åŒ–çš„APIã€‚</p><p>Commons Pool 1.5+ çš„ç‰ˆæœ¬ä¹Ÿæ˜¯æ”¯æŒçš„ï¼Œä½†æ˜¯åœ¨Spring Framework 4.2å·²ç»è¿‡æ—¶äº†ã€‚</p><p>ä»¥ä¸‹æ¸…å•æ˜¾ç¤ºäº†ä¸€ä¸ªç¤ºä¾‹é…ç½®:</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs abnf">&lt;bean id<span class="hljs-operator">=</span><span class="hljs-string">&quot;businessObjectTarget&quot;</span> class<span class="hljs-operator">=</span><span class="hljs-string">&quot;com.mycompany.MyBusinessObject&quot;</span>        scope<span class="hljs-operator">=</span><span class="hljs-string">&quot;prototype&quot;</span>&gt;    ... properties omitted&lt;/bean&gt;<br>&lt;bean id<span class="hljs-operator">=</span><span class="hljs-string">&quot;poolTargetSource&quot;</span> class<span class="hljs-operator">=</span><span class="hljs-string">&quot;org.springframework.aop.target.CommonsPool2TargetSource&quot;</span>&gt;    &lt;property name<span class="hljs-operator">=</span><span class="hljs-string">&quot;targetBeanName&quot;</span> value<span class="hljs-operator">=</span><span class="hljs-string">&quot;businessObjectTarget&quot;</span>/&gt;    &lt;property name<span class="hljs-operator">=</span><span class="hljs-string">&quot;maxSize&quot;</span> value<span class="hljs-operator">=</span><span class="hljs-string">&quot;25&quot;</span>/&gt;&lt;/bean&gt;<br>&lt;bean id<span class="hljs-operator">=</span><span class="hljs-string">&quot;businessObject&quot;</span> class<span class="hljs-operator">=</span><span class="hljs-string">&quot;org.springframework.aop.framework.ProxyFactoryBean&quot;</span>&gt;    &lt;property name<span class="hljs-operator">=</span><span class="hljs-string">&quot;targetSource&quot;</span> ref<span class="hljs-operator">=</span><span class="hljs-string">&quot;poolTargetSource&quot;</span>/&gt;    &lt;property name<span class="hljs-operator">=</span><span class="hljs-string">&quot;interceptorNames&quot;</span> value<span class="hljs-operator">=</span><span class="hljs-string">&quot;myInterceptor&quot;</span>/&gt;&lt;/bean&gt;<br></code></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œç›®æ ‡å¯¹è±¡ ( ä¾‹å¦‚ç¤ºä¾‹ä¸­çš„<code>businessObjectTarget</code>)å¿…é¡»æ˜¯åŸå‹çš„ã€‚ è¿™å…è®¸<code>PoolingTargetSource</code>èƒ½å¤Ÿå®ç°æŒ‰éœ€åˆ›å»ºç›®æ ‡çš„æ–°å®ä¾‹ï¼Œç”¨äºæ‰©å±•æ± ã€‚ è¯·å‚é˜…<a href="https://docs.spring.io/spring-framework/docs/5.1.3.BUILD-SNAPSHOT/javadoc-api/org/springframeworkaop/target/AbstractPoolingTargetSource.html">javadoc of<code>AbstractPoolingTargetSource</code></a>ä»¥åŠç”¨äºå…¶å±æ€§ä¿¡æ¯çš„å…·ä½“å­ç±»ã€‚ <code>maxSize</code> æ˜¯æœ€åŸºæœ¬çš„ï¼Œå¹¶ä¸”å§‹ç»ˆä¿è¯å­˜åœ¨ã€‚</p><p>åœ¨è¿™ç§æƒ…å†µä¸‹, <code>myInterceptor</code> æ˜¯éœ€è¦åœ¨ç›¸åŒçš„IoCä¸Šä¸‹æ–‡ä¸­å®šä¹‰çš„æ‹¦æˆªå™¨çš„åç§°ã€‚ä½†æ˜¯ï¼Œæ— éœ€æŒ‡å®šæ‹¦æˆªå™¨æ¥ä½¿ç”¨æ± ã€‚å¦‚æœåªå¸Œæœ›ä½¿ç”¨æ± åŒ–åŠŸèƒ½è€Œä¸éœ€è¦é€šçŸ¥ï¼Œé‚£ä¹ˆå¯ä»¥ä¸è®¾ç½®<code>interceptorNames</code>å±æ€§ã€‚</p><p>å¯ä»¥å¯¹Springè¿›è¡Œé…ç½®ï¼Œä»¥ä¾¿å°†ä»»æ„æ± å¯¹è±¡å¼ºåˆ¶è½¬æ¢åˆ°<code>org.springframework.aop.target.PoolingConfig</code> æ¥å£,ä»è€Œå¼•å…¥å…¬å¼€çš„ï¼Œæœ‰å…³æ± çš„é…ç½®å’Œå½“å‰å¤§å°çš„ä¿¡æ¯ã€‚ æ­¤æ—¶éœ€è¦åƒä¸‹é¢è¿™æ ·å®šä¹‰é€šçŸ¥è€…:</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs abnf">&lt;bean id<span class="hljs-operator">=</span><span class="hljs-string">&quot;poolConfigAdvisor&quot;</span> class<span class="hljs-operator">=</span><span class="hljs-string">&quot;org.springframework.beans.factory.config.MethodInvokingFactoryBean&quot;</span>&gt;<br><br>    &lt;property name<span class="hljs-operator">=</span><span class="hljs-string">&quot;targetObject&quot;</span> ref<span class="hljs-operator">=</span><span class="hljs-string">&quot;poolTargetSource&quot;</span>/&gt;<br><br>    &lt;property name<span class="hljs-operator">=</span><span class="hljs-string">&quot;targetMethod&quot;</span> value<span class="hljs-operator">=</span><span class="hljs-string">&quot;getPoolingConfigMixin&quot;</span>/&gt;<br><br>&lt;/bean&gt;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªé€šçŸ¥è€…æ˜¯é€šè¿‡åœ¨<code>AbstractPoolingTargetSource</code>ç±»ä¸Šè°ƒç”¨ä¸€ä¸ªæ–¹ä¾¿çš„æ–¹æ³•è·å¾—çš„ï¼Œå› æ­¤å¯ä»¥è°ƒç”¨<code>MethodInvokingFactoryBean</code>ã€‚é€šçŸ¥è€…çš„åå­—ï¼ˆåœ¨è¿™é‡Œæ˜¯<code>poolConfigAdvisor</code>ï¼‰å¿…é¡»åŒ…å«åœ¨æ‹¦æˆªå™¨åå­—çš„åˆ—è¡¨ä¸­ï¼Œ<code>ProxyFactoryBean</code>å…¬å¼€äº†æ± åŒ–çš„å¯¹è±¡ã€‚</p><p>The cast is defined as follows:</p><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sas">PoolingConfig conf = (PoolingConfig) beanFactory.getBea<span class="hljs-meta">n</span>(<span class="hljs-string">&quot;businessObject&quot;</span>);<br><br>System.<span class="hljs-keyword">out</span>.printl<span class="hljs-meta">n</span>(<span class="hljs-string">&quot;Max pool size is &quot;</span> + conf.getMaxSize());<br></code></pre></td></tr></table></figure><p>æ± åŒ–çš„æ— çŠ¶æ€æœåŠ¡å¯¹è±¡ä¸€èˆ¬æ˜¯æ²¡æœ‰å¿…è¦çš„ã€‚ä¸€èˆ¬è¿™ç§é€‰æ‹©ä¸æ˜¯é»˜è®¤çš„ï¼Œå› ä¸ºå¤§å¤šæ•°æ— çŠ¶æ€çš„å¯¹è±¡æœ¬è´¨ä¸Šæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¹¶ä¸”å¦‚æœèµ„æºæ˜¯ç¼“å­˜çš„è¯ï¼Œå…¶å®ä¾‹æ± åŒ–æ˜¯æœ‰é—®é¢˜çš„ã€‚</p><p>ä½¿ç”¨è‡ªåŠ¨ä»£ç†å¯ä»¥åˆ›å»ºæ›´ç®€å•çš„æ± ï¼Œå¯ä»¥è®¾ç½®ä»»ä½•è‡ªåŠ¨ä»£ç†åˆ›å»ºè€…ä½¿ç”¨çš„<code>TargetSource</code> ã€‚</p><h4 id="3-9-3-åŸå‹ç›®æ ‡æº"><a href="#3-9-3-åŸå‹ç›®æ ‡æº" class="headerlink" title="3.9.3. åŸå‹ç›®æ ‡æº"></a>3.9.3. åŸå‹ç›®æ ‡æº</h4><p>è®¾ç½®â€œprototypeâ€ ç›®æ ‡æºä¸åˆå¹¶<code>TargetSource</code>ç±»ä¼¼ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¯ä¸ªæ–¹æ³•è°ƒç”¨éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç›®æ ‡å®ä¾‹ã€‚ å°½ç®¡åœ¨ç°ä»£JVMä¸­åˆ›å»ºæ–°å¯¹è±¡çš„æˆæœ¬å¹¶ä¸é«˜ï¼Œ ä½†æ˜¯è¿æ¥æ–°å¯¹è±¡ï¼ˆæ»¡è¶³å…¶IoCä¾èµ–æ€§ï¼‰çš„æˆæœ¬å¯èƒ½ä¼šæ›´é«˜ã€‚å› æ­¤ï¼Œå¦‚æœæ²¡æœ‰å¾ˆå¥½çš„ç†ç”±ï¼Œä¸åº”è¯¥ä½¿ç”¨è¿™ç§æ–¹æ³•ã€‚</p><p>ä¸ºæ­¤, å¯ä»¥ä¿®æ”¹ä¸Šé¢æ˜¾ç¤ºçš„ <code>poolTargetSource</code> å®šä¹‰ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼ˆä¸ºæ¸…æ™°èµ·è§ï¼Œæˆ‘ä»¬è¿˜æ›´æ”¹äº†åç§°ï¼‰ï¼š:</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs abnf">&lt;bean id<span class="hljs-operator">=</span><span class="hljs-string">&quot;prototypeTargetSource&quot;</span> class<span class="hljs-operator">=</span><span class="hljs-string">&quot;org.springframework.aop.target.PrototypeTargetSource&quot;</span>&gt;<br><br>    &lt;property name<span class="hljs-operator">=</span><span class="hljs-string">&quot;targetBeanName&quot;</span> ref<span class="hljs-operator">=</span><span class="hljs-string">&quot;businessObjectTarget&quot;</span>/&gt;<br><br>&lt;/bean&gt;<br></code></pre></td></tr></table></figure><p>å”¯ä¸€çš„å±æ€§æ˜¯ç›®æ ‡beançš„åç§°ã€‚åœ¨<code>TargetSource</code>å®ç°ä¸­ä½¿ç”¨ç»§æ‰¿æ¥ç¡®ä¿ä¸€è‡´çš„å‘½åã€‚ä¸æ± åŒ–ç›®æ ‡æºä¸€æ ·ï¼Œç›®æ ‡beanå¿…é¡»æ˜¯åŸå‹beanå®šä¹‰ã€‚</p><h4 id="3-9-4-ThreadLocal-çš„ç›®æ ‡æº"><a href="#3-9-4-ThreadLocal-çš„ç›®æ ‡æº" class="headerlink" title="3.9.4. ThreadLocal çš„ç›®æ ‡æº"></a>3.9.4. <code>ThreadLocal</code> çš„ç›®æ ‡æº</h4><p>å¦‚æœæ‚¨éœ€è¦ä¸ºæ¯ä¸ªä¼ å…¥è¯·æ±‚åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼ˆæ¯ä¸ªçº¿ç¨‹ï¼‰ï¼Œ<code>ThreadLocal</code>ç›®æ ‡æºå¾ˆæœ‰ç”¨ã€‚<code>ThreadLocal</code>çš„æ¦‚å¿µæä¾›äº†ä¸€ä¸ªJDKèŒƒå›´çš„å·¥å…·ï¼Œç”¨äºé€æ˜åœ°å°†èµ„æºä¸çº¿ç¨‹å­˜å‚¨åœ¨ä¸€èµ·ã€‚ è®¾ç½®<code>ThreadLocalTargetSource</code>å‡ ä¹ä¸å…¶ä»–ç±»å‹çš„ç›®æ ‡æºè®¾ç½®ä¸€æ ·ã€‚å¦‚ä¸‹ä¾‹æ‰€ç¤º:</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs abnf">&lt;bean id<span class="hljs-operator">=</span><span class="hljs-string">&quot;threadlocalTargetSource&quot;</span> class<span class="hljs-operator">=</span><span class="hljs-string">&quot;org.springframework.aop.target.ThreadLocalTargetSource&quot;</span>&gt;<br><br>    &lt;property name<span class="hljs-operator">=</span><span class="hljs-string">&quot;targetBeanName&quot;</span> value<span class="hljs-operator">=</span><span class="hljs-string">&quot;businessObjectTarget&quot;</span>/&gt;<br><br>&lt;/bean&gt;<br></code></pre></td></tr></table></figure><p>å½“åœ¨å¤šçº¿ç¨‹å’Œå¤šç±»åŠ è½½å™¨ç¯å¢ƒä¸­é”™è¯¯åœ°ä½¿ç”¨å®ƒä»¬æ—¶ï¼Œ<code>ThreadLocal</code>ä¼šå¸¦æ¥ä¸¥é‡çš„é—®é¢˜ï¼ˆå¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼ï¼‰ã€‚æ‚¨åº”è¯¥å§‹ç»ˆè€ƒè™‘å°†threadlocalåŒ…è£…åœ¨å…¶ä»–ç±»ä¸­ï¼Œå¹¶ä¸”æ°¸è¿œä¸è¦ç›´æ¥ä½¿ç”¨ <code>ThreadLocal</code>æœ¬èº«ï¼ˆé™¤äº†åœ¨åŒ…è£…ç±»ä¸­ï¼‰ã€‚ å¦å¤–ï¼Œåº”è¯¥å§‹ç»ˆè®°å¾—æ­£ç¡®è®¾ç½®å’Œå–æ¶ˆè®¾ç½®ï¼ˆåè€…åªéœ€è°ƒç”¨<code>ThreadLocal.set(null)</code>æ–¹æ³•ï¼‰çº¿ç¨‹çš„æœ¬åœ°èµ„æºã€‚åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½åº”è¯¥å†™å–æ¶ˆè®¾ç½®ï¼Œå¦‚æœä¸å–æ¶ˆå°†ä¼šå‡ºé—®é¢˜ã€‚ Springçš„<code>ThreadLocal</code>æ”¯æŒæ­¤è®¾ç½®å¹¶ä¸”åº”å½“è¢«è€ƒè™‘æ”¯æŒä½¿ç”¨<code>ThreadLocal</code>è€Œä¸æ˜¯æ‰‹åŠ¨æ“ä½œä»£ç ã€‚</p><h3 id="3-10-å®šä¹‰æ–°çš„é€šçŸ¥ç±»å‹"><a href="#3-10-å®šä¹‰æ–°çš„é€šçŸ¥ç±»å‹" class="headerlink" title="3.10. å®šä¹‰æ–°çš„é€šçŸ¥ç±»å‹"></a>3.10. å®šä¹‰æ–°çš„é€šçŸ¥ç±»å‹</h3><p>Spring AOPè¢«è®¾è®¡ä¸ºå¯æ‰©å±•çš„ã€‚å°½ç®¡æ‹¦æˆªå™¨å®æ–½æœºåˆ¶ç›®å‰åªåœ¨å†…éƒ¨ä½¿ç”¨ï¼Œä½†é™¤äº†å›´ç»•é€šçŸ¥æ‹¥æœ‰å¼€ç®±å³ç”¨çš„æ‹¦æˆªå™¨ä¹‹å¤–ï¼Œè¿˜å¯ä»¥æ”¯æŒä»»æ„çš„é€šçŸ¥ç±»å‹ï¼Œä¾‹å¦‚å‰ç½®ã€å¼‚å¸¸å’Œåç½®è¿”å›çš„é€šçŸ¥ã€‚</p><p>The <code>org.springframework.aop.framework.adapter</code>åŒ…æ˜¯ä¸€ä¸ªSPIåŒ…ï¼Œå…è®¸åœ¨ä¸æ”¹å˜æ ¸å¿ƒæ¡†æ¶çš„æƒ…å†µä¸‹æ·»åŠ æ–°çš„è‡ªå®šä¹‰é€šçŸ¥ç±»å‹ã€‚è‡ªå®šä¹‰é€šçŸ¥ç±»å‹çš„å”¯ä¸€çº¦æŸæ˜¯å®ƒå¿…é¡»å®ç° <code>org.aopalliance.aop.Advice</code>æ ‡è¯†æ¥å£ã€‚</p><p>See the <a href="https://docs.spring.io/spring-framework/docs/5.1.3.BUILD-SNAPSHOT/javadoc-api/org/springframework/aop/framework/adapter/package-frame.html"><code>org.springframework.aop.framework.adapter</code></a> javadoc for further information.</p><blockquote><p>Rod Johnson, Juergen Hoeller, Keith Donald, Colin Sampaleanu, Rob Harrop, Thomas Risberg, Alef Arendsen, Darren Davison, Dmitriy Kopylenko, Mark Pollack, Thierry Templier, Erwin Vervaet, Portia Tung, Ben Hale, Adrian Colyer, John Lewis, Costin Leau, Mark Fisher, Sam Brannen, Ramnivas Laddad, Arjen Poutsma, Chris Beams, Tareq Abedrabbo, Andy Clement, Dave Syer, Oliver Gierke, Rossen Stoyanchev, Phillip Webb, Rob Winch, Brian Clozel, Stephane Nicoll, Sebastien Deleuze, Jay Bryant, Mark Paluch</p></blockquote><blockquote><p>Copyright Â© 2002 - 2024 VMware, Inc. All Rights Reserved.</p></blockquote><blockquote><p>Copies of this document may be made for your own use and for distribution to others, provided that you do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically.</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>Spring æ•™ç¨‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Spring</tag>
      
      <tag>AOP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>AOPç¼–ç¨‹(ä¸Š)</title>
    <link href="/post/6afadaa8-943a-4804-bc56-bcb95040e76e/"/>
    <url>/post/6afadaa8-943a-4804-bc56-bcb95040e76e/</url>
    
    <content type="html"><![CDATA[<h1 id="AOP-ç¼–ç¨‹-ä¸Š"><a href="#AOP-ç¼–ç¨‹-ä¸Š" class="headerlink" title="AOP ç¼–ç¨‹(ä¸Š)"></a>AOP ç¼–ç¨‹(ä¸Š)</h1><p>Spring æ•™ç¨‹</p><hr><h2 id="2-ä½¿ç”¨Springé¢å‘åˆ‡é¢ç¼–ç¨‹"><a href="#2-ä½¿ç”¨Springé¢å‘åˆ‡é¢ç¼–ç¨‹" class="headerlink" title="2. ä½¿ç”¨Springé¢å‘åˆ‡é¢ç¼–ç¨‹"></a>2. ä½¿ç”¨Springé¢å‘åˆ‡é¢ç¼–ç¨‹</h2><p>é¢å‘åˆ‡é¢ç¼–ç¨‹(Aspect-oriented Programming ç®€ç§°AOPAOP) ,æ˜¯ç›¸å¯¹é¢å‘å¯¹è±¡ç¼–ç¨‹(Object-oriented Programming ç®€ç§°OOP)çš„æ¡†æ¶,ä½œä¸ºOOPçš„ä¸€ç§åŠŸèƒ½è¡¥å……. OOPä¸»è¦çš„æ¨¡å—å•å…ƒæ˜¯ç±»(class)ã€‚è€ŒAOPåˆ™æ˜¯åˆ‡é¢ï¼ˆaspectï¼‰ã€‚åˆ‡é¢ä¼šå°†è¯¸å¦‚äº‹åŠ¡ç®¡ç†è¿™æ ·è·¨è¶Šå¤šä¸ªç±»å‹å’Œå¯¹è±¡çš„å…³æ³¨ç‚¹æ¨¡å—åŒ–ï¼ˆåœ¨AOPçš„è¯­ä¹‰ä¸­ï¼Œè¿™ç±»å…³æ³¨ç‚¹è¢«ç§°ä¸ºæ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆcrosscuttingï¼‰ï¼‰ã€‚</p><p>AOPæ˜¯Springæ¡†æ¶é‡è¦çš„ç»„ä»¶ï¼Œè™½ç„¶Spring IoCå®¹å™¨æ²¡æœ‰ä¾èµ–AOPï¼Œå› æ­¤Springä¸ä¼šå¼ºè¿«å¼€å‘è€…ä½¿ç”¨AOPã€‚ä½†AOPæä¾›äº†éå¸¸æ£’çš„åŠŸèƒ½ï¼Œç”¨åšå¯¹Spring IoCçš„è¡¥å……ã€‚</p><p>Spring 2.0+ AOP</p><p>Spring 2.0 å¼•å…¥äº†ä¸€ç§æ›´ç®€å•ã€æ›´å¼ºå¤§çš„æ–¹å¼ç”¨æ¥è‡ªå®šä¹‰åˆ‡é¢ï¼Œå¼€å‘è€…å¯ä»¥é€‰æ‹©ä½¿ç”¨åŸºäºæ¨¡å¼ <a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-schema">schema-based approach</a> çš„æ–¹å¼æˆ–ä½¿ç”¨<a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-ataspectj">@AspectJæ³¨è§£é£æ ¼</a>æ–¹å¼æ¥å®šä¹‰ã€‚è¿™ä¸¤ç§æ–¹å¼éƒ½å®Œå…¨æ”¯æŒé€šçŸ¥ï¼ˆAdviceï¼‰ç±»å‹å’ŒAspectJçš„åˆ‡ç‚¹è¯­ä¹‰ï¼Œè™½ç„¶å®é™…ä¸Šä»ç„¶æ˜¯ä½¿ç”¨Spring AOPç»‡å…¥ï¼ˆweavingï¼‰çš„ã€‚</p><p>æœ¬ç« ä¸»è¦è®¨è®ºSpring 2.0+ æ¡†æ¶å¯¹åŸºäºæ¨¡å¼å’ŒåŸºäº@AspectJçš„AOPæ”¯æŒã€‚<a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-api">ä¸‹ä¸€ç« </a>ï¼Œå°†è®¨è®ºåº•å±‚çš„AOPæ”¯æŒï¼Œå¦‚Spring 1.2åº”ç”¨ç¨‹åºä¸­å¸¸è§çš„é‚£æ ·ã€‚ The lower-level AOP support, as commonly exposed in Spring 1.2 applications, is discussed in .</p><p>AOPåœ¨Spring Frameworkä¸­ç”¨äº:</p><ul><li>æä¾›å£°æ˜å¼ä¼ä¸šæœåŠ¡ï¼Œç‰¹åˆ«æ˜¯ç”¨äºæ›¿ä»£EJBçš„å£°æ˜å¼æœåŠ¡ã€‚æœ€é‡è¦çš„æœåŠ¡æ˜¯<a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#transaction-declarative">å£°æ˜å¼äº‹åŠ¡ç®¡ç†</a>ï¼ˆdeclarative transaction managementï¼‰ï¼Œè¿™ä¸ªæœåŠ¡å»ºç«‹åœ¨Springçš„æŠ½è±¡äº‹åŠ¡ç®¡ç†ï¼ˆtransaction abstractionï¼‰ä¹‹ä¸Šã€‚</li><li>å…è®¸å¼€å‘è€…å®ç°è‡ªå®šä¹‰åˆ‡é¢ï¼Œä½¿ç”¨AOPæ¥å®Œå–„OOPçš„åŠŸèƒ½ã€‚</li></ul><p>å¦‚æœåªæ‰“ç®—ä½¿ç”¨é€šç”¨çš„å£°æ˜å¼æœåŠ¡æˆ–è€…å·²æœ‰çš„å£°æ˜å¼ä¸­é—´ä»¶æœåŠ¡ï¼Œä¾‹å¦‚ç¼“å†²æ± ï¼ˆpoolingï¼‰é‚£ä¹ˆå¯ä»¥ä¸ç›´æ¥ä½¿ç”¨AOPï¼Œä¹Ÿå¯ä»¥å¿½ç•¥æœ¬ç« å¤§éƒ¨åˆ†å†…å®¹ã€‚</p><h3 id="2-1-AOP-æ¦‚å¿µ"><a href="#2-1-AOP-æ¦‚å¿µ" class="headerlink" title="2.1. AOP æ¦‚å¿µ"></a>2.1. AOP æ¦‚å¿µ</h3><p>è®©æˆ‘ä»¬ä»å®šä¹‰ä¸€äº›æ ¸å¿ƒAOPæ¦‚å¿µå’Œæœ¯è¯­å¼€å§‹ã€‚ è¿™äº›æœ¯è¯­ä¸æ˜¯ç‰¹å®šäºSpringçš„ã€‚ ä¸å¹¸çš„æ˜¯ï¼ŒAOPæœ¯è¯­ä¸æ˜¯ç‰¹åˆ«ç›´è§‚ã€‚ ä½†æ˜¯ï¼Œå¦‚æœSpringä½¿ç”¨è‡ªå·±çš„æœ¯è¯­ï¼Œé‚£å°†æ›´åŠ ä»¤äººå›°æƒ‘ã€‚</p><ul><li>åˆ‡é¢ï¼ˆAspectï¼‰: æŒ‡å…³æ³¨ç‚¹æ¨¡å—åŒ–ï¼Œè¿™ä¸ªå…³æ³¨ç‚¹å¯èƒ½ä¼šæ¨ªåˆ‡å¤šä¸ªå¯¹è±¡ã€‚äº‹åŠ¡ç®¡ç†æ˜¯ä¼ä¸šçº§Javaåº”ç”¨ä¸­æœ‰å…³æ¨ªåˆ‡å…³æ³¨ç‚¹çš„ä¾‹å­ã€‚ åœ¨Spring AOPä¸­ï¼Œåˆ‡é¢å¯ä»¥ä½¿ç”¨é€šç”¨ç±»åŸºäºæ¨¡å¼çš„æ–¹å¼ï¼ˆ<a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-schema">schema-based approach</a>ï¼‰æˆ–è€…åœ¨æ™®é€šç±»ä¸­ä»¥<code>@Aspect</code>æ³¨è§£ï¼ˆ<a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-ataspectj">@AspectJ æ³¨è§£æ–¹å¼</a>ï¼‰æ¥å®ç°ã€‚</li><li>è¿æ¥ç‚¹ï¼ˆJoin pointï¼‰: åœ¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­æŸä¸ªç‰¹å®šçš„ç‚¹ï¼Œä¾‹å¦‚æŸä¸ªæ–¹æ³•è°ƒç”¨çš„æ—¶é—´ç‚¹æˆ–è€…å¤„ç†å¼‚å¸¸çš„æ—¶é—´ç‚¹ã€‚åœ¨Spring AOPä¸­ï¼Œä¸€ä¸ªè¿æ¥ç‚¹æ€»æ˜¯ä»£è¡¨ä¸€ä¸ªæ–¹æ³•çš„æ‰§è¡Œã€‚</li><li>é€šçŸ¥ï¼ˆAdviceï¼‰: åœ¨åˆ‡é¢çš„æŸä¸ªç‰¹å®šçš„è¿æ¥ç‚¹ä¸Šæ‰§è¡Œçš„åŠ¨ä½œã€‚é€šçŸ¥æœ‰å¤šç§ç±»å‹ï¼ŒåŒ…æ‹¬â€œaroundâ€, â€œbeforeâ€ and â€œafterâ€ç­‰ç­‰ã€‚é€šçŸ¥çš„ç±»å‹å°†åœ¨åé¢çš„ç« èŠ‚è¿›è¡Œè®¨è®ºã€‚ è®¸å¤šAOPæ¡†æ¶ï¼ŒåŒ…æ‹¬Springåœ¨å†…ï¼Œéƒ½æ˜¯ä»¥æ‹¦æˆªå™¨åšé€šçŸ¥æ¨¡å‹çš„ï¼Œå¹¶ç»´æŠ¤ç€ä¸€ä¸ªä»¥è¿æ¥ç‚¹ä¸ºä¸­å¿ƒçš„æ‹¦æˆªå™¨é“¾ã€‚</li><li>åˆ‡ç‚¹ï¼ˆPointcutï¼‰: åŒ¹é…è¿æ¥ç‚¹çš„æ–­è¨€ã€‚é€šçŸ¥å’Œåˆ‡ç‚¹è¡¨è¾¾å¼ç›¸å…³è”ï¼Œå¹¶åœ¨æ»¡è¶³è¿™ä¸ªåˆ‡ç‚¹çš„è¿æ¥ç‚¹ä¸Šè¿è¡Œï¼ˆä¾‹å¦‚ï¼Œå½“æ‰§è¡ŒæŸä¸ªç‰¹å®šåç§°çš„æ–¹æ³•æ—¶ï¼‰ã€‚åˆ‡ç‚¹è¡¨è¾¾å¼å¦‚ä½•å’Œè¿æ¥ç‚¹åŒ¹é…æ˜¯AOPçš„æ ¸å¿ƒï¼šSpringé»˜è®¤ä½¿ç”¨AspectJåˆ‡ç‚¹è¯­ä¹‰ã€‚</li><li>å¼•å…¥ï¼ˆIntroductionï¼‰: å£°æ˜é¢å¤–çš„æ–¹æ³•æˆ–è€…æŸä¸ªç±»å‹çš„å­—æ®µã€‚Springå…è®¸å¼•å…¥æ–°çš„æ¥å£ï¼ˆä»¥åŠä¸€ä¸ªå¯¹åº”çš„å®ç°ï¼‰åˆ°ä»»ä½•è¢«é€šçŸ¥çš„å¯¹è±¡ä¸Šã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨å¼•å…¥æ¥ä½¿beanå®ç° <code>IsModified</code>æ¥å£ï¼Œ ä»¥ä¾¿ç®€åŒ–ç¼“å­˜æœºåˆ¶ï¼ˆåœ¨AspectJç¤¾åŒºï¼Œå¼•å…¥ä¹Ÿè¢«ç§°ä¸ºå†…éƒ¨ç±»å‹å£°æ˜ï¼ˆinterï¼‰ï¼‰ã€‚</li><li>ç›®æ ‡å¯¹è±¡ï¼ˆTarget objectï¼‰: è¢«ä¸€ä¸ªæˆ–è€…å¤šä¸ªåˆ‡é¢æ‰€é€šçŸ¥çš„å¯¹è±¡ã€‚ä¹Ÿè¢«ç§°ä½œè¢«é€šçŸ¥ï¼ˆadvisedï¼‰å¯¹è±¡ã€‚æ—¢ç„¶Spring AOPæ˜¯é€šè¿‡è¿è¡Œæ—¶ä»£ç†å®ç°çš„ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡æ°¸è¿œæ˜¯ä¸€ä¸ªè¢«ä»£ç†ï¼ˆproxiedï¼‰çš„å¯¹è±¡ã€‚</li><li>AOPä»£ç†ï¼ˆAOP proxyï¼‰:AOP æ¡†æ¶åˆ›å»ºçš„å¯¹è±¡ï¼Œç”¨æ¥å®ç°åˆ‡é¢å¥‘çº¦ï¼ˆaspect contractï¼‰ï¼ˆåŒ…æ‹¬é€šçŸ¥æ–¹æ³•æ‰§è¡Œç­‰åŠŸèƒ½ï¼‰ã€‚åœ¨Springä¸­ï¼ŒAOPä»£ç†å¯ä»¥æ˜¯JDKåŠ¨æ€ä»£ç†æˆ–CGLIBä»£ç†ã€‚</li><li>ç»‡å…¥ï¼ˆWeavingï¼‰: æŠŠåˆ‡é¢è¿æ¥åˆ°å…¶å®ƒçš„åº”ç”¨ç¨‹åºç±»å‹æˆ–è€…å¯¹è±¡ä¸Šï¼Œå¹¶åˆ›å»ºä¸€ä¸ªè¢«è¢«é€šçŸ¥çš„å¯¹è±¡çš„è¿‡ç¨‹ã€‚è¿™ä¸ªè¿‡ç¨‹å¯ä»¥åœ¨ç¼–è¯‘æ—¶ï¼ˆä¾‹å¦‚ä½¿ç”¨AspectJç¼–è¯‘å™¨ï¼‰ã€ç±»åŠ è½½æ—¶æˆ–è¿è¡Œæ—¶ä¸­å®Œæˆã€‚ Springå’Œå…¶ä»–çº¯Java AOPæ¡†æ¶ä¸€æ ·ï¼Œæ˜¯åœ¨è¿è¡Œæ—¶å®Œæˆç»‡å…¥çš„ã€‚</li></ul><p>Spring AOPåŒ…å«ä»¥ä¸‹ç±»å‹çš„é€šçŸ¥:</p><ul><li>å‰ç½®é€šçŸ¥ï¼ˆBefore adviceï¼‰: åœ¨è¿æ¥ç‚¹ä¹‹å‰è¿è¡Œä½†æ— æ³•é˜»æ­¢æ‰§è¡Œæµç¨‹è¿›å…¥è¿æ¥ç‚¹çš„é€šçŸ¥ï¼ˆé™¤éå®ƒå¼•å‘å¼‚å¸¸ï¼‰ã€‚</li><li>åç½®è¿”å›é€šçŸ¥ï¼ˆAfter returning adviceï¼‰:åœ¨è¿æ¥ç‚¹æ­£å¸¸å®Œæˆåæ‰§è¡Œçš„é€šçŸ¥ï¼ˆä¾‹å¦‚ï¼Œå½“æ–¹æ³•æ²¡æœ‰æŠ›å‡ºä»»ä½•å¼‚å¸¸å¹¶æ­£å¸¸è¿”å›æ—¶ï¼‰ã€‚</li><li>åç½®å¼‚å¸¸é€šçŸ¥ï¼ˆAfter throwing adviceï¼‰: åœ¨æ–¹æ³•æŠ›å‡ºå¼‚å¸¸é€€å‡ºæ—¶æ‰§è¡Œçš„é€šçŸ¥ã€‚</li><li>åç½®é€šçŸ¥ï¼ˆæ€»ä¼šæ‰§è¡Œï¼‰ï¼ˆAfter (finally) adviceï¼‰: å½“è¿æ¥ç‚¹é€€å‡ºçš„æ—¶å€™æ‰§è¡Œçš„é€šçŸ¥ï¼ˆæ— è®ºæ˜¯æ­£å¸¸è¿”å›è¿˜æ˜¯å¼‚å¸¸é€€å‡ºï¼‰ã€‚</li><li>ç¯ç»•é€šçŸ¥ï¼ˆAround Adviceï¼‰:ç¯ç»•è¿æ¥ç‚¹çš„é€šçŸ¥ï¼Œä¾‹å¦‚æ–¹æ³•è°ƒç”¨ã€‚è¿™æ˜¯æœ€å¼ºå¤§çš„ä¸€ç§é€šçŸ¥ç±»å‹ï¼Œã€‚ç¯ç»•é€šçŸ¥å¯ä»¥åœ¨æ–¹æ³•è°ƒç”¨å‰åå®Œæˆè‡ªå®šä¹‰çš„è¡Œä¸ºã€‚å®ƒå¯ä»¥é€‰æ‹©æ˜¯å¦ç»§ç»­æ‰§è¡Œè¿æ¥ç‚¹æˆ–ç›´æ¥è¿”å›è‡ªå®šä¹‰çš„è¿”å›å€¼åˆæˆ–æŠ›å‡ºå¼‚å¸¸å°†æ‰§è¡Œç»“æŸã€‚</li></ul><p>ç¯ç»•é€šçŸ¥æ˜¯æœ€å¸¸ç”¨çš„ä¸€ç§é€šçŸ¥ç±»å‹ã€‚ä¸AspectJä¸€æ ·ï¼Œåœ¨é€‰æ‹©Springæä¾›çš„é€šçŸ¥ç±»å‹æ—¶ï¼Œå›¢é˜Ÿæ¨èå¼€å‘è€…å°½é‡ä½¿ç”¨ç®€å•çš„é€šçŸ¥ç±»å‹æ¥å®ç°éœ€è¦çš„åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œ å¦‚æœåªæ˜¯éœ€è¦ä½¿ç”¨æ–¹æ³•çš„è¿”å›å€¼æ¥ä½œç¼“å­˜æ›´æ–°ï¼Œè™½ç„¶ä½¿ç”¨ç¯ç»•é€šçŸ¥ä¹Ÿèƒ½å®ŒæˆåŒæ ·çš„äº‹æƒ…ï¼Œä½†æ˜¯ä»ç„¶æ¨èä½¿ç”¨åç½®è¿”å›é€šçŸ¥æ¥ä»£æ›¿ã€‚ä½¿ç”¨æœ€åˆé€‚çš„é€šçŸ¥ç±»å‹å¯ä»¥è®©ç¼–ç¨‹æ¨¡å‹å˜å¾—ç®€å•ï¼Œ è¿˜èƒ½é¿å…å¾ˆå¤šæ½œåœ¨çš„é”™è¯¯ã€‚ä¾‹å¦‚ï¼Œå¼€å‘è€…æ— éœ€è°ƒç”¨äºç¯ç»•é€šçŸ¥ï¼ˆç”¨<code>JoinPoint</code>ï¼‰çš„ <code>proceed()</code>æ–¹æ³•ï¼Œä¹Ÿå°±ä¸ä¼šäº§ç”Ÿè°ƒç”¨çš„é—®é¢˜ã€‚</p><p>åœ¨Spring 2.0ä¸­ï¼Œæ‰€æœ‰é€šçŸ¥å‚æ•°éƒ½æ˜¯é™æ€ç±»å‹çš„ï¼Œå› æ­¤æ‚¨å¯ä»¥ä½¿ç”¨ç›¸åº”ç±»å‹çš„é€šçŸ¥å‚æ•°ï¼ˆä¾‹å¦‚ï¼Œæ–¹æ³•æ‰§è¡Œçš„è¿”å›å€¼çš„ç±»å‹ï¼‰è€Œä¸æ˜¯<code>Object</code>æ•°ç»„ã€‚</p><p>åˆ‡ç‚¹å’Œè¿æ¥ç‚¹åŒ¹é…æ˜¯AOPçš„å…³é”®æ¦‚å¿µï¼Œè¿™ä¸ªæ¦‚å¿µè®©AOPä¸åŒäºå…¶å®ƒä»…ä»…æä¾›æ‹¦æˆªåŠŸèƒ½çš„æ—§æŠ€æœ¯ã€‚åˆ‡å…¥ç‚¹ä½¿å¾—é€šçŸ¥å¯ä»¥ç‹¬ç«‹äºé¢å‘å¯¹è±¡çš„å±‚æ¬¡ç»“æ„è¿›è¡Œå®šå‘ã€‚ ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥å°†ä¸€ä¸ªæä¾›å£°æ˜å¼äº‹åŠ¡ç®¡ç†çš„é€šçŸ¥åº”ç”¨äºè·¨å¤šä¸ªå¯¹è±¡ï¼ˆä¾‹å¦‚æœåŠ¡å±‚ä¸­çš„æ‰€æœ‰ä¸šåŠ¡æ“ä½œï¼‰çš„ä¸€ç»„æ–¹æ³•ã€‚</p><h3 id="2-2-Spring-AOPçš„åŠŸèƒ½å’Œç›®æ ‡"><a href="#2-2-Spring-AOPçš„åŠŸèƒ½å’Œç›®æ ‡" class="headerlink" title="2.2. Spring AOPçš„åŠŸèƒ½å’Œç›®æ ‡"></a>2.2. Spring AOPçš„åŠŸèƒ½å’Œç›®æ ‡</h3><p>Spring AOPæ˜¯ç”¨çº¯Javaå®ç°çš„ã€‚ ä¸éœ€è¦ç‰¹æ®Šçš„ç¼–è¯‘è¿‡ç¨‹ã€‚ Spring AOPä¸éœ€è¦æ§åˆ¶ç±»åŠ è½½å™¨å±‚æ¬¡ç»“æ„ï¼Œå› æ­¤é€‚åˆåœ¨servletå®¹å™¨æˆ–åº”ç”¨ç¨‹åºæœåŠ¡å™¨ä¸­ä½¿ç”¨ã€‚</p><p>Springç›®å‰ä»…æ”¯æŒæ–¹æ³•è°ƒç”¨çš„æ–¹å¼ä½œä¸ºè¿æ¥ç‚¹ï¼ˆåœ¨Spring beanä¸Šé€šçŸ¥æ–¹æ³•çš„æ‰§è¡Œï¼‰ã€‚è™½ç„¶å¯ä»¥åœ¨ä¸å½±å“åˆ°Spring AOPæ ¸å¿ƒAPIçš„æƒ…å†µä¸‹åŠ å…¥å¯¹æˆå‘˜å˜é‡æ‹¦æˆªå™¨æ”¯æŒï¼Œ ä½†Springå¹¶æ²¡æœ‰å®ç°æˆå‘˜å˜é‡æ‹¦æˆªå™¨ã€‚å¦‚æœéœ€è¦é€šçŸ¥å¯¹æˆå‘˜å˜é‡çš„è®¿é—®å’Œæ›´æ–°è¿æ¥ç‚¹ï¼Œå¯ä»¥è€ƒè™‘å…¶å®ƒè¯­è¨€ï¼Œä¾‹å¦‚AspectJã€‚</p><p>Springå®ç°AOPçš„æ–¹æ³•ä¸å…¶ä»–çš„æ¡†æ¶ä¸åŒï¼ŒSpringå¹¶ä¸æ˜¯è¦å°è¯•æä¾›æœ€å®Œæ•´çš„AOPå®ç°ï¼ˆå°½ç®¡Spring AOPæœ‰è¿™ä¸ªèƒ½åŠ›ï¼‰ï¼Œç›¸ååœ°ï¼Œå®ƒå…¶å®ä¾§é‡äºæä¾›ä¸€ç§AOPä¸Spring IoCå®¹å™¨çš„æ•´åˆçš„å®ç°ï¼Œç”¨äºå¸®åŠ©è§£å†³åœ¨ä¼ä¸šçº§å¼€å‘ä¸­çš„å¸¸è§é—®é¢˜ã€‚</p><p>å› æ­¤ï¼Œä¾‹å¦‚ï¼ŒSpring Frameworkçš„AOPåŠŸèƒ½é€šå¸¸ä¸Spring IoCå®¹å™¨ä¸€èµ·ä½¿ç”¨ã€‚é€šè¿‡ä½¿ç”¨æ™®é€šbeanå®šä¹‰è¯­æ³•æ¥é…ç½®åˆ‡é¢ï¼ˆå°½ç®¡Springæä¾›äº†å¼ºå¤§çš„â€œè‡ªåŠ¨ä»£ç†â€åŠŸèƒ½ï¼‰ã€‚ è¿™æ˜¯ä¸å…¶ä»–AOPå®ç°çš„é‡è¦åŒºåˆ«ã€‚ ä½¿ç”¨Spring AOPæ— æ³•è½»æ¾æˆ–é«˜æ•ˆåœ°å®ŒæˆæŸäº›æ“ä½œï¼Œä¾‹å¦‚å»ºè®®éå¸¸ç»†ç²’åº¦çš„å¯¹è±¡ï¼ˆé€šå¸¸æ˜¯åŸŸå¯¹è±¡ï¼‰ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒAspectJæ˜¯æœ€ä½³é€‰æ‹©ã€‚ ä½†æ˜¯ï¼Œæˆ‘ä»¬çš„ç»éªŒæ˜¯ï¼ŒSpring AOPä¸ºé€‚åˆAOPçš„ä¼ä¸šJavaåº”ç”¨ç¨‹åºä¸­çš„å¤§å¤šæ•°é—®é¢˜æä¾›äº†å‡ºè‰²çš„è§£å†³æ–¹æ¡ˆã€‚</p><p>Spring AOPä»æ¥æ²¡æœ‰æ‰“ç®—é€šè¿‡æä¾›ä¸€ç§å…¨é¢çš„AOPè§£å†³æ–¹æ¡ˆç”¨äºå–ä»£AspectJï¼Œæˆ‘ä»¬ç›¸ä¿¡ï¼ŒåŸºäºä»£ç†çš„æ¡†æ¶ï¼ˆå¦‚Spring AOPï¼‰å’Œå®Œæ•´çš„æ¡†æ¶ï¼ˆå¦‚AspectJï¼‰éƒ½å¾ˆæœ‰ä»·å€¼ï¼Œè€Œä¸”å®ƒä»¬æ˜¯äº’è¡¥çš„ï¼Œè€Œä¸æ˜¯ç«äº‰ã€‚ Springå°†Spring AOPå’ŒIoCä¸AspectJæ— ç¼é›†æˆï¼Œä½¿å¾—æ‰€æœ‰çš„AOPåŠŸèƒ½å®Œå…¨èå…¥åŸºäºSpringçš„åº”ç”¨ä½“ç³»ã€‚è¿™æ ·çš„é›†æˆä¸ä¼šå½±å“Spring AOP APIæˆ–è€…AOP Alliance APIã€‚ Spring AOPä»ç„¶å‘åå…¼å®¹ã€‚ æœ‰å…³Spring AOP APIçš„è®¨è®ºï¼Œè¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-api">ä»¥ä¸‹ç« èŠ‚</a>ã€‚</p><p>Springæ¡†æ¶çš„ä¸€ä¸ªæ ¸å¿ƒåŸåˆ™æ˜¯éä¾µå…¥æ€§ã€‚è¿™æ„å‘³ç€å¼€å‘è€…æ— éœ€åœ¨è‡ªèº«çš„ä¸šåŠ¡&#x2F;åŸŸæ¨¡å‹ä¸Šè¢«è¿«å¼•å…¥æ¡†æ¶ç‰¹å®šçš„ç±»å’Œæ¥å£ã€‚ç„¶è€Œï¼Œæœ‰äº›æ—¶å€™ï¼ŒSpringæ¡†æ¶å¯ä»¥è®©å¼€å‘è€…é€‰æ‹©å¼•å…¥Springæ¡†æ¶ç‰¹å®šçš„ä¾èµ–å…³ç³»åˆ°ä¸šåŠ¡ä»£ç ã€‚ ç»™äºˆè¿™ç§é€‰æ‹©çš„ç†ç”±æ˜¯å› ä¸ºåœ¨æŸäº›æƒ…å†µä¸‹å®ƒå¯èƒ½æ˜¯æ›´æ˜“è¯»æˆ–æ˜“äºç¼–å†™æŸäº›ç‰¹å®šåŠŸèƒ½ã€‚Springæ¡†æ¶ï¼ˆå‡ ä¹ï¼‰æ€»èƒ½ç»™å‡ºè¿™æ ·çš„é€‰æ‹©ï¼Œå¼€å‘è€…å¯ä»¥è‡ªç”±åœ°åšå‡ºæ˜æ™ºçš„å†³å®šï¼Œé€‰æ‹©æœ€é€‚åˆçš„ç‰¹å®šç”¨ä¾‹æˆ–åœºæ™¯ã€‚</p><p>ä¸æœ¬ç« ç›¸å…³çš„ä¸€ä¸ªé€‰æ‹©æ˜¯é€‰æ‹©å“ªç§AOPæ¡†æ¶ï¼ˆä»¥åŠå“ªç§AOPæ ·å¼ï¼‰ã€‚æ‚¨å¯ä»¥é€‰æ‹©AspectJï¼ŒSpring AOPæˆ–ä¸¤è€…ã€‚ä¹Ÿå¯ä»¥é€‰æ‹©@AspectJæ³¨è§£å¼çš„æ–¹æ³•æˆ–Springçš„XMLé…ç½®æ–¹å¼ã€‚ äº‹å®ä¸Šï¼Œæœ¬ç« ä»¥ä»‹ç»@AspectJæ–¹å¼ä¸ºå…ˆä¸åº”è¯¥è¢«è§†ä¸ºSpringå›¢é˜Ÿå€¾å‘äº@AspectJçš„æ–¹å¼èƒœè¿‡Springçš„XMLé…ç½®æ–¹å¼ã€‚</p><p>è¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-choosing">é€‰æ‹©è¦ä½¿ç”¨çš„AOPå£°æ˜æ ·å¼</a>ï¼Œä»¥æ›´å…¨é¢åœ°è®¨è®ºæ¯ç§æ ·å¼çš„â€œä¸ºä»€ä¹ˆå’Œå¦‚ä½•è¿›è¡Œâ€ã€‚</p><h3 id="2-3-AOP-ä»£ç†"><a href="#2-3-AOP-ä»£ç†" class="headerlink" title="2.3. AOP ä»£ç†"></a>2.3. AOP ä»£ç†</h3><p>Springé»˜è®¤ä½¿ç”¨æ ‡å‡†çš„JDKåŠ¨æ€ä»£ç†æ¥ä½œä¸ºAOPçš„ä»£ç†ã€‚è¿™æ ·ä»»ä½•æ¥å£ï¼ˆæˆ–è€…æ¥å£çš„setï¼‰éƒ½å¯ä»¥è¢«ä»£ç†ã€‚</p><p>Springä¹Ÿæ”¯æŒä½¿ç”¨CGLIBä»£ç†ã€‚å¯¹äºéœ€è¦ä»£ç†ç±»è€Œä¸æ˜¯ä»£ç†æ¥å£çš„æ—¶å€™CGLIBä»£ç†æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚å¦‚æœä¸šåŠ¡å¯¹è±¡å¹¶æ²¡æœ‰å®ç°æ¥å£ï¼Œé»˜è®¤å°±ä¼šä½¿ç”¨CGLIBä»£ç† ã€‚æ­¤å¤–ï¼Œé¢å‘æ¥å£ç¼–ç¨‹ä¹Ÿæ˜¯æœ€ä½³å®è·µï¼Œä¸šåŠ¡å¯¹è±¡é€šå¸¸éƒ½ä¼šå®ç°ä¸€ä¸ªæˆ–å¤šä¸ªæ¥å£ã€‚æ­¤å¤–ï¼Œè¿˜å¯ä»¥<a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-proxying">å¼ºåˆ¶çš„ä½¿ç”¨CGLIBä»£ç†</a>ï¼Œ åœ¨é‚£äº›ï¼ˆå¸Œæœ›æ˜¯ç½•è§çš„ï¼‰éœ€è¦é€šçŸ¥æ²¡æœ‰åœ¨æ¥å£ä¸­å£°æ˜çš„æ–¹æ³•æ—¶ï¼Œæˆ–è€…å½“éœ€è¦ä¼ é€’ä¸€ä¸ªä»£ç†å¯¹è±¡ä½œä¸ºä¸€ç§å…·ä½“ç±»å‹åˆ°æ–¹æ³•çš„æƒ…å†µä¸‹ã€‚</p><p>æŒæ¡Spring AOPæ˜¯åŸºäºä»£ç†çš„è¿™ä¸€äº‹å®éå¸¸é‡è¦ã€‚ è¯·å‚é˜… <a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-understanding-aop-proxies">AOPä»£ç†</a>ï¼Œä»¥å…¨é¢äº†è§£æ­¤å®ç°ç»†èŠ‚çš„å®é™…å«ä¹‰ã€‚.</p><h3 id="2-4-AspectJæ³¨è§£æ”¯æŒ"><a href="#2-4-AspectJæ³¨è§£æ”¯æŒ" class="headerlink" title="2.4.@AspectJæ³¨è§£æ”¯æŒ"></a>2.4.@AspectJæ³¨è§£æ”¯æŒ</h3><p>@AspectJä¼šå°†åˆ‡é¢å£°æ˜ä¸ºå¸¸è§„Javaç±»çš„æ³¨è§£ç±»å‹ã€‚ <a href="https://www.eclipse.org/aspectj">AspectJé¡¹ç›®</a>å¼•å…¥äº†@AspectJé£æ ¼ï¼Œå¹¶ä½œä¸ºAspectJ 5å‘è¡Œç‰ˆçš„ä¸€éƒ¨åˆ†ã€‚Springä½¿ç”¨çš„æ³¨è§£ç±»ä¼¼äºAspectJ 5ï¼Œ ä½¿ç”¨AspectJæä¾›çš„åº“ç”¨æ¥è§£æå’ŒåŒ¹é…åˆ‡ç‚¹ã€‚AOPè¿è¡Œæ—¶ä»ç„¶æ˜¯çº¯ç²¹çš„Spring AOPï¼Œå¹¶ä¸ä¾èµ–AspectJç¼–è¯‘å™¨æˆ–ç¼–ç»‡å™¨ã€‚</p><p>ä½¿ç”¨AspectJç¼–è¯‘å™¨å’Œç»‡å…¥å¹¶å…è®¸ä½¿ç”¨å…¨éƒ¨åŸºäºAspectJè¯­è¨€ï¼Œå¹¶åœ¨<a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-using-aspectj">Using AspectJ with Spring Applications</a>è¿›è¡Œäº†è®¨è®ºã€‚</p><h4 id="2-4-1-å…è®¸-AspectJçš„æ”¯æŒ"><a href="#2-4-1-å…è®¸-AspectJçš„æ”¯æŒ" class="headerlink" title="2.4.1. å…è®¸@AspectJçš„æ”¯æŒ"></a>2.4.1. å…è®¸@AspectJçš„æ”¯æŒ</h4><p>è¦åœ¨Springé…ç½®ä¸­ä½¿ç”¨@AspectJåˆ‡é¢ï¼Œéœ€è¦å¯ç”¨Springæ”¯æŒï¼Œç”¨äºæ ¹æ®@AspectJåˆ‡é¢é…ç½®Spring AOPï¼Œå¹¶æ ¹æ®è¿™äº›åˆ‡é¢è‡ªåŠ¨ä»£ç†beanï¼ˆäº‹å…ˆåˆ¤æ–­æ˜¯å¦åœ¨é€šçŸ¥çš„èŒƒå›´å†…ï¼‰ã€‚ é€šè¿‡è‡ªåŠ¨ä»£ç†çš„æ„æ€æ˜¯ï¼šå¦‚æœSpringç¡®å®šä¸€ä¸ªbeanæ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªåˆ‡é¢å¤„ç†çš„ï¼Œå°†æ®æ­¤ä¸ºbeanè‡ªåŠ¨ç”Ÿæˆä»£ç†beanï¼Œå¹¶ä»¥æ‹¦æˆªæ–¹æ³•è°ƒç”¨å¹¶ç¡®ä¿éœ€è¦æ‰§è¡Œçš„é€šçŸ¥ã€‚</p><p>å¯ä»¥ä½¿ç”¨XMLæˆ–Javaé…ç½®çš„æ–¹å¼å¯ç”¨@AspectJæ”¯æŒã€‚ä¸ç®¡å“ªä¸€ç§æ–¹å¼ï¼Œæ‚¨è¿˜éœ€è¦ç¡®ä¿AspectJçš„<code>aspectjweaver.jar</code>åº“ä½äºåº”ç”¨ç¨‹åºçš„ç±»è·¯å¾„ä¸­ï¼ˆç‰ˆæœ¬1.8æˆ–æ›´é«˜ç‰ˆæœ¬ï¼‰ã€‚æ­¤åº“å¯åœ¨AspectJåˆ†å‘çš„<code>lib</code> ç›®å½•ä¸­æˆ–Maven Centralå­˜å‚¨åº“ä¸­æ‰¾åˆ°ã€‚</p><h5 id="ä½¿ç”¨Javaé…ç½®å¯ç”¨-AspectJæ”¯æŒ"><a href="#ä½¿ç”¨Javaé…ç½®å¯ç”¨-AspectJæ”¯æŒ" class="headerlink" title="ä½¿ç”¨Javaé…ç½®å¯ç”¨@AspectJæ”¯æŒ"></a>ä½¿ç”¨Javaé…ç½®å¯ç”¨@AspectJæ”¯æŒ</h5><p>è¦ä½¿ç”¨Java <code>@Configuration</code>å¯ç”¨@AspectJæ”¯æŒï¼Œè¯·æ·»åŠ  <code>@EnableAspectJAutoProxy</code>æ³¨è§£ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Configuration</span><span class="hljs-variable">@EnableAspectJAutoProxypublic</span> class AppConfig &#123;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="ä½¿ç”¨XMLé…ç½®å¯ç”¨-AspectJæ”¯æŒ"><a href="#ä½¿ç”¨XMLé…ç½®å¯ç”¨-AspectJæ”¯æŒ" class="headerlink" title="ä½¿ç”¨XMLé…ç½®å¯ç”¨@AspectJæ”¯æŒ"></a>ä½¿ç”¨XMLé…ç½®å¯ç”¨@AspectJæ”¯æŒ</h5><p>è¦ä½¿ç”¨åŸºäºXMLçš„é…ç½®å¯ç”¨@AspectJæ”¯æŒï¼Œè¯·ä½¿ç”¨ <code>aop:aspectj-autoproxy</code>å…ƒç´ ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">&lt;aop:aspectj-<span class="hljs-built_in">auto</span>proxy/&gt;<br></code></pre></td></tr></table></figure><p>è¿™å‡è®¾æ‚¨ä½¿ç”¨<a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#xsd-schemas">XML Schema-based configuration</a>ä¸­æè¿°çš„schemaæ”¯æŒã€‚ æœ‰å…³å¦‚ä½•åœ¨aopå‘½åç©ºé—´ä¸­å¯¼å…¥æ ‡è®°ï¼Œè¯·å‚é˜… <a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#xsd-schemas-aop">åœ¨<code>aop</code>aopå‘½åç©ºé—´ä¸­å¯¼å…¥æ ‡è®°</a>ã€‚</p><h4 id="2-4-2-å£°æ˜åˆ‡é¢"><a href="#2-4-2-å£°æ˜åˆ‡é¢" class="headerlink" title="2.4.2. å£°æ˜åˆ‡é¢"></a>2.4.2. å£°æ˜åˆ‡é¢</h4><p>å¯ç”¨äº†@AspectJæ”¯æŒåï¼Œåœ¨åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­å®šä¹‰çš„ä»»æ„beanï¼ˆæœ‰<code>@Aspect</code>æ³¨è§£ï¼‰çš„ç±»éƒ½å°†è¢«Springè‡ªåŠ¨æ£€æµ‹ï¼Œå¹¶ç”¨äºé…ç½®Spring AOPã€‚ æ¥ä¸‹æ¥çš„ä¸¤ä¸ªç¤ºä¾‹æ˜¾ç¤ºäº†éå¸¸æœ‰ç”¨çš„æ–¹é¢æ‰€éœ€çš„æœ€å°å®šä¹‰ã€‚</p><p>è¿™ä¸¤ä¸ªç¤ºä¾‹ä¸­çš„ç¬¬ä¸€ä¸ªç¤ºä¾‹åœ¨åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­æ˜¾ç¤ºäº†ä¸€ä¸ªå¸¸è§„beanå®šä¹‰ï¼Œè¯¥å®šä¹‰æŒ‡å‘å…·æœ‰<code>@Aspect</code>æ³¨è§£çš„beanç±»ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;myAspect&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.xyz.NotVeryUsefulAspect&quot;</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- configure properties of the aspect here --&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p>è¿™ä¸¤ä¸ªç¤ºä¾‹ä¸­çš„ç¬¬äºŒä¸ªæ˜¾ç¤ºäº†<code>NotVeryUsefulAspect</code>ç±»å®šä¹‰ï¼Œè¯¥å®šä¹‰ä½¿ç”¨ <code>org.aspectj.lang.annotation.Aspect</code> æ³¨è§£è¿›è¡Œæ³¨è§£;</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">package</span> org.xyz;<span class="hljs-keyword">import</span> org.aspectj.lang.<span class="hljs-keyword">annotation</span>.Aspect;<br><span class="hljs-meta">@Aspectpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NotVeryUsefulAspect</span> &#123;<br>&#125;<br></code></pre></td></tr></table></figure><p>åˆ‡é¢ï¼ˆä½¿ç”¨ <code>@Aspect</code>çš„ç±»ï¼‰å¯ä»¥æ‹¥æœ‰æ–¹æ³•å’Œå±æ€§ï¼Œä¸å…¶ä»–ç±»å¹¶æ— ä¸åŒã€‚ä¹Ÿå¯ä»¥åŒ…æ‹¬åˆ‡ç‚¹ã€é€šçŸ¥å’Œå†…ç½®ç±»å‹ï¼ˆå³å¼•å…¥ï¼‰å£°æ˜ã€‚</p><p>é€šè¿‡ç»„ä»¶æ‰«æè‡ªåŠ¨æ£€æµ‹åˆ‡é¢</p><p>æ‚¨å¯ä»¥åœ¨Spring XMLé…ç½®ä¸­å°†åˆ‡é¢ç±»æ³¨å†Œä¸ºå¸¸è§„beanï¼Œæˆ–è€…é€šè¿‡ç±»è·¯å¾„æ‰«æè‡ªåŠ¨æ£€æµ‹å®ƒä»¬ - ä¸ä»»ä½•å…¶ä»–Springç®¡ç†çš„beanç›¸åŒã€‚ç„¶è€Œæ³¨æ„åˆ°<code>@Aspect</code>æ³¨è§£å¯¹äºç±»çš„è‡ªåŠ¨æ¢æµ‹æ˜¯ä¸å¤Ÿçš„ï¼Œ ä¸ºæ­¤ï¼Œéœ€è¦å•ç‹¬æ·»åŠ <code>@Component</code> ï¼Œæ³¨è§£ï¼ˆæˆ–è‡ªå®šä¹‰æ³¨è§£å£°æ˜ï¼Œç”¨ä½œSpringç»„ä»¶æ‰«æå™¨çš„è§„åˆ™ä¹‹ä¸€ï¼‰ã€‚</p><p>æ˜¯å¦å¯ä»¥ä½œä¸ºå…¶ä»–åˆ‡é¢çš„åˆ‡é¢é€šçŸ¥?</p><p>åœ¨Spring AOPä¸­ï¼Œä¸å¯èƒ½å°†åˆ‡é¢æœ¬èº«è¢«ä½œä¸ºå…¶ä»–åˆ‡é¢çš„ç›®æ ‡ã€‚ç±»ä¸Šçš„<code>@Aspect</code>æ³¨è§£è¡¨æ˜ä»–æ˜¯ä¸€ä¸ªåˆ‡é¢å¹¶ä¸”æ’é™¤åœ¨è‡ªåŠ¨ä»£ç†çš„èŒƒå›´ä¹‹å¤–ã€‚</p><h4 id="2-4-3-å£°æ˜åˆ‡ç‚¹"><a href="#2-4-3-å£°æ˜åˆ‡ç‚¹" class="headerlink" title="2.4.3. å£°æ˜åˆ‡ç‚¹"></a>2.4.3. å£°æ˜åˆ‡ç‚¹</h4><p>åˆ‡ç‚¹å†³å®šäº†åŒ¹é…çš„è¿æ¥ç‚¹ï¼Œä»è€Œä½¿æˆ‘ä»¬èƒ½å¤Ÿæ§åˆ¶é€šçŸ¥ä½•æ—¶æ‰§è¡Œã€‚Spring AOPåªæ”¯æŒä½¿ç”¨Spring beançš„æ–¹æ³•æ‰§è¡Œè¿æ¥ç‚¹ï¼Œæ‰€ä»¥å¯ä»¥å°†åˆ‡ç‚¹çœ‹å‡ºæ˜¯åŒ¹é…Spring beanä¸Šæ–¹æ³•çš„æ‰§è¡Œã€‚ åˆ‡ç‚¹çš„å£°æ˜åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼šåŒ…å«åç§°å’Œä»»æ„å‚æ•°çš„ç­¾åï¼Œä»¥åŠæ˜ç¡®éœ€è¦åŒ¹é…çš„æ–¹å¼æ‰§è¡Œçš„åˆ‡ç‚¹è¡¨è¾¾å¼ã€‚åœ¨@AspectJæ³¨è§£æ–¹å¼çš„AOPä¸­ï¼Œä¸€ä¸ªåˆ‡ç‚¹çš„ç­¾åç”±å¸¸è§„æ–¹æ³•å®šä¹‰æ¥æä¾›ï¼Œ å¹¶ä¸”åˆ‡ç‚¹è¡¨è¾¾å¼ä½¿ç”¨ <code>@Pointcut</code>æ³¨è§£æŒ‡å®šï¼ˆæ–¹æ³•ä½œä¸ºåˆ‡ç‚¹ç­¾åå¿…é¡»æœ‰ç±»å‹ä¸º<code>void</code>çš„è¿”å›ï¼‰ã€‚</p><p>ä½¿ç”¨ä¾‹å­æœ‰åŠ©äºæ›´å¥½åœ°åŒºåˆ†åˆ‡ç‚¹ç­¾åå’Œåˆ‡ç‚¹è¡¨è¾¾å¼ä¹‹é—´çš„å…³ç³»ã€‚ä»¥ä¸‹ç¤ºä¾‹å®šä¹‰åä¸ºnamed <code>anyOldTransfer</code>çš„åˆ‡ç‚¹ï¼Œè¯¥åˆ‡ç‚¹ä¸åä¸º<code>transfer</code>çš„ä»»ä½•æ–¹æ³•çš„æ‰§è¡Œç›¸åŒ¹é…ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Pointcut(&quot;execution(* transfer(..))&quot;)</span><span class="hljs-comment">// the pointcut expression</span><br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">anyOldTransfer</span><span class="hljs-params">()</span> &#123;&#125;<span class="hljs-comment">// the pointcut signature</span><br></code></pre></td></tr></table></figure><p>åˆ‡ç‚¹è¡¨è¾¾å¼ç”±<code>@Pointcut</code> æ³¨è§£çš„å€¼æ˜¯å¸¸è§„çš„AspectJ 5åˆ‡ç‚¹è¡¨è¾¾å¼ã€‚å…³äºAspectJåˆ‡ç‚¹è¯­è¨€çš„æè¿°ï¼Œè§ <a href="https://www.eclipse.org/aspectj/doc/released/progguide/index.html">AspectJçš„ç¼–ç¨‹æŒ‡å—</a> ï¼ˆä½œä¸ºæ‰©å±•ï¼Œ è¯·å‚è€ƒ<a href="https://www.eclipse.org/aspectj/doc/released/adk15notebook/index.html">AspectJ 5 Developerâ€™s Notebook</a>ï¼‰æˆ–è€…Colyerè‘—çš„å…³äºAspectJçš„ä¹¦ç±ã€‚ ä¾‹å¦‚ï¼Œ<em>Eclipse AspectJ</em>ï¼Œæˆ–è€…å‚çœ‹Ramnivas Laddadçš„_AspectJ in Action_ã€‚</p><h5 id="æ”¯æŒåˆ‡ç‚¹æ ‡è¯†ç¬¦"><a href="#æ”¯æŒåˆ‡ç‚¹æ ‡è¯†ç¬¦" class="headerlink" title="æ”¯æŒåˆ‡ç‚¹æ ‡è¯†ç¬¦"></a>æ”¯æŒåˆ‡ç‚¹æ ‡è¯†ç¬¦</h5><p>Spring AOPæ”¯æŒä½¿ç”¨ä»¥ä¸‹AspectJåˆ‡ç‚¹æ ‡è¯†ç¬¦(PCD),ç”¨äºåˆ‡ç‚¹è¡¨è¾¾å¼ï¼š</p><ul><li><code>execution</code>: ç”¨äºåŒ¹é…æ–¹æ³•æ‰§è¡Œè¿æ¥ç‚¹ã€‚ è¿™æ˜¯ä½¿ç”¨Spring AOPæ—¶ä½¿ç”¨çš„ä¸»è¦åˆ‡ç‚¹æ ‡è¯†ç¬¦ã€‚</li><li><code>within</code>: é™åˆ¶åŒ¹é…ç‰¹å®šç±»å‹ä¸­çš„è¿æ¥ç‚¹ï¼ˆåœ¨ä½¿ç”¨Spring AOPæ—¶ï¼Œåªéœ€æ‰§è¡Œåœ¨åŒ¹é…ç±»å‹ä¸­å£°æ˜çš„æ–¹æ³•ï¼‰ã€‚</li><li><code>this</code>: åœ¨beanå¼•ç”¨ï¼ˆSpring AOPä»£ç†ï¼‰æ˜¯ç»™å®šç±»å‹çš„å®ä¾‹çš„æƒ…å†µä¸‹ï¼Œé™åˆ¶åŒ¹é…è¿æ¥ç‚¹ï¼ˆä½¿ç”¨Spring AOPæ—¶æ–¹æ³•çš„æ‰§è¡Œï¼‰ã€‚</li><li><code>target</code>: é™åˆ¶åŒ¹é…åˆ°è¿æ¥ç‚¹ï¼ˆä½¿ç”¨Spring AOPæ—¶æ–¹æ³•çš„æ‰§è¡Œï¼‰ï¼Œå…¶ä¸­ç›®æ ‡å¯¹è±¡ï¼ˆæ­£åœ¨ä»£ç†çš„åº”ç”¨ç¨‹åºå¯¹è±¡ï¼‰æ˜¯ç»™å®šç±»å‹çš„å®ä¾‹ã€‚</li><li><code>args</code>: é™åˆ¶ä¸è¿æ¥ç‚¹çš„åŒ¹é…ï¼ˆä½¿ç”¨Spring AOPæ—¶æ–¹æ³•çš„æ‰§è¡Œï¼‰ï¼Œå…¶ä¸­å˜é‡æ˜¯ç»™å®šç±»å‹çš„å®ä¾‹ã€‚ AOP) where the arguments are instances of the given types.</li><li><code>@target</code>: é™åˆ¶ä¸è¿æ¥ç‚¹çš„åŒ¹é…ï¼ˆä½¿ç”¨Spring AOPæ—¶æ–¹æ³•çš„æ‰§è¡Œï¼‰ï¼Œå…¶ä¸­æ‰§è¡Œå¯¹è±¡çš„ç±»å…·æœ‰ç»™å®šç±»å‹çš„æ³¨è§£ã€‚</li><li><code>@args</code>: é™åˆ¶åŒ¹é…è¿æ¥ç‚¹ï¼ˆä½¿ç”¨Spring AOPæ—¶æ–¹æ³•çš„æ‰§è¡Œï¼‰ï¼Œå…¶ä¸­ä¼ é€’çš„å®é™…å‚æ•°çš„è¿è¡Œæ—¶ç±»å‹å…·æœ‰ç»™å®šç±»å‹çš„æ³¨è§£ã€‚</li><li><code>@within</code>: é™åˆ¶ä¸å…·æœ‰ç»™å®šæ³¨è§£çš„ç±»å‹ä¸­çš„è¿æ¥ç‚¹åŒ¹é…ï¼ˆä½¿ç”¨Spring AOPæ—¶åœ¨å…·æœ‰ç»™å®šæ³¨è§£çš„ç±»å‹ä¸­å£°æ˜çš„æ–¹æ³•çš„æ‰§è¡Œï¼‰ã€‚</li><li><code>@annotation</code>:é™åˆ¶åŒ¹é…è¿æ¥ç‚¹ï¼ˆåœ¨Spring AOPä¸­æ‰§è¡Œçš„æ–¹æ³•å…·æœ‰ç»™å®šçš„æ³¨è§£ï¼‰ã€‚</li></ul><p>å…¶ä»–åˆ‡ç‚¹ç±»å‹</p><p>Springå¹¶æ²¡æœ‰å®Œå…¨åœ°æ”¯æŒAspectJåˆ‡ç‚¹è¯­è¨€å£°æ˜çš„åˆ‡ç‚¹æ ‡è¯†ç¬¦ï¼ŒåŒ…æ‹¬ <code>call</code>, <code>get</code>, <code>set</code>, <code>preinitialization</code>, <code>staticinitialization</code>, <code>initialization</code>, <code>handler</code>, <code>adviceexecution</code>, <code>withincode</code>, <code>cflow</code>, <code>cflowbelow</code>, <code>if</code>, <code>@this</code>, å’Œ <code>@withincode</code>ã€‚åœ¨ç”±Spring AOPè§£é‡Šçš„åˆ‡ç‚¹è¡¨è¾¾å¼ä¸­ï¼Œä½¿ç”¨è¿™äº›åˆ‡ç‚¹æ ‡è¯†ç¬¦å°†å¯¼è‡´<code>IllegalArgumentException</code>å¼‚å¸¸ã€‚</p><p>Spring AOPæ”¯æŒçš„åˆ‡ç‚¹æ ‡è¯†ç¬¦å¯ä»¥åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­æ‰©å±•ï¼Œä»¥æ”¯æŒæ›´å¤šçš„AspectJåˆ‡ç‚¹æ ‡è¯†ç¬¦ã€‚</p><p>å› ä¸ºSpring AOPé™åˆ¶äº†åªåŒ¹é…æ–¹æ³•çš„è¿æ¥ç‚¹æ‰§è¡Œï¼Œæ‰€ä»¥ä¸Šé¢çš„åˆ‡ç‚¹æ ‡è¯†ç¬¦çš„è®¨è®ºæ¯”åœ¨AspectJç¼–ç¨‹æŒ‡å—ä¸­æ‰¾åˆ°çš„å®šä¹‰è¦çª„ã€‚å¦å¤–ï¼ŒAspectJæœ¬èº«å…·æœ‰åŸºäºç±»å‹çš„è¯­ä¹‰ï¼Œ å¹¶ä¸”åœ¨æ‰§è¡Œè¿æ¥ç‚¹ä¸Šï¼Œ<code>this</code>å’Œ<code>target</code>éƒ½æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡-å³æ‰§è¡Œæ–¹æ³•çš„å¯¹è±¡ã€‚Spring AOPæ˜¯ä¸€ä¸ªåŸºäºä»£ç†çš„ç³»ç»Ÿï¼ŒåŒºåˆ†ä»£ç†å¯¹è±¡æœ¬èº«ï¼ˆç»‘å®šåˆ°<code>this</code>ï¼‰å’Œä»£ç†ï¼ˆç»‘å®šåˆ°<code>target</code>ï¼‰åçš„ç›®æ ‡å¯¹è±¡ã€‚</p><p>ç”±äºSpring AOPæ¡†æ¶æ˜¯åŸºäºä»£ç†çš„ç‰¹æ€§ï¼Œå®šä¹‰çš„protectedæ–¹æ³•å°†ä¸ä¼šè¢«å¤„ç†ï¼Œä¸ç®¡æ˜¯JDKçš„ä»£ç†ï¼ˆåšä¸åˆ°ï¼‰è¿˜æ˜¯CGLIBä»£ç†ï¼ˆæœ‰æŠ€æœ¯å¯ä»¥å®ç°ä½†æ˜¯ä¸å»ºè®®ï¼‰ã€‚ å› æ­¤ï¼Œä»»ä½•ç»™å®šçš„åˆ‡ç‚¹å°†åªèƒ½ä¸publicæ–¹æ³•åŒ¹é…ã€‚</p><p>è¯·æ³¨æ„ï¼Œåˆ‡ç‚¹å®šä¹‰é€šå¸¸ä¸ä»»ä½•æˆªè·çš„æ–¹æ³•åŒ¹é…ã€‚ å¦‚æœåˆ‡ç‚¹ä¸¥æ ¼æ„ä¹‰ä¸Šæ˜¯å…¬å¼€çš„ï¼Œå³ä½¿åœ¨é€šè¿‡ä»£ç†è¿›è¡Œæ½œåœ¨éå…¬å…±äº¤äº’çš„CGLIBä»£ç†æ–¹æ¡ˆä¸­ï¼Œä¹Ÿéœ€è¦ç›¸åº”åœ°å®šä¹‰åˆ‡ç‚¹ã€‚</p><p>å¦‚æœéœ€è¦æ‹¦æˆªåŒ…æ‹¬protectedå’Œprivateæ–¹æ³•ç”šè‡³æ˜¯æ„é€ å‡½æ•°ï¼Œè¯·è€ƒè™‘ä½¿ç”¨åŸºäºSpringé©±åŠ¨çš„<a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-aj-ltw">æœ¬åœ°AspectJç¼–ç»‡</a>è€Œä¸æ˜¯Springçš„åŸºäºä»£ç†çš„AOPæ¡†æ¶ã€‚ è¿™æ„æˆäº†ä¸åŒç‰¹æ€§çš„AOPä½¿ç”¨æ¨¡å¼ï¼Œæ‰€ä»¥åœ¨åšå‡ºå†³å®šä¹‹å‰ä¸€å®šè¦å…ˆç†Ÿæ‚‰ä¸€ä¸‹ç¼–ç»‡ã€‚</p><p>Spring AOPæ”¯æŒæ›´å¤šçš„PCDå‘½å<code>bean</code>ã€‚PCDå…è®¸å°†è¿æ¥ç‚¹çš„åŒ¹é…é™åˆ¶ä¸ºç‰¹å®šçš„Spring beanæˆ–ä¸€ç³»åˆ—Spring beanã€‚ <code>bean</code> PCDå…·æœ‰ä»¥ä¸‹å½¢å¼ï¼š:</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">bean</span><span class="hljs-params">(idOrNameOfBean)</span></span><br></code></pre></td></tr></table></figure><p><code>idOrNameOfBean</code>æ ‡è¯†å¯ä»¥æ˜¯ä»»æ„ç¬¦åˆSpring beançš„åå­—ï¼Œ æä¾›äº†ä½¿ç”¨<code>*</code>å­—ç¬¦çš„æœ‰é™é€šé…ç¬¦æ”¯æŒï¼Œå› æ­¤ï¼Œå¦‚æœä¸ºSpring beanå»ºç«‹äº†ä¸€äº›å‘½åçº¦å®šï¼Œåˆ™å¯ä»¥ç¼–å†™<code>bean</code> PCDè¡¨è¾¾å¼æ¥é€‰æ‹©å®ƒä»¬ã€‚ ä¸å…¶ä»–åˆ‡ç‚¹æ ‡è¯†ç¬¦çš„æƒ…å†µä¸€æ ·ï¼ŒPCD beanå¯ä»¥æ˜¯<code>&amp;&amp;</code> (and), <code>||</code> (or), and <code>!</code>ã€‚</p><p><code>bean</code> PCDä»…åœ¨Spring AOPä¸­å—æ”¯æŒï¼Œè€Œåœ¨æœ¬æœºAspectJç¼–ç»‡ä¸­ä¸å—æ”¯æŒã€‚ å®ƒæ˜¯AspectJå®šä¹‰çš„æ ‡å‡†PCDçš„Springç‰¹å®šæ‰©å±•ï¼Œå› æ­¤ä¸é€‚ç”¨äº <code>@Aspect</code> æ¨¡å‹ä¸­å£°æ˜çš„åˆ‡é¢ã€‚</p><p>PCD <code>bean</code>è¿è¡Œåœ¨å®ä¾‹çº§åˆ«ä¸Šï¼ˆåŸºäºSpring beanåç§°æ¦‚å¿µæ„å»ºï¼‰ï¼Œè€Œä¸æ˜¯ä»…åœ¨ç±»å‹çº§åˆ«ï¼ˆè¿™æ˜¯åŸºäºç¼–ç»‡çš„AOPæ‰€é™åˆ¶çš„ï¼‰ã€‚ åŸºäºå®ä¾‹çš„åˆ‡ç‚¹æ ‡è¯†ç¬¦æ˜¯SpringåŸºäºä»£ç†çš„AOPæ¡†æ¶çš„ç‰¹æ®ŠåŠŸèƒ½ï¼Œå®ƒä¸Spring beanå·¥å‚ç´§å¯†é›†æˆï¼Œé€šè¿‡åç§°è¯†åˆ«ç‰¹å®šçš„beanæ˜¯è‡ªç„¶è€Œç›´æ¥çš„ã€‚</p><h5 id="åˆå¹¶åˆ‡ç‚¹è¡¨è¾¾å¼"><a href="#åˆå¹¶åˆ‡ç‚¹è¡¨è¾¾å¼" class="headerlink" title="åˆå¹¶åˆ‡ç‚¹è¡¨è¾¾å¼"></a>åˆå¹¶åˆ‡ç‚¹è¡¨è¾¾å¼</h5><p>æ‚¨å¯ä»¥ä½¿ç”¨ <code>&amp;&amp;,</code> <code>||</code> å’Œ <code>!</code>ç­‰ç¬¦å·è¿›è¡Œåˆå¹¶æ“ä½œã€‚ä¹Ÿå¯ä»¥é€šè¿‡åå­—æ¥æŒ‡å‘åˆ‡ç‚¹è¡¨è¾¾å¼ã€‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†ä¸‰ä¸ªåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Pointcut</span>(<span class="hljs-string">&quot;execution(public * *(..))&quot;</span>)private void <span class="hljs-built_in">anyPublicOperation</span>() &#123;&#125; (<span class="hljs-number">1</span>)<br><span class="hljs-variable">@Pointcut</span>(<span class="hljs-string">&quot;within(com.xyz.someapp.trading..*)&quot;</span>)private void <span class="hljs-built_in">inTrading</span>() &#123;&#125; (<span class="hljs-number">2</span>)<br><span class="hljs-variable">@Pointcut</span>(<span class="hljs-string">&quot;anyPublicOperation() &amp;&amp; inTrading()&quot;</span>)private void <span class="hljs-built_in">tradingOperation</span>() &#123;&#125; (<span class="hljs-number">3</span>)<br></code></pre></td></tr></table></figure><p><strong>(1)ã€‚</strong><code>anyPublicOperation</code>ï¼šå¦‚æœæ–¹æ³•æ‰§è¡Œè¿æ¥ç‚¹è¡¨ç¤ºä»»ä½•å…¬å…±æ–¹æ³•çš„æ‰§è¡Œï¼Œåˆ™åŒ¹é…</p><p><strong>(2)ã€‚</strong><code>inTrading</code> ï¼šå¦‚æœæ–¹æ³•æ‰§è¡Œåœ¨tradingä¸­ï¼Œåˆ™åŒ¹é….</p><p><strong>(3)ã€‚</strong><code>tradingOperation</code> ï¼šå¦‚æœæ–¹æ³•æ‰§è¡Œè¡¨ç¤ºtradingä¸­çš„ä»»ä½•å…¬å…±æ–¹æ³•ï¼Œåˆ™åŒ¹é…ã€‚</p><p>å¦‚ä¸Šæ‰€ç¤ºï¼Œç”¨æ›´å°çš„å‘½åç»„ä»¶æ„å»ºæ›´å¤æ‚çš„åˆ‡å…¥ç‚¹è¡¨è¾¾å¼æ˜¯æœ€ä½³å®è·µã€‚å½“æŒ‰åç§°å¼•ç”¨åˆ‡ç‚¹æ—¶ï¼Œå°†åº”ç”¨æ™®é€šçš„Javaå¯è§æ€§è§„åˆ™ï¼ˆå¯ä»¥çœ‹åˆ°ç›¸åŒç±»å‹çš„ç§æœ‰åˆ‡ç‚¹ï¼Œå±‚æ¬¡ç»“æ„ä¸­å—ä¿æŠ¤çš„åˆ‡ç‚¹ï¼Œä»»ä½•ä½ç½®çš„å…¬å…±åˆ‡ç‚¹ç­‰ï¼‰ã€‚å¯è§æ€§å¹¶ä¸å½±å“åˆ‡ç‚¹åŒ¹é…ã€‚</p><h5 id="å…±äº«é€šç”¨çš„åˆ‡ç‚¹å®šä¹‰"><a href="#å…±äº«é€šç”¨çš„åˆ‡ç‚¹å®šä¹‰" class="headerlink" title="å…±äº«é€šç”¨çš„åˆ‡ç‚¹å®šä¹‰"></a>å…±äº«é€šç”¨çš„åˆ‡ç‚¹å®šä¹‰</h5><p>åœ¨å¤„ç†ä¼ä¸šåº”ç”¨ç¨‹åºæ—¶ï¼Œé€šå¸¸éœ€è¦ä»å‡ ä¸ªåˆ‡é¢æ¥å¼•ç”¨åº”ç”¨ç¨‹åºçš„æ¨¡å—å’Œç‰¹å®šçš„æ“ä½œé›†ã€‚å»ºè®®å®šä¹‰ä¸€ä¸ªâ€œSystemArchitectureâ€ åˆ‡é¢ï¼Œä»¥æ­¤ä¸ºç›®çš„æ•è·é€šç”¨çš„åˆ‡ç‚¹è¡¨è¾¾å¼ã€‚è¿™æ ·çš„åˆ‡é¢é€šå¸¸ç±»ä¼¼äºä»¥ä¸‹ç¤ºä¾‹ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">package</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.xyz</span><span class="hljs-selector-class">.someapp</span>;<br><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.aspectj</span><span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.Aspect</span>;<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.aspectj</span><span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.Pointcut</span>;<br>@<span class="hljs-selector-tag">Aspectpublic</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">SystemArchitecture</span> &#123;<br>    <span class="hljs-comment">/**     * A join point is in the web layer if the method is defined     * in a type in the com.xyz.someapp.web package or any sub-package     * under that.     */</span>    <span class="hljs-variable">@Pointcut</span>(<span class="hljs-string">&quot;within(com.xyz.someapp.web..*)&quot;</span>)    public void <span class="hljs-built_in">inWebLayer</span>() &#123;&#125;<br>    <span class="hljs-comment">/**     * A join point is in the service layer if the method is defined     * in a type in the com.xyz.someapp.service package or any sub-package     * under that.     */</span>    <span class="hljs-variable">@Pointcut</span>(<span class="hljs-string">&quot;within(com.xyz.someapp.service..*)&quot;</span>)    public void <span class="hljs-built_in">inServiceLayer</span>() &#123;&#125;<br>    <span class="hljs-comment">/**     * A join point is in the data access layer if the method is defined     * in a type in the com.xyz.someapp.dao package or any sub-package     * under that.     */</span>    <span class="hljs-variable">@Pointcut</span>(<span class="hljs-string">&quot;within(com.xyz.someapp.dao..*)&quot;</span>)    public void <span class="hljs-built_in">inDataAccessLayer</span>() &#123;&#125;<br>    <span class="hljs-comment">/**     * A business service is the execution of any method defined on a service     * interface. This definition assumes that interfaces are placed in the     * &quot;service&quot; package, and that implementation types are in sub-packages.     *     * If you group service interfaces by functional area (for example,     * in packages com.xyz.someapp.abc.service and com.xyz.someapp.def.service) then     * the pointcut expression &quot;execution(* com.xyz.someapp..service.*.*(..))&quot;     * could be used instead.     *     * Alternatively, you can write the expression using the &#x27;bean&#x27;     * PCD, like so &quot;bean(*Service)&quot;. (This assumes that you have     * named your Spring service beans in a consistent fashion.)     */</span>    <span class="hljs-variable">@Pointcut</span>(<span class="hljs-string">&quot;execution(* com.xyz.someapp..service.*.*(..))&quot;</span>)    public void <span class="hljs-built_in">businessService</span>() &#123;&#125;<br>    <span class="hljs-comment">/**     * A data access operation is the execution of any method defined on a     * dao interface. This definition assumes that interfaces are placed in the     * &quot;dao&quot; package, and that implementation types are in sub-packages.     */</span>    <span class="hljs-variable">@Pointcut</span>(<span class="hljs-string">&quot;execution(* com.xyz.someapp.dao.*.*(..))&quot;</span>)    public void <span class="hljs-built_in">dataAccessOperation</span>() &#123;&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åƒè¿™æ ·å®šä¹‰çš„åˆ‡ç‚¹å¯ä»¥ç”¨åœ¨ä»»ä½•éœ€è¦åˆ‡ç‚¹è¡¨è¾¾å¼çš„åœ°æ–¹ï¼Œ ä¾‹å¦‚ï¼Œè¦ä½¿æœåŠ¡å±‚å…·æœ‰äº‹åŠ¡æ€§ï¼Œæ‚¨å¯ä»¥ç¼–å†™ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">aop:config</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">aop:advisor</span>        <span class="hljs-attr">pointcut</span>=<span class="hljs-string">&quot;com.xyz.someapp.SystemArchitecture.businessService()&quot;</span>        <span class="hljs-attr">advice-ref</span>=<span class="hljs-string">&quot;tx-advice&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">aop:config</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">tx:advice</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;tx-advice&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">tx:attributes</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">tx:method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;*&quot;</span> <span class="hljs-attr">propagation</span>=<span class="hljs-string">&quot;REQUIRED&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">tx:attributes</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tx:advice</span>&gt;</span><br></code></pre></td></tr></table></figure><p><code>&lt;aop:config&gt;</code> and <code>&lt;aop:advisor&gt;</code>å…ƒç´ åœ¨ <a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-schema">åŸºäºSchemaçš„AOP æ”¯æŒ</a>ä¸­è¿›è¡Œäº†è®¨è®ºã€‚ <a href="https://sca.aliyun.com/learn/spring/core/aop/data-access.html#transaction">äº‹åŠ¡ç®¡ç†</a>ä¸­è®¨è®ºäº†äº‹åŠ¡å…ƒç´ ã€‚</p><h5 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h5><p>Spring AOPç”¨æˆ·å¯èƒ½æœ€å¸¸ä½¿ç”¨<code>execution</code>åˆ‡ç‚¹æ ‡è¯†ç¬¦ ï¼Œæ‰§è¡Œè¡¨è¾¾å¼çš„æ ¼å¼ä¸ºï¼š</p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs coq">execution(modifiers-<span class="hljs-built_in">pattern</span>? ret-type-<span class="hljs-built_in">pattern</span> declaring-type-<span class="hljs-built_in">pattern</span>?name-<span class="hljs-built_in">pattern</span>(param-<span class="hljs-built_in">pattern</span>)<br><br>            throws-<span class="hljs-built_in">pattern</span>?)<br></code></pre></td></tr></table></figure><p>é™¤è¿”å›ç±»å‹æ¨¡å¼ï¼ˆä¸Šé¢ç‰‡æ®µä¸­çš„<code>ret-type-pattern</code> ï¼‰ä»¥å¤–çš„æ‰€æœ‰éƒ¨ä»¶ã€åç§°æ¨¡å¼å’Œå‚æ•°æ¨¡å¼éƒ½æ˜¯å¯é€‰çš„ã€‚è¿”å›ç±»å‹æ¨¡å¼ç¡®å®šè¦åŒ¹é…çš„è¿æ¥ç‚¹çš„æ–¹æ³•çš„è¿”å›ç±»å‹å¿…é¡»æ˜¯ä»€ä¹ˆã€‚ é€šå¸¸ï¼Œå¯ä»¥ä½¿ç”¨<code>*</code>ä½œä¸ºè¿”å›ç±»å‹æ¨¡å¼ï¼Œå®ƒåŒ¹é…ä»»ä½•è¿”å›ç±»å‹ã€‚åªæœ‰å½“æ–¹æ³•è¿”å›ç»™å®šç±»å‹æ—¶ï¼Œå®Œå…¨é™å®šçš„ç±»å‹åç§°æ‰ä¼šåŒ¹é…ã€‚åç§°æ¨¡å¼ä¸æ–¹æ³•åç§°åŒ¹é…ï¼Œå¯ä»¥å°†<code>*</code>é€šé…ç¬¦ç”¨ä½œåç§°æ¨¡å¼çš„å…¨éƒ¨æˆ–éƒ¨åˆ†ã€‚ å¦‚æœæŒ‡å®šå£°æ˜ç±»å‹æ¨¡å¼ï¼Œåˆ™éœ€è¦æœ‰åç¼€ <code>.</code>å°†å…¶åŠ å…¥åˆ°åç§°æ¨¡å¼ç»„ä»¶ä¸­ã€‚å‚æ•°æ¨¡å¼ç¨å¾®å¤æ‚ä¸€ç‚¹ã€‚<code>()</code>åŒ¹é…æ²¡æœ‰å‚æ•°çš„æ–¹æ³•ã€‚<code>(..)</code>åŒ¹é…ä»»æ„ä¸ªæ•°çš„å‚æ•°ï¼ˆ0ä¸ªæˆ–å¤šä¸ªï¼‰ã€‚ <code>(*)</code>åŒ¹é…ä»»ä½•ç±»å‹çš„å•ä¸ªå‚æ•°ã€‚<code>(*,String)</code>åŒ¹é…æœ‰ä¸¤ä¸ªå‚æ•°è€Œä¸”ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä»»æ„ç±»å‹ï¼Œç¬¬äºŒä¸ªå¿…é¡»æ˜¯<code>String</code>çš„æ–¹æ³•ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…AspectJç¼–ç¨‹æŒ‡å—çš„<a href="https://www.eclipse.org/aspectj/doc/released/progguide/semantics-pointcuts.html">è¯­è¨€è¯­ä¹‰</a>éƒ¨åˆ†ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†ä¸€äº›å¸¸è§çš„åˆ‡ç‚¹è¡¨è¾¾å¼ï¼š</p><ul><li><p>åŒ¹é…ä»»æ„å…¬å…±æ–¹æ³•çš„æ‰§è¡Œ:</p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lisp">execution(<span class="hljs-name">public</span> * *(..))<br></code></pre></td></tr></table></figure></li><li><p>åŒ¹é…ä»»æ„ä»¥<code>set</code>å¼€å§‹çš„æ–¹æ³•:</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">execution</span><span class="hljs-params">(* set*(..)</span></span>)<br></code></pre></td></tr></table></figure></li><li><p>åŒ¹é…å®šä¹‰äº†<code>AccountService</code>æ¥å£çš„ä»»æ„æ–¹æ³•:</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">execution</span><span class="hljs-params">(* com.xyz.service.AccountService.*(..)</span></span>)<br></code></pre></td></tr></table></figure></li><li><p>åŒ¹é…å®šä¹‰åœ¨<code>service</code> åŒ…ä¸­çš„ä»»æ„æ–¹æ³•:</p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lisp">execution(<span class="hljs-name">*</span> com.xyz.service.*.*(..))<br></code></pre></td></tr></table></figure></li><li><p>åŒ¹é…å®šä¹‰åœ¨serviceåŒ…å’Œå…¶å­åŒ…ä¸­çš„ä»»æ„æ–¹æ³•:</p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lisp">execution(<span class="hljs-name">*</span> com.xyz.service..*.*(..))<br></code></pre></td></tr></table></figure></li><li><p>åŒ¹é…åœ¨serviceåŒ…ä¸­çš„ä»»æ„è¿æ¥ç‚¹ï¼ˆåªåœ¨Spring AOPä¸­çš„æ–¹æ³•æ‰§è¡Œï¼‰:</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">within</span><span class="hljs-params">(com.xyz.service.*)</span></span><br></code></pre></td></tr></table></figure></li><li><p>åŒ¹é…åœ¨serviceåŒ…åŠå…¶å­åŒ…ä¸­çš„ä»»æ„è¿æ¥ç‚¹ï¼ˆåªåœ¨Spring AOPä¸­çš„æ–¹æ³•æ‰§è¡Œï¼‰:</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">within</span><span class="hljs-params">(com.xyz.service..*)</span></span><br></code></pre></td></tr></table></figure></li><li><p>åŒ¹é…ä»£ç†å®ç°äº†<code>AccountService</code> æ¥å£çš„ä»»æ„è¿æ¥ç‚¹ï¼ˆåªåœ¨Spring AOPä¸­çš„æ–¹æ³•æ‰§è¡Œï¼‰ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">this</span><span class="hljs-params">(com.xyz.service.AccountService)</span></span><br></code></pre></td></tr></table></figure><p>â€˜thisâ€™ å¸¸å¸¸ä»¥æ†ç»‘çš„å½¢å¼å‡ºç°. è§åç»­çš„ç« èŠ‚è®¨è®ºå¦‚ä½•åœ¨<a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-advice">å£°æ˜é€šçŸ¥</a>ä¸­ä½¿ç”¨ä»£ç†å¯¹è±¡ã€‚</p></li><li><p>åŒ¹é…å½“ç›®æ ‡å¯¹è±¡å®ç°äº†<code>AccountService</code>æ¥å£çš„ä»»æ„è¿æ¥ç‚¹ï¼ˆåªåœ¨Spring AOPä¸­çš„æ–¹æ³•æ‰§è¡Œï¼‰:</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">target</span><span class="hljs-params">(com.xyz.service.AccountService)</span></span><br></code></pre></td></tr></table></figure><p>â€˜targetâ€™ å¸¸å¸¸ä»¥æ†ç»‘çš„å½¢å¼å‡ºç°. è§åç»­çš„ç« èŠ‚è®¨è®ºå¦‚ä½•åœ¨<a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-advice">å£°æ˜é€šçŸ¥</a>ä¸­ä½¿ç”¨ç›®æ ‡å¯¹è±¡ã€‚</p></li><li><p>åŒ¹é…ä½¿ç”¨äº†å•ä¸€çš„å‚æ•°ï¼Œå¹¶ä¸”å‚æ•°åœ¨è¿è¡Œæ—¶è¢«ä¼ é€’æ—¶å¯ä»¥åºåˆ—åŒ–çš„ä»»æ„è¿æ¥ç‚¹ï¼ˆåªåœ¨Springçš„AOPä¸­çš„æ–¹æ³•æ‰§è¡Œï¼‰ã€‚:</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">args</span><span class="hljs-params">(java.io.Serializable)</span></span><br></code></pre></td></tr></table></figure><p>â€˜argsâ€™ å¸¸å¸¸ä»¥æ†ç»‘çš„å½¢å¼å‡ºç°.è§åç»­çš„ç« èŠ‚è®¨è®ºå¦‚ä½•åœ¨<a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-advice">å£°æ˜é€šçŸ¥</a>ä¸­ä½¿ç”¨æ–¹æ³•å‚æ•°ã€‚</p><p>æ³¨æ„åœ¨è¿™ä¸ªä¾‹å­ä¸­ç»™å®šçš„åˆ‡ç‚¹ä¸åŒäº<code>execution(* *(java.io.Serializable))</code>. å¦‚æœåœ¨è¿è¡Œæ—¶ä¼ é€’çš„å‚æ•°æ˜¯å¯åºåˆ—åŒ–çš„ï¼Œåˆ™ä¸executionåŒ¹é…ï¼Œå¦‚æœæ–¹æ³•ç­¾åå£°æ˜å•ä¸ªå‚æ•°ç±»å‹å¯åºåˆ—åŒ–ï¼Œåˆ™ä¸argsåŒ¹é…ã€‚</p></li><li><p>åŒ¹é…å½“ç›®æ ‡å¯¹è±¡æœ‰<code>@Transactional</code>æ³¨è§£æ—¶çš„ä»»æ„è¿æ¥ç‚¹ï¼ˆåªåœ¨Spring AOPä¸­çš„æ–¹æ³•æ‰§è¡Œï¼‰ã€‚</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">@<span class="hljs-built_in">target</span>(org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.transaction</span><span class="hljs-selector-class">.annotation</span>.Transactional)<br></code></pre></td></tr></table></figure><p>â€˜@targetâ€™ ä¹Ÿå¯ä»¥ä»¥æ†ç»‘çš„å½¢å¼ä½¿ç”¨.è§åç»­çš„ç« èŠ‚è®¨è®ºå¦‚ä½•åœ¨<a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-advice">å£°æ˜é€šçŸ¥</a>ä¸­ä½¿ç”¨æ³¨è§£å¯¹è±¡ã€‚</p></li><li><p>åŒ¹é…å½“ç›®æ ‡å¯¹è±¡çš„å®šä¹‰ç±»å‹æœ‰<code>@Transactional</code>æ³¨è§£æ—¶çš„ä»»æ„è¿æ¥ç‚¹ï¼ˆåªåœ¨Springçš„AOPä¸­çš„æ–¹æ³•æ‰§è¡Œï¼‰:</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">@<span class="hljs-built_in">within</span>(org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.transaction</span><span class="hljs-selector-class">.annotation</span>.Transactional)<br></code></pre></td></tr></table></figure><p>â€˜@withinâ€™ ä¹Ÿå¯ä»¥ä»¥æ†ç»‘çš„å½¢å¼ä½¿ç”¨.è§åç»­çš„ç« èŠ‚è®¨è®ºå¦‚ä½•åœ¨<a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-advice">å£°æ˜é€šçŸ¥</a>ä¸­ä½¿ç”¨æ³¨è§£å¯¹è±¡ã€‚</p></li><li><p>åŒ¹é…å½“æ‰§è¡Œçš„æ–¹æ³•æœ‰<code>@Transactional</code>æ³¨è§£çš„ä»»æ„è¿æ¥ç‚¹ï¼ˆåªåœ¨Spring AOPä¸­çš„æ–¹æ³•æ‰§è¡Œï¼‰:</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">@<span class="hljs-built_in">annotation</span>(org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.transaction</span><span class="hljs-selector-class">.annotation</span>.Transactional)<br></code></pre></td></tr></table></figure><p>â€˜@annotationâ€™ ä¹Ÿå¯ä»¥ä»¥æ†ç»‘çš„å½¢å¼ä½¿ç”¨.è§åç»­çš„ç« èŠ‚è®¨è®ºå¦‚ä½•åœ¨<a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-advice">å£°æ˜é€šçŸ¥</a>ä¸­ä½¿ç”¨æ³¨è§£å¯¹è±¡ã€‚</p></li><li><p>åŒ¹é…æœ‰å•ä¸€çš„å‚æ•°å¹¶ä¸”åœ¨è¿è¡Œæ—¶ä¼ å…¥çš„å‚æ•°ç±»å‹æœ‰<code>@Classified</code>æ³¨è§£çš„ä»»æ„è¿æ¥ç‚¹ï¼ˆåªåœ¨Spring AOPä¸­çš„æ–¹æ³•æ‰§è¡Œï¼‰:</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">@<span class="hljs-built_in">args</span>(com<span class="hljs-selector-class">.xyz</span><span class="hljs-selector-class">.security</span>.Classified)<br></code></pre></td></tr></table></figure><p>â€˜@argsâ€™ ä¹Ÿå¯ä»¥ä»¥æ†ç»‘çš„å½¢å¼ä½¿ç”¨.è§åç»­çš„ç« èŠ‚è®¨è®ºå¦‚ä½•åœ¨<a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-advice">å£°æ˜é€šçŸ¥</a>ä¸­ä½¿ç”¨æ³¨è§£å¯¹è±¡ã€‚</p></li><li><p>åŒ¹é…åœ¨åä¸º<code>tradeService</code>çš„Spring beanä¸Šçš„ä»»æ„è¿æ¥ç‚¹ï¼ˆåªåœ¨Spring AOPä¸­çš„æ–¹æ³•æ‰§è¡Œï¼‰:</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">bean</span><span class="hljs-params">(tradeService)</span></span><br></code></pre></td></tr></table></figure></li><li><p>åŒ¹é…ä»¥<code>Service</code>ç»“å°¾çš„Spring beanä¸Šçš„ä»»æ„è¿æ¥ç‚¹ï¼ˆåªåœ¨Spring AOPä¸­æ–¹æ³•æ‰§è¡Œï¼‰ :</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">bean</span><span class="hljs-params">(*Service)</span></span><br></code></pre></td></tr></table></figure></li></ul><h5 id="ç¼–å†™å¥½çš„åˆ‡ç‚¹"><a href="#ç¼–å†™å¥½çš„åˆ‡ç‚¹" class="headerlink" title="ç¼–å†™å¥½çš„åˆ‡ç‚¹"></a>ç¼–å†™å¥½çš„åˆ‡ç‚¹</h5><p>åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼ŒAspectJä¼šå°è¯•å’Œä¼˜åŒ–åŒ¹é…æ€§èƒ½æ¥å¤„ç†åˆ‡ç‚¹ã€‚æ£€æŸ¥ä»£ç å¹¶ç¡®å®šæ¯ä¸ªè¿æ¥ç‚¹æ˜¯å¦åŒ¹é…ï¼ˆé™æ€æˆ–åŠ¨æ€ï¼‰ç»™å®šåˆ‡ç‚¹æ˜¯ä¸€ä¸ªä»£ä»·é«˜æ˜‚çš„è¿‡ç¨‹ã€‚ï¼ˆåŠ¨æ€åŒ¹é…æ„å‘³ç€æ— æ³•ä»é™æ€åˆ†æä¸­å®Œå…¨ç¡®å®šåŒ¹é…ï¼Œ å¹¶ä¸”å°†åœ¨ä»£ç ä¸­æ”¾ç½®æµ‹è¯•ï¼Œä»¥ç¡®å®šåœ¨è¿è¡Œä»£ç æ—¶æ˜¯å¦å­˜åœ¨å®é™…åŒ¹é…ï¼‰ã€‚åœ¨ç¬¬ä¸€æ¬¡é‡åˆ°åˆ‡ç‚¹å£°æ˜æ—¶ï¼ŒAspectJä¼šå°†å®ƒé‡å†™ä¸ºåŒ¹é…è¿‡ç¨‹çš„æœ€ä½³å½¢å¼ã€‚è¿™æ˜¯ä»€ä¹ˆæ„æ€ï¼ŸåŸºæœ¬ä¸Šï¼Œåˆ‡ç‚¹æ˜¯åœ¨DNFï¼ˆæå–èŒƒå¼ï¼‰ä¸­é‡å†™çš„ ï¼Œåˆ‡ç‚¹çš„ç»„æˆéƒ¨åˆ†ä¼šè¢«æ’åºï¼Œä»¥ä¾¿å…ˆæ£€æŸ¥é‚£äº›æ¯”è¾ƒæ˜ç¡®çš„ç»„ä»¶ã€‚è¿™æ„å‘³ç€å¼€å‘è€…ä¸å¿…æ‹…å¿ƒå„ç§åˆ‡ç‚¹æ ‡è¯†ç¬¦çš„æ€§èƒ½ï¼Œå¹¶ä¸”å¯ä»¥åœ¨åˆ‡ç‚¹å£°æ˜ä¸­ä»¥ä»»ä½•é¡ºåºç¼–å†™ã€‚</p><p>ä½†æ˜¯ï¼ŒAspectJåªèƒ½ä¸è¢«å®ƒæŒ‡å®šçš„å†…å®¹ååŒå·¥ä½œï¼Œå¹¶ä¸”ä¸ºäº†è·å¾—æœ€ä½³çš„åŒ¹é…æ€§èƒ½ï¼Œå¼€å‘è€…åº”è¯¥è€ƒè™‘å®ƒä»¬è¯•å›¾å®ç°çš„ç›®æ ‡ï¼Œå¹¶åœ¨å®šä¹‰ä¸­å°½å¯èƒ½ç¼©å°åŒ¹é…çš„æœç´¢ç©ºé—´ã€‚ ç°æœ‰çš„æ ‡è¯†ç¬¦ä¼šè‡ªåŠ¨é€‰æ‹©ä¸‹é¢ä¸‰ä¸ªä¸­çš„ä¸€ä¸ª kinded, scoping, å’Œ contextual:</p><ul><li>Kindedé€‰æ‹©ç‰¹å®šç±»å‹çš„è¿æ¥ç‚¹çš„æ ‡è¯†ç¬¦: <code>execution</code>, <code>get</code>, <code>set</code>, <code>call</code>, å’Œ <code>handler</code>.</li><li>Scopingé€‰æ‹©ä¸€ç»„è¿æ¥ç‚¹çš„åŒ¹é… ï¼ˆå¯èƒ½æ˜¯è®¸å¤šç§ç±»ï¼‰: <code>within</code> and <code>withincode</code></li><li>ContextualåŸºäºä¸Šä¸‹æ–‡åŒ¹é… ï¼ˆæˆ–å¯é€‰ç»‘å®šï¼‰çš„æ ‡è¯†ç¬¦: <code>this</code>, <code>target</code>, and <code>@annotation</code></li></ul><p>ä¸€ä¸ªå†™å¾—å¾ˆå¥½çš„åˆ‡å…¥ç‚¹åº”è¯¥è‡³å°‘åŒ…æ‹¬å‰ä¸¤ç§ç±»å‹ï¼ˆkindedå’Œscopingï¼‰ã€‚åŒæ—¶contextualæ ‡è¯†ç¬¦æˆ–è®¸ä¼šè¢«åŒ…æ‹¬å¦‚æœå¸Œæœ›åŒ¹é…åŸºäºè¿æ¥ç‚¹ä¸Šä¸‹æ–‡æˆ–ç»‘å®šåœ¨é€šçŸ¥ä¸­ä½¿ç”¨çš„ä¸Šä¸‹æ–‡ã€‚ åªæ˜¯æä¾›kindedæ ‡è¯†ç¬¦æˆ–åªæä¾›contextualæ ‡è¯†ç¬¦å™¨ä¹Ÿèƒ½å¤Ÿå·¥ä½œï¼Œä½†æ˜¯å¯èƒ½å½±å“å¤„ç†æ€§èƒ½ï¼ˆæ—¶é—´å’Œå†…å­˜çš„ä½¿ç”¨ï¼‰ï¼Œæµªè´¹äº†é¢å¤–çš„å¤„ç†å’Œåˆ†ææ—¶é—´æˆ–ç©ºé—´ã€‚scopingæ ‡è¯†ç¬¦å¯ä»¥å¿«é€ŸåŒ¹é…å¹¶ä¸”ä½¿ç”¨AspectJå¯ä»¥å¿«é€Ÿæ’é™¤ä¸ä¼šè¢«å¤„ç†çš„è¿æ¥ç‚¹ç»„ï¼Œ è¿™ä¹Ÿè¯´æ˜ç¼–å†™å¥½çš„åˆ‡ç‚¹è¡¨è¾¾å¼æ˜¯å¾ˆé‡è¦çš„ï¼ˆå› ä¸ºæ²¡æœ‰æ˜ç¡®æŒ‡å®šæ—¶ï¼Œå®ƒå°±ä¼šLoop Lookupå¾ªç¯åŒ¹é…ï¼‰ã€‚</p><h4 id="2-4-4-å£°æ˜é€šçŸ¥"><a href="#2-4-4-å£°æ˜é€šçŸ¥" class="headerlink" title="2.4.4. å£°æ˜é€šçŸ¥"></a>2.4.4. å£°æ˜é€šçŸ¥</h4><p>é€šçŸ¥æ˜¯ä¸åˆ‡ç‚¹è¡¨è¾¾å¼ç›¸å…³è”çš„æ¦‚å¿µï¼Œå¯ä»¥åœ¨åˆ‡ç‚¹åŒ¹é…çš„æ–¹æ³•ä¹‹å‰ã€ä¹‹åæˆ–ä¹‹é—´æ‰§è¡Œã€‚åˆ‡ç‚¹è¡¨è¾¾å¼å¯ä»¥æ˜¯å¯¹å‘½ååˆ‡ç‚¹çš„ç®€å•å¼•ç”¨ï¼Œä¹Ÿå¯ä»¥æ˜¯å³æ—¶å£°æ˜çš„åˆ‡ç‚¹è¡¨è¾¾å¼ã€‚</p><h5 id="å‰ç½®é€šçŸ¥"><a href="#å‰ç½®é€šçŸ¥" class="headerlink" title="å‰ç½®é€šçŸ¥"></a>å‰ç½®é€šçŸ¥</h5><p>æ‚¨å¯ä»¥ä½¿ç”¨<code>@Before</code>æ³¨è§£åœ¨åˆ‡é¢ä¸­çš„é€šçŸ¥ä¹‹å‰å£°æ˜ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">import</span> org.aspectj.lang.<span class="hljs-keyword">annotation</span>.Aspect;<span class="hljs-keyword">import</span> org.aspectj.lang.<span class="hljs-keyword">annotation</span>.Before;<br><span class="hljs-meta">@Aspectpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BeforeExample</span> &#123;<br>    <span class="hljs-meta">@Before(<span class="hljs-string">&quot;com.xyz.myapp.SystemArchitecture.dataAccessOperation()&quot;</span>)</span>    <span class="hljs-keyword">public</span> void doAccessCheck() &#123;        <span class="hljs-comment">// ...    &#125;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœä½¿ç”¨å†…ç½®åˆ‡ç‚¹è¡¨è¾¾å¼ï¼Œæˆ‘ä»¬å¯ä»¥é‡å†™å‰é¢çš„ç¤ºä¾‹ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Aspect;<span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Before;<br><span class="hljs-meta">@Aspectpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BeforeExample</span> &#123;<br>    <span class="hljs-meta">@Before(&quot;execution(* com.xyz.myapp.dao.*.*(..))&quot;)</span>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doAccessCheck</span><span class="hljs-params">()</span> &#123;        <span class="hljs-comment">// ...    &#125;</span><br>&#125;<br></code></pre></td></tr></table></figure><h5 id="åç½®è¿”å›é€šçŸ¥"><a href="#åç½®è¿”å›é€šçŸ¥" class="headerlink" title="åç½®è¿”å›é€šçŸ¥"></a>åç½®è¿”å›é€šçŸ¥</h5><p>è¦æƒ³ç”¨åç½®è¿”å›é€šçŸ¥å¯ä»¥åœ¨åˆ‡é¢ä¸Šæ·»åŠ <code>@AfterReturning</code>æ³¨è§£:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">import</span> org.aspectj.lang.<span class="hljs-keyword">annotation</span>.Aspect;<span class="hljs-keyword">import</span> org.aspectj.lang.<span class="hljs-keyword">annotation</span>.AfterReturning;<br><span class="hljs-meta">@Aspectpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AfterReturningExample</span> &#123;<br>    <span class="hljs-meta">@AfterReturning(<span class="hljs-string">&quot;com.xyz.myapp.SystemArchitecture.dataAccessOperation()&quot;</span>)</span>    <span class="hljs-keyword">public</span> void doAccessCheck() &#123;        <span class="hljs-comment">// ...    &#125;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨åŒä¸€åˆ‡é¢ä¸­å½“ç„¶å¯ä»¥å£°æ˜å¤šä¸ªé€šçŸ¥ã€‚åœ¨æ­¤åªæ˜¯ä¸ºäº†è¿åˆè®¨è®ºçš„ä¸»é¢˜è€Œåªæ¶‰åŠå•ä¸ªé€šçŸ¥ã€‚</p><p>æœ‰äº›æ—¶å€™éœ€è¦åœ¨é€šçŸ¥ä¸­è·å–å®é™…çš„è¿”å›å€¼ã€‚å¯ä»¥ä½¿ç”¨<code>@AfterReturning</code>ï¼Œå¹¶æŒ‡å®šreturningå­—æ®µå¦‚ä¸‹:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">import</span> org.aspectj.lang.<span class="hljs-keyword">annotation</span>.Aspect;<span class="hljs-keyword">import</span> org.aspectj.lang.<span class="hljs-keyword">annotation</span>.AfterReturning;<br><span class="hljs-meta">@Aspectpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AfterReturningExample</span> &#123;<br>    <span class="hljs-meta">@AfterReturning(        pointcut=<span class="hljs-string">&quot;com.xyz.myapp.SystemArchitecture.dataAccessOperation()&quot;</span>,        returning=<span class="hljs-string">&quot;retVal&quot;</span>)</span>    <span class="hljs-keyword">public</span> void doAccessCheck(Object retVal) &#123;        <span class="hljs-comment">// ...    &#125;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨<code>returning</code>å±æ€§ä¸­ä½¿ç”¨çš„åå­—å¿…é¡»å’Œé€šçŸ¥æ–¹æ³•ä¸­çš„å‚æ•°åç›¸å…³ï¼Œæ–¹æ³•æ‰§è¡Œè¿”å›æ—¶ï¼Œè¿”å›å€¼ä½œä¸ºç›¸åº”çš„å‚æ•°å€¼ä¼ é€’ç»™adviceæ–¹æ³•ã€‚<code>returning</code>å­å¥è¿˜é™åˆ¶åªåŒ¹é…é‚£äº›è¿”å›æŒ‡å®šç±»å‹çš„å€¼çš„æ–¹æ³•æ‰§è¡Œï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸º<code>Object</code>ï¼Œå®ƒåŒ¹é…ä»»ä½•è¿”å›å€¼å¯¹è±¡ï¼‰ã€‚</p><p>è¯·æ³¨æ„ï¼Œå½“ä½¿ç”¨after-returningçš„é€šçŸ¥æ—¶ã€‚ä¸èƒ½è¿”å›ä¸åŒçš„å¼•ç”¨ã€‚</p><h5 id="åç½®å¼‚å¸¸é€šçŸ¥"><a href="#åç½®å¼‚å¸¸é€šçŸ¥" class="headerlink" title="åç½®å¼‚å¸¸é€šçŸ¥"></a>åç½®å¼‚å¸¸é€šçŸ¥</h5><p>å½“æ–¹æ³•æ‰§è¡Œå¹¶æŠ›å‡ºå¼‚å¸¸æ—¶åç½®å¼‚å¸¸é€šçŸ¥ä¼šè¢«æ‰§è¡Œï¼Œéœ€è¦ä½¿ç”¨<code>@AfterThrowing</code>æ³¨è§£æ¥å®šä¹‰ã€‚å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">import</span> org.aspectj.lang.<span class="hljs-keyword">annotation</span>.Aspect;<span class="hljs-keyword">import</span> org.aspectj.lang.<span class="hljs-keyword">annotation</span>.AfterThrowing;<br><span class="hljs-meta">@Aspectpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AfterThrowingExample</span> &#123;<br>    <span class="hljs-meta">@AfterThrowing(<span class="hljs-string">&quot;com.xyz.myapp.SystemArchitecture.dataAccessOperation()&quot;</span>)</span>    <span class="hljs-keyword">public</span> void doRecoveryActions() &#123;        <span class="hljs-comment">// ...    &#125;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å¼€å‘è€…å¸¸å¸¸å¸Œæœ›å½“ç»™å®šç±»å‹çš„å¼‚å¸¸è¢«æŠ›å‡ºæ—¶æ‰§è¡Œé€šçŸ¥ï¼Œå¹¶ä¸”ä¹Ÿéœ€è¦åœ¨é€šçŸ¥ä¸­è®¿é—®æŠ›å‡ºçš„å¼‚å¸¸ã€‚ä½¿ç”¨<code>throwing</code>å±æ€§æ¥é™åˆ¶åŒ¹é…ï¼ˆå¦‚æœéœ€è¦ï¼Œä½¿ç”¨ <code>Throwable</code>ä½œä¸ºå¼‚å¸¸ç±»å‹ï¼‰ï¼Œå¹¶å°†å¼•å‘çš„å¼‚å¸¸ç»‘å®šåˆ°é€šçŸ¥å‚æ•°ã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">import</span> org.aspectj.lang.<span class="hljs-keyword">annotation</span>.Aspect;<span class="hljs-keyword">import</span> org.aspectj.lang.<span class="hljs-keyword">annotation</span>.AfterThrowing;<br><span class="hljs-meta">@Aspectpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AfterThrowingExample</span> &#123;<br>    <span class="hljs-meta">@AfterThrowing(        pointcut=<span class="hljs-string">&quot;com.xyz.myapp.SystemArchitecture.dataAccessOperation()&quot;</span>,        throwing=<span class="hljs-string">&quot;ex&quot;</span>)</span>    <span class="hljs-keyword">public</span> void doRecoveryActions(DataAccessException ex) &#123;        <span class="hljs-comment">// ...    &#125;</span><br>&#125;<br></code></pre></td></tr></table></figure><p><code>throwing</code>å±æ€§ä¸­ä½¿ç”¨çš„åå­—å¿…é¡»å’Œé€šçŸ¥æ–¹æ³•ä¸­çš„å‚æ•°åç›¸å…³ã€‚å½“æ–¹æ³•æ‰§è¡Œå¹¶æŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œå¼‚å¸¸å°†ä¼šä¼ é€’ç»™é€šçŸ¥æ–¹æ³•ä½œä¸ºç›¸å…³çš„å‚æ•°å€¼ã€‚ æŠ›å‡ºå­å¥è¿˜é™åˆ¶ä¸åªå¼•å‘æŒ‡å®šç±»å‹çš„å¼‚å¸¸ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸º<code>DataAccessException</code>ï¼‰çš„æ–¹æ³•æ‰§è¡Œçš„åŒ¹é…ã€‚</p><h5 id="åç½®é€šçŸ¥-æ€»ä¼šæ‰§è¡Œ"><a href="#åç½®é€šçŸ¥-æ€»ä¼šæ‰§è¡Œ" class="headerlink" title="åç½®é€šçŸ¥(æ€»ä¼šæ‰§è¡Œ)"></a>åç½®é€šçŸ¥(æ€»ä¼šæ‰§è¡Œ)</h5><p>å½“åŒ¹é…æ–¹æ³•æ‰§è¡Œä¹‹ååç½®é€šçŸ¥ï¼ˆæ€»ä¼šæ‰§è¡Œï¼‰ä¼šè¢«æ‰§è¡Œã€‚è¿™ç§æƒ…å†µä½¿ç”¨<code>@After</code>æ³¨è§£æ¥å®šä¹‰ã€‚åç½®é€šçŸ¥å¿…é¡»è¢«å‡†å¤‡æ¥å¤„ç†æ­£å¸¸æˆ–å¼‚å¸¸çš„è¿”å›æ¡ä»¶ã€‚é€šå¸¸ç”¨äºé‡Šæ”¾èµ„æºç­‰ç­‰:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">import</span> org.aspectj.lang.<span class="hljs-keyword">annotation</span>.Aspect;<span class="hljs-keyword">import</span> org.aspectj.lang.<span class="hljs-keyword">annotation</span>.After;<br><span class="hljs-meta">@Aspectpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AfterFinallyExample</span> &#123;<br>    <span class="hljs-meta">@After(<span class="hljs-string">&quot;com.xyz.myapp.SystemArchitecture.dataAccessOperation()&quot;</span>)</span>    <span class="hljs-keyword">public</span> void doReleaseLock() &#123;        <span class="hljs-comment">// ...    &#125;</span><br>&#125;<br></code></pre></td></tr></table></figure><h5 id="ç¯ç»•é€šçŸ¥"><a href="#ç¯ç»•é€šçŸ¥" class="headerlink" title="ç¯ç»•é€šçŸ¥"></a>ç¯ç»•é€šçŸ¥</h5><p>æœ€åä¸€ç§é€šçŸ¥æ˜¯ç¯ç»•é€šçŸ¥ï¼Œç¯ç»•é€šçŸ¥å›´ç»•æ–¹æ³•æ‰§è¡Œã€‚å¯ä»¥åœ¨æ–¹æ³•æ‰§è¡Œä¹‹å‰å’Œæ‰§è¡Œä¹‹åæ‰§è¡Œï¼Œå¹¶ä¸”å®šä¹‰ä½•æ—¶åšä»€ä¹ˆï¼Œç”šè‡³æ˜¯å¦çœŸæ­£å¾—åˆ°æ‰§è¡Œã€‚å¦‚æœéœ€è¦åœ¨æ–¹æ³•æ‰§è¡Œä¹‹å‰å’Œä¹‹åä»¥çº¿ç¨‹å®‰å…¨çš„æ–¹å¼ ï¼ˆä¾‹å¦‚å¯åŠ¨å’Œåœæ­¢è®¡æ—¶å™¨ï¼‰ å…±äº«çŠ¶æ€ï¼Œ åˆ™é€šå¸¸ä¼šä½¿ç”¨ç¯ç»•é€šçŸ¥ã€‚æ€»æ˜¯å»ºè®®ä½¿ç”¨æœ€é€‚åˆè¦æ±‚çš„é€šçŸ¥ï¼ˆå³å¯ä»¥ç”¨å‰ç½®é€šçŸ¥è§£å†³çš„å°±ä¸è¦ç”¨ç¯ç»•é€šçŸ¥äº†ï¼‰ã€‚</p><p>ä½¿ç”¨<code>@Around</code>æ³¨è§£æ¥å®šä¹‰ç¯ç»•é€šçŸ¥ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯<code>ProceedingJoinPoint</code>ç±»å‹çš„ã€‚åœ¨é€šçŸ¥ä¸­è°ƒç”¨ <code>ProceedingJoinPoint</code>ä¸­çš„ <code>proceed()</code>æ–¹æ³•æ¥å¼•ç”¨æ‰§è¡Œçš„æ–¹æ³•ã€‚<code>proceed</code>æ–¹æ³•ä¹Ÿå¯ä»¥è¢«è°ƒç”¨ä¼ é€’æ•°ç»„å¯¹è±¡- æ•°ç»„çš„å€¼å°†ä¼šè¢«å½“ä½œå‚æ•°åœ¨æ–¹æ³•æ‰§è¡Œæ—¶è¢«ä½¿ç”¨ã€‚proceedæ–¹æ³•ä¹Ÿå¯ä»¥ä¼ å…¥ <code>Object[]</code>ã€‚ æ•°ç»„ä¸­çš„å€¼åœ¨è¿›è¡Œæ—¶ç”¨ä½œæ–¹æ³•æ‰§è¡Œçš„å‚æ•°ã€‚</p><p>åœ¨ä½¿ç”¨ <code>Object[]</code> è°ƒç”¨æ—¶ <code>proceed</code> çš„è¡Œä¸ºä¸åœ¨AspectJç¼–è¯‘å™¨ç¼–è¯‘çš„ç¯ç»•é€šçŸ¥è¿›è¡Œçš„è¡Œä¸ºç•¥æœ‰ä¸åŒã€‚å¯¹äºä½¿ç”¨ä¼ ç»ŸAspectJè¯­è¨€ç¼–å†™çš„é€šçŸ¥ï¼Œ ä¼ é€’ç»™<code>proceed</code>çš„å‚æ•°æ•°å¿…é¡»ä¸ä¼ é€’ç»™ç¯ç»•é€šçŸ¥çš„å‚æ•°æ•°é‡ï¼ˆä¸æ˜¯è¢«è¿æ¥ç‚¹å¤„ç†çš„å‚æ•°çš„æ•°ç›®ï¼‰åŒ¹é…ï¼Œå¹¶ä¸”ä¼ é€’çš„å€¼å°†<code>proceed</code> åœ¨ç»™å®šçš„å‚æ•°ä½ç½®å–ä»£è¯¥å€¼ç»‘å®šåˆ°çš„å®ä½“çš„è¿æ¥ç‚¹çš„åŸå§‹å€¼ï¼ˆå¦‚æœç°åœ¨æ— æ³•ç†è§£ ï¼Œè¯·ä¸è¦æ‹…å¿ƒï¼‰ã€‚Springå¤„ç†çš„æ–¹å¼æ˜¯ç®€å•çš„å¹¶ä¸”åŸºäºä»£ç†çš„ï¼Œä¼šç”Ÿæˆæ›´å¥½çš„åŒ¹é…è¯­ä¹‰ã€‚ç°åœ¨åªéœ€æ„è¯†åˆ°è¿™ä¸¤ç§æ˜¯æœ‰è¿™ä¹ˆä¸€ç‚¹çš„ä¸åŒçš„å³å¯ã€‚æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥ç¼–å†™å‡º100%å…¼å®¹Spring AOPå’ŒAspectJçš„åŒ¹é…ï¼Œ <a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-ataspectj-advice-params">åœ¨åç»­çš„ç« èŠ‚ä¸­</a>å°†ä¼šè®¨è®ºé€šçŸ¥çš„å‚æ•°ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•ä½¿ç”¨aroundé€šçŸ¥ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">import</span> org.aspectj.lang.<span class="hljs-keyword">annotation</span>.Aspect;<span class="hljs-keyword">import</span> org.aspectj.lang.<span class="hljs-keyword">annotation</span>.Around;<span class="hljs-keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;<br><span class="hljs-meta">@Aspectpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AroundExample</span> &#123;<br>    <span class="hljs-meta">@Around(<span class="hljs-string">&quot;com.xyz.myapp.SystemArchitecture.businessService()&quot;</span>)</span>    <span class="hljs-keyword">public</span> Object doBasicProfiling(ProceedingJoinPoint pjp) throws Throwable &#123;        <span class="hljs-comment">// start stopwatch        Object retVal = pjp.proceed();        // stop stopwatch        return retVal;    &#125;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ç¯ç»•é€šçŸ¥è¿”å›çš„å€¼å°†ä¼šè¢«è°ƒç”¨çš„æ–¹æ³•çœ‹åˆ°ï¼Œä¾‹å¦‚ï¼Œä¸€ä¸ªç®€å•çš„ç¼“å­˜åˆ‡é¢å¯ä»¥ä»ç¼“å­˜ä¸­è¿”å›ä¸€ä¸ªå€¼ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ï¼Œå¦‚æœæ²¡æœ‰åˆ™è°ƒç”¨<code>proceed()</code>ã€‚ è¯·æ³¨æ„ï¼Œå¯ä»¥åœ¨aroundé€šçŸ¥çš„ä¸»ä½“å†…è°ƒç”¨ä¸€æ¬¡ï¼Œå¤šæ¬¡æˆ–æ ¹æœ¬ä¸è°ƒç”¨ã€‚ æ‰€æœ‰è¿™äº›éƒ½æ˜¯åˆæ³•çš„ã€‚</p><h5 id="é€šçŸ¥çš„å‚æ•°"><a href="#é€šçŸ¥çš„å‚æ•°" class="headerlink" title="é€šçŸ¥çš„å‚æ•°"></a>é€šçŸ¥çš„å‚æ•°</h5><p>Springæä¾›äº†å…¨éƒ¨ç±»å‹çš„é€šçŸ¥ï¼Œè¿™æ„å‘³ç€éœ€åœ¨é€šçŸ¥ç­¾åä¸­å£°æ˜æ‰€éœ€çš„å‚æ•°ï¼ˆæ­£å¦‚ä¸Šé¢è¿”å›å’Œå¼‚å¸¸çš„ç¤ºä¾‹ï¼‰ï¼Œè€Œä¸æ˜¯ä¸€ç›´ä½¿ç”¨ <code>Object[]</code>æ•°ç»„ã€‚æ¥ç€å°†ä¼šçœ‹åˆ°æ€ä¹ˆå£°æ˜å‚æ•°ä»¥åŠä¸Šä¸‹æ–‡çš„å€¼æ˜¯å¦‚ä½•åœ¨é€šçŸ¥å®ä½“ä¸­è¢«ä½¿ç”¨çš„ã€‚ é¦–å…ˆï¼Œæ¥çœ‹çœ‹å¦‚ä½•ç¼–å†™ä¸€èˆ¬çš„é€šçŸ¥ï¼Œæ‰¾å‡ºç¼–å†™é€šçŸ¥çš„æ³•å­ã€‚</p><h6 id="è®¿é—®å½“å‰çš„è¿æ¥ç‚¹"><a href="#è®¿é—®å½“å‰çš„è¿æ¥ç‚¹" class="headerlink" title="è®¿é—®å½“å‰çš„è¿æ¥ç‚¹"></a>è®¿é—®å½“å‰çš„<code>è¿æ¥ç‚¹</code></h6><p>ä»»ä½•é€šçŸ¥æ–¹æ³•éƒ½å¯ä»¥å£°æ˜ä¸€ä¸ªç±»å‹ä¸º <code>org.aspectj.lang.JoinPoint</code>çš„å‚æ•°ä½œä¸ºå…¶ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆæ³¨æ„ï¼Œéœ€è¦ä½¿ç”¨around adviceæ¥å£°æ˜ä¸€ä¸ªç±»å‹ä¸º<code>ProceedingJoinPoint</code>çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ å®ƒæ˜¯<code>JoinPoint</code>çš„ä¸€ä¸ªå­ç±»ã€‚<code>JoinPoint</code>æ¥å£æä¾›å¾ˆå¤šæœ‰ç”¨çš„æ–¹æ³•ï¼š:</p><ul><li><code>getArgs()</code>: è¿”å›æ–¹æ³•å‚æ•°.</li><li><code>getThis()</code>: è¿”å›ä»£ç†å¯¹è±¡.</li><li><code>getTarget()</code>: è¿”å›ç›®æ ‡å¯¹è±¡.</li><li><code>getSignature()</code>:è¿”å›æ­£åœ¨é€šçŸ¥çš„æ–¹æ³•çš„æè¿°.</li><li><code>toString()</code>: æ‰“å°æ–¹æ³•è¢«é€šçŸ¥çš„æœ‰ç”¨æè¿°.</li></ul><p>See the <a href="https://www.eclipse.org/aspectj/doc/released/runtime-api/org/aspectj/lang/JoinPoint.html">javadoc</a> for more detail.</p><h6 id="ä¼ é€’å‚æ•°ç»™é€šçŸ¥"><a href="#ä¼ é€’å‚æ•°ç»™é€šçŸ¥" class="headerlink" title="ä¼ é€’å‚æ•°ç»™é€šçŸ¥"></a>ä¼ é€’å‚æ•°ç»™é€šçŸ¥</h6><p>æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†å¦‚ä½•ç»‘å®šè¿”å›çš„å€¼æˆ–å¼‚å¸¸å€¼ï¼ˆåœ¨è¿”å›ä¹‹åå’ŒæŠ›å‡ºé€šçŸ¥ä¹‹åä½¿ç”¨ï¼‰ã€‚ä¸ºäº†åœ¨é€šçŸ¥ä»£ç æ®µä¸­ä½¿ç”¨å‚æ•°å€¼ï¼Œå¯ä»¥ä½¿ç”¨ç»‘å®š<code>args</code>çš„å½¢å¼ã€‚å¦‚æœåœ¨å‚æ•°è¡¨è¾¾å¼ä¸­ä½¿ç”¨å‚æ•°åä»£æ›¿ç±»å‹åç§°ï¼Œ åˆ™åœ¨è°ƒç”¨é€šçŸ¥æ—¶ï¼Œè¦å°†ç›¸å…³çš„å‚æ•°å€¼å½“ä½œå‚æ•°ä¼ é€’ã€‚ä¾‹å¦‚ï¼Œå‡å¦‚åœ¨daoæ“ä½œæ—¶å°†Accountå¯¹è±¡ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’ç»™é€šçŸ¥ï¼Œå¹¶ä¸”éœ€è¦åœ¨é€šçŸ¥ä»£ç æ®µå†…è®¿é—®<code>Account</code>ï¼Œå¯ä»¥è¿™æ ·å†™:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Before(&quot;com.xyz.myapp.SystemArchitecture.dataAccessOperation() &amp;&amp; args(account,..)&quot;)</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">validateAccount</span><span class="hljs-params">(Account account)</span> &#123;<br><br>    <span class="hljs-comment">// ...</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p>åˆ‡ç‚¹è¡¨è¾¾å¼çš„<code>args(account,..)</code> éƒ¨åˆ†æœ‰ä¸¤ä¸ªç›®çš„ã€‚på®ƒä¸¥æ ¼åŒ¹é…äº†è‡³å°‘å¸¦ä¸€ä¸ªå‚æ•°çš„æ‰§è¡Œæ–¹æ³•ï¼Œå¹¶ä¸”ä¼ é€’ç»™ä¼ é€’çš„å‚æ•°æ˜¯<code>Account</code>å®ä¾‹ã€‚ ç¬¬äºŒï¼Œå®ƒä½¿å¾—å®é™…çš„<code>Account</code>å¯¹è±¡é€šè¿‡<code>account</code>å‚æ•°æä¾›ç»™é€šçŸ¥ã€‚ parameter, and the argument passed to that parameter is an instance of . Second, it makes the actual object available to the advice through the parameter.</p><p>å¦ä¸€ä¸ªæ–¹æ³•å†™æ³•å°±æ˜¯å…ˆå®šä¹‰åˆ‡ç‚¹ï¼Œç„¶åï¼Œâ€œprovidesâ€<code>Account</code>å¯¹è±¡ç»™åŒ¹é…çš„è¿æ¥ç‚¹ï¼Œæœ‰äº†è¿æ¥ç‚¹ï¼Œé‚£ä¹ˆå¼•ç”¨è¿æ¥ç‚¹ä½œä¸ºåˆ‡ç‚¹çš„é€šçŸ¥å°±èƒ½è·å¾—Accountå¯¹è±¡çš„å€¼ã€‚è¿™çœ‹èµ·æ¥å¦‚ä¸‹ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Pointcut</span>(<span class="hljs-string">&quot;com.xyz.myapp.SystemArchitecture.dataAccessOperation() &amp;&amp; args(account,..)&quot;</span>)private void <span class="hljs-built_in">accountDataAccessOperation</span>(Account account) &#123;&#125;<br><span class="hljs-variable">@Before</span>(<span class="hljs-string">&quot;accountDataAccessOperation(account)&quot;</span>)public void <span class="hljs-built_in">validateAccount</span>(Account account) &#123;    <span class="hljs-comment">// ...&#125;</span><br></code></pre></td></tr></table></figure><p>æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…AspectJç¼–ç¨‹æŒ‡å—ã€‚</p><p>ä»£ç†å¯¹è±¡( <code>this</code>)ï¼Œç›®æ ‡å¯¹è±¡ ( <code>target</code>)å’Œæ³¨è§£ ( <code>@within</code>, <code>@target</code>, <code>@annotation</code>, and <code>@args</code>)éƒ½å¯ä»¥ä»¥ç±»ä¼¼çš„æ–¹å¼ç»‘å®šã€‚æ¥ä¸‹æ¥çš„ä¸¤ä¸ªç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•åŒ¹é…å¸¦æœ‰<code>@Auditable</code>æ³¨è§£çš„æ³¨è§£æ–¹æ³•çš„æ‰§è¡Œå¹¶è·å–auditä»£ç ä»£ç :</p><p>é¦–å…ˆæ˜¯<code>@Auditable</code>æ³¨è§£çš„å®šä¹‰:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Retention</span>(RetentionPolicy.RUNTIME)<br><br><span class="hljs-variable">@Target</span>(ElementType.METHOD)<br><br>public <span class="hljs-variable">@interface</span> Auditable &#123;<br><br>    <span class="hljs-selector-tag">AuditCode</span> <span class="hljs-selector-tag">value</span>();<br><br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åæ˜¯åŒ¹é…<code>@Auditable</code>æ–¹æ³•é€šçŸ¥çš„æ‰§è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Before(&quot;com.xyz.lib.Pointcuts.anyPublicMethod() &amp;&amp; @annotation(auditable)&quot;)</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">audit</span><span class="hljs-params">(Auditable auditable)</span> &#123;<br><br>    <span class="hljs-type">AuditCode</span> <span class="hljs-variable">code</span> <span class="hljs-operator">=</span> auditable.value();<br><br>    <span class="hljs-comment">// ...</span><br><br>&#125;<br></code></pre></td></tr></table></figure><h6 id="é€šçŸ¥å‚æ•°å’Œæ³›å‹"><a href="#é€šçŸ¥å‚æ•°å’Œæ³›å‹" class="headerlink" title="é€šçŸ¥å‚æ•°å’Œæ³›å‹"></a>é€šçŸ¥å‚æ•°å’Œæ³›å‹</h6><p>Spring AOPå¯ä»¥å¤„ç†ç±»å£°æ˜å’Œæ–¹æ³•å‚æ•°ä¸­ä½¿ç”¨çš„æ³›å‹ã€‚å‡è®¾å¦‚ä¸‹æ³›å‹ç±»å‹:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">Sample</span>&lt;<span class="hljs-title">T</span>&gt; &#123;<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sampleGenericMethod</span>(<span class="hljs-params">T param</span>)</span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sampleGenericCollectionMethod</span>(<span class="hljs-params">Collection&lt;T&gt; param</span>)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>åªéœ€å°†é€šçŸ¥å‚æ•°é”®å…¥è¦æ‹¦æˆªæ–¹æ³•çš„å‚æ•°ç±»å‹ï¼Œå°±å¯ä»¥å°†æ–¹æ³•ç±»å‹çš„æ£€æµ‹é™åˆ¶ä¸ºæŸäº›å‚æ•°ç±»å‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Before(&quot;execution(* ..Sample+.sampleGenericMethod(*)) &amp;&amp; args(param)&quot;)</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">beforeSampleMethod</span><span class="hljs-params">(MyType param)</span> &#123;<br><br>    <span class="hljs-comment">// Advice implementation</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p>æ­¤æ–¹æ³•ä¸é€‚ç”¨äºæ³›å‹é›†åˆã€‚ å› æ­¤ï¼Œæ‚¨æ— æ³•æŒ‰å¦‚ä¸‹æ–¹å¼å®šä¹‰åˆ‡ç‚¹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Before(&quot;execution(* ..Sample+.sampleGenericCollectionMethod(*)) &amp;&amp; args(param)&quot;)</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">beforeSampleMethod</span><span class="hljs-params">(Collection&lt;MyType&gt; param)</span> &#123;<br><br>    <span class="hljs-comment">// Advice implementation</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸ºäº†ä½¿è¿™é¡¹å·¥ä½œï¼Œæˆ‘ä»¬å¿…é¡»æ£€æŸ¥é›†åˆçš„æ¯ä¸ªå…ƒç´ ï¼Œè¿™æ˜¯ä¸åˆç†çš„ï¼Œå› ä¸ºæˆ‘ä»¬ä¹Ÿæ— æ³•å†³å®šå¦‚ä½•å¤„ç†<code>null</code>å€¼ã€‚ è¦å®ç°ä¸æ­¤ç±»ä¼¼çš„æ“ä½œï¼Œæ‚¨å¿…é¡»å°†å‚æ•°é”®å…¥<code>Collection&lt;?&gt;</code> å¹¶æ‰‹åŠ¨æ£€æŸ¥å…ƒç´ çš„ç±»å‹ã€‚</p><h6 id="å£°æ˜å‚æ•°çš„åå­—"><a href="#å£°æ˜å‚æ•°çš„åå­—" class="headerlink" title="å£°æ˜å‚æ•°çš„åå­—"></a>å£°æ˜å‚æ•°çš„åå­—</h6><p>å‚æ•°åœ¨é€šçŸ¥ä¸­çš„ç»‘å®šä¾èµ–äºåå­—åŒ¹é…ï¼Œé‡ç‚¹åœ¨åˆ‡ç‚¹è¡¨è¾¾å¼ä¸­å®šä¹‰çš„å‚æ•°åçš„æ–¹æ³•ç­¾åä¸Šï¼ˆé€šçŸ¥å’Œåˆ‡ç‚¹ï¼‰ã€‚å‚æ•°åç§°ä¸èƒ½é€šè¿‡Javaåå°„è·å¾—ï¼Œå› æ­¤Spring AOPä½¿ç”¨ä»¥ä¸‹ç­–ç•¥æ¥ç¡®å®šå‚æ•°åç§°ï¼š</p><ul><li><p>å¦‚æœç”¨æˆ·å·²æ˜ç¡®æŒ‡å®šå‚æ•°åç§°ï¼Œåˆ™ä½¿ç”¨æŒ‡å®šçš„å‚æ•°åç§°ã€‚é€šçŸ¥å’Œåˆ‡ç‚¹æ³¨è§£éƒ½æœ‰ä¸€ä¸ªå¯é€‰çš„<code>argNames</code>å±æ€§ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è¯¥å±æ€§æŒ‡å®šå¸¦æ³¨è§£çš„æ–¹æ³•çš„å‚æ•°åç§°ã€‚ è¿™äº›å‚æ•°åç§°åœ¨è¿è¡Œæ—¶å¯ç”¨ã€‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•ä½¿ç”¨<code>argNames</code>å±æ€§:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Before(value=&quot;com.xyz.lib.Pointcuts.anyPublicMethod() &amp;&amp; target(bean) &amp;&amp; @annotation(auditable)&quot;,</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">        argNames=&quot;bean,auditable&quot;)</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">audit</span><span class="hljs-params">(Object bean, Auditable auditable)</span> &#123;<br><br>    <span class="hljs-type">AuditCode</span> <span class="hljs-variable">code</span> <span class="hljs-operator">=</span> auditable.value();<br><br>    <span class="hljs-comment">// ... use code and bean</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°æ˜¯<code>JoinPoint</code>, <code>ProceedingJoinPoint</code>, æˆ– <code>JoinPoint.StaticPart</code> ç±»å‹ï¼Œåˆ™å¯ä»¥ä»<code>argNames</code>å±æ€§çš„å€¼ä¸­çœç•¥å‚æ•°çš„åç§°ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœä¿®æ”¹å‰é¢çš„é€šçŸ¥ä»¥æ¥æ”¶è¿æ¥ç‚¹å¯¹è±¡ï¼Œåˆ™<code>argNames</code>å±æ€§ä¸éœ€è¦åŒ…å«å®ƒ:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Before(value=&quot;com.xyz.lib.Pointcuts.anyPublicMethod() &amp;&amp; target(bean) &amp;&amp; @annotation(auditable)&quot;,</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">        argNames=&quot;bean,auditable&quot;)</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">audit</span><span class="hljs-params">(JoinPoint jp, Object bean, Auditable auditable)</span> &#123;<br><br>    <span class="hljs-type">AuditCode</span> <span class="hljs-variable">code</span> <span class="hljs-operator">=</span> auditable.value();<br><br>    <span class="hljs-comment">// ... use code, bean, and jp</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p>å¯¹<code>JoinPoint</code>,<code>ProceedingJoinPoint</code>, and <code>JoinPoint.StaticPart</code>ç±»å‹çš„ç¬¬ä¸€ä¸ªå‚æ•°çš„ç‰¹æ®Šå¤„ç†æ–¹ä¾¿ä¸æ”¶é›†ä»»ä½•å…¶ä»–è¿æ¥ç‚¹ä¸Šä¸‹æ–‡çš„é€šçŸ¥ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ç®€å•åœ°çœç•¥<code>argNames</code>å±æ€§ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹å»ºè®®æ— éœ€å£°æ˜<code>argNames</code>å±æ€§:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Before(&quot;com.xyz.lib.Pointcuts.anyPublicMethod()&quot;)</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">audit</span><span class="hljs-params">(JoinPoint jp)</span> &#123;<br><br>    <span class="hljs-comment">// ... use jp</span><br><br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨<code>&#39;argNames&#39;</code>å±æ€§æœ‰ç‚¹ç¬¨æ‹™ï¼Œæ‰€ä»¥å¦‚æœæ²¡æœ‰æŒ‡å®š<code>&#39;argNames&#39;</code>å±æ€§ï¼ŒSpring AOPä¼šæŸ¥çœ‹è¯¥ç±»çš„è°ƒè¯•ä¿¡æ¯ï¼Œå¹¶å°è¯•ä»å±€éƒ¨å˜é‡è¡¨ä¸­ç¡®å®šå‚æ•°åç§°ã€‚åªè¦ä½¿ç”¨è°ƒè¯•ä¿¡æ¯(<code>&#39;-g:vars&#39;</code>ï¼‰ç¼–è¯‘ç±»ï¼Œ å°±ä¼šå‡ºç°æ­¤ä¿¡æ¯ã€‚ä½¿ç”¨æ­¤æ ‡å¿—è¿›è¡Œç¼–è¯‘çš„åæœæ˜¯ï¼š(1).æ‚¨çš„ä»£ç å°†å®¹æ˜“è¢«ç†è§£(é€†å‘å·¥ç¨‹ã€‚(2). ç±»æ–‡ä»¶çš„å¤§å°å°†ä¼šæœ‰äº›å¤§(é€šå¸¸ä¸æ˜¯ä»€ä¹ˆäº‹)ã€‚(3). å¯¹éä½¿ç”¨æœ¬åœ°å˜é‡çš„ä¼˜åŒ–å°†ä¸ä¼šåº”ç”¨äºä½ çš„ç¼–è¯‘å™¨ã€‚ æ¢å¥è¯è¯´ï¼Œé€šè¿‡ä½¿ç”¨æ­¤æ ‡å¿—æ„å»ºï¼Œæ‚¨åº”è¯¥ä¸ä¼šé‡åˆ°ä»»ä½•å›°éš¾ã€‚</p><p>å¦‚æœå³ä½¿æ²¡æœ‰è°ƒè¯•ä¿¡æ¯ï¼ŒAspectJç¼–è¯‘å™¨ï¼ˆajcï¼‰ä¹Ÿç¼–è¯‘äº†@AspectJæ–¹é¢ï¼Œåˆ™æ— éœ€æ·»åŠ  <code>argNames</code>å±æ€§ï¼Œå› ä¸ºç¼–è¯‘å™¨ä¼šä¿ç•™æ‰€éœ€çš„ä¿¡æ¯ã€‚</p></li><li><p>å¦‚æœä»£ç æ˜¯åœ¨æ²¡æœ‰å¿…è¦çš„è°ƒè¯•ä¿¡æ¯çš„æƒ…å†µä¸‹ç¼–è¯‘çš„ï¼Œé‚£ä¹ˆSpring AOPå°†å°è¯•æ¨æ–­ç»‘å®šå˜é‡ä¸å‚æ•°çš„é…å¯¹ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœåœ¨åˆ‡ç‚¹è¡¨è¾¾å¼ä¸­åªç»‘å®šäº†ä¸€ä¸ªå˜é‡ï¼Œå¹¶ä¸”è¯¥é€šçŸ¥æ–¹æ³•åªéœ€è¦ä¸€ä¸ªå‚æ•°ï¼Œæ­¤æ—¶ä¸¤è€…åŒ¹é…æ˜¯æ˜æ˜¾çš„ï¼‰ã€‚ å¦‚æœç»™å®šäº†å¯ç”¨ä¿¡æ¯ï¼Œå˜é‡çš„ç»‘å®šæ˜¯ä¸æ˜ç¡®çš„è¯ï¼Œåˆ™ä¼šå¼•å‘<code>AmbiguousBindingException</code>å¼‚å¸¸ã€‚</p></li><li><p>å¦‚æœä¸Šè¿°æ‰€æœ‰ç­–ç•¥éƒ½å¤±è´¥ï¼Œåˆ™æŠ›å‡º<code>IllegalArgumentException</code> å¼‚å¸¸ã€‚</p></li></ul><h6 id="å¤„ç†å‚æ•°"><a href="#å¤„ç†å‚æ•°" class="headerlink" title="å¤„ç†å‚æ•°"></a>å¤„ç†å‚æ•°</h6><p>å‰é¢è¯´è¿‡ã€‚å°†æè¿°å¦‚ä½•ç”¨åœ¨Spring AOPå’ŒAspectJä¸­ä¸€è‡´çš„å‚æ•°ä¸­ç¼–å†™<code>proceed</code>å¤„ç†å‡½æ•°ã€‚è§£å†³æ–¹æ¡ˆæ˜¯ç¡®ä¿å»ºè®®ç­¾åæŒ‰é¡ºåºç»‘å®šæ¯ä¸ªæ–¹æ³•å‚æ•°ã€‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œï¼š:</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-meta">@Around</span>(<span class="hljs-string">&quot;execution(List&lt;Account&gt; find*(..)) &amp;&amp; &quot;</span> +<br><br>        <span class="hljs-string">&quot;com.xyz.myapp.SystemArchitecture.inDataAccessLayer() &amp;&amp; &quot;</span> +<br><br>        <span class="hljs-string">&quot;args(accountHolderNamePattern)&quot;</span>)<br><br><span class="hljs-keyword">public</span> Object preProcessQueryPattern(ProceedingJoinPoint pjp,<br><br>        <span class="hljs-keyword">String</span> accountHolderNamePattern) throws Throwable &#123;<br><br>    <span class="hljs-keyword">String</span> <span class="hljs-keyword">new</span><span class="hljs-type">Pattern</span> = preProcess(accountHolderNamePattern);<br><br>    <span class="hljs-keyword">return</span> pjp.proceed(<span class="hljs-keyword">new</span> <span class="hljs-type">Object</span>[] &#123;<span class="hljs-keyword">new</span><span class="hljs-type">Pattern</span>&#125;);<br><br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œæ— è®ºå¦‚ä½•éƒ½è¦æ‰§è¡Œæ­¤ç»‘å®šï¼ˆå¦‚å‰é¢çš„ç¤ºä¾‹æ‰€ç¤ºï¼‰ã€‚</p><h5 id="é€šçŸ¥çš„é¡ºåº"><a href="#é€šçŸ¥çš„é¡ºåº" class="headerlink" title="é€šçŸ¥çš„é¡ºåº"></a>é€šçŸ¥çš„é¡ºåº</h5><p>å½“å¤šä¸ªé€šçŸ¥éƒ½å¸Œæœ›åœ¨åŒä¸€è¿æ¥ç‚¹ä¸Šè¿è¡Œæ—¶ä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼ŸSpring AOPéµå¾ªä¸AspectJç›¸åŒçš„ä¼˜å…ˆçº§è§„åˆ™æ¥ç¡®å®šé€šçŸ¥æ‰§è¡Œçš„é¡ºåºã€‚æ‹¥æœ‰æœ€é«˜ä¼˜å…ˆæƒçš„é€šçŸ¥ä¼šé€”ä¸­å…ˆâ€è¿›å…¥â€ï¼ˆå› æ­¤ï¼Œç»™å®šä¸¤æ¡å‰ç½®é€šçŸ¥ï¼Œä¼˜å…ˆçº§æœ€é«˜çš„é€šçŸ¥é¦–å…ˆè¿è¡Œï¼‰ã€‚ ä»è¿æ¥ç‚¹â€é€€å‡ºâ€ï¼Œæ‹¥æœ‰æœ€é«˜ä¼˜å…ˆçº§çš„é€šçŸ¥æœ€åæ‰è¿è¡Œï¼ˆé€€å‡ºï¼‰ï¼ˆï¼ˆå› æ­¤ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªåç½®é€šçŸ¥ï¼Œé‚£ä¹ˆæ‹¥æœ‰æœ€é«˜ä¼˜å…ˆçº§çš„å°†åœ¨æœ€åè¿è¡Œï¼ˆé€€å‡ºï¼‰ï¼‰ã€‚</p><p>å¦‚æœåœ¨ä¸åŒåˆ‡é¢å®šä¹‰çš„ä¸¤ä¸ªé€šçŸ¥éƒ½éœ€è¦åœ¨åŒä¸€ä¸ªè¿æ¥ç‚¹è¿è¡Œï¼Œé‚£ä¹ˆé™¤éå¼€å‘è€…æŒ‡å®šè¿è¡Œçš„å…ˆåï¼Œå¦åˆ™æ‰§è¡Œçš„é¡ºåºæ˜¯æœªå®šä¹‰çš„ã€‚ å¯ä»¥é€šè¿‡æŒ‡å®šä¼˜å…ˆçº§æ¥æ§åˆ¶æ‰§è¡Œé¡ºåºã€‚è¿™ä¹Ÿæ˜¯Springæ¨èçš„æ–¹å¼ï¼Œé€šè¿‡åœ¨åˆ‡é¢ç±»å®ç°<code>org.springframework.core.Ordered</code>æ¥å£æˆ–ä½¿ç”¨<code>Order</code>å¯¹å…¶è¿›è¡Œæ³¨è§£å³å¯ã€‚ å¦‚æœæœ‰ä¸¤ä¸ªåˆ‡é¢ï¼Œä»<code>Ordered.getValue()</code>ï¼ˆæˆ–æ³¨è§£å€¼ï¼‰è¿”å›è¾ƒä½å€¼çš„æ–¹é¢å…·æœ‰è¾ƒé«˜çš„ä¼˜å…ˆçº§ã€‚</p><p>å½“åœ¨åŒä¸€åˆ‡é¢å®šä¹‰çš„ä¸¤æ¡é€šçŸ¥éƒ½éœ€è¦åœ¨åŒä¸€ä¸ªè¿æ¥ç‚¹ä¸Šè¿è¡Œæ—¶ï¼Œæ’åºä¹Ÿæ˜¯æœªå®šä¹‰çš„ï¼ˆå› ä¸ºæ²¡æœ‰åŠæ³•é€šè¿‡åå°„æ£€ç´¢Javacç¼–è¯‘çš„ç±»çš„å£°æ˜é¡ºåºï¼‰ ã€‚è€ƒè™‘å°†é€šçŸ¥æ–¹æ³•ä¸ä¸€ä¸ªé€šçŸ¥æ–¹æ³•åˆå¹¶ï¼Œæ ¹æ®æ¯ä¸ªè¿æ¥ç‚¹åœ¨æ¯ä¸ªåˆ‡é¢ç±»æˆ–å°†é€šçŸ¥åˆ‡åˆ†ä¸ºåˆ‡é¢ç±»ï¼Œå¯ä»¥åœ¨åˆ‡é¢çº§åˆ«æŒ‡å®šé¡ºåºã€‚</p><h4 id="2-4-5-å¼•å…¥"><a href="#2-4-5-å¼•å…¥" class="headerlink" title="2.4.5. å¼•å…¥"></a>2.4.5. å¼•å…¥</h4><p>å¼•å…¥ï¼ˆä½œä¸ºAspectJä¸­å†…éƒ¨ç±»å‹çš„å£°æ˜ï¼‰å…è®¸åˆ‡é¢å®šä¹‰é€šçŸ¥çš„å¯¹è±¡å®ç°ç»™å®šçš„æ¥å£,å¹¶ä»£è¡¨è¿™äº›å¯¹è±¡æä¾›è¯¥æ¥å£çš„å®ç°.</p><p>å¼•å…¥ä½¿ç”¨<code>@DeclareParents</code>æ³¨è§£æ¥å®šä¹‰,è¿™ä¸ªæ³¨è§£ç”¨äºå£°æ˜åŒ¹é…æ‹¥æœ‰æ–°çš„çˆ¶ç±»çš„ç±»å‹ï¼ˆå› æ­¤å¾—åï¼‰ã€‚ä¾‹å¦‚ï¼Œ ç»™å®šåä¸º<code>UsageTracked</code> çš„æ¥å£å’Œåä¸º<code>DefaultUsageTracked</code>çš„æ¥å£çš„å®ç°ï¼Œä»¥ä¸‹åˆ‡é¢å£°æ˜æœåŠ¡æ¥å£çš„æ‰€æœ‰å®ç°è€…ä¹Ÿå®ç°<code>UsageTracked</code>æ¥å£ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡JMXå…¬å¼€ç»Ÿè®¡ä¿¡æ¯ï¼‰:</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">@Aspectpublic <span class="hljs-keyword">class</span> <span class="hljs-symbol">UsageTracking</span> &#123;<br>    @DeclareParents(value=<span class="hljs-string">&quot;com.xzy.myapp.service.*+&quot;</span>, defaultImpl=DefaultUsageTracked.class)    <span class="hljs-keyword">public</span> static UsageTracked <span class="hljs-keyword">mixin</span>;<br>    @Before(<span class="hljs-string">&quot;com.xyz.myapp.SystemArchitecture.businessService() &amp;&amp; this(usageTracked)&quot;</span>)    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> recordUsage(UsageTracked usageTracked) &#123;        usageTracked.incrementUseCount();    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¦å®ç°çš„æ¥å£ç”±æ³¨è§£å±æ€§çš„ç±»å‹æ¥ç¡®å®šã€‚ <code>@DeclareParents</code>æ³¨è§£çš„<code>value</code>å€¼æ˜¯AspectJç±»å‹æ¨¡å¼å¼•è¿‡æ¥çš„ã€‚æ³¨æ„ä¸Šé¢ä¾‹å­ä¸­çš„å‰ç½®é€šçŸ¥ï¼Œ æœåŠ¡beanå¯ä»¥ç›´æ¥ä½œä¸º<code>UsageTracked</code>æ¥å£çš„å®ç°ï¼Œå¦‚æœä»¥ç¼–ç¨‹æ–¹å¼è®¿é—®beanï¼Œæ‚¨å°†ç¼–å†™ä»¥ä¸‹å†…å®¹ï¼š:</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">UsageTracked usageTracked <span class="hljs-operator">=</span> (UsageTracked) context.getBean(<span class="hljs-string">&quot;myService&quot;</span>)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><h4 id="2-4-6-åˆ‡é¢å®ä¾‹åŒ–æ¨¡å‹"><a href="#2-4-6-åˆ‡é¢å®ä¾‹åŒ–æ¨¡å‹" class="headerlink" title="2.4.6. åˆ‡é¢å®ä¾‹åŒ–æ¨¡å‹"></a>2.4.6. åˆ‡é¢å®ä¾‹åŒ–æ¨¡å‹</h4><p>è¿™æ˜¯ä¸€ä¸ªé«˜çº§ä¸»é¢˜ã€‚ å¦‚æœæ‚¨åˆšåˆšå¼€å§‹ä½¿ç”¨AOPï¼Œæ‚¨å¯ä»¥è·³è¿‡å®ƒç›´åˆ°ç¨åå†äº†è§£ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­çš„æ¯ä¸ªåˆ‡é¢éƒ½æœ‰ä¸€ä¸ªå®ä¾‹ã€‚AspectJå°†å…¶ç§°ä¸ºå•ä¾‹å®ä¾‹åŒ–æ¨¡å‹ã€‚ å¯ä»¥ä½¿ç”¨äº¤æ›¿ç”Ÿå‘½å‘¨æœŸå®šä¹‰åˆ‡é¢ã€‚ Springæ”¯æŒAspectJçš„<code>perthis</code>å’Œ <code>pertarget</code>å®ä¾‹åŒ–æ¨¡å‹ï¼ˆç›®å‰ä¸æ”¯æŒ<code>percflow, percflowbelow,</code> å’Œ <code>pertypewithin</code>ï¼‰ã€‚</p><p>æ‚¨å¯ä»¥é€šè¿‡åœ¨<code>@Aspect</code>æ³¨è§£ä¸­æŒ‡å®š<code>perthis</code>å­å¥æ¥å£°æ˜ç›¸å…³æ–¹é¢ã€‚ è¯·è€ƒè™‘ä»¥ä¸‹ç¤ºä¾‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Aspect(&quot;perthis(com.xyz.myapp.SystemArchitecture.businessService())&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAspect</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> someState;<br>    <span class="hljs-meta">@Before(com.xyz.myapp.SystemArchitecture.businessService())</span>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">recordServiceUsage</span><span class="hljs-params">()</span> &#123;        <span class="hljs-comment">// ...    &#125;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œ<code>&#39;perthis&#39;</code>å­å¥çš„ä½œç”¨æ˜¯ä¸ºæ‰§è¡Œä¸šåŠ¡æœåŠ¡çš„æ¯ä¸ªå”¯ä¸€æœåŠ¡å¯¹è±¡åˆ›å»ºä¸€ä¸ªåˆ‡é¢å®ä¾‹ï¼ˆæ¯ä¸ªå”¯ä¸€å¯¹è±¡åœ¨ç”±åˆ‡ç‚¹è¡¨è¾¾å¼åŒ¹é…çš„è¿æ¥ç‚¹å¤„ç»‘å®šåˆ°â€™thisâ€™ï¼‰ã€‚ æ–¹æ³•å®ä¾‹æ˜¯åœ¨ç¬¬ä¸€æ¬¡åœ¨æœåŠ¡å¯¹è±¡ä¸Šè°ƒç”¨æ–¹æ³•æ—¶åˆ›å»ºçš„ã€‚å½“æœåŠ¡å¯¹è±¡è¶…å‡ºèŒƒå›´æ—¶ï¼Œè¯¥åˆ‡é¢ä¹Ÿå°†è¶…å‡ºèŒƒå›´ã€‚åœ¨åˆ›å»ºåˆ‡é¢å®ä¾‹ä¹‹å‰ï¼Œå®ƒåŒ…å«çš„ä»»æ„é€šçŸ¥éƒ½ä¸ä¼šæ‰§è¡Œã€‚åœ¨åˆ›å»ºäº†åˆ‡é¢å®ä¾‹åï¼Œ å…¶ä¸­å£°æ˜çš„é€šçŸ¥å°†åœ¨åŒ¹é…çš„è¿æ¥ç‚¹ä¸­æ‰§è¡Œï¼Œä½†ä»…å½“æœåŠ¡å¯¹è±¡æ˜¯æ­¤åˆ‡é¢å…³è”çš„é€šçŸ¥æ—¶æ‰ä¼šè¿è¡Œã€‚æœ‰å…³<code>per</code> å­å¥çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…AspectJç¼–ç¨‹æŒ‡å—ã€‚</p><p><code>pertarget</code> å®ä¾‹åŒ–æ¨¡å‹çš„å·¥ä½œæ–¹å¼ä¸<code>perthis</code>å®Œå…¨ç›¸åŒï¼Œä½†å®ƒä¸ºåŒ¹é…çš„è¿æ¥ç‚¹å¤„çš„æ¯ä¸ªå”¯ä¸€ç›®æ ‡å¯¹è±¡åˆ›å»ºä¸€ä¸ªåˆ‡é¢å®ä¾‹ã€‚</p><h4 id="2-4-7-AOP-ä¾‹å­"><a href="#2-4-7-AOP-ä¾‹å­" class="headerlink" title="2.4.7. AOP ä¾‹å­"></a>2.4.7. AOP ä¾‹å­</h4><p>ç°åœ¨æ‚¨å·²ç»äº†è§£äº†æ‰€æœ‰ç»„æˆéƒ¨åˆ†çš„å·¥ä½œåŸç†ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒä»¬æ”¾åœ¨ä¸€èµ·åšä¸€äº›æœ‰ç”¨çš„äº‹æƒ….</p><p>ç”±äºå¹¶å‘é—®é¢˜ï¼ˆä¾‹å¦‚ï¼Œæ­»é”å¤±è´¥è€…ï¼‰ï¼Œä¸šåŠ¡æœåŠ¡çš„æ‰§è¡Œæœ‰æ—¶ä¼šå¤±è´¥ã€‚å¦‚æœé‡è¯•è¯¥æ“ä½œï¼Œåˆ™å¯èƒ½åœ¨ä¸‹æ¬¡å°è¯•æ—¶æˆåŠŸã€‚å¯¹äºé€‚åˆåœ¨è¿™ç§æƒ…å†µä¸‹é‡è¯•çš„ä¸šåŠ¡æœåŠ¡ï¼ˆä¸éœ€è¦è¿”å›ç»™ç”¨æˆ·æ¥è§£å†³å†²çªçš„å¹‚ç­‰æ“ä½œï¼‰ã€‚ å¸Œæœ›é€æ˜åœ°é‡è¯•è¯¥æ“ä½œï¼Œä»¥é¿å…å®¢æˆ·ç«¯çœ‹åˆ°<code>PessimisticLockingFailureException</code>å¼‚å¸¸ã€‚è¿™ä¸ªéœ€æ±‚å¾ˆæ˜æ˜¾ï¼Œå®ƒè·¨è¶Šäº†æœåŠ¡å±‚ä¸­çš„å¤šä¸ªæœåŠ¡ï¼Œå› æ­¤éå¸¸é€‚åˆé€šè¿‡åˆ‡é¢æ¥å®ç°ã€‚</p><p>å› ä¸ºæˆ‘ä»¬æƒ³è¦é‡è¯•æ“ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨ç¯ç»•é€šçŸ¥ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥å¤šæ¬¡è°ƒç”¨<code>proceed</code>ã€‚ ä»¥ä¸‹æ¸…å•æ˜¾ç¤ºäº†åŸºæœ¬æ–¹é¢çš„å®ç°:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Aspectpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConcurrentOperationExecutor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Ordered</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">DEFAULT_MAX_RETRIES</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">maxRetries</span> <span class="hljs-operator">=</span> DEFAULT_MAX_RETRIES;    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setMaxRetries</span><span class="hljs-params">(<span class="hljs-type">int</span> maxRetries)</span> &#123;        <span class="hljs-built_in">this</span>.maxRetries = maxRetries;    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getOrder</span><span class="hljs-params">()</span> &#123;        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.order;    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setOrder</span><span class="hljs-params">(<span class="hljs-type">int</span> order)</span> &#123;        <span class="hljs-built_in">this</span>.order = order;    &#125;<br>    <span class="hljs-meta">@Around(&quot;com.xyz.myapp.SystemArchitecture.businessService()&quot;)</span>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">doConcurrentOperation</span><span class="hljs-params">(ProceedingJoinPoint pjp)</span> <span class="hljs-keyword">throws</span> Throwable &#123;        <span class="hljs-type">int</span> <span class="hljs-variable">numAttempts</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;        PessimisticLockingFailureException lockFailureException;        <span class="hljs-keyword">do</span> &#123;            numAttempts++;            <span class="hljs-keyword">try</span> &#123;                <span class="hljs-keyword">return</span> pjp.proceed();            &#125;            <span class="hljs-keyword">catch</span>(PessimisticLockingFailureException ex) &#123;                lockFailureException = ex;            &#125;        &#125; <span class="hljs-keyword">while</span>(numAttempts &lt;= <span class="hljs-built_in">this</span>.maxRetries);        <span class="hljs-keyword">throw</span> lockFailureException;    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œè¯¥æ–¹é¢å®ç°äº†<code>Ordered</code>æ¥å£ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥å°†åˆ‡é¢çš„ä¼˜å…ˆçº§è®¾ç½®ä¸ºé«˜äºäº‹åŠ¡é€šçŸ¥ï¼ˆæˆ‘ä»¬æ¯æ¬¡é‡è¯•æ—¶éƒ½éœ€è¦ä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼‰ã€‚ <code>maxRetries</code>å’Œ<code>order</code>å±æ€§éƒ½ç”±Springé…ç½®ã€‚ä¸»è¦çš„æ“ä½œæ˜¯åœ¨<code>doConcurrentOperation</code>çš„ç¯ç»•é€šçŸ¥ä¸­ã€‚è¯·æ³¨æ„ï¼Œè¯·æ³¨æ„ï¼Œç›®å‰ï¼Œæˆ‘ä»¬å°†é‡è¯•é€»è¾‘åº”ç”¨äºæ¯ä¸ª <code>businessService()</code>ã€‚ å°è¯•æ‰§è¡Œæ—¶ï¼Œå¦‚æœå¤±è´¥äº†ï¼Œå°†äº§ç”Ÿ<code>PessimisticLockingFailureException</code>å¼‚å¸¸ï¼Œä½†æ˜¯ä¸ç”¨ç®¡å®ƒï¼Œåªéœ€å†æ¬¡å°è¯•æ‰§è¡Œå³å¯ï¼Œé™¤éå·²ç»ç”¨å°½æ‰€æœ‰çš„é‡è¯•æ¬¡æ•°ã€‚</p><p>ç›¸åº”çš„Springé…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;aop:aspectj-autoproxy/&gt;<br>&lt;bean <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;concurrentOperationExecutor&quot;</span> <span class="hljs-attribute">class</span>=<span class="hljs-string">&quot;com.xyz.myapp.service.impl.ConcurrentOperationExecutor&quot;</span>&gt;    &lt;property <span class="hljs-attribute">name</span>=<span class="hljs-string">&quot;maxRetries&quot;</span> <span class="hljs-attribute">value</span>=<span class="hljs-string">&quot;3&quot;</span>/&gt;    &lt;property <span class="hljs-attribute">name</span>=<span class="hljs-string">&quot;order&quot;</span> <span class="hljs-attribute">value</span>=<span class="hljs-string">&quot;100&quot;</span>/&gt;&lt;/bean&gt;<br></code></pre></td></tr></table></figure><p>ä¸ºäº†ä¼˜åŒ–åˆ‡é¢ä»¥ä¾¿å®ƒåªé‡è¯•å¹‚ç­‰æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä»¥ä¸‹<code>Idempotent</code>æ³¨è§£:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Retention</span>(RetentionPolicy.RUNTIME)<br><br>public <span class="hljs-variable">@interface</span> Idempotent &#123;<br><br>    <span class="hljs-comment">// marker annotation</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åä½¿ç”¨å®ƒæ¥æ³¨è§£æœåŠ¡æ“ä½œçš„å®ç°ã€‚å¯¹åˆ‡é¢çš„æ›´æ”¹åªéœ€è¦é‡è¯•ç­‰å¹‚è¿ç®—ï¼Œåªéœ€ç»†åŒ–åˆ‡ç‚¹è¡¨è¾¾å¼ï¼Œä»¥ä¾¿åªåŒ¹é…<code>@Idempotent</code>æ“ä½œ:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Around(&quot;com.xyz.myapp.SystemArchitecture.businessService() &amp;&amp; &quot; +</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">        &quot;@annotation(com.xyz.myapp.service.Idempotent)&quot;)</span><br><br><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">doConcurrentOperation</span><span class="hljs-params">(ProceedingJoinPoint pjp)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br><br>    ...<br><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-5-åŸºäºSchemaçš„AOPæ”¯æŒ"><a href="#2-5-åŸºäºSchemaçš„AOPæ”¯æŒ" class="headerlink" title="2.5. åŸºäºSchemaçš„AOPæ”¯æŒ"></a>2.5. åŸºäºSchemaçš„AOPæ”¯æŒ</h3><p>å¦‚æœæ‚¨æ›´å–œæ¬¢åŸºäºXMLçš„æ ¼å¼ï¼ŒSpringè¿˜æ”¯æŒä½¿ç”¨æ–°çš„<code>aop</code>å‘½åç©ºé—´æ ‡ç­¾å®šä¹‰åˆ‡é¢ã€‚å®Œå…¨ç›¸åŒçš„åˆ‡ç‚¹è¡¨è¾¾å¼å’Œé€šçŸ¥ç±»å‹åœ¨ä½¿ç”¨@AspectJæ–¹å¼æ—¶åŒæ ·å¾—åˆ°æ”¯æŒã€‚ å› æ­¤ï¼Œåœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†é‡ç‚¹æ”¾åœ¨æ–°è¯­æ³•ä¸Šï¼Œå¹¶å°†è¯»è€…å¼•ç”¨åˆ°ä¸Šä¸€èŠ‚ï¼ˆ<a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-ataspectj">@AspectJæ”¯æŒ</a>ï¼‰ä¸­çš„è®¨è®ºï¼Œä»¥äº†è§£ç¼–å†™åˆ‡ç‚¹è¡¨è¾¾å¼å’Œé€šçŸ¥å‚æ•°çš„ç»‘å®šã€‚</p><p>è¦ä½¿ç”¨æœ¬èŠ‚ä¸­æè¿°çš„aopå‘½åç©ºé—´æ ‡ç­¾ï¼Œæ‚¨éœ€è¦å¯¼å…¥<code>spring-aop</code> schemaï¼Œå¦‚<a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#xsd-schemas">åŸºäºXMLæ¨¡å¼çš„é…ç½®ä¸­æ‰€è¿°</a>ã€‚ æœ‰å…³å¦‚ä½•åœ¨<code>aop</code>å‘½åç©ºé—´ä¸­å¯¼å…¥æ ‡è®°ï¼Œè¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#xsd-schemas-aop">the AOP schema</a>ã€‚</p><p>åœ¨Springé…ç½®ä¸­ï¼Œæ‰€æœ‰aspectå’Œadvisorå…ƒç´ å¿…é¡»æ”¾åœ¨ <code>&lt;aop:config&gt;</code>å…ƒç´ ä¸­ï¼ˆåœ¨åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡é…ç½®ä¸­å¯ä»¥æœ‰å¤šä¸ª <code>&lt;aop:config&gt;</code>å…ƒç´ ï¼‰ã€‚ <code>&lt;aop:config&gt;</code>å…ƒç´ å¯ä»¥åŒ…å«åˆ‡ç‚¹ï¼Œé€šçŸ¥è€…å’Œåˆ‡é¢å…ƒç´ ï¼ˆè¯·æ³¨æ„ï¼Œè¿™äº›å…ƒç´ å¿…é¡»æŒ‰æ­¤é¡ºåºå£°æ˜ï¼‰ã€‚</p><p><code>&lt;aop:config&gt;</code>é…ç½®æ ·å¼å¤§é‡ä½¿ç”¨äº†Springçš„<a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-autoproxy">è‡ªåŠ¨ä»£ç†</a>æœºåˆ¶ã€‚å¦‚æœå·²ç»é€šè¿‡ä½¿ç”¨<code>BeanNameAutoProxyCreator</code> æˆ–ç±»ä¼¼çš„ç±»ä½¿ç”¨äº†æ˜¾å¼çš„è‡ªåŠ¨ä»£ç†ï¼Œ åˆ™å¯èƒ½ä¼šå‡ºç°é—®é¢˜ï¼ˆå¦‚é€šçŸ¥è¿˜æ²¡è¢«ç¼–ç»‡ï¼‰ã€‚å»ºè®®çš„ä½¿ç”¨æ¨¡å¼æ˜¯ä»…ä½¿ç”¨<code>&lt;aop:config&gt;</code>æ ·å¼æˆ–ä»…ä½¿ç”¨<code>AutoProxyCreator</code>æ ·å¼ï¼Œå¹¶ä¸”æ°¸è¿œä¸è¦æ··ç”¨å®ƒä»¬ã€‚</p><h4 id="2-5-1-å£°æ˜åˆ‡é¢"><a href="#2-5-1-å£°æ˜åˆ‡é¢" class="headerlink" title="2.5.1.å£°æ˜åˆ‡é¢"></a>2.5.1.å£°æ˜åˆ‡é¢</h4><p>å¦‚æœä½¿ç”¨schemaï¼Œé‚£ä¹ˆåˆ‡é¢åªæ˜¯åœ¨Springåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­å®šä¹‰ä¸ºbeançš„å¸¸è§„Javaå¯¹è±¡ã€‚åœ¨å¯¹è±¡çš„å­—æ®µå’Œæ–¹æ³•ä¸­è·å–çŠ¶æ€å’Œè¡Œä¸ºï¼Œå¹¶ä¸”åœ¨XMLä¸­è·å–åˆ‡ç‚¹å’Œé€šçŸ¥ä¿¡æ¯ã€‚</p><p>æ‚¨å¯ä»¥ä½¿ç”¨<a href="aop:aspect">aop:aspect</a>å…ƒç´ å£°æ˜æ–¹é¢ï¼Œå¹¶ä½¿ç”¨<code>ref</code>å±æ€§å¼•ç”¨æ”¯æŒbeanï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">aop:config</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">aop:aspect</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;myAspect&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;aBean&quot;</span>&gt;</span>        ...    <span class="hljs-tag">&lt;/<span class="hljs-name">aop:aspect</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">aop:config</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;aBean&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;...&quot;</span>&gt;</span>    ...<span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æ”¯æŒåˆ‡é¢çš„beanï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯<code>aBean</code>ï¼‰å½“ç„¶å¯ä»¥åƒä»»ä½•å…¶ä»–Spring beanä¸€æ ·é…ç½®å’Œä¾èµ–æ³¨å…¥ã€‚</p><h4 id="2-5-2-å£°æ˜åˆ‡ç‚¹"><a href="#2-5-2-å£°æ˜åˆ‡ç‚¹" class="headerlink" title="2.5.2. å£°æ˜åˆ‡ç‚¹"></a>2.5.2. å£°æ˜åˆ‡ç‚¹</h4><p>æ‚¨å¯ä»¥åœ¨<code>&lt;aop:config&gt;</code>å…ƒç´ ä¸­å£°æ˜ä¸€ä¸ªå‘½ååˆ‡ç‚¹ï¼Œè®©åˆ‡ç‚¹å®šä¹‰åœ¨å¤šä¸ªåˆ‡é¢å’Œé€šçŸ¥è€…ä¹‹é—´å…±äº«ã€‚</p><p>è¡¨ç¤ºæœåŠ¡å±‚ä¸­ä»»ä½•ä¸šåŠ¡æœåŠ¡æ‰§è¡Œçš„åˆ‡ç‚¹å¯ä»¥å®šä¹‰å¦‚ä¸‹ï¼š:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">aop:config</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;businessService&quot;</span>        <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;execution(* com.xyz.myapp.service.*.*(..))&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">aop:config</span>&gt;</span><br></code></pre></td></tr></table></figure><p>åˆ‡ç‚¹è¡¨è¾¾å¼æœ¬èº«ä½¿ç”¨çš„æ˜¯ç›¸åŒçš„AspectJåˆ‡ç‚¹è¡¨è¾¾å¼è¯­è¨€ï¼Œå¦‚<a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-ataspectj">@AspectJæ”¯æŒ</a>æ‰€è¿°ã€‚å¦‚æœä½¿ç”¨åŸºäºschemaçš„å£°æ˜æ ·å¼ï¼Œåˆ™å¯ä»¥å¼•ç”¨åœ¨åˆ‡ç‚¹è¡¨è¾¾å¼å†…çš„ç±»å‹(@Aspects)ä¸­å®šä¹‰çš„å‘½ååˆ‡ç‚¹ ã€‚å®šä¹‰ä¸Šè¿°åˆ‡å…¥ç‚¹çš„å¦ä¸€ç§æ–¹æ³•å¦‚ä¸‹:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">aop:config</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;businessService&quot;</span>        <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;com.xyz.myapp.SystemArchitecture.businessService()&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">aop:config</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å‡è®¾æœ‰ä¸€ä¸ª<code>SystemArchitecture</code>çš„åˆ‡é¢ï¼ˆå¦‚<a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-common-pointcuts">å…±äº«é€šç”¨çš„åˆ‡ç‚¹å®šä¹‰</a>ä¸€èŠ‚æ‰€è¿°ï¼‰ã€‚</p><p>åˆ‡é¢å£°æ˜åˆ‡ç‚¹ä¸å£°æ˜top-levelåˆ‡ç‚¹éå¸¸ç›¸ä¼¼ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">aop:config</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">aop:aspect</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;myAspect&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;aBean&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;businessService&quot;</span>            <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;execution(* com.xyz.myapp.service.*.*(..))&quot;</span>/&gt;</span><br>        ...<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">aop:aspect</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">aop:config</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä¸@AspectJæ–¹é¢çš„æ–¹æ³•ç›¸åŒï¼Œä½¿ç”¨åŸºäºschemaçš„å®šä¹‰æ ·å¼å£°æ˜çš„åˆ‡ç‚¹å¯èƒ½ä¼šæ”¶é›†è¿æ¥ç‚¹ä¸Šä¸‹æ–‡ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹åˆ‡ç‚¹å°†<code>this</code>å¯¹è±¡æ”¶é›†ä¸ºè¿æ¥ç‚¹ä¸Šä¸‹æ–‡å¹¶å°†å…¶ä¼ é€’ç»™é€šçŸ¥ï¼š:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">aop:config</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">aop:aspect</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;myAspect&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;aBean&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;businessService&quot;</span>            <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;execution(* com.xyz.myapp.service.*.*(..)) <span class="hljs-symbol">&amp;amp;</span><span class="hljs-symbol">&amp;amp;</span> this(service)&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">aop:before</span> <span class="hljs-attr">pointcut-ref</span>=<span class="hljs-string">&quot;businessService&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;monitor&quot;</span>/&gt;</span><br>        ...<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">aop:aspect</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">aop:config</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å¿…é¡»é€šè¿‡åŒ…å«åŒ¹é…åç§°çš„å‚æ•°æ¥å£°æ˜æ¥æ”¶æ‰€æ”¶é›†çš„è¿æ¥ç‚¹ä¸Šä¸‹æ–‡çš„é€šçŸ¥ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">monitor</span>(<span class="hljs-params"><span class="hljs-built_in">Object</span> service</span>) &#123;<br><br>    ...<br><br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ç»„åˆåˆ‡ç‚¹è¡¨è¾¾å¼ä¸­ï¼Œ <code>&amp;&amp;</code> åœ¨XMLæ–‡æ¡£ä¸­å¾ˆéš¾å¤„ç†ï¼Œå› æ­¤æ‚¨å¯ä»¥åˆ†åˆ«ä½¿ç”¨ <code>and</code>, <code>or</code>å’Œ<code>not</code> åˆ†åˆ«ç”¨æ¥ä»£æ›¿<code>&amp;&amp;</code>, <code>||</code>, å’Œ <code>!</code> ã€‚ä¾‹å¦‚ï¼Œä»¥å‰çš„åˆ‡ç‚¹å¯ä»¥æ›´å¥½åœ°ç¼–å†™å¦‚ä¸‹ï¼š:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">aop:config</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">aop:aspect</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;myAspect&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;aBean&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;businessService&quot;</span>            <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;execution(* com.xyz.myapp.service..(..)) and this(service)&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">aop:before</span> <span class="hljs-attr">pointcut-ref</span>=<span class="hljs-string">&quot;businessService&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;monitor&quot;</span>/&gt;</span><br>        ...    <span class="hljs-tag">&lt;/<span class="hljs-name">aop:aspect</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">aop:config</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä»¥è¿™ç§æ–¹å¼å®šä¹‰çš„åˆ‡ç‚¹ç”±å…¶XML <code>id</code>å¼•ç”¨ï¼Œä¸èƒ½ç”¨ä½œå‘½ååˆ‡ç‚¹ä»¥å½¢æˆå¤åˆåˆ‡ç‚¹ã€‚å› æ­¤ï¼ŒåŸºäºschemaå®šä¹‰æ ·å¼ä¸­çš„å‘½ååˆ‡ç‚¹æ¯”@AspectJæ ·å¼æä¾›çš„å—åˆ°æ›´å¤šçš„é™åˆ¶ã€‚</p><h4 id="2-5-3-å£°æ˜é€šçŸ¥"><a href="#2-5-3-å£°æ˜é€šçŸ¥" class="headerlink" title="2.5.3. å£°æ˜é€šçŸ¥"></a>2.5.3. å£°æ˜é€šçŸ¥</h4><p>åŒæ ·çš„äº”ç§é€šçŸ¥ç±»å‹ä¹Ÿæ”¯æŒ@AspectJæ ·å¼ï¼Œå¹¶ä¸”å®ƒä»¬å…·æœ‰å®Œå…¨ç›¸åŒçš„è¯­ä¹‰ã€‚</p><h5 id="å‰ç½®é€šçŸ¥-1"><a href="#å‰ç½®é€šçŸ¥-1" class="headerlink" title="å‰ç½®é€šçŸ¥"></a>å‰ç½®é€šçŸ¥</h5><p>å‰ç½®é€šçŸ¥å¾ˆæ˜æ˜¾æ˜¯åœ¨åŒ¹é…æ–¹æ³•æ‰§è¡Œä¹‹å‰è¢«è°ƒç”¨ï¼Œ å®ƒé€šè¿‡ä½¿ç”¨ <a href="aop:before">aop:before</a>å…ƒç´ åœ¨<code>&lt;aop:aspect&gt;</code>ä¸­å£°æ˜ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤º:</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs applescript">&lt;aop:aspect <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;beforeExample&quot;</span> <span class="hljs-keyword">ref</span>=<span class="hljs-string">&quot;aBean&quot;</span>&gt;<br>    &lt;aop:<span class="hljs-keyword">before</span>        pointcut-<span class="hljs-keyword">ref</span>=<span class="hljs-string">&quot;dataAccessOperation&quot;</span>        method=<span class="hljs-string">&quot;doAccessCheck&quot;</span>/&gt;<br>    ...<br>&lt;/aop:aspect&gt;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œ<code>dataAccessOperation</code> æ˜¯åœ¨æœ€å¤–å±‚çš„(<code>&lt;aop:config&gt;</code>)å®šä¹‰çš„åˆ‡ç‚¹idã€‚è‹¥è¦ä»¥å†…è”æ–¹å¼å®šä¹‰åˆ‡ç‚¹ï¼Œè¯·å°†<code>pointcut-ref</code>å±æ€§æ›¿æ¢ä¸ºåˆ‡ç‚¹å±æ€§ã€‚å¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs applescript">&lt;aop:aspect <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;beforeExample&quot;</span> <span class="hljs-keyword">ref</span>=<span class="hljs-string">&quot;aBean&quot;</span>&gt;<br>    &lt;aop:<span class="hljs-keyword">before</span>        pointcut=<span class="hljs-string">&quot;execution(* com.xyz.myapp.dao.*.*(..))&quot;</span>        method=<span class="hljs-string">&quot;doAccessCheck&quot;</span>/&gt;<br>    ...<br>&lt;/aop:aspect&gt;<br></code></pre></td></tr></table></figure><p>æ­£å¦‚æˆ‘ä»¬åœ¨è®¨è®º@AspectJæ ·å¼æ—¶æ‰€æåˆ°çš„ï¼Œä½¿ç”¨å‘½ååˆ‡ç‚¹å¯ä»¥æ˜¾ç€æé«˜ä»£ç çš„å¯è¯»æ€§ã€‚</p><p><code>method</code>å±æ€§å®šä¹‰çš„ (<code>doAccessCheck</code>)æ–¹æ³•ç”¨äºé€šçŸ¥çš„ä»£ç ä½“å†…ã€‚è¿™ä¸ªæ–¹æ³•åŒ…å«åˆ‡é¢å…ƒç´ æ‰€å¼•ç”¨çš„beanã€‚åœ¨æ•°æ®è®¿é—®æ“ä½œä¹‹å‰é€šçŸ¥ä¼šè¢«æ‰§è¡Œ(å½“ç„¶è¿æ¥ç‚¹åŒ¹é…ä¸­çš„åˆ‡ç‚¹)ï¼Œ å³åˆ‡é¢beançš„<code>doAccessCheck</code>æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚</p><h5 id="åç½®è¿”å›é€šçŸ¥-1"><a href="#åç½®è¿”å›é€šçŸ¥-1" class="headerlink" title="åç½®è¿”å›é€šçŸ¥"></a>åç½®è¿”å›é€šçŸ¥</h5><p>åœ¨åŒ¹é…çš„æ–¹æ³•æ‰§è¡Œæ­£å¸¸å®Œæˆåè¿”å›é€šçŸ¥è¿è¡Œã€‚ å®ƒåœ¨ <code>&lt;aop:aspect&gt;</code>ä¸­ä»¥ä¸å‰ç½®é€šçŸ¥ç›¸åŒçš„æ–¹å¼å£°æ˜ã€‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•å£°æ˜å®ƒ:</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs applescript">&lt;aop:aspect <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;afterReturningExample&quot;</span> <span class="hljs-keyword">ref</span>=<span class="hljs-string">&quot;aBean&quot;</span>&gt;<br>    &lt;aop:<span class="hljs-keyword">after</span>-<span class="hljs-keyword">returning</span>        pointcut-<span class="hljs-keyword">ref</span>=<span class="hljs-string">&quot;dataAccessOperation&quot;</span>        method=<span class="hljs-string">&quot;doAccessCheck&quot;</span>/&gt;<br>    ...<br>&lt;/aop:aspect&gt;<br></code></pre></td></tr></table></figure><p>ä¸@AspectJæ ·å¼ä¸€æ ·ï¼Œå¯ä»¥åœ¨é€šçŸ¥ä»£ç ä½“å†…è·å–è¿”å›å€¼ã€‚ä¸ºæ­¤ï¼Œä½¿ç”¨returningå±æ€§å®šä¹‰å‚æ•°çš„åå­—æ¥ä¼ é€’è¿”å›å€¼ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs applescript">&lt;aop:aspect <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;afterReturningExample&quot;</span> <span class="hljs-keyword">ref</span>=<span class="hljs-string">&quot;aBean&quot;</span>&gt;<br>    &lt;aop:<span class="hljs-keyword">after</span>-<span class="hljs-keyword">returning</span>        pointcut-<span class="hljs-keyword">ref</span>=<span class="hljs-string">&quot;dataAccessOperation&quot;</span>        <span class="hljs-keyword">returning</span>=<span class="hljs-string">&quot;retVal&quot;</span>        method=<span class="hljs-string">&quot;doAccessCheck&quot;</span>/&gt;<br>    ...<br>&lt;/aop:aspect&gt;<br></code></pre></td></tr></table></figure><p><code>doAccessCheck</code>æ–¹æ³•å¿…é¡»å£°æ˜ä¸€ä¸ªåä¸º<code>retVal</code>çš„å‚æ•°ï¼Œæ­¤å‚æ•°çš„ç±»å‹çº¦æŸåŒ¹é…çš„æ–¹å¼ä¸<code>@AfterReturning</code>æ‰€æè¿°çš„ç›¸åŒã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼å£°æ˜æ–¹æ³•ç­¾å:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">doAccessCheck</span>(<span class="hljs-params"><span class="hljs-built_in">Object</span> retVal</span>) &#123;...<br></code></pre></td></tr></table></figure><h5 id="åç½®å¼‚å¸¸é€šçŸ¥-1"><a href="#åç½®å¼‚å¸¸é€šçŸ¥-1" class="headerlink" title="åç½®å¼‚å¸¸é€šçŸ¥"></a>åç½®å¼‚å¸¸é€šçŸ¥</h5><p>å°±æ˜¯åŒ¹é…çš„æ–¹æ³•è¿è¡ŒæŠ›å‡ºå¼‚å¸¸ååç½®å¼‚å¸¸é€šçŸ¥ä¼šè¿è¡Œï¼Œå®ƒåœ¨<code>&lt;aop:aspect&gt;</code>ä¸­ä½¿ç”¨ after-throwingå…ƒç´ å£°æ˜ã€‚å¦‚ä¸‹ä¾‹æ‰€ç¤º:</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs applescript">&lt;aop:aspect <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;afterThrowingExample&quot;</span> <span class="hljs-keyword">ref</span>=<span class="hljs-string">&quot;aBean&quot;</span>&gt;<br>    &lt;aop:<span class="hljs-keyword">after</span>-throwing        pointcut-<span class="hljs-keyword">ref</span>=<span class="hljs-string">&quot;dataAccessOperation&quot;</span>        method=<span class="hljs-string">&quot;doRecoveryActions&quot;</span>/&gt;<br>    ...<br>&lt;/aop:aspect&gt;<br></code></pre></td></tr></table></figure><p>ä¸@AspectJæ ·å¼ä¸€æ ·ï¼Œå¯ä»¥åœ¨é€šçŸ¥ä»£ç ä½“å†…è·å–æŠ›å‡ºçš„å¼‚å¸¸ï¼Œä½¿ç”¨throwingå±æ€§å®šä¹‰å‚æ•°çš„åå­—æ¥ä¼ é€’å¼‚å¸¸ã€‚å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs applescript">&lt;aop:aspect <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;afterThrowingExample&quot;</span> <span class="hljs-keyword">ref</span>=<span class="hljs-string">&quot;aBean&quot;</span>&gt;<br>    &lt;aop:<span class="hljs-keyword">after</span>-throwing        pointcut-<span class="hljs-keyword">ref</span>=<span class="hljs-string">&quot;dataAccessOperation&quot;</span>        throwing=<span class="hljs-string">&quot;dataAccessEx&quot;</span>        method=<span class="hljs-string">&quot;doRecoveryActions&quot;</span>/&gt;<br>    ...<br>&lt;/aop:aspect&gt;<br></code></pre></td></tr></table></figure><p><code>doRecoveryActions</code>æ–¹æ³•å¿…é¡»å£°æ˜åä¸º <code>dataAccessEx</code>çš„å‚æ•°ã€‚æ­¤å‚æ•°çš„ç±»å‹çº¦æŸåŒ¹é…çš„æ–¹å¼ä¸<code>@AfterThrowing</code>æ‰€æè¿°çš„ç›¸åŒã€‚ ä¾‹å¦‚ï¼Œæ–¹æ³•ç­¾åå¯ä»¥å£°æ˜å¦‚ä¸‹:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">doRecoveryActions</span>(<span class="hljs-params">DataAccessException dataAccessEx</span>) &#123;...<br></code></pre></td></tr></table></figure><h5 id="åç½®é€šçŸ¥-æ€»ä¼šæ‰§è¡Œçš„"><a href="#åç½®é€šçŸ¥-æ€»ä¼šæ‰§è¡Œçš„" class="headerlink" title="åç½®é€šçŸ¥(æ€»ä¼šæ‰§è¡Œçš„)"></a>åç½®é€šçŸ¥(æ€»ä¼šæ‰§è¡Œçš„)</h5><p>å½“æ–¹æ³•æ‰§è¡Œå®Œæˆå¹¶é€€å‡ºåï¼Œåç½®é€šçŸ¥ä¼šè¢«æ‰§è¡Œ(è€Œä¸”æ˜¯æ€»ä¼šè¢«æ‰§è¡Œ)ã€‚å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs applescript">&lt;aop:aspect <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;afterFinallyExample&quot;</span> <span class="hljs-keyword">ref</span>=<span class="hljs-string">&quot;aBean&quot;</span>&gt;<br>    &lt;aop:<span class="hljs-keyword">after</span>        pointcut-<span class="hljs-keyword">ref</span>=<span class="hljs-string">&quot;dataAccessOperation&quot;</span>        method=<span class="hljs-string">&quot;doReleaseLock&quot;</span>/&gt;<br>    ...<br>&lt;/aop:aspect&gt;<br></code></pre></td></tr></table></figure><h5 id="ç¯ç»•é€šçŸ¥-1"><a href="#ç¯ç»•é€šçŸ¥-1" class="headerlink" title="ç¯ç»•é€šçŸ¥"></a>ç¯ç»•é€šçŸ¥</h5><p>æœ€åä¸€ç§é€šçŸ¥æ˜¯ç¯ç»•é€šçŸ¥. ç¯ç»•é€šçŸ¥ â€œaroundâ€ åŒ¹é…çš„æ–¹æ³•æ‰§è¡Œè¿è¡Œã€‚å®ƒæœ‰æœºä¼šåœ¨æ–¹æ³•æ‰§è¡Œä¹‹å‰å’Œä¹‹åè¿›è¡Œå·¥ä½œï¼Œå¹¶ç¡®å®šæ–¹æ³•ä½•æ—¶ã€ å¦‚ä½•ä»¥åŠç”šè‡³æ˜¯å¦çœŸæ­£æ‰§è¡Œã€‚ç¯ç»•é€šçŸ¥ç»å¸¸ç”¨äºéœ€è¦åœ¨æ–¹æ³•æ‰§è¡Œå‰æˆ–ååœ¨çº¿ç¨‹å®‰å…¨çš„æƒ…å†µä¸‹å…±äº«çŠ¶æ€ï¼ˆä¾‹å¦‚å¼€å§‹å’Œç»“æŸæ—¶é—´ï¼‰ã€‚ç¡®è®¤å¯ä½¿ç”¨çš„é€šçŸ¥å½¢å¼ï¼Œ è¦ç¬¦åˆæœ€å°åŒ¹é…åŸåˆ™ã€‚</p><p>æ‚¨å¯ä»¥ä½¿ç”¨<code>aop:around</code>å…ƒç´ å£°æ˜ç¯ç»•é€šçŸ¥ã€‚é€šçŸ¥æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯<code>ProceedingJoinPoint</code>ç±»å‹ã€‚åœ¨é€šçŸ¥ä»£ç ä½“ä¸­ï¼Œè°ƒç”¨<code>ProceedingJoinPoint</code>å®ç°çš„<code>proceed()</code>ä¼šä½¿åŒ¹é…çš„æ–¹æ³•ç»§ç»­æ‰§è¡Œã€‚ <code>proceed</code>æ–¹æ³•ä¹Ÿå¯ä»¥é€šè¿‡ä¼ é€’ <code>Object[]</code>â€“ æ•°ç»„çš„å€¼ç»™åŸæ–¹æ³•ä½œä¸ºä¼ å…¥å‚æ•°ã€‚æœ‰å…³è°ƒç”¨ç»§ç»­ä½¿ç”¨ <code>Object[]</code>çš„è¯´æ˜ï¼Œè¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-ataspectj-around-advice">ç¯ç»•é€šçŸ¥</a>ã€‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•åœ¨XMLä¸­å£°æ˜é€šçŸ¥ï¼š</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs applescript">&lt;aop:aspect <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;aroundExample&quot;</span> <span class="hljs-keyword">ref</span>=<span class="hljs-string">&quot;aBean&quot;</span>&gt;<br>    &lt;aop:<span class="hljs-keyword">around</span>        pointcut-<span class="hljs-keyword">ref</span>=<span class="hljs-string">&quot;businessService&quot;</span>        method=<span class="hljs-string">&quot;doBasicProfiling&quot;</span>/&gt;<br>    ...<br>&lt;/aop:aspect&gt;<br></code></pre></td></tr></table></figure><p><code>doBasicProfiling</code>é€šçŸ¥çš„è¿è¡Œä¸@AspectJç¤ºä¾‹ä¸­çš„å®Œå…¨ç›¸åŒï¼ˆå½“ç„¶çœç•¥äº†æ³¨è§£ï¼‰ã€‚å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-keyword">public</span> <span class="hljs-function">Object <span class="hljs-title">doBasicProfiling</span><span class="hljs-params">(ProceedingJoinPoint pjp)</span> <span class="hljs-keyword">throws</span> Throwable </span>&#123;<br><br>    <span class="hljs-comment">// start stopwatch</span><br><br>    Object retVal = pjp.<span class="hljs-keyword">proceed</span>();<br><br>    <span class="hljs-comment">// stop stopwatch</span><br><br>    <span class="hljs-keyword">return</span> retVal;<br><br>&#125;<br></code></pre></td></tr></table></figure><h5 id="é€šçŸ¥å‚æ•°"><a href="#é€šçŸ¥å‚æ•°" class="headerlink" title="é€šçŸ¥å‚æ•°"></a>é€šçŸ¥å‚æ•°</h5><p>åŸºäºschemaçš„å£°æ˜æ ·å¼æ”¯æŒæ‰€æœ‰ç±»å‹çš„é€šçŸ¥ï¼Œå…¶æ–¹å¼ä¸@AspectJæ”¯æŒçš„æè¿°ç›¸åŒ - é€šè¿‡æŒ‰åç§°åŒ¹é…åˆ‡ç‚¹å‚æ•°ä¸é€šçŸ¥æ–¹æ³•å‚æ•°ç›¸åŒ¹é…ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-ataspectj-advice-params">é€šçŸ¥å‚æ•°</a>ã€‚ å¦‚æœå¸Œæœ›æ˜¾å¼æŒ‡å®šé€šçŸ¥æ–¹æ³•çš„å‚æ•°åç§°ï¼ˆä¸ä¾èµ–äºå‰é¢æè¿°çš„æ£€æµ‹ç­–ç•¥ï¼‰åˆ™ä½¿ç”¨é€šçŸ¥å…ƒç´ çš„<code>arg-names</code>å±æ€§æ¥å®Œæˆè¿™ä¸€æ“ä½œã€‚å…¶å¤„ç†æ–¹å¼å’Œé€šçŸ¥æ³¨è§£ä¸­çš„<code>argNames</code>å±æ€§æ˜¯ç›¸åŒçš„ï¼Œ åœ¨é€šçŸ¥æ³¨è§£ä¸­ï¼ˆå¦‚<a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-ataspectj-advice-params-names">ç¡®å®šå‚æ•°åç§°</a>ä¸­æ‰€è¿°ï¼‰ã€‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•åœ¨XMLä¸­æŒ‡å®šå‚æ•°åç§°:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;aop:before<br><br>    <span class="hljs-attribute">pointcut</span>=<span class="hljs-string">&quot;com.xyz.lib.Pointcuts.anyPublicMethod() and @annotation(auditable)&quot;</span><br><br>    <span class="hljs-attribute">method</span>=<span class="hljs-string">&quot;audit&quot;</span><br><br>    <span class="hljs-attribute">arg-names</span>=<span class="hljs-string">&quot;auditable&quot;</span>/&gt;<br></code></pre></td></tr></table></figure><p><code>arg-names</code> å±æ€§æ¥å—ä»¥é€—å·åˆ†éš”çš„å‚æ•°åç§°åˆ—è¡¨ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªåŸºäºXSDæ–¹å¼çš„å¤šè°ƒç”¨ç¤ºä¾‹ï¼Œå®ƒè¯´æ˜ç¯ç»•é€šçŸ¥æ˜¯å¦‚ä½•ä¸ä¸€äº›å¼ºç±»å‹å‚æ•°å…±åŒä½¿ç”¨çš„:</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-keyword">package</span> x.y.service;<br><span class="hljs-keyword">public</span> <span class="hljs-title class_"><span class="hljs-keyword">interface</span> <span class="hljs-title">PersonService</span> </span>&#123;<br>    Person getPerson(<span class="hljs-keyword">String</span> personName, int age);&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-title class_"><span class="hljs-keyword">class</span> <span class="hljs-title">DefaultFooService</span> <span class="hljs-keyword"><span class="hljs-keyword">implements</span> <span class="hljs-type">FooService</span></span> </span>&#123;<br>    <span class="hljs-keyword">public</span> Person getPerson(<span class="hljs-keyword">String</span> name, int age) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-type">Person</span>(name, age);    &#125;&#125;<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å®šä¹‰åˆ‡é¢ã€‚è¯·æ³¨æ„ï¼Œ<code>profile(..)</code>æ–¹æ³•æ¥å—è®¸å¤šå¼ºç±»å‹å‚æ•°ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªæ˜¯ç”¨äºæ–¹æ³•è°ƒç”¨çš„è¿æ¥ç‚¹ã€‚è¿™ä¸ªå‚æ•°ç”¨äºå£°æ˜<code>profile(..)</code>ä½œä¸ºç¯ç»•é€šçŸ¥æ¥ä½¿ç”¨ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">package x.y;<br><span class="hljs-keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;<span class="hljs-keyword">import</span> org.springframework.util.StopWatch;<br><span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> SimpleProfiler &#123;<br>    <span class="hljs-built_in">public</span> <span class="hljs-keyword">Object</span> profile(ProceedingJoinPoint <span class="hljs-keyword">call</span>, String <span class="hljs-type">name</span>, <span class="hljs-type">int</span> age) throws Throwable &#123;        StopWatch clock = <span class="hljs-built_in">new</span> StopWatch(&quot;Profiling for &#x27;&quot; + <span class="hljs-type">name</span> + &quot;&#x27; and &#x27;&quot; + age + &quot;&#x27;&quot;);        try &#123;            clock.<span class="hljs-keyword">start</span>(<span class="hljs-keyword">call</span>.toShortString());            <span class="hljs-keyword">return</span> <span class="hljs-keyword">call</span>.proceed();        &#125; finally &#123;            clock.stop();            <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(clock.prettyPrint());        &#125;    &#125;&#125;<br></code></pre></td></tr></table></figure><p>æœ€åï¼Œä¸‹é¢æ˜¯ä¸ºç‰¹å®šè¿æ¥ç‚¹æ‰§è¡Œä¸Šè¿°å»ºè®®æ‰€éœ€çš„XMLé…ç½®:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span>    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>    <span class="hljs-attr">xmlns:aop</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/aop&quot;</span>    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- this is the object that will be proxied by Spring&#x27;s AOP infrastructure --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;personService&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;x.y.service.DefaultPersonService&quot;</span>/&gt;</span><br>    <span class="hljs-comment">&lt;!-- this is the actual advice itself --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;profiler&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;x.y.SimpleProfiler&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">aop:config</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">aop:aspect</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;profiler&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;theExecutionOfSomePersonServiceMethod&quot;</span>                <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;execution(* x.y.service.PersonService.getPerson(String,int))                and args(name, age)&quot;</span>/&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">aop:around</span> <span class="hljs-attr">pointcut-ref</span>=<span class="hljs-string">&quot;theExecutionOfSomePersonServiceMethod&quot;</span>                <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;profile&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">aop:aspect</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">aop:config</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><p>è¯·è€ƒè™‘ä»¥ä¸‹é©±åŠ¨ç¨‹åºè„šæœ¬:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.springframework.beans.factory.BeanFactory;<span class="hljs-keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;<span class="hljs-keyword">import</span> x.y.service.PersonService;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Boot</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-keyword">final</span> String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;        <span class="hljs-type">BeanFactory</span> <span class="hljs-variable">ctx</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathXmlApplicationContext</span>(<span class="hljs-string">&quot;x/y/plain.xml&quot;</span>);        <span class="hljs-type">PersonService</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> (PersonService) ctx.getBean(<span class="hljs-string">&quot;personService&quot;</span>);        person.getPerson(<span class="hljs-string">&quot;Pengo&quot;</span>, <span class="hljs-number">12</span>);    &#125;&#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨è¿™æ ·çš„Bootç±»ï¼Œæˆ‘ä»¬å°†åœ¨æ ‡å‡†è¾“å‡ºä¸Šè·å¾—ç±»ä¼¼äºä»¥ä¸‹å†…å®¹çš„è¾“å‡ºï¼š:</p><p>StopWatch â€˜Profiling for â€˜Pengoâ€™ and â€˜12â€: running time (millis) &#x3D; 0 â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“ ms % Task name â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“ 00000 ? execution(getFoo)</p><h5 id="é€šçŸ¥çš„é¡ºåº-1"><a href="#é€šçŸ¥çš„é¡ºåº-1" class="headerlink" title="é€šçŸ¥çš„é¡ºåº"></a>é€šçŸ¥çš„é¡ºåº</h5><p>å½“å¤šä¸ªé€šçŸ¥éœ€è¦åœ¨åŒä¸€ä¸ªè¿æ¥ç‚¹ï¼ˆæ‰§è¡Œæ–¹æ³•ï¼‰æ‰§è¡Œæ—¶ï¼Œæ’åºè§„åˆ™å¦‚<a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-ataspectj-advice-ordering">é€šçŸ¥æ’åº</a>ä¸­æ‰€è¿°ã€‚ æ–¹é¢ä¹‹é—´çš„ä¼˜å…ˆçº§æ˜¯é€šè¿‡å°†<code>Order</code>æ³¨é‡Šæ·»åŠ åˆ°æ”¯æŒæ–¹é¢çš„beanæˆ–é€šè¿‡è®©beanå®ç° <code>Ordered</code>æ¥å£æ¥ç¡®å®šçš„ã€‚</p><h4 id="2-5-4-å¼•å…¥"><a href="#2-5-4-å¼•å…¥" class="headerlink" title="2.5.4. å¼•å…¥"></a>2.5.4. å¼•å…¥</h4><p>å¼•å…¥ï¼ˆä½œä¸ºAspectJä¸­å†…éƒ¨ç±»å‹çš„å£°æ˜ï¼‰å…è®¸åˆ‡é¢å®šä¹‰é€šçŸ¥çš„å¯¹è±¡å®ç°ç»™å®šçš„æ¥å£ï¼Œå¹¶ä»£è¡¨è¿™äº›å¯¹è±¡æä¾›è¯¥æ¥å£çš„å®ç°ã€‚</p><p>æ‚¨å¯ä»¥åœ¨<code>aop:aspect</code>ä¸­ä½¿ç”¨<code>aop:declare-parents</code>å…ƒç´ è¿›è¡Œå¼•å…¥ã€‚ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨<code>aop:declare-parents</code>å…ƒç´ å£°æ˜åŒ¹é…ç±»å‹å…·æœ‰çˆ¶çº§ï¼ˆå› æ­¤åç§°ï¼‰ã€‚ ä¾‹å¦‚ï¼Œç»™å®šåä¸º<code>UsageTracked</code>çš„æ¥å£å’Œåä¸º<code>DefaultUsageTracked</code>çš„æ¥å£çš„å®ç°ï¼Œä»¥ä¸‹æ–¹é¢å£°æ˜æœåŠ¡æ¥å£çš„æ‰€æœ‰å®ç°è€…ä¹Ÿå®ç°<code>UsageTracked</code> æ¥å£ã€‚ ï¼ˆä¾‹å¦‚ï¼Œä¸ºäº†é€šè¿‡JMXå…¬å¼€ç»Ÿè®¡ä¿¡æ¯ã€‚ï¼‰</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">&lt;aop:aspect id=&quot;usageTrackerAspect&quot; <span class="hljs-keyword">ref</span>=&quot;usageTracking&quot;&gt;<br>    &lt;aop:<span class="hljs-keyword">declare</span>-parents        <span class="hljs-keyword">types</span>-matching=&quot;com.xzy.myapp.service.*+&quot;        implement-interface=&quot;com.xyz.myapp.service.tracking.UsageTracked&quot;        <span class="hljs-keyword">default</span>-impl=&quot;com.xyz.myapp.service.tracking.DefaultUsageTracked&quot;/&gt;<br>    &lt;aop:<span class="hljs-keyword">before</span>        pointcut=&quot;com.xyz.myapp.SystemArchitecture.businessService()            and this(usageTracked)&quot;            <span class="hljs-keyword">method</span>=&quot;recordUsage&quot;/&gt;<br>&lt;/aop:aspect&gt;<br></code></pre></td></tr></table></figure><p>ç„¶åï¼Œæ”¯æŒ<code>usageTracking</code>beançš„ç±»å°†åŒ…å«ä»¥ä¸‹æ–¹æ³•:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">recordUsage</span>(<span class="hljs-params">UsageTracked usageTracked</span>) &#123;<br><br>    usageTracked.<span class="hljs-title function_">incrementUseCount</span>();<br><br>&#125;<br></code></pre></td></tr></table></figure><p>è¦å®ç°çš„æ¥å£ç”±<code>implement-interface</code>å±æ€§ç¡®å®šã€‚<code>types-matching</code>å±æ€§çš„å€¼æ˜¯AspectJç±»å‹æ¨¡å¼ã€‚ä»»ä½•åŒ¹é…ç±»å‹çš„beanéƒ½å°†å®ç°<code>UsageTracked</code>æ¥å£ã€‚ è¯·æ³¨æ„ï¼Œåœ¨å‰é¢çš„ç¤ºä¾‹çš„é€šçŸ¥ä¸­ï¼ŒæœåŠ¡beanå¯ä»¥ç›´æ¥ç”¨ä½œ<code>UsageTracked</code>æ¥å£çš„å®ç°ã€‚è¦ä»¥ç¼–ç¨‹æ–¹å¼è®¿é—®beanï¼Œæ‚¨å¯ä»¥ç¼–å†™ä»¥ä¸‹ä»£ç :</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">UsageTracked usageTracked <span class="hljs-operator">=</span> (UsageTracked) context.getBean(<span class="hljs-string">&quot;myService&quot;</span>)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><h4 id="2-5-5-åˆ‡é¢å®ä¾‹åŒ–æ¨¡å‹"><a href="#2-5-5-åˆ‡é¢å®ä¾‹åŒ–æ¨¡å‹" class="headerlink" title="2.5.5. åˆ‡é¢å®ä¾‹åŒ–æ¨¡å‹"></a>2.5.5. åˆ‡é¢å®ä¾‹åŒ–æ¨¡å‹</h4><p>å”¯ä¸€å—æ”¯æŒçš„schemaå®šä¹‰çš„å®ä¾‹åŒ–æ¨¡å‹æ˜¯å•ä¾‹æ¨¡å‹ï¼Œåœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½æ”¯æŒå…¶ä»–å®ä¾‹åŒ–æ¨¡å‹ã€‚</p><h4 id="2-5-6-é€šçŸ¥è€…"><a href="#2-5-6-é€šçŸ¥è€…" class="headerlink" title="2.5.6. é€šçŸ¥è€…"></a>2.5.6. é€šçŸ¥è€…</h4><p>é€šçŸ¥è€…çš„æ¦‚å¿µæ˜¯åœ¨Spring 1.2ä¸­æå‡ºçš„ï¼Œèƒ½è¢«AOPæ”¯æŒã€‚è€Œåœ¨AspectJä¸­æ²¡æœ‰ç­‰ä»·çš„æ¦‚å¿µã€‚é€šçŸ¥è€…å°±åƒè¿·ä½ çš„åˆ‡é¢ï¼ŒåŒ…å«å•ä¸€çš„é€šçŸ¥ã€‚é€šçŸ¥æœ¬èº«å¯ä»¥é€šè¿‡beanæ¥ä»£è¡¨ï¼Œå¹¶ä¸”å¿…é¡»å®ç°Springä¸­çš„<a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-api-advice-types">é€šçŸ¥ç±»å‹</a>ä¸­æè¿°çš„é€šçŸ¥æ¥å£ä¹‹ä¸€ï¼Œ é€šçŸ¥è€…å¯ä»¥åˆ©ç”¨AspectJçš„åˆ‡ç‚¹è¡¨è¾¾å¼</p><p>Springä½¿ç”¨<code>&lt;aop:advisor&gt;</code>å…ƒç´ æ”¯æŒé€šçŸ¥è€…æ¦‚å¿µã€‚é€šå¸¸ä¼šçœ‹åˆ°å®ƒä¸äº‹åŠ¡æ€§é€šçŸ¥ä¸€èµ·ä½¿ç”¨ï¼Œå®ƒåœ¨Springä¸­ä¹Ÿæœ‰è‡ªå·±çš„å‘½åç©ºé—´æ”¯æŒã€‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†ä¸€ä¸ªé€šçŸ¥è€…:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">aop:config</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;businessService&quot;</span>        <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;execution(* com.xyz.myapp.service.*.*(..))&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">aop:advisor</span>        <span class="hljs-attr">pointcut-ref</span>=<span class="hljs-string">&quot;businessService&quot;</span>        <span class="hljs-attr">advice-ref</span>=<span class="hljs-string">&quot;tx-advice&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">aop:config</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">tx:advice</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;tx-advice&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">tx:attributes</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">tx:method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;*&quot;</span> <span class="hljs-attr">propagation</span>=<span class="hljs-string">&quot;REQUIRED&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">tx:attributes</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tx:advice</span>&gt;</span><br></code></pre></td></tr></table></figure><p>é™¤äº†å‰é¢ç¤ºä¾‹ä¸­ä½¿ç”¨çš„<code>pointcut-ref</code>å±æ€§ä¹‹å¤–ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨åˆ‡ç‚¹å±æ€§æ¥å†…è”å®šä¹‰åˆ‡ç‚¹è¡¨è¾¾å¼ã€‚</p><p>å¦‚æœæƒ³å°†é€šçŸ¥æ’åºï¼Œå¯ä»¥å®šä¹‰é€šçŸ¥è€…çš„ä¼˜å…ˆçº§ã€‚åœ¨é€šçŸ¥è€…ä¸Šå¯ä»¥ä½¿ç”¨<code>order</code>å±æ€§æ¥å®šä¹‰<code>Ordered</code>å€¼ã€‚</p><h4 id="2-5-7-AOP-Schema-ä¾‹å­"><a href="#2-5-7-AOP-Schema-ä¾‹å­" class="headerlink" title="2.5.7. AOP Schema ä¾‹å­"></a>2.5.7. AOP Schema ä¾‹å­</h4><p>æœ¬èŠ‚è¯´æ˜å¦‚ä½•ä½¿ç”¨Schemaæ”¯æŒé‡å†™<a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-ataspectj-example">An AOP Example</a>ç¤ºä¾‹ä¸­çš„å¹¶å‘é”å®šå¤±è´¥é‡è¯•ç¤ºä¾‹ã€‚</p><p>ç”±äºå¹¶å‘é—®é¢˜ï¼ˆä¾‹å¦‚ï¼Œæ­»é”å¤±è´¥è€…ï¼‰ï¼Œä¸šåŠ¡æœåŠ¡çš„æ‰§è¡Œæœ‰æ—¶ä¼šå¤±è´¥ã€‚å¦‚æœé‡è¯•è¯¥æ“ä½œï¼Œåˆ™å¯èƒ½åœ¨ä¸‹æ¬¡å°è¯•æ—¶æˆåŠŸã€‚å¯¹äºé€‚åˆåœ¨è¿™ç§æƒ…å†µä¸‹é‡è¯•çš„ä¸šåŠ¡æœåŠ¡ï¼ˆä¸éœ€è¦è¿”å›ç»™ç”¨æˆ·æ¥è§£å†³å†²çªçš„å¹‚ç­‰æ“ä½œï¼‰ã€‚ å¸Œæœ›é€æ˜åœ°é‡è¯•è¯¥æ“ä½œï¼Œä»¥é¿å…å®¢æˆ·ç«¯çœ‹åˆ°<code>PessimisticLockingFailureException</code>å¼‚å¸¸ã€‚è¿™ä¸ªéœ€æ±‚å¾ˆæ˜æ˜¾ï¼Œå®ƒè·¨è¶Šäº†æœåŠ¡å±‚ä¸­çš„å¤šä¸ªæœåŠ¡ï¼Œå› æ­¤éå¸¸é€‚åˆé€šè¿‡åˆ‡é¢æ¥å®ç°ã€‚</p><p>å› ä¸ºæˆ‘ä»¬æƒ³è¦é‡è¯•æ“ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨ç¯ç»•é€šçŸ¥ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥å¤šæ¬¡è°ƒç”¨<code>proceed</code>ã€‚ ä»¥ä¸‹æ¸…å•æ˜¾ç¤ºäº†åŸºæœ¬æ–¹é¢çš„å®ç°ï¼ˆä½¿ç”¨Schemaæ”¯æŒçš„å¸¸è§„Javaç±»ï¼‰:</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs axapta"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConcurrentOperationExecutor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_ inherited__">Ordered</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> DEFAULT_MAX_RETRIES = <span class="hljs-number">2</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> maxRetries = DEFAULT_MAX_RETRIES;    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> <span class="hljs-keyword">order</span> = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> setMaxRetries(<span class="hljs-built_in">int</span> maxRetries) &#123;        <span class="hljs-keyword">this</span>.maxRetries = maxRetries;    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> getOrder() &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.<span class="hljs-keyword">order</span>;    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> setOrder(<span class="hljs-built_in">int</span> <span class="hljs-keyword">order</span>) &#123;        <span class="hljs-keyword">this</span>.<span class="hljs-keyword">order</span> = <span class="hljs-keyword">order</span>;    &#125;<br>    <span class="hljs-keyword">public</span> Object doConcurrentOperation(ProceedingJoinPoint pjp) throws Throwable &#123;        <span class="hljs-built_in">int</span> numAttempts = <span class="hljs-number">0</span>;        PessimisticLockingFailureException lockFailureException;        <span class="hljs-keyword">do</span> &#123;            numAttempts++;            <span class="hljs-keyword">try</span> &#123;                <span class="hljs-keyword">return</span> pjp.proceed();            &#125;            <span class="hljs-keyword">catch</span>(PessimisticLockingFailureException ex) &#123;                lockFailureException = ex;            &#125;        &#125; <span class="hljs-keyword">while</span>(numAttempts &lt;= <span class="hljs-keyword">this</span>.maxRetries);        <span class="hljs-keyword">throw</span> lockFailureException;    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œè¯¥æ–¹é¢å®ç°äº†<code>Ordered</code>æ¥å£ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥å°†åˆ‡é¢çš„ä¼˜å…ˆçº§è®¾ç½®ä¸ºé«˜äºäº‹åŠ¡é€šçŸ¥ï¼ˆæˆ‘ä»¬æ¯æ¬¡é‡è¯•æ—¶éƒ½éœ€è¦ä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼‰ã€‚ <code>maxRetries</code>å’Œ<code>order</code>å±æ€§éƒ½ç”±Springé…ç½®ã€‚ä¸»è¦çš„æ“ä½œæ˜¯åœ¨<code>doConcurrentOperation</code>çš„ç¯ç»•é€šçŸ¥ä¸­ã€‚è¯·æ³¨æ„ï¼Œè¯·æ³¨æ„ï¼Œç›®å‰ï¼Œæˆ‘ä»¬å°†é‡è¯•é€»è¾‘åº”ç”¨äºæ¯ä¸ª <code>businessService()</code>ã€‚ å°è¯•æ‰§è¡Œæ—¶ï¼Œå¦‚æœå¤±è´¥äº†ï¼Œå°†äº§ç”Ÿ<code>PessimisticLockingFailureException</code>å¼‚å¸¸ï¼Œä½†æ˜¯ä¸ç”¨ç®¡å®ƒï¼Œåªéœ€å†æ¬¡å°è¯•æ‰§è¡Œå³å¯ï¼Œé™¤éå·²ç»ç”¨å°½æ‰€æœ‰çš„é‡è¯•æ¬¡æ•°ã€‚</p><p>æ­¤ç±»ä¸@AspectJç¤ºä¾‹ä¸­ä½¿ç”¨çš„ç±»ç›¸åŒï¼Œä½†åˆ é™¤äº†æ³¨é‡Šã€‚</p><p>ç›¸åº”çš„Springé…ç½®å¦‚ä¸‹:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">aop:config</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">aop:aspect</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;concurrentOperationRetry&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;concurrentOperationExecutor&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;idempotentOperation&quot;</span>            <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;execution(* com.xyz.myapp.service.*.*(..))&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">aop:around</span>            <span class="hljs-attr">pointcut-ref</span>=<span class="hljs-string">&quot;idempotentOperation&quot;</span>            <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;doConcurrentOperation&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">aop:aspect</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">aop:config</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;concurrentOperationExecutor&quot;</span>    <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.xyz.myapp.service.impl.ConcurrentOperationExecutor&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;maxRetries&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;3&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;order&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;100&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œåœ¨å½“æ—¶ï¼Œæˆ‘ä»¬å‡è®¾æ‰€æœ‰ä¸šåŠ¡æœåŠ¡éƒ½æ˜¯å¹‚ç­‰çš„ã€‚å¦‚æœä¸æ˜¯è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¼•å…¥<code>Idempotent</code>æ³¨è§£å¹¶ä½¿ç”¨æ³¨è§£æ¥æ³¨è§£æœåŠ¡æ“ä½œçš„å®ç°æ¥ä¼˜åŒ–åˆ‡é¢ï¼Œä½¿å…¶é‡è¯•æ—¶æ˜¯å¹‚ç­‰æ“ä½œï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Retention</span>(RetentionPolicy.RUNTIME)<br><br>public <span class="hljs-variable">@interface</span> Idempotent &#123;<br><br>    <span class="hljs-comment">// marker annotation</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p>å¯¹åˆ‡é¢çš„æ›´æ”¹åªéœ€è¦é‡è¯•ç­‰å¹‚è¿ç®—ï¼Œåªéœ€ç»†åŒ–åˆ‡ç‚¹è¡¨è¾¾å¼ï¼Œä»¥ä¾¿åªåŒ¹é…<code>@Idempotent</code>æ“ä½œï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;aop:pointcut <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;idempotentOperation&quot;</span><br><br>        <span class="hljs-attribute">expression</span>=<span class="hljs-string">&quot;execution(* com.xyz.myapp.service.*.*(..)) and</span><br><span class="hljs-string"></span><br><span class="hljs-string">        @annotation(com.xyz.myapp.service.Idempotent)&quot;</span>/&gt;<br></code></pre></td></tr></table></figure><h3 id="2-6-é€‰æ‹©è¦ä½¿ç”¨çš„AOPå£°æ˜æ ·å¼"><a href="#2-6-é€‰æ‹©è¦ä½¿ç”¨çš„AOPå£°æ˜æ ·å¼" class="headerlink" title="2.6. é€‰æ‹©è¦ä½¿ç”¨çš„AOPå£°æ˜æ ·å¼"></a>2.6. é€‰æ‹©è¦ä½¿ç”¨çš„AOPå£°æ˜æ ·å¼</h3><p>ä¸€æ—¦ç¡®å®šæŸä¸ªåˆ‡é¢æ˜¯å®ç°ç»™å®šéœ€æ±‚çš„æœ€ä½³æ–¹æ³•ï¼Œæ‚¨å¦‚ä½•å†³å®šä½¿ç”¨Spring AOPæˆ–AspectJä»¥åŠAspectè¯­è¨€ï¼ˆä»£ç ï¼‰æ ·å¼ï¼Œ @ AspectJæ³¨è§£æ ·å¼è¿˜æ˜¯Spring XMLæ ·å¼ï¼Ÿ è¿™äº›å†³ç­–å—åˆ°è®¸å¤šå› ç´ çš„å½±å“ï¼ŒåŒ…æ‹¬åº”ç”¨ç¨‹åºè¦æ±‚ï¼Œå¼€å‘å·¥å…·å’Œå›¢é˜Ÿå¯¹AOPçš„ç†Ÿæ‚‰ç¨‹åº¦ã€‚</p><h4 id="2-6-1-ä½¿ç”¨Spring-AOPè¿˜æ˜¯å…¨é¢ä½¿ç”¨AspectJ"><a href="#2-6-1-ä½¿ç”¨Spring-AOPè¿˜æ˜¯å…¨é¢ä½¿ç”¨AspectJ" class="headerlink" title="2.6.1. ä½¿ç”¨Spring AOPè¿˜æ˜¯å…¨é¢ä½¿ç”¨AspectJ?"></a>2.6.1. ä½¿ç”¨Spring AOPè¿˜æ˜¯å…¨é¢ä½¿ç”¨AspectJ?</h4><p>ä½¿ç”¨æœ€ç®€å•çš„æ–¹æ³•ã€‚ Spring AOPæ¯”ä½¿ç”¨å®Œæ•´çš„AspectJæ›´ç®€å•ï¼Œå› ä¸ºä¸éœ€è¦åœ¨å¼€å‘å’Œæ„å»ºè¿‡ç¨‹ä¸­å¼•å…¥AspectJç¼–è¯‘å™¨&#x2F; ç¼–ç»‡å™¨ã€‚å¦‚æœåªæ˜¯éœ€è¦åœ¨Spring beanä¸Šæ‰§è¡Œé€šçŸ¥æ“ä½œï¼Œé‚£ä¹ˆä½¿ç”¨Spring AOPæ˜¯æ­£ç¡®çš„é€‰æ‹©ã€‚ å¦‚æœéœ€è¦çš„é€šçŸ¥ä¸æ˜¯ç”±Springå®¹å™¨ç®¡ç†çš„å¯¹è±¡ï¼ˆé€šå¸¸æ˜¯åŸŸå¯¹è±¡ï¼‰ï¼Œé‚£ä¹ˆå°±éœ€è¦ä½¿ç”¨AspectJã€‚å¦‚æœæƒ³ä½¿ç”¨é€šçŸ¥è¿æ¥ç‚¹è€Œä¸æ˜¯ç®€å•çš„æ–¹æ³•æ‰§è¡Œï¼Œä¹Ÿéœ€è¦ä½¿ç”¨AspectJï¼ˆä¾‹å¦‚ï¼Œå­—æ®µè·å–æˆ–è®¾ç½®è¿æ¥ç‚¹ç­‰ï¼‰ï¼Œåˆ™è¿˜éœ€è¦ä½¿ç”¨AspectJã€‚</p><p>ä½¿ç”¨AspectJæ—¶ï¼Œæ‚¨å¯ä»¥é€‰æ‹©AspectJè¯­è¨€è¯­æ³•ï¼ˆä¹Ÿç§°ä¸ºâ€œä»£ç æ ·å¼â€ï¼‰æˆ–@AspectJæ³¨é‡Šæ ·å¼ã€‚æ˜¾ç„¶ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨Java 5+ç‰ˆæœ¬é‚£ä¹ˆé€‰æ‹©å·²ç»ç¡®å®šäº†â€¦ä½¿ç”¨ä»£ç æ–¹å¼ã€‚ å¦‚æœåˆ‡é¢åœ¨ä½ çš„è®¾è®¡ä¸­æ‰®æ¼”é‡è¦è§’è‰²ï¼Œå¹¶ä¸”æƒ³ä½¿ç”¨é’ˆå¯¹Eclipseçš„<a href="https://www.eclipse.org/ajdt/">AspectJå¼€å‘å·¥å…·ï¼ˆAJDTï¼‰</a> æ’ä»¶ï¼Œé‚£ä¹ˆAspectJè¯­è¨€è¯­æ³•æ˜¯é¦–é€‰é¡¹ï¼šå®ƒæ›´æ¸…æ™°å’Œæ›´ç®€å•ï¼Œå› ä¸ºè¯­è¨€æ˜¯ä¸“é—¨ç”¨äºç¼–å†™åˆ‡é¢çš„ã€‚ å¦‚æœæ²¡æœ‰ä½¿ç”¨Eclipseï¼Œæˆ–è€…åªæœ‰ä¸€äº›åˆ‡é¢åœ¨åº”ç”¨ç¨‹åºä¸­ä¸èµ·ä¸»è¦ä½œç”¨ï¼Œé‚£ä¹ˆå¯èƒ½éœ€è¦è€ƒè™‘ä½¿ç”¨@AspectJæ–¹å¼ï¼Œå¹¶åœ¨IDEä¸­ä½¿ç”¨å¸¸è§„Javaç¼–è¯‘ï¼Œå¹¶åŠ å…¥åˆ‡é¢ç¼–ç»‡é˜¶æ®µæ„å»ºçš„è„šæœ¬ã€‚</p><h4 id="2-6-2-é€‰æ‹©-AspectJæ³¨è§£è¿˜æ˜¯Spring-AOPçš„XMLé…ç½®"><a href="#2-6-2-é€‰æ‹©-AspectJæ³¨è§£è¿˜æ˜¯Spring-AOPçš„XMLé…ç½®" class="headerlink" title="2.6.2. é€‰æ‹©@AspectJæ³¨è§£è¿˜æ˜¯Spring AOPçš„XMLé…ç½®?"></a>2.6.2. é€‰æ‹©@AspectJæ³¨è§£è¿˜æ˜¯Spring AOPçš„XMLé…ç½®?</h4><p>å¦‚æœæ‚¨é€‰æ‹©ä½¿ç”¨Spring AOPï¼Œåˆ™å¯ä»¥é€‰æ‹©@AspectJæˆ–XMLæ ·å¼ã€‚ éœ€è¦è€ƒè™‘å„ç§æƒè¡¡ã€‚</p><p>XMLæ ·å¼å¯èƒ½æ˜¯ç°æœ‰Springç”¨æˆ·æœ€ç†Ÿæ‚‰çš„ï¼Œå¹¶ä¸”ç”±çœŸæ­£çš„POJOæ”¯æŒã€‚å½“ä½¿ç”¨AOPä½œä¸ºä¸€ç§å·¥å…·æ¥é…ç½®ä¼ä¸šæœåŠ¡æ—¶ï¼Œ XMLå°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼ˆå¯ä»¥ç”¨ä»¥ä¸‹æ–¹æ³•æµ‹è¯•ï¼šæ˜¯å¦è®¤ä¸ºåˆ‡å…¥ç‚¹è¡¨è¾¾å¼æ˜¯æƒ³è¦ç‹¬ç«‹æ”¹å˜çš„é…ç½®çš„ä¸€éƒ¨åˆ†ï¼‰ã€‚ ä½¿ç”¨XMLé…ç½®çš„æ–¹å¼ï¼Œå¯ä»¥ä»é…ç½®ä¸­æ›´æ¸…æ¥šåœ°äº†è§£ç³»ç»Ÿä¸­å­˜åœ¨å“ªäº›åˆ‡é¢ã€‚</p><p>XMLæ ·å¼æœ‰ä¸¤ä¸ªç¼ºç‚¹ã€‚é¦–å…ˆï¼Œå®ƒå¹¶æ²¡æœ‰æŒ‰å®ç°çš„è¦æ±‚å®Œå…¨å°è£…åˆ°å•ä¸ªåœ°æ–¹ã€‚DRYåŸåˆ™æ˜¯è¯´ï¼šåœ¨ä»»ä½•çŸ¥è¯†ç³»ç»Ÿä¸­ï¼Œåº”è¯¥æœ‰ä¸€ä¸ªå•ä¸€çš„ã€æ˜ç¡®çš„ã€æƒå¨çš„èŒè´£ã€‚ä½¿ç”¨XMLçš„æ ·å¼æ—¶ï¼Œå¦‚æœè¦æ±‚çš„çŸ¥è¯†æ˜¯å®ç°æ‹†åˆ†çš„beanç±»çš„å£°æ˜ï¼Œå¹¶ä¸”æ˜¯é…ç½®åœ¨æ–‡ä»¶çš„XMLä¸­ã€‚ å½“ä½¿ç”¨@AspectJçš„é£æ ¼å®ç°å•ä¸€çš„æ¨¡å—æ—¶ï¼Œåˆ‡é¢çš„ä¿¡æ¯æ˜¯å°è£…çš„ã€‚å…¶æ¬¡ï¼ŒXMLçš„æ ·å¼åœ¨èƒ½è¡¨è¾¾çš„åŠŸèƒ½æ–¹é¢æ¯”@AspectJé£æ ¼çš„æœ‰æ›´å¤šçš„é™åˆ¶ï¼Œåªæœ‰â€œsingletonâ€åˆ‡é¢çš„å®ä¾‹åŒ–æ¨¡å¼å¾—åˆ°æ”¯æŒï¼Œè¿™åœ¨XMLå£°æ˜çš„åˆ‡ç‚¹ä¸­æ˜¯ä¸å¯èƒ½çš„ã€‚ ä¾‹å¦‚ï¼Œåœ¨@AspectJæ ·å¼ä¸­ï¼Œæ‚¨å¯ä»¥ç¼–å†™å¦‚ä¸‹å†…å®¹:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Pointcut</span>(<span class="hljs-string">&quot;execution(* get*())&quot;</span>)public void <span class="hljs-built_in">propertyAccess</span>() &#123;&#125;<br><span class="hljs-variable">@Pointcut</span>(<span class="hljs-string">&quot;execution(org.xyz.Account+ *(..))&quot;</span>)public void <span class="hljs-built_in">operationReturningAnAccount</span>() &#123;&#125;<br><span class="hljs-variable">@Pointcut</span>(<span class="hljs-string">&quot;propertyAccess() &amp;&amp; operationReturningAnAccount()&quot;</span>)public void <span class="hljs-built_in">accountPropertyAccess</span>() &#123;&#125;<br></code></pre></td></tr></table></figure><p>åœ¨XMLæ ·å¼ä¸­ï¼Œæ‚¨å¯ä»¥å£°æ˜å‰ä¸¤ä¸ªåˆ‡å…¥ç‚¹:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;aop:pointcut <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;propertyAccess&quot;</span>        <span class="hljs-attribute">expression</span>=<span class="hljs-string">&quot;execution(* get*())&quot;</span>/&gt;<br>&lt;aop:pointcut <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;operationReturningAnAccount&quot;</span>        <span class="hljs-attribute">expression</span>=<span class="hljs-string">&quot;execution(org.xyz.Account+ *(..))&quot;</span>/&gt;<br></code></pre></td></tr></table></figure><p>XMLçš„æ–¹æ³•çš„ç¼ºç‚¹æ˜¯ï¼Œæ‚¨æ— æ³•é€šè¿‡ç»„åˆè¿™äº›å®šä¹‰æ¥å®šä¹‰<code>accountPropertyAccess</code>åˆ‡ç‚¹ã€‚</p><p>@AspectJçš„é£æ ¼æ”¯æŒæ›´å¤šçš„å®ä¾‹åŒ–æ¨¡å¼å’Œä¸°å¯Œçš„åˆ‡ç‚¹ç»„åˆã€‚å®ƒçš„ä¼˜ç‚¹æ˜¯å°†åˆ‡é¢ç¡®ä¿ä¸ºå•å…ƒæ¨¡å—åŒ–ï¼Œ@AspectJçš„ä½¿ç”¨å¯¹ç†è§£åˆ‡é¢ä¹Ÿå¾ˆæœ‰ä¼˜åŠ¿ï¼ˆä¹Ÿå¾ˆå®¹æ˜“æ¥å—ï¼‰ï¼Œ æ— è®ºæ˜¯é€šè¿‡Spring AOPè¿˜æ˜¯AspectJçš„ä½¿ç”¨ ã€‚ æ‰€ä»¥å¦‚æœå†³å®šéœ€è¦AspectJçš„èƒ½åŠ›è§£å†³é¢å¤–çš„è¦æ±‚ï¼Œç„¶åè¿ç§»åˆ°ä¸€ä¸ªåŸºäºAspectJçš„æ–¹æ³•ï¼Œæ˜¯éå¸¸ç®€å•çš„ã€‚ Springå›¢é˜Ÿå»ºè®®ä½¿ç”¨@AspectJçš„æ–¹å¼ã€‚</p><h3 id="2-7-æ··åˆåˆ‡é¢ç±»å‹"><a href="#2-7-æ··åˆåˆ‡é¢ç±»å‹" class="headerlink" title="2.7. æ··åˆåˆ‡é¢ç±»å‹"></a>2.7. æ··åˆåˆ‡é¢ç±»å‹</h3><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå®Œå…¨æœ‰å¯èƒ½æ··åˆä½¿ç”¨@AspectJçš„åˆ‡é¢æ–¹å¼ï¼Œç”¨äºæ”¯æŒè‡ªåŠ¨ä»£ç†ã€schemaå®šä¹‰<code>&lt;aop:aspect&gt;</code>ï¼Œ<code>&lt;aop:advisor&gt;</code>å£°æ˜é€šçŸ¥è€…ç”šè‡³åœ¨åŒä¸€é…ç½®ä¸­å®šä¹‰ä½¿ç”¨Spring 1.2 é£æ ¼çš„ä»£ç†å’Œæ‹¦æˆªå™¨ã€‚æ‰€æœ‰è¿™äº›éƒ½æ˜¯ä½¿ç”¨ç›¸åŒçš„åº•å±‚æ”¯æŒæœºåˆ¶å®ç°çš„ï¼Œå¹¶ä¸”å¯ä»¥æ„‰å¿«åœ°å…±å­˜ã€‚</p><h3 id="2-8-ä»£ç†ç­–ç•¥"><a href="#2-8-ä»£ç†ç­–ç•¥" class="headerlink" title="2.8. ä»£ç†ç­–ç•¥"></a>2.8. ä»£ç†ç­–ç•¥</h3><p>Spring AOPä½¿ç”¨JDKåŠ¨æ€ä»£ç†æˆ–CGLIBä¸ºç»™å®šç›®æ ‡å¯¹è±¡åˆ›å»ºä»£ç†ã€‚ ï¼ˆåªè¦æœ‰é€‰æ‹©ï¼ŒJDKåŠ¨æ€ä»£ç†å°±æ˜¯é¦–é€‰ï¼‰ã€‚</p><p>å¦‚æœè¦ä»£ç†çš„ç›®æ ‡å¯¹è±¡å®ç°è‡³å°‘ä¸€ä¸ªæ¥å£ï¼Œåˆ™ä½¿ç”¨JDKåŠ¨æ€ä»£ç†ã€‚ ç›®æ ‡ç±»å‹å®ç°çš„æ‰€æœ‰æ¥å£éƒ½æ˜¯ä»£ç†çš„ã€‚ å¦‚æœç›®æ ‡å¯¹è±¡æœªå®ç°ä»»ä½•æ¥å£ï¼Œåˆ™ä¼šåˆ›å»ºCGLIBä»£ç†ã€‚</p><p>å¦‚æœè¦å¼ºåˆ¶ä½¿ç”¨CGLIBä»£ç†ï¼ˆä¾‹å¦‚ï¼Œä»£ç†ä¸ºç›®æ ‡å¯¹è±¡å®šä¹‰çš„æ¯ä¸ªæ–¹æ³•ï¼Œè€Œä¸ä»…ä»…æ˜¯é‚£äº›ç”±å…¶æ¥å£å®ç°çš„æ–¹æ³•ï¼‰ï¼Œæ‚¨å¯ä»¥è¿™æ ·åšã€‚ ä½†æ˜¯ï¼Œæ‚¨åº”è¯¥è€ƒè™‘ä»¥ä¸‹é—®é¢˜ï¼š</p><ul><li><code>final</code> å£°æ˜ä¸ºfinalçš„æ–¹æ³•ä¸èƒ½ä½¿ç”¨ï¼Œå› ä¸ºå®ƒä»¬ä¸èƒ½è¢«è¦†ç›–ã€‚</li><li>ä»Spring 3.2å¼€å§‹ï¼Œä¸å†éœ€è¦å°†CGLIBæ·»åŠ åˆ°é¡¹ç›®ç±»è·¯å¾„ä¸­ï¼Œå› ä¸ºCGLIBç±»åœ¨<code>org.springframework</code>ä¸‹é‡æ–°æ‰“åŒ…å¹¶ç›´æ¥åŒ…å«åœ¨spring-core JARä¸­ã€‚è¿™æ„å‘³ç€åŸºäºCGLIBçš„ä»£ç†æ”¯æŒå¯ä»¥åƒJDKåŠ¨æ€ä»£ç†é‚£æ ·æ–¹ä¾¿åœ°å·¥ä½œã€‚</li><li>ä»Spring 4.0å¼€å§‹ï¼Œä»£ç†å¯¹è±¡çš„æ„é€ å‡½æ•°ä¸å†è¢«è°ƒç”¨ä¸¤æ¬¡ï¼Œå› ä¸ºCGLIBä»£ç†å®ä¾‹æ˜¯é€šè¿‡Objenesisåˆ›å»ºçš„ã€‚åªæœ‰å½“JVMä¸å…è®¸æ„é€ å™¨ç»•è¿‡æ—¶ï¼Œå¯èƒ½ä¼šçœ‹åˆ°æ¥è‡ªSpring AOPçš„ä»£ç†æ”¯æŒåŒé‡è°ƒç”¨ä»¥åŠçœ‹åˆ°ç›¸åº”çš„è°ƒè¯•æ—¥å¿—ã€‚</li></ul><p>è¦å¼ºåˆ¶ä½¿ç”¨CGLIBä»£ç†ï¼Œè¯·å°†<code>&lt;aop:config&gt;</code>å…ƒç´ çš„<code>proxy-target-class</code>å±æ€§çš„å€¼è®¾ç½®ä¸º<code>true</code>ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">aop:config</span> <span class="hljs-attr">proxy-target-class</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- other beans defined here... --&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">aop:config</span>&gt;</span><br></code></pre></td></tr></table></figure><p>è¦åœ¨ä½¿ç”¨@AspectJè‡ªåŠ¨ä»£ç†æ”¯æŒæ—¶å¼ºåˆ¶CGLIBä»£ç†ï¼Œè¯·å°†<code>&lt;aop:aspectj-autoproxy&gt;</code> å…ƒç´ çš„<code>proxy-target-class</code>å±æ€§è®¾ç½®ä¸º<code>true</code>ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">&lt;aop:aspectj-<span class="hljs-built_in">auto</span>proxy proxy-target-<span class="hljs-keyword">class</span>=&quot;<span class="hljs-symbol">true</span>&quot;/&gt;<br></code></pre></td></tr></table></figure><p>å¤šä¸ª<code>&lt;aop:config/&gt;</code>é€‰æ‹©è¢«é›†åˆåˆ°ä¸€ä¸ªç»Ÿä¸€çš„è‡ªåŠ¨ä»£ç†åˆ›å»ºå™¨ä¸­è¿è¡Œï¼Œå®ƒä½¿ç”¨äº†ä¸€ä¸ªå¼ºä»£ç†è®¾ç½®ï¼Œè¿™äº›é…ç½®æ˜¯ä»»æ„ <code>&lt;aop:config/&gt;</code> çš„å­ä»£ç æ®µï¼ˆé€šå¸¸æ˜¯æ¥è‡ªä¸åŒçš„XML beanå®šä¹‰æ–‡ä»¶ï¼‰ ã€‚è¿™ä¹Ÿé€‚ç”¨äº<code>&lt;tx:annotation-driven/&gt;</code>å’Œ<code>&lt;aop:aspectj-autoproxy/&gt;</code>ã€‚</p><p>è¦æ˜ç¡®çš„æ˜¯ï¼Œåœ¨<code>&lt;tx:annotation-driven/&gt;</code>ï¼Œ<code>&lt;aop:aspectj-autoproxy/&gt;</code>æˆ–<code>&lt;aop:config/&gt;</code>å…ƒç´ ä¸Šä½¿ç”¨<code>proxy-target-class=&quot;true&quot;</code> &#x3D;â€œtrueâ€ä¼šå¼ºåˆ¶ä½¿ç”¨CGLIBä»£ç† ä»–ä»¬ã€‚</p><h4 id="2-8-1-ç†è§£AOPä»£ç†"><a href="#2-8-1-ç†è§£AOPä»£ç†" class="headerlink" title="2.8.1. ç†è§£AOPä»£ç†"></a>2.8.1. ç†è§£AOPä»£ç†</h4><p>Spring AOPæ˜¯åŸºäºä»£ç†çš„ï¼Œåœ¨ç¼–å†™è‡ªå®šä¹‰åˆ‡é¢æˆ–ä½¿ç”¨Springæ¡†æ¶æä¾›çš„ä»»ä½•åŸºäºSpring AOPçš„åˆ‡é¢å‰ï¼ŒæŒæ¡ä¸Šä¸€ä¸ªè¯­å¥çš„å®é™…è¯­ä¹‰æ˜¯éå¸¸é‡è¦çš„ã€‚</p><p>é¦–å…ˆéœ€è¦è€ƒè™‘çš„æƒ…å†µå¦‚ä¸‹ï¼Œå‡è®¾æœ‰ä¸€ä¸ªæ™®é€šçš„ã€éä»£ç†çš„ã€æ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šçš„ã€ç›´æ¥çš„å¼•ç”¨å¯¹è±¡ã€‚å¦‚ä¸‹é¢çš„ä»£ç ç‰‡æ®µæ‰€ç¤º:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimplePojo</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Pojo</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-comment">// this next method invocation is a direct call on the &#x27;this&#x27; reference        this.bar();    &#125;</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">bar</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-comment">// some logic...    &#125;&#125;</span><br></code></pre></td></tr></table></figure><p>å¦‚æœåœ¨å¯¹è±¡å¼•ç”¨ä¸Šè°ƒç”¨æ–¹æ³•ï¼Œåˆ™ç›´æ¥åœ¨è¯¥å¯¹è±¡å¼•ç”¨ä¸Šè°ƒç”¨è¯¥æ–¹æ³•ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š:</p><p><img src="aop-proxy-plain-pojo-call.png" alt="aop proxy plain pojo call"></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) &#123;<br>        <span class="hljs-title class_">Pojo</span> pojo = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimplePojo</span>();<br>        <span class="hljs-comment">// this is a direct method call on the &#x27;pojo&#x27; reference        pojo.foo();    &#125;&#125;</span><br></code></pre></td></tr></table></figure><p>å½“å®¢æˆ·ç«¯ä»£ç æ˜¯ä»£ç†çš„å¼•ç”¨æ—¶ï¼Œäº‹æƒ…å‘ç”Ÿäº†ç»†å¾®çš„å˜åŒ–ã€‚è¯·è€ƒè™‘ä»¥ä¸‹å›¾è¡¨å’Œä»£ç æ®µ:</p><p><img src="aop-proxy-call.png" alt="aop proxy call"></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dart">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Main</span> </span>&#123;<br>    public <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> main(<span class="hljs-built_in">String</span>[] args) &#123;<br>        ProxyFactory <span class="hljs-keyword">factory</span> = <span class="hljs-keyword">new</span> ProxyFactory(<span class="hljs-keyword">new</span> SimplePojo());        <span class="hljs-keyword">factory</span>.addInterface(Pojo.<span class="hljs-keyword">class</span>);        <span class="hljs-keyword">factory</span>.addAdvice(<span class="hljs-keyword">new</span> RetryAdvice());<br>        Pojo pojo = (Pojo) <span class="hljs-keyword">factory</span>.getProxy();<br>        <span class="hljs-comment">// this is a method call on the proxy!        pojo.foo();    &#125;&#125;</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œè¦ç†è§£çš„å…³é”®æ˜¯ <code>Main</code>ç±»çš„ <code>main(..)</code>æ–¹æ³•ä¸­çš„å®¢æˆ·ç«¯ä»£ç å…·æœ‰å¯¹ä»£ç†çš„å¼•ç”¨ã€‚è¿™æ„å‘³ç€å¯¹è¯¥å¯¹è±¡å¼•ç”¨çš„æ–¹æ³•å°†åœ¨ä»£ç†ä¸Šè°ƒç”¨ï¼Œå› æ­¤ä»£ç†å°†èƒ½å¤Ÿå§”æ‰˜ä¸è¯¥ç‰¹å®šæ–¹æ³•è°ƒç”¨ç›¸å…³çš„æ‰€æœ‰æ‹¦æˆªå™¨ï¼ˆé€šçŸ¥ï¼‰ã€‚ ç„¶è€Œï¼Œä¸€æ—¦è°ƒç”¨ç»ˆäºè¾¾åˆ°äº†ç›®æ ‡å¯¹è±¡ï¼ˆåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯<code>SimplePojo</code>å¼•ç”¨ï¼‰ï¼Œä»»ä½•æ–¹æ³•è°ƒç”¨éƒ½ä¼šä¼ é€’ç»™ä»–ï¼Œä¾‹å¦‚<code>this.bar()</code>æˆ–<code>this.foo()</code>ï¼Œ éƒ½ä¼šè°ƒç”¨è¿™ä¸ªå¼•ç”¨ï¼Œè€Œä¸æ˜¯ä»£ç†ã€‚è¿™å…·æœ‰é‡è¦çš„æ„ä¹‰ï¼Œè¿™æ„å‘³ç€è‡ªæˆ‘è°ƒç”¨ä¸ä¼šå¯¼è‡´ä¸æ–¹æ³•è°ƒç”¨ç›¸å…³è”çš„é€šçŸ¥ï¼Œä»è€Œä¹Ÿä¸ä¼šè·å¾—æ‰§è¡Œçš„æœºä¼šã€‚</p><p>å¥½çš„ï¼Œé‚£è¦åšäº›ä»€ä¹ˆå‘¢ï¼Ÿ æœ€å¥½çš„æ–¹æ³•ï¼ˆè¿™ä¸ªâ€œæœ€å¥½â€çš„ï¼Œä¹Ÿæ˜¯è¿«ä¸å¾—å·²çš„ï¼‰æ˜¯é‡æ„ä»£ç ï¼Œä»¥ä¾¿ä¸ä¼šå‘ç”Ÿè‡ªæˆ‘è°ƒç”¨ã€‚è¿™ç¡®å®éœ€è¦æ‚¨åšä¸€äº›å·¥ä½œï¼Œä½†è¿™æ˜¯æœ€å¥½çš„ï¼Œæœ€å°‘ä¾µå…¥æ€§çš„æ–¹æ³•ã€‚ ä¸‹ä¸€ä¸ªåŠæ³•ç»å¯¹æ˜¯å¯æ€•çš„ï¼Œæˆ‘å‡ ä¹ä¸æ„¿æ„æŒ‡å‡ºï¼Œæ­£æ˜¯å› ä¸ºå®ƒæ˜¯å¦‚æ­¤å¯æ€•ã€‚æ‚¨å¯ä»¥ï¼ˆå¯¹æˆ‘ä»¬æ¥è¯´å¾ˆç—›è‹¦ï¼‰å°†ç±»ä¸­çš„é€»è¾‘å®Œå…¨ç»‘å®šåˆ°Spring AOPï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimplePojo</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Pojo</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-comment">// this works, but... gah!        ((Pojo) AopContext.currentProxy()).bar();    &#125;</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">bar</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-comment">// some logic...    &#125;&#125;</span><br></code></pre></td></tr></table></figure><p>è¿™å®Œå…¨å°†ä»£ç ä¸AOPç›¸è€¦åˆï¼Œè¿™ä½¿ç±»æœ¬èº«æ„è¯†åˆ°å®ƒæ­£åœ¨AOPä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨ï¼ŒçŠ¹å¦‚åœ¨AOPé¢å‰è€å¤§åˆ€ä¸€èˆ¬ã€‚å½“åˆ›å»ºä»£ç†æ—¶ï¼Œå®ƒè¿˜éœ€è¦ä¸€äº›é¢å¤–çš„é…ç½®ã€‚å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dart">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Main</span> </span>&#123;<br>    public <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> main(<span class="hljs-built_in">String</span>[] args) &#123;<br>        ProxyFactory <span class="hljs-keyword">factory</span> = <span class="hljs-keyword">new</span> ProxyFactory(<span class="hljs-keyword">new</span> SimplePojo());        <span class="hljs-keyword">factory</span>.adddInterface(Pojo.<span class="hljs-keyword">class</span>);        <span class="hljs-keyword">factory</span>.addAdvice(<span class="hljs-keyword">new</span> RetryAdvice());        <span class="hljs-keyword">factory</span>.setExposeProxy(<span class="hljs-keyword">true</span>);<br>        Pojo pojo = (Pojo) <span class="hljs-keyword">factory</span>.getProxy();<br>        <span class="hljs-comment">// this is a method call on the proxy!        pojo.foo();    &#125;&#125;</span><br></code></pre></td></tr></table></figure><p>æœ€åï¼Œå¿…é¡»æ³¨æ„çš„æ˜¯AspectJæ²¡æœ‰è¿™ç§è‡ªæˆ‘è°ƒç”¨é—®é¢˜ï¼Œå› ä¸ºå®ƒä¸æ˜¯åŸºäºä»£ç†çš„AOPæ¡†æ¶ã€‚</p><h3 id="2-9-ç¼–ç¨‹åˆ›å»º-AspectJä»£ç†"><a href="#2-9-ç¼–ç¨‹åˆ›å»º-AspectJä»£ç†" class="headerlink" title="2.9. ç¼–ç¨‹åˆ›å»º@AspectJä»£ç†"></a>2.9. ç¼–ç¨‹åˆ›å»º@AspectJä»£ç†</h3><p>é™¤äº†åœ¨é…ç½®ä¸­ä½¿ç”¨<code>&lt;aop:config&gt;</code>æˆ– <code>&lt;aop:aspectj-autoproxy&gt;</code>æ¥å£°æ˜åˆ‡é¢å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ç¼–ç¨‹çš„æ–¹å¼åˆ›å»ºä»£ç†çš„é€šçŸ¥ç›®æ ‡å¯¹è±¡ã€‚ æœ‰å…³Springçš„AOP APIçš„å®Œæ•´è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-api">ä¸‹ä¸€ç« </a>ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬çš„å…³æ³¨ç‚¹æ˜¯å¸Œæœ›ä½¿ç”¨@AspectJæ–¹é¢è‡ªåŠ¨åˆ›å»ºä»£ç†çš„èƒ½åŠ›ã€‚</p><p>æ‚¨å¯ä»¥ä½¿ç”¨<code>org.springframework.aop.aspectj.annotation.AspectJProxyFactory</code> ç±»ä¸ºä¸€ä¸ªæˆ–å¤šä¸ª@AspectJåˆ‡é¢é€šçŸ¥çš„ç›®æ ‡å¯¹è±¡åˆ›å»ºä»£ç†ã€‚ æ­¤ç±»çš„åŸºæœ¬ç”¨æ³•éå¸¸ç®€å•ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤º:</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-comment">// create a factory that can generate a proxy for the given target objectAspectJProxyFactory factory = new AspectJProxyFactory(targetObject);</span><br><span class="hljs-comment">// add an aspect, the class must be an @AspectJ aspect// you can call this as many times as you need with different aspectsfactory.addAspect(SecurityManager.class);</span><br><span class="hljs-comment">// you can also add existing aspect instances, the type of the object supplied must be an @AspectJ aspectfactory.addAspect(usageTracker);</span><br><span class="hljs-comment">// now get the proxy object...MyInterfaceType proxy = factory.getProxy();</span><br></code></pre></td></tr></table></figure><p>See the <a href="https://docs.spring.io/spring-framework/docs/5.1.3.BUILD-SNAPSHOT/javadoc-api/org/springframework/aop/aspectj/annotation/AspectJProxyFactory.html">javadoc</a> for more information.</p><h3 id="2-10-åœ¨Springåº”ç”¨ä¸­ä½¿ç”¨AspectJ"><a href="#2-10-åœ¨Springåº”ç”¨ä¸­ä½¿ç”¨AspectJ" class="headerlink" title="2.10. åœ¨Springåº”ç”¨ä¸­ä½¿ç”¨AspectJ"></a>2.10. åœ¨Springåº”ç”¨ä¸­ä½¿ç”¨AspectJ</h3><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åœ¨æœ¬ç« ä¸­ä»‹ç»çš„æ‰€æœ‰å†…å®¹éƒ½æ˜¯çº¯ç²¹çš„Spring AOPã€‚å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨AspectJç¼–è¯‘å™¨&#x2F;ç¼–ç»‡å™¨ä»£æ›¿AOPï¼Œè¿˜ä»‹ç»äº†è¶…è¶ŠSpring AOPè€Œå•ç‹¬æä¾›çš„åŠŸèƒ½ã€‚</p><p>Springæœ‰ä¸€ä¸ªå°çš„AspectJåˆ‡é¢åº“ï¼Œæ˜¯ä¸€ä¸ªå•ç‹¬ç®¡ç†çš„<code>spring-aspects.jar</code>åŒ…ã€‚å¦‚æœä½¿ç”¨åˆ°åˆ‡é¢é‚£ä¹ˆéœ€è¦å°†å®ƒæ·»åŠ åˆ°ç±»è·¯å¾„ä¸­ã€‚åœ¨<a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-atconfigurable">ä½¿ç”¨Springä¸­çš„AspectJç‹¬ç«‹æ³¨å…¥åŸŸå¯¹è±¡</a> å’Œ <a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-ajlib-other">åœ¨Springä¸­ä½¿ç”¨çš„AspectJå¦å¤–çš„åˆ‡é¢</a> ä¼šè®¨è®ºè¿™ä¸ªåº“çš„å†…å®¹ä»¥åŠå¦‚ä½•ä½¿ç”¨ã€‚<a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-aj-configure">ä½¿ç”¨Springçš„IoCé…ç½®AspectJåˆ‡é¢</a>è®¨è®ºå¦‚ä½•ä¾èµ–äºä½¿ç”¨AspectJç¼–è¯‘å™¨ç¼–ç»‡çš„AspectJåˆ‡é¢ã€‚æœ€åï¼Œ åœ¨ <a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-aj-ltw">åœ¨Springæ¡†æ¶ä¸­ä½¿ç”¨AspectJçš„åŠ è½½æ—¶ç»‡å…¥</a> å°†è®¨è®ºåœ¨Springçš„åº”ç”¨ä¸­ä½¿ç”¨AspectJæ¶‰åŠçš„ç¼–ç»‡æ—¶æœºçš„è®¨è®ºã€‚</p><h4 id="2-10-1-ä½¿ç”¨Springä¸­çš„AspectJç‹¬ç«‹æ³¨å…¥åŸŸå¯¹è±¡"><a href="#2-10-1-ä½¿ç”¨Springä¸­çš„AspectJç‹¬ç«‹æ³¨å…¥åŸŸå¯¹è±¡" class="headerlink" title="2.10.1. ä½¿ç”¨Springä¸­çš„AspectJç‹¬ç«‹æ³¨å…¥åŸŸå¯¹è±¡"></a>2.10.1. ä½¿ç”¨Springä¸­çš„AspectJç‹¬ç«‹æ³¨å…¥åŸŸå¯¹è±¡</h4><p>Springå®¹å™¨å®ä¾‹åŒ–å’Œé…ç½®ä¼šåœ¨åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­å®šä¹‰beanã€‚ä¹Ÿå¯ä»¥è®©beanå·¥å‚é…ç½®é¢„å…ˆå­˜åœ¨çš„å¯¹è±¡ï¼Œç»™å®šä¸€ä¸ªåŒ…å«è¦åº”ç”¨çš„é…ç½®çš„beanå®šä¹‰åç§°ã€‚<code>spring-aspects.jar</code> åŒ…å«äº†æ³¨è§£é©±åŠ¨çš„åˆ‡é¢ï¼Œ åˆ©ç”¨è¿™ä¸ªåŠŸèƒ½æ¥å…è®¸ä¾èµ–æ³¨å…¥åˆ°ä»»æ„å¯¹è±¡ã€‚è¯¥æ”¯æŒæ—¨åœ¨ç”¨äºåœ¨åˆ›å»ºä»»ä½•å®¹å™¨æ§åˆ¶ä¹‹å¤–çš„å¯¹è±¡ã€‚åŸŸå¯¹è±¡é€šå¸¸å±äºè¿™ä¸€ç±»ï¼Œå› ä¸ºå®ƒä»¬é€šå¸¸æ˜¯ä½¿ç”¨<code>new</code>çš„æ“ä½œç¬¦ä»¥ç¼–ç¨‹æ–¹å¼åˆ›å»ºçš„ï¼Œæˆ–ç”±ORMå·¥å…·ä¸ºæ•°æ®åº“æŸ¥è¯¢çš„ç»“æœåˆ›å»ºçš„ã€‚</p><p><code>@Configurable</code>æ³¨è§£æ ‡è®°ä¸€ä¸ªç±»ç¬¦åˆSpringé©±åŠ¨é…ç½®çš„æ¡ä»¶ï¼Œåœ¨æœ€ç®€å•çš„æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥çº¯ç²¹ä½¿ç”¨å®ƒä½œä¸ºæ ‡è®°æ³¨è§£ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤º:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">package</span> com.xyz.myapp.domain;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.<span class="hljs-keyword">annotation</span>.Configurable;<br><span class="hljs-meta">@Configurablepublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Account</span> &#123;    <span class="hljs-comment">// ...&#125;</span><br></code></pre></td></tr></table></figure><p>ä½œä¸ºè¿™æ ·ä¸€ä¸ªæ ‡è¯†æ¥å£, Springå°†ä¼šä¸ºè¿™ä¸ªæ³¨è§£ç±»å‹ï¼ˆåœ¨ä¾‹å­ä¸­æ˜¯<code>Account</code>ï¼‰åˆ©ç”¨å®šä¹‰beançš„æ–¹å¼ï¼ˆå…¸å‹çš„åŸå‹ä½œç”¨åŸŸï¼‰é…ç½®ä¸€ä¸ªæ–°å®ä¾‹ï¼Œ è¿™ä¸ªå®ä¾‹æ‹¥æœ‰ä¸å®Œå…¨é™å®šç±»å‹ç›¸åŒçš„åå­—(<code>com.xyz.myapp.domain.Account</code>)ã€‚å› ä¸ºä¸€ä¸ªbeançš„é»˜è®¤åç§°æ˜¯å®ƒçš„ç±»å‹çš„å®Œå…¨é™å®šåï¼Œè¿™ä¸ªç®€ä¾¿çš„æ–¹å¼åªæ˜¯çœç•¥äº†å®ƒçš„ <code>id</code>å±æ€§ã€‚å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs abnf">&lt;bean class<span class="hljs-operator">=</span><span class="hljs-string">&quot;com.xyz.myapp.domain.Account&quot;</span> scope<span class="hljs-operator">=</span><span class="hljs-string">&quot;prototype&quot;</span>&gt;<br><br>    &lt;property name<span class="hljs-operator">=</span><span class="hljs-string">&quot;fundsTransferService&quot;</span> ref<span class="hljs-operator">=</span><span class="hljs-string">&quot;fundsTransferService&quot;</span>/&gt;<br><br>&lt;/bean&gt;<br></code></pre></td></tr></table></figure><p>å¦‚æœæƒ³è¦æ˜¾å¼æŒ‡å®šä¸ºåŸå‹beanä½¿ç”¨çš„åç§°ï¼Œå¯ä»¥ç›´æ¥åœ¨æ³¨è§£æ‰§è¡Œæ­¤æ“ä½œï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">package</span> com.xyz.myapp.domain;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.<span class="hljs-keyword">annotation</span>.Configurable;<br><span class="hljs-meta">@Configurable(<span class="hljs-string">&quot;account&quot;</span>)</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Account</span> &#123;    <span class="hljs-comment">// ...&#125;</span><br></code></pre></td></tr></table></figure><p>Springç°åœ¨æŸ¥æ‰¾åä¸º<code>account</code> çš„beanå®šä¹‰ï¼Œå¹¶å°†å…¶ç”¨ä½œé…ç½®æ–°<code>Account</code>å®ä¾‹çš„å®šä¹‰ã€‚</p><p>ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªåŠ¨è£…é…ä»¥é¿å…æŒ‡å®šä¸€ä¸ªç‰¹å®šçš„ä¸“ç”¨beanå®šä¹‰ã€‚Springå°†åˆ©ç”¨<code>@Configurable</code>æ³¨è§£çš„è‡ªåŠ¨è£…é…å±æ€§æ¥è‡ªåŠ¨è£…é…beanï¼Œå¯ä»¥ä½¿ç”¨<code>@Configurable(autowire=Autowire.BY_NAME</code>æˆ–è€… <code>@Configurable(autowire=Autowire.BY_TYPE)</code>åˆ†åˆ«è‡ªåŠ¨è£…é…åŸºäºåç§°å’ŒåŸºäºç±»å‹çš„beanã€‚å¦å¤–ï¼ŒSpring 2.5ä¹‹åæ˜ç¡®åœ°æŒ‡å®šäº†æ›´å¥½çš„ç­–ç•¥ï¼Œ åœ¨ç±»ä¸­æœ‰<code>@Configurable</code>æ³¨è§£çš„beanä¸Šï¼Œå…¶åŸŸæˆ–æ–¹æ³•çº§åˆ«ä¸Šä½¿ç”¨<code>@Autowired</code>æˆ–<code>@Inject</code>èƒ½å¤Ÿä½¿ç”¨æ³¨è§£é©±åŠ¨çš„ä¾èµ–æ³¨å…¥ã€‚ æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#beans-annotation-config">åŸºäºæ³¨è§£çš„å®¹å™¨é…ç½®</a>ã€‚</p><p>æœ€åï¼Œå¯ä»¥ä½¿ç”¨Springä¾èµ–çš„åä¸º<code>dependencyCheck</code>çš„ç‰¹æ€§å»æ£€æŸ¥æ–°å»ºçš„å¯¹è±¡å¼•ç”¨ä»¥åŠé…ç½®å¯¹è±¡ï¼ˆä¾‹å¦‚ï¼Œ <code>@Configurable(autowire=Autowire.BY_NAME,dependencyCheck=true)</code>ï¼‰ ã€‚å¦‚æœå°†æ­¤ç‰¹æ€§è®¾ç½®ä¸º <code>true</code>ï¼Œé‚£ä¹ˆSpringå°†åœ¨é…ç½®ä¹‹åç¡®è®¤æ‰€æœ‰å±æ€§ï¼ˆéåŸå§‹æˆ–é›†åˆï¼‰å·²è¢«è®¾ç½®ã€‚</p><p>å½“ç„¶ï¼Œä½¿ç”¨æ³¨è§£æœ¬èº«æ²¡æœ‰ä»»ä½•ä½œç”¨ã€‚è¿™æ˜¯ <code>spring-aspects.jar</code>åŒ…ä¸­çš„<code>AnnotationBeanConfigurerAspect</code>æ³¨è§£çš„å­˜åœ¨è¡Œä¸ºã€‚å®è´¨ä¸Šï¼Œ è¯¥åˆ‡é¢è¡¨è¾¾çš„æ˜¯ï¼Œä¸€ä¸ªå¸¦æœ‰<code>@Configurable</code>æ³¨è§£ç±»å‹çš„æ–°å¯¹è±¡åœ¨åˆå§‹åŒ–è¿”å›ä¹‹åï¼ŒæŒ‰ç…§æ³¨è§£çš„å±æ€§ä½¿ç”¨Springé…ç½®åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåˆå§‹åŒ–æ˜¯æŒ‡æ–°å®ä¾‹åŒ–çš„å¯¹è±¡ï¼ˆä¾‹å¦‚ï¼Œ ç”¨<code>new</code> è¿ç®—ç¬¦å®ä¾‹åŒ–çš„å¯¹è±¡ï¼‰ä»¥åŠæ­£åœ¨ç»å†ååºåˆ—åŒ–ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡<a href="https://docs.oracle.com/javase/6/docs/api/java/io/Serializable.html">readResolve()</a>ï¼‰çš„å¯åºåˆ—åŒ–å¯¹è±¡ã€‚</p><p>ä¸Šä¸€æ®µçš„ä¸€ä¸ªå…³é”®çŸ­è¯­æ˜¯ â€œå®è´¨â€.ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç²¾ç¡®çš„è¯­ä¹‰ä»ä¸€ä¸ªæ–°å¯¹è±¡åˆå§‹åŒ–åè¿”å›æ˜¯é€‚åˆçš„ã€‚â€œåˆå§‹åŒ–åâ€æ„å‘³ç€ä¾èµ–å°†ä¼šåœ¨å¯¹è±¡è¢«æ„å»ºå®Œæ¯•åæ³¨å…¥ ï¼Œ è¿™æ„å‘³ç€ä¾èµ–åœ¨ç±»æ„é€ å™¨å½“ä¸­æ˜¯ä¸èƒ½ä½¿ç”¨çš„ã€‚å¦‚æœæƒ³ä¾èµ–çš„æ³¨å…¥å‘ç”Ÿåœ¨æ„é€ å™¨æ‰§è¡Œä¹‹å‰ï¼Œè€Œä¸”èƒ½å¤Ÿç”¨åœ¨æ„é€ å™¨ä¹‹ä¸­ï¼Œé‚£ä¹ˆéœ€è¦åƒä¸‹é¢è¿™æ ·å£°æ˜ <code>@Configurable</code>ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">@Configurable(<span class="hljs-attribute">preConstruction</span>=<span class="hljs-literal">true</span>)<br></code></pre></td></tr></table></figure><p>æ‚¨å¯ä»¥åœ¨ <a href="https://www.eclipse.org/aspectj/doc/next/progguide/semantics-joinPoints.html">æœ¬é™„å½•</a> ä¸­ <a href="https://www.eclipse.org/aspectj/doc/next/progguide/index.html">AspectJç¼–ç¨‹æŒ‡å—</a>ä¸€ä¹¦ä¸­æ‰¾åˆ°æ›´å¤šæœ‰å…³AspectJçš„ä¿¡æ¯</p><p>è¿™ä¸ªæ³¨è§£ç±»å‹å¿…é¡»ä½¿ç”¨AspectJç¼–ç»‡ç»‡å…¥æ‰å¯ä»¥å·¥ä½œ ï¼Œ å¼€å‘è€…å¯ä»¥ä½¿ç”¨æ„å»ºç»„ä»¶Antæˆ–Mavenæ¥å®Œæˆè¿™ä¸ªä»»åŠ¡ï¼ˆ<a href="https://www.eclipse.org/aspectj/doc/released/devguide/antTasks.html">AspectJ Development Environment Guide</a>æœ‰å‚è€ƒä¾‹å­ï¼‰ï¼Œæˆ–è€…åœ¨è£…é…æ—¶ç»‡å…¥ï¼ˆè¯·å‚è€ƒ <a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-aj-ltw">åœ¨Springæ¡†æ¶ä¸­ä½¿ç”¨AspectJçš„åŠ è½½æ—¶ç»‡å…¥</a>ï¼‰ã€‚<code>AnnotationBeanConfigurerAspect</code>æ³¨è§£æœ¬èº«éœ€è¦Springæ¥é…ç½®ï¼ˆä¸ºäº†è·å–ä¸€ä¸ªbeanå·¥å‚å¼•ç”¨ï¼Œè¢«ç”¨äºé…ç½®æ–°çš„å¯¹è±¡ï¼‰ã€‚å¦‚æœä½¿ç”¨åŸºäºJavaçš„é…ç½®ï¼Œ é‚£ä¹ˆåªéœ€å°†<code>@EnableSpringConfigured</code> æ³¨è§£åŠ å…¥åˆ°ä»»æ„çš„<code>@Configuration</code>ç±»ä¸­å³å¯ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Configuration</span><span class="hljs-variable">@EnableSpringConfiguredpublic</span> class AppConfig &#123;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœåŸºäºXMLé…ç½®ï¼Œé‚£ä¹ˆåªè¦åœ¨Spring <a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#xsd-schemas-context"><code>context</code></a>çš„å‘½åç©ºé—´å£°æ˜ä¸­æ·»åŠ <code>context:spring-configured</code>ã€‚æ‚¨å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼ä½¿ç”¨å®ƒï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-section">&lt;context:spring-configured/&gt;</span><br></code></pre></td></tr></table></figure><p>åœ¨é…ç½®åˆ‡é¢ä¹‹å‰åˆ›å»º<code>@Configurable</code>å¯¹è±¡çš„å®ä¾‹å°†ä¼šå‘è°ƒè¯•æ—¥å¿—å‘æ¶ˆæ¯ï¼Œå¹¶ä¸”ä¸ä¼šå¯¹è¯¥å¯¹è±¡è¿›è¡Œé…ç½®ã€‚ä¸€ä¸ªä¾‹å­æ˜¯åœ¨Springé…ç½®ä¸­çš„ä¸€ä¸ªbeanï¼Œå®ƒåœ¨Springåˆå§‹åŒ–æ—¶åˆ›å»ºåŸŸå¯¹è±¡ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨<code>depends-on</code>beanå±æ€§æ¥æ‰‹åŠ¨æŒ‡å®šbeanä¾èµ–çš„åˆ‡é¢é…ç½®ã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•ä½¿ç”¨<code>depends-on</code>å±æ€§ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;myService&quot;</span>        <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.xzy.myapp.service.MyService&quot;</span>        <span class="hljs-attr">depends-on</span>=<span class="hljs-string">&quot;org.springframework.beans.factory.aspectj.AnnotationBeanConfigurerAspect&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- ... --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä¸ç”¨é€šè¿‡beançš„åˆ‡é¢é…ç½®æ¥æ¿€æ´»<code>@Configurable</code>å¤„ç†è¿‡ç¨‹ï¼Œé™¤éçœŸçš„æƒ³åœ¨è¿è¡Œä¸­ä¾èµ–å…¶è¯­ä¹‰ã€‚ç‰¹åˆ«åœ°ï¼Œä¸è¦åœ¨ä¸€ä¸ªå·²ç»åœ¨å®¹å™¨ä¸Šæ³¨å†Œè¿‡çš„Spring beanä¸Šå»å†å»ä½¿ç”¨<code>@Configurable</code>æ³¨è§£ã€‚ å¦åˆ™ï¼Œè¿™ä¸ªbeanå°†ä¼šè¢«åˆå§‹åŒ–ä¸¤æ¬¡ï¼Œå®¹å™¨ä¸€æ¬¡ï¼Œåˆ‡é¢ä¸€æ¬¡ã€‚</p><h5 id="å•å…ƒæµ‹è¯•-Configurableçš„å¯¹è±¡"><a href="#å•å…ƒæµ‹è¯•-Configurableçš„å¯¹è±¡" class="headerlink" title="å•å…ƒæµ‹è¯•@Configurableçš„å¯¹è±¡"></a>å•å…ƒæµ‹è¯•<code>@Configurable</code>çš„å¯¹è±¡</h5><p>å¼€å¯<code>@Configurable</code>æ”¯æŒçš„ä¸€ä¸ªç›®æ ‡å°±æ˜¯ä½¿å•å…ƒæµ‹è¯•ç‹¬ç«‹äºåŸŸå¯¹è±¡ï¼Œä»è€Œæ²¡æœ‰ç¢°åˆ°è¯¸å¦‚ç¡¬ç¼–ç æŸ¥æ‰¾ä¸€æ ·çš„å›°éš¾ã€‚å¦‚æœ<code>@Configurable</code>æ³¨è§£æ²¡æœ‰ä½¿ç”¨AspectJç»‡å…¥é‚£ä¹ˆå®ƒå°±ä¸ä¼šå¯¹å•å…ƒæµ‹è¯•é€ æˆå½±å“ï¼Œ è¿™æ ·å°±å¯ä»¥æ­£å¸¸åœ°è¿›è¡Œmockæˆ–stubæµ‹è¯•ã€‚å¦‚æœ<code>@Configurable</code>æ˜¯ä½¿ç”¨AspectJç»‡å…¥çš„ï¼Œé‚£ä¹ˆä¾ç„¶å¯ä»¥åœ¨å®¹å™¨ä¹‹å¤–æ­£å¸¸åœ°è¿›è¡Œå•å…ƒæµ‹è¯•ï¼Œä½†æ˜¯å¦‚æœæ¯æ¬¡éƒ½æ„å»ºä¸€ä¸ª<code>@Configurable</code>å¯¹è±¡éƒ½ä¼šçœ‹åˆ°è­¦å‘Šæ¶ˆæ¯ï¼Œ å®ƒè¡¨ç¤ºæ­¤é…ç½®å¹¶éSpringçš„é…ç½®ã€‚</p><h5 id="å¤šä¸ªåº”ç”¨ä¸Šä¸‹æ–‡ä¸€èµ·å·¥ä½œ"><a href="#å¤šä¸ªåº”ç”¨ä¸Šä¸‹æ–‡ä¸€èµ·å·¥ä½œ" class="headerlink" title="å¤šä¸ªåº”ç”¨ä¸Šä¸‹æ–‡ä¸€èµ·å·¥ä½œ"></a>å¤šä¸ªåº”ç”¨ä¸Šä¸‹æ–‡ä¸€èµ·å·¥ä½œ</h5><p><code>AnnotationBeanConfigurerAspect</code>ç±»åœ¨AspectJä¸­ç”¨æ¥å®ç°<code>@Configurable</code>æ”¯æŒçš„å•ä¸ªåˆ‡é¢ã€‚å•ä¸ªåˆ‡é¢çš„ä½œç”¨åŸŸä¸é™æ€æˆå‘˜çš„ä½œç”¨åŸŸæ˜¯ç›¸åŒçš„ï¼Œ ä¹Ÿå°±æ˜¯è¯´æ¯ä¸€ä¸ªç±»åŠ è½½å™¨éƒ½ä¼šå®šä¹‰è¿™ä¸ªåˆ‡é¢çš„å®ä¾‹ç±»å‹ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœä½¿ç”¨ç›¸åŒçš„ç±»åŠ è½½å™¨å±‚æ¥å®šä¹‰å¤šä¸ªåº”ç”¨ä¸Šä¸‹æ–‡ã€‚é‚£ä¹ˆå¿…é¡»è€ƒè™‘åœ¨å“ªå„¿å®šä¹‰<code>@EnableSpringConfigured</code> beanä»¥åŠåœ¨å“ªä¸ªè·¯å¾„å­˜æ”¾ <code>spring-aspects.jar</code>åŒ…ã€‚</p><p>è€ƒè™‘ä¸€ä¸ªå…¸å‹çš„Spring Webåº”ç”¨ç¨‹åºé…ç½®ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªå…±äº«çš„çˆ¶åº”ç”¨ä¸Šä¸‹æ–‡ï¼Œå®šä¹‰å…¬å…±ä¸šåŠ¡æœåŠ¡å’Œæ”¯æŒå®ƒä»¬æ‰€éœ€çš„æ‰€æœ‰å†…å®¹ï¼Œæ¯ä¸ªServletåŒ…å«ä¸€ä¸ªå­åº”ç”¨ä¸Šä¸‹æ–‡ï¼Œ å…¶ä¸­åŒ…å«ç‰¹å®šäºServletçš„å®šä¹‰ã€‚æ‰€æœ‰è¿™äº›ä¸Šä¸‹æ–‡å…±å­˜äºç›¸åŒçš„ç±»åŠ è½½å™¨å±‚æ¬¡ï¼Œæ‰€ä»¥<code>AnnotationBeanConfigurerAspect</code>èƒ½å¤ŸæŒæœ‰ä»–ä»¬ä¹‹ä¸­çš„ä¸€ä¸ªçš„å¼•ç”¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ å»ºè®®åœ¨å…±äº«çš„ï¼ˆçˆ¶ï¼‰åº”ç”¨ä¸Šä¸‹æ–‡ä¸Šä½¿ç”¨<code>@EnableSpringConfigured</code> beanå®šä¹‰ï¼Œè¿™ä¸ªå®šä¹‰çš„æœåŠ¡ï¼Œ å¯èƒ½æƒ³æ³¨å…¥åˆ°åŸŸå¯¹è±¡ä¸­ã€‚ç»“æœæ˜¯ï¼Œå¼€å‘è€…ä¸èƒ½åœ¨å­ä¸Šä¸‹æ–‡ï¼ˆç‰¹å®šçš„Servletï¼‰ ä¸­ä½¿ç”¨@Configurableå»å®šä¹‰åŸŸå¯¹è±¡çš„å¼•ç”¨beanï¼ˆä¹Ÿè®¸å¹¶ä¸æƒ³åšäº›ä»€ä¹ˆï¼‰ã€‚</p><p>åœ¨åŒä¸€ä¸ªå®¹å™¨éƒ¨ç½²å¤šä¸ªWebåº”ç”¨ç¨‹åºæ—¶ï¼Œç¡®ä¿æ¯ä¸ªWebåº”ç”¨ç¨‹åºåŠ è½½<code>spring-aspects.jar</code>ç±»å‹æ˜¯åœ¨ä½¿ç”¨è‡ªå·±çš„åŠ è½½å™¨å¼•ç”¨ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡ <code>&#39;WEB-INF/lib&#39;</code>ï¼‰ã€‚å¦‚æœ<code>spring-aspects.jar</code>ä»…åœ¨å®¹å™¨çš„ç±»è·¯å¾„ä¸‹ï¼ˆä¹Ÿå°±æ˜¯è£…åœ¨çˆ¶æ¯å…±äº«çš„åŠ è½½å™¨çš„å¼•ç”¨ï¼‰ï¼Œæ‰€æœ‰çš„Webåº”ç”¨ç¨‹åºå°†å…±äº«ç›¸åŒçš„åˆ‡é¢å®ä¾‹ï¼Œè€Œè¿™å¯èƒ½ä¸æ˜¯ä½ æƒ³è¦çš„ã€‚</p><h4 id="2-10-2-åœ¨Springä¸­ä½¿ç”¨çš„AspectJé¢å¤–çš„åˆ‡é¢"><a href="#2-10-2-åœ¨Springä¸­ä½¿ç”¨çš„AspectJé¢å¤–çš„åˆ‡é¢" class="headerlink" title="2.10.2. åœ¨Springä¸­ä½¿ç”¨çš„AspectJé¢å¤–çš„åˆ‡é¢"></a>2.10.2. åœ¨Springä¸­ä½¿ç”¨çš„AspectJé¢å¤–çš„åˆ‡é¢</h4><p>é™¤äº†<code>@Configurable</code>åˆ‡é¢ï¼Œ<code>spring-aspects.jar</code>è¿˜åŒ…å«AspectJåˆ‡é¢ï¼Œå¯ä»¥ç”¨æ¥é©±åŠ¨Springçš„äº‹åŠ¡ç®¡ç†ï¼Œç”¨äºæ³¨è§£å¸¦<code>@Transactional</code>æ³¨è§£çš„ç±»å‹å’Œæ–¹æ³• ã€‚è¿™ä¸»è¦æ˜¯ä¸ºé‚£äº›å¸Œæœ›åœ¨Springå®¹å™¨ä¹‹å¤–ä½¿ç”¨Springæ¡†æ¶çš„äº‹åŠ¡æ”¯æŒçš„ç”¨æˆ·è€Œè®¾è®¡çš„ã€‚</p><p>è§£æ <code>@Transactional</code> æ³¨è§£çš„åˆ‡é¢æ˜¯ <code>AnnotationTransactionAspect</code>ã€‚å½“ä½¿ç”¨è¿™ä¸ªåˆ‡é¢æ—¶ï¼Œå¿…é¡»æ³¨è§£è¿™ä¸ªå®ç°ç±»ï¼ˆå’Œ&#x2F;æˆ–åœ¨ç±»çš„æ–¹æ³•ä¸Šï¼‰ï¼Œä¸æ˜¯æ¥å£ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ çš„å®ç°ç±»ã€‚AspectJéµå¾ªJavaçš„è§„åˆ™ï¼Œæ³¨è§£çš„æ¥å£ä¸èƒ½è¢«ç»§æ‰¿ã€‚</p><p><code>@Transactional</code>æ³¨è§£çš„ç±»æŒ‡å®šé»˜è®¤çš„äº‹åŠ¡è¯­ä¹‰çš„å„ç§å…¬å…±æ“ä½œçš„ç±».</p><p>åœ¨ç±»çš„æ–¹æ³•ä¸Šæ³¨è§£<code>@Transactional</code>å°†ä¼šè¦†ç›–ç”±ç»™å®šé»˜è®¤äº‹åŠ¡è¯­ä¹‰çš„æ³¨è§£ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ï¼Œä»»æ„å¯è§æ€§çš„æ–¹æ³•éƒ½å¯ä»¥è¢«æ³¨è§£ï¼ŒåŒ…æ‹¬ç§æœ‰æ–¹æ³•ã€‚ç›´æ¥æ³¨è§£éå…¬å…±æ–¹æ³•æ˜¯è·å¾—æ‰§è¡Œæ­¤ç±»æ–¹æ³•çš„äº‹åŠ¡åˆ’åˆ†çš„å”¯ä¸€æ–¹æ³•ã€‚</p><p>ä»Spring Framework 4.2å¼€å§‹ï¼Œ<code>spring-aspects</code>æä¾›äº†ç±»ä¼¼çš„åˆ‡é¢ï¼Œä¸ºæ ‡å‡†çš„<code>javax.transaction.Transactional</code>æ³¨è§£æä¾›äº†å®Œå…¨ç›¸åŒçš„åŠŸèƒ½ã€‚ æŸ¥çœ‹<code>JtaAnnotationTransactionAspect</code> è·å–æ›´å¤šç»†èŠ‚</p><p>å¯¹äºå¸Œæœ›ä½¿ç”¨Springé…ç½®å’Œäº‹åŠ¡ç®¡ç†æ”¯æŒä½†ä¸å¸Œæœ›ï¼ˆæˆ–ä¸èƒ½ï¼‰ä½¿ç”¨æ³¨è§£çš„AspectJç¨‹åºå‘˜ï¼Œ <code>spring-aspects.jar</code>è¿˜åŒ…å«å¯ä»¥æ‰©å±•ä»¥æä¾›è‡ªå®šä¹‰åˆ‡ç‚¹å®šä¹‰çš„æŠ½è±¡åˆ‡é¢ã€‚ æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…<code>AbstractBeanConfigurerAspect</code>å’Œ<code>AbstractTransactionAspect</code>åˆ‡é¢çš„æºç ã€‚ ä½œä¸ºç¤ºä¾‹ï¼Œä»¥ä¸‹æ‘˜å½•æ˜¾ç¤ºäº†å¦‚ä½•ä½¿ç”¨ä¸å®Œå…¨é™å®šçš„ç±»ååŒ¹é…çš„åŸå‹beanå®šä¹‰æ¥ç¼–å†™ä¸€ä¸ªåˆ‡é¢ ï¼Œç”¨äºé…ç½®åŸŸæ¨¡å‹ä¸­å®šä¹‰çš„æ‰€æœ‰å¯¹è±¡å®ä¾‹:</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">aspect</span> <span class="hljs-title">DomainObjectConfiguration</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractBeanConfigurerAspect</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">DomainObjectConfiguration</span><span class="hljs-params">()</span> </span>&#123;        setBeanWiringInfoResolver(<span class="hljs-keyword">new</span> ClassNameBeanWiringInfoResolver());    &#125;<br>    <span class="hljs-comment">// the creation of a new bean (any object in the domain model)    protected pointcut beanCreation(Object beanInstance) :        initialization(new(..)) &amp;&amp;        SystemArchitecture.inDomainModel() &amp;&amp;        this(beanInstance);</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="2-10-3-ä½¿ç”¨Spring-IoCé…ç½®AspectJåˆ‡é¢"><a href="#2-10-3-ä½¿ç”¨Spring-IoCé…ç½®AspectJåˆ‡é¢" class="headerlink" title="2.10.3. ä½¿ç”¨Spring IoCé…ç½®AspectJåˆ‡é¢"></a>2.10.3. ä½¿ç”¨Spring IoCé…ç½®AspectJåˆ‡é¢</h4><p>å½“åœ¨Springåº”ç”¨ä¸­ä½¿ç”¨AspectJçš„åˆ‡é¢æ—¶ï¼Œå¾ˆè‡ªç„¶çš„å¸Œæœ›èƒ½å¤Ÿä½¿ç”¨Springæ¥é…ç½®åˆ‡é¢ã€‚AspectJè¿è¡Œæ—¶æœ¬èº«æ˜¯è´Ÿè´£åˆ›å»ºå’Œé…ç½®åˆ‡é¢çš„ï¼Œ AspectJé€šè¿‡Springåˆ›å»ºåˆ‡é¢å–å†³äºAspectJå®ä¾‹åŒ–æ¨¡å‹çš„æ–¹æ³•ï¼ˆ<code>per-xxx</code>å¼•èµ·çš„ï¼‰çš„åˆ‡é¢ä½¿ç”¨ã€‚</p><p>å¤šæ•°çš„AspectJåˆ‡é¢æ˜¯å•ä¾‹åˆ‡é¢ã€‚è¿™äº›åˆ‡é¢çš„é…ç½®éå¸¸å®¹æ˜“ï¼Œåªéœ€æ­£å¸¸åœ°åˆ›å»ºä¸€ä¸ªbeanå®šä¹‰å¼•ç”¨åˆ‡é¢çš„ç±»å‹ï¼ŒåŒ…å«beanå±æ€§<code>factory-method=&quot;aspectOf&quot;</code> ã€‚è¿™ä¿è¯äº†Springè·å¾—çš„æ˜¯AspectJçš„å®ä¾‹è€Œä¸æ˜¯è¯•å›¾åˆ›å»ºå®ä¾‹æœ¬èº«çš„åˆ‡é¢ã€‚ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•ä½¿ç”¨ <code>factory-method=&quot;aspectOf&quot;</code>å±æ€§ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;bean <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;profiler&quot;</span> <span class="hljs-attribute">class</span>=<span class="hljs-string">&quot;com.xyz.profiler.Profiler&quot;</span>        <span class="hljs-attribute">factory-method</span>=<span class="hljs-string">&quot;aspectOf&quot;</span>&gt; (1)<br>    &lt;property <span class="hljs-attribute">name</span>=<span class="hljs-string">&quot;profilingStrategy&quot;</span> <span class="hljs-attribute">ref</span>=<span class="hljs-string">&quot;jamonProfilingStrategy&quot;</span>/&gt;&lt;/bean&gt;<br></code></pre></td></tr></table></figure><p><strong>(1)ã€‚</strong>è¯·æ³¨æ„<code>factory-method=&quot;aspectOf&quot;</code> å±æ€§</p><p>éå•ä¾‹åˆ‡é¢å¾ˆéš¾é…ç½®ï¼Œä½†æ˜¯è¿™æ ·åšä¹Ÿæ˜¯æœ‰å¯èƒ½çš„ï¼Œé€šè¿‡åˆ›å»ºåŸå‹beançš„å®šä¹‰å’Œä»<code>spring-aspects.jar</code>ä¸­ä½¿ç”¨<code>@Configurable</code>çš„æ”¯æŒã€‚è¿™äº›å·¥ä½œéœ€è¦åœ¨AspectJè¿è¡Œä¹‹ååœ¨åˆ›å»ºä¹‹ä¸­å»é…ç½®åˆ‡é¢å®ä¾‹æ‰èƒ½æˆåŠŸã€‚</p><p>å¦‚æœæƒ³è¦ä½¿ç”¨AspectJç¼–å†™ä¸€äº›@AspectJåˆ‡é¢ï¼ˆä¾‹å¦‚ï¼Œé’ˆå¯¹é¢†åŸŸæ¨¡å‹ç±»å‹ä½¿ç”¨åŠ è½½æ—¶ç¼–ç»‡ï¼‰ä»¥åŠå¸Œæœ›ä¸Spring AOPä¸€èµ·ä½¿ç”¨çš„å…¶ä»–@AspectJåˆ‡é¢ï¼Œå¹¶ä¸”è¿™äº›åˆ‡é¢éƒ½ä½¿ç”¨Springè¿›è¡Œé…ç½® ã€‚ é‚£ä¹ˆéœ€è¦å‘Šè¯‰Spring AOP @AspectJè‡ªåŠ¨ä»£ç†æ”¯æŒåœ¨é…ç½®ä¸­å®šä¹‰çš„@AspectJæ–¹é¢çš„ç¡®åˆ‡å­é›†åº”è¯¥ç”¨äºè‡ªåŠ¨ä»£ç†ã€‚å¯ä»¥é€šè¿‡åœ¨<code>&lt;aop:aspectj-autoproxy/&gt;</code>å…ƒç´ ä¸­å£°æ˜ä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ª <code>&lt;include/&gt;</code>å…ƒç´ æ¥å®Œæˆæ­¤æ“ä½œã€‚ æ¯ä¸ª <code>&lt;include/&gt;</code>å…ƒç´ æŒ‡å®šä¸€ä¸ªåç§°æ¨¡å¼ï¼Œå¹¶ä¸”åªæœ‰åç§°ä¸è‡³å°‘ä¸€ä¸ªæ¨¡å¼ç›¸åŒ¹é…çš„beanæ‰ä¼šç”¨äºSpring AOPè‡ªåŠ¨ä»£ç†é…ç½®ã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•ä½¿ç”¨<code>&lt;include/&gt;</code>å…ƒç´ ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">aop:aspectj-autoproxy</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">aop:include</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;thisBean&quot;</span>/&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">aop:include</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;thatBean&quot;</span>/&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">aop:aspectj-autoproxy</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä¸è¦è¢« <code>&lt;aop:aspectj-autoproxy/&gt;</code> å…ƒç´ çš„åç§°è¯¯å¯¼ã€‚ ä½¿ç”¨å®ƒä¼šå¯¼è‡´åˆ›å»ºSpring AOPä»£ç†ã€‚ åˆ‡é¢å£°æ˜çš„@AspectJæ–¹å¼åªæ˜¯åœ¨è¿™é‡Œä½¿ç”¨ï¼ŒAspectJè¿è¡Œæ—¶æ˜¯æ²¡æœ‰ç”¨åˆ°çš„ã€‚</p><h4 id="2-10-4-åœ¨Springæ¡†æ¶ä¸­ä½¿ç”¨AspectJçš„åŠ è½½æ—¶ç»‡å…¥"><a href="#2-10-4-åœ¨Springæ¡†æ¶ä¸­ä½¿ç”¨AspectJçš„åŠ è½½æ—¶ç»‡å…¥" class="headerlink" title="2.10.4. åœ¨Springæ¡†æ¶ä¸­ä½¿ç”¨AspectJçš„åŠ è½½æ—¶ç»‡å…¥"></a>2.10.4. åœ¨Springæ¡†æ¶ä¸­ä½¿ç”¨AspectJçš„åŠ è½½æ—¶ç»‡å…¥</h4><p>æ˜¯æŒ‡AspectJåˆ‡é¢åœ¨JVMåŠ è½½ç±»æ–‡ä»¶æ—¶è¢«ç»‡å…¥åˆ°ç¨‹åºçš„ç±»æ–‡ä»¶çš„è¿‡ç¨‹ã€‚æœ¬éƒ¨åˆ†çš„é‡ç‚¹æ˜¯é…ç½®å’Œä½¿ç”¨LTWåœ¨Springæ¡†æ¶ä¸Šçš„å…·ä½“å†…å®¹ï¼Œæœ¬èŠ‚ä¸æ˜¯LTWçš„ç®€ä»‹ã€‚ åªæœ‰AspectJèƒ½å¤Ÿè¯¦ç»†åœ°è®²è¿°LTWçš„ç‰¹æ€§å’Œé…ç½®ï¼ˆä¸Springå®Œå…¨æ²¡æœ‰å…³ç³»ï¼‰ï¼Œå¯ä»¥å‚çœ‹<a href="https://www.eclipse.org/aspectj/doc/released/devguide/ltw.html">LTW section of the AspectJ Development Environment Guide</a>ã€‚</p><p>Springæ¡†æ¶åœ¨AspectJçš„LTWç»‡å…¥çš„è¿‡ç¨‹ä¸­æä¾›äº†æ›´ç»†ç²’åº¦çš„æ§åˆ¶ï¼Œâ€˜Vanillaâ€™ AspectJ LTWæ˜¯ä¸€ä¸ªé«˜æ•ˆçš„ä½¿ç”¨Javaï¼ˆ1.5+)çš„ä»£ç†ï¼Œå®ƒä¼šåœ¨JVMå¯åŠ¨çš„æ—¶å€™æ”¹å˜ä¸€ä¸ªVMå‚æ•°ã€‚ è¿™æ˜¯ä¸€ç§JVMèŒƒå›´çš„è®¾ç½®ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½ä¼šå¾ˆé€‚åˆï¼Œä½†æ˜¯å¤ªç²—ç²’åº¦äº†ã€‚Springçš„LTWèƒ½å¤Ÿä¸ºLTWæä¾›ç±»åŠ è½½å‰çš„ç»‡å…¥ï¼Œæ˜¾ç„¶è¿™æ˜¯ä¸€ä¸ªæ›´ç»†ç²’åº¦çš„æ§åˆ¶ï¼Œè€Œä¸”å®ƒåœ¨â€™single-JVM-multiple-applicationâ€™ çš„ç¯å¢ƒä¸‹æ›´å…·æ„ä¹‰ï¼ˆåœ¨å…¸å‹çš„åº”ç”¨ç¨‹åºæœåŠ¡å™¨ç¯å¢ƒä¸­å°±æ˜¯è¿™æ ·åšçš„ï¼‰ã€‚</p><p>æ­¤å¤–ï¼Œåœ¨ç‰¹å®šçš„ç¯å¢ƒä¸­ï¼ˆæŸ¥çœ‹<a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-aj-ltw-environments">in certain environments</a>ï¼‰ï¼Œè¿™ç§æ–¹å¼å¯ä»¥åœ¨å¯¹åº”ç”¨ç¨‹åºæœåŠ¡å™¨è¿è¡Œè„šæœ¬ä¸åšä»»ä½•ä¿®æ”¹çš„æƒ…å½¢ä¸‹æ”¯æŒLTWï¼Œ ä½†éœ€è¦æ·»åŠ <code>-javaagent:path/to/aspectjweaver.jar</code>ï¼ˆæœ¬èŠ‚ç¨åå°†ä¼šæè¿°ï¼‰æˆ–<code>-javaagent:path/to/org.springframework.instrument-&#123;version&#125;.jar</code>ï¼ˆåŸåä¸º <code>spring-agent.jar</code>ï¼‰ã€‚ å¼€å‘äººå‘˜åªéœ€ä¿®æ”¹æ„æˆåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡çš„ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶ï¼Œä»¥å¯ç”¨åŠ è½½æ—¶ç¼–å…¥ï¼Œè€Œä¸æ˜¯ä¾èµ–é€šå¸¸è´Ÿè´£éƒ¨ç½²é…ç½®çš„ç®¡ç†æ–‡ä»¶ã€‚ä¾‹å¦‚å¯åŠ¨è„šæœ¬ã€‚</p><p>åˆ°æ­¤ä¸ºæ­¢ï¼Œæ¨é”€å®£ä¼ éƒ¨åˆ†å·²ç»ç»“æŸäº†ï¼Œé‚£ä¹ˆè®©æˆ‘ä»¬é¦–å…ˆä»‹ç»ä½¿ç”¨Springçš„AspectJ LTWçš„å¿«é€Ÿç¤ºä¾‹ï¼Œç„¶åè¯¦ç»†ä»‹ç»ç¤ºä¾‹ä¸­ä»‹ç»çš„å…ƒç´ ã€‚ æœ‰å…³å®Œæ•´ç¤ºä¾‹ï¼Œè¯·å‚é˜…<a href="https://github.com/spring-projects/spring-petclinic">Petclinicç¤ºä¾‹åº”ç”¨ç¨‹åº</a>ã€‚</p><h5 id="ç¬¬ä¸€ä¸ªä¾‹å­"><a href="#ç¬¬ä¸€ä¸ªä¾‹å­" class="headerlink" title="ç¬¬ä¸€ä¸ªä¾‹å­"></a>ç¬¬ä¸€ä¸ªä¾‹å­</h5><p>å‡è®¾æ‚¨æ˜¯ä¸€ååº”ç”¨ç¨‹åºå¼€å‘äººå‘˜ï¼Œè´Ÿè´£è¯Šæ–­ç³»ç»Ÿä¸­æŸäº›æ€§èƒ½é—®é¢˜çš„åŸå› ã€‚æˆ‘ä»¬æ— éœ€æ‰“å¼€ä¸€ä¸ªåˆ†æå·¥å…·ï¼Œè€Œæ˜¯è¦æ‰“å¼€ä¸€ä¸ªç®€å•çš„å‰–æåˆ‡é¢ï¼Œè®©æˆ‘ä»¬èƒ½å¤Ÿå¾ˆå¿«è·å¾—äº†ä¸€äº›æ€§èƒ½æŒ‡æ ‡ï¼Œ è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨éšåç«‹å³ä½¿ç”¨æ›´ç»†ç²’åº¦çš„åˆ†æå·¥å…·ã€‚</p><p>è¿™é‡Œä»‹ç»çš„ä¾‹å­ä½¿ç”¨XMLæ ¼å¼çš„é…ç½®ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#beans-java">Javaé…ç½®</a>å’Œå’Œ@AspectJçš„æ–¹å¼ã€‚ç‰¹åˆ«æ˜¯<code>@EnableLoadTimeWeaving</code>æ³¨è§£å¯ä»¥èµ· åˆ°æ›¿ä»£<code>&lt;context:load-time-weaver/&gt;</code> ï¼ˆè¯¦æƒ…<a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-aj-ltw-spring">è§ä¸‹æ–‡</a>ï¼‰ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç”¨äºæ€§èƒ½åˆ†æçš„åˆ‡é¢ï¼Œå®ƒä¸éœ€è¦å¤ªèŠ±å“¨ï¼Œå®ƒæ˜¯ä¸€ä¸ªåŸºäºæ—¶é—´çš„åˆ†æå™¨ï¼Œå®ƒä½¿ç”¨@ AspectJæ ·å¼çš„æ–¹é¢å£°æ˜:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> foo;<br><span class="hljs-keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;<span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Aspect;<span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Around;<span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Pointcut;<span class="hljs-keyword">import</span> org.springframework.util.StopWatch;<span class="hljs-keyword">import</span> org.springframework.core.annotation.Order;<br><span class="hljs-meta">@Aspectpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProfilingAspect</span> &#123;<br>    <span class="hljs-meta">@Around(&quot;methodsToBeProfiled()&quot;)</span>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">profile</span><span class="hljs-params">(ProceedingJoinPoint pjp)</span> <span class="hljs-keyword">throws</span> Throwable &#123;        <span class="hljs-type">StopWatch</span> <span class="hljs-variable">sw</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StopWatch</span>(getClass().getSimpleName());        <span class="hljs-keyword">try</span> &#123;            sw.start(pjp.getSignature().getName());            <span class="hljs-keyword">return</span> pjp.proceed();        &#125; <span class="hljs-keyword">finally</span> &#123;            sw.stop();            System.out.println(sw.prettyPrint());        &#125;    &#125;<br>    <span class="hljs-meta">@Pointcut(&quot;execution(public * foo..*.*(..))&quot;)</span>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">methodsToBeProfiled</span><span class="hljs-params">()</span>&#123;&#125;&#125;<br></code></pre></td></tr></table></figure><p>æ­¤å¤–è¿˜éœ€è¦åˆ›å»ºä¸€ä¸ª<code>META-INF/aop.xml</code> æ–‡ä»¶ï¼Œå®ƒå°†é€šçŸ¥AspectJå°†<code>ProfilingAspect</code>ç»‡å…¥åˆ°ç±»ä¸­ã€‚è¿™æ˜¯æ–‡ä»¶çš„æƒ¯ä¾‹ï¼Œ å³åœ¨Javaç±»è·¯å¾„ä¸­å­˜åœ¨åä¸º<code>META-INF/aop.xml</code>çš„æ–‡ä»¶ï¼ˆæˆ–å¤šä¸ªæ–‡ä»¶ï¼‰æ˜¯æ ‡å‡†AspectJã€‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†<code>aop.xml</code> æ–‡ä»¶:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">aspectj</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//AspectJ//DTD//EN&quot;</span> <span class="hljs-string">&quot;http://www.eclipse.org/aspectj/dtd/aspectj.dtd&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">aspectj</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">weaver</span>&gt;</span>        <span class="hljs-comment">&lt;!-- only weave classes in our application-specific packages --&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">within</span>=<span class="hljs-string">&quot;foo.*&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">weaver</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">aspects</span>&gt;</span>        <span class="hljs-comment">&lt;!-- weave in just this aspect --&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">aspect</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;foo.ProfilingAspect&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">aspects</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">aspectj</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ç°åœ¨æ¥é…ç½®çš„Springç‰¹å®šéƒ¨åˆ†ã€‚ æˆ‘ä»¬éœ€è¦é…ç½®<code>LoadTimeWeaver</code>ï¼ˆç¨åè§£é‡Šï¼‰ã€‚LTWæ˜¯ä»ä¸€ä¸ªæˆ–å¤šä¸ª<code>META-INF/aop.xml</code> æ–‡ä»¶ä¸­ç»‡å…¥åˆ°åº”ç”¨ç±»çš„åˆ‡é¢é…ç½®çš„ä¸»è¦éƒ¨åˆ†ã€‚å¹¸è¿çš„æ˜¯å®ƒä¸éœ€è¦å¤§é‡çš„é…ç½®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼ˆè¿˜æœ‰ä¸€äº›é€‰é¡¹å¯ä»¥æŒ‡å®šï¼Œä½†æ˜¯åé¢ä¼šè¯¦ç»†ä»‹ç»ï¼‰ã€‚å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span>    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>    <span class="hljs-attr">xmlns:context</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/context&quot;</span>    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;        http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans.xsd        http://www.springframework.org/schema/context        http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- a service object; we will be profiling its methods --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;entitlementCalculationService&quot;</span>            <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;foo.StubEntitlementCalculationService&quot;</span>/&gt;</span><br>    <span class="hljs-comment">&lt;!-- this switches on the load-time weaving --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">context:load-time-weaver</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ç°åœ¨æ‰€æœ‰å¿…éœ€çš„ææ–™( aspect, <code>META-INF/aop.xml</code>æ–‡ä»¶, Spring çš„é…ç½®) éƒ½å·²åˆ°ä½ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>main(..)</code>æ–¹æ³•åˆ›å»ºä»¥ä¸‹é©±åŠ¨ç¨‹åºç±»ï¼Œä»¥æ¼”ç¤ºLTWçš„è¿è¡Œæƒ…å†µï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> foo;<br><span class="hljs-keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">ctx</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathXmlApplicationContext</span>(<span class="hljs-string">&quot;beans.xml&quot;</span>, Main.class);<br>        <span class="hljs-type">EntitlementCalculationService</span> <span class="hljs-variable">entitlementCalculationService</span>            <span class="hljs-operator">=</span> (EntitlementCalculationService) ctx.getBean(<span class="hljs-string">&quot;entitlementCalculationService&quot;</span>);<br>        <span class="hljs-comment">// the profiling aspect is &#x27;woven&#x27; around this method execution        entitlementCalculationService.calculateEntitlement();    &#125;&#125;</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿˜æœ‰æœ€åä¸€ä»¶äº‹è¦åšã€‚ æœ¬èŠ‚çš„ä»‹ç»ç¡®å®è¯´å¯ä»¥ä½¿ç”¨Springåœ¨æ¯ä¸ªClassLoaderçš„åŸºç¡€ä¸Šæœ‰é€‰æ‹©åœ°æ‰“å¼€LTWï¼Œè¿™æ˜¯äº‹å®ã€‚ ä½†æ˜¯ï¼Œå¯¹äºæ­¤ç¤ºä¾‹ï¼Œæˆ‘ä»¬ä½¿ç”¨Javaä»£ç†ï¼ˆéšSpringæä¾›ï¼‰æ¥æ‰“å¼€LTWã€‚ æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥è¿è¡Œå‰é¢æ˜¾ç¤ºçš„ <code>Main</code>ç±»ï¼š</p><p>java -javaagent:C:&#x2F;projects&#x2F;foo&#x2F;lib&#x2F;global&#x2F;spring-instrument.jar foo.Main</p><p><code>-javaagent</code>æ˜¯ä¸€ä¸ªæ ‡å¿—ï¼Œç”¨äºæŒ‡å®šå’Œå¯ç”¨ <a href="https://docs.oracle.com/javase/6/docs/api/java/lang/instrument/package-summary.html">ä»£ç†ç¨‹åºæ¥æ£€æµ‹åœ¨JVMä¸Šè¿è¡Œçš„ç¨‹åº</a>ã€‚Spring Frameworké™„å¸¦äº†ä¸€ä¸ªä»£ç†ç¨‹åº<code>InstrumentationSavingAgent</code>ï¼Œ å®ƒåŒ…è£…åœ¨<code>spring-instrument.jar</code>ä¸­ï¼Œå®ƒä½œä¸ºå‰é¢ç¤ºä¾‹ä¸­-javaagentå‚æ•°çš„å€¼æä¾›ã€‚</p><p>ä¸»ç¨‹åºçš„è¾“å‡ºå°†å¦‚ä¸‹æ‰€ç¤ºã€‚ï¼ˆå‰é¢å·²ç»ä»‹ç»äº†<code>Thread.sleep(..)</code>å£°æ˜ä¸º <code>calculateEntitlement()</code>å®ç°ä½¿åˆ†æå™¨å®é™…ä¸Šæ•è·äº†æ¯”0æ¯«ç§’æ›´å¤šçš„ä¸œè¥¿ï¼ˆ<code>01234</code>æ¯«ç§’ä¸æ˜¯AOPå¼•å…¥çš„å¼€é”€ï¼‰ ï¼‰ä¸‹é¢çš„æ¸…å•æ˜¾ç¤ºäº†è¾“å‡º æˆ‘ä»¬è¿è¡Œæˆ‘ä»¬çš„æ¢æŸ¥å™¨æ—¶å¾—åˆ°äº†:</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livescript">Calculating entitlement<br>StopWatch <span class="hljs-string">&#x27;ProfilingAspect&#x27;</span>: running time (millis) = <span class="hljs-number">1234</span><span class="hljs-string">\-\-\-\-\-\-</span> <span class="hljs-string">\-\-\-\-\-</span> <span class="hljs-string">\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-ms</span>     %     Task name<span class="hljs-string">\-\-\-\-\-\-</span> <span class="hljs-string">\-\-\-\-\-</span> <span class="hljs-string">\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-01234</span>  <span class="hljs-number">100</span>%  calculateEntitlement<br></code></pre></td></tr></table></figure><p>ç”±äºLTWæ˜¯ä¼šå¯¹AspectJäº§ç”Ÿå½±å“çš„ï¼Œè€Œä¸æ˜¯ä»…ä»…å±€é™åœ¨Springçš„beansã€‚åœ¨ <code>Main</code>ç¨‹åºçš„è½»å¾®å˜åŒ–ä¼šäº§ç”Ÿç›¸åŒçš„ç»“æœ:</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-keyword">package</span> foo;<br><span class="hljs-keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-title class_"><span class="hljs-keyword">class</span> <span class="hljs-title">Main</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> void main(<span class="hljs-keyword">String</span>[] args) &#123;<br>        <span class="hljs-keyword">new</span> <span class="hljs-type">ClassPathXmlApplicationContext</span>(<span class="hljs-string">&quot;beans.xml&quot;</span>, Main.class);<br>        EntitlementCalculationService entitlementCalculationService =            <span class="hljs-keyword">new</span> <span class="hljs-type">StubEntitlementCalculationService</span>();<br>        <span class="hljs-comment">// the profiling aspect will be &#x27;woven&#x27; around this method execution        entitlementCalculationService.calculateEntitlement();    &#125;&#125;</span><br></code></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œåœ¨å‰é¢çš„ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å¦‚ä½•å¼•å¯¼Springå®¹å™¨ï¼Œç„¶ååœ¨Springçš„ä¸Šä¸‹æ–‡ä¹‹å¤–åˆ›å»ºä¸€ä¸ªæ–°çš„<code>StubEntitlementCalculationService</code>å®ä¾‹ã€‚ åˆ†æé€šçŸ¥ä¾ç„¶ä¼šè¢«ç¼–ç»‡ã€‚</p><p>ä¸å¯å¦è®¤ï¼Œè¿™ä¸ªä¾‹å­å¾ˆç®€å•ã€‚ä½†æ˜¯åœ¨Springä¸­æ”¯æŒLTWçš„åŸºç¡€éƒ½ä»‹ç»åˆ°äº†ï¼Œè€Œä¸”ä¸ºä»€ä¹ˆä½¿ç”¨ä»¥åŠæ€æ ·ä½¿ç”¨é…ç½®åœ¨åé¢çš„ç« èŠ‚ä¹Ÿå°†è§£é‡Šã€‚</p><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ä½¿ç”¨çš„<code>ProfilingAspect</code>å¯èƒ½å¾ˆåŸºç¡€çš„ï¼Œä½†å®ƒéå¸¸æœ‰ç”¨ã€‚æ˜¯ä¸€ä¸ªå¼€å‘è€…å¯ä»¥ä½¿ç”¨åœ¨å¼€å‘è¿‡ç¨‹ä¸­ä½¿ç”¨å¼€å‘æ—¶é—´åˆ‡é¢çš„ä¾‹å­ï¼Œ ç„¶åå¾ˆå®¹æ˜“åœ°æ’é™¤æ¥è‡ªåº”ç”¨ç¨‹åºè¢«éƒ¨ç½²åˆ°æµ‹è¯•æˆ–ç”Ÿäº§ä¸­çš„å› ç´ ã€‚</p><h5 id="åˆ‡é¢"><a href="#åˆ‡é¢" class="headerlink" title="åˆ‡é¢"></a>åˆ‡é¢</h5><p>åœ¨LTWä½¿ç”¨çš„aspectså¿…é¡»æ˜¯AspectJçš„åˆ‡é¢ã€‚å®ƒä»¬å¯ä»¥å†™åœ¨AspectJè¯­è¨€æœ¬èº«ä¹Ÿå¯ä»¥åœ¨@AspectJæ–¹å¼å£°æ˜ã€‚è¿™æ„å‘³ç€aspectsåœ¨AspectJå’ŒSpring AOPçš„åˆ‡é¢éƒ½æœ‰æ•ˆã€‚ æ­¤å¤–ï¼Œç¼–è¯‘åˆ‡é¢çš„ç±»éœ€è¦åŒ…å«åœ¨ç±»è·¯å¾„ä¸­ã€‚</p><h5 id="â€˜META-INF-aop-xmlâ€™"><a href="#â€˜META-INF-aop-xmlâ€™" class="headerlink" title="â€˜META-INF&#x2F;aop.xmlâ€™"></a>â€˜META-INF&#x2F;aop.xmlâ€™</h5><p>ä½¿ç”¨AspectJ LTWçš„åŸºç¡€è®¾æ–½æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ª<code>META-INF/aop.xml</code>é…ç½®æ–‡ä»¶ï¼Œè¿™æ˜¯åœ¨Javaç±»è·¯å¾„ä¸­çš„ï¼ˆç›´æ¥çš„æˆ–è€…æ›´é€šå¸¸æ˜¯ä¸€ä¸ªJARæ–‡ä»¶ï¼‰ã€‚</p><p>LTWéƒ¨åˆ† <a href="https://www.eclipse.org/aspectj/doc/released/devguide/ltw-configuration.html">AspectJå‚è€ƒæ–‡æ¡£</a>ä¸­è¯¦ç»†ä»‹ç»äº†æ­¤æ–‡ä»¶çš„ç»“æ„å’Œå†…å®¹ã€‚ ç”±äºaop.xmlæ–‡ä»¶æ˜¯100ï¼…AspectJï¼Œå› æ­¤æˆ‘ä»¬ä¸åœ¨æ­¤è¿›ä¸€æ­¥æè¿°ã€‚</p><h5 id="éœ€è¦çš„ç±»åº“-JARS"><a href="#éœ€è¦çš„ç±»åº“-JARS" class="headerlink" title="éœ€è¦çš„ç±»åº“(JARS)"></a>éœ€è¦çš„ç±»åº“(JARS)</h5><p>è‡³å°‘ï¼Œæ‚¨éœ€è¦ä»¥ä¸‹åº“æ¥ä½¿ç”¨Spring Frameworkå¯¹AspectJ LTWçš„æ”¯æŒ:</p><ul><li><code>spring-aop.jar</code> (version 2.5 or later, plus all mandatory dependencies)</li><li><code>aspectjweaver.jar</code> (version 1.6.8 or later)</li></ul><p>å¦‚æœä½¿ç”¨<a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-aj-ltw-environment-generic">Springæä¾›çš„ä»£ç†ç¨‹åºå¯ç”¨æ£€æµ‹</a>ï¼Œåˆ™è¿˜éœ€è¦ï¼š</p><ul><li><code>spring-instrument.jar</code></li></ul><h5 id="Springçš„é…ç½®"><a href="#Springçš„é…ç½®" class="headerlink" title="Springçš„é…ç½®"></a>Springçš„é…ç½®</h5><p>Springæ”¯æŒLTWçš„å…³é”®éƒ¨ä»¶æ˜¯ <code>LoadTimeWeaver</code>æ¥å£ï¼ˆä½äº<code>org.springframework.instrument.classloading</code>åŒ…ï¼‰ï¼Œè€Œè¿™æ¥å£æœ‰å¤§éƒ¨åˆ†çš„å®ç°åˆ†å¸ƒåœ¨Springä¸­ã€‚ <code>LoadTimeWeaver</code>è´Ÿè´£æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ª<code>java.lang.instrument.ClassFileTransformers</code> åˆ°è¿è¡Œæ—¶çš„ç±»è£…è½½å™¨ä¸­ã€‚ è¿™ä¸ºå„ç§æœ‰è¶£çš„åº”ç”¨ç¨‹åºæ‰“å¼€äº†å¤§é—¨ï¼Œå…¶ä¸­ä¸€ä¸ªæ°å¥½æ˜¯æ–¹é¢çš„LTWã€‚</p><p>å¦‚æœæ‚¨ä¸ç†Ÿæ‚‰è¿è¡Œæ—¶ç±»æ–‡ä»¶è½¬æ¢çš„æ¦‚å¿µï¼Œè¯·åœ¨ç»§ç»­ä¹‹å‰æŸ¥çœ‹<code>java.lang.instrument</code> åŒ…çš„javadoc APIæ–‡æ¡£ã€‚è™½ç„¶è¯¥æ–‡æ¡£å¹¶ä¸å…¨é¢ï¼Œä½†è‡³å°‘å¯ä»¥çœ‹åˆ°å…³é”®æ¥å£å’Œç±»ï¼ˆä¾›æ‚¨é˜…è¯»æœ¬èŠ‚æ—¶å‚è€ƒï¼‰ã€‚</p><p>é…ç½®ä¸€ä¸ªç‰¹å®šçš„<code>ApplicationContext</code> <code>LoadTimeWeaver</code>å°±åƒåŠ å…¥ä¸€è¡Œä»£ç ä¸€æ ·å®¹æ˜“ã€‚ï¼ˆè¯·æ³¨æ„ï¼Œå‡ ä¹å¯ä»¥è‚¯å®šä¼šå°†<code>ApplicationContext</code>ä½œä¸ºçš„Springå®¹å™¨- é€šå¸¸ä¸€ä¸ª<code>BeanFactory</code>æ˜¯ä¸å¤Ÿçš„ï¼Œå› ä¸ºLTWçš„æ”¯æŒåˆ©ç”¨åˆ°<code>BeanFactoryPostProcessors</code>ï¼‰ã€‚</p><p>è¦å¯ç”¨Spring Frameworkçš„LTWæ”¯æŒï¼Œæ‚¨éœ€è¦é…ç½®<code>LoadTimeWeaver</code>ï¼Œé€šå¸¸ä½¿ç”¨<code>@EnableLoadTimeWeaving</code>æ³¨è§£æ¥å®Œæˆï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Configuration</span><span class="hljs-variable">@EnableLoadTimeWeavingpublic</span> class AppConfig &#123;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ–è€…ï¼Œå¦‚æœæ‚¨æ›´å–œæ¬¢åŸºäºXMLçš„é…ç½®ï¼Œè¯·ä½¿ç”¨<code>&lt;context:load-time-weaver/&gt;</code>å…ƒç´ ã€‚è¯·æ³¨æ„ï¼Œå…ƒç´ æ˜¯åœ¨ <code>context</code>å‘½åç©ºé—´ä¸­å®šä¹‰çš„ã€‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•ä½¿ç”¨<code>&lt;context:load-time-weaver/&gt;</code>ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span>    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>    <span class="hljs-attr">xmlns:context</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/context&quot;</span>    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;        http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans.xsd        http://www.springframework.org/schema/context        http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">context:load-time-weaver</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„é…ç½®è‡ªåŠ¨ä¸ºä½ ç™»è®°äº†ä¸€äº›ç‰¹å®šçš„åŸºç¡€beansï¼Œä¾‹å¦‚<code>LoadTimeWeaver</code>å’Œ<code>AspectJWeavingEnabler</code>ã€‚ é»˜è®¤çš„<code>LoadTimeWeaver</code>æ˜¯<code>DefaultContextLoadTimeWeaver</code> ç±»ï¼Œå®ƒè¯•å›¾è£…é¥°å¹¶è‡ªåŠ¨æ£€æµ‹<code>LoadTimeWeaver</code>ã€‚ â€œè‡ªåŠ¨æ£€æµ‹â€çš„<code>LoadTimeWeaver</code>çš„ç¡®åˆ‡ç±»å‹å–å†³äºæ‚¨çš„è¿è¡Œæ—¶ç¯å¢ƒã€‚ ä¸‹è¡¨æ€»ç»“äº†å„ç§<code>LoadTimeWeaver</code>å®ç°:</p><p>Table 13. DefaultContextLoadTimeWeaver LoadTimeWeavers</p><table><thead><tr><th>è¿è¡Œæ—¶ç¯å¢ƒ</th><th><code>LoadTimeWeaver</code> å®ç°</th></tr></thead><tbody><tr><td>Running in Oracleâ€™s <a href="http://www.oracle.com/technetwork/middleware/weblogic/overview/index-085209.html">WebLogic</a></td><td><code>WebLogicLoadTimeWeaver</code></td></tr><tr><td>Running in Oracleâ€™s <a href="http://glassfish.dev.java.net/">GlassFish</a></td><td><code>GlassFishLoadTimeWeaver</code></td></tr><tr><td>Running in <a href="https://tomcat.apache.org/">Apache Tomcat</a></td><td><code>TomcatLoadTimeWeaver</code></td></tr><tr><td>Running in Red Hatâ€™s <a href="http://www.jboss.org/jbossas/">JBoss AS</a> or <a href="http://www.wildfly.org/">WildFly</a></td><td><code>JBossLoadTimeWeaver</code></td></tr><tr><td>Running in IBMâ€™s <a href="https://www-01.ibm.com/software/webservers/appserv/was/">WebSphere</a></td><td><code>WebSphereLoadTimeWeaver</code></td></tr><tr><td>JVM started with Spring <code>InstrumentationSavingAgent</code> (<code>java -javaagent:path/to/spring-instrument.jar</code>)</td><td><code>InstrumentationLoadTimeWeaver</code></td></tr><tr><td>Fallback, expecting the underlying ClassLoader to follow common conventions (for example applicable to <code>TomcatInstrumentableClassLoader</code> and <a href="http://www.caucho.com/">Resin</a>)</td><td><code>ReflectiveLoadTimeWeaver</code></td></tr></tbody></table><p>è¯·æ³¨æ„ï¼Œè¯¥è¡¨ä»…åˆ—å‡ºä½¿ç”¨<code>DefaultContextLoadTimeWeaver</code>æ—¶è‡ªåŠ¨æ£€æµ‹çš„ <code>LoadTimeWeavers</code>ã€‚ æ‚¨å¯ä»¥å‡†ç¡®æŒ‡å®šè¦ä½¿ç”¨çš„<code>LoadTimeWeaver</code>å®ç°ã€‚</p><p>ä½¿ç”¨Javaé…ç½®æŒ‡å®šç‰¹å®šçš„ <code>LoadTimeWeaver</code>å®ç°<code>LoadTimeWeavingConfigurer</code> æ¥å£å¹¶è¦†ç›– <code>getLoadTimeWeaver()</code> æ–¹æ³•ã€‚ä»¥ä¸‹ç¤ºä¾‹æŒ‡å®š<code>ReflectiveLoadTimeWeaver</code>ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Configuration</span><span class="hljs-variable">@EnableLoadTimeWeavingpublic</span> class AppConfig implements LoadTimeWeavingConfigurer &#123;<br>    <span class="hljs-variable">@Override</span>    public LoadTimeWeaver <span class="hljs-built_in">getLoadTimeWeaver</span>() &#123;        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">ReflectiveLoadTimeWeaver</span>();    &#125;&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœä½¿ç”¨åŸºäºXMLçš„é…ç½®ï¼Œåˆ™å¯ä»¥å°†å®Œå…¨é™å®šçš„ç±»åæŒ‡å®šä¸º<code>&lt;context:load-time-weaver/&gt;</code>å…ƒç´ ä¸Šçš„ <code>weaver-class</code>å±æ€§çš„å€¼ã€‚ åŒæ ·ï¼Œä»¥ä¸‹ç¤ºä¾‹æŒ‡å®šäº† <code>ReflectiveLoadTimeWeaver</code>:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span>    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>    <span class="hljs-attr">xmlns:context</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/context&quot;</span>    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;        http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans.xsd        http://www.springframework.org/schema/context        http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">context:load-time-weaver</span>            <span class="hljs-attr">weaver-class</span>=<span class="hljs-string">&quot;org.springframework.instrument.classloading.ReflectiveLoadTimeWeaver&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ç¨åå¯ä»¥ä½¿ç”¨ä¼—æ‰€å‘¨çŸ¥çš„åç§° <code>loadTimeWeaver</code>ä»Springå®¹å™¨ä¸­æ£€ç´¢ç”±é…ç½®å®šä¹‰å’Œæ³¨å†Œçš„<code>LoadTimeWeaver</code> ã€‚è¯·è®°ä½ï¼Œ <code>LoadTimeWeaver</code>åªæ˜¯ä½œä¸ºSpringçš„LTWåŸºç¡€ç»“æ„çš„æœºåˆ¶æ¥æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ª<code>ClassFileTransformer</code>ï¼Œæ‰§è¡ŒLTWçš„å®é™…<code>ClassFileTransformers</code>æ˜¯ <code>ClassPreProcessorAgentAdapter</code>ï¼ˆæ¥è‡ª<code>org.aspectj.weaver.loadtime</code>åŒ…ï¼‰ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<code>ClassPreProcessorAgentAdapter</code>ç±»çš„ç±»çº§javadocï¼Œ å› ä¸ºç¼–ç»‡å®é™…å¦‚ä½•å®ç°çš„ç»†èŠ‚è¶…å‡ºäº†æœ¬æ–‡æ¡£çš„èŒƒå›´ã€‚</p><p>å‰©ä¸‹è¦è®¨è®ºçš„é…ç½®æœ‰ä¸€ä¸ªæœ€ç»ˆå±æ€§ï¼š<code>aspectjWeaving</code>å±æ€§ï¼ˆå¦‚æœä½¿ç”¨XMLï¼Œåˆ™ä¸º<code>aspectj-weaving</code>ï¼‰ã€‚ æ­¤å±æ€§æ§åˆ¶æ˜¯å¦å¯ç”¨LTWã€‚ å®ƒæ¥å—ä¸‰ä¸ªå¯èƒ½å€¼ä¸­çš„ä¸€ä¸ªï¼Œå¦‚æœè¯¥å±æ€§ä¸å­˜åœ¨ï¼Œåˆ™é»˜è®¤å€¼ä¸º<code>autodetect</code>ã€‚ ä¸‹è¡¨æ€»ç»“äº†ä¸‰ä¸ªå¯èƒ½çš„å€¼:</p><p>Table 14. AspectJç»‡å…¥çš„å±æ€§å€¼</p><table><thead><tr><th>Annotation Value</th><th>XML Value</th><th>Explanation</th></tr></thead><tbody><tr><td><code>ENABLED</code></td><td><code>on</code></td><td>AspectJç¼–ç»‡å¼€å¯ï¼Œåˆ‡é¢åœ¨åŠ è½½æ—¶ç»‡å…¥ã€‚</td></tr><tr><td><code>DISABLED</code></td><td><code>off</code></td><td>LTWå·²å…³é—­ã€‚ æ²¡æœ‰åˆ‡é¢åŠ è½½æ—¶ç»‡å…¥ã€‚</td></tr><tr><td><code>AUTODETECT</code></td><td><code>autodetect</code></td><td>å¦‚æœSpring LTWåŸºç¡€ç»“æ„å¯ä»¥æ‰¾åˆ°è‡³å°‘ä¸€ä¸ª<code>META-INF/aop.xml</code>æ–‡ä»¶ï¼Œé‚£ä¹ˆAspectJç¼–ç»‡å°±ä¼šæ‰“å¼€ã€‚ å¦åˆ™ï¼Œå®ƒå…³é—­ã€‚ è¿™æ˜¯é»˜è®¤å€¼ã€‚</td></tr></tbody></table><h5 id="ç‰¹å®šç¯å¢ƒçš„é…ç½®"><a href="#ç‰¹å®šç¯å¢ƒçš„é…ç½®" class="headerlink" title="ç‰¹å®šç¯å¢ƒçš„é…ç½®"></a>ç‰¹å®šç¯å¢ƒçš„é…ç½®</h5><p>æœ€åä¸€éƒ¨åˆ†åŒ…å«åœ¨åº”ç”¨ç¨‹åºæœåŠ¡å™¨å’ŒWebå®¹å™¨ç­‰ç¯å¢ƒä¸­ä½¿ç”¨Spring LTWæ”¯æŒæ—¶æ‰€éœ€çš„ä»»ä½•å…¶ä»–è®¾ç½®å’Œé…ç½®ã€‚</p><h6 id="Tomcat"><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h6><p>ä»å†å²ä¸Šçœ‹, <a href="https://tomcat.apache.org/">Apache Tomcat</a>çš„é»˜è®¤ç±»åŠ è½½å™¨ä¸æ”¯æŒç±»è½¬æ¢ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆSpringæä¾›äº†ä¸€ä¸ªå¢å¼ºçš„å®ç°æ¥æ»¡è¶³è¿™ä¸€éœ€æ±‚ã€‚ åå­—å«<code>TomcatInstrumentableClassLoader</code>ï¼ŒåŠ è½½ç¨‹åºé€‚ç”¨äºTomcat 6.0åŠæ›´é«˜ç‰ˆæœ¬ã€‚</p><p>ä¸è¦åœ¨Tomcat 8.0åŠæ›´é«˜ç‰ˆæœ¬ä¸Šå®šä¹‰<code>TomcatInstrumentableClassLoader</code> ã€‚ ç›¸åï¼Œè®©Springé€šè¿‡<code>TomcatLoadTimeWeaver</code> ç­–ç•¥è‡ªåŠ¨ä½¿ç”¨Tomcatçš„æ–°çš„ï¼ŒåŸç”Ÿçš„<code>InstrumentableClassLoader</code>å·¥å…·ã€‚</p><p>å¦‚æœä»éœ€è¦ä½¿ç”¨<code>TomcatInstrumentableClassLoader</code>ï¼Œåˆ™å¯ä»¥ä¸ºæ¯ä¸ªWebåº”ç”¨ç¨‹åºå•ç‹¬æ³¨å†Œï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><ol><li><p>å°†<code>org.springframework.instrument.tomcat.jar</code>å¤åˆ¶åˆ°<code>$CATALINA_HOME/lib</code>ä¸­ï¼Œå…¶ä¸­<code>$CATALINA_HOME</code>è¡¨ç¤ºTomcatå®‰è£…çš„æ ¹ç›®å½•</p></li><li><p>é€šè¿‡ç¼–è¾‘Webåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡æ–‡ä»¶ï¼ŒæŒ‡ç¤ºTomcatä½¿ç”¨è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼ˆè€Œä¸æ˜¯é»˜è®¤å€¼ï¼‰ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p></li></ol><p>Apache Tomcat 6.0+æ”¯æŒå¤šä¸ªä¸Šä¸‹æ–‡ä½ç½®:</p><ul><li>æœåŠ¡é…ç½®æ–‡ä»¶ : <code>$CATALINA_HOME/conf/server.xml</code></li><li>é»˜è®¤ä¸Šä¸‹æ–‡é…ç½® : <code>$CATALINA_HOME/conf/context.xml</code>, which affects all deployed web applications</li><li>æ¯ä¸ªåº”ç”¨ç¨‹åºçš„é…ç½®, å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯çš„<code>$CATALINA_HOME/conf/[enginename]/[hostname]/[webapp]-context.xml</code>ä¸Šéƒ¨ç½²ä¹Ÿå¯ä»¥åµŒå…¥åœ¨webåº”ç”¨ç¨‹åº<code>META-INF/context.xml</code>ä¸­</li></ul><p>ä¸ºäº†æé«˜æ•ˆç‡ï¼Œå»ºè®®ä½¿ç”¨åµŒå…¥å¼Webåº”ç”¨ç¨‹åºé…ç½®é£æ ¼ï¼Œå› ä¸ºå®ƒåªå½±å“ä½¿ç”¨è‡ªå®šä¹‰ç±»è£…å…¥å™¨çš„åº”ç”¨ç¨‹åºï¼Œä¸éœ€è¦å¯¹æœåŠ¡å™¨é…ç½®è¿›è¡Œä»»ä½•æ›´æ”¹ã€‚ æœ‰å…³å¯ç”¨ä¸Šä¸‹æ–‡ä½ç½®çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…Tomcat 6.0.x<a href="https://tomcat.apache.org/tomcat-6.0-doc/config/context.html">æ–‡æ¡£</a>ã€‚</p><p>æˆ–è€…ï¼Œè€ƒè™‘ä½¿ç”¨Springæä¾›çš„é€šç”¨VMä»£ç†ï¼Œåœ¨Tomcatçš„å¯åŠ¨è„šæœ¬ä¸­æŒ‡å®šï¼ˆåœ¨æœ¬èŠ‚å‰é¢ä»‹ç»è¿‡ï¼‰ã€‚ è¿™å°†ä½¿åŠŸèƒ½é€‚ç”¨äºæ‰€æœ‰éƒ¨ç½²çš„Webåº”ç”¨ç¨‹åºï¼Œæ— è®ºå®ƒä»¬æ°å¥½è¿è¡Œåœ¨å“ªä¸ª<code>ClassLoader</code>ä¸Šã€‚</p><h6 id="WebLogic-WebSphere-Resin-GlassFish-and-JBoss"><a href="#WebLogic-WebSphere-Resin-GlassFish-and-JBoss" class="headerlink" title="WebLogic, WebSphere, Resin, GlassFish, and JBoss"></a>WebLogic, WebSphere, Resin, GlassFish, and JBoss</h6><p>æœ€æ–°ç‰ˆæœ¬çš„WebLogic Serverï¼ˆç‰ˆæœ¬10åŠæ›´é«˜ç‰ˆæœ¬ï¼‰ï¼ŒIBM WebSphere Application Serverï¼ˆç‰ˆæœ¬7åŠæ›´é«˜ç‰ˆæœ¬ï¼‰ï¼ŒResinï¼ˆç‰ˆæœ¬3.1åŠæ›´é«˜ç‰ˆæœ¬ï¼‰å’ŒJBossï¼ˆç‰ˆæœ¬6.xæˆ–æ›´é«˜ç‰ˆæœ¬ï¼‰ æä¾›äº†ä¸€ä¸ªèƒ½å¤Ÿè¿›è¡Œæœ¬åœ°æ£€æµ‹çš„ClassLoaderã€‚Springçš„åŸç”ŸLTWåˆ©ç”¨è¿™ç§ClassLoaderå®ç°æ¥å®ç°AspectJç»‡å…¥ã€‚ <a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-using-aspectj">å¦‚å‰æ‰€è¿°</a>ï¼Œæ‚¨å¯ä»¥é€šè¿‡æ¿€æ´»åŠ è½½æ—¶ç»‡å…¥æ¥å¯ç”¨LTWã€‚ å…·ä½“æ¥è¯´ï¼Œæ‚¨æ— éœ€ä¿®æ”¹å¯åŠ¨è„šæœ¬å³å¯æ·»åŠ <code>-javaagent:path/to/spring-instrument.jar</code>ã€‚</p><p>è¯·æ³¨æ„ï¼Œå…·æœ‰GlassFishåŠŸèƒ½çš„<code>ClassLoader</code> ä»…åœ¨å…¶EARç¯å¢ƒä¸­å¯ç”¨ã€‚å¯¹äºGlassFish Webåº”ç”¨ç¨‹åºï¼Œè¯·æŒ‰ç…§<a href="https://sca.aliyun.com/learn/spring/core/aop/?spm=0.29160081.0.0.51f92e5dCHrGI4#aop-aj-ltw-environment-tomcat">ä¸Šé¢æ¦‚è¿°</a>çš„Tomcatè®¾ç½®è¯´æ˜è¿›è¡Œæ“ä½œã€‚ .</p><p>æ³¨æ„åœ¨JBoss 6.xä¸­ï¼Œ åº”ç”¨ç¨‹åºæœåŠ¡å™¨çš„æ‰«æéœ€è¦ç¦ç”¨ï¼Œé˜²æ­¢å®ƒåŠ è½½çš„ç±»çš„åº”ç”¨ä¹‹å‰å®é™…ä¸Šå·²ç»å¼€å§‹ã€‚å¿«é€Ÿçš„è§£å†³æ–¹æ¡ˆæ˜¯å¢åŠ ä¸€ä¸ªå«<code>WEB-INF/jboss-scanning.xml</code>çš„æ–‡æ¡£å¹¶åŠ å…¥ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;scanning <span class="hljs-attribute">xmlns</span>=<span class="hljs-string">&quot;urn:jboss:scanning:1.0&quot;</span>/&gt;<br></code></pre></td></tr></table></figure><h6 id="é€šç”¨çš„Javaåº”ç”¨"><a href="#é€šç”¨çš„Javaåº”ç”¨" class="headerlink" title="é€šç”¨çš„Javaåº”ç”¨"></a>é€šç”¨çš„Javaåº”ç”¨</h6><p>åœ¨ä¸æ”¯æŒç°æœ‰<code>LoadTimeWeaver</code>å®ç°æˆ–ä¸å—ç°æœ‰<code>LoadTimeWeaver</code>å®ç°æ”¯æŒçš„ç¯å¢ƒä¸­éœ€è¦ç±»æ£€æµ‹æ—¶ï¼Œä½¿ç”¨JDKä»£ç†å¯èƒ½æ˜¯å”¯ä¸€çš„è§£å†³æ–¹æ¡ˆã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œ Springæä¾›äº†<code>InstrumentationLoadTimeWeaver</code>ï¼Œå®ƒéœ€è¦Springç‰¹æœ‰çš„ï¼ˆä½†ä¹Ÿæ˜¯éå¸¸æ™®é€šçš„ï¼‰VMä»£ç†åŒ…<code>org.springframework.instrument-&#123;version&#125;.jar</code>(ä»¥å‰ç§°ä¸º <code>spring-agent.jar</code>).</p><p>è¦ä½¿ç”¨å®ƒï¼Œå¿…é¡»é€šè¿‡æä¾›ä»¥ä¸‹JVMé€‰é¡¹æ¥å¯åŠ¨å¸¦æœ‰Springä»£ç†çš„è™šæ‹Ÿæœºã€‚:</p><p>-javaagent:&#x2F;path&#x2F;to&#x2F;org.springframework.instrument-{version}.jar</p><p>è¿™éœ€è¦ä¿®æ”¹VMå¯åŠ¨è„šæœ¬ï¼Œè¿™å¯èƒ½ä¼šé˜»æ­¢åœ¨åº”ç”¨æœåŠ¡å™¨ç¯å¢ƒä¸­ä½¿ç”¨å®ƒï¼ˆå…·ä½“å–å†³äºæ“ä½œç­–ç•¥ï¼‰ã€‚æ­¤å¤–ï¼ŒJDKä»£ç†å¯ä»¥æ£€æµ‹æ•´ä¸ªVMï¼Œè¿™å¯èƒ½å¾ˆæ˜‚è´µã€‚ã€‚</p><p>å‡ºäºæ€§èƒ½åŸå› ï¼Œæˆ‘ä»¬å»ºè®®æ‚¨ä»…åœ¨ç›®æ ‡ç¯å¢ƒï¼ˆä¾‹å¦‚<a href="https://www.eclipse.org/jetty/">Jetty</a>ï¼‰æ²¡æœ‰ï¼ˆæˆ–ä¸æ”¯æŒï¼‰ä¸“ç”¨LTWæ—¶æ‰ä½¿ç”¨æ­¤é…ç½®ã€‚</p><h3 id="2-11-æ›´å¤šèµ„æº"><a href="#2-11-æ›´å¤šèµ„æº" class="headerlink" title="2.11. æ›´å¤šèµ„æº"></a>2.11. æ›´å¤šèµ„æº</h3><p>æœ‰å…³AspectJçš„æ›´å¤šä¿¡æ¯å¯ä»¥åœ¨<a href="https://www.eclipse.org/aspectj">AspectJ website</a>ä¸Šæ‰¾åˆ°ã€‚</p><p>_Eclipse AspectJ_çš„ä¹¦Eclipse AspectJ (Addison-Wesley, 2005) æä¾›äº†è¯¦å°½çš„æœ‰å…³AspectJè¯­è¨€çš„ä»‹ç»</p><p><em>AspectJ in Action</em>, ä¸€ä¹¦çš„ç¬¬äºŒç‰ˆç”±Ramnivas Laddadï¼ˆManningï¼Œ2009)å‡ºç‰ˆï¼Œä¹Ÿæ˜¯å¼ºçƒˆæ¨èçš„ã€‚è¿™æœ¬ä¹¦çš„é‡ç‚¹æ˜¯AspectJï¼Œä½†ä¹Ÿåœ¨ä¸€å®šçš„æ·±åº¦ä¸Šæ¢è®¨äº†æ™®é€šçš„AOPä¸»é¢˜ã€‚</p><blockquote><p>Rod Johnson, Juergen Hoeller, Keith Donald, Colin Sampaleanu, Rob Harrop, Thomas Risberg, Alef Arendsen, Darren Davison, Dmitriy Kopylenko, Mark Pollack, Thierry Templier, Erwin Vervaet, Portia Tung, Ben Hale, Adrian Colyer, John Lewis, Costin Leau, Mark Fisher, Sam Brannen, Ramnivas Laddad, Arjen Poutsma, Chris Beams, Tareq Abedrabbo, Andy Clement, Dave Syer, Oliver Gierke, Rossen Stoyanchev, Phillip Webb, Rob Winch, Brian Clozel, Stephane Nicoll, Sebastien Deleuze, Jay Bryant, Mark Paluch</p></blockquote><blockquote><p>Copyright Â© 2002 - 2024 VMware, Inc. All Rights Reserved.</p></blockquote><blockquote><p>Copies of this document may be made for your own use and for distribution to others, provided that you do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically.</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>Spring æ•™ç¨‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Spring</tag>
      
      <tag>AOP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>IOCå®¹å™¨</title>
    <link href="/post/ee218146-1936-4260-8d7e-ac7205d4d805/"/>
    <url>/post/ee218146-1936-4260-8d7e-ac7205d4d805/</url>
    
    <content type="html"><![CDATA[<h3 id="IOCå®¹å™¨"><a href="#IOCå®¹å™¨" class="headerlink" title="IOCå®¹å™¨"></a>IOCå®¹å™¨</h3><p><code>hexo template generate by typora plugin templater</code></p><h1 id="IOC-å®¹å™¨"><a href="#IOC-å®¹å™¨" class="headerlink" title="IOC å®¹å™¨"></a>IOC å®¹å™¨</h1><p>Spring æ•™ç¨‹</p><hr><h2 id="1-IOCå®¹å™¨"><a href="#1-IOCå®¹å™¨" class="headerlink" title="1. IOCå®¹å™¨"></a>1. IOCå®¹å™¨</h2><p>è¿™ç« é‡ç‚¹è¯´æ˜IOCå®¹å™¨.</p><h3 id="1-1-Spring-IoCå®¹å™¨å’Œbeançš„ä»‹ç»"><a href="#1-1-Spring-IoCå®¹å™¨å’Œbeançš„ä»‹ç»" class="headerlink" title="1.1. Spring IoCå®¹å™¨å’Œbeançš„ä»‹ç»"></a>1.1. Spring IoCå®¹å™¨å’Œbeançš„ä»‹ç»</h3><p>æœ¬ç« ä»‹ç»Springæ¡†æ¶ä¸­æ§åˆ¶åè½¬ <a href="https://github.com/DocsHome/spring-docs/blob/master/pages/overview/overview.md#background-ioc">Inversion of Control</a> çš„å®ç°. IOCä¸å¤§å®¶ç†ŸçŸ¥çš„ä¾èµ–æ³¨å…¥åŒç†ï¼ŒæŒ‡çš„æ˜¯å¯¹è±¡ä»…é€šè¿‡æ„é€ å‡½æ•°å‚æ•°ã€å·¥å‚æ–¹æ³•çš„å‚æ•°æˆ–åœ¨å¯¹è±¡å®ä¾‹æ„é€ ä»¥åæˆ–ä»å·¥å‚æ–¹æ³•è¿”å›ä»¥åï¼Œåœ¨å¯¹è±¡å®ä¾‹ä¸Šè®¾ç½®çš„å±æ€§æ¥å®šä¹‰å®ƒä»¬çš„ä¾èµ–å…³ç³»ï¼ˆå³å®ƒä»¬ä½¿ç”¨çš„å…¶ä»–å¯¹è±¡). ç„¶åå®¹å™¨åœ¨åˆ›å»ºbeanæ—¶æ³¨å…¥è¿™äº›éœ€è¦çš„ä¾èµ–ã€‚ è¿™ä¸ªè¿‡ç¨‹åŸºæœ¬ä¸Šæ˜¯beanæœ¬èº«çš„é€†è¿‡ç¨‹ï¼ˆå› æ­¤ç§°ä¸ºIOCï¼‰ï¼Œé€šè¿‡ä½¿ç”¨ç±»çš„ç›´æ¥æ„é€ æˆ–æœåŠ¡å®šä½å™¨æ¨¡å¼ç­‰æœºåˆ¶æ¥æ§åˆ¶å…¶ä¾èµ–é¡¹çš„å®ä¾‹åŒ–æˆ–ä½ç½®ã€‚</p><p><code>org.springframework.beans</code> å’Œ <code>org.springframework.context</code> æ˜¯å®ç°Spring IOCå®¹å™¨æ¡†æ¶çš„åŸºç¡€. <a href="https://docs.spring.io/spring-framework/docs/5.1.3.BUILD-SNAPSHOT/javadoc-api/org/springframework/beans/factory/BeanFactory.html"><code>BeanFactory</code></a> æ¥å£æä¾›äº†ä¸€ç§æ›´å…ˆè¿›çš„é…ç½®æœºåˆ¶æ¥ç®¡ç†ä»»æ„ç±»å‹çš„å¯¹è±¡. <a href="https://docs.spring.io/spring-framework/docs/5.1.3.BUILD-SNAPSHOT/javadoc-api/org/springframework/context/ApplicationContext.html"><code>ApplicationContext</code></a> æ˜¯<code>BeanFactory</code>çš„å­æ¥å£. ä»–æä¾›äº†:</p><ul><li>æ›´å®¹æ˜“ä¸Springçš„AOPç‰¹æ€§é›†æˆ</li><li>æ¶ˆæ¯èµ„æºå¤„ç†(ç”¨äºå›½é™…åŒ–)</li><li>äº‹ä»¶å‘å¸ƒ</li><li>åº”ç”¨å±‚ç‰¹å®šçš„ä¸Šä¸‹æ–‡ï¼Œå¦‚ç”¨äºwebåº”ç”¨ç¨‹åºçš„<code>WebApplicationContext</code>.</li></ul><p>ç®€è€Œè¨€ä¹‹ï¼Œ<code>BeanFactory</code>æä¾›äº†é…ç½®æ¡†æ¶çš„åŸºæœ¬åŠŸèƒ½ï¼Œ<code>ApplicationContext</code>æ·»åŠ äº†æ›´å¤šç‰¹å®šäºä¼ä¸šçš„åŠŸèƒ½ã€‚ <code>ApplicationContext</code>å®Œå…¨æ‰©å±•äº†<code>BeanFactory</code>çš„åŠŸèƒ½ï¼Œè¿™äº›å†…å®¹å°†åœ¨ä»‹ç»Spring IoCå®¹å™¨çš„ç« èŠ‚ä¸“é—¨è®²è§£ã€‚æœ‰å…³ä½¿ç”¨<code>BeanFactory</code>æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<code>BeanFactory</code>ã€‚</p><p>åœ¨Springä¸­ï¼Œç”±Spring IOCå®¹å™¨ç®¡ç†çš„ï¼Œæ„æˆç¨‹åºçš„éª¨æ¶çš„å¯¹è±¡æˆä¸ºBeanã€‚beanå¯¹è±¡æ˜¯æŒ‡ç»è¿‡IoCå®¹å™¨å®ä¾‹åŒ–ï¼Œç»„è£…å’Œç®¡ç†çš„å¯¹è±¡ã€‚æ­¤å¤–ï¼Œbeanå°±æ˜¯åº”ç”¨ç¨‹åºä¸­ä¼—å¤šå¯¹è±¡ä¹‹ä¸€ ã€‚beanå’Œbeançš„ä¾èµ–ç”±å®¹å™¨æ‰€ä½¿ç”¨çš„é…ç½®å…ƒæ•°æ®åå°„è€Œæ¥ã€‚</p><h3 id="1-2-å®¹å™¨æ¦‚è¿°"><a href="#1-2-å®¹å™¨æ¦‚è¿°" class="headerlink" title="1.2. å®¹å™¨æ¦‚è¿°"></a>1.2. å®¹å™¨æ¦‚è¿°</h3><p><code>org.springframework.context.ApplicationContext</code>æ˜¯Spring IoCå®¹å™¨å®ç°çš„ä»£è¡¨ï¼Œå®ƒè´Ÿè´£å®ä¾‹åŒ–ï¼Œé…ç½®å’Œç»„è£…Beanã€‚å®¹å™¨é€šè¿‡è¯»å–é…ç½®å…ƒæ•°æ®è·å–æœ‰å…³å®ä¾‹åŒ–ã€é…ç½®å’Œç»„è£…å“ªäº›å¯¹è±¡çš„è¯´æ˜ ã€‚é…ç½®å…ƒæ•°æ®å¯ä»¥ä½¿ç”¨XMLã€Javaæ³¨è§£æˆ–Javaä»£ç æ¥å‘ˆç°ã€‚å®ƒå…è®¸ä½ å¤„ç†åº”ç”¨ç¨‹åºçš„å¯¹è±¡ä¸å…¶ä»–å¯¹è±¡ä¹‹é—´çš„äº’ç›¸ä¾èµ–å…³ç³»ã€‚</p><p>Springæä¾›äº†<code>ApplicationContext</code>æ¥å£çš„å‡ ä¸ªå®ç°ã€‚ åœ¨ç‹¬ç«‹åº”ç”¨ç¨‹åºä¸­ï¼Œé€šå¸¸åˆ›å»º<a href="https://docs.spring.io/spring-framework/docs/5.1.3.BUILD-SNAPSHOT/javadoc-api/org/springframework/context/support/ClassPathXmlApplicationContext.html"><code>ClassPathXmlApplicationContext</code></a>æˆ–<a href="https://docs.spring.io/spring-framework/docs/5.1.3.BUILD-SNAPSHOT/javadoc-api/org/springframework/context/support/FileSystemXmlApplicationContext.html"><code>FileSystemXmlApplicationContext</code></a>çš„å®ä¾‹ã€‚è™½ç„¶XMLä¸€ç›´æ˜¯å®šä¹‰é…ç½®å…ƒæ•°æ®çš„ä¼ ç»Ÿæ ¼å¼ï¼Œ ä½†æ˜¯æ‚¨å¯ä»¥æŒ‡å®šå®¹å™¨ä½¿ç”¨Javaæ³¨è§£æˆ–ç¼–ç¨‹çš„æ–¹å¼ç¼–å†™å…ƒæ•°æ®æ ¼å¼ï¼Œå¹¶é€šè¿‡æä¾›å°‘é‡çš„XMLé…ç½®ä»¥å£°æ˜å¯¹æŸäº›é¢å¤–å…ƒæ•°æ®çš„æ”¯æŒã€‚</p><p>åœ¨å¤§å¤šæ•°åº”ç”¨åœºæ™¯ä¸­ï¼Œä¸éœ€è¦ç”¨æˆ·æ˜¾å¼çš„ç¼–å†™ä»£ç æ¥å®ä¾‹åŒ–IOCå®¹å™¨çš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªå®ä¾‹ã€‚ä¾‹å¦‚ï¼Œåœ¨Webåº”ç”¨åœºæ™¯ä¸­ï¼Œåªéœ€è¦åœ¨web.xmlä¸­æ·»åŠ å¤§æ¦‚8è¡Œç®€å•çš„webæè¿°æ ·æ¿å°±è¡Œäº†ã€‚ï¼ˆ <a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#context-create">ä¾¿æ·çš„ApplicationContextå®ä¾‹åŒ–Webåº”ç”¨ç¨‹åº</a>ï¼‰ å¦‚æœä½ ä½¿ç”¨çš„æ˜¯åŸºäºEclipseçš„<a href="https://spring.io/tools/sts">Spring Tool Suite</a>å¼€å‘ç¯å¢ƒï¼Œè¯¥æ ·æ¿é…ç½®åªéœ€ç‚¹å‡»å‡ ä¸‹é¼ æ ‡æˆ–æŒ‰å‡ ä¸‹é”®ç›˜å°±èƒ½åˆ›å»ºäº†ã€‚</p><p>ä¸‹å›¾å±•ç¤ºäº†Springå·¥ä½œæ–¹å¼çš„é«˜çº§è§†å›¾ï¼Œåº”ç”¨ç¨‹åºçš„ç±»ä¸å…ƒæ•°æ®é…ç½®ç›¸äº’é…åˆï¼Œè¿™æ ·ï¼Œåœ¨<code>ApplicationContext</code>åˆ›å»ºå’Œåˆå§‹åŒ–åï¼Œä½ ç«‹å³æ‹¥æœ‰ä¸€ä¸ªå¯é…ç½®çš„ï¼Œå¯æ‰§è¡Œçš„ç³»ç»Ÿæˆ–åº”ç”¨ç¨‹åºã€‚</p><p><img src="container-magic.png" alt="container magic"></p><p>å›¾ 1. IOCå®¹å™¨</p><h4 id="1-2-1-é…ç½®å…ƒæ•°æ®"><a href="#1-2-1-é…ç½®å…ƒæ•°æ®" class="headerlink" title="1.2.1. é…ç½®å…ƒæ•°æ®"></a>1.2.1. é…ç½®å…ƒæ•°æ®</h4><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒSpring IOCå®¹å™¨ä½¿ç”¨å…ƒæ•°æ®é…ç½®è¿™ç§å½¢å¼ï¼Œè¿™ä¸ªé…ç½®å…ƒæ•°æ®è¡¨ç¤ºäº†åº”ç”¨å¼€å‘äººå‘˜å‘Šè¯‰Springå®¹å™¨ä»¥ä½•ç§æ–¹å¼å®ä¾‹åŒ–ã€é…ç½®å’Œç»„è£…åº”ç”¨ç¨‹åºä¸­çš„å¯¹è±¡ã€‚</p><p>é…ç½®å…ƒæ•°æ®é€šå¸¸ä»¥ç®€å•ã€ç›´è§‚çš„XMLæ ¼å¼æä¾›ï¼Œæœ¬ç« çš„å¤§éƒ¨åˆ†å†…å®¹éƒ½ä½¿ç”¨è¿™ç§æ ¼å¼æ¥è¯´æ˜Spring IoCå®¹å™¨çš„å…³é”®æ¦‚å¿µå’Œç‰¹æ€§ã€‚</p><p>XMLå¹¶ä¸æ˜¯é…ç½®å…ƒæ•°æ®çš„å”¯ä¸€æ–¹å¼ï¼ŒSpring IoCå®¹å™¨æœ¬èº«æ˜¯å®Œå…¨ä¸å…ƒæ•°æ®é…ç½®çš„å®é™…æ ¼å¼åˆ†ç¦»çš„ã€‚ç°åœ¨ï¼Œè®¸å¤šå¼€å‘äººå‘˜é€‰æ‹©<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-java">åŸºäºJavaçš„é…ç½®</a>æ¥å¼€å‘åº”ç”¨ç¨‹åºã€‚</p><p>æ›´å¤šå…¶ä»–æ ¼å¼çš„å…ƒæ•°æ®è§:</p><ul><li><a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-annotation-config">åŸºäºæ³¨è§£çš„é…ç½®</a>: Spring 2.5 æ”¯æŒåŸºäºæ³¨è§£çš„å…ƒæ•°æ®é…ç½®.</li><li><a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-java">åŸºäºJavaçš„é…ç½®</a>: ä» Spring 3.0å¼€å§‹, ç”±Spring JavaConfigé¡¹ç›®æä¾›çš„åŠŸèƒ½å·²ç»æˆä¸ºSpringæ ¸å¿ƒæ¡†æ¶çš„ä¸€éƒ¨åˆ†ã€‚å› æ­¤ï¼Œä½ å¯ä»¥ä½¿ç”¨Javaé…ç½®æ¥ä»£æ›¿XMLé…ç½®å®šä¹‰å¤–éƒ¨bean ã€‚è¦ä½¿ç”¨è¿™äº›æ–°åŠŸèƒ½ï¼Œè¯·å‚é˜… <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/Configuration.html"><code>@Configuration</code></a>, <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/Bean.html"><code>@Bean</code></a>, <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/Import.html"><code>@Import</code></a>, å’Œ <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/DependsOn.html"><code>@DependsOn</code></a> annotations.</li></ul><p>Springé…ç½®è‡³å°‘ä¸€ä¸ªï¼ˆé€šå¸¸ä¸æ­¢ä¸€ä¸ªï¼‰ç”±å®¹å™¨æ¥ç®¡ç†ã€‚åŸºäºXMLçš„å…ƒæ•°æ®é…ç½®å°†è¿™äº›beané…ç½®ä¸º<code>&lt;bean/&gt;</code>å…ƒç´ ï¼Œå¹¶æ”¾ç½®äº<code>&lt;bean/&gt;</code>å…ƒç´ å†…éƒ¨ã€‚ å…¸å‹çš„Javaé…ç½®æ˜¯åœ¨ä½¿ç”¨<code>@Configuration</code>æ³¨è§£è¿‡çš„ç±»ä¸­ï¼Œåœ¨å®ƒçš„æ–¹æ³•ä¸Šä½¿ç”¨<code>@Bean</code>æ³¨è§£ã€‚</p><p>è¿™äº›beanå®šä¹‰ä¼šå¯¹åº”åˆ°æ„æˆåº”ç”¨ç¨‹åºçš„å®é™…å¯¹è±¡ã€‚é€šå¸¸ä½ ä¼šå®šä¹‰æœåŠ¡å±‚å¯¹è±¡ï¼Œæ•°æ®è®¿é—®å¯¹è±¡ï¼ˆDAOsï¼‰ï¼Œè¡¨ç¤ºå¯¹è±¡(å¦‚Struts <code>Action</code>çš„å®ä¾‹)ï¼ŒåŸºç¡€å¯¹è±¡ï¼ˆå¦‚Hibernate çš„<code>SessionFactories</code>, JMS <code>Queues</code>ï¼‰ã€‚é€šå¸¸ä¸ä¼šåœ¨å®¹å™¨ä¸­é…ç½®ç»†ç²’åº¦çš„åŸŸå¯¹è±¡ï¼Œä½†æ˜¯ï¼Œå› ä¸ºå®ƒçš„åˆ›å»ºå’ŒåŠ è½½é€šå¸¸æ˜¯DAOå’Œä¸šåŠ¡é€»è¾‘çš„ä»»åŠ¡ã€‚ ä½†æ˜¯ï¼Œä½ å¯ä»¥ä½¿ç”¨Springä¸AspectJ é›†æˆç‹¬ç«‹äº IoC å®¹å™¨æ¥åˆ›å»ºçš„å¯¹è±¡ï¼Œè¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#aop-atconfigurable">AspectJåœ¨Springä¸­è¿›è¡Œä¾èµ–å…³ç³»æ³¨å…¥åŸŸå¯¹è±¡</a></p><p>ä¸‹é¢çš„ç¤ºä¾‹æ˜¾ç¤ºäº†åŸºäºXMLå…ƒæ•°æ®é…ç½®çš„åŸºæœ¬ç»“æ„:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span>    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;...&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;...&quot;</span>&gt;</span>  (1) (2)        <span class="hljs-comment">&lt;!-- collaborators and configuration for this bean go here --&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;...&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;...&quot;</span>&gt;</span>        <span class="hljs-comment">&lt;!-- collaborators and configuration for this bean go here --&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- more bean definitions go here --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>1</strong></p><p><code>id</code> å±æ€§æ˜¯å­—ç¬¦ä¸² ï¼Œç”¨æ¥è¯†åˆ«å”¯ä¸€çš„beanå®šä¹‰.</p><p><strong>2</strong></p><p><code>class</code> å±æ€§å®šä¹‰äº†beançš„ç±»å‹ï¼Œä½¿ç”¨å…¨ç±»å.</p><p><code>id</code>å±æ€§çš„å€¼æ˜¯æŒ‡å¼•ç”¨åä½œå¯¹è±¡ï¼ˆåœ¨è¿™ä¸ªä¾‹å­æ²¡æœ‰æ˜¾ç¤ºç”¨äºå¼•ç”¨åä½œå¯¹è±¡çš„XMLï¼‰ã€‚è¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-dependencies">ä¾èµ–</a>è·å–æ›´å¤šä¿¡æ¯</p><h4 id="1-2-2-å®ä¾‹åŒ–å®¹å™¨"><a href="#1-2-2-å®ä¾‹åŒ–å®¹å™¨" class="headerlink" title="1.2.2. å®ä¾‹åŒ–å®¹å™¨"></a>1.2.2. å®ä¾‹åŒ–å®¹å™¨</h4><p>æä¾›ç»™ApplicationContextæ„é€ å‡½æ•°çš„è·¯å¾„å°±æ˜¯å®é™…çš„èµ„æºå­—ç¬¦ä¸²ï¼Œä½¿å®¹å™¨èƒ½ä»å„ç§å¤–éƒ¨èµ„æº(å¦‚æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€Javaç±»è·¯å¾„ç­‰)è£…è½½å…ƒæ•°æ®é…ç½®ã€‚</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">ApplicationContext context</span> = new ClassPathXmlApplicationContext(<span class="hljs-string">&quot;services.xml&quot;</span>, <span class="hljs-string">&quot;daos.xml&quot;</span>);<br></code></pre></td></tr></table></figure><p>å½“ä½ äº†è§£Spring IoCå®¹å™¨ï¼Œä½ å¯èƒ½æƒ³çŸ¥é“æ›´å¤šå…³äºSpringçš„æŠ½è±¡èµ„æºï¼ˆè¯¦ç»†æè¿°<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#resources">èµ„æº</a>ï¼‰å®ƒæä¾›äº†ä¸€ç§æ–¹ä¾¿çš„ï¼Œç”±URIè¯­æ³•å®šä¹‰çš„ä½ç½®è¯»å–InputStreamæè¿°çš„æ–¹å¼ ï¼Œèµ„æºè·¯å¾„è¢«ç”¨äºæ„å»ºåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#resources-app-ctx">åº”ç”¨ç¯å¢ƒå’Œèµ„æºè·¯å¾„</a></p><p>ä¸‹é¢çš„ä¾‹å­æ˜¾ç¤ºäº†æœåŠ¡å±‚å¯¹è±¡(<code>services.xml</code>)é…ç½®æ–‡ä»¶::</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span>    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- services --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;petStore&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.samples.jpetstore.services.PetStoreServiceImpl&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;accountDao&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;accountDao&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;itemDao&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;itemDao&quot;</span>/&gt;</span>        <span class="hljs-comment">&lt;!-- additional collaborators and configuration for this bean go here --&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- more bean definitions for services go here --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä¸‹é¢çš„ç¤ºä¾‹æ˜¾ç¤ºäº†æ•°æ®è®¿é—®å¯¹è±¡ï¼ˆ<code>daos.xml</code>ï¼‰é…ç½®æ–‡ä»¶:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span>    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;accountDao&quot;</span>        <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.samples.jpetstore.dao.jpa.JpaAccountDao&quot;</span>&gt;</span>        <span class="hljs-comment">&lt;!-- additional collaborators and configuration for this bean go here --&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;itemDao&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.samples.jpetstore.dao.jpa.JpaItemDao&quot;</span>&gt;</span>        <span class="hljs-comment">&lt;!-- additional collaborators and configuration for this bean go here --&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- more bean definitions for data access objects go here --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒæœåŠ¡å±‚ç”±PetStoreServiceImplç±»ï¼Œä¸¤ä¸ªæ•°æ®è®¿é—®å¯¹è±¡JpaAccountDaoç±»å’ŒJpaItemDaoç±»ï¼ˆåŸºäºJPAå¯¹è±¡&#x2F;å…³ç³»æ˜ å°„æ ‡å‡†ï¼‰ç»„æˆ property nameå…ƒç´ æ˜¯æŒ‡JavaBeanå±æ€§çš„åç§°ï¼Œè€Œrefå…ƒç´ å¼•ç”¨å¦ä¸€ä¸ªbeanå®šä¹‰çš„åç§°ã€‚idå’Œrefå…ƒç´ ä¹‹é—´çš„è¿™ç§è”ç³»è¡¨è¾¾äº†ç»„åˆå¯¹è±¡ä¹‹é—´çš„ç›¸äº’ä¾èµ–å…³ç³»ã€‚æœ‰å…³å¯¹è±¡é—´çš„ä¾èµ–å…³ç³»ï¼Œè¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-dependencies">ä¾èµ–</a> .</p><h5 id="ç»„åˆåŸºäºXMLçš„å…ƒæ•°æ®é…ç½®"><a href="#ç»„åˆåŸºäºXMLçš„å…ƒæ•°æ®é…ç½®" class="headerlink" title="ç»„åˆåŸºäºXMLçš„å…ƒæ•°æ®é…ç½®"></a>ç»„åˆåŸºäºXMLçš„å…ƒæ•°æ®é…ç½®</h5><p>ä½¿ç”¨XMLé…ç½®ï¼Œå¯ä»¥è®©beanå®šä¹‰åˆ†å¸ƒåœ¨å¤šä¸ªXMLæ–‡ä»¶ä¸Šï¼Œè¿™ç§æ–¹æ³•ç›´è§‚ä¼˜é›…æ¸…æ™°æ˜æ˜¾ã€‚é€šå¸¸ï¼Œæ¯ä¸ªå•ç‹¬çš„XMLé…ç½®æ–‡ä»¶ä»£è¡¨æ¶æ„ä¸­çš„ä¸€ä¸ªé€»è¾‘å±‚æˆ–æ¨¡å—ã€‚</p><p>ä½ å¯ä»¥ä½¿ç”¨åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡æ„é€ å‡½æ•°ä»æ‰€æœ‰è¿™äº›XMLç‰‡æ®µåŠ è½½beanå®šä¹‰ï¼Œè¿™ä¸ªæ„é€ å‡½æ•°å¯ä»¥è¾“å…¥å¤šä¸ªèµ„æºä½ç½®ï¼Œ<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-instantiation">å¦‚ä¸Šä¸€èŠ‚æ‰€ç¤º</a>ã€‚ æˆ–è€…ï¼Œä½¿ç”¨<code>&lt;import/&gt;</code>å…ƒç´ ä¹Ÿå¯ä»¥ä»å¦ä¸€ä¸ªï¼ˆæˆ–å¤šä¸ªï¼‰æ–‡ä»¶åŠ è½½beanå®šä¹‰ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;beans&gt;    &lt;import <span class="hljs-attribute">resource</span>=<span class="hljs-string">&quot;services.xml&quot;</span>/&gt;    &lt;import <span class="hljs-attribute">resource</span>=<span class="hljs-string">&quot;resources/messageSource.xml&quot;</span>/&gt;    &lt;import <span class="hljs-attribute">resource</span>=<span class="hljs-string">&quot;/resources/themeSource.xml&quot;</span>/&gt;<br>    &lt;bean <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;bean1&quot;</span> <span class="hljs-attribute">class</span>=<span class="hljs-string">&quot;...&quot;</span>/&gt;    &lt;bean <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;bean2&quot;</span> <span class="hljs-attribute">class</span>=<span class="hljs-string">&quot;...&quot;</span>/&gt;&lt;/beans&gt;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨äº†3ä¸ªæ–‡ä»¶ï¼š<code>services.xml</code>, <code>messageSource.xml</code>, å’Œ <code>themeSource.xml</code>æ¥åŠ è½½å¤–éƒ¨Beançš„å®šä¹‰ã€‚ å¯¼å…¥æ–‡ä»¶é‡‡ç”¨çš„éƒ½æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œå› æ­¤<code>services.xml</code>å¿…é¡»å’Œå¯¼å…¥æ–‡ä»¶ä½äºåŒä¸€ç›®å½•æˆ–ç±»è·¯å¾„ä¸­ï¼Œè€Œ<code>messageSource.xml</code> å’Œ <code>themeSource.xml</code> å¿…é¡»åœ¨å¯¼å…¥æ–‡ä»¶çš„èµ„æºä½ç½®ä¸­ã€‚æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œå‰é¢çš„æ–œçº¿å°†ä¼šè¢«å¿½ç•¥ï¼Œä½†è€ƒè™‘åˆ°è¿™äº›è·¯å¾„æ˜¯ç›¸å¯¹çš„ï¼Œæœ€ä½³çš„ä½¿ç”¨æ˜¯ä¸ç”¨æ–œçº¿çš„ã€‚ è¿™ä¸ªXMLæ–‡ä»¶çš„å†…å®¹éƒ½ä¼šè¢«å¯¼å…¥ï¼ŒåŒ…æ‹¬é¡¶çº§çš„ <code>&lt;beans/&gt;</code>å…ƒç´ ï¼Œä½†å¿…é¡»éµå¾ªSpring Schemaå®šä¹‰XML beanå®šä¹‰çš„è§„åˆ™ ã€‚</p><p>è¿™ç§ç›¸å¯¹è·¯å¾„çš„é…ç½®æ˜¯å¯è¡Œçš„ï¼Œä½†ä¸æ¨èè¿™æ ·åšï¼Œå¼•ç”¨åœ¨ä½¿ç”¨ç›¸å¯¹äºâ€..&#x2F;â€œè·¯å¾„çš„çˆ¶ç›®å½•æ–‡ä»¶ä¸­ï¼Œè¿™æ ·åšä¼šå¯¹å½“å‰åº”ç”¨ç¨‹åºä¹‹å¤–çš„æ–‡ä»¶äº§ç”Ÿä¾èµ–å…³ç³»ã€‚ ç‰¹åˆ«æ˜¯å¯¹äº<code>classpath:</code>: URLs(ä¾‹å¦‚<code>classpath:../services.xml</code>)ï¼Œä¸å»ºè®®ä½¿ç”¨æ­¤å¼•ç”¨ï¼Œå› ä¸ºåœ¨è¯¥å¼•ç”¨ä¸­ï¼Œè¿è¡Œæ—¶è§£æè¿‡ç¨‹é€‰æ‹©â€œæœ€è¿‘çš„â€classpathæ ¹ç›®å½•ï¼Œç„¶åæŸ¥çœ‹å…¶çˆ¶ç›®å½•ã€‚ ç±»è·¯å¾„çš„å˜åŒ–æˆ–è€…é€‰æ‹©äº†ä¸æ­£ç¡®çš„ç›®å½•éƒ½ä¼šå¯¼è‡´æ­¤é…ç½®ä¸å¯ç”¨ã€‚</p><p>æ‚¨å¯ä»¥ä½¿ç”¨å®Œå…¨é™å®šçš„èµ„æºä½ç½®è€Œä¸æ˜¯ç›¸å¯¹è·¯å¾„:ä¾‹å¦‚ï¼Œ<code>file:C:/config/services.xml</code>æˆ–è€…<code>classpath:/config/services.xml</code>.ã€‚ ä½†æ˜¯ï¼Œè¯·æ³¨æ„ï¼Œæ‚¨æ­£åœ¨å°†åº”ç”¨ç¨‹åºçš„é…ç½®ä¸ç‰¹å®šçš„ç»å¯¹ä½ç½®è€¦åˆã€‚é€šå¸¸ä¼šé€‰å–é—´æ¥çš„æ–¹å¼åº”å¯¹è¿™ç§ç»å¯¹è·¯å¾„ï¼Œä¾‹å¦‚ä½¿ç”¨å ä½ç¬¦â€œ${â€¦}â€æ¥è§£å†³å¯¹JVMç³»ç»Ÿå±æ€§çš„å¼•ç”¨ã€‚</p><p>import æ˜¯ç”±beanå‘½åç©ºé—´æœ¬èº«æä¾›çš„åŠŸèƒ½ã€‚åœ¨Springæä¾›çš„XMLå‘½åç©ºé—´ä¸­ï¼Œå¦‚â€œ<code>context</code>â€å’Œâ€œ<code>util</code>â€å‘½åç©ºé—´ï¼Œå¯ä»¥ç”¨äºå¯¹æ™®é€šbeanå®šä¹‰è¿›è¡Œæ›´é«˜çº§çš„åŠŸèƒ½é…ç½®ã€‚</p><h5 id="DSLå®šä¹‰Groovy-Bean"><a href="#DSLå®šä¹‰Groovy-Bean" class="headerlink" title="DSLå®šä¹‰Groovy Bean"></a>DSLå®šä¹‰Groovy Bean</h5><p>ä½œä¸ºä»å¤–éƒ¨é…ç½®å…ƒæ•°æ®çš„å¦ä¸€ä¸ªç¤ºä¾‹ï¼Œbeanå®šä¹‰ä¹Ÿå¯ä»¥ä½¿ç”¨Springçš„Groovy DSLæ¥å®šä¹‰ã€‚Grailsæ¡†æ¶æœ‰æ­¤é…ç½®å®ä¾‹ï¼Œé€šå¸¸ï¼Œ å¯ä»¥åœ¨å…·æœ‰ä»¥ä¸‹ç»“æ„çš„â€.groovyâ€æ–‡ä»¶ä¸­é…ç½®beanå®šä¹‰ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs markdown">beans &#123;<br><br><span class="hljs-code">    dataSource(BasicDataSource) &#123;</span><br><span class="hljs-code"></span><br><span class="hljs-code">        driverClassName = &quot;org.hsqldb.jdbcDriver&quot;</span><br><span class="hljs-code"></span><br><span class="hljs-code">        url = &quot;jdbc:hsqldb:mem:grailsDB&quot;</span><br><span class="hljs-code"></span><br><span class="hljs-code">        username = &quot;sa&quot;</span><br><span class="hljs-code"></span><br><span class="hljs-code">        password = &quot;&quot;</span><br><span class="hljs-code"></span><br><span class="hljs-code">        settings = [mynew:&quot;setting&quot;]</span><br><span class="hljs-code"></span><br><span class="hljs-code">    &#125;</span><br><span class="hljs-code"></span><br><span class="hljs-code">    sessionFactory(SessionFactory) &#123;</span><br><span class="hljs-code"></span><br><span class="hljs-code">        dataSource = dataSource</span><br><span class="hljs-code"></span><br><span class="hljs-code">    &#125;</span><br><span class="hljs-code"></span><br><span class="hljs-code">    myService(MyService) &#123;</span><br><span class="hljs-code"></span><br><span class="hljs-code">        nestedBean = &#123; AnotherBean bean -&gt;</span><br><span class="hljs-code"></span><br><span class="hljs-code">            dataSource = dataSource</span><br><span class="hljs-code"></span><br><span class="hljs-code">        &#125;</span><br><span class="hljs-code"></span><br><span class="hljs-code">    &#125;</span><br><span class="hljs-code"></span><br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ç§é…ç½®é£æ ¼åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šç­‰ä»·äºXML beanå®šä¹‰ï¼Œç”šè‡³æ”¯æŒSpringçš„XMLé…ç½®åç§°ç©ºé—´ã€‚å®ƒè¿˜å…è®¸é€šè¿‡<code>importBeans</code>æŒ‡ä»¤å¯¼å…¥XML beanå®šä¹‰æ–‡ä»¶ã€‚</p><h4 id="1-2-3-ä½¿ç”¨å®¹å™¨"><a href="#1-2-3-ä½¿ç”¨å®¹å™¨" class="headerlink" title="1.2.3. ä½¿ç”¨å®¹å™¨"></a>1.2.3. ä½¿ç”¨å®¹å™¨</h4><p><code>ApplicationContext</code>æ˜¯èƒ½å¤Ÿåˆ›å»ºbeanå®šä¹‰ä»¥åŠå¤„ç†ç›¸äº’ä¾èµ–å…³ç³»çš„é«˜çº§å·¥å‚æ¥å£ï¼Œä½¿ç”¨æ–¹æ³•<code>T getBean(String name, Class&lt;T&gt; requiredType)</code>è·å–å®¹å™¨å®ä¾‹ã€‚</p><p><code>ApplicationContext</code>å¯ä»¥è¯»å–beanå®šä¹‰å¹¶è®¿é—®å®ƒä»¬ å¦‚ä¸‹ :</p><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vhdl">// create <span class="hljs-keyword">and</span> configure beansApplicationContext <span class="hljs-keyword">context</span> = <span class="hljs-keyword">new</span> ClassPathXmlApplicationContext(<span class="hljs-string">&quot;services.xml&quot;</span>, <span class="hljs-string">&quot;daos.xml&quot;</span>);<br>// retrieve configured instancePetStoreService service = <span class="hljs-keyword">context</span>.getBean(<span class="hljs-string">&quot;petStore&quot;</span>, PetStoreService.class);<br>// <span class="hljs-keyword">use</span> configured instanceList&lt;<span class="hljs-built_in">String</span>&gt; userList = service.getUsernameList();<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨Groovyé…ç½®å¼•å¯¼çœ‹èµ·æ¥éå¸¸ç›¸ä¼¼ï¼Œåªæ˜¯ç”¨åˆ°ä¸åŒçš„ä¸Šä¸‹æ–‡å®ç°ç±»ï¼šå®ƒæ˜¯Groovyæ„ŸçŸ¥çš„ï¼ˆä½†ä¹Ÿéœ€ç†è§£XML beanå®šä¹‰ï¼‰ å¦‚ä¸‹:</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">ApplicationContext context</span> = new GenericGroovyApplicationContext(<span class="hljs-string">&quot;services.groovy&quot;</span>, <span class="hljs-string">&quot;daos.groovy&quot;</span>);<br></code></pre></td></tr></table></figure><p>æœ€çµæ´»çš„å˜ä½“æ˜¯<code>GenericApplicationContext</code>ï¼Œä¾‹å¦‚è¯»å–XMLæ–‡ä»¶çš„<code>XmlBeanDefinitionReader</code>ã€‚å¦‚ä¸‹é¢çš„ç¤ºä¾‹æ‰€ç¤º:</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs maxima">GenericApplicationContext <span class="hljs-built_in">context</span> = <span class="hljs-built_in">new</span> GenericApplicationContext();<br><br><span class="hljs-built_in">new</span> XmlBeanDefinitionReader(<span class="hljs-built_in">context</span>).loadBeanDefinitions(<span class="hljs-string">&quot;services.xml&quot;</span>, <span class="hljs-string">&quot;daos.xml&quot;</span>);<br><br><span class="hljs-built_in">context</span>.refresh();<br></code></pre></td></tr></table></figure><p>æ‚¨è¿˜å¯ä»¥ä¸ºGroovyæ–‡ä»¶ä½¿ç”¨<code>GroovyBeanDefinitionReader</code>ï¼Œå¦‚ä¸‹é¢çš„ç¤ºä¾‹æ‰€ç¤º:</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs maxima">GenericApplicationContext <span class="hljs-built_in">context</span> = <span class="hljs-built_in">new</span> GenericApplicationContext();<br><br><span class="hljs-built_in">new</span> GroovyBeanDefinitionReader(<span class="hljs-built_in">context</span>).loadBeanDefinitions(<span class="hljs-string">&quot;services.groovy&quot;</span>, <span class="hljs-string">&quot;daos.groovy&quot;</span>);<br><br><span class="hljs-built_in">context</span>.refresh();<br></code></pre></td></tr></table></figure><p>è¿™ä¸€ç±»çš„è¯»å–å¯ä»¥åœ¨åŒä¸€ä¸ª <code>ApplicationContext</code>ä¸Šæ··åˆä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥è‡ªåŠ¨åŒ¹é…ï¼Œå¦‚æœéœ€è¦å¯ä»¥ä»ä¸åŒçš„é…ç½®æºè¯»å–beanå®šä¹‰ã€‚</p><p>æ‚¨å¯ä»¥ä½¿ç”¨ <code>getBean</code>æ¥è·å–beanå®ä¾‹ï¼Œ <code>ApplicationContext</code>æ¥å£ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–çš„æ–¹æ³•æ¥è·å–beanã€‚ä½†æ˜¯åœ¨ç†æƒ³æƒ…å†µä¸‹ï¼Œåº”ç”¨ç¨‹åºä»£ç æ°¸è¿œä¸åº”è¯¥ä½¿ç”¨å®ƒä»¬ã€‚ äº‹å®ä¸Šï¼Œä½ çš„åº”ç”¨ç¨‹åºä»£ç ä¹Ÿä¸åº”è¯¥è°ƒç”¨çš„<code>getBean()</code>æ–¹æ³•ï¼Œå› æ­¤å¯¹Spring APIæ²¡æœ‰ä¾èµ–ã€‚ä¾‹å¦‚ï¼ŒSpringä¸Webæ¡†æ¶çš„é›†æˆä¸ºå„ç§Webæ¡†æ¶ç»„ä»¶(å¦‚æ§åˆ¶å™¨å’ŒJSFç®¡ç†beanï¼‰ æä¾›äº†ä¾èµ–é¡¹æ³¨å…¥åŠŸèƒ½ï¼Œä»è€Œå…è®¸å¼€å‘è€…é€šè¿‡å…ƒæ•°æ®å£°æ˜å¯¹ç‰¹å®šbeançš„ä¾èµ–(ä¾‹å¦‚ï¼Œè‡ªåŠ¨æ³¨è§£ï¼‰ã€‚</p><h3 id="1-3-Bean-çš„æ¦‚è¿°"><a href="#1-3-Bean-çš„æ¦‚è¿°" class="headerlink" title="1.3. Bean çš„æ¦‚è¿°"></a>1.3. Bean çš„æ¦‚è¿°</h3><p>Spring IoCå®¹å™¨ç®¡ç†ä¸€ä¸ªæˆ–å¤šä¸ªbeanã€‚è¿™äº›beanæ˜¯ç”±æ‚¨æä¾›ç»™å®¹å™¨çš„å…ƒæ•°æ®é…ç½®åˆ›å»ºçš„(ä¾‹å¦‚ï¼ŒXML <code>&lt;bean/&gt;</code>å®šä¹‰çš„å½¢å¼)ã€‚</p><p>åœ¨å®¹å™¨å†…éƒ¨ï¼Œè¿™äº›beanå®šä¹‰è¡¨ç¤ºä¸º<code>BeanDefinition</code>å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«ï¼ˆå…¶ä»–ä¿¡æ¯ï¼‰ä»¥ä¸‹å…ƒæ•°æ®</p><ul><li>é™å®šåŒ…ç±»åç§°: é€šå¸¸ï¼Œå®šä¹‰çš„beançš„å®é™…å®ç°ç±»ã€‚</li><li>beanè¡Œä¸ºé…ç½®å…ƒç´ , å®šä¹‰Beançš„è¡Œä¸ºçº¦æŸ(ä¾‹å¦‚ä½œç”¨åŸŸï¼Œç”Ÿå‘½å‘¨æœŸå›è°ƒç­‰ç­‰ï¼‰</li><li>beanéœ€è¦å¼•ç”¨å…¶ä»–beanæ¥å®Œæˆå·¥ä½œ. è¿™äº›å¼•ç”¨ä¹Ÿç§°ä¸ºåä½œæˆ–ä¾èµ–å…³ç³».</li><li>å…¶ä»–é…ç½®ç”¨äºæ–°å¯¹è±¡çš„åˆ›å»ºï¼Œä¾‹å¦‚ä½¿ç”¨beançš„æ•°é‡æ¥ç®¡ç†è¿æ¥æ± ï¼Œæˆ–è€…é™åˆ¶æ± çš„å¤§å°ã€‚</li></ul><p>ä»¥ä¸‹æ˜¯æ¯ä¸ªbeanå®šä¹‰çš„å±æ€§:</p><p>Table 1. Beançš„å®šä¹‰</p><table><thead><tr><th>Property</th><th>å¯¹åº”çš„ç« èŠ‚å</th></tr></thead><tbody><tr><td>Class</td><td><a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-class">å®ä¾‹åŒ–Bean</a></td></tr><tr><td>Name</td><td><a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-beanname">å‘½åBean</a></td></tr><tr><td>Scope</td><td><a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-scopes">Bean çš„ä½œç”¨åŸŸ</a></td></tr><tr><td>Constructor arguments</td><td><a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-collaborators">ä¾èµ–æ³¨å…¥</a></td></tr><tr><td>Properties</td><td><a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-collaborators">ä¾èµ–æ³¨å…¥</a></td></tr><tr><td>Autowiring mode</td><td><a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-autowire">è‡ªåŠ¨è£…é…</a></td></tr><tr><td>Lazy initialization mode</td><td><a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-lazy-init">æ‡’åŠ è½½Bean</a></td></tr><tr><td>Initialization method</td><td><a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-lifecycle-initializingbean">åˆå§‹åŒ–æ–¹æ³•å›è°ƒ</a></td></tr><tr><td>Destruction method</td><td><a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-lifecycle-disposablebean">é”€æ¯æ–¹æ³•å›è°ƒ</a></td></tr></tbody></table><p>é™¤äº†beanå®šä¹‰åŒ…å«å¦‚ä½•åˆ›å»ºç‰¹å®šçš„beançš„ä¿¡æ¯å¤–ï¼Œ<code>ApplicationContext</code>å®ç°è¿˜å…è®¸ç”¨æˆ·åœ¨å®¹å™¨ä¸­æ³¨å†Œç°æœ‰çš„ã€å·²åˆ›å»ºçš„å¯¹è±¡ã€‚ é€šè¿‡<code>getBeanFactory()</code>è®¿é—®åˆ°è¿”å›å€¼ä¸º<code>DefaultListableBeanFactory</code>çš„å®ç°çš„ApplicationContextçš„BeanFactory <code>DefaultListableBeanFactory</code>æ”¯æŒé€šè¿‡<code>registerSingleton(..)</code>å’Œ<code>registerBeanDefinition(..)</code>æ–¹æ³•æ¥æ³¨å†Œå¯¹è±¡ã€‚ ç„¶è€Œï¼Œå…¸å‹çš„åº”ç”¨ç¨‹åºåªèƒ½é€šè¿‡å…ƒæ•°æ®é…ç½®æ¥å®šä¹‰beanã€‚</p><p>ä¸ºäº†è®©å®¹å™¨æ­£ç¡®æ¨æ–­å®ƒä»¬åœ¨è‡ªåŠ¨è£…é…å’Œå…¶å®ƒå†…ç½®æ­¥éª¤ï¼Œéœ€è¦å°½æ—©æ³¨å†ŒBeançš„å…ƒæ•°æ®å’Œæ‰‹åŠ¨ä½¿ç”¨å•ä¾‹çš„å®ä¾‹ã€‚è™½ç„¶è¦†ç›–ç°æœ‰çš„å…ƒæ•°æ®å’Œç°æœ‰çš„å•ä¾‹å®ä¾‹åœ¨æŸç§ç¨‹åº¦ä¸Šæ˜¯æ”¯æŒçš„ï¼Œ ä½†æ˜¯æ–°beanåœ¨è¿è¡Œæ—¶(åŒæ—¶è®¿é—®åŠ¨æ€å·¥å‚ï¼‰æ³¨å†Œå®˜æ–¹å¹¶ä¸æ”¯æŒï¼Œå¯èƒ½ä¼šå¯¼è‡´å¹¶å‘è®¿é—®å¼‚å¸¸ã€beanå®¹å™¨ä¸­çš„ä¸ä¸€è‡´çŠ¶æ€ï¼Œæˆ–è€…ä¸¤è€…å…¼æœ‰ã€‚</p><h4 id="1-3-1-å‘½åbean"><a href="#1-3-1-å‘½åbean" class="headerlink" title="1.3.1. å‘½åbean"></a>1.3.1. å‘½åbean</h4><p>æ¯ä¸ªbeanéƒ½æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæ ‡è¯†ç¬¦ï¼Œè¿™äº›æ ‡è¯†ç¬¦åœ¨å®¹å™¨æ‰˜ç®¡æ—¶å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚beané€šå¸¸åªæœ‰ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œä½†å¦‚æœéœ€è¦åˆ°çš„æ ‡è¯†ä¸æ­¢ä¸€ä¸ªæ—¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨åˆ«åã€‚</p><p>åœ¨åŸºäºXMLçš„é…ç½®ä¸­ï¼Œå¼€å‘è€…å¯ä»¥ä½¿ç”¨<code>id</code>å±æ€§ï¼Œnameå±æ€§æˆ–ä¸¤è€…éƒ½æŒ‡å®šbeançš„æ ‡è¯†ç¬¦ã€‚ <code>id</code>å±æ€§å…è®¸æ‚¨æŒ‡å®šä¸€ä¸ª<code>id</code>ï¼Œé€šå¸¸è¿™äº›åå­—ä½¿ç”¨å­—æ¯å’Œæ•°å­—çš„ç»„åˆ(ä¾‹å¦‚â€™myBeanâ€™, â€˜someServiceâ€™ï¼Œç­‰ç­‰ï¼‰ï¼Œä½†ä¹Ÿå¯ä»¥åŒ…å«ç‰¹æ®Šå­—ç¬¦ã€‚ å¦‚æœä½ æƒ³ä½¿ç”¨beanåˆ«åï¼Œæ‚¨å¯ä»¥åœ¨nameå±æ€§ä¸Šå®šä¹‰ï¼Œä½¿ç”¨é€—å·(<code>,</code>ï¼‰ï¼Œåˆ†å·(<code>;</code>)ï¼Œæˆ–ç™½è‰²ç©ºæ ¼è¿›è¡Œåˆ†éš”ã€‚ç”±äºå†å²å› ç´ ï¼Œ è¯·æ³¨æ„ï¼Œåœ¨Spring 3.1ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œidå±æ€§è¢«å®šä¹‰ä¸º<code>xsd:ID</code>ç±»å‹ï¼Œå®ƒä¼šé™åˆ¶æŸäº›å­—ç¬¦ã€‚ä»3.1å¼€å§‹ï¼Œå®ƒè¢«å®šä¹‰ä¸º<code>xsd:string</code>ç±»å‹ã€‚è¯·æ³¨æ„ï¼Œç”±äºbean <code>id</code>çš„å”¯ä¸€æ€§ï¼Œä»–ä»ç„¶ç”±å®¹å™¨æ‰§è¡Œï¼Œä¸å†ç”±XMLè§£æå™¨æ‰§è¡Œã€‚</p><p>æ‚¨ä¹Ÿæ— éœ€æä¾›beançš„<code>name</code>æˆ– <code>id</code>ï¼Œå¦‚æœæ²¡æœ‰æ˜¾å¼åœ°æä¾›<code>name</code>æˆ– <code>id</code>ï¼Œå®¹å™¨ä¼šç»™beanç”Ÿæˆå”¯ä¸€çš„åç§°ã€‚ ç„¶è€Œï¼Œå¦‚æœä½ æƒ³å¼•ç”¨beançš„åå­—ï¼Œå¯ä»¥ä½¿ç”¨refå…ƒç´ æˆ–ä½¿ç”¨<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-servicelocator">Service Locator</a>ï¼ˆæœåŠ¡å®šä½å™¨ï¼‰æ¥è¿›è¡ŒæŸ¥æ‰¾ï¼ˆæ­¤æ—¶å¿…é¡»æä¾›åç§°ï¼‰ã€‚ ä¸ä½¿ç”¨åç§°çš„æƒ…å†µæœ‰ï¼š <a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-inner-beans">å†…éƒ¨bean</a>å’Œ<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-autowire">è‡ªåŠ¨è£…é…çš„åä½œè€…</a></p><p>Bean çš„å‘½åçº¦å®š</p><p>beançš„å‘½åæ˜¯æŒ‰ç…§æ ‡å‡†çš„Javaå­—æ®µåç§°å‘½åæ¥è¿›è¡Œçš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œbeanåç§°å¼€å§‹éœ€è¦ä»¥å°å†™å­—æ¯å¼€å¤´ï¼Œåé¢é‡‡ç”¨â€œé©¼å³°å¼â€çš„æ–¹æ³•ã€‚ ä¾‹å¦‚<code>accountManager</code>,<code>accountService</code>, <code>userDao</code>, <code>loginController</code>ç­‰ã€‚</p><p>ä¸€è‡´çš„beanså‘½åèƒ½å¤Ÿè®©é…ç½®æ›´æ–¹ä¾¿é˜…è¯»å’Œç†è§£ï¼Œå¦‚æœä½ æ­£åœ¨ä½¿ç”¨Spring AOPï¼Œå½“ä½ é€šè¿‡beanåç§°åº”ç”¨åˆ°é€šçŸ¥æ—¶ï¼Œè¿™ç§å‘½åæ–¹å¼ä¼šæœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚</p><p>åœ¨ç±»è·¯å¾„ä¸­è¿›è¡Œç»„ä»¶æ‰«ææ—¶ï¼Œ Spring ä¼šæ ¹æ®ä¸Šé¢çš„è§„åˆ™ä¸ºæœªå‘½åçš„ç»„ä»¶ç”Ÿæˆ bean åç§°ï¼Œè§„åˆ™æ˜¯ï¼šé‡‡ç”¨ç®€å•çš„ç±»åï¼Œå¹¶å°†å…¶åˆå§‹å­—ç¬¦è½¬åŒ–ä¸ºå°å†™å­—æ¯ã€‚ ç„¶è€Œï¼Œåœ¨ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œå½“æœ‰ä¸€ä¸ªä»¥ä¸Šçš„å­—ç¬¦ï¼ŒåŒæ—¶ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªå­—ç¬¦éƒ½æ˜¯å¤§å†™æ—¶ï¼ŒåŸæ¥çš„è§„åˆ™ä»ç„¶åº”è¯¥ä¿ç•™ã€‚è¿™äº›è§„åˆ™ä¸Javaä¸­å®šä¹‰å®ä¾‹çš„ç›¸åŒã€‚ ä¾‹å¦‚Springä½¿ç”¨çš„<code>java.beans.Introspector.decapitalize</code> ç±»ã€‚</p><h5 id="ä¸ºå¤–éƒ¨å®šä¹‰çš„beanèµ·åˆ«å"><a href="#ä¸ºå¤–éƒ¨å®šä¹‰çš„beanèµ·åˆ«å" class="headerlink" title="ä¸ºå¤–éƒ¨å®šä¹‰çš„beanèµ·åˆ«å"></a>ä¸ºå¤–éƒ¨å®šä¹‰çš„beanèµ·åˆ«å</h5><p>åœ¨å¯¹beanå®šä¹‰æ—¶ï¼Œé™¤äº†ä½¿ç”¨<code>id</code>å±æ€§æŒ‡å®šå”¯ä¸€çš„åç§°å¤–ï¼Œè¿˜å¯ä»¥æä¾›å¤šä¸ªåˆ«åï¼Œè¿™éœ€è¦é€šè¿‡<code>name</code>å±æ€§æŒ‡å®šã€‚ æ‰€æœ‰è¿™ä¸ªåç§°éƒ½ä¼šæŒ‡å‘åŒä¸€ä¸ªbeanï¼Œåœ¨æŸäº›æƒ…å†µä¸‹æä¾›åˆ«åéå¸¸æœ‰ç”¨ï¼Œä¾‹å¦‚ä¸ºäº†è®©åº”ç”¨æ¯ä¸€ä¸ªç»„ä»¶éƒ½èƒ½æ›´å®¹æ˜“çš„å¯¹å…¬å…±ç»„ä»¶è¿›è¡Œå¼•ç”¨ã€‚</p><p>ç„¶è€Œï¼Œåœ¨å®šä¹‰beanæ—¶å°±æŒ‡å®šæ‰€æœ‰çš„åˆ«åå¹¶ä¸æ˜¯å¾ˆæ°å½“çš„ã€‚æœ‰æ—¶æœŸæœ›èƒ½å¤Ÿåœ¨å½“å‰ä½ç½®ä¸ºé‚£äº›åœ¨åˆ«å¤„å®šä¹‰çš„beanå¼•å…¥åˆ«åã€‚åœ¨XMLé…ç½®æ–‡ä»¶ä¸­ï¼Œ å¯ä»¥é€šè¿‡<code>&lt;alias/&gt;</code>å…ƒç´ æ¥å®šä¹‰beanåˆ«åï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">&lt;<span class="hljs-keyword">alias</span> <span class="hljs-type">name</span>=&quot;fromName&quot; <span class="hljs-keyword">alias</span>=&quot;toName&quot;/&gt;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢ç¤ºä¾‹ä¸­ï¼Œåœ¨åŒä¸€ä¸ªå®¹å™¨ä¸­åä¸º<code>fromName</code> çš„beanå®šä¹‰ï¼Œåœ¨å¢åŠ åˆ«åå®šä¹‰åï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code>toName</code>æ¥å¼•ç”¨ã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨å­ç³»ç»ŸAä¸­é€šè¿‡åå­—<code>subsystemA-dataSource</code>é…ç½®çš„æ•°æ®æºã€‚åœ¨å­ç³»ç»ŸBä¸­å¯èƒ½é€šè¿‡åå­— <code>subsystemB-dataSource</code>æ¥å¼•ç”¨ã€‚ å½“ä¸¤ä¸ªå­ç³»ç»Ÿæ„æˆä¸»åº”ç”¨çš„æ—¶å€™ï¼Œä¸»åº”ç”¨å¯èƒ½é€šè¿‡åå­—<code>myApp-dataSource</code>å¼•ç”¨æ•°æ®æºï¼Œå°†å…¨éƒ¨ä¸‰ä¸ªåå­—å¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡ï¼Œä½ å¯ä»¥å°†ä¸‹é¢çš„åˆ«åå®šä¹‰æ·»åŠ åˆ°åº”ç”¨é…ç½®ä¸­ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">&lt;<span class="hljs-keyword">alias</span> <span class="hljs-type">name</span>=&quot;subsystemA-dataSource&quot; <span class="hljs-keyword">alias</span>=&quot;subsystemB-dataSource&quot;/&gt;<br><br>&lt;<span class="hljs-keyword">alias</span> <span class="hljs-type">name</span>=&quot;subsystemA-dataSource&quot; <span class="hljs-keyword">alias</span>=&quot;myApp-dataSource&quot; /&gt;<br></code></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œæ¯ä¸ªç»„ä»¶å’Œä¸»åº”ç”¨ç¨‹åºéƒ½å¯ä»¥é€šè¿‡ä¸€ä¸ªå”¯ä¸€çš„åç§°å¼•ç”¨dataSourceï¼Œå¹¶ä¿è¯ä¸ä¸ä»»ä½•å…¶ä»–å®šä¹‰å†²çªï¼ˆæœ‰æ•ˆåœ°åˆ›å»ºå‘½åç©ºé—´ï¼‰ï¼Œä½†å®ƒä»¬å¼•ç”¨ç›¸åŒçš„beanã€‚ .</p><p>Javaé…ç½®</p><p>å¦‚æœä½ æ˜¯ç”¨javaé…ç½®ï¼Œ <code>@Bean</code>å¯ä»¥ç”¨æ¥æä¾›åˆ«åï¼Œè¯¦æƒ…è§<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-java-bean-annotation">ä½¿ç”¨<code>@Bean</code> æ³¨è§£ã€‚</a></p><h4 id="1-3-2-å®ä¾‹åŒ–Bean"><a href="#1-3-2-å®ä¾‹åŒ–Bean" class="headerlink" title="1.3.2. å®ä¾‹åŒ–Bean"></a>1.3.2. å®ä¾‹åŒ–Bean</h4><p>beanå®šä¹‰åŸºæœ¬ä¸Šå°±æ˜¯ç”¨æ¥åˆ›å»ºä¸€ä¸ªæˆ–å¤šä¸ªå¯¹è±¡çš„é…ç½®ï¼Œå½“éœ€è¦beançš„æ—¶å€™ï¼Œå®¹å™¨ä¼šæŸ¥æ‰¾é…ç½®å¹¶ä¸”æ ¹æ®beanå®šä¹‰å°è£…çš„å…ƒæ•°æ®æ¥åˆ›å»ºï¼ˆæˆ–è·å–ï¼‰å®é™…å¯¹è±¡ã€‚</p><p>å¦‚æœä½ ä½¿ç”¨åŸºäºXMLçš„é…ç½®ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨<code>&lt;bean/&gt;</code> å…ƒç´ ä¸­é€šè¿‡ <code>class</code>å±æ€§æ¥æŒ‡å®šå¯¹è±¡ç±»å‹ã€‚ classå±æ€§å®é™…ä¸Šå°±æ˜¯<code>BeanDefinition</code>å®ä¾‹ä¸­çš„<code>class</code>å±æ€§ã€‚ä»–é€šå¸¸æ˜¯å¿…éœ€çš„ï¼ˆä¸€äº›ä¾‹å¤–æƒ…å†µï¼ŒæŸ¥çœ‹ <a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-class-instance-factory-method">ä½¿ç”¨å®ä¾‹å·¥å‚æ–¹æ³•å®ä¾‹åŒ–</a> å’Œ <a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-child-bean-definitions">Bean å®šä¹‰çš„ç»§æ‰¿</a>)ã€‚æœ‰ä¸¤ç§æ–¹å¼ä½¿ç”¨Classå±æ€§</p><ul><li>é€šå¸¸æƒ…å†µä¸‹ï¼Œä¼šç›´æ¥é€šè¿‡åå°„è°ƒç”¨æ„é€ æ–¹æ³•æ¥åˆ›å»ºbeanï¼Œè¿™ç§æ–¹å¼ä¸Javaä»£ç çš„<code>new</code>åˆ›å»ºç›¸ä¼¼ã€‚</li><li>é€šè¿‡é™æ€å·¥å‚æ–¹æ³•åˆ›å»ºï¼Œç±»ä¸­åŒ…å«é™æ€æ–¹æ³•ã€‚é€šè¿‡è°ƒç”¨é™æ€æ–¹æ³•è¿”å›å¯¹è±¡çš„ç±»å‹å¯èƒ½å’ŒClassä¸€æ ·ï¼Œä¹Ÿå¯èƒ½å®Œå…¨ä¸ä¸€æ ·ã€‚</li></ul><p>å†…éƒ¨ç±»å</p><p>å¦‚æœä½ æƒ³é…ç½®é™æ€å†…éƒ¨ç±»ï¼Œé‚£ä¹ˆå¿…é¡»ä½¿ç”¨å†…éƒ¨ç±»çš„äºŒè¿›åˆ¶åç§°ã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨<code>com.example</code>æœ‰ä¸ª<code>SomeThing</code>ç±»ï¼Œè¿™ä¸ªç±»é‡Œé¢æœ‰ä¸ªé™æ€å†…éƒ¨ç±»<code>OtherThing</code>ï¼Œè¿™ç§æƒ…å†µä¸‹beanå®šä¹‰çš„classå±æ€§åº”è¯¥å†™ä½œ <code>com.example.SomeThing$OtherThing</code>.</p><p>ä½¿ç”¨$å­—ç¬¦æ¥åˆ†éš”å¤–éƒ¨ç±»å’Œå†…éƒ¨ç±»çš„åç§°</p><h5 id="ä½¿ç”¨æ„é€ å™¨å®ä¾‹åŒ–"><a href="#ä½¿ç”¨æ„é€ å™¨å®ä¾‹åŒ–" class="headerlink" title="ä½¿ç”¨æ„é€ å™¨å®ä¾‹åŒ–"></a>ä½¿ç”¨æ„é€ å™¨å®ä¾‹åŒ–</h5><p>å½“æ‚¨é€šè¿‡æ„é€ æ–¹æ³•åˆ›å»ºbeanæ—¶ï¼Œæ‰€æœ‰æ™®é€šç±»éƒ½å¯ä»¥ä½¿ç”¨å¹¶ä¸Springå…¼å®¹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ­£åœ¨å¼€å‘çš„ç±»ä¸éœ€è¦å®ç°ä»»ä½•ç‰¹å®šæ¥å£æˆ–ä»¥ç‰¹å®šæ–¹å¼ç¼–ç ã€‚ åªè¦æŒ‡å®šbeanç±»å°±è¶³å¤Ÿäº†ã€‚ä½†æ˜¯ï¼Œæ ¹æ®æ‚¨ä¸ºè¯¥ç‰¹å®šbeanä½¿ç”¨çš„IoCç±»å‹ï¼Œæ‚¨å¯èƒ½éœ€è¦ä¸€ä¸ªé»˜è®¤ï¼ˆç©ºï¼‰æ„é€ å‡½æ•°ã€‚</p><p>Spring IoCå®¹å™¨å‡ ä¹å¯ä»¥ç®¡ç†æ‚¨å¸Œæœ›å®ƒç®¡ç†çš„ä»»ä½•ç±»ã€‚å®ƒä¸ä»…é™äºç®¡ç†çœŸæ­£çš„JavaBeansã€‚å¤§å¤šæ•°Springç”¨æˆ·æ›´å–œæ¬¢ç®¡ç†é‚£äº›åªæœ‰ä¸€ä¸ªé»˜è®¤æ„é€ å‡½æ•°ï¼ˆæ— å‚æ•°ï¼‰ å’Œæœ‰åˆé€‚çš„setterå’Œgetteræ–¹æ³•çš„çœŸå®çš„JavaBeansï¼Œè¿˜å¯ä»¥åœ¨å®¹å™¨ä¸­æ”¾ç½®æ›´å¤šçš„å¤–éƒ¨ébeanå½¢å¼ï¼ˆnon-bean-style)ç±»ï¼Œä¾‹å¦‚ï¼šå¦‚æœéœ€è¦ä½¿ç”¨ä¸€ä¸ªç»å¯¹è¿åJavaBeanè§„èŒƒçš„é—ç•™è¿æ¥æ± æ—¶ Springä¹Ÿæ˜¯å¯ä»¥ç®¡ç†å®ƒçš„ã€‚</p><p>ä½¿ç”¨åŸºäºXMLçš„é…ç½®å…ƒæ•°æ®ï¼Œæ‚¨å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼æŒ‡å®šbeanç±»ï¼š:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;bean <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;exampleBean&quot;</span> <span class="hljs-attribute">class</span>=<span class="hljs-string">&quot;examples.ExampleBean&quot;</span>/&gt;<br>&lt;bean <span class="hljs-attribute">name</span>=<span class="hljs-string">&quot;anotherExample&quot;</span> <span class="hljs-attribute">class</span>=<span class="hljs-string">&quot;examples.ExampleBeanTwo&quot;</span>/&gt;<br></code></pre></td></tr></table></figure><p>ç»™æ„é€ æ–¹æ³•æŒ‡å®šå‚æ•°ä»¥åŠä¸ºbeanå®ä¾‹åŒ–è®¾ç½®å±æ€§å°†åœ¨åé¢çš„<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-collaborators">ä¾èµ–æ³¨å…¥</a>ä¸­è¯´æ˜ã€‚</p><h5 id="ä½¿ç”¨é™æ€å·¥å‚æ–¹æ³•å®ä¾‹åŒ–"><a href="#ä½¿ç”¨é™æ€å·¥å‚æ–¹æ³•å®ä¾‹åŒ–" class="headerlink" title="ä½¿ç”¨é™æ€å·¥å‚æ–¹æ³•å®ä¾‹åŒ–"></a>ä½¿ç”¨é™æ€å·¥å‚æ–¹æ³•å®ä¾‹åŒ–</h5><p>å½“é‡‡ç”¨é™æ€å·¥å‚æ–¹æ³•åˆ›å»ºbeanæ—¶ï¼Œé™¤äº†éœ€è¦æŒ‡å®šclasså±æ€§å¤–ï¼Œè¿˜éœ€è¦é€šè¿‡<code>factory-method</code> å±æ€§æ¥æŒ‡å®šåˆ›å»ºbeanå®ä¾‹çš„å·¥å‚æ–¹æ³•ã€‚ Springå°†ä¼šè°ƒç”¨æ­¤æ–¹æ³•ï¼ˆå…¶å¯é€‰å‚æ•°æ¥ä¸‹æ¥ä¼šä»‹ç»ï¼‰è¿”å›å®ä¾‹å¯¹è±¡ã€‚ä»è¿™æ ·çœ‹æ¥ï¼Œå®ƒä¸é€šè¿‡æ™®é€šæ„é€ å™¨åˆ›å»ºç±»å®ä¾‹æ²¡ä»€ä¹ˆä¸¤æ ·ã€‚</p><p>ä¸‹é¢çš„beanå®šä¹‰å±•ç¤ºäº†å¦‚ä½•é€šè¿‡å·¥å‚æ–¹æ³•æ¥åˆ›å»ºbeanå®ä¾‹ã€‚æ³¨æ„ï¼Œæ­¤å®šä¹‰å¹¶æœªæŒ‡å®šå¯¹è±¡çš„è¿”å›ç±»å‹ï¼Œåªæ˜¯æŒ‡å®šäº†è¯¥ç±»åŒ…å«çš„å·¥å‚æ–¹æ³•ï¼Œåœ¨è¿™ä¸ªä¾‹ä¸­ï¼Œ <code>createInstance()</code>å¿…é¡»æ˜¯ä¸€ä¸ªé™æ€ï¼ˆstaticï¼‰çš„æ–¹æ³•ã€‚</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;bean <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;clientService&quot;</span><br><br>    <span class="hljs-attribute">class</span>=<span class="hljs-string">&quot;examples.ClientService&quot;</span><br><br>    <span class="hljs-attribute">factory-method</span>=<span class="hljs-string">&quot;createInstance&quot;</span>/&gt;<br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†ä¸€ä¸ªå¯ä»¥ä½¿ç”¨å‰é¢çš„beanå®šä¹‰çš„ç±»:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ClientService</span> &#123;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ClientService clientService = <span class="hljs-keyword">new</span> ClientService();    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">ClientService</span>()</span> &#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ClientService <span class="hljs-title">createInstance</span>()</span> &#123;        <span class="hljs-keyword">return</span> clientService;    &#125;&#125;<br></code></pre></td></tr></table></figure><p>ç»™å·¥å‚æ–¹æ³•æŒ‡å®šå‚æ•°ä»¥åŠä¸ºbeanå®ä¾‹è®¾ç½®å±æ€§çš„è¯¦ç»†å†…å®¹è¯·æŸ¥é˜…<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-properties-detailed">ä¾èµ–å’Œé…ç½®è¯¦è§£</a> ã€‚</p><h5 id="ä½¿ç”¨å®ä¾‹å·¥å‚æ–¹æ³•å®ä¾‹åŒ–"><a href="#ä½¿ç”¨å®ä¾‹å·¥å‚æ–¹æ³•å®ä¾‹åŒ–" class="headerlink" title="ä½¿ç”¨å®ä¾‹å·¥å‚æ–¹æ³•å®ä¾‹åŒ–"></a>ä½¿ç”¨å®ä¾‹å·¥å‚æ–¹æ³•å®ä¾‹åŒ–</h5><p>é€šè¿‡è°ƒç”¨å·¥å‚å®ä¾‹çš„éé™æ€æ–¹æ³•è¿›è¡Œå®ä¾‹åŒ–ä¸é€šè¿‡<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-class-static-factory-method">é™æ€å·¥å‚æ–¹æ³•</a>å®ä¾‹åŒ–ç±»ä¼¼ï¼Œ è¦ä½¿ç”¨æ­¤æœºåˆ¶ï¼Œè¯·å°†classå±æ€§ä¿ç•™ä¸ºç©ºï¼Œå¹¶åœ¨<code>factory-bean</code>å±æ€§ä¸­æŒ‡å®šå½“å‰ï¼ˆæˆ–çˆ¶çº§æˆ–ç¥–å…ˆï¼‰å®¹å™¨ä¸­beançš„åç§°ï¼Œè¯¥å®¹å™¨åŒ…å«è¦è°ƒç”¨ä»¥åˆ›å»ºå¯¹è±¡çš„å®ä¾‹æ–¹æ³•ã€‚ ä½¿ç”¨<code>factory-method</code>å±æ€§è®¾ç½®å·¥å‚æ–¹æ³•æœ¬èº«çš„åç§°ã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•é…ç½®æ­¤ç±»beanï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- the factory bean, which contains a method called createInstance() --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;serviceLocator&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;examples.DefaultServiceLocator&quot;</span>&gt;</span>    <span class="hljs-comment">&lt;!-- inject any dependencies required by this locator bean --&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-comment">&lt;!-- the bean to be created via the factory bean --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;clientService&quot;</span>    <span class="hljs-attr">factory-bean</span>=<span class="hljs-string">&quot;serviceLocator&quot;</span>    <span class="hljs-attr">factory-method</span>=<span class="hljs-string">&quot;createClientServiceInstance&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†ç›¸åº”çš„Javaç±»:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DefaultServiceLocator</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ClientService clientService = <span class="hljs-keyword">new</span> ClientServiceImpl();<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> ClientService <span class="hljs-title">createClientServiceInstance</span>()</span> &#123;        <span class="hljs-keyword">return</span> clientService;    &#125;&#125;<br></code></pre></td></tr></table></figure><p>ä¸€ä¸ªå·¥å‚ç±»ä¹Ÿå¯ä»¥åŒ…å«å¤šä¸ªå·¥å‚æ–¹æ³•ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;serviceLocator&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;examples.DefaultServiceLocator&quot;</span>&gt;</span>    <span class="hljs-comment">&lt;!-- inject any dependencies required by this locator bean --&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;clientService&quot;</span>    <span class="hljs-attr">factory-bean</span>=<span class="hljs-string">&quot;serviceLocator&quot;</span>    <span class="hljs-attr">factory-method</span>=<span class="hljs-string">&quot;createClientServiceInstance&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;accountService&quot;</span>    <span class="hljs-attr">factory-bean</span>=<span class="hljs-string">&quot;serviceLocator&quot;</span>    <span class="hljs-attr">factory-method</span>=<span class="hljs-string">&quot;createAccountServiceInstance&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†ç›¸åº”çš„Javaç±»:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DefaultServiceLocator</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ClientService clientService = <span class="hljs-keyword">new</span> ClientServiceImpl();<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> AccountService accountService = <span class="hljs-keyword">new</span> AccountServiceImpl();<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> ClientService <span class="hljs-title">createClientServiceInstance</span>()</span> &#123;        <span class="hljs-keyword">return</span> clientService;    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> AccountService <span class="hljs-title">createAccountServiceInstance</span>()</span> &#123;        <span class="hljs-keyword">return</span> accountService;    &#125;&#125;<br></code></pre></td></tr></table></figure><p>è¿™ç§æ–¹æ³•è¡¨æ˜å¯ä»¥é€šè¿‡ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰æ¥ç®¡ç†å’Œé…ç½®å·¥å‚beanæœ¬èº«ã€‚è¯·å‚é˜…è¯¦ç»†ä¿¡æ¯ä¸­çš„<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-properties-detailed">ä¾èµ–å’Œé…ç½®è¯¦è§£</a>ã€‚</p><p>åœ¨Springæ–‡æ¡£ä¸­ï¼Œâ€œfactory beanâ€æ˜¯æŒ‡åœ¨Springå®¹å™¨ä¸­é…ç½®å¹¶é€šè¿‡<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-class-instance-factory-method">å®ä¾‹</a> æˆ– <a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-class-static-factory-method">é™æ€å·¥å‚æ–¹æ³•</a> åˆ›å»ºå¯¹è±¡çš„beanã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒFactoryBeanï¼ˆæ³¨æ„å¤§å°å†™ï¼‰æ˜¯æŒ‡Springç‰¹å®šçš„<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-extension-factorybean"><code>FactoryBean</code></a>ã€‚</p><h3 id="1-4-ä¾èµ–"><a href="#1-4-ä¾èµ–" class="headerlink" title="1.4. ä¾èµ–"></a>1.4. ä¾èµ–</h3><p>ä¸€èˆ¬æƒ…å†µä¸‹ä¼ä¸šåº”ç”¨ä¸ä¼šåªæœ‰ä¸€ä¸ªå¯¹è±¡ï¼ˆSpring Beanï¼‰ï¼Œç”šè‡³æœ€ç®€å•çš„åº”ç”¨éƒ½éœ€è¦å¤šä¸ªå¯¹è±¡ååŒå·¥ä½œã€‚ä¸‹ä¸€èŠ‚å°†è§£é‡Šå¦‚ä½•ä»å®šä¹‰å•ä¸ªBeanåˆ°è®©å¤šä¸ªBeanååŒå·¥ä½œã€‚</p><h4 id="1-4-1-ä¾èµ–æ³¨å…¥"><a href="#1-4-1-ä¾èµ–æ³¨å…¥" class="headerlink" title="1.4.1. ä¾èµ–æ³¨å…¥"></a>1.4.1. ä¾èµ–æ³¨å…¥</h4><p>ä¾èµ–æ³¨å…¥æ˜¯è®©å¯¹è±¡åªé€šè¿‡æ„é€ å‚æ•°ã€å·¥å‚æ–¹æ³•çš„å‚æ•°æˆ–è€…é…ç½®çš„å±æ€§æ¥å®šä¹‰ä»–ä»¬çš„ä¾èµ–çš„è¿‡ç¨‹ã€‚è¿™äº›ä¾èµ–ä¹Ÿæ˜¯å…¶ä»–å¯¹è±¡æ‰€éœ€è¦ååŒå·¥ä½œçš„å¯¹è±¡ï¼Œ å®¹å™¨ä¼šåœ¨åˆ›å»ºBeançš„æ—¶å€™æ³¨å…¥è¿™äº›ä¾èµ–ã€‚æ•´ä¸ªè¿‡ç¨‹å®Œå…¨åè½¬äº†ç”±Beanè‡ªå·±æ§åˆ¶å®ä¾‹åŒ–æˆ–è€…ä¾èµ–å¼•ç”¨ï¼Œæ‰€ä»¥è¿™ä¸ªè¿‡ç¨‹ä¹Ÿç§°ä¹‹ä¸ºâ€œæ§åˆ¶åè½¬â€</p><p>å½“ä½¿ç”¨äº†ä¾èµ–æ³¨å…¥çš„ç‰¹æ€§ä»¥åï¼Œä¼šè®©å¼€å‘è€…æ›´å®¹æ˜“ç®¡ç†å’Œè§£è€¦å¯¹è±¡ä¹‹é—´çš„ä¾èµ–ï¼Œä½¿ä»£ç å˜å¾—æ›´åŠ ç®€å•ã€‚å¯¹è±¡ä¹‹é—´ä¸å†å…³æ³¨ä¾èµ–ï¼Œä¹Ÿä¸éœ€è¦çŸ¥é“ä¾èµ–ç±»çš„ä½ç½®ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œå¼€å‘çš„ç±»æ›´æ˜“äºæµ‹è¯• å°¤å…¶æ˜¯å½“å¼€å‘è€…çš„ä¾èµ–æ˜¯æ¥å£æˆ–è€…æŠ½è±¡ç±»çš„æƒ…å†µæ—¶ï¼Œå¼€å‘è€…å¯ä»¥è½»æ˜“åœ°åœ¨å•å…ƒæµ‹è¯•ä¸­mockå¯¹è±¡ã€‚</p><p>ä¾èµ–æ³¨å…¥ä¸»è¦ä½¿ç”¨ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-constructor-injection">åŸºäºæ„é€ å‡½æ•°çš„æ³¨å…¥</a>ï¼Œå¦ä¸€ç§çš„<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-setter-injection">åŸºäºSetteræ–¹æ³•çš„ä¾èµ–æ³¨å…¥</a>ã€‚</p><h5 id="åŸºäºæ„é€ å‡½æ•°çš„ä¾èµ–æ³¨å…¥"><a href="#åŸºäºæ„é€ å‡½æ•°çš„ä¾èµ–æ³¨å…¥" class="headerlink" title="åŸºäºæ„é€ å‡½æ•°çš„ä¾èµ–æ³¨å…¥"></a>åŸºäºæ„é€ å‡½æ•°çš„ä¾èµ–æ³¨å…¥</h5><p>åŸºäºæ„é€ å‡½æ•°çš„ä¾èµ–æ³¨å…¥æ˜¯ç”±IoCå®¹å™¨æ¥è°ƒç”¨ç±»çš„æ„é€ å‡½æ•°ï¼Œæ„é€ å‡½æ•°çš„å‚æ•°ä»£è¡¨è¿™ä¸ªBeanæ‰€ä¾èµ–çš„å¯¹è±¡ã€‚æ„é€ å‡½æ•°çš„ä¾èµ–æ³¨å…¥ä¸è°ƒç”¨å¸¦å‚æ•°çš„é™æ€å·¥å‚æ–¹æ³•åŸºæœ¬ä¸€æ ·ã€‚ è°ƒç”¨å…·æœ‰ç‰¹å®šå‚æ•°çš„é™æ€å·¥å‚æ–¹æ³•æ¥æ„é€ beanå‡ ä¹æ˜¯ç­‰æ•ˆçš„ï¼Œæœ¬è®¨è®ºåŒæ ·å¤„ç†æ„é€ å‡½æ•°å’Œé™æ€å·¥å‚æ–¹æ³•çš„å‚æ•°ã€‚ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†ä¸€ä¸ªé€šè¿‡æ„é€ å‡½æ•°æ¥å®ç°ä¾èµ–æ³¨å…¥çš„ç±»ã€‚:</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> SimpleMovieLister &#123;<br>    <span class="hljs-comment">// the SimpleMovieLister has a dependency on a MovieFinder    private MovieFinder movieFinder;</span><br>    <span class="hljs-comment">// a constructor so that the Spring container can inject a MovieFinder    public SimpleMovieLister(MovieFinder movieFinder) &#123;        this.movieFinder = movieFinder;    &#125;</span><br>    <span class="hljs-comment">// business logic that actually uses the injected MovieFinder is omitted...&#125;</span><br></code></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œè¿™ä¸ªç±»æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«ä¹‹å¤„ã€‚ å®ƒæ˜¯ä¸€ä¸ªPOJOï¼Œå®ƒä¸ä¾èµ–äºå®¹å™¨ç‰¹å®šçš„æ¥å£ï¼ŒåŸºç±»æˆ–æ³¨è§£ã€‚</p><h6 id="è§£ææ„é€ å™¨å‚æ•°"><a href="#è§£ææ„é€ å™¨å‚æ•°" class="headerlink" title="è§£ææ„é€ å™¨å‚æ•°"></a>è§£ææ„é€ å™¨å‚æ•°</h6><p>æ„é€ å‡½æ•°çš„å‚æ•°è§£ææ˜¯é€šè¿‡å‚æ•°çš„ç±»å‹æ¥åŒ¹é…çš„ã€‚å¦‚æœåœ¨Beançš„æ„é€ å‡½æ•°å‚æ•°ä¸å­˜åœ¨æ­§ä¹‰ï¼Œé‚£ä¹ˆæ„é€ å™¨å‚æ•°çš„é¡ºåºä¹Ÿå°±æ˜¯å°±æ˜¯è¿™äº›å‚æ•°å®ä¾‹åŒ–ä»¥åŠè£…è½½çš„é¡ºåºã€‚å‚è€ƒå¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-keyword">package</span> x.y;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThingOne</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ThingOne</span><span class="hljs-params">(ThingTwo thingTwo, ThingThree thingThree)</span> </span>&#123;        <span class="hljs-comment">// ...    &#125;&#125;</span><br></code></pre></td></tr></table></figure><p>å‡è®¾<code>ThingTwo</code>å’Œ<code>ThingThree</code>ç±»ä¸ç»§æ‰¿æ— å…³ï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆæ­§ä¹‰ã€‚ä¸‹é¢çš„é…ç½®å®Œå…¨å¯ä»¥å·¥ä½œæ­£å¸¸ã€‚å¼€å‘è€…æ— éœ€å†åˆ°<code>&lt;constructor-arg/&gt;</code>å…ƒç´ ä¸­æŒ‡å®šæ„é€ å‡½æ•°å‚æ•°çš„indexæˆ–type</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs abnf">&lt;beans&gt;    &lt;bean id<span class="hljs-operator">=</span><span class="hljs-string">&quot;thingOne&quot;</span> class<span class="hljs-operator">=</span><span class="hljs-string">&quot;x.y.ThingOne&quot;</span>&gt;        &lt;constructor-arg ref<span class="hljs-operator">=</span><span class="hljs-string">&quot;thingTwo&quot;</span>/&gt;        &lt;constructor-arg ref<span class="hljs-operator">=</span><span class="hljs-string">&quot;thingThree&quot;</span>/&gt;    &lt;/bean&gt;<br>    &lt;bean id<span class="hljs-operator">=</span><span class="hljs-string">&quot;thingTwo&quot;</span> class<span class="hljs-operator">=</span><span class="hljs-string">&quot;x.y.ThingTwo&quot;</span>/&gt;<br>    &lt;bean id<span class="hljs-operator">=</span><span class="hljs-string">&quot;thingThree&quot;</span> class<span class="hljs-operator">=</span><span class="hljs-string">&quot;x.y.ThingThree&quot;</span>/&gt;&lt;/beans&gt;<br></code></pre></td></tr></table></figure><p>å½“å¼•ç”¨å¦ä¸€ä¸ªbeanæ—¶ï¼Œå¦‚æœç±»å‹æ˜¯å·²çŸ¥çš„ï¼ŒåŒ¹é…å°±ä¼šå·¥ä½œæ­£å¸¸ï¼ˆä¸å‰é¢çš„ç¤ºä¾‹ä¸€æ ·ï¼‰ã€‚å½“ä½¿ç”¨ç®€å•ç±»å‹çš„æ—¶å€™ï¼ˆä¾‹å¦‚<code>&lt;value&gt;true&lt;/value&gt;</code>ï¼‰ï¼Œ Spring IoCå®¹å™¨æ— æ³•åˆ¤æ–­å€¼çš„ç±»å‹ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯æ— æ³•åŒ¹é…çš„ï¼Œè€ƒè™‘ä»£ç ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">package</span> examples;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExampleBean</span> &#123;<br>    <span class="hljs-comment">// Number of years to calculate the Ultimate Answer    private int years;</span><br>    <span class="hljs-comment">// The Answer to Life, the Universe, and Everything    private String ultimateAnswer;</span><br>    <span class="hljs-keyword">public</span> ExampleBean(int years, String ultimateAnswer) &#123;        <span class="hljs-keyword">this</span>.years = years;        <span class="hljs-keyword">this</span>.ultimateAnswer = ultimateAnswer;    &#125;&#125;<br></code></pre></td></tr></table></figure><p>æ„é€ å‡½æ•°å‚æ•°ç±»å‹åŒ¹é…</p><p>åœ¨å‰é¢çš„åœºæ™¯ä¸­ï¼Œå¦‚æœä½¿ç”¨ type å±æ€§æ˜¾å¼æŒ‡å®šæ„é€ å‡½æ•°å‚æ•°çš„ç±»å‹ï¼Œåˆ™å®¹å™¨å¯ä»¥ä½¿ç”¨ä¸ç®€å•ç±»å‹çš„ç±»å‹åŒ¹é…ã€‚å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs abnf">&lt;bean id<span class="hljs-operator">=</span><span class="hljs-string">&quot;exampleBean&quot;</span> class<span class="hljs-operator">=</span><span class="hljs-string">&quot;examples.ExampleBean&quot;</span>&gt;<br><br>    &lt;constructor-arg type<span class="hljs-operator">=</span><span class="hljs-string">&quot;int&quot;</span> value<span class="hljs-operator">=</span><span class="hljs-string">&quot;7500000&quot;</span>/&gt;<br><br>    &lt;constructor-arg type<span class="hljs-operator">=</span><span class="hljs-string">&quot;java.lang.String&quot;</span> value<span class="hljs-operator">=</span><span class="hljs-string">&quot;42&quot;</span>/&gt;<br><br>&lt;/bean&gt;<br></code></pre></td></tr></table></figure><p>æ„é€ å‡½æ•°å‚æ•°ç´¢å¼•</p><p>æ‚¨å¯ä»¥ä½¿ç”¨<code>index</code>å±æ€§æ˜¾å¼æŒ‡å®šæ„é€ å‡½æ•°å‚æ•°çš„ç´¢å¼•ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs abnf">&lt;bean id<span class="hljs-operator">=</span><span class="hljs-string">&quot;exampleBean&quot;</span> class<span class="hljs-operator">=</span><span class="hljs-string">&quot;examples.ExampleBean&quot;</span>&gt;<br><br>    &lt;constructor-arg index<span class="hljs-operator">=</span><span class="hljs-string">&quot;0&quot;</span> value<span class="hljs-operator">=</span><span class="hljs-string">&quot;7500000&quot;</span>/&gt;<br><br>    &lt;constructor-arg index<span class="hljs-operator">=</span><span class="hljs-string">&quot;1&quot;</span> value<span class="hljs-operator">=</span><span class="hljs-string">&quot;42&quot;</span>/&gt;<br><br>&lt;/bean&gt;<br></code></pre></td></tr></table></figure><p>é™¤äº†è§£å†³å¤šä¸ªç®€å•å€¼çš„æ­§ä¹‰ä¹‹å¤–ï¼ŒæŒ‡å®šç´¢å¼•è¿˜å¯ä»¥è§£å†³æ„é€ å‡½æ•°å…·æœ‰ç›¸åŒç±»å‹çš„ä¸¤ä¸ªå‚æ•°çš„æ­§ä¹‰ã€‚</p><p>index ä»0å¼€å§‹ã€‚</p><p>æ„é€ å‡½æ•°å‚æ•°åç§°</p><p>æ‚¨è¿˜å¯ä»¥ä½¿ç”¨æ„é€ å‡½æ•°å‚æ•°åç§°æ¶ˆé™¤æ­§ä¹‰ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š:</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs abnf">&lt;bean id<span class="hljs-operator">=</span><span class="hljs-string">&quot;exampleBean&quot;</span> class<span class="hljs-operator">=</span><span class="hljs-string">&quot;examples.ExampleBean&quot;</span>&gt;<br><br>    &lt;constructor-arg name<span class="hljs-operator">=</span><span class="hljs-string">&quot;years&quot;</span> value<span class="hljs-operator">=</span><span class="hljs-string">&quot;7500000&quot;</span>/&gt;<br><br>    &lt;constructor-arg name<span class="hljs-operator">=</span><span class="hljs-string">&quot;ultimateAnswer&quot;</span> value<span class="hljs-operator">=</span><span class="hljs-string">&quot;42&quot;</span>/&gt;<br><br>&lt;/bean&gt;<br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè§£æè¿™ä¸ªé…ç½®çš„ä»£ç å¿…é¡»å¯ç”¨äº†è°ƒè¯•æ ‡è®°æ¥ç¼–è¯‘ï¼Œè¿™æ ·Springæ‰å¯ä»¥ä»æ„é€ å‡½æ•°æŸ¥æ‰¾å‚æ•°åç§°ã€‚å¼€å‘è€…ä¹Ÿå¯ä»¥ä½¿ç”¨<a href="https://download.oracle.com/javase/6/docs/api/java/beans/ConstructorProperties.html">@ConstructorProperties</a>æ³¨è§£æ¥æ˜¾å¼å£°æ˜æ„é€ å‡½æ•°çš„åç§°ã€‚ ä¾‹å¦‚ä¸‹é¢ä»£ç :</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">package</span> examples;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExampleBean</span> &#123;<br>    <span class="hljs-comment">// Fields omitted</span><br>    <span class="hljs-meta">@ConstructorProperties(&#123;<span class="hljs-string">&quot;years&quot;</span>, <span class="hljs-string">&quot;ultimateAnswer&quot;</span>&#125;)</span>    <span class="hljs-keyword">public</span> ExampleBean(int years, String ultimateAnswer) &#123;        <span class="hljs-keyword">this</span>.years = years;        <span class="hljs-keyword">this</span>.ultimateAnswer = ultimateAnswer;    &#125;&#125;<br></code></pre></td></tr></table></figure><h5 id="åŸºäºsetteræ–¹æ³•çš„ä¾èµ–æ³¨å…¥"><a href="#åŸºäºsetteræ–¹æ³•çš„ä¾èµ–æ³¨å…¥" class="headerlink" title="åŸºäºsetteræ–¹æ³•çš„ä¾èµ–æ³¨å…¥"></a>åŸºäºsetteræ–¹æ³•çš„ä¾èµ–æ³¨å…¥</h5><p>åŸºäºsetterå‡½æ•°çš„ä¾èµ–æ³¨å…¥æ˜¯è®©å®¹å™¨è°ƒç”¨æ‹¥æœ‰Beançš„æ— å‚æ„é€ å‡½æ•°ï¼Œæˆ–è€…<code>æ— å‚é™æ€å·¥å‚æ–¹æ³•</code>ï¼Œç„¶åå†æ¥è°ƒç”¨setteræ–¹æ³•æ¥å®ç°ä¾èµ–æ³¨å…¥ã€‚</p><p>ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†ä½¿ç”¨setteræ–¹æ³•è¿›è¡Œçš„ä¾èµ–æ³¨å…¥çš„è¿‡ç¨‹ã€‚å…¶ä¸­ç±»å¯¹è±¡åªæ˜¯ç®€å•çš„POJOï¼Œå®ƒä¸ä¾èµ–äºå®¹å™¨ç‰¹å®šçš„æ¥å£ï¼ŒåŸºç±»æˆ–æ³¨è§£ã€‚</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-symbol">SimpleMovieLister</span> &#123;<br>    <span class="hljs-comment">// the SimpleMovieLister has a dependency on the MovieFinder    private MovieFinder movieFinder;</span><br>    <span class="hljs-comment">// a setter method so that the Spring container can inject a MovieFinder    public void setMovieFinder(MovieFinder movieFinder) &#123;        this.movieFinder = movieFinder;    &#125;</span><br>    <span class="hljs-comment">// business logic that actually uses the injected MovieFinder is omitted...&#125;</span><br></code></pre></td></tr></table></figure><p><code>ApplicationContext</code>æ‰€ç®¡ç†BeanåŒæ—¶æ”¯æŒåŸºäºæ„é€ å‡½æ•°å’ŒåŸºäºsetteræ–¹æ³•çš„ä¾èµ–æ³¨å…¥ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒä½¿ç”¨setteræ–¹æ³•åœ¨é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥ä¾èµ–ä¹‹åå†æ¬¡æ³¨å…¥ä¾èµ–ã€‚ å¼€å‘è€…åœ¨<code>BeanDefinition</code>ä¸­å¯ä»¥ä½¿ç”¨<code>PropertyEditor</code>å®ä¾‹æ¥è‡ªç”±é€‰æ‹©æ³¨å…¥æ–¹å¼ã€‚ç„¶è€Œï¼Œå¤§å¤šæ•°çš„å¼€å‘è€…å¹¶ä¸ç›´æ¥ä½¿ç”¨è¿™äº›ç±»ï¼Œè€Œæ˜¯æ›´å–œæ¬¢ä½¿ç”¨XMLé…ç½®æ¥è¿›è¡Œbeanå®šä¹‰ï¼Œ æˆ–è€…åŸºäºæ³¨è§£çš„ç»„ä»¶ï¼ˆä¾‹å¦‚ä½¿ç”¨ <code>@Component</code>,<code>@Controller</code>ç­‰ï¼‰ï¼Œæˆ–è€…åœ¨é…ç½®äº†<code>@Configuration</code>çš„ç±»ä¸Šé¢ä½¿ç”¨<code>@Bean</code>çš„æ–¹æ³•ã€‚ ç„¶åï¼Œè¿™äº›æºåœ¨å†…éƒ¨è½¬æ¢ä¸º <code>BeanDefinition</code>çš„å®ä¾‹ï¼Œå¹¶ç”¨äºåŠ è½½æ•´ä¸ªSpring IoCå®¹å™¨å®ä¾‹ã€‚</p><p>å¦‚ä½•é€‰æ‹©åŸºäºæ„é€ å™¨å’ŒåŸºäºsetteræ–¹æ³•?</p><p>å› ä¸ºå¼€å‘è€…å¯ä»¥æ··ç”¨ä¸¤ç§ä¾èµ–æ³¨å…¥æ–¹å¼ï¼Œä¸¤ç§æ–¹å¼ç”¨äºå¤„ç†ä¸åŒçš„æƒ…å†µï¼šå¿…è¦çš„ä¾èµ–é€šå¸¸é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥ï¼Œè€Œå¯é€‰çš„ä¾èµ–åˆ™é€šè¿‡setteræ–¹æ³•æ³¨å…¥ã€‚å…¶ä¸­ï¼Œåœ¨setteræ–¹æ³•ä¸Šæ·»åŠ <a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-required-annotation">@Required</a> æ³¨è§£å¯ç”¨äºæ„é€ å¿…è¦çš„ä¾èµ–ã€‚</p><p>Springå›¢é˜Ÿæ¨èä½¿ç”¨åŸºäºæ„é€ å‡½æ•°çš„æ³¨å…¥ï¼Œå› ä¸ºè¿™ç§æ–¹å¼ä¼šä¿ƒä½¿å¼€å‘è€…å°†ç»„ä»¶å¼€å‘æˆä¸å¯å˜å¯¹è±¡å¹¶ä¸”ç¡®ä¿æ³¨å…¥çš„ä¾èµ–ä¸ä¸º<code>null</code>ã€‚å¦å¤–ï¼ŒåŸºäºæ„é€ å‡½æ•°çš„æ³¨å…¥çš„ç»„ä»¶è¢«å®¢æˆ·ç«¯è°ƒç”¨çš„æ—¶å€™ä¹Ÿå·²ç»æ˜¯å®Œå…¨æ„é€ å¥½çš„ ã€‚å½“ç„¶ï¼Œä»å¦ä¸€æ–¹é¢æ¥è¯´ï¼Œè¿‡å¤šçš„æ„é€ å‡½æ•°å‚æ•°ä¹Ÿæ˜¯éå¸¸ç³Ÿç³•çš„ä»£ç æ–¹å¼ï¼Œè¿™ç§æ–¹å¼è¯´æ˜ç±»é™„å¸¦äº†å¤ªå¤šçš„åŠŸèƒ½ï¼Œæœ€å¥½é‡æ„å°†ä¸åŒèŒèƒ½åˆ†ç¦»ã€‚</p><p>åŸºäºsetterçš„æ³¨å…¥åªç”¨äºå¯é€‰çš„ä¾èµ–ï¼Œä½†æ˜¯ä¹Ÿæœ€å¥½é…ç½®ä¸€äº›åˆç†çš„é»˜è®¤å€¼ã€‚å¦åˆ™ï¼Œåªèƒ½å¯¹ä»£ç çš„ä¾èµ–è¿›è¡Œénullå€¼æ£€æŸ¥äº†ã€‚åŸºäºsetteræ–¹æ³•çš„æ³¨å…¥æœ‰ä¸€ä¸ªä¾¿åˆ©ä¹‹å¤„æ˜¯ï¼šå¯¹è±¡å¯ä»¥é‡æ–°é…ç½®å’Œé‡æ–°æ³¨å…¥ã€‚ å› æ­¤ï¼Œä½¿ç”¨setteræ³¨å…¥ç®¡ç† <a href="https://github.com/DocsHome/spring-docs/blob/master/pages/integration/integration.md#jmx">JMX MBeans</a> æ˜¯å¾ˆæ–¹ä¾¿çš„</p><p>ä¾èµ–æ³¨å…¥çš„ä¸¤ç§é£æ ¼é€‚åˆå¤§å¤šæ•°çš„æƒ…å†µï¼Œä½†æ˜¯åœ¨ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“çš„æ—¶å€™ï¼Œå¼€å‘è€…å¯èƒ½å¹¶æ²¡æœ‰æºç ï¼Œé‚£ä¹ˆå°±åªèƒ½ä½¿ç”¨åŸºäºæ„é€ å‡½æ•°çš„ä¾èµ–æ³¨å…¥äº†ã€‚</p><h5 id="å†³å®šä¾èµ–çš„è¿‡ç¨‹"><a href="#å†³å®šä¾èµ–çš„è¿‡ç¨‹" class="headerlink" title="å†³å®šä¾èµ–çš„è¿‡ç¨‹"></a>å†³å®šä¾èµ–çš„è¿‡ç¨‹</h5><p>å®¹å™¨è§£æBeançš„è¿‡ç¨‹å¦‚ä¸‹:</p><ul><li>åˆ›å»ºå¹¶æ ¹æ®æè¿°çš„å…ƒæ•°æ®æ¥å®ä¾‹åŒ–<code>ApplicationContext</code>ï¼Œå…ƒæ•°æ®é…ç½®å¯ä»¥æ˜¯XMLæ–‡ä»¶ã€Javaä»£ç æˆ–è€…æ³¨è§£ã€‚</li><li>æ¯ä¸€ä¸ªBeançš„ä¾èµ–éƒ½é€šè¿‡æ„é€ å‡½æ•°å‚æ•°æˆ–å±æ€§ï¼Œæˆ–è€…é™æ€å·¥å‚æ–¹æ³•çš„å‚æ•°ç­‰ç­‰æ¥è¡¨ç¤ºã€‚è¿™äº›ä¾èµ–ä¼šåœ¨Beanåˆ›å»ºçš„æ—¶å€™è£…è½½å’Œæ³¨å…¥</li><li>æ¯ä¸€ä¸ªå±æ€§æˆ–è€…æ„é€ å‡½æ•°çš„å‚æ•°éƒ½æ˜¯çœŸå®å®šä¹‰çš„å€¼æˆ–è€…å¼•ç”¨å®¹å™¨å…¶ä»–çš„Bean.</li><li>æ¯ä¸€ä¸ªå±æ€§æˆ–è€…æ„é€ å‚æ•°å¯ä»¥æ ¹æ®æŒ‡å®šçš„ç±»å‹è½¬æ¢ä¸ºæ‰€éœ€çš„ç±»å‹ã€‚Springä¹Ÿå¯ä»¥å°†Stringè½¬æˆé»˜è®¤çš„Javaå†…ç½®ç±»å‹ã€‚ä¾‹å¦‚<code>int</code>, <code>long</code>, <code>String</code>, <code>boolean</code>ç­‰ ã€‚</li></ul><p>Springå®¹å™¨ä¼šåœ¨å®¹å™¨åˆ›å»ºçš„æ—¶å€™é’ˆå¯¹æ¯ä¸€ä¸ªBeanè¿›è¡Œæ ¡éªŒã€‚ä½†æ˜¯Beançš„å±æ€§åœ¨Beanæ²¡æœ‰çœŸæ­£åˆ›å»ºä¹‹å‰æ˜¯ä¸ä¼šè¿›è¡Œé…ç½®çš„ï¼Œå•ä¾‹ç±»å‹çš„Beanæ˜¯å®¹å™¨åˆ›å»ºçš„æ—¶å€™é…ç½®æˆé¢„å®ä¾‹çŠ¶æ€çš„ã€‚ <a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-scopes">Beançš„ä½œç”¨åŸŸ</a>åé¢å†è¯´ï¼Œå…¶ä»–çš„Beanéƒ½åªæœ‰åœ¨è¯·æ±‚çš„æ—¶å€™ï¼Œæ‰ä¼šåˆ›å»ºï¼Œæ˜¾ç„¶åˆ›å»ºBeanå¯¹è±¡ä¼šæœ‰ä¸€ä¸ªä¾èµ–é¡ºåºå›¾ï¼Œè¿™ä¸ªå›¾è¡¨ç¤ºBeanä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚ å®¹å™¨æ ¹æ®æ­¤æ¥å†³å®šåˆ›å»ºå’Œé…ç½®Beançš„é¡ºåºã€‚</p><p>å¾ªç¯ä¾èµ–</p><p>å¦‚æœå¼€å‘è€…ä¸»è¦ä½¿ç”¨åŸºäºæ„é€ å‡½æ•°çš„ä¾èµ–æ³¨å…¥ï¼Œé‚£ä¹ˆå¾ˆæœ‰å¯èƒ½å‡ºç°å¾ªç¯ä¾èµ–çš„æƒ…å†µã€‚</p><p>ä¾‹å¦‚ï¼šç±»Aåœ¨æ„é€ å‡½æ•°ä¸­ä¾èµ–äºç±»Bçš„å®ä¾‹ï¼Œè€Œç±»Bçš„æ„é€ å‡½æ•°åˆä¾èµ–ç±»Açš„å®ä¾‹ã€‚å¦‚æœè¿™æ ·é…ç½®ç±»Aå’Œç±»Bç›¸äº’æ³¨å…¥çš„è¯ï¼ŒSpring IoCå®¹å™¨ä¼šå‘ç°è¿™ä¸ªè¿è¡Œæ—¶çš„å¾ªç¯ä¾èµ–ï¼Œ å¹¶ä¸”æŠ›å‡º<code>BeanCurrentlyInCreationException</code>ã€‚</p><p>å¼€å‘è€…å¯ä»¥é€‰æ‹©setteræ–¹æ³•æ¥é…ç½®ä¾èµ–æ³¨å…¥ï¼Œè¿™æ ·å°±ä¸ä¼šå‡ºç°å¾ªç¯ä¾èµ–çš„æƒ…å†µã€‚æˆ–è€…æ ¹æœ¬å°±ä¸ä½¿ç”¨åŸºäºæ„é€ å‡½æ•°çš„ä¾èµ–æ³¨å…¥ï¼Œè€Œä»…ä»…ä½¿ç”¨åŸºäºsetteræ–¹æ³•çš„ä¾èµ–æ³¨å…¥ã€‚ æ¢è¨€ä¹‹ï¼Œä½†æ˜¯å¼€å‘è€…å¯ä»¥å°†å¾ªç¯ä¾èµ–é…ç½®ä¸ºåŸºäºSetteræ–¹æ³•çš„ä¾èµ–æ³¨å…¥ï¼ˆå°½ç®¡ä¸æ¨èè¿™æ ·åšï¼‰</p><p>ä¸åƒå…¸å‹çš„ä¾‹å­ï¼ˆæ²¡æœ‰å¾ªç¯ä¾èµ–çš„æƒ…å†µï¼‰ï¼Œbean Aå’Œbean Bä¹‹é—´çš„å¾ªç¯ä¾èµ–å…³ç³»åœ¨å®Œå…¨åˆå§‹åŒ–ä¹‹å‰å°±å·²ç»å°†å…¶ä¸­ä¸€ä¸ªbeanæ³¨å…¥åˆ°å¦ä¸€ä¸ªä¸­äº†ï¼ˆå…¸å‹çš„é¸¡å’Œé¸¡è›‹çš„æ•…äº‹ï¼‰</p><p>ä½ å¯ä»¥ä¿¡ä»»Springåšæ­£ç¡®çš„äº‹ã€‚å®ƒåœ¨å®¹å™¨åŠ è½½æ—¶æ£€æµ‹é…ç½®é—®é¢˜ï¼Œä¾‹å¦‚å¯¹ä¸å­˜åœ¨çš„beanå’Œå¾ªç¯ä¾èµ–çš„å¼•ç”¨ã€‚ å½“å®é™…åˆ›å»ºbeanæ—¶ï¼ŒSpringä¼šå°½å¯èƒ½æ™šåœ°è®¾ç½®å±æ€§å¹¶è§£æä¾èµ–é¡¹ã€‚è¿™ä¹Ÿæ„å‘³ç€Springå®¹å™¨åŠ è½½æ­£ç¡®åä¼šåœ¨beanæ³¨å…¥ä¾èµ–å‡ºé”™çš„æ—¶å€™æŠ›å‡ºå¼‚å¸¸ã€‚ä¾‹å¦‚ï¼ŒbeanæŠ›å‡ºç¼ºå°‘å±æ€§æˆ–è€…å±æ€§ä¸åˆæ³•çš„å¼‚å¸¸ ï¼Œè¿™ç§å»¶è¿Ÿçš„è§£æä¹Ÿæ˜¯<code>ApplicationContext</code> çš„å®ç°ä¼šä»¤å•ä¾‹Beanå¤„äºé¢„å®ä¾‹åŒ–çŠ¶æ€çš„åŸå› ã€‚è¿™æ ·ï¼Œé€šè¿‡<code>ApplicationContext</code>åˆ›å»ºbeanï¼Œå¯ä»¥åœ¨çœŸæ­£ä½¿ç”¨beanä¹‹å‰æ¶ˆè€—ä¸€äº›å†…å­˜ä»£ä»·è€Œå‘ç°é…ç½®çš„é—®é¢˜ ã€‚å¼€å‘è€…ä¹Ÿå¯ä»¥è¦†ç›–é»˜è®¤çš„è¡Œä¸ºè®©å•ä¾‹beanå»¶è¿ŸåŠ è½½ï¼Œè€Œä¸æ€»æ˜¯å¤„äºé¢„å®ä¾‹åŒ–çŠ¶æ€ã€‚</p><p>å¦‚æœä¸å­˜åœ¨å¾ªç¯ä¾èµ–çš„è¯ï¼Œbeanæ‰€å¼•ç”¨çš„ä¾èµ–ä¼šé¢„å…ˆå…¨éƒ¨æ„é€ ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœbean Aä¾èµ–äºbean Bï¼Œé‚£ä¹ˆSpring IoCå®¹å™¨ä¼šå…ˆé…ç½®bean Bï¼Œç„¶åè°ƒç”¨bean Açš„setteræ–¹æ³•æ¥æ„é€ bean Aã€‚ æ¢è¨€ä¹‹ï¼Œbeanå…ˆä¼šå®ä¾‹åŒ–ï¼Œç„¶åå†æ³¨å…¥ä¾èµ–ï¼Œæœ€åæ‰æ˜¯ç›¸å…³ç”Ÿå‘½å‘¨æœŸæ–¹æ³•çš„è°ƒç”¨ï¼ˆå°±åƒé…ç½®æ–‡ä»¶çš„<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-lifecycle-initializingbean">åˆå§‹åŒ–æ–¹æ³•</a> æˆ–è€…<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-lifecycle-initializingbean">InitializingBeançš„å›è°ƒå‡½æ•°</a>é‚£æ ·ï¼‰ã€‚</p><h5 id="ä¾èµ–æ³¨å…¥çš„ä¾‹å­"><a href="#ä¾èµ–æ³¨å…¥çš„ä¾‹å­" class="headerlink" title="ä¾èµ–æ³¨å…¥çš„ä¾‹å­"></a>ä¾èµ–æ³¨å…¥çš„ä¾‹å­</h5><p>ä¸‹é¢çš„ä¾‹å­ä½¿ç”¨åŸºäºXMLçš„å…ƒæ•°æ®é…ç½®ï¼Œç„¶åä½¿ç”¨setteræ–¹å¼è¿›è¡Œä¾èµ–æ³¨å…¥ã€‚ä¸‹é¢æ˜¯Springä¸­ä½¿ç”¨XMLæ–‡ä»¶å£°æ˜beanå®šä¹‰çš„ç‰‡æ®µï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;exampleBean&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;examples.ExampleBean&quot;</span>&gt;</span>    <span class="hljs-comment">&lt;!-- setter injection using the nested ref element --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;beanOne&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">bean</span>=<span class="hljs-string">&quot;anotherExampleBean&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- setter injection using the neater ref attribute --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;beanTwo&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;yetAnotherBean&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;integerProperty&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;1&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;anotherExampleBean&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;examples.AnotherBean&quot;</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;yetAnotherBean&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;examples.YetAnotherBean&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†ç›¸åº”çš„ <code>ExampleBean</code>ç±»ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExampleBean</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">AnotherBean</span> beanOne;<br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">YetAnotherBean</span> beanTwo;<br>    <span class="hljs-keyword">private</span> int i;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setBeanOne</span>(<span class="hljs-params">AnotherBean beanOne</span>) &#123;        <span class="hljs-variable language_">this</span>.<span class="hljs-property">beanOne</span> = beanOne;    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setBeanTwo</span>(<span class="hljs-params">YetAnotherBean beanTwo</span>) &#123;        <span class="hljs-variable language_">this</span>.<span class="hljs-property">beanTwo</span> = beanTwo;    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setIntegerProperty</span>(<span class="hljs-params">int i</span>) &#123;        <span class="hljs-variable language_">this</span>.<span class="hljs-property">i</span> = i;    &#125;&#125;<br></code></pre></td></tr></table></figure><p>åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œsetterè¢«å£°æ˜ä¸ºä¸XMLæ–‡ä»¶ä¸­æŒ‡å®šçš„å±æ€§åŒ¹é…ã€‚ä»¥ä¸‹ç¤ºä¾‹ä½¿ç”¨åŸºäºæ„é€ å‡½æ•°çš„DIï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;exampleBean&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;examples.ExampleBean&quot;</span>&gt;</span>    <span class="hljs-comment">&lt;!-- constructor injection using the nested ref element --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">bean</span>=<span class="hljs-string">&quot;anotherExampleBean&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">constructor-arg</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- constructor injection using the neater ref attribute --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;yetAnotherBean&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;int&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;1&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;anotherExampleBean&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;examples.AnotherBean&quot;</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;yetAnotherBean&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;examples.YetAnotherBean&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†ç›¸åº”çš„<code>ExampleBean</code>ç±»ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExampleBean</span> &#123;<br>    <span class="hljs-keyword">private</span> AnotherBean beanOne;<br>    <span class="hljs-keyword">private</span> YetAnotherBean beanTwo;<br>    <span class="hljs-keyword">private</span> int i;<br>    <span class="hljs-keyword">public</span> ExampleBean(        AnotherBean anotherBean, YetAnotherBean yetAnotherBean, int i) &#123;        <span class="hljs-keyword">this</span>.beanOne = anotherBean;        <span class="hljs-keyword">this</span>.beanTwo = yetAnotherBean;        <span class="hljs-keyword">this</span>.i = i;    &#125;&#125;<br></code></pre></td></tr></table></figure><p>beanå®šä¹‰ä¸­æŒ‡å®šçš„æ„é€ å‡½æ•°å‚æ•°ç”¨ä½œ <code>ExampleBean</code>çš„æ„é€ å‡½æ•°çš„å‚æ•°ã€‚</p><p>ç°åœ¨è€ƒè™‘è¿™ä¸ªç¤ºä¾‹çš„å˜ä½“ï¼Œå…¶ä¸­ï¼Œä¸ä½¿ç”¨æ„é€ å‡½æ•°ï¼Œè€Œæ˜¯å‘Šè¯‰Springè°ƒç”¨é™æ€å·¥å‚æ–¹æ³•æ¥è¿”å›å¯¹è±¡çš„å®ä¾‹ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;bean <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;exampleBean&quot;</span> <span class="hljs-attribute">class</span>=<span class="hljs-string">&quot;examples.ExampleBean&quot;</span> <span class="hljs-attribute">factory-method</span>=<span class="hljs-string">&quot;createInstance&quot;</span>&gt;    &lt;constructor-arg <span class="hljs-attribute">ref</span>=<span class="hljs-string">&quot;anotherExampleBean&quot;</span>/&gt;    &lt;constructor-arg <span class="hljs-attribute">ref</span>=<span class="hljs-string">&quot;yetAnotherBean&quot;</span>/&gt;    &lt;constructor-arg <span class="hljs-attribute">value</span>=<span class="hljs-string">&quot;1&quot;</span>/&gt;&lt;/bean&gt;<br>&lt;bean <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;anotherExampleBean&quot;</span> <span class="hljs-attribute">class</span>=<span class="hljs-string">&quot;examples.AnotherBean&quot;</span>/&gt;&lt;bean <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;yetAnotherBean&quot;</span> <span class="hljs-attribute">class</span>=<span class="hljs-string">&quot;examples.YetAnotherBean&quot;</span>/&gt;<br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†ç›¸åº”çš„<code>ExampleBean</code>ç±»ï¼š</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-keyword">public</span> <span class="hljs-title class_"><span class="hljs-keyword">class</span> <span class="hljs-title">ExampleBean</span> </span>&#123;<br>    <span class="hljs-comment">// a private constructor    private ExampleBean(...) &#123;        ...    &#125;</span><br>    <span class="hljs-comment">// a static factory method; the arguments to this method can be    // considered the dependencies of the bean that is returned,    // regardless of how those arguments are actually used.    public static ExampleBean createInstance (        AnotherBean anotherBean, YetAnotherBean yetAnotherBean, int i) &#123;</span><br>        ExampleBean eb = <span class="hljs-keyword">new</span> <span class="hljs-type">ExampleBean</span> (...);        <span class="hljs-comment">// some other operations...        return eb;    &#125;&#125;</span><br></code></pre></td></tr></table></figure><p><code>é™æ€å·¥å‚æ–¹æ³•</code>çš„å‚æ•°ç”±<code>&lt;constructor-arg/&gt;</code>å…ƒç´ æä¾›ï¼Œä¸å®é™…ä½¿ç”¨çš„æ„é€ å‡½æ•°å®Œå…¨ç›¸åŒã€‚å·¥å‚æ–¹æ³•è¿”å›ç±»çš„ç±»å‹ä¸å¿…ä¸åŒ…å«<code>é™æ€å·¥å‚æ–¹æ³•</code> çš„ç±»å®Œå…¨ç›¸åŒï¼Œ å°½ç®¡åœ¨æœ¬ä¾‹ä¸­æ˜¯è¿™æ ·ã€‚å®ä¾‹ï¼ˆéé™æ€ï¼‰å·¥å‚æ–¹æ³•çš„ä½¿ç”¨æ–¹å¼ä¹Ÿæ˜¯ç›¸ä¼¼çš„ï¼ˆé™¤äº†ä½¿ç”¨<code>factory-bean</code>å±æ€§è€Œä¸æ˜¯<code>class</code>å±æ€§ã€‚å› æ­¤æ­¤å¤„ä¸åœ¨å±•å¼€è®¨è®ºã€‚</p><h4 id="1-4-2-ä¾èµ–å’Œé…ç½®çš„ç»†èŠ‚"><a href="#1-4-2-ä¾èµ–å’Œé…ç½®çš„ç»†èŠ‚" class="headerlink" title="1.4.2. ä¾èµ–å’Œé…ç½®çš„ç»†èŠ‚"></a>1.4.2. ä¾èµ–å’Œé…ç½®çš„ç»†èŠ‚</h4><p><a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-collaborators">å¦‚ä¸Šä¸€èŠ‚æ‰€è¿°</a>ï¼Œæ‚¨å¯ä»¥å°†beançš„å±æ€§å’Œæ„é€ å‡½æ•°å‚æ•°å®šä¹‰ä¸ºå¯¹å…¶ä»–beançš„å¼•ç”¨ï¼Œæˆ–è€…ä½œä¸ºå…¶å†…è”å®šä¹‰çš„å€¼ã€‚Springå¯ä»¥å…è®¸æ‚¨åœ¨åŸºäºXMLçš„é…ç½®å…ƒæ•°æ®ï¼ˆå®šä¹‰Beanï¼‰ä¸­ä½¿ç”¨å­å…ƒç´ <code>&lt;property/&gt;</code> and <code>&lt;constructor-arg/&gt;</code> æ¥è¾¾åˆ°è¿™ç§ç›®çš„ã€‚</p><h5 id="ç›´æ¥å€¼ï¼ˆåŸºæœ¬ç±»å‹ï¼ŒStringç­‰ç­‰ï¼‰"><a href="#ç›´æ¥å€¼ï¼ˆåŸºæœ¬ç±»å‹ï¼ŒStringç­‰ç­‰ï¼‰" class="headerlink" title="ç›´æ¥å€¼ï¼ˆåŸºæœ¬ç±»å‹ï¼ŒStringç­‰ç­‰ï¼‰"></a>ç›´æ¥å€¼ï¼ˆåŸºæœ¬ç±»å‹ï¼ŒStringç­‰ç­‰ï¼‰</h5><p><code>&lt;property/&gt;</code> å…ƒç´ çš„<code>value</code> å±æ€§å°†å±æ€§æˆ–æ„é€ å‡½æ•°å‚æ•°æŒ‡å®šä¸ºäººç±»å¯è¯»çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ï¼Œ Springçš„<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#core-convert-ConversionService-API">conversion service</a>ç”¨äºå°†è¿™äº›å€¼ä»<code>String</code> è½¬æ¢ä¸ºå±æ€§æˆ–å‚æ•°çš„å®é™…ç±»å‹ã€‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†è¦è®¾ç½®çš„å„ç§å€¼ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;myDataSource&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span> <span class="hljs-attr">destroy-method</span>=<span class="hljs-string">&quot;close&quot;</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- results in a setDriverClassName(String) call --&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;driverClassName&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/mydb&quot;</span>/&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>/&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;masterkaoli&quot;</span>/&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹ç¤ºä¾‹ä½¿ç”¨<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-p-namespace">på‘½åç©ºé—´</a>è¿›è¡Œæ›´ç®€æ´çš„XMLé…ç½®ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus">&lt;beans xmlns=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span>    xmlns:xsi=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>    xmlns:p=<span class="hljs-string">&quot;http://www.springframework.org/schema/p&quot;</span>    xsi:schemaLocation=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans    http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;<br>    &lt;bean id=<span class="hljs-string">&quot;myDataSource&quot;</span> class=<span class="hljs-string">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span>        destroy-method=<span class="hljs-string">&quot;close&quot;</span>        <span class="hljs-selector-tag">p</span>:driverClassName=<span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span>        <span class="hljs-selector-tag">p</span>:url=<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/mydb&quot;</span>        <span class="hljs-selector-tag">p</span>:username=<span class="hljs-string">&quot;root&quot;</span>        <span class="hljs-selector-tag">p</span>:password=<span class="hljs-string">&quot;masterkaoli&quot;</span>/&gt;<br>&lt;/beans&gt;<br></code></pre></td></tr></table></figure><p>å‰é¢çš„XMLæ›´ç®€æ´ã€‚ ä½†æ˜¯å› ä¸ºå±æ€§çš„ç±»å‹æ˜¯åœ¨è¿è¡Œæ—¶ç¡®å®šçš„ï¼Œè€Œéè®¾è®¡æ—¶ç¡®å®šçš„ã€‚æ‰€æœ‰æœ‰å¯èƒ½åœ¨è¿è¡Œæ—¶å‘ç°æ‹¼å†™é”™è¯¯ã€‚ï¼Œé™¤éæ‚¨åœ¨åˆ›å»ºbeanå®šä¹‰æ—¶ä½¿ç”¨æ”¯æŒè‡ªåŠ¨å±æ€§å®Œæˆçš„IDEï¼ˆä¾‹å¦‚<a href="http://www.jetbrains.com/idea/">IntelliJ IDEA</a> or the <a href="https://spring.io/tools/sts">Spring Tool Suite</a>ï¼‰ã€‚ æ‰€ä»¥ï¼Œå¼ºçƒˆå»ºè®®ä½¿ç”¨æ­¤ç±»IDEå¸®åŠ©ã€‚</p><p>ä½ ä¹Ÿå¯ä»¥é…ç½®ä¸€ä¸ª<code>java.util.Properties</code> çš„å®ä¾‹ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;mappings&quot;</span>    <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.beans.factory.config.PropertyPlaceholderConfigurer&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- typed as a java.util.Properties --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;properties&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>            jdbc.driver.className=com.mysql.jdbc.Driver            jdbc.url=jdbc:mysql://localhost:3306/mydb        <span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p>Springçš„å®¹å™¨ä¼šå°†<code>&lt;value/&gt;</code>é‡Œé¢çš„æ–‡æœ¬é€šè¿‡JavaBeançš„<code>PropertyEditor</code> æœºåˆ¶è½¬æ¢æˆ<code>java.util.Properties</code> å®ä¾‹ï¼Œ è¿™ç§åµŒå¥—<code>&lt;value/&gt;</code>å…ƒç´ çš„å¿«æ·æ–¹å¼ä¹Ÿæ˜¯Springå›¢é˜Ÿæ¨èä½¿ç”¨çš„ã€‚</p><h6 id="idref-å…ƒç´ "><a href="#idref-å…ƒç´ " class="headerlink" title="idref å…ƒç´ "></a><code>idref</code> å…ƒç´ </h6><p><code>idref</code> å…ƒç´ åªæ˜¯ä¸€ç§é˜²é”™æ–¹æ³•ï¼Œå¯ä»¥å°†å®¹å™¨ä¸­å¦ä¸€ä¸ªbeançš„<code>id</code>ï¼ˆå­—ç¬¦ä¸²å€¼ - è€Œä¸æ˜¯å¼•ç”¨ï¼‰ä¼ é€’ç»™<code>&lt;constructor-arg/&gt;</code>æˆ–<code>&lt;property/&gt;</code>å…ƒç´ ï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf">&lt;bean id<span class="hljs-operator">=</span><span class="hljs-string">&quot;theTargetBean&quot;</span> class<span class="hljs-operator">=</span><span class="hljs-string">&quot;...&quot;</span>/&gt;<br>&lt;bean id<span class="hljs-operator">=</span><span class="hljs-string">&quot;theClientBean&quot;</span> class<span class="hljs-operator">=</span><span class="hljs-string">&quot;...&quot;</span>&gt;    &lt;property name<span class="hljs-operator">=</span><span class="hljs-string">&quot;targetName&quot;</span>&gt;        &lt;idref bean<span class="hljs-operator">=</span><span class="hljs-string">&quot;theTargetBean&quot;</span>/&gt;    &lt;/property&gt;&lt;/bean&gt;<br></code></pre></td></tr></table></figure><p>å‰é¢çš„beanå®šä¹‰ä»£ç æ®µè¿è¡Œæ—¶ä¸ä»¥ä¸‹ä»£ç æ®µå®Œå…¨ç­‰æ•ˆï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;bean <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;theTargetBean&quot;</span> <span class="hljs-attribute">class</span>=<span class="hljs-string">&quot;...&quot;</span> /&gt;<br>&lt;bean <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;client&quot;</span> <span class="hljs-attribute">class</span>=<span class="hljs-string">&quot;...&quot;</span>&gt;    &lt;property <span class="hljs-attribute">name</span>=<span class="hljs-string">&quot;targetName&quot;</span> <span class="hljs-attribute">value</span>=<span class="hljs-string">&quot;theTargetBean&quot;</span>/&gt;&lt;/bean&gt;<br></code></pre></td></tr></table></figure><p>Springå›¢é˜Ÿæ›´æ¨èç¬¬ä¸€ç§æ–¹å¼ï¼Œå› ä¸ºä½¿ç”¨äº†<code>idref</code> æ ‡ç­¾ï¼Œå®ƒä¼šè®©å®¹å™¨åœ¨éƒ¨ç½²é˜¶æ®µå°±å¯¹beanè¿›è¡Œæ ¡éªŒï¼Œä»¥ç¡®ä¿beanä¸€å®šå­˜åœ¨ã€‚è€Œä½¿ç”¨ç¬¬äºŒç§æ–¹å¼çš„è¯ï¼Œæ˜¯æ²¡æœ‰ä»»ä½•æ ¡éªŒçš„ã€‚ åªæœ‰å®é™…ä¸Šå¼•ç”¨äº†<code>client</code> beançš„<code>targetName</code>å±æ€§ï¼Œä¸å¯¹å…¶å€¼è¿›è¡Œæ ¡éªŒã€‚åœ¨å®ä¾‹åŒ–clientçš„æ—¶å€™æ‰ä¼šè¢«å‘ç°ã€‚å¦‚æœclientæ˜¯<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-scopes">prototype</a>ç±»å‹çš„Beançš„è¯ï¼Œé‚£ä¹ˆç±»ä¼¼æ‹¼å†™ä¹‹ç±»çš„é”™è¯¯ä¼šåœ¨å®¹å™¨éƒ¨ç½²ä»¥åå¾ˆä¹…æ‰èƒ½å‘ç°ã€‚</p><p><code>idref</code>å…ƒç´ çš„<code>local</code>å±æ€§åœ¨Spring 4.0ä»¥åçš„xsdä¸­å·²ç»ä¸å†æ”¯æŒäº†ï¼Œè€Œæ˜¯ä½¿ç”¨äº†beanå¼•ç”¨ã€‚å¦‚æœæ›´æ–°äº†ç‰ˆæœ¬çš„è¯ï¼Œåªè¦å°†<code>idref local</code>å¼•ç”¨éƒ½è½¬æ¢æˆ<code>idref bean</code> å³å¯ã€‚</p><p>åœ¨<code>ProxyFactoryBean</code>å®šä¹‰ä¸­ï¼Œå…ƒç´ æ‰€æºå¸¦çš„å€¼åœ¨<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#aop-pfb-1">AOPæ‹¦æˆªå™¨a&gt;çš„é…ç½®ä¸­å¾ˆå¸¸è§ï¼ˆè‡³å°‘åœ¨Spring 2.0ä¹‹å‰çš„ç‰ˆæœ¬æ˜¯è¿™æ ·ï¼‰ã€‚åœ¨æŒ‡å®šæ‹¦æˆªå™¨åç§°æ—¶ä½¿ç”¨&#96;&#96; å…ƒç´ å¯é˜²æ­¢æ‹¦æˆªå™¨æ¼æ‰idæˆ–æ‹¼å†™é”™è¯¯ã€‚</a></p><h5 id="å¼•ç”¨å…¶ä»–çš„Beanï¼ˆè£…é…ï¼‰"><a href="#å¼•ç”¨å…¶ä»–çš„Beanï¼ˆè£…é…ï¼‰" class="headerlink" title="å¼•ç”¨å…¶ä»–çš„Beanï¼ˆè£…é…ï¼‰"></a>å¼•ç”¨å…¶ä»–çš„Beanï¼ˆè£…é…ï¼‰</h5><p><code>ref</code> å…ƒç´ æ˜¯<code>&lt;constructor-arg/&gt;</code> æˆ– or <code>&lt;property/&gt;</code>å®šä¹‰å…ƒç´ ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ ã€‚ ä½ å¯ä»¥é€šè¿‡è¿™ä¸ªæ ‡ç­¾é…ç½®ä¸€ä¸ªbeanæ¥å¼•ç”¨å¦ä¸€ä¸ªbeanã€‚å½“éœ€è¦å¼•ç”¨ä¸€ä¸ªbeançš„æ—¶å€™ï¼Œè¢«å¼•ç”¨çš„beanä¼šå…ˆå®ä¾‹åŒ–ï¼Œç„¶åé…ç½®å±æ€§ï¼Œä¹Ÿå°±æ˜¯å¼•ç”¨çš„ä¾èµ–ã€‚å¦‚æœè¯¥beanæ˜¯å•ä¾‹beançš„è¯ ï¼Œé‚£ä¹ˆè¯¥beanä¼šæ—©ç”±å®¹å™¨åˆå§‹åŒ–ã€‚æœ€ç»ˆä¼šå¼•ç”¨å¦ä¸€ä¸ªå¯¹è±¡çš„æ‰€æœ‰å¼•ç”¨ï¼Œbeançš„èŒƒå›´ä»¥åŠæ ¡éªŒå–å†³äºä½ æ˜¯å¦æœ‰é€šè¿‡<code>bean</code>, <code>local,</code> or <code>parent</code> è¿™äº›å±æ€§æ¥æŒ‡å®šå¯¹è±¡çš„idæˆ–è€…nameå±æ€§ã€‚</p><p>é€šè¿‡æŒ‡å®š <code>bean</code>å±æ€§ä¸­çš„<code>&lt;ref/&gt;</code>å…ƒç´ æ¥æŒ‡å®šä¾èµ–æ˜¯æœ€å¸¸è§çš„ä¸€ç§æ–¹å¼ï¼Œå¯ä»¥å¼•ç”¨å®¹å™¨æˆ–è€…çˆ¶å®¹å™¨ä¸­çš„beanï¼Œä¸åœ¨åŒä¸€ä¸ªXMLæ–‡ä»¶å®šä¹‰ä¹Ÿå¯ä»¥å¼•ç”¨ã€‚ å…¶ä¸­<code>bean</code> å±æ€§ä¸­çš„å€¼å¯ä»¥å’Œå…¶ä»–å¼•ç”¨<code>bean</code> ä¸­çš„<code>id</code>å±æ€§ä¸€è‡´ï¼Œæˆ–è€…å’Œå…¶ä¸­çš„æŸä¸ª<code>name</code> å±æ€§ä¸€è‡´ï¼Œä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•ä½¿ç”¨refå…ƒç´ ï¼šï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;ref <span class="hljs-attribute">bean</span>=<span class="hljs-string">&quot;someBean&quot;</span>/&gt;<br></code></pre></td></tr></table></figure><p>é€šè¿‡æŒ‡å®šbeançš„<code>parent</code>å±æ€§å¯ä»¥åˆ›å»ºä¸€ä¸ªå¼•ç”¨åˆ°å½“å‰å®¹å™¨çš„çˆ¶å®¹å™¨ä¹‹ä¸­ã€‚<code>parent</code>å±æ€§çš„å€¼å¯ä»¥ä¸ç›®æ ‡beançš„<code>id</code>å±æ€§ä¸€è‡´ï¼Œæˆ–è€…å’Œç›®æ ‡beançš„<code>name</code>å±æ€§ä¸­çš„æŸä¸ªä¸€è‡´ï¼Œç›®æ ‡beanå¿…é¡»æ˜¯å½“å‰å¼•ç”¨ç›®æ ‡beanå®¹å™¨çš„çˆ¶å®¹å™¨ ã€‚å¼€å‘è€…ä¸€èˆ¬åªæœ‰åœ¨å­˜åœ¨å±‚æ¬¡åŒ–å®¹å™¨ï¼Œå¹¶ä¸”å¸Œæœ›é€šè¿‡ä»£ç†æ¥åŒ…è£¹çˆ¶å®¹å™¨ä¸­ä¸€ä¸ªå­˜åœ¨çš„beançš„æ—¶å€™æ‰ä¼šç”¨åˆ°è¿™ä¸ªå±æ€§ã€‚ ä»¥ä¸‹ä¸€å¯¹åˆ—è¡¨æ˜¾ç¤ºäº†å¦‚ä½•ä½¿ç”¨çˆ¶å±æ€§:</p><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs django"><span class="language-xml"><span class="hljs-comment">&lt;!-- in the parent context --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;accountService&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.something.SimpleAccountService&quot;</span>&gt;</span>    <span class="hljs-comment">&lt;!-- insert dependencies as required as here --&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-comment">&lt;!-- in the child (descendant) context --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;accountService&quot;</span> &lt;!<span class="hljs-attr">--</span> <span class="hljs-attr">bean</span> <span class="hljs-attr">name</span> <span class="hljs-attr">is</span> <span class="hljs-attr">the</span> <span class="hljs-attr">same</span> <span class="hljs-attr">as</span> <span class="hljs-attr">the</span> <span class="hljs-attr">parent</span> <span class="hljs-attr">bean</span> <span class="hljs-attr">--</span>&gt;</span>    class=&quot;org.springframework.aop.framework.ProxyFactoryBean&quot;&gt;    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;target&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">parent</span>=<span class="hljs-string">&quot;accountService&quot;</span>/&gt;</span> <span class="hljs-comment">&lt;!-- notice how we refer to the parent bean --&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>    <span class="hljs-comment">&lt;!-- insert other configuration and dependencies as required here --&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p>ä¸idrefæ ‡ç­¾ä¸€æ ·ï¼Œ<code>ref</code>å…ƒç´ ä¸­çš„<code>local</code> æ ‡ç­¾åœ¨xsd 4.0ï¼Œä»¥åå·²ç»ä¸å†æ”¯æŒäº†ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡å°†å·²å­˜åœ¨çš„<code>ref local</code>æ”¹ä¸º<code>ref bean</code> æ¥å®ŒæˆSpringç‰ˆæœ¬å‡çº§ã€‚</p><h5 id="å†…éƒ¨bean"><a href="#å†…éƒ¨bean" class="headerlink" title="å†…éƒ¨bean"></a>å†…éƒ¨bean</h5><p>å®šä¹‰åœ¨<code>&lt;bean/&gt;</code>å…ƒç´ çš„<code>&lt;property/&gt;</code>æˆ–è€…<code>&lt;constructor-arg/&gt;</code> å…ƒç´ ä¹‹å†…çš„beanå«åšå†…éƒ¨beanï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;outer&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;...&quot;</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- instead of using a reference to a target bean, simply define the target bean inline --&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;target&quot;</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.example.Person&quot;</span>&gt;</span> <span class="hljs-comment">&lt;!-- this is the inner bean --&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Fiona Apple&quot;</span>/&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;age&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;25&quot;</span>/&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å†…éƒ¨beanå®šä¹‰ä¸éœ€è¦å®šä¹‰çš„IDæˆ–åç§°ã€‚å¦‚æœæŒ‡å®šï¼Œåˆ™å®¹å™¨ä¸ä½¿ç”¨æ­¤ç±»å€¼ä½œä¸ºæ ‡è¯†ç¬¦ã€‚å®¹å™¨è¿˜ä¼šåœ¨åˆ›å»ºæ—¶å¿½ç•¥<code>scope</code> æ ‡ç­¾ï¼Œå› ä¸ºå†…éƒ¨beanå§‹ç»ˆæ˜¯åŒ¿åçš„ï¼Œå¹¶ä¸”å§‹ç»ˆä½¿ç”¨å¤–éƒ¨beanåˆ›å»ºã€‚ å¼€å‘è€…æ˜¯æ— æ³•å°†å†…éƒ¨beanæ³¨å…¥åˆ°å¤–éƒ¨beanä»¥å¤–çš„å…¶ä»–beanä¸­çš„ã€‚</p><p>ä½œä¸ºä¸€ä¸ªæç«¯æƒ…å†µï¼Œå¯ä»¥ä»è‡ªå®šä¹‰èŒƒå›´æ¥æ”¶é”€æ¯å›è°ƒ ï¼Œ ä¾‹å¦‚ï¼šè¯·æ±‚èŒƒå›´çš„å†…éƒ¨beanåŒ…å«äº†å•ä¾‹beanï¼Œé‚£ä¹ˆå†…éƒ¨beanå®ä¾‹ä¼šç»‘å®šåˆ°åŒ…å«çš„beanï¼Œè€ŒåŒ…å«çš„beanå…è®¸è®¿é—®requestçš„scopeç”Ÿå‘½å‘¨æœŸã€‚ è¿™ç§åœºæ™¯å¹¶ä¸å¸¸è§ï¼Œå†…éƒ¨beané€šå¸¸åªæ˜¯ä¾›ç»™å®ƒçš„å¤–éƒ¨beanä½¿ç”¨ã€‚</p><h5 id="é›†åˆ"><a href="#é›†åˆ" class="headerlink" title="é›†åˆ"></a>é›†åˆ</h5><p>åœ¨<code>&lt;list/&gt;</code>, <code>&lt;set/&gt;</code>, <code>&lt;map/&gt;</code>, å’Œ <code>&lt;props/&gt;</code>å…ƒç´ ä¸­ï¼Œæ‚¨å¯ä»¥åˆ†åˆ«é…ç½®Javaé›†åˆç±»å‹ <code>List</code>, <code>Set</code>, <code>Map</code>, and <code>Properties</code>çš„å±æ€§å’Œå‚æ•°ã€‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•ä½¿ç”¨å®ƒä»¬:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;moreComplexObject&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;example.ComplexObject&quot;</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- results in a setAdminEmails(java.util.Properties) call --&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;adminEmails&quot;</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">props</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">prop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;administrator&quot;</span>&gt;</span>administrator@example.org<span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">prop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;support&quot;</span>&gt;</span>support@example.org<span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">prop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;development&quot;</span>&gt;</span>development@example.org<span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">props</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- results in a setSomeList(java.util.List) call --&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;someList&quot;</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>a list element followed by a reference<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">bean</span>=<span class="hljs-string">&quot;myDataSource&quot;</span> /&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- results in a setSomeMap(java.util.Map) call --&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;someMap&quot;</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">map</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;an entry&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;just some string&quot;</span>/&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span> =<span class="hljs-string">&quot;a ref&quot;</span> <span class="hljs-attr">value-ref</span>=<span class="hljs-string">&quot;myDataSource&quot;</span>/&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">map</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- results in a setSomeSet(java.util.Set) call --&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;someSet&quot;</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">set</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>just some string<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">bean</span>=<span class="hljs-string">&quot;myDataSource&quot;</span> /&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">set</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œmapçš„keyæˆ–è€…valueï¼Œæˆ–è€…é›†åˆçš„valueéƒ½å¯ä»¥é…ç½®ä¸ºä¸‹åˆ—å…ƒç´ ä¹‹ä¸€:</p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coq">bean | <span class="hljs-type">ref</span> | <span class="hljs-type">idref</span> | <span class="hljs-type">list</span> | <span class="hljs-type">set</span> | <span class="hljs-type">map</span> | <span class="hljs-type">props</span> | <span class="hljs-type">value</span> | <span class="hljs-type">null</span><br></code></pre></td></tr></table></figure><h6 id="é›†åˆçš„åˆå¹¶"><a href="#é›†åˆçš„åˆå¹¶" class="headerlink" title="é›†åˆçš„åˆå¹¶"></a>é›†åˆçš„åˆå¹¶</h6><p>Springçš„å®¹å™¨ä¹Ÿæ”¯æŒé›†åˆåˆå¹¶ï¼Œå¼€å‘è€…å¯ä»¥å®šä¹‰çˆ¶æ ·å¼çš„<list/>, <map/>, <set/> æˆ– <props/>å…ƒç´ ï¼Œ åŒæ—¶æœ‰å­æ ·å¼çš„<list/>, <map/>, <set/> æˆ– <props/>å…ƒç´ ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå­é›†åˆçš„å€¼æ˜¯çˆ¶å…ƒç´ å’Œå­å…ƒç´ é›†åˆçš„åˆå¹¶å€¼ã€‚</p><p>æœ‰å…³åˆå¹¶çš„è¿™ä¸€èŠ‚è®¨è®ºçˆ¶å­beanæœºåˆ¶ï¼Œä¸ç†Ÿæ‚‰çˆ¶å’Œå­beanå®šä¹‰çš„è¯»è€…å¯èƒ½å¸Œæœ›åœ¨ç»§ç»­ä¹‹å‰é˜…è¯»<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-child-bean-definitions">ç›¸å…³éƒ¨åˆ†</a>ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹æ¼”ç¤ºäº†é›†åˆåˆå¹¶ï¼š:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;parent&quot;</span> <span class="hljs-attr">abstract</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;example.ComplexObject&quot;</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;adminEmails&quot;</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">props</span>&gt;</span><br><br>                <span class="hljs-tag">&lt;<span class="hljs-name">prop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;administrator&quot;</span>&gt;</span>administrator@example.com<span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span><br><br>                <span class="hljs-tag">&lt;<span class="hljs-name">prop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;support&quot;</span>&gt;</span>support@example.com<span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">props</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;child&quot;</span> <span class="hljs-attr">parent</span>=<span class="hljs-string">&quot;parent&quot;</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;adminEmails&quot;</span>&gt;</span><br><br>            <span class="hljs-comment">&lt;!-- the merge is specified on the child collection definition --&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">props</span> <span class="hljs-attr">merge</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><br><br>                <span class="hljs-tag">&lt;<span class="hljs-name">prop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;sales&quot;</span>&gt;</span>sales@example.com<span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span><br><br>                <span class="hljs-tag">&lt;<span class="hljs-name">prop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;support&quot;</span>&gt;</span>support@example.co.uk<span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">props</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œåœ¨<code>child</code> bean å®šä¹‰çš„<code>adminEmails</code>ä¸­çš„<code>&lt;props/&gt;</code>ä½¿ç”¨<code>merge=true</code> å±æ€§ã€‚ å½“å®¹å™¨è§£æå¹¶å®ä¾‹åŒ–<code>child</code> beanæ—¶ï¼Œç”Ÿæˆçš„å®ä¾‹æœ‰ä¸€ä¸ª<code>adminEmails</code>å±æ€§é›†åˆï¼Œ å…¶å®ä¾‹ä¸­åŒ…å«çš„<code>adminEmails</code>é›†åˆå°±æ˜¯childçš„<code>adminEmails</code>ä»¥åŠparentçš„<code>adminEmails</code>é›†åˆã€‚ä»¥ä¸‹æ¸…å•æ˜¾ç¤ºäº†ç»“æœï¼š :</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">administrator</span>=administrator@example.com<br><br><span class="hljs-attr">sales</span>=sales@example.com<br><br><span class="hljs-attr">support</span>=support@example.co.uk<br></code></pre></td></tr></table></figure><p>å­<code>å±æ€§</code>é›†åˆçš„å€¼é›†ç»§æ‰¿çˆ¶<code>&lt;props/&gt;</code>çš„æ‰€æœ‰å±æ€§å…ƒç´ ï¼Œå­å€¼çš„<code>æ”¯æŒ</code>å€¼è¦†ç›–çˆ¶é›†åˆä¸­çš„å€¼ã€‚</p><p>è¿™ä¸ªåˆå¹¶çš„è¡Œä¸ºå’Œ<code>&lt;list/&gt;</code>, <code>&lt;map/&gt;</code>, å’Œ <code>&lt;set/&gt;</code>ä¹‹ç±»çš„é›†åˆç±»å‹çš„è¡Œä¸ºæ˜¯ç±»ä¼¼çš„ã€‚<code>List</code> åœ¨ç‰¹å®šä¾‹å­ä¸­ï¼Œä¸Listé›†åˆç±»å‹ç±»ä¼¼ï¼Œ æœ‰ç€éšå«çš„ <code>ordered</code>æ¦‚å¿µã€‚æ‰€æœ‰çš„çˆ¶å…ƒç´ é‡Œé¢çš„å€¼ï¼Œæ˜¯åœ¨æ‰€æœ‰å­å…ƒç´ çš„å€¼ä¹‹å‰é…ç½®çš„ã€‚ä½†æ˜¯åƒ<code>Map</code>, <code>Set</code>, å’Œ <code>Properties</code>çš„é›†åˆç±»å‹ï¼Œæ˜¯ä¸å­˜åœ¨é¡ºåºçš„ã€‚</p><h6 id="é›†åˆåˆå¹¶çš„é™åˆ¶"><a href="#é›†åˆåˆå¹¶çš„é™åˆ¶" class="headerlink" title="é›†åˆåˆå¹¶çš„é™åˆ¶"></a>é›†åˆåˆå¹¶çš„é™åˆ¶</h6><p>æ‚¨ä¸èƒ½åˆå¹¶ä¸åŒç±»å‹çš„é›†åˆï¼ˆä¾‹å¦‚è¦å°†<code>Map</code> å’Œ<code>List</code>åˆå¹¶æ˜¯ä¸å¯èƒ½çš„ï¼‰ã€‚å¦‚æœå¼€å‘è€…ç¡¬è¦è¿™æ ·åšå°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œ <code>merge</code>çš„å±æ€§æ˜¯å¿…é¡»ç‰¹æŒ‡åˆ°æ›´ä½çº§æˆ–è€…ç»§æ‰¿çš„å­èŠ‚ç‚¹å®šä¹‰ä¸Šï¼Œ ç‰¹æŒ‡mergeå±æ€§åˆ°çˆ¶é›†åˆçš„å®šä¹‰ä¸Šæ˜¯å†—ä½™çš„ï¼Œè€Œä¸”åœ¨åˆå¹¶ä¸Šä¹Ÿæ²¡æœ‰ä»»ä½•æ•ˆæœã€‚</p><h6 id="å¼ºç±»å‹çš„é›†åˆ"><a href="#å¼ºç±»å‹çš„é›†åˆ" class="headerlink" title="å¼ºç±»å‹çš„é›†åˆ"></a>å¼ºç±»å‹çš„é›†åˆ</h6><p>åœ¨Java 5ä»¥åï¼Œå¼€å‘è€…å¯ä»¥ä½¿ç”¨å¼ºç±»å‹çš„é›†åˆäº†ã€‚ä¹Ÿå°±æ˜¯ï¼Œå¼€å‘è€…å¯ä»¥å£°æ˜<code>Collection</code>ç±»å‹ï¼Œç„¶åè¿™ä¸ªé›†åˆåªåŒ…å«<code>String</code>å…ƒç´ ï¼ˆä¸¾ä¾‹æ¥è¯´ï¼‰ã€‚ å¦‚æœå¼€å‘è€…é€šè¿‡Springæ¥æ³¨å…¥å¼ºç±»å‹çš„Collectionåˆ°beanä¸­ï¼Œå¼€å‘è€…å°±å¯ä»¥åˆ©ç”¨Springçš„ç±»å‹è½¬æ¢æ”¯æŒæ¥åšåˆ° ä»¥ä¸‹Javaç±»å’Œbeanå®šä¹‰æ˜¾ç¤ºäº†å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œ:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SomeClass</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Float</span>&gt; accounts;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setAccounts</span>(<span class="hljs-params"><span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, Float&gt; accounts</span>) &#123;        <span class="hljs-variable language_">this</span>.<span class="hljs-property">accounts</span> = accounts;    &#125;&#125;<br>&lt;beans&gt;    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;something&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;x.y.SomeClass&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;accounts&quot;</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">map</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;one&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;9.99&quot;</span>/&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;two&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;2.75&quot;</span>/&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;six&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;3.99&quot;</span>/&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">map</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></span>&lt;/beans&gt;<br></code></pre></td></tr></table></figure><p>å½“<code>something</code>çš„å±æ€§<code>accounts</code>å‡†å¤‡æ³¨å…¥çš„æ—¶å€™ï¼Œaccountsçš„æ³›å‹ä¿¡æ¯Map<code>Map&lt;String, Float&gt;</code> å°±ä¼šé€šè¿‡åå°„æ‹¿åˆ°ã€‚ è¿™æ ·ï¼ŒSpringçš„ç±»å‹è½¬æ¢ç³»ç»Ÿèƒ½å¤Ÿè¯†åˆ«ä¸åŒçš„ç±»å‹ï¼Œå¦‚ä¸Šé¢çš„ä¾‹å­<code>Float</code>ç„¶åä¼šå°†å­—ç¬¦ä¸²çš„å€¼<code>9.99, 2.75</code>, å’Œ<code>3.99</code>è½¬æ¢æˆå¯¹åº”çš„<code>Float</code>ç±»å‹ã€‚</p><h5 id="Null-and-ç©ºå­—ç¬¦ä¸²"><a href="#Null-and-ç©ºå­—ç¬¦ä¸²" class="headerlink" title="Null and ç©ºå­—ç¬¦ä¸²"></a>Null and ç©ºå­—ç¬¦ä¸²</h5><p><code>Strings</code>å°†å±æ€§çš„ç©ºå‚æ•°è§†ä¸ºç©ºå­—ç¬¦ä¸²ã€‚ä¸‹é¢åŸºäºXMLçš„å…ƒæ•°æ®é…ç½®å°±ä¼šå°†<code>email</code> å±æ€§é…ç½®ä¸ºStringçš„å€¼ã€‚</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">&lt;bean <span class="hljs-keyword">class</span>=&quot;<span class="hljs-symbol">ExampleBean</span>&quot;&gt;<br><br>    &lt;<span class="hljs-symbol">property</span> <span class="hljs-symbol">name</span>=&quot;<span class="hljs-symbol">email</span>&quot; <span class="hljs-symbol">value</span>=&quot;&quot;/&gt;<br><br>&lt;/<span class="hljs-symbol">bean</span>&gt;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„ç¤ºä¾‹ç­‰æ•ˆäºä»¥ä¸‹Javaä»£ç :</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">exampleBean.setEmail(<span class="hljs-string">&quot;&quot;</span>)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p><code>&lt;null/&gt;</code>å°†è¢«å¤„ç†ä¸ºnullå€¼ã€‚ä»¥ä¸‹æ¸…å•æ˜¾ç¤ºäº†ä¸€ä¸ªç¤ºä¾‹:</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">&lt;bean <span class="hljs-keyword">class</span>=&quot;<span class="hljs-symbol">ExampleBean</span>&quot;&gt;<br><br>    &lt;<span class="hljs-symbol">property</span> <span class="hljs-symbol">name</span>=&quot;<span class="hljs-symbol">email</span>&quot;&gt;<br><br>        &lt;<span class="hljs-symbol">null</span>/&gt;<br><br>    &lt;/<span class="hljs-symbol">property</span>&gt;<br><br>&lt;/<span class="hljs-symbol">bean</span>&gt;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°é…ç½®ç­‰åŒäºä»¥ä¸‹Javaä»£ç ï¼š</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">exampleBean.setEmail(<span class="hljs-literal">null</span>);<br></code></pre></td></tr></table></figure><h5 id="ä½¿ç”¨på‘½åç©ºé—´ç®€åŒ–XMLé…ç½®"><a href="#ä½¿ç”¨på‘½åç©ºé—´ç®€åŒ–XMLé…ç½®" class="headerlink" title="ä½¿ç”¨på‘½åç©ºé—´ç®€åŒ–XMLé…ç½®"></a>ä½¿ç”¨på‘½åç©ºé—´ç®€åŒ–XMLé…ç½®</h5><p>på‘½åç©ºé—´è®©å¼€å‘è€…å¯ä»¥ä½¿ç”¨<code>bean</code>çš„å±æ€§ï¼Œè€Œä¸å¿…ä½¿ç”¨åµŒå¥—çš„<code>&lt;property/&gt;</code>å…ƒç´ ã€‚</p><p>Springæ˜¯æ”¯æŒåŸºäºXMLçš„æ ¼å¼åŒ–<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#xsd-schemas">å‘½åç©ºé—´</a>æ‰©å±•çš„ã€‚æœ¬èŠ‚è®¨è®ºçš„<code>beans</code> é…ç½®éƒ½æ˜¯åŸºäºXMLçš„ï¼Œpå‘½åç©ºé—´æ˜¯å®šä¹‰åœ¨Spring Coreä¸­çš„ï¼ˆä¸æ˜¯åœ¨XSDæ–‡ä»¶ï¼‰ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†ä¸¤ä¸ªXMLç‰‡æ®µï¼ˆç¬¬ä¸€ä¸ªä½¿ç”¨æ ‡å‡†XMLæ ¼å¼ï¼Œç¬¬äºŒä¸ªä½¿ç”¨på‘½åç©ºé—´ï¼‰ï¼Œå®ƒä»¬è§£æä¸ºç›¸åŒçš„ç»“æœï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span>    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>    <span class="hljs-attr">xmlns:p</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/p&quot;</span>    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;classic&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.example.ExampleBean&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;email&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;someone@somewhere.com&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;p-namespace&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.example.ExampleBean&quot;</span>        <span class="hljs-attr">p:email</span>=<span class="hljs-string">&quot;someone@somewhere.com&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä¾‹å­åœ¨beanä¸­å®šä¹‰äº†<code>email</code>çš„å±æ€§ã€‚è¿™ç§å®šä¹‰å‘ŠçŸ¥Springè¿™æ˜¯ä¸€ä¸ªå±æ€§å£°æ˜ã€‚å¦‚å‰é¢æ‰€æè¿°çš„ï¼Œpå‘½åç©ºé—´å¹¶æ²¡æœ‰æ ‡å‡†çš„å®šä¹‰æ¨¡å¼ï¼Œæ‰€ä»¥å¼€å‘è€…å¯ä»¥å°†å±æ€§çš„åç§°é…ç½®ä¸ºä¾èµ–åç§°ã€‚</p><p>ä¸‹ä¸€ä¸ªç¤ºä¾‹åŒ…æ‹¬å¦å¤–ä¸¤ä¸ªbeanå®šä¹‰ï¼Œå®ƒä»¬éƒ½å¼•ç”¨äº†å¦ä¸€ä¸ªbean:</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;    xmlns:p=&quot;http://www.springframework.org/schema/p&quot;    xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;&gt;<br>    &lt;bean <span class="hljs-type">name</span>=&quot;john-classic&quot; <span class="hljs-keyword">class</span>=&quot;com.example.Person&quot;&gt;        &lt;property <span class="hljs-type">name</span>=&quot;name&quot; <span class="hljs-keyword">value</span>=&quot;John Doe&quot;/&gt;        &lt;property <span class="hljs-type">name</span>=&quot;spouse&quot; <span class="hljs-keyword">ref</span>=&quot;jane&quot;/&gt;    &lt;/bean&gt;<br>    &lt;bean <span class="hljs-type">name</span>=&quot;john-modern&quot;        <span class="hljs-keyword">class</span>=&quot;com.example.Person&quot;        p:<span class="hljs-type">name</span>=&quot;John Doe&quot;        p:spouse-<span class="hljs-keyword">ref</span>=&quot;jane&quot;/&gt;<br>    &lt;bean <span class="hljs-type">name</span>=&quot;jane&quot; <span class="hljs-keyword">class</span>=&quot;com.example.Person&quot;&gt;        &lt;property <span class="hljs-type">name</span>=&quot;name&quot; <span class="hljs-keyword">value</span>=&quot;Jane Doe&quot;/&gt;    &lt;/bean&gt;&lt;/beans&gt;<br></code></pre></td></tr></table></figure><p>æ­¤ç¤ºä¾‹ä¸ä»…åŒ…å«ä½¿ç”¨på‘½åç©ºé—´çš„å±æ€§å€¼ï¼Œè¿˜ä½¿ç”¨ç‰¹æ®Šæ ¼å¼æ¥å£°æ˜å±æ€§å¼•ç”¨ã€‚ç¬¬ä¸€ä¸ªbeanå®šä¹‰ä½¿ç”¨<code>&lt;property name=&quot;spouse&quot; ref=&quot;jane&quot;/&gt;</code>æ¥åˆ›å»ºä»bean <code>john</code>åˆ°bean <code>jane</code>çš„å¼•ç”¨ï¼Œ è€Œç¬¬äºŒä¸ªbeanå®šä¹‰ä½¿ç”¨<code>p:spouse-ref=&quot;jane&quot;</code>æ¥ä½œä¸ºæŒ‡å‘beançš„å¼•ç”¨ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ <code>spouse</code>æ˜¯å±æ€§çš„åå­—ï¼Œè€Œ<code>-ref</code>éƒ¨åˆ†è¡¨åè¿™ä¸ªä¾èµ–ä¸æ˜¯ç›´æ¥çš„ç±»å‹ï¼Œè€Œæ˜¯å¼•ç”¨å¦ä¸€ä¸ªbeanã€‚</p><p>på‘½åç©ºé—´å¹¶ä¸å¦‚æ ‡å‡†XMLæ ¼å¼çµæ´»ã€‚ä¾‹å¦‚ï¼Œå£°æ˜å±æ€§çš„å¼•ç”¨å¯èƒ½å’Œä¸€äº›ä»¥<code>Ref</code>ç»“å°¾çš„å±æ€§ç›¸å†²çªï¼Œè€Œæ ‡å‡†çš„XMLæ ¼å¼å°±ä¸ä¼šã€‚Springå›¢é˜Ÿæ¨èå¼€å‘è€…èƒ½å¤Ÿå’Œå›¢é˜Ÿå•†é‡ä¸€ä¸‹ï¼Œåå•†ä½¿ç”¨å“ªä¸€ç§æ–¹å¼ï¼Œè€Œä¸è¦åŒæ—¶ä½¿ç”¨ä¸‰ç§æ–¹æ³•ã€‚</p><h5 id="ä½¿ç”¨cå‘½åç©ºé—´ç®€åŒ–XML"><a href="#ä½¿ç”¨cå‘½åç©ºé—´ç®€åŒ–XML" class="headerlink" title="ä½¿ç”¨cå‘½åç©ºé—´ç®€åŒ–XML"></a>ä½¿ç”¨cå‘½åç©ºé—´ç®€åŒ–XML</h5><p>ä¸ <a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-p-namespace">på‘½åç©ºé—´</a>ç±»ä¼¼ï¼Œcå‘½åç©ºé—´æ˜¯åœ¨Spring 3.1é¦–æ¬¡å¼•å…¥çš„ï¼Œcå‘½åç©ºé—´å…è®¸ä½¿ç”¨å†…è”çš„å±æ€§æ¥é…ç½®æ„é€ å‚æ•°è€Œä¸å¿…ä½¿ç”¨<code>constructor-arg</code> ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹ä½¿ç”¨<code>c:</code>å‘½åç©ºé—´çš„ä¾‹å­æ¥æ‰§è¡Œä¸<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-constructor-injection">åŸºäºConstructorçš„ä¾èµ–æ³¨å…¥</a>ç›¸åŒçš„æ“ä½œï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span>    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>    <span class="hljs-attr">xmlns:c</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/c&quot;</span>    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;thingOne&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;x.y.ThingTwo&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;thingTwo&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;x.y.ThingThree&quot;</span>/&gt;</span><br>    <span class="hljs-comment">&lt;!-- traditional declaration --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;thingOne&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;x.y.ThingOne&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;thingTwo&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;thingThree&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;something@somewhere.com&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- c-namespace declaration --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;thingOne&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;x.y.ThingOne&quot;</span> <span class="hljs-attr">c:thingTwo-ref</span>=<span class="hljs-string">&quot;thingTwo&quot;</span> <span class="hljs-attr">c:thingThree-ref</span>=<span class="hljs-string">&quot;thingThree&quot;</span> <span class="hljs-attr">c:email</span>=<span class="hljs-string">&quot;something@somewhere.com&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><p><code>c:</code>:å‘½åç©ºé—´ä½¿ç”¨äº†å’Œ<code>p:</code> :å‘½åç©ºé—´ç›¸ç±»ä¼¼çš„æ–¹å¼ï¼ˆä½¿ç”¨äº†<code>-ref</code> æ¥é…ç½®å¼•ç”¨).è€Œä¸”,åŒæ ·çš„,cå‘½åç©ºé—´ä¹Ÿæ˜¯å®šä¹‰åœ¨Spring Coreä¸­çš„ï¼ˆä¸æ˜¯XSDæ¨¡å¼).</p><p>åœ¨å°‘æ•°çš„ä¾‹å­ä¹‹ä¸­,æ„é€ å‡½æ•°çš„å‚æ•°åå­—å¹¶ä¸å¯ç”¨ï¼ˆé€šå¸¸,å¦‚æœå­—èŠ‚ç æ²¡æœ‰debugä¿¡æ¯çš„ç¼–è¯‘),ä½ å¯ä»¥ä½¿ç”¨å›è°ƒå‚æ•°çš„ç´¢å¼•ï¼Œå¦‚ä¸‹é¢çš„ä¾‹å­:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- c-namespace index declaration --&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;thingOne&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;x.y.ThingOne&quot;</span> <span class="hljs-attr">c:_0-ref</span>=<span class="hljs-string">&quot;thingTwo&quot;</span> <span class="hljs-attr">c:_1-ref</span>=<span class="hljs-string">&quot;thingThree&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><p>ç”±äºXMLè¯­æ³•ï¼Œç´¢å¼•è¡¨ç¤ºæ³•éœ€è¦ä½¿ç”¨<code>_</code>ä½œä¸ºå±æ€§åå­—çš„å‰ç¼€ï¼Œå› ä¸ºXMLå±æ€§åç§°ä¸èƒ½ä»¥æ•°å­—å¼€å¤´ï¼ˆå³ä½¿æŸäº›IDEå…è®¸å®ƒï¼‰ã€‚</p><p>å®é™…ä¸Šï¼Œ<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-ctor-arguments-resolution">æ„é€ å‡½æ•°è§£ææœºåˆ¶</a>åœ¨åŒ¹é…å‚æ•°æ–¹é¢éå¸¸æœ‰æ•ˆï¼Œå› æ­¤é™¤éæ‚¨ç¡®å®éœ€è¦ï¼Œå¦åˆ™æˆ‘ä»¬å»ºè®®åœ¨æ•´ä¸ªé…ç½®ä¸­ä½¿ç”¨åç§°è¡¨ç¤ºæ³•ã€‚</p><h5 id="ç»„åˆå±æ€§å"><a href="#ç»„åˆå±æ€§å" class="headerlink" title="ç»„åˆå±æ€§å"></a>ç»„åˆå±æ€§å</h5><p>å¼€å‘è€…å¯ä»¥é…ç½®æ··åˆçš„å±æ€§ï¼Œåªéœ€æ‰€æœ‰çš„ç»„ä»¶è·¯å¾„ï¼ˆé™¤äº†æœ€åä¸€ä¸ªå±æ€§åå­—ï¼‰ä¸èƒ½ä¸º<code>null</code>å³å¯ã€‚å‚è€ƒå¦‚ä¸‹å®šä¹‰ï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs abnf">&lt;bean id<span class="hljs-operator">=</span><span class="hljs-string">&quot;something&quot;</span> class<span class="hljs-operator">=</span><span class="hljs-string">&quot;things.ThingOne&quot;</span>&gt;<br><br>    &lt;property name<span class="hljs-operator">=</span><span class="hljs-string">&quot;fred.bob.sammy&quot;</span> value<span class="hljs-operator">=</span><span class="hljs-string">&quot;123&quot;</span> /&gt;<br><br>&lt;/bean&gt;<br></code></pre></td></tr></table></figure><p><code>something</code>æœ‰ <code>fred</code>çš„å±æ€§ï¼Œè€Œå…¶ä¸­<code>fred</code>å±æ€§æœ‰<code>bob</code>å±æ€§ï¼Œè€Œ<code>bob</code>å±æ€§ä¹‹ä¸­æœ‰<code>sammy</code>å±æ€§ï¼Œé‚£ä¹ˆæœ€åè¿™ä¸ª<code>sammy</code>å±æ€§ä¼šé…ç½®ä¸º123ã€‚ æƒ³è¦ä¸Šè¿°çš„é…ç½®èƒ½å¤Ÿç”Ÿæ•ˆï¼Œ<code>fred</code>å±æ€§éœ€è¦æœ‰<code>bob</code>å±æ€§è€Œä¸”åœ¨<code>fred</code>æ„é€ ä¹‹åä¸ä¸ºnullå³å¯ã€‚</p><h4 id="1-4-3-ä½¿ç”¨-depends-onå±æ€§"><a href="#1-4-3-ä½¿ç”¨-depends-onå±æ€§" class="headerlink" title="1.4.3. ä½¿ç”¨ depends-onå±æ€§"></a>1.4.3. ä½¿ç”¨ <code>depends-on</code>å±æ€§</h4><p>å¦‚æœä¸€ä¸ªbeanæ˜¯å¦ä¸€ä¸ªbeançš„ä¾èµ–ï¼Œé€šå¸¸è¿™ä¸ªbeanä¹Ÿå°±æ˜¯å¦ä¸€ä¸ªbeançš„å±æ€§ä¹‹ä¸€ã€‚å¤šæ•°æƒ…å†µä¸‹ï¼Œå¼€å‘è€…å¯ä»¥åœ¨é…ç½®XMLå…ƒæ•°æ®çš„æ—¶å€™ä½¿ç”¨<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-ref-element">&#96;&#96;</a>æ ‡ç­¾ã€‚ ç„¶è€Œï¼Œæœ‰æ—¶beanä¹‹é—´çš„ä¾èµ–ä¸æ˜¯ç›´æ¥å…³è”çš„ã€‚ä¾‹å¦‚ï¼šéœ€è¦è°ƒç”¨ç±»çš„é™æ€å®ä¾‹åŒ–å™¨æ¥è§¦å‘ä¾èµ–ï¼Œç±»ä¼¼æ•°æ®åº“é©±åŠ¨æ³¨å†Œã€‚<code>depends-on</code>å±æ€§å¯ä»¥æ˜¾å¼å¼ºåˆ¶åˆå§‹åŒ–ä¸€ä¸ªæˆ–å¤šä¸ªbeanã€‚ ä»¥ä¸‹ç¤ºä¾‹ä½¿ç”¨depends-onå±æ€§è¡¨ç¤ºå¯¹å•ä¸ªbeançš„ä¾èµ–å…³ç³»:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;bean <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;beanOne&quot;</span> <span class="hljs-attribute">class</span>=<span class="hljs-string">&quot;ExampleBean&quot;</span> <span class="hljs-attribute">depends-on</span>=<span class="hljs-string">&quot;manager&quot;</span>/&gt;<br><br>&lt;bean <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;manager&quot;</span> <span class="hljs-attribute">class</span>=<span class="hljs-string">&quot;ManagerBean&quot;</span> /&gt;<br></code></pre></td></tr></table></figure><p>å¦‚æœæƒ³è¦ä¾èµ–å¤šä¸ªbeanï¼Œå¯ä»¥æä¾›å¤šä¸ªåå­—ä½œä¸º<code>depends-on</code>çš„å€¼ã€‚ä»¥é€—å·ã€ç©ºæ ¼æˆ–è€…åˆ†å·åˆ†å‰²:</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf">&lt;bean id<span class="hljs-operator">=</span><span class="hljs-string">&quot;beanOne&quot;</span> class<span class="hljs-operator">=</span><span class="hljs-string">&quot;ExampleBean&quot;</span> depends-on<span class="hljs-operator">=</span><span class="hljs-string">&quot;manager,accountDao&quot;</span>&gt;    &lt;property name<span class="hljs-operator">=</span><span class="hljs-string">&quot;manager&quot;</span> ref<span class="hljs-operator">=</span><span class="hljs-string">&quot;manager&quot;</span> /&gt;&lt;/bean&gt;<br>&lt;bean id<span class="hljs-operator">=</span><span class="hljs-string">&quot;manager&quot;</span> class<span class="hljs-operator">=</span><span class="hljs-string">&quot;ManagerBean&quot;</span> /&gt;&lt;bean id<span class="hljs-operator">=</span><span class="hljs-string">&quot;accountDao&quot;</span> class<span class="hljs-operator">=</span><span class="hljs-string">&quot;x.y.jdbc.JdbcAccountDao&quot;</span> /&gt;<br></code></pre></td></tr></table></figure><p><code>depends-on</code>å±æ€§æ—¢å¯ä»¥æŒ‡å®šåˆå§‹åŒ–æ—¶é—´ä¾èµ–æ€§ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå•ç‹¬çš„beanï¼Œç›¸åº”çš„é”€æ¯æ—¶é—´çš„ä¾èµ–ã€‚ç‹¬ç«‹å®šä¹‰äº†<code>depends-on</code>å±æ€§çš„beanä¼šä¼˜å…ˆé”€æ¯ ï¼ˆç›¸å¯¹äº<code>depends-on</code>çš„beané”€æ¯ï¼Œè¿™æ ·<code>depends-on</code>å¯ä»¥æ§åˆ¶é”€æ¯çš„é¡ºåºã€‚</p><h4 id="1-4-4-æ‡’åŠ è½½Bean"><a href="#1-4-4-æ‡’åŠ è½½Bean" class="headerlink" title="1.4.4. æ‡’åŠ è½½Bean"></a>1.4.4. æ‡’åŠ è½½Bean</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ <code>ApplicationContext</code> ä¼šåœ¨å®ä¾‹åŒ–çš„è¿‡ç¨‹ä¸­åˆ›å»ºå’Œé…ç½®æ‰€æœ‰çš„å•ä¾‹<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-scopes-singleton">singleton</a> beanã€‚æ€»çš„æ¥è¯´ï¼Œ è¿™ä¸ªé¢„åˆå§‹åŒ–æ˜¯å¾ˆä¸é”™çš„ã€‚å› ä¸ºè¿™æ ·èƒ½åŠæ—¶å‘ç°ç¯å¢ƒä¸Šçš„ä¸€äº›é…ç½®é”™è¯¯ï¼Œè€Œä¸æ˜¯ç³»ç»Ÿè¿è¡Œäº†å¾ˆä¹…ä¹‹åæ‰å‘ç°ã€‚å¦‚æœè¿™ä¸ªè¡Œä¸ºä¸æ˜¯è¿«åˆ‡éœ€è¦çš„ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡å°†Beanæ ‡è®°ä¸ºå»¶è¿ŸåŠ è½½å°±èƒ½é˜»æ­¢è¿™ä¸ªé¢„åˆå§‹åŒ– æ‡’åŠ è½½beanä¼šé€šçŸ¥IoCä¸è¦è®©beané¢„åˆå§‹åŒ–è€Œæ˜¯åœ¨è¢«å¼•ç”¨çš„æ—¶å€™æ‰ä¼šå®ä¾‹åŒ–ã€‚</p><p>åœ¨XMLä¸­ï¼Œæ­¤è¡Œä¸ºç”±<code>&lt;bean/&gt;</code>å…ƒç´ ä¸Šçš„<code>lazy-init</code> å±æ€§æ§åˆ¶ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;bean <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;lazy&quot;</span> <span class="hljs-attribute">class</span>=<span class="hljs-string">&quot;com.something.ExpensiveToCreateBean&quot;</span> <span class="hljs-attribute">lazy-init</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;<br><br>&lt;bean <span class="hljs-attribute">name</span>=<span class="hljs-string">&quot;not.lazy&quot;</span> <span class="hljs-attribute">class</span>=<span class="hljs-string">&quot;com.something.AnotherBean&quot;</span>/&gt;<br></code></pre></td></tr></table></figure><p>å½“å°†beané…ç½®ä¸ºä¸Šè¿°XMLçš„æ—¶å€™ï¼Œ <code>ApplicationContext</code>ä¹‹ä¸­çš„<code>lazy</code> beanæ˜¯ä¸ä¼šéšç€ <code>ApplicationContext</code>çš„å¯åŠ¨è€Œè¿›å…¥åˆ°é¢„åˆå§‹åŒ–çŠ¶æ€çš„ã€‚ åªæœ‰é‚£äº›éå»¶è¿ŸåŠ è½½çš„beanæ˜¯å¤„äºé¢„åˆå§‹åŒ–çš„çŠ¶æ€çš„ã€‚</p><p>ç„¶è€Œï¼Œå¦‚æœå»¶è¿ŸåŠ è½½çš„ç±»æ˜¯ä½œä¸ºå•ä¾‹éå»¶è¿ŸåŠ è½½çš„beançš„ä¾èµ–è€Œå­˜åœ¨çš„è¯ï¼Œ<code>ApplicationContext</code>ä»ç„¶ä¼šåœ¨<code>ApplicationContext</code>å¯åŠ¨çš„æ—¶å€™åŠ è½½ã€‚ å› ä¸ºä½œä¸ºå•ä¾‹beançš„ä¾èµ–ï¼Œä¼šéšç€å•ä¾‹beançš„å®ä¾‹åŒ–è€Œå®ä¾‹åŒ–ã€‚</p><p>æ‚¨è¿˜å¯ä»¥ä½¿ç”¨<code>&lt;beans/&gt;</code>å…ƒç´ ä¸Šçš„<code>default-lazy-init</code>å±æ€§åœ¨å®¹å™¨çº§åˆ«æ§åˆ¶å»¶è¿Ÿåˆå§‹åŒ–ï¼Œä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">default-lazy-init</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- no beans will be pre-instantiated... --&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="1-4-5-è‡ªåŠ¨è£…é…"><a href="#1-4-5-è‡ªåŠ¨è£…é…" class="headerlink" title="1.4.5. è‡ªåŠ¨è£…é…"></a>1.4.5. è‡ªåŠ¨è£…é…</h4><p>Springå®¹å™¨å¯ä»¥æ ¹æ®beanä¹‹é—´çš„ä¾èµ–å…³ç³»è‡ªåŠ¨è£…é…ï¼Œå¼€å‘è€…å¯ä»¥è®©Springé€šè¿‡<code>ApplicationContext</code>æ¥è‡ªåŠ¨è§£æè¿™äº›å…³è”ï¼Œè‡ªåŠ¨è£…è½½æœ‰å¾ˆå¤šä¼˜ç‚¹:</p><ul><li>è‡ªåŠ¨è£…è½½èƒ½å¤Ÿæ˜æ˜¾çš„å‡å°‘æŒ‡å®šçš„å±æ€§æˆ–è€…æ˜¯æ„é€ å‚æ•°ã€‚ï¼ˆåœ¨æœ¬ç« <a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-child-bean-definitions">å…¶ä»–åœ°æ–¹è®¨è®º</a>çš„å…¶ä»–æœºåˆ¶ï¼Œå¦‚beanæ¨¡æ¿ï¼Œåœ¨è¿™æ–¹é¢ä¹Ÿå¾ˆæœ‰ä»·å€¼ã€‚ï¼‰</li><li>è‡ªåŠ¨è£…è½½å¯ä»¥æ‰©å±•å¼€å‘è€…çš„å¯¹è±¡ï¼Œæ¯”å¦‚è¯´ï¼Œå¦‚æœå¼€å‘è€…éœ€è¦åŠ ä¸€ä¸ªä¾èµ–ï¼Œåªéœ€å…³å¿ƒå¦‚ä½•æ›´æ”¹é…ç½®å³å¯è‡ªåŠ¨æ»¡è¶³ä¾èµ–å…³è”ã€‚è¿™æ ·ï¼Œè‡ªåŠ¨è£…è½½åœ¨å¼€å‘è¿‡ç¨‹ä¸­æ˜¯æå…¶é«˜æ•ˆçš„ï¼Œæ— éœ€æ˜ç¡®é€‰æ‹©è£…è½½çš„ä¾èµ–ä¼šä½¿ç³»ç»Ÿæ›´åŠ ç¨³å®š</li></ul><p>ä½¿ç”¨åŸºäºXMLçš„é…ç½®å…ƒæ•°æ®ï¼ˆè¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-collaborators">ä¾èµ–æ³¨å…¥</a>ï¼‰æ—¶ï¼Œå¯ä»¥ä½¿ç”¨<code>&lt;bean/&gt;</code> å…ƒç´ çš„<code>autowire</code>å±æ€§ä¸ºbeanå®šä¹‰æŒ‡å®šautowireæ¨¡å¼ã€‚ è‡ªåŠ¨è£…é…åŠŸèƒ½æœ‰å››ç§æ–¹å¼ã€‚å¼€å‘è€…å¯ä»¥æŒ‡å®šæ¯ä¸ªbeançš„è£…é…æ–¹å¼ï¼Œè¿™æ ·beanå°±çŸ¥é“å¦‚ä½•åŠ è½½è‡ªå·±çš„ä¾èµ–ã€‚ä¸‹è¡¨æè¿°äº†å››ç§è‡ªåŠ¨è£…é…æ¨¡å¼ï¼š</p><p>Table 2. è£…é…æ¨¡å¼</p><table><thead><tr><th>æ¨¡å¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>no</code></td><td>(é»˜è®¤) ä¸è‡ªåŠ¨è£…é…ã€‚Beanå¼•ç”¨å¿…é¡»ç”± <code>ref</code> å…ƒç´ å®šä¹‰ï¼Œå¯¹äºæ¯”è¾ƒå¤§çš„é¡¹ç›®çš„éƒ¨ç½²ï¼Œä¸å»ºè®®ä¿®æ”¹é»˜è®¤çš„é…ç½® ï¼Œå› ä¸ºæ˜ç¡®æŒ‡å®šåä½œè€…å¯ä»¥æä¾›æ›´å¥½çš„æ§åˆ¶å’Œæ¸…æ™°åº¦ã€‚åœ¨æŸç§ç¨‹åº¦ä¸Šï¼Œå®ƒè®°å½•äº†ç³»ç»Ÿçš„ç»“æ„ã€‚</td></tr><tr><td><code>byName</code></td><td>æŒ‰å±æ€§åç§°è‡ªåŠ¨è£…é…ã€‚ SpringæŸ¥æ‰¾ä¸éœ€è¦è‡ªåŠ¨è£…é…çš„å±æ€§åŒåçš„beanã€‚ ä¾‹å¦‚ï¼Œå¦‚æœbeané…ç½®ä¸ºæ ¹æ®åå­—è£…é…ï¼Œä»–åŒ…å« çš„å±æ€§åå­—ä¸º<code>master</code>ï¼ˆå³ï¼Œå®ƒå…·æœ‰<code>setMaster(..)</code>æ–¹æ³•ï¼‰ï¼Œåˆ™Springä¼šæŸ¥æ‰¾åä¸º <code>master</code> çš„beanå®šä¹‰å¹¶ä½¿ç”¨å®ƒæ¥è®¾ç½®å±æ€§ã€‚</td></tr><tr><td><code>byType</code></td><td>å¦‚æœéœ€è¦è‡ªåŠ¨è£…é…çš„å±æ€§çš„ç±»å‹åœ¨å®¹å™¨ä¸­åªå­˜åœ¨ä¸€ä¸ªçš„è¯ï¼Œä»–å…è®¸è‡ªåŠ¨è£…é…ã€‚å¦‚æœå­˜åœ¨å¤šä¸ªï¼Œåˆ™æŠ›å‡ºè‡´å‘½å¼‚å¸¸ï¼Œè¿™è¡¨ç¤ºæ‚¨ä¸èƒ½å¯¹è¯¥beanä½¿ç”¨<code>byType</code>è‡ªåŠ¨è£…é…ã€‚ å¦‚æœæ²¡æœ‰åŒ¹é…çš„beanï¼Œåˆ™ä¸ä¼šå‘ç”Ÿä»»ä½•äº‹æƒ…ï¼ˆæœªè®¾ç½®è¯¥å±æ€§ï¼‰ã€‚</td></tr><tr><td><code>constructor</code></td><td>ç±»ä¼¼äº<code>byType</code>ï¼Œä½†åº”ç”¨äºæ„é€ å‡½æ•°å‚æ•°ã€‚ å¦‚æœå®¹å™¨ä¸­æ²¡æœ‰ä¸€ä¸ªBeançš„ç±»å‹å’Œæ„é€ å‡½æ•°å‚æ•°ç±»å‹ä¸€è‡´çš„è¯ï¼Œåˆ™ä¼šå¼•å‘è‡´å‘½é”™è¯¯ã€‚</td></tr></tbody></table><p>é€šè¿‡<code>byType</code>æˆ–è€…<code>constructor</code>çš„è‡ªåŠ¨è£…é…æ–¹å¼ï¼Œå¼€å‘è€…å¯ä»¥è£…è½½æ•°ç»„å’Œå¼ºç±»å‹é›†åˆã€‚åœ¨è¿™æ ·çš„ä¾‹å­ä¸­ï¼Œæ‰€æœ‰å®¹å™¨ä¸­çš„åŒ¹é…äº†æŒ‡å®šç±»å‹çš„beanéƒ½ä¼šè‡ªåŠ¨è£…é…åˆ°beanä¸Šæ¥å®Œæˆä¾èµ–æ³¨å…¥ã€‚ å¼€å‘è€…å¯ä»¥è‡ªåŠ¨è£…é…keyä¸º<code>String</code>.çš„å¼ºç±»å‹çš„ <code>Map</code> ã€‚è‡ªåŠ¨è£…é…çš„Mapå€¼ä¼šåŒ…å«æ‰€æœ‰çš„beanå®ä¾‹å€¼æ¥åŒ¹é…æŒ‡å®šçš„ç±»å‹ï¼Œ<code>Map</code>çš„keyä¼šåŒ…å«å…³è”çš„beançš„åå­—ã€‚</p><h5 id="è‡ªåŠ¨è£…é…çš„å±€é™å’Œç¼ºç‚¹"><a href="#è‡ªåŠ¨è£…é…çš„å±€é™å’Œç¼ºç‚¹" class="headerlink" title="è‡ªåŠ¨è£…é…çš„å±€é™å’Œç¼ºç‚¹"></a>è‡ªåŠ¨è£…é…çš„å±€é™å’Œç¼ºç‚¹</h5><p>è‡ªåŠ¨è£…é…åœ¨é¡¹ç›®ä¸­ä¸€è‡´ä½¿ç”¨æ—¶æ•ˆæœæœ€ä½³ã€‚å¦‚æœä¸€èˆ¬ä¸ä½¿ç”¨è‡ªåŠ¨è£…é…ï¼Œé‚£ä¹ˆå¼€å‘äººå‘˜ä½¿ç”¨å®ƒæ¥è£…é…ä¸€ä¸ªæˆ–ä¸¤ä¸ªbeanå®šä¹‰å¯èƒ½ä¼šè®©äººæ„Ÿåˆ°å›°æƒ‘ã€‚</p><p>è€ƒè™‘è‡ªåŠ¨è£…é…çš„å±€é™å’Œç¼ºç‚¹:</p><ul><li><code>property</code>å’Œ<code>constructor-arg</code>è®¾ç½®ä¸­çš„æ˜¾å¼ä¾èµ–é¡¹å§‹ç»ˆè¦†ç›–è‡ªåŠ¨è£…é…ã€‚å¼€å‘è€…ä¸èƒ½è‡ªåŠ¨è£…é…ä¸€äº›ç®€å•å±æ€§ï¼Œæ‚¨ä¸èƒ½è‡ªåŠ¨è£…é…ç®€å•å±æ€§ï¼Œä¾‹å¦‚åŸºæœ¬ç±»å‹ ï¼Œå­—ç¬¦ä¸²å’Œç±»ï¼ˆä»¥åŠæ­¤ç±»ç®€å•å±æ€§çš„æ•°ç»„ï¼‰ã€‚è¿™ç§é™åˆ¶æ˜¯æŒ‰è®¾è®¡çš„ã€‚</li><li>è‡ªåŠ¨è£…é…æ¯”æ˜¾å¼çš„é…ç½®æ›´å®¹æ˜“æ­§ä¹‰ï¼Œå°½ç®¡ä¸Šè¡¨è¡¨æ˜äº†ä¸åŒè‡ªåŠ¨é…ç½®çš„ç‰¹ç‚¹ï¼ŒSpringä¹Ÿä¼šå°½å¯èƒ½é¿å…ä¸å¿…è¦çš„è£…é…é”™è¯¯ã€‚ä½†æ˜¯Springç®¡ç†çš„å¯¹è±¡å…³ç³»ä»ç„¶ä¸å¦‚æ˜¾å¼é…ç½®é‚£æ ·æ˜ç¡®ã€‚</li><li>ä»Springå®¹å™¨ç”Ÿæˆæ–‡æ¡£çš„å·¥å…·å¯èƒ½æ— æ³•æœ‰æ•ˆçš„æä¾›è£…é…ä¿¡æ¯ã€‚</li><li>å®¹å™¨ä¸­çš„å¤šä¸ªbeanå®šä¹‰å¯èƒ½ä¸setteræ–¹æ³•æˆ–æ„é€ å‡½æ•°å‚æ•°æ‰€æŒ‡å®šçš„ç±»å‹ç›¸åŒ¹é…ï¼Œ è¿™æœ‰åˆ©äºè‡ªåŠ¨è£…é…ã€‚å¯¹äºarrays, collections, or <code>Map</code>å®ä¾‹æ¥è¯´è¿™ä¸æ˜¯é—®é¢˜ã€‚ä½†æ˜¯å¦‚æœæ˜¯å¯¹åªæœ‰ä¸€ä¸ªä¾èµ–é¡¹çš„å€¼æ˜¯æœ‰æ­§ä¹‰çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ªé¡¹æ˜¯æ— æ³•è§£æçš„ã€‚å¦‚æœæ²¡æœ‰å”¯ä¸€çš„beanï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</li></ul><p>åœ¨åé¢çš„åœºæ™¯ï¼Œä½ å¯æœ‰å¦‚ä¸‹çš„é€‰æ‹©ï¼š</p><ul><li>æ”¾å¼ƒè‡ªåŠ¨è£…é…ï¼Œæ”¹ç”¨æ˜¾å¼çš„é…ç½®ã€‚</li><li>é€šè¿‡å°†<code>autowire-candidate</code> å±æ€§è®¾ç½®ä¸º<code>false</code>ï¼Œé¿å…å¯¹beanå®šä¹‰è¿›è¡Œè‡ªåŠ¨è£…é…ï¼Œ<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-autowire-candidate">å¦‚ä¸‹ä¸€èŠ‚æ‰€è¿°</a>ã€‚</li><li>é€šè¿‡å°†å…¶<code>&lt;bean/&gt;</code> å…ƒç´ çš„<code>primary</code>å±æ€§è®¾ç½®ä¸º <code>true</code>ï¼Œå°†å•ä¸ªbeanå®šä¹‰æŒ‡å®šä¸ºä¸»è¦å€™é€‰é¡¹ã€‚</li><li>ä½¿ç”¨åŸºäºæ³¨è§£çš„é…ç½®å®ç°æ›´ç»†ç²’åº¦çš„æ§åˆ¶ï¼Œå¦‚<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-annotation-config">åŸºäºæ³¨è§£çš„å®¹å™¨é…ç½®</a>ä¸­æ‰€è¿°ã€‚</li></ul><h5 id="å°†beanä»è‡ªåŠ¨è£…é…ä¸­æ’é™¤"><a href="#å°†beanä»è‡ªåŠ¨è£…é…ä¸­æ’é™¤" class="headerlink" title="å°†beanä»è‡ªåŠ¨è£…é…ä¸­æ’é™¤"></a>å°†beanä»è‡ªåŠ¨è£…é…ä¸­æ’é™¤</h5><p>åœ¨æ¯ä¸ªbeançš„åŸºç¡€ä¸Šï¼Œæ‚¨å¯ä»¥ä»è‡ªåŠ¨è£…é…ä¸­æ’é™¤beanã€‚ åœ¨Springçš„XMLæ ¼å¼ä¸­ï¼Œå°†<code>&lt;bean/&gt;</code> å…ƒç´ çš„<code>autowire-candidate</code> å±æ€§è®¾ç½®ä¸º<code>false</code>ã€‚ å®¹å™¨ä½¿ç‰¹å®šçš„beanå®šä¹‰å¯¹è‡ªåŠ¨è£…é…åŸºç¡€ç»“æ„ä¸å¯ç”¨ï¼ˆåŒ…æ‹¬æ³¨è§£æ ·å¼é…ç½®ï¼Œå¦‚<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-autowired-annotation"><code>@Autowired</code></a>ï¼‰ã€‚</p><p><code>autowire-candidate</code> å±æ€§æ—¨åœ¨ä»…å½±å“åŸºäºç±»å‹çš„è‡ªåŠ¨è£…é…ã€‚ å®ƒä¸ä¼šå½±å“åç§°çš„æ˜¾å¼å¼•ç”¨ï¼Œå³ä½¿æŒ‡å®šçš„beanæœªæ ‡è®°ä¸ºautowireå€™é€‰ï¼Œä¹Ÿä¼šè§£æå®ƒã€‚ å› æ­¤ï¼Œå¦‚æœåç§°åŒ¹é…ï¼Œåˆ™æŒ‰åç§°è‡ªåŠ¨è£…é…ä¼šæ³¨å…¥beanã€‚</p><p>å¼€å‘è€…å¯ä»¥é€šè¿‡æ¨¡å¼åŒ¹é…è€Œä¸æ˜¯Beançš„åå­—æ¥é™åˆ¶è‡ªåŠ¨è£…é…çš„å€™é€‰è€…ã€‚æœ€ä¸Šå±‚çš„<code>&lt;beans/&gt;</code> å…ƒç´ ä¼šåœ¨<code>default-autowire-candidates</code> å±æ€§ä¸­æ¥é…ç½®å¤šç§æ¨¡å¼ã€‚ ä¾‹å¦‚ï¼Œé™åˆ¶è‡ªåŠ¨è£…é…å€™é€‰è€…çš„åå­—ä»¥<code>Repository</code>ç»“å°¾ï¼Œå¯ä»¥é…ç½®æˆ<code>*Repository</code>ã€‚å¦‚æœéœ€è¦é…ç½®å¤šç§æ¨¡å¼ï¼Œåªéœ€è¦ç”¨é€—å·åˆ†éš”å¼€å³å¯ã€‚ beanå®šä¹‰çš„<code>autowire-candidate</code>å±æ€§çš„æ˜¾å¼å€¼<code>true</code> æˆ–<code>false</code>å§‹ç»ˆä¼˜å…ˆã€‚ å¯¹äºæ­¤ç±»beanï¼Œæ¨¡å¼åŒ¹é…è§„åˆ™ä¸é€‚ç”¨ã€‚</p><p>ä¸Šé¢çš„è¿™äº›æŠ€æœ¯åœ¨é…ç½®é‚£äº›æ— éœ€è‡ªåŠ¨è£…é…çš„beanæ˜¯ç›¸å½“æœ‰æ•ˆçš„ï¼Œå½“ç„¶è¿™å¹¶ä¸æ˜¯è¯´è¿™ç±»beanæœ¬èº«æ— æ³•è‡ªåŠ¨è£…é…å…¶ä»–çš„beanã€‚è€Œæ˜¯è¯´è¿™äº›beanä¸å†ä½œä¸ºè‡ªåŠ¨è£…é…çš„ä¾èµ–å€™é€‰è€…ã€‚</p><h4 id="1-4-6-æ–¹æ³•æ³¨å…¥"><a href="#1-4-6-æ–¹æ³•æ³¨å…¥" class="headerlink" title="1.4.6.æ–¹æ³•æ³¨å…¥"></a>1.4.6.æ–¹æ³•æ³¨å…¥</h4><p>åœ¨å¤§å¤šæ•°çš„åº”ç”¨åœºæ™¯ä¸‹ï¼Œå¤šæ•°çš„beanéƒ½æ˜¯<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-scopes-singleton">å•ä¾‹</a>çš„ã€‚å½“è¿™ä¸ªå•ä¾‹çš„beanéœ€è¦å’Œå¦ä¸€ä¸ªå•ä¾‹çš„æˆ–è€…éå•ä¾‹çš„beanåä½œä½¿ç”¨çš„æ—¶å€™ï¼Œå¼€å‘è€…åªéœ€è¦é…ç½®ä¾èµ–beanä¸ºè¿™ä¸ªbeançš„å±æ€§å³å¯ã€‚ ä½†æ˜¯æœ‰æ—¶ä¼šå› ä¸ºbeanå…·æœ‰ä¸åŒçš„ç”Ÿå‘½å‘¨æœŸè€Œäº§ç”Ÿé—®é¢˜ã€‚å‡è®¾å•ä¾‹çš„bean Aåœ¨æ¯ä¸ªæ–¹æ³•è°ƒç”¨ä¸­ä½¿ç”¨äº†éå•ä¾‹çš„bean Bã€‚å®¹å™¨åªä¼šåˆ›å»ºbean Aä¸€æ¬¡ï¼Œè€Œåªæœ‰ä¸€ä¸ªæœºä¼šæ¥é…ç½®å±æ€§ã€‚ é‚£ä¹ˆå®¹å™¨å°±æ— æ³•ä¸ºæ¯ä¸€æ¬¡åˆ›å»ºbean Aæ—¶éƒ½æä¾›æ–°çš„bean Bå®ä¾‹ã€‚</p><p>ä¸€ç§è§£å†³æ–¹æ¡ˆå°±æ˜¯æ”¾å¼ƒIoCï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡å®ç°<code>ApplicationContextAware</code>æ¥å£è®©<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-aware">bean Aå¯¹ApplicationContext</a>å¯è§ã€‚ ä»è€Œé€šè¿‡è°ƒç”¨<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-client"><code>getBean(&quot;B&quot;)</code></a>æ¥åœ¨bean A éœ€è¦æ–°çš„å®ä¾‹çš„æ—¶å€™æ¥è·å–åˆ°æ–°çš„Bå®ä¾‹ã€‚å‚è€ƒä¸‹é¢ä¾‹å­ã€‚</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">// a <span class="hljs-keyword">class</span> that uses a stateful Command-style <span class="hljs-keyword">class</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">perform</span> <span class="hljs-keyword">some</span> processingpackage fiona.apple;<br>// Spring-API importsimport org.springframework.beans.BeansException;<span class="hljs-keyword">import</span> org.springframework.context.ApplicationContext;<span class="hljs-keyword">import</span> org.springframework.context.ApplicationContextAware;<br><span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> CommandManager implements ApplicationContextAware &#123;<br>    private ApplicationContext applicationContext;<br>    <span class="hljs-built_in">public</span> <span class="hljs-keyword">Object</span> process(Map commandState) &#123;        // grab a <span class="hljs-built_in">new</span> instance <span class="hljs-keyword">of</span> the appropriate Command        Command command = createCommand();        // <span class="hljs-keyword">set</span> the state <span class="hljs-keyword">on</span> the (hopefully brand <span class="hljs-built_in">new</span>) Command instance        command.setState(commandState);        <span class="hljs-keyword">return</span> command.<span class="hljs-keyword">execute</span>();    &#125;<br>    protected Command createCommand() &#123;        // <span class="hljs-keyword">notice</span> the Spring API dependency!        <span class="hljs-keyword">return</span> this.applicationContext.getBean(&quot;command&quot;, Command.<span class="hljs-keyword">class</span>);    &#125;<br>    <span class="hljs-built_in">public</span> <span class="hljs-type">void</span> setApplicationContext(            ApplicationContext applicationContext) throws BeansException &#123;        this.applicationContext = applicationContext;    &#125;&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç å¹¶ä¸è®©äººååˆ†æ»¡æ„ï¼Œå› ä¸ºä¸šåŠ¡çš„ä»£ç å·²ç»ä¸Springæ¡†æ¶è€¦åˆåœ¨ä¸€èµ·ã€‚æ–¹æ³•æ³¨å…¥æ˜¯Spring IoCå®¹å™¨çš„ä¸€ä¸ªé«˜çº§åŠŸèƒ½ï¼Œå¯ä»¥è®©æ‚¨å¤„ç†è¿™ç§é—®é¢˜ã€‚ Springæä¾›äº†ä¸€ä¸ªç¨å¾®é«˜çº§çš„æ³¨å…¥æ–¹å¼æ¥å¤„ç†è¿™ç§é—®é¢˜</p><p>æ‚¨å¯ä»¥åœ¨æ­¤<a href="https://spring.io/blog/2004/08/06/method-injection/">åšå®¢æ¡ç›®</a>ä¸­é˜…è¯»æœ‰å…³æ–¹æ³•æ³¨å…¥çš„æ›´å¤šä¿¡æ¯ã€‚</p><h5 id="æŸ¥æ‰¾æ–¹æ³•æ³¨å…¥"><a href="#æŸ¥æ‰¾æ–¹æ³•æ³¨å…¥" class="headerlink" title="æŸ¥æ‰¾æ–¹æ³•æ³¨å…¥"></a>æŸ¥æ‰¾æ–¹æ³•æ³¨å…¥</h5><p>æŸ¥æ‰¾æ–¹æ³•æ³¨å…¥æ˜¯å®¹å™¨è¦†ç›–ç®¡ç†beanä¸Šçš„æ–¹æ³•çš„èƒ½åŠ›ï¼Œä»¥ä¾¿è¿”å›å®¹å™¨ä¸­å¦ä¸€ä¸ªå‘½åbeançš„æŸ¥æ‰¾ç»“æœã€‚æŸ¥æ‰¾æ–¹æ³•é€šå¸¸æ¶‰åŠåŸå‹beanï¼Œ<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-method-injection">å¦‚å‰é¢æè¿°çš„åœºæ™¯</a>ã€‚ Springæ¡†æ¶é€šè¿‡ä½¿ç”¨CGLIBåº“ç”Ÿæˆçš„å­—èŠ‚ç æ¥ç”ŸæˆåŠ¨æ€å­ç±»é‡å†™çš„æ–¹æ³•å®ç°æ­¤æ³¨å…¥ã€‚</p><ul><li>å¦‚æœæƒ³è®©è¿™ä¸ªåŠ¨æ€å­ç±»æ­£å¸¸å·¥ä½œï¼Œé‚£ä¹ˆSpringå®¹å™¨æ‰€ç»§æ‰¿çš„Beanä¸èƒ½æ˜¯<code>final</code>çš„ï¼Œè€Œè¦†ç›–çš„æ–¹æ³•ä¹Ÿä¸èƒ½æ˜¯<code>final</code>çš„ã€‚</li><li>å¯¹å…·æœ‰<code>æŠ½è±¡</code>æ–¹æ³•çš„ç±»è¿›è¡Œå•å…ƒæµ‹è¯•æ—¶ï¼Œéœ€è¦å¼€å‘è€…å¯¹ç±»è¿›è¡Œå­ç±»åŒ–ï¼Œå¹¶æä¾›<code>æŠ½è±¡</code>æ–¹æ³•çš„å…·ä½“å®ç°ã€‚</li><li>ç»„ä»¶æ‰«æä¹Ÿéœ€è¦å…·ä½“çš„æ–¹æ³•ï¼Œå› ä¸ºå®ƒéœ€è¦è·å–å…·ä½“çš„ç±»ã€‚</li><li>å¦ä¸€ä¸ªå…³é”®é™åˆ¶æ˜¯æŸ¥æ‰¾æ–¹æ³•ä¸é€‚ç”¨äºå·¥å‚æ–¹æ³•ï¼Œç‰¹åˆ«æ˜¯åœ¨é…ç½®ç±»ä¸­ä¸ä½¿ç”¨<code>@Bean</code>çš„æ–¹æ³•ã€‚å› ä¸ºåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®¹å™¨ä¸è´Ÿè´£åˆ›å»ºå®ä¾‹ï¼Œå› æ­¤ä¸èƒ½åœ¨è¿è¡Œæ—¶åˆ›å»ºè¿è¡Œæ—¶ç”Ÿæˆçš„å­ç±»ã€‚</li></ul><p>å¯¹äºå‰é¢ä»£ç ç‰‡æ®µä¸­çš„<code>CommandManager</code>ç±»ï¼ŒSpringå®¹å™¨åŠ¨æ€åœ°è¦†ç›–<code>createCommand()</code>æ–¹æ³•çš„å®ç°ã€‚ <code>CommandManager</code>ç±»ä¸å†æ‹¥æœ‰ä»»ä½•çš„Springä¾èµ–ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs smali">package fiona.apple;<br>// no more Spring imports!<span class="hljs-keyword"></span><br><span class="hljs-keyword">public</span><span class="hljs-keyword"> abstract</span> class CommandManager &#123;<br>   <span class="hljs-keyword"> public</span> Object process(Object commandState) &#123;        // grab a<span class="hljs-built_in"> new </span>instance of the appropriate Command interface        Command command = createCommand();        // set the state on the (hopefully brand new) Command<span class="hljs-built_in"> instance </span>       command.setState(commandState);       <span class="hljs-built_in"> return </span>command.execute();    &#125;<br>    // okay... but where is the implementation of this method?   <span class="hljs-keyword"> protected</span><span class="hljs-keyword"> abstract</span> Command createCommand();&#125;<br></code></pre></td></tr></table></figure><p>åœ¨åŒ…å«éœ€è¦æ³¨å…¥æ–¹æ³•çš„å®¢æˆ·ç«¯ç±»ä¸­ (åœ¨æœ¬ä¾‹ä¸­ä¸º<code>CommandManager</code>ï¼‰æ³¨å…¥æ–¹æ³•çš„ç­¾åéœ€è¦å¦‚ä¸‹å½¢å¼ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs typescript">&lt;<span class="hljs-keyword">public</span>|<span class="hljs-keyword">protected</span>&gt; [<span class="hljs-keyword">abstract</span>] &lt;<span class="hljs-keyword">return</span>-<span class="hljs-keyword">type</span>&gt; <span class="hljs-title function_">theMethodName</span>(no-<span class="hljs-variable language_">arguments</span>);<br></code></pre></td></tr></table></figure><p>å¦‚æœæ–¹æ³•æ˜¯<code>abstract</code>çš„ï¼Œ é‚£ä¹ˆåŠ¨æ€ç”Ÿæˆçš„å­ç±»ä¼šå®ç°è¯¥æ–¹æ³•ã€‚å¦åˆ™ï¼ŒåŠ¨æ€ç”Ÿæˆçš„å­ç±»å°†è¦†ç›–åŸå§‹ç±»å®šä¹‰çš„å…·ä½“æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- a stateful bean deployed as a prototype (non-singleton) --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;myCommand&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;fiona.apple.AsyncCommand&quot;</span> <span class="hljs-attr">scope</span>=<span class="hljs-string">&quot;prototype&quot;</span>&gt;</span>    <span class="hljs-comment">&lt;!-- inject dependencies here as required --&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-comment">&lt;!-- commandProcessor uses statefulCommandHelper --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;commandManager&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;fiona.apple.CommandManager&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">lookup-method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;createCommand&quot;</span> <span class="hljs-attr">bean</span>=<span class="hljs-string">&quot;myCommand&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å½“éœ€è¦æ–°çš„myCommand beanå®ä¾‹æ—¶ï¼Œæ ‡è¯†ä¸º<code>commandManager</code>çš„beanä¼šè°ƒç”¨è‡ªèº«çš„<code>createCommand()</code>æ–¹æ³•.å¼€å‘è€…å¿…é¡»å°å¿ƒéƒ¨ç½²<code>myCommand</code> beanä¸ºåŸå‹bean. å¦‚æœæ‰€éœ€çš„beanæ˜¯<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-scopes-singleton">å•ä¾‹</a>çš„,é‚£ä¹ˆæ¯æ¬¡éƒ½ä¼šè¿”å›ç›¸åŒçš„<code>myCommand</code> beanå®ä¾‹.</p><p>å¦å¤–,å¦‚æœæ˜¯åŸºäºæ³¨è§£çš„é…ç½®æ¨¡å¼,ä½ å¯ä»¥åœ¨æŸ¥æ‰¾æ–¹æ³•ä¸Šå®šä¹‰<code>@Lookup</code>æ³¨è§£,å¦‚ä¸‹:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CommandManager</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Object</span> <span class="hljs-title function_">process</span>(<span class="hljs-params"><span class="hljs-built_in">Object</span> commandState</span>) &#123;        <span class="hljs-title class_">Command</span> command = <span class="hljs-title function_">createCommand</span>();        command.<span class="hljs-title function_">setState</span>(commandState);        <span class="hljs-keyword">return</span> command.<span class="hljs-title function_">execute</span>();    &#125;<br>    <span class="hljs-meta">@Lookup</span>(<span class="hljs-string">&quot;myCommand&quot;</span>)    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> <span class="hljs-title class_">Command</span> <span class="hljs-title function_">createCommand</span>();&#125;<br></code></pre></td></tr></table></figure><p>æˆ–è€…ï¼Œæ›´å¸¸è§çš„æ˜¯ï¼Œå¼€å‘è€…ä¹Ÿå¯ä»¥æ ¹æ®æŸ¥æ‰¾æ–¹æ³•çš„è¿”å›ç±»å‹æ¥æŸ¥æ‰¾åŒ¹é…çš„beanï¼Œå¦‚ä¸‹</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CommandManager</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Object</span> <span class="hljs-title function_">process</span>(<span class="hljs-params"><span class="hljs-built_in">Object</span> commandState</span>) &#123;        <span class="hljs-title class_">MyCommand</span> command = <span class="hljs-title function_">createCommand</span>();        command.<span class="hljs-title function_">setState</span>(commandState);        <span class="hljs-keyword">return</span> command.<span class="hljs-title function_">execute</span>();    &#125;<br>    <span class="hljs-meta">@Lookup</span>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> <span class="hljs-title class_">MyCommand</span> <span class="hljs-title function_">createCommand</span>();&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„å¼€å‘è€…å¯ä»¥é€šè¿‡åˆ›å»ºå­ç±»å®ç°lookupæ–¹æ³•ï¼Œä»¥ä¾¿ä½¿å®ƒä»¬ä¸Springçš„ç»„ä»¶æ‰«æè§„åˆ™å…¼å®¹ï¼ŒåŒæ—¶æŠ½è±¡ç±»ä¼šåœ¨é»˜è®¤æƒ…å†µä¸‹è¢«å¿½ç•¥ã€‚è¿™ç§é™åˆ¶ä¸é€‚ç”¨äºæ˜¾å¼æ³¨å†Œbeanæˆ–æ˜ç¡®å¯¼å…¥beançš„æƒ…å†µã€‚</p><p>å¦ä¸€ç§å¯ä»¥è®¿é—®ä¸åŒç”Ÿå‘½å‘¨æœŸçš„æ–¹æ³•æ˜¯<code>ObjectFactory</code>&#x2F;<code>Provider</code>æ³¨å…¥ï¼Œå…·ä½“å‚çœ‹ <a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-scopes-other-injection">ä½œç”¨åŸŸçš„beanä¾èµ–</a></p><p>æ‚¨å¯èƒ½è¿˜ä¼šå‘ç°<code>ServiceLocatorFactoryBean</code>ï¼ˆåœ¨<code>org.springframework.beans.factory.config</code>åŒ…ä¸­ï¼‰å¾ˆæœ‰ç”¨ã€‚</p><h5 id="æ›¿æ¢ä»»æ„æ–¹æ³•"><a href="#æ›¿æ¢ä»»æ„æ–¹æ³•" class="headerlink" title="æ›¿æ¢ä»»æ„æ–¹æ³•"></a>æ›¿æ¢ä»»æ„æ–¹æ³•</h5><p>ä»å‰é¢çš„æè¿°ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“æŸ¥æ‰¾æ–¹æ³•æ˜¯æœ‰èƒ½åŠ›æ¥è¦†ç›–ä»»ä½•ç”±å®¹å™¨ç®¡ç†çš„beanæ–¹æ³•çš„ã€‚å¼€å‘è€…æœ€å¥½è·³è¿‡è¿™ä¸€éƒ¨åˆ†ï¼Œé™¤éä¸€å®šéœ€è¦ç”¨åˆ°è¿™ä¸ªåŠŸèƒ½ã€‚</p><p>é€šè¿‡åŸºäºXMLçš„å…ƒæ•°æ®é…ç½®ï¼Œå¼€å‘è€…å¯ä»¥ä½¿ç”¨<code>replaced-method</code>å…ƒç´ æ¥æ›¿æ¢å·²å­˜åœ¨æ–¹æ³•çš„å®ç°ã€‚è€ƒè™‘ä»¥ä¸‹ç±»ï¼Œå®ƒæœ‰ä¸€ä¸ªæˆ‘ä»¬æƒ³è¦è¦†ç›–çš„åä¸º<code>computeValue</code> çš„æ–¹æ³•ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyValueCalculator</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">computeValue</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> input</span>) &#123;        <span class="hljs-comment">// some real code...    &#125;</span><br>    <span class="hljs-comment">// some other methods...&#125;</span><br></code></pre></td></tr></table></figure><p>å®ç°<code>org.springframework.beans.factory.support.MethodReplacer</code>æ¥å£çš„ç±»æä¾›äº†æ–°çš„æ–¹æ³•å®šä¹‰ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs processing"><span class="hljs-comment">/** * meant to be used to override the existing computeValue(String) * implementation in MyValueCalculator */</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReplacementComputeValue</span> implements MethodReplacer &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">Object</span> <span class="hljs-title function_">reimplement</span>(<span class="hljs-built_in">Object</span> o, Method m, <span class="hljs-built_in">Object</span>[] args) <span class="hljs-keyword">throws</span> Throwable &#123;        <span class="hljs-comment">// get the input value, work with it, and return a computed result        String input = (String) args[0];        ...        return ...;    &#125;&#125;</span><br></code></pre></td></tr></table></figure><p>å¦‚æœéœ€è¦è¦†ç›–beanæ–¹æ³•çš„XMLé…ç½®å¦‚ä¸‹ç±»ä¼¼äºä»¥ä¸‹ç¤ºä¾‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;myValueCalculator&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;x.y.z.MyValueCalculator&quot;</span>&gt;</span>    <span class="hljs-comment">&lt;!-- arbitrary method replacement --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">replaced-method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;computeValue&quot;</span> <span class="hljs-attr">replacer</span>=<span class="hljs-string">&quot;replacementComputeValue&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">arg-type</span>&gt;</span>String<span class="hljs-tag">&lt;/<span class="hljs-name">arg-type</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">replaced-method</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;replacementComputeValue&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;a.b.c.ReplacementComputeValue&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><p>æ‚¨å¯ä»¥åœ¨<code>&lt;replaced-method/&gt;</code>å…ƒç´ ä¸­ä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ª <code>&lt;arg-type/&gt;</code>å…ƒç´ æ¥æŒ‡ç¤ºè¢«è¦†ç›–çš„æ–¹æ³•çš„æ–¹æ³•ã€‚å½“éœ€è¦è¦†ç›–çš„æ–¹æ³•å­˜åœ¨é‡è½½æ–¹æ³•æ—¶ï¼Œå¿…é¡»æŒ‡å®šæ‰€éœ€å‚æ•°ã€‚ ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œå­—ç¬¦ä¸²çš„ç±»å‹ä¼šåŒ¹é…ä»¥ä¸‹ç±»å‹ï¼Œå®ƒå®Œå…¨ç­‰åŒäº<code>java.lang.String</code></p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs arduino">java.lang.<span class="hljs-type">String</span><br><br><span class="hljs-type">String</span><br><br>Str<br></code></pre></td></tr></table></figure><p>å› ä¸ºï¼Œé€šå¸¸æ¥è¯´å‚æ•°çš„ä¸ªæ•°å·²ç»è¶³å¤ŸåŒºåˆ«ä¸åŒçš„æ–¹æ³•ï¼Œè¿™ç§å¿«æ·çš„å†™æ³•å¯ä»¥çœå»å¾ˆå¤šçš„ä»£ç ã€‚</p><h3 id="1-5-beançš„ä½œç”¨åŸŸ"><a href="#1-5-beançš„ä½œç”¨åŸŸ" class="headerlink" title="1.5. beançš„ä½œç”¨åŸŸ"></a>1.5. beançš„ä½œç”¨åŸŸ</h3><p>åˆ›å»ºbeanå®šä¹‰æ—¶ï¼ŒåŒæ—¶ä¹Ÿä¼šå®šä¹‰è¯¥å¦‚ä½•åˆ›å»ºBeanå®ä¾‹ã€‚ è¿™äº›å…·ä½“åˆ›å»ºçš„è¿‡ç¨‹æ˜¯å¾ˆé‡è¦çš„ï¼Œå› ä¸ºåªæœ‰é€šè¿‡å¯¹è¿™äº›é…ç½®è¿‡ç¨‹ï¼Œæ‚¨æ‰èƒ½åˆ›å»ºå®ä¾‹å¯¹è±¡ã€‚</p><p>æ‚¨ä¸ä»…å¯ä»¥å°†ä¸åŒçš„ä¾èµ–æ³¨å…¥åˆ°beanä¸­ï¼Œè¿˜å¯ä»¥é…ç½®beançš„ä½œç”¨åŸŸã€‚è¿™ç§æ–¹æ³•æ˜¯éå¸¸å¼ºå¤§è€Œä¸”ä¹Ÿéå¸¸çµæ´»ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡é…ç½®æ¥æŒ‡å®šå¯¹è±¡çš„ä½œç”¨åŸŸï¼Œæ— éœ€åœ¨Javaç±»çš„å±‚æ¬¡ä¸Šé…ç½®ã€‚ beanå¯ä»¥é…ç½®å¤šç§ä½œç”¨åŸŸï¼ŒSpringæ¡†æ¶æ”¯æŒäº”ç§ä½œç”¨åŸŸï¼Œæœ‰ä¸‰ç§ä½œç”¨åŸŸæ˜¯å½“å¼€å‘è€…ä½¿ç”¨åŸºäºWebçš„<code>ApplicationContext</code>çš„æ—¶å€™æ‰æœ‰æ•ˆçš„ã€‚æ‚¨è¿˜å¯ä»¥åˆ›å»º<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-scopes-custom">è‡ªå®šä¹‰èŒƒå›´.</a>ã€‚</p><p>ä¸‹è¡¨æè¿°äº†æ”¯æŒçš„èŒƒå›´:</p><p>Table 3. Bean çš„ä½œç”¨åŸŸ</p><table><thead><tr><th>ä½œç”¨åŸŸ</th><th>æè¿°</th></tr></thead><tbody><tr><td><a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-scopes-singleton">singleton</a></td><td>(é»˜è®¤) æ¯ä¸€Spring IOCå®¹å™¨éƒ½æ‹¥æœ‰å”¯ä¸€çš„å®ä¾‹å¯¹è±¡ã€‚</td></tr><tr><td><a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-scopes-prototype">prototype</a></td><td>ä¸€ä¸ªBeanå®šä¹‰å¯ä»¥åˆ›å»ºä»»æ„å¤šä¸ªå®ä¾‹å¯¹è±¡.</td></tr><tr><td><a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-scopes-request">request</a></td><td>å°†å•ä¸ªbeanå®šä¹‰èŒƒå›´é™å®šä¸ºå•ä¸ªHTTPè¯·æ±‚çš„ç”Ÿå‘½å‘¨æœŸã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸ªHTTPè¯·æ±‚éƒ½æœ‰è‡ªå·±çš„beanå®ä¾‹ï¼Œå®ƒæ˜¯åœ¨å•ä¸ªbeanå®šä¹‰çš„åé¢åˆ›å»ºçš„ã€‚ åªæœ‰åŸºäºWebçš„Spring <code>ApplicationContext</code>çš„æ‰å¯ç”¨ã€‚</td></tr><tr><td><a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-scopes-session">session</a></td><td>å°†å•ä¸ªbeanå®šä¹‰èŒƒå›´é™å®šä¸ºHTTP <code>Session</code>çš„ç”Ÿå‘½å‘¨æœŸã€‚ åªæœ‰åŸºäºWebçš„Spring <code>ApplicationContext</code>çš„æ‰å¯ç”¨ã€‚</td></tr><tr><td><a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-scopes-application">application</a></td><td>å°†å•ä¸ªbeanå®šä¹‰èŒƒå›´é™å®šä¸º<code>ServletContext</code>çš„ç”Ÿå‘½å‘¨æœŸã€‚ åªæœ‰åŸºäºWebçš„Spring <code>ApplicationContext</code>çš„æ‰å¯ç”¨ã€‚</td></tr><tr><td><a href="https://github.com/DocsHome/spring-docs/blob/master/pages/web/web.md#websocket-stomp-websocket-scope">websocket</a></td><td>å°†å•ä¸ªbeanå®šä¹‰èŒƒå›´é™å®šä¸º <code>WebSocket</code>çš„ç”Ÿå‘½å‘¨æœŸã€‚ åªæœ‰åŸºäºWebçš„Spring <code>ApplicationContext</code>çš„æ‰å¯ç”¨ã€‚</td></tr></tbody></table><p>ä»Spring 3.0å¼€å§‹ï¼Œçº¿ç¨‹ä½œç”¨åŸŸé»˜è®¤æ˜¯å¯ç”¨çš„ï¼Œä½†é»˜è®¤æƒ…å†µä¸‹æœªæ³¨å†Œã€‚ æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://docs.spring.io/spring-framework/docs/5.1.3.BUILD-SNAPSHOT/javadoc-api/org/springframework/context/support/SimpleThreadScope.html"><code>SimpleThreadScope</code></a>çš„æ–‡æ¡£ã€‚ æœ‰å…³å¦‚ä½•æ³¨å†Œæ­¤èŒƒå›´æˆ–ä»»ä½•å…¶ä»–è‡ªå®šä¹‰èŒƒå›´çš„è¯´æ˜ï¼Œè¯·å‚é˜…ä½¿ç”¨<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-scopes-custom-using">è‡ªå®šä¹‰èŒƒå›´</a>ã€‚</p><h4 id="1-5-1-å•ä¾‹ä½œç”¨åŸŸ"><a href="#1-5-1-å•ä¾‹ä½œç”¨åŸŸ" class="headerlink" title="1.5.1. å•ä¾‹ä½œç”¨åŸŸ"></a>1.5.1. å•ä¾‹ä½œç”¨åŸŸ</h4><p>å•ä¾‹beanåœ¨å…¨å±€åªæœ‰ä¸€ä¸ªå…±äº«çš„å®ä¾‹ï¼Œæ‰€æœ‰ä¾èµ–å•ä¾‹beançš„åœºæ™¯ä¸­ï¼Œå®¹å™¨è¿”å›çš„éƒ½æ˜¯åŒä¸€ä¸ªå®ä¾‹ã€‚</p><p>æ¢å¥è¯è¯´ï¼Œå½“æ‚¨å®šä¹‰ä¸€ä¸ªbeanå¹¶ä¸”å®ƒçš„èŒƒå›´æ˜¯ä¸€ä¸ªå•ä¾‹æ—¶ï¼ŒSpring IoCå®¹å™¨åªä¼šæ ¹æ®beançš„å®šä¹‰æ¥åˆ›å»ºè¯¥beançš„å”¯ä¸€å®ä¾‹ã€‚ è¿™äº›å”¯ä¸€çš„å®ä¾‹ä¼šç¼“å­˜åˆ°å®¹å™¨ä¸­ï¼Œåç»­é’ˆå¯¹å•ä¾‹beançš„è¯·æ±‚å’Œå¼•ç”¨ï¼Œéƒ½ä¼šä»è¿™ä¸ªç¼“å­˜ä¸­æ‹¿åˆ°è¿™ä¸ªå”¯ä¸€å®ä¾‹ã€‚ ä¸‹å›¾æ˜¾ç¤ºäº†å•ä¾‹èŒƒå›´çš„å·¥ä½œåŸç†ï¼š</p><p><img src="singleton.png" alt="singleton"></p><p>Springçš„å•ä¾‹beanæ¦‚å¿µä¸åŒäºè®¾è®¡æ¨¡å¼ï¼ˆGoFï¼‰ä¹‹ä¸­æ‰€å®šä¹‰çš„å•ä¾‹æ¨¡å¼ã€‚è®¾è®¡æ¨¡å¼ä¸­çš„å•ä¾‹æ¨¡å¼æ˜¯å°†ä¸€ä¸ªå¯¹è±¡çš„ä½œç”¨åŸŸç¡¬ç¼–ç çš„ï¼Œä¸€ä¸ªClassLoaderåªèƒ½æœ‰å”¯ä¸€çš„ä¸€ä¸ªå®ä¾‹ã€‚ è€ŒSpringçš„å•ä¾‹ä½œç”¨åŸŸæ˜¯ä»¥å®¹å™¨ä¸ºå‰æçš„ï¼Œæ¯ä¸ªå®¹å™¨æ¯ä¸ªbeanåªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹ã€‚ è¿™æ„å‘³ç€ï¼Œå¦‚æœåœ¨å•ä¸ªSpringå®¹å™¨ä¸­ä¸ºç‰¹å®šç±»å®šä¹‰ä¸€ä¸ªbeanï¼Œåˆ™Springå®¹å™¨ä¼šæ ¹æ®beanå®šä¹‰åˆ›å»ºå”¯ä¸€çš„beanå®ä¾‹ã€‚ å•ä¾‹ä½œç”¨åŸŸæ˜¯Springçš„é»˜è®¤ä½œç”¨åŸŸã€‚ ä¸‹é¢çš„ä¾‹å­æ˜¯åœ¨XMLä¸­é…ç½®å•ä¾‹æ¨¡å¼Beançš„ä¾‹å­ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;accountService&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.something.DefaultAccountService&quot;</span>/&gt;</span><br><span class="hljs-comment">&lt;!-- the following is equivalent, though redundant (singleton scope is the default) --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;accountService&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.something.DefaultAccountService&quot;</span> <span class="hljs-attr">scope</span>=<span class="hljs-string">&quot;singleton&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><h4 id="1-5-2-åŸå‹ä½œç”¨åŸŸ"><a href="#1-5-2-åŸå‹ä½œç”¨åŸŸ" class="headerlink" title="1.5.2. åŸå‹ä½œç”¨åŸŸ"></a>1.5.2. åŸå‹ä½œç”¨åŸŸ</h4><p>éå•ä¾‹çš„ã€åŸå‹beanæŒ‡çš„æ˜¯æ¯æ¬¡è¯·æ±‚beanå®ä¾‹æ—¶,è¿”å›çš„éƒ½æ˜¯æ–°çš„å¯¹è±¡å®ä¾‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯æ¬¡æ³¨å…¥åˆ°å¦å¤–çš„beanæˆ–è€…é€šè¿‡è°ƒç”¨ <code>getBean()</code>æ–¹æ³•æ¥è·å¾—çš„beanéƒ½æ˜¯å…¨æ–°çš„å®ä¾‹ã€‚ åŸºäºçº¿ç¨‹å®‰å…¨æ€§çš„è€ƒè™‘ï¼Œå½“beanå¯¹è±¡æœ‰çŠ¶æ€æ—¶ä½¿ç”¨åŸå‹ä½œç”¨åŸŸï¼Œè€Œæ— çŠ¶æ€æ—¶åˆ™ä½¿ç”¨å•ä¾‹ä½œç”¨åŸŸã€‚</p><p>ä¸‹å›¾è¯´æ˜äº†SpringåŸå‹ä½œç”¨åŸŸï¼š:</p><p><img src="prototype.png" alt="prototype"></p><p>ï¼ˆæ•°æ®è®¿é—®å¯¹è±¡ï¼ˆDAOï¼‰é€šå¸¸ä¸é…ç½®ä¸ºåŸå‹ï¼Œå› ä¸ºå…¸å‹çš„DAOä¸å…·æœ‰ä»»ä½•ä¼šè¯çŠ¶æ€ã€‚æˆ‘ä»¬å¯ä»¥æ›´å®¹æ˜“é‡ç”¨å•ä¾‹å›¾çš„æ ¸å¿ƒã€‚ï¼‰</p><p>ç”¨ä¸‹é¢çš„ä¾‹å­æ¥è¯´æ˜Springçš„åŸå‹ä½œç”¨åŸŸ:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;bean <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;accountService&quot;</span> <span class="hljs-attribute">class</span>=<span class="hljs-string">&quot;com.something.DefaultAccountService&quot;</span> <span class="hljs-attribute">scope</span>=<span class="hljs-string">&quot;prototype&quot;</span>/&gt;<br></code></pre></td></tr></table></figure><p>ä¸å…¶ä»–ä½œç”¨åŸŸç›¸æ¯”ï¼ŒSpringä¸ä¼šå®Œæ•´åœ°ç®¡ç†åŸå‹beançš„ç”Ÿå‘½å‘¨æœŸã€‚ Springå®¹å™¨åªä¼šåˆå§‹åŒ–ã€é…ç½®å’Œè£…è½½è¿™äº›beanï¼Œç„¶åä¼ é€’ç»™Clientã€‚ä½†æ˜¯ä¹‹åå°±ä¸ä¼šå†æœ‰è¯¥åŸå‹å®ä¾‹çš„è¿›ä¸€æ­¥è®°å½•ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œåˆå§‹åŒ–ç”Ÿå‘½å‘¨æœŸå›è°ƒæ–¹æ³•åœ¨æ‰€æœ‰ä½œç”¨åŸŸçš„beanæ˜¯éƒ½ä¼šè°ƒç”¨çš„ï¼Œä½†æ˜¯é”€æ¯ç”Ÿå‘½å‘¨æœŸå›è°ƒæ–¹æ³•åœ¨åŸå‹beanæ˜¯ä¸ä¼šè°ƒç”¨çš„ã€‚æ‰€ä»¥ï¼Œå®¢æˆ·ç«¯ä»£ç å¿…é¡»æ³¨æ„æ¸…ç†åŸå‹beanä»¥åŠé‡Šæ”¾åŸå‹beanæ‰€æŒæœ‰çš„èµ„æºã€‚ å¯ä»¥é€šè¿‡ä½¿ç”¨è‡ªå®šä¹‰çš„<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-extension-bpp">bean post-processor</a>ï¼ˆBeançš„åç½®å¤„ç†å™¨ï¼‰æ¥è®©Springé‡Šæ”¾æ‰åŸå‹beanæ‰€æŒæœ‰çš„èµ„æºã€‚</p><p>åœ¨æŸäº›æ–¹é¢ï¼ŒSpringå®¹å™¨å…³äºåŸå‹ä½œç”¨åŸŸçš„beanå°±æ˜¯å–ä»£äº†Javaçš„<code>new</code> æ“ä½œç¬¦ã€‚ æ‰€æœ‰çš„ç”Ÿå‘½å‘¨æœŸçš„æ§åˆ¶éƒ½ç”±å®¢æˆ·ç«¯æ¥å¤„ç†ï¼ˆæœ‰å…³Springå®¹å™¨ä¸­beançš„ç”Ÿå‘½å‘¨æœŸçš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-lifecycle">Beançš„ç”Ÿå‘½å‘¨æœŸ</a>ï¼‰ã€‚</p><h4 id="1-5-3-ä¾èµ–åŸå‹beançš„å•ä¾‹bean"><a href="#1-5-3-ä¾èµ–åŸå‹beançš„å•ä¾‹bean" class="headerlink" title="1.5.3. ä¾èµ–åŸå‹beançš„å•ä¾‹bean"></a>1.5.3. ä¾èµ–åŸå‹beançš„å•ä¾‹bean</h4><p>å½“æ‚¨ä½¿ç”¨å…·æœ‰ä¾èµ–äºåŸå‹beançš„å•ä¾‹ä½œç”¨åŸŸbeanæ—¶ï¼Œè¯·æ³¨æ„åœ¨å®ä¾‹åŒ–æ—¶è§£æä¾èµ–é¡¹ã€‚ å› æ­¤ï¼Œå¦‚æœå°†åŸå‹beanæ³¨å…¥åˆ°å•ä¾‹çš„beanä¸­ï¼Œåˆ™ä¼šå®ä¾‹åŒ–ä¸€ä¸ªæ–°çš„åŸå‹beanï¼Œç„¶åå°†ä¾èµ–æ³¨å…¥åˆ°å•ä¾‹beanä¸­ã€‚ è¿™ä¸ªä¾èµ–çš„åŸå‹beanä»ç„¶æ˜¯åŒä¸€ä¸ªå®ä¾‹ã€‚</p><p>ä½†æ˜¯ï¼Œå‡è®¾æ‚¨å¸Œæœ›å•ä¾‹ä½œç”¨åŸŸçš„beanåœ¨è¿è¡Œæ—¶é‡å¤è·å–åŸå‹ä½œç”¨åŸŸçš„beançš„æ–°å®ä¾‹ã€‚ æ‚¨ä¸èƒ½å°†åŸå‹ä½œç”¨åŸŸçš„beanä¾èµ–æ³¨å…¥åˆ°æ‚¨çš„å•ä¾‹beanä¸­ï¼Œ å› ä¸ºå½“Springå®¹å™¨å®ä¾‹åŒ–å•ä¾‹beanå¹¶è§£ææ³¨å…¥å…¶ä¾èµ–é¡¹æ—¶ï¼Œè¯¥æ³¨å…¥åªå‘ç”Ÿä¸€æ¬¡ã€‚ å¦‚æœæ‚¨éœ€è¦åœ¨è¿è¡Œæ—¶å¤šæ¬¡ä½¿ç”¨åŸå‹beançš„æ–°å®ä¾‹ï¼Œè¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-method-injection">æ–¹æ³•æ³¨å…¥</a>ã€‚</p><h4 id="1-5-4-è¯·æ±‚ï¼Œä¼šè¯ï¼Œåº”ç”¨ç¨‹åºå’ŒWebSocketä½œç”¨åŸŸ"><a href="#1-5-4-è¯·æ±‚ï¼Œä¼šè¯ï¼Œåº”ç”¨ç¨‹åºå’ŒWebSocketä½œç”¨åŸŸ" class="headerlink" title="1.5.4. è¯·æ±‚ï¼Œä¼šè¯ï¼Œåº”ç”¨ç¨‹åºå’ŒWebSocketä½œç”¨åŸŸ"></a>1.5.4. è¯·æ±‚ï¼Œä¼šè¯ï¼Œåº”ç”¨ç¨‹åºå’ŒWebSocketä½œç”¨åŸŸ</h4><p><code>request</code>, <code>session</code>, <code>application</code>, å’Œ <code>websocket</code>ä½œç”¨åŸŸåªæœ‰åœ¨Webä¸­ä½¿ç”¨Springçš„<code>ApplicationContext</code>ï¼ˆä¾‹å¦‚<code>ClassPathXmlApplicationContext</code>ï¼‰çš„æƒ…å†µä¸‹æ‰ç”¨å¾—ä¸Šã€‚ å¦‚æœåœ¨æ™®é€šçš„Spring IoCå®¹å™¨ï¼Œä¾‹å¦‚ClassPathXmlApplicationContextä¸­ä½¿ç”¨è¿™äº›ä½œç”¨åŸŸï¼Œå°†ä¼šæŠ›å‡ºIllegalStateExceptionå¼‚å¸¸æ¥è¯´æ˜ä½¿ç”¨äº†æœªçŸ¥çš„ä½œç”¨åŸŸã€‚</p><h5 id="åˆå§‹åŒ–Webçš„é…ç½®"><a href="#åˆå§‹åŒ–Webçš„é…ç½®" class="headerlink" title="åˆå§‹åŒ–Webçš„é…ç½®"></a>åˆå§‹åŒ–Webçš„é…ç½®</h5><p>ä¸ºäº†èƒ½å¤Ÿä½¿ç”¨è¯·æ±‚ <code>request</code>, <code>session</code>, <code>application</code>, å’Œ<code>websocket</code>ï¼ˆWebèŒƒå›´çš„beanï¼‰ï¼Œéœ€è¦åœ¨é…ç½®beanä¹‹å‰ä½œä¸€äº›åŸºç¡€é…ç½®ã€‚ è€Œå¯¹äºæ ‡å‡†çš„ä½œç”¨åŸŸï¼Œä¾‹å¦‚å•ä¾‹å’ŒåŸå‹ä½œç”¨åŸŸï¼Œè¿™ç§åŸºç¡€é…ç½®æ˜¯ä¸éœ€è¦çš„ã€‚</p><p>å¦‚ä½•å®Œæˆæ­¤åˆå§‹è®¾ç½®å–å†³äºæ‚¨çš„ç‰¹å®šServletç¯å¢ƒ.</p><p>ä¾‹å¦‚ï¼Œå¦‚æœå¼€å‘è€…ä½¿ç”¨äº†Spring Web MVCæ¡†æ¶ï¼Œé‚£ä¹ˆæ¯ä¸€ä¸ªè¯·æ±‚éƒ½ä¼šé€šè¿‡Springçš„<code>DispatcherServlet</code>æ¥å¤„ç†ï¼Œé‚£ä¹ˆä¹Ÿæ— éœ€ç‰¹æ®Šçš„è®¾ç½®äº†ã€‚DispatcherServletå’ŒDispatcherPortletå·²ç»åŒ…å«äº†ç›¸åº”çŠ¶æ€ã€‚</p><p>å¦‚æœæ‚¨ä½¿ç”¨Servlet 2.5 Webå®¹å™¨ï¼Œå¹¶ä¸”åœ¨Springçš„<code>DispatcherServlet</code>ä¹‹å¤–å¤„ç†è¯·æ±‚ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨JSFæˆ–Strutsæ—¶ï¼‰ï¼Œåˆ™éœ€è¦æ³¨å†Œ<code>org.springframework.web.context.request.RequestContextListener</code>æˆ–è€…<code>ServletRequestListener</code>ã€‚ å¯¹äºServlet 3.0+ï¼Œå¯ä»¥ä½¿ç”¨<code>WebApplicationInitializer</code>æ¥å£ä»¥ç¼–ç¨‹æ–¹å¼å®Œæˆæ­¤æ“ä½œã€‚ å¦‚æœéœ€è¦å…¼å®¹æ—§ç‰ˆæœ¬å®¹å™¨çš„è¯ï¼Œå°†ä»¥ä¸‹å£°æ˜æ·»åŠ åˆ°Webåº”ç”¨ç¨‹åºçš„<code>web.xml</code> æ–‡ä»¶ä¸­:</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">web-app</span>&gt;</span></span><br><br><span class="hljs-code">    ...</span><br><span class="hljs-code"></span><br><span class="hljs-code">    &lt;listener&gt;</span><br><span class="hljs-code"></span><br><span class="hljs-code">        &lt;listener-class&gt;</span><br><span class="hljs-code"></span><br><span class="hljs-code">            org.springframework.web.context.request.RequestContextListener</span><br><span class="hljs-code"></span><br><span class="hljs-code">        &lt;/listener-class&gt;</span><br><span class="hljs-code"></span><br><span class="hljs-code">    &lt;/listener&gt;</span><br><span class="hljs-code"></span><br><span class="hljs-code">    ...</span><br><span class="hljs-code"></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">web-app</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p>æˆ–è€…ï¼Œå¦‚æœå¯¹Listenerä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œè¯·è€ƒè™‘ä½¿ç”¨Springçš„<code>RequestContextFilter</code>ã€‚ Filteræ˜ å°„å–å†³äºWebåº”ç”¨çš„é…ç½®ï¼Œå› æ­¤æ‚¨å¿…é¡»æ ¹æ®éœ€è¦è¿›è¡Œæ›´æ”¹ã€‚ ä»¥ä¸‹æ¸…å•æ˜¾ç¤ºäº†Webåº”ç”¨ç¨‹åºçš„è¿‡æ»¤å™¨éƒ¨åˆ†:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">web-app</span>&gt;</span><br><br>    ...<br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">filter</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>requestContextFilter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">filter-class</span>&gt;</span>org.springframework.web.filter.RequestContextFilter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-class</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">filter-mapping</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>requestContextFilter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">filter-mapping</span>&gt;</span><br><br>    ...<br><br><span class="hljs-tag">&lt;/<span class="hljs-name">web-app</span>&gt;</span><br></code></pre></td></tr></table></figure><p><code>DispatcherServlet</code>, <code>RequestContextListener</code>, and <code>RequestContextFilter</code>æ‰€åšçš„å·¥ä½œå®é™…ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯å°†requestå¯¹è±¡è¯·æ±‚ç»‘å®šåˆ°æœåŠ¡çš„ <code>Thread</code>ä¸Šã€‚ è¿™æ‰ä½¿beanåœ¨ä¹‹åçš„è°ƒç”¨é“¾ä¸Šå¯¹è¯·æ±‚å’Œä¼šè¯ä½œç”¨åŸŸå¯è§ã€‚</p><h5 id="Requestä½œç”¨åŸŸ"><a href="#Requestä½œç”¨åŸŸ" class="headerlink" title="Requestä½œç”¨åŸŸ"></a>Requestä½œç”¨åŸŸ</h5><p>å‚è€ƒä¸‹é¢è¿™ä¸ªXMLé…ç½®çš„beanå®šä¹‰:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;bean <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;loginAction&quot;</span> <span class="hljs-attribute">class</span>=<span class="hljs-string">&quot;com.something.LoginAction&quot;</span> <span class="hljs-attribute">scope</span>=<span class="hljs-string">&quot;request&quot;</span>/&gt;<br></code></pre></td></tr></table></figure><p>Springå®¹å™¨ä¼šåœ¨æ¯æ¬¡ä½¿ç”¨<code>LoginAction</code>æ¥å¤„ç†æ¯ä¸ªHTTPè¯·æ±‚æ—¶éƒ½ä¼šåˆ›å»ºæ–°çš„<code>LoginAction</code>å®ä¾‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>LoginAction</code> beançš„ä½œç”¨åŸŸæ˜¯HTTP Requestçº§åˆ«çš„ã€‚ å¼€å‘è€…å¯ä»¥éšæ„æ”¹å˜å®ä¾‹çš„çŠ¶æ€ï¼Œå› ä¸ºå…¶ä»–é€šè¿‡<code>loginAction</code>è¯·æ±‚æ¥åˆ›å»ºçš„å®ä¾‹æ ¹æœ¬çœ‹ä¸åˆ°å¼€å‘è€…æ”¹å˜çš„å®ä¾‹çŠ¶æ€ï¼Œæ‰€æœ‰åˆ›å»ºçš„Beanå®ä¾‹éƒ½æ˜¯æ ¹æ®ç‹¬ç«‹çš„è¯·æ±‚åˆ›å»ºçš„ã€‚å½“è¯·æ±‚å¤„ç†å®Œæ¯•ï¼Œè¿™ä¸ªbeanä¹Ÿå°†ä¼šé”€æ¯ã€‚</p><p>å½“ä½¿ç”¨æ³¨è§£é…ç½®æˆ–Javaé…ç½®æ—¶ï¼Œä½¿ç”¨<code>@RequestScope</code>æ³¨è§£ä¿®é¥°çš„beanä¼šè¢«è®¾ç½®æˆrequestä½œç”¨åŸŸã€‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@RequestScope</span><br><br><span class="hljs-variable">@Component</span><br><br>public class LoginAction &#123;<br><br>    <span class="hljs-comment">// ...</span><br><br>&#125;<br></code></pre></td></tr></table></figure><h5 id="Sessionä½œç”¨åŸŸ"><a href="#Sessionä½œç”¨åŸŸ" class="headerlink" title="Sessionä½œç”¨åŸŸ"></a>Sessionä½œç”¨åŸŸ</h5><p>å‚è€ƒä¸‹é¢XMLé…ç½®çš„beançš„å®šä¹‰:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;bean <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;userPreferences&quot;</span> <span class="hljs-attribute">class</span>=<span class="hljs-string">&quot;com.something.UserPreferences&quot;</span> <span class="hljs-attribute">scope</span>=<span class="hljs-string">&quot;session&quot;</span>/&gt;<br></code></pre></td></tr></table></figure><p>Springå®¹å™¨é€šè¿‡åœ¨å•ä¸ªHTTPä¼šè¯çš„ç”Ÿå‘½å‘¨æœŸä¸­ä½¿ç”¨<code>UserPreferences</code> beanå®šä¹‰æ¥åˆ›å»º<code>UserPreferences</code> beançš„æ–°å®ä¾‹ã€‚æ¢è¨€ä¹‹ï¼Œ<code>UserPreferences</code> Beançš„ä½œç”¨åŸŸæ˜¯HTTP S<code>Session</code>çº§åˆ«çš„ï¼Œåœ¨request-scopedä½œç”¨åŸŸçš„beanä¸Šï¼Œ å¼€å‘è€…å¯ä»¥éšæ„çš„æ›´æ”¹å®ä¾‹çš„çŠ¶æ€ï¼ŒåŒæ ·ï¼Œå…¶ä»–HTTP <code>Session</code>çš„åŸºæœ¬å®ä¾‹åœ¨æ¯ä¸ª<code>Session</code>ä¸­éƒ½ä¼šè¯·æ±‚userPreferencesæ¥åˆ›å»ºæ–°çš„å®ä¾‹ï¼Œæ‰€ä»¥ï¼Œå¼€å‘è€…æ›´æ”¹beançš„çŠ¶æ€ï¼Œ å¯¹äºå…¶ä»–çš„Beanä»ç„¶æ˜¯ä¸å¯è§çš„ã€‚å½“HTTP <code>Session</code>è¢«é”€æ¯æ—¶ï¼Œæ ¹æ®è¿™ä¸ª<code>Session</code>æ¥åˆ›å»ºçš„beanä¹Ÿå°†ä¼šè¢«é”€æ¯ã€‚</p><p>ä½¿ç”¨æ³¨è§£é…ç½®å’ŒJavaé…ç½®æ—¶ï¼Œä½¿ç”¨<code>@SessionScope</code> æ³¨è§£ä¿®é¥°çš„ bean ä¼šè¢«è®¾ç½®æˆ<code>session</code>ä½œç”¨åŸŸã€‚</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@SessionScope</span><br><br><span class="hljs-variable">@Component</span><br><br>public class UserPreferences &#123;<br><br>    <span class="hljs-comment">// ...</span><br><br>&#125;<br></code></pre></td></tr></table></figure><h5 id="Applicationä½œç”¨åŸŸ"><a href="#Applicationä½œç”¨åŸŸ" class="headerlink" title="Applicationä½œç”¨åŸŸ"></a>Applicationä½œç”¨åŸŸ</h5><p>å‚è€ƒä¸‹é¢ç”¨XMLé…ç½®çš„beançš„å®šä¹‰:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;bean <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;appPreferences&quot;</span> <span class="hljs-attribute">class</span>=<span class="hljs-string">&quot;com.something.AppPreferences&quot;</span> <span class="hljs-attribute">scope</span>=<span class="hljs-string">&quot;application&quot;</span>/&gt;<br></code></pre></td></tr></table></figure><p>Springå®¹å™¨ä¼šåœ¨æ•´ä¸ªWebåº”ç”¨å†…ä½¿ç”¨åˆ°<code>appPreferences</code>çš„æ—¶å€™åˆ›å»ºä¸€ä¸ªæ–°çš„<code>AppPreferences</code>çš„å®ä¾‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>appPreferences</code> beanæ˜¯åœ¨<code>ServletContext</code> çº§åˆ«çš„ï¼Œ å°±åƒæ™®é€šçš„<code>ServletContext</code> å±æ€§ä¸€æ ·ã€‚è¿™ç§ä½œç”¨åŸŸåœ¨ä¸€äº›ç¨‹åº¦ä¸Šæ¥è¯´å’ŒSpringçš„å•ä¾‹ä½œç”¨åŸŸæ˜¯æä¸ºç›¸ä¼¼ï¼Œä½†æ˜¯ä¹Ÿæœ‰å¦‚ä¸‹ä¸åŒä¹‹å¤„ï¼Œåº”ç”¨ä½œç”¨åŸŸæ˜¯æ¯ä¸ª<code>ServletContext</code> ä¸­åŒ…å«ä¸€ä¸ª è€Œä¸æ˜¯æ¯ä¸ªSpring ApplicationContextä¸­åªæœ‰ä¸€ä¸ªï¼ˆæŸäº›åº”ç”¨å¯èƒ½åŒ…å«å¤šä¸ªApplicationContextï¼‰ã€‚åº”ç”¨ä½œç”¨åŸŸä»…ä»…å¯¹<code>ServletContext</code> å¯è§ï¼Œå•ä¾‹beanæ˜¯å¯¹ApplicationContextå¯è§ã€‚</p><p>å½“ä½¿ç”¨æ³¨è§£é…ç½®æˆ–Javaé…ç½®æ—¶ï¼Œä½¿ç”¨<code>@ApplicationScope</code> æ³¨è§£ä¿®é¥°çš„beanä¼šè¢«è®¾ç½®æˆ<code>application</code>ä½œç”¨åŸŸ ã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œ:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@ApplicationScope</span><br><br><span class="hljs-variable">@Component</span><br><br>public class AppPreferences &#123;<br><br>    <span class="hljs-comment">// ...</span><br><br>&#125;<br></code></pre></td></tr></table></figure><h5 id="æœ‰ä½œç”¨åŸŸbeançš„ä¾èµ–"><a href="#æœ‰ä½œç”¨åŸŸbeançš„ä¾èµ–" class="headerlink" title="æœ‰ä½œç”¨åŸŸbeançš„ä¾èµ–"></a>æœ‰ä½œç”¨åŸŸbeançš„ä¾èµ–</h5><p>Spring IoCå®¹å™¨ä¸ä»…ä»…ç®¡ç†å¯¹è±¡ï¼ˆbeanï¼‰çš„å®ä¾‹åŒ–ï¼ŒåŒæ—¶ä¹Ÿè´Ÿè´£è£…é…ä¾èµ–ã€‚å¦‚æœå¼€å‘è€…è¦å°†ä¸€ä¸ªbeanè£…é…åˆ°æ¯”å®ƒä½œç”¨åŸŸæ›´å¹¿çš„beanæ—¶ï¼ˆä¾‹å¦‚HTTPè¯·æ±‚è¿”å›çš„beanï¼‰ï¼Œé‚£ä¹ˆå¼€å‘è€…åº”å½“é€‰æ‹©æ³¨å…¥AOPä»£ç†è€Œä¸æ˜¯ä½¿ç”¨å¸¦ä½œç”¨åŸŸçš„beanã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå¼€å‘è€…éœ€è¦æ³¨å…¥ä»£ç†å¯¹è±¡ï¼Œè€Œè¿™ä¸ªä»£ç†å¯¹è±¡æ—¢å¯ä»¥æ‰¾åˆ°å®é™…çš„beanï¼Œè¿˜èƒ½å¤Ÿåˆ›å»ºå…¨æ–°çš„beanã€‚</p><p>æ‚¨è¿˜å¯ä»¥åœ¨ä½œä¸ºå•ä¾‹çš„ä½œç”¨åŸŸçš„beanä¹‹é—´ä½¿ç”¨<code>&lt;aop:scoped-proxy/&gt;</code>ï¼Œç„¶åå¼•ç”¨é€šè¿‡å¯åºåˆ—åŒ–çš„ä¸­é—´ä»£ç†ï¼Œä»è€Œèƒ½å¤Ÿåœ¨ååºåˆ—åŒ–æ—¶é‡æ–°è·å–ç›®æ ‡<code>å•ä¾‹</code>beanã€‚</p><p>å½“é’ˆå¯¹åŸå‹ä½œç”¨åŸŸçš„beanå£°æ˜<code>&lt;aop:scoped-proxy/&gt;</code>æ—¶ï¼Œæ¯ä¸ªé€šè¿‡ä»£ç†çš„è°ƒç”¨éƒ½ä¼šäº§ç”Ÿæ–°çš„ç›®æ ‡å®ä¾‹ã€‚</p><p>æ­¤å¤–ï¼Œä½œç”¨åŸŸä»£ç†å¹¶ä¸æ˜¯å–å¾—ä½œç”¨åŸŸbeançš„å”¯ä¸€å®‰å…¨æ–¹å¼ã€‚ å¼€å‘è€…ä¹Ÿå¯ä»¥é€šè¿‡ç®€å•çš„å£°æ˜æ³¨å…¥ï¼ˆå³æ„é€ å‡½æ•°æˆ–setterå‚æ•°æˆ–è‡ªåŠ¨è£…é…å­—æ®µï¼‰<code>ObjectFactory&lt;MyTargetBean&gt;</code>ï¼Œ ç„¶åå…è®¸é€šè¿‡ç±»ä¼¼<code>getObject()</code>çš„æ–¹æ³•è°ƒç”¨æ¥è·å–ä¸€äº›æŒ‡å®šçš„ä¾èµ–ï¼Œè€Œä¸æ˜¯ç›´æ¥å‚¨å­˜ä¾èµ–çš„å®ä¾‹ã€‚</p><p>ä½œä¸ºæ‰©å±•å˜ä½“ï¼Œæ‚¨å¯ä»¥å£°æ˜<code>ObjectProvider&lt;MyTargetBean&gt;</code>ï¼Œå®ƒæä¾›äº†å‡ ä¸ªé¢å¤–çš„è®¿é—®å˜ä½“ï¼ŒåŒ…æ‹¬<code>getIfAvailable</code> å’Œ <code>getIfUnique</code>ã€‚</p><p>JSR-330å°†è¿™æ ·çš„å˜ç§ç§°ä¸ºProviderï¼Œå®ƒä½¿ç”¨<code>Provider&lt;MyTargetBean&gt;</code> å£°æ˜ä»¥åŠç›¸å…³çš„ <code>get()</code> æ–¹æ³•æ¥å°è¯•è·å–æ¯ä¸€ä¸ªé…ç½®ã€‚ æœ‰å…³JSR-330æ•´ä½“çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œ<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-standard-annotations">è¯·å‚çœ‹æ­¤å¤„</a>ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹ä¸­çš„é…ç½®åªæœ‰ä¸€è¡Œï¼Œä½†äº†è§£â€œä¸ºä»€ä¹ˆâ€ä»¥åŠå®ƒèƒŒåçš„â€œå¦‚ä½•â€éå¸¸é‡è¦ï¼š:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span>    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>    <span class="hljs-attr">xmlns:aop</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/aop&quot;</span>    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans.xsd        http://www.springframework.org/schema/aop        http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- an HTTP Session-scoped bean exposed as a proxy --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userPreferences&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.something.UserPreferences&quot;</span> <span class="hljs-attr">scope</span>=<span class="hljs-string">&quot;session&quot;</span>&gt;</span>        <span class="hljs-comment">&lt;!-- instructs the container to proxy the surrounding bean --&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">aop:scoped-proxy</span>/&gt;</span> (1)    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- a singleton-scoped bean injected with a proxy to the above bean --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userService&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.something.SimpleUserService&quot;</span>&gt;</span>        <span class="hljs-comment">&lt;!-- a reference to the proxied userPreferences bean --&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;userPreferences&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;userPreferences&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>1</strong>ã€å®šä¹‰ä»£ç†çš„è¡Œã€‚</p><p>è¦åˆ›å»ºè¿™æ ·çš„ä¸€ä¸ªä»£ç†ï¼Œåªéœ€è¦åœ¨å¸¦ä½œç”¨åŸŸçš„beanå®šä¹‰ä¸­æ·»åŠ å­èŠ‚ç‚¹<code>&lt;aop:scoped-proxy/&gt;</code>å³å¯ï¼ˆå…·ä½“æŸ¥çœ‹<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-scopes-other-injection-proxies">é€‰æ‹©åˆ›å»ºä»£ç†çš„ç±»å‹</a>å’Œ <a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#xsd-schemas">åŸºäºXML Schemaçš„é…ç½®</a>ï¼‰ã€‚ä¸ºä»€ä¹ˆåœ¨<code>request</code>, <code>session</code>å’Œè‡ªå®šä¹‰ä½œç”¨åŸŸçº§åˆ«èŒƒå›´å†…çš„beanå®šä¹‰éœ€è¦<code>&lt;aop:scoped-proxy/&gt;</code>ï¼Œ è€ƒè™‘ä»¥ä¸‹å•ä¾‹beanå®šä¹‰ï¼Œå¹¶å°†å…¶ä¸æ‚¨éœ€è¦ä¸ºä¸Šè¿°èŒƒå›´å®šä¹‰çš„å†…å®¹è¿›è¡Œå¯¹æ¯”ï¼ˆè¯·æ³¨æ„ï¼Œä»¥ä¸‹<code>userPreferences</code>beanå®šä¹‰ä¸å®Œæ•´ï¼‰:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;bean <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;userPreferences&quot;</span> <span class="hljs-attribute">class</span>=<span class="hljs-string">&quot;com.something.UserPreferences&quot;</span> <span class="hljs-attribute">scope</span>=<span class="hljs-string">&quot;session&quot;</span>/&gt;<br>&lt;bean <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;userManager&quot;</span> <span class="hljs-attribute">class</span>=<span class="hljs-string">&quot;com.something.UserManager&quot;</span>&gt;    &lt;property <span class="hljs-attribute">name</span>=<span class="hljs-string">&quot;userPreferences&quot;</span> <span class="hljs-attribute">ref</span>=<span class="hljs-string">&quot;userPreferences&quot;</span>/&gt;&lt;/bean&gt;<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå•ä¾‹beanï¼ˆ<code>userManager</code>ï¼‰æ³¨å…¥äº†æ³¨å…¥äº†HTTP <code>Session</code>çº§åˆ«çš„<code>userPreferences</code>ä¾èµ–ã€‚ æ˜¾ç„¶ï¼Œ é—®é¢˜å°±æ˜¯<code>userPreferences</code>åœ¨Springå®¹å™¨ä¸­åªä¼šå®ä¾‹åŒ–ä¸€æ¬¡ã€‚å®ƒçš„ä¾èµ–é¡¹ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹åªæœ‰ä¸€ä¸ªï¼Œ<code>userPreferences</code>ï¼‰ä¹Ÿåªæ³¨å…¥ä¸€æ¬¡ã€‚ è¿™æ„å‘³ç€<code>userManager</code> æ¯æ¬¡ä½¿ç”¨çš„æ˜¯å®Œå…¨ç›¸åŒçš„<code>userPreferences</code>å¯¹è±¡ï¼ˆå³æœ€åˆæ³¨å…¥å®ƒçš„å¯¹è±¡ï¼‰è¿›è¡Œæ“ä½œã€‚</p><p>è¿™ä¸æ˜¯å°†çŸ­å‘¨æœŸä½œç”¨åŸŸbeanæ³¨å…¥åˆ°é•¿å‘¨æœŸä½œç”¨åŸŸbeanæ—¶æ‰€éœ€çš„è¡Œä¸ºï¼Œä¾‹å¦‚å°†HTTP <code>Session</code>çº§åˆ«çš„ä½œç”¨åŸŸbeanä½œä¸ºä¾èµ–æ³¨å…¥åˆ°å•ä¾‹beanä¸­ã€‚ç›¸åï¼Œå¼€å‘è€…éœ€è¦ä¸€ä¸ª <code>userManager</code>å¯¹è±¡ï¼Œ è€Œåœ¨HTTP <code>Session</code>çš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œå¼€å‘è€…éœ€è¦ä¸€ä¸ªç‰¹å®šäºHTTP Sessionçš„ userPreferences å¯¹è±¡ã€‚å› æ­¤ï¼Œå®¹å™¨åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡å…¬å¼€ä¸UserPreferencesç±»ï¼ˆç†æƒ³æƒ…å†µä¸‹ä¸º<code>UserPreferences</code>å®ä¾‹çš„å¯¹è±¡ï¼‰ å®Œå…¨ç›¸åŒçš„å…¬å…±æ¥å£ï¼Œè¯¥å¯¹è±¡å¯ä»¥ä»ä½œç”¨åŸŸæœºåˆ¶ï¼ˆHTTP Requestã€<code>Session</code>ç­‰ï¼‰ä¸­è·å–çœŸå®çš„<code>UserPreferences</code>å¯¹è±¡ã€‚å®¹å™¨å°†è¿™ä¸ªä»£ç†å¯¹è±¡æ³¨å…¥åˆ°<code>userManager</code>ä¸­ï¼Œ è€Œä¸çŸ¥é“è¿™ä¸ª<code>UserPreferences</code>å¼•ç”¨æ˜¯ä¸€ä¸ªä»£ç†ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå½“ä¸€ä¸ªUserManagerå®ä¾‹åœ¨ä¾èµ–æ³¨å…¥çš„UserPreferenceså¯¹è±¡ä¸Šè°ƒç”¨ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œ å®ƒå®é™…ä¸Šæ˜¯åœ¨è°ƒç”¨ä»£ç†çš„æ–¹æ³•ï¼Œå†ç”±ä»£ç†ä»HTTP <code>Session</code>ï¼ˆæœ¬ä¾‹ï¼‰è·å–çœŸå®çš„<code>UserPreferences</code>å¯¹è±¡ï¼Œå¹¶å°†æ–¹æ³•è°ƒç”¨å§”æ‰˜ç»™æ£€ç´¢åˆ°çš„å®é™…<code>UserPreferences</code>å¯¹è±¡ã€‚</p><p>å› æ­¤ï¼Œåœ¨å°†<code>request-</code> and <code>session-scoped</code>çš„beanæ¥ä½œä¸ºä¾èµ–æ—¶ï¼Œæ‚¨éœ€è¦ä»¥ä¸‹ï¼ˆæ­£ç¡®å’Œå®Œæ•´ï¼‰é…ç½®ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š æ‰€ä»¥å½“å¼€å‘è€…å¸Œæœ›èƒ½å¤Ÿæ­£ç¡®çš„ä½¿ç”¨é…ç½®è¯·æ±‚ã€ä¼šè¯æˆ–è€…å…¨å±€ä¼šè¯çº§åˆ«çš„beanæ¥ä½œä¸ºä¾èµ–æ—¶ï¼Œéœ€è¦è¿›è¡Œå¦‚ä¸‹ç±»ä¼¼çš„é…ç½®ã€‚</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript">&lt;bean <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;userPreferences&quot;</span> <span class="hljs-built_in">class</span>=<span class="hljs-string">&quot;com.something.UserPreferences&quot;</span> scope=<span class="hljs-string">&quot;session&quot;</span>&gt;    &lt;aop:scoped-proxy/&gt;&lt;/bean&gt;<br>&lt;bean <span class="hljs-built_in">id</span>=<span class="hljs-string">&quot;userManager&quot;</span> <span class="hljs-built_in">class</span>=<span class="hljs-string">&quot;com.something.UserManager&quot;</span>&gt;    &lt;<span class="hljs-keyword">property</span> <span class="hljs-built_in">name</span>=<span class="hljs-string">&quot;userPreferences&quot;</span> <span class="hljs-keyword">ref</span>=<span class="hljs-string">&quot;userPreferences&quot;</span>/&gt;&lt;/bean&gt;<br></code></pre></td></tr></table></figure><h6 id="é€‰æ‹©è¦åˆ›å»ºçš„ä»£ç†ç±»å‹"><a href="#é€‰æ‹©è¦åˆ›å»ºçš„ä»£ç†ç±»å‹" class="headerlink" title="é€‰æ‹©è¦åˆ›å»ºçš„ä»£ç†ç±»å‹"></a>é€‰æ‹©è¦åˆ›å»ºçš„ä»£ç†ç±»å‹</h6><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“Springå®¹å™¨ä¸ºä½¿ç”¨<code>&lt;aop:scoped-proxy/&gt;</code> å…ƒç´ æ ‡è®°çš„beanåˆ›å»ºä»£ç†æ—¶ï¼Œå°†åˆ›å»ºåŸºäºCGLIBçš„ç±»ä»£ç†ã€‚</p><p>CGLIBä»£ç†åªæ‹¦æˆªå…¬å…±æ–¹æ³•è°ƒç”¨ï¼ ä¸è¦åœ¨è¿™æ ·çš„ä»£ç†ä¸Šè°ƒç”¨éå…¬å…±æ–¹æ³•ã€‚ å®ƒä»¬ä¸ä¼šå§”æ‰˜ç»™å®é™…çš„ä½œç”¨åŸŸç›®æ ‡å¯¹è±¡ã€‚</p><p>æˆ–è€…ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä¸º<code>&lt;aop:scoped-proxy/&gt;</code>å…ƒç´ çš„<code>proxy-target-class</code> å±æ€§çš„å€¼æŒ‡å®š<code>false</code>æ¥é…ç½®Springå®¹å™¨ï¼Œ ä»¥ä¾¿ä¸ºæ­¤ç±»ä½œç”¨åŸŸbeanåˆ›å»ºåŸºäºJDKæ¥å£çš„æ ‡å‡†ä»£ç†ã€‚ ä½¿ç”¨åŸºäºæ¥å£çš„JDKä»£ç†æ„å‘³ç€å¼€å‘è€…æ— éœ€å¼•å…¥ç¬¬ä¸‰æ–¹åº“å³å¯å®Œæˆä»£ç†ã€‚ ä½†æ˜¯ï¼Œè¿™ä¹Ÿæ„å‘³ç€å¸¦ä½œç”¨åŸŸçš„beanéœ€è¦é¢å¤–å®ç°ä¸€ä¸ªæ¥å£ï¼Œè€Œä¾èµ–æ˜¯ä»è¿™äº›æ¥å£æ¥è·å–çš„ã€‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºåŸºäºæ¥å£çš„ä»£ç†ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- DefaultUserPreferences implements the UserPreferences interface --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userPreferences&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.stuff.DefaultUserPreferences&quot;</span> <span class="hljs-attr">scope</span>=<span class="hljs-string">&quot;session&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">aop:scoped-proxy</span> <span class="hljs-attr">proxy-target-class</span>=<span class="hljs-string">&quot;false&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userManager&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.stuff.UserManager&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;userPreferences&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;userPreferences&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æœ‰å…³é€‰æ‹©åŸºäºç±»æˆ–åŸºäºæ¥å£çš„ä»£ç†çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#aop-proxying">ä»£ç†æœºåˆ¶</a>ã€‚</p><h4 id="1-5-5-è‡ªå®šä¹‰ä½œç”¨åŸŸ"><a href="#1-5-5-è‡ªå®šä¹‰ä½œç”¨åŸŸ" class="headerlink" title="1.5.5. è‡ªå®šä¹‰ä½œç”¨åŸŸ"></a>1.5.5. è‡ªå®šä¹‰ä½œç”¨åŸŸ</h4><p>beançš„ä½œç”¨åŸŸæœºåˆ¶æ˜¯å¯æ‰©å±•çš„ï¼Œå¼€å‘è€…å¯ä»¥è‡ªå®šä¹‰ä½œç”¨åŸŸï¼Œç”šè‡³é‡æ–°å®šä¹‰å·²ç»å­˜åœ¨çš„ä½œç”¨åŸŸï¼Œä½†æ˜¯Springå›¢é˜Ÿä¸æ¨èè¿™æ ·åšï¼Œè€Œä¸”å¼€å‘è€…ä¹Ÿä¸èƒ½é‡å†™<code>singleton</code> å’Œ <code>prototype</code>ä½œç”¨åŸŸã€‚</p><h5 id="åˆ›å»ºè‡ªå®šä¹‰ä½œç”¨åŸŸ"><a href="#åˆ›å»ºè‡ªå®šä¹‰ä½œç”¨åŸŸ" class="headerlink" title="åˆ›å»ºè‡ªå®šä¹‰ä½œç”¨åŸŸ"></a>åˆ›å»ºè‡ªå®šä¹‰ä½œç”¨åŸŸ</h5><p>ä¸ºäº†èƒ½å¤Ÿä½¿Springå¯ä»¥ç®¡ç†å¼€å‘è€…å®šä¹‰çš„ä½œç”¨åŸŸï¼Œå¼€å‘è€…éœ€è¦å®ç°<code>org.springframework.beans.factory.config.Scope</code>ã€‚å¦‚ä½•å®ç°è‡ªå®šä¹‰çš„ä½œç”¨åŸŸï¼Œ å¯ä»¥å‚è€ƒSpringæ¡†æ¶çš„ä¸€äº›å®ç°æˆ–è€…æœ‰å…³<a href="https://docs.spring.io/spring-framework/docs/5.1.3.BUILD-SNAPSHOT/javadoc-api/org/springframework/beans/factory/config/Scope.html"><code>Scope</code></a> çš„javadoc</p><p><code>Scope</code>æ¥å£æœ‰å››ä¸ªæ–¹æ³•ç”¨äºæ“ä½œå¯¹è±¡,ä¾‹å¦‚è·å–ã€ç§»é™¤æˆ–é”€æ¯ç­‰æ“ä½œã€‚</p><p>ä¾‹å¦‚ï¼Œä¼ å…¥Sessionä½œç”¨åŸŸè¯¥æ–¹æ³•å°†ä¼šè¿”å›ä¸€ä¸ª session-scopedçš„beanï¼ˆå¦‚æœå®ƒä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå°†ä¼šè¿”å›ç»‘å®šsessionä½œç”¨åŸŸçš„æ–°å®ä¾‹ï¼‰ã€‚ä¸‹é¢çš„æ–¹æ³•è¿”å›ç›¸åº”ä½œç”¨åŸŸçš„å¯¹è±¡ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-built_in">Object</span> <span class="hljs-keyword">get</span>(<span class="hljs-built_in">String</span> name, ObjectFactory objectFactory)<br></code></pre></td></tr></table></figure><p>ä¸‹é¢çš„æ–¹æ³•å°†ä»ç›¸åº”çš„ä½œç”¨åŸŸä¸­ç§»é™¤å¯¹è±¡ã€‚åŒæ ·ï¼Œä»¥ä¼šè¯ä¸ºä¾‹ï¼Œè¯¥å‡½æ•°ä¼šåˆ é™¤ä¼šè¯ä½œç”¨åŸŸçš„Beanã€‚åˆ é™¤çš„å¯¹è±¡ä¼šä½œä¸ºè¿”å›å€¼è¿”å›ï¼Œå½“æ— æ³•æ‰¾åˆ°å¯¹è±¡æ—¶å°†è¿”å›nullã€‚ ä»¥ä¸‹æ–¹æ³•ä»ç›¸åº”ä½œç”¨åŸŸä¸­åˆ é™¤å¯¹è±¡ï¼š:</p><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs delphi"><span class="hljs-keyword">Object</span> remove(<span class="hljs-keyword">String</span> <span class="hljs-keyword">name</span>)<br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹æ–¹æ³•æ³¨å†ŒèŒƒå›´åœ¨é”€æ¯æ—¶æˆ–åœ¨Scopeä¸­çš„æŒ‡å®šå¯¹è±¡è¢«é”€æ¯æ—¶åº”è¯¥æ‰§è¡Œçš„å›è°ƒ:</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">registerDestructionCallback</span><span class="hljs-params">(<span class="hljs-type">String</span> name, Runnable destructionCallback)</span></span><br></code></pre></td></tr></table></figure><p>æœ‰å…³é”€æ¯å›è°ƒçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚çœ‹<a href="https://docs.spring.io/spring-framework/docs/5.1.3.BUILD-SNAPSHOT/javadoc-api/org/springframework/beans/factory/config/Scope.html#registerDestructionCallback">javadoc</a>æˆ–Springçš„Scopeå®ç°éƒ¨åˆ†ã€‚</p><p>ä¸‹é¢çš„æ–¹æ³•è·å–ç›¸åº”ä½œç”¨åŸŸçš„åŒºåˆ†æ ‡è¯†ç¬¦:</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-variable">String</span> <span class="hljs-function"><span class="hljs-title">getConversationId</span>()</span><br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæ ‡è¯†ç¬¦åœ¨ä¸åŒçš„ä½œç”¨åŸŸä¸­æ˜¯ä¸åŒçš„ã€‚ä¾‹å¦‚å¯¹äºä¼šè¯ä½œç”¨åŸŸï¼Œè¿™ä¸ªæ ‡è¯†ç¬¦å°±æ˜¯ä¼šè¯çš„æ ‡è¯†ç¬¦ã€‚.</p><h5 id="ä½¿ç”¨è‡ªå®šä¹‰ä½œç”¨åŸŸ"><a href="#ä½¿ç”¨è‡ªå®šä¹‰ä½œç”¨åŸŸ" class="headerlink" title="ä½¿ç”¨è‡ªå®šä¹‰ä½œç”¨åŸŸ"></a>ä½¿ç”¨è‡ªå®šä¹‰ä½œç”¨åŸŸ</h5><p>åœ¨å®ç°äº†è‡ªå®šä¹‰<code>ä½œç”¨åŸŸ</code>åï¼Œå¼€å‘è€…è¿˜éœ€è¦è®©Springå®¹å™¨èƒ½å¤Ÿè¯†åˆ«å‘ç°æ‰€åˆ›å»ºçš„æ–°<code>ä½œç”¨åŸŸ</code>ã€‚ä¸‹é¢çš„æ–¹æ³•å°±æ˜¯åœ¨Springå®¹å™¨ä¸­ç”¨æ¥æ³¨å†Œæ–°<code>Scope</code>çš„:</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">registerScope</span><span class="hljs-params">(<span class="hljs-type">String</span> scopeName, Scope scope)</span></span>;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•æ˜¯åœ¨<code>ConfigurableBeanFactory</code>çš„æ¥å£ä¸­å£°æ˜çš„ï¼Œå¯ä»¥ç”¨åœ¨å¤šæ•°çš„<code>ApplicationContext</code>å®ç°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ <code>BeanFactory</code>å±æ€§æ¥è°ƒç”¨ã€‚</p><p><code>registerScope(..)</code>æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç›¸å…³<code>ä½œç”¨åŸŸ</code>çš„å”¯ä¸€åç§°ã€‚ä¸¾ä¾‹æ¥è¯´ï¼ŒSpringå®¹å™¨ä¸­çš„å•ä¾‹å’ŒåŸå‹å°±ä»¥å®ƒæœ¬èº«æ¥å‘½åã€‚ ç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯å¼€å‘è€…å¸Œæœ›æ³¨å†Œå’Œä½¿ç”¨çš„è‡ªå®šä¹‰<code>Scope</code>å®ç°çš„å…·æœ‰å¯¹è±¡ T</p><p>å‡å®šå¼€å‘è€…å®ç°äº†è‡ªå®šä¹‰<code>Scope</code>ï¼Œç„¶åå¯ä»¥æŒ‰å¦‚ä¸‹æ­¥éª¤æ¥æ³¨å†Œã€‚</p><p>ä¸‹ä¸€ä¸ªç¤ºä¾‹ä½¿ç”¨SimpleThreadScopeï¼Œè¿™ä¸ªä¾‹å­åœ¨Springä¸­æ˜¯æœ‰å®ç°çš„ï¼Œä½†æ²¡æœ‰é»˜è®¤æ³¨å†Œã€‚ æ‚¨è‡ªå®šä¹‰çš„ä½œç”¨åŸŸä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹çš„æ–¹å¼æ¥æ³¨å†Œã€‚</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs haxe">Scope threadScope = <span class="hljs-keyword">new</span> <span class="hljs-type">SimpleThreadScope</span>();<br><br>beanFactory.registerScope(<span class="hljs-string">&quot;thread&quot;</span>, threadScope);<br></code></pre></td></tr></table></figure><p>ç„¶åï¼Œæ‚¨å¯ä»¥åˆ›å»ºç¬¦åˆè‡ªå®šä¹‰Scopeçš„ä½œç”¨åŸŸè§„åˆ™çš„beanå®šä¹‰ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;bean <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;...&quot;</span> <span class="hljs-attribute">class</span>=<span class="hljs-string">&quot;...&quot;</span> <span class="hljs-attribute">scope</span>=<span class="hljs-string">&quot;thread&quot;</span>&gt;<br></code></pre></td></tr></table></figure><p>åœ¨è‡ªå®šä¹‰ä½œç”¨åŸŸä¸­ï¼Œå¼€å‘è€…ä¹Ÿä¸é™äºä»…ä»…é€šè¿‡ç¼–ç¨‹çš„æ–¹å¼æ¥æ³¨å†Œä½œç”¨åŸŸï¼Œè¿˜å¯ä»¥é€šè¿‡é…ç½®<code>CustomScopeConfigurer</code> ç±»æ¥å®ç°ã€‚å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span>    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>    <span class="hljs-attr">xmlns:aop</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/aop&quot;</span>    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans.xsd        http://www.springframework.org/schema/aop        http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.beans.factory.config.CustomScopeConfigurer&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;scopes&quot;</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">map</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;thread&quot;</span>&gt;</span>                    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.context.support.SimpleThreadScope&quot;</span>/&gt;</span>                <span class="hljs-tag">&lt;/<span class="hljs-name">entry</span>&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">map</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;thing2&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;x.y.Thing2&quot;</span> <span class="hljs-attr">scope</span>=<span class="hljs-string">&quot;thread&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Rick&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">aop:scoped-proxy</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;thing1&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;x.y.Thing1&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;thing2&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;thing2&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><p>åœ¨<code>FactoryBean</code>å®ç°ä¸­æ·»åŠ äº†<code>&lt;aop:scoped-proxy/&gt;</code>å…ƒç´ æ—¶ï¼Œå®ƒæ˜¯å·¥å‚beanæœ¬èº«çš„ä½œç”¨åŸŸï¼Œè€Œä¸æ˜¯ä»<code>getObject()</code>æ–¹æ³•è¿”å›çš„å¯¹è±¡ã€‚</p><h3 id="1-6-è‡ªå®šä¹‰Beançš„ç‰¹æ€§"><a href="#1-6-è‡ªå®šä¹‰Beançš„ç‰¹æ€§" class="headerlink" title="1.6. è‡ªå®šä¹‰Beançš„ç‰¹æ€§"></a>1.6. è‡ªå®šä¹‰Beançš„ç‰¹æ€§</h3><p>Spring Frameworkæä¾›äº†è®¸å¤šå¯ç”¨äºè‡ªå®šä¹‰beanç‰¹æ€§çš„æ¥å£ã€‚ æœ¬èŠ‚å°†å®ƒä»¬åˆ†ç»„å¦‚ä¸‹ï¼š</p><ul><li><a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-lifecycle">Lifecycle Callbacks(ç”Ÿå‘½å‘¨æœŸå›è°ƒ)</a></li><li><a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-aware"><code>ApplicationContextAware</code> and <code>BeanNameAware</code></a></li><li><a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#aware-list">å…¶ä»– <code>Aware</code> æ¥å£</a></li></ul><h4 id="1-6-1-ç”Ÿå‘½å‘¨æœŸå›è°ƒ"><a href="#1-6-1-ç”Ÿå‘½å‘¨æœŸå›è°ƒ" class="headerlink" title="1.6.1. ç”Ÿå‘½å‘¨æœŸå›è°ƒ"></a>1.6.1. ç”Ÿå‘½å‘¨æœŸå›è°ƒ</h4><p>ä½ å¯ä»¥å®ç°<code>InitializingBean</code> å’Œ <code>DisposableBean</code>æ¥å£ï¼Œè®©å®¹å™¨é‡Œç®¡ç†Beançš„ç”Ÿå‘½å‘¨æœŸã€‚å®¹å™¨ä¼šåœ¨è°ƒç”¨<code>afterPropertiesSet()</code> ä¹‹åå’Œ<code>destroy()</code>ä¹‹å‰ä¼šå…è®¸beanåœ¨åˆå§‹åŒ–å’Œé”€æ¯beanæ—¶æ‰§è¡ŒæŸäº›æ“ä½œã€‚</p><p>JSR-250 <code>@PostConstruct</code> å’Œ <code>@PreDestroy</code>æ³¨è§£é€šå¸¸è¢«è®¤ä¸ºæ˜¯åœ¨ç°ä»£Springåº”ç”¨ç¨‹åºä¸­æ¥æ”¶ç”Ÿå‘½å‘¨æœŸå›è°ƒçš„æœ€ä½³å®è·µã€‚ ä½¿ç”¨è¿™äº›æ³¨è§£æ„å‘³ç€æ‚¨çš„beanä¸ä¼šè€¦åˆåˆ°ç‰¹å®šäºSpringçš„æ¥å£ã€‚ æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-postconstruct-and-predestroy-annotations">ä½¿ç”¨ <code>@PostConstruct</code> å’Œ <code>@PreDestroy</code></a>.</p><p>å¦‚æœæ‚¨ä¸æƒ³ä½¿ç”¨JSR-250æ³¨è§£ä½†ä»æƒ³åˆ é™¤è€¦åˆï¼Œè¯·è€ƒè™‘ä½¿ç”¨<code>init-method</code> å’Œ <code>destroy-method</code>å®šä¹‰å¯¹è±¡å…ƒæ•°æ®ã€‚</p><p>åœ¨å†…éƒ¨ï¼ŒSpring æ¡†æ¶ä½¿ç”¨<code>BeanPostProcessor</code> å®ç°æ¥å¤„ç†ä»»ä½•å›è°ƒæ¥å£å¹¶è°ƒç”¨é€‚å½“çš„æ–¹æ³•ã€‚ å¦‚æœæ‚¨éœ€è¦Springé»˜è®¤æä¾›çš„è‡ªå®šä¹‰åŠŸèƒ½æˆ–å…¶ä»–ç”Ÿå‘½å‘¨æœŸè¡Œä¸ºï¼Œæ‚¨å¯ä»¥è‡ªå·±å®ç°<code>BeanPostProcessor</code>ã€‚ æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-extension">å®¹å™¨æ‰©å±•ç‚¹</a>ã€‚</p><p>é™¤äº†åˆå§‹åŒ–å’Œé”€æ¯æ–¹æ³•çš„å›è°ƒï¼ŒSpringç®¡ç†çš„å¯¹è±¡ä¹Ÿå®ç°äº†Lifecycleæ¥å£æ¥è®©ç®¡ç†çš„å¯¹è±¡åœ¨å®¹å™¨çš„<code>ç”Ÿå‘½å‘¨æœŸ</code>å†…å¯åŠ¨å’Œå…³é—­ã€‚</p><p>æœ¬èŠ‚æè¿°äº†ç”Ÿå‘½å‘¨æœŸå›è°ƒæ¥å£ã€‚.</p><h5 id="åˆå§‹åŒ–æ–¹æ³•å›è°ƒ"><a href="#åˆå§‹åŒ–æ–¹æ³•å›è°ƒ" class="headerlink" title="åˆå§‹åŒ–æ–¹æ³•å›è°ƒ"></a>åˆå§‹åŒ–æ–¹æ³•å›è°ƒ</h5><p><code>org.springframework.beans.factory.InitializingBean</code>æ¥å£å…è®¸beanåœ¨æ‰€æœ‰çš„å¿…è¦çš„ä¾èµ–é…ç½®å®Œæˆåæ‰§è¡Œbeançš„åˆå§‹åŒ–ï¼Œ <code>InitializingBean</code> æ¥å£ä¸­æŒ‡å®šä½¿ç”¨å¦‚ä¸‹æ–¹æ³•:</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">afterPropertiesSet</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception</span>;<br></code></pre></td></tr></table></figure><p>Springå›¢é˜Ÿæ˜¯ä¸å»ºè®®å¼€å‘è€…ä½¿ç”¨<code>InitializingBean</code>æ¥å£ï¼Œå› ä¸ºè¿™æ ·ä¼šå°†ä»£ç è€¦åˆåˆ°Springçš„ç‰¹æ®Šæ¥å£ä¸Šã€‚ä»–ä»¬å»ºè®®ä½¿ç”¨<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-postconstruct-and-predestroy-annotations"><code>@PostConstruct</code></a> æ³¨è§£æˆ–è€…æŒ‡å®šä¸€ä¸ªPOJOçš„å®ç°æ–¹æ³•ï¼Œ è¿™ä¼šæ¯”å®ç°æ¥å£æ›´å¥½ã€‚åœ¨åŸºäºXMLçš„å…ƒæ•°æ®é…ç½®ä¸Šï¼Œå¼€å‘è€…å¯ä»¥ä½¿ç”¨<code>init-method</code> å±æ€§æ¥æŒ‡å®šä¸€ä¸ªæ²¡æœ‰å‚æ•°çš„æ–¹æ³•ï¼Œä½¿ç”¨Javaé…ç½®çš„å¼€å‘è€…å¯ä»¥åœ¨<code>@Bean</code>ä¸Šæ·»åŠ  <code>initMethod</code> å±æ€§ã€‚ è¯·å‚é˜… <a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-java-lifecycle-callbacks">æ¥æ”¶ç”Ÿå‘½å‘¨æœŸå›è°ƒ</a>æ¥æ”¶ç”Ÿå‘½å‘¨æœŸå›è°ƒï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs csharp">&lt;bean id=<span class="hljs-string">&quot;exampleInitBean&quot;</span> <span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;examples.ExampleBean&quot;</span> <span class="hljs-keyword">init</span>-method=<span class="hljs-string">&quot;init&quot;</span>/&gt;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ExampleBean</span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span>()</span> &#123;        <span class="hljs-comment">// do some initialization work    &#125;&#125;</span><br></code></pre></td></tr></table></figure><p>å‰é¢çš„ç¤ºä¾‹ä¸ä»¥ä¸‹ç¤ºä¾‹ï¼ˆç”±ä¸¤ä¸ªåˆ—è¡¨ç»„æˆï¼‰å…·æœ‰å‡ ä¹å®Œå…¨ç›¸åŒçš„æ•ˆæœï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript">&lt;bean id=<span class="hljs-string">&quot;exampleInitBean&quot;</span> <span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;examples.AnotherExampleBean&quot;</span>/&gt;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AnotherExampleBean</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InitializingBean</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">afterPropertiesSet</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-comment">// do some initialization work    &#125;&#125;</span><br></code></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œå‰é¢ä¸¤ä¸ªç¤ºä¾‹ä¸­çš„ç¬¬ä¸€ä¸ªæ²¡æœ‰å°†ä»£ç è€¦åˆåˆ°Springã€‚</p><h5 id="é”€æ¯æ–¹æ³•çš„å›è°ƒ"><a href="#é”€æ¯æ–¹æ³•çš„å›è°ƒ" class="headerlink" title="é”€æ¯æ–¹æ³•çš„å›è°ƒ"></a>é”€æ¯æ–¹æ³•çš„å›è°ƒ</h5><p>å®ç°<code>org.springframework.beans.factory.DisposableBean</code> æ¥å£çš„Beanå°±èƒ½è®©å®¹å™¨é€šè¿‡å›è°ƒæ¥é”€æ¯beanæ‰€å¼•ç”¨çš„èµ„æºã€‚ <code>DisposableBean</code> æ¥å£æŒ‡å®šä¸€ä¸ªæ–¹æ³•ï¼š</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">destroy</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception</span>;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å»ºè®®æ‚¨ä¸è¦ä½¿ç”¨ <code>DisposableBean</code> å›è°ƒæ¥å£ï¼Œå› ä¸ºå®ƒä¼šä¸å¿…è¦åœ°å°†ä»£ç è€¦åˆåˆ°Springã€‚æˆ–è€…ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-postconstruct-and-predestroy-annotations"><code>@PreDestroy</code></a>æ³¨è§£ æˆ–æŒ‡å®šbeanå®šä¹‰æ”¯æŒçš„æ³›å‹æ–¹æ³•ã€‚ åœ¨åŸºäºXMLçš„å…ƒæ•°æ®é…ç½®ä¸­ï¼Œæ‚¨å¯ä»¥åœ¨<code>&lt;bean/&gt;</code>ä¸Šä½¿ç”¨<code>destroy-method</code>å±æ€§ã€‚ ä½¿ç”¨Javaé…ç½®ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<code>@Bean</code>çš„ <code>destroyMethod</code> å±æ€§ã€‚ è¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-java-lifecycle-callbacks">æ¥æ”¶ç”Ÿå‘½å‘¨æœŸå›è°ƒ</a>ã€‚ è€ƒè™‘ä»¥ä¸‹å®šä¹‰ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">&lt;bean id=&quot;exampleInitBean&quot; <span class="hljs-keyword">class</span>=&quot;examples.ExampleBean&quot; destroy-<span class="hljs-keyword">method</span>=&quot;cleanup&quot;/&gt;<br><span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> ExampleBean &#123;<br>    <span class="hljs-built_in">public</span> <span class="hljs-type">void</span> cleanup() &#123;        // <span class="hljs-keyword">do</span> <span class="hljs-keyword">some</span> destruction <span class="hljs-keyword">work</span> (<span class="hljs-keyword">like</span> releasing pooled connections)    &#125;&#125;<br></code></pre></td></tr></table></figure><p>å‰é¢çš„å®šä¹‰ä¸ä»¥ä¸‹å®šä¹‰å‡ ä¹å®Œå…¨ç›¸åŒï¼š:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript">&lt;bean id=<span class="hljs-string">&quot;exampleInitBean&quot;</span> <span class="hljs-keyword">class</span>=<span class="hljs-string">&quot;examples.AnotherExampleBean&quot;</span>/&gt;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AnotherExampleBean</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">DisposableBean</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">destroy</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-comment">// do some destruction work (like releasing pooled connections)    &#125;&#125;</span><br></code></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œå‰é¢ä¸¤ä¸ªå®šä¹‰ä¸­çš„ç¬¬ä¸€ä¸ªæ²¡æœ‰å°†ä»£ç è€¦åˆåˆ°Springã€‚.</p><p>æ‚¨å¯ä»¥ä¸º<code>&lt;bean&gt;</code> å…ƒç´ çš„<code>destroy-method</code>å±æ€§åˆ†é…ä¸€ä¸ªç‰¹æ®Šçš„ï¼ˆæ¨æ–­çš„ï¼‰å€¼ï¼Œè¯¥å€¼æŒ‡ç¤ºSpringè‡ªåŠ¨æ£€æµ‹ç‰¹å®šbeanç±»çš„<code>close</code>æˆ–è€…<code>shutdown</code>æ–¹æ³•ã€‚ ï¼ˆå› æ­¤ï¼Œä»»ä½•å®ç°<code>java.lang.AutoCloseable</code>æˆ–<code>java.io.Closeable</code>çš„ç±»éƒ½å°†åŒ¹é…ã€‚ï¼‰ æ‚¨è¿˜å¯ä»¥åœ¨<code>&lt;bean&gt;</code> å…ƒç´ çš„<code>default-destroy-method</code>å±æ€§ä¸Šè®¾ç½®æ­¤ç‰¹æ®Šï¼ˆæ¨æ–­ï¼‰å€¼ï¼Œç”¨äºè®©æ‰€æœ‰çš„beanéƒ½å®ç°è¿™ä¸ªè¡Œä¸ºï¼ˆ<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-lifecycle-default-init-destroy-methods">å‚è§é»˜è®¤åˆå§‹åŒ–å’Œé”€æ¯æ–¹æ³•</a>ï¼‰ã€‚ è¯·æ³¨æ„ï¼Œè¿™æ˜¯Javaé…ç½®çš„é»˜è®¤è¡Œä¸ºã€‚</p><h5 id="é»˜è®¤åˆå§‹åŒ–å’Œé”€æ¯æ–¹æ³•"><a href="#é»˜è®¤åˆå§‹åŒ–å’Œé”€æ¯æ–¹æ³•" class="headerlink" title="é»˜è®¤åˆå§‹åŒ–å’Œé”€æ¯æ–¹æ³•"></a>é»˜è®¤åˆå§‹åŒ–å’Œé”€æ¯æ–¹æ³•</h5><p>å½“æ‚¨ä¸ä½¿ç”¨Springç‰¹æœ‰çš„<code>InitializingBean</code>å’Œ <code>DisposableBean</code>å›è°ƒæ¥å£æ¥å®ç°åˆå§‹åŒ–å’Œé”€æ¯æ–¹æ³•æ—¶ï¼Œæ‚¨å®šä¹‰æ–¹æ³•çš„åç§°æœ€å¥½ç±»ä¼¼äº<code>init()</code>, <code>initialize()</code>, <code>dispose()</code>ã€‚ è¿™æ ·å¯ä»¥åœ¨é¡¹ç›®ä¸­æ ‡å‡†åŒ–ç±»æ–¹æ³•ï¼Œå¹¶è®©æ‰€æœ‰å¼€å‘è€…éƒ½ä½¿ç”¨ä¸€æ ·çš„åå­—æ¥ç¡®ä¿ä¸€è‡´æ€§ã€‚</p><p>æ‚¨å¯ä»¥é…ç½®Springå®¹å™¨æ¥é’ˆå¯¹æ¯ä¸€ä¸ªBeanéƒ½æŸ¥æ‰¾è¿™ç§åå­—çš„åˆå§‹åŒ–å’Œé”€æ¯å›è°ƒæ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ ä»»æ„çš„å¼€å‘è€…éƒ½ä¼šåœ¨åº”ç”¨çš„ç±»ä¸­ä½¿ç”¨ä¸€ä¸ªå« <code>init()</code>çš„åˆå§‹åŒ–å›è°ƒã€‚è€Œä¸éœ€è¦åœ¨æ¯ä¸ªbeanä¸­éƒ½å®šä¹‰<code>init-method=&quot;init&quot;</code> è¿™ç§å±æ€§ï¼Œ Spring IoCå®¹å™¨ä¼šåœ¨beanåˆ›å»ºçš„æ—¶å€™è°ƒç”¨é‚£ä¸ªå›è°ƒæ–¹æ³•ï¼ˆ<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-lifecycle">å¦‚å‰é¢æè¿°</a>çš„æ ‡å‡†ç”Ÿå‘½å‘¨æœŸä¸€æ ·ï¼‰ã€‚è¿™ä¸ªç‰¹æ€§ä¹Ÿå°†å¼ºåˆ¶å¼€å‘è€…ä¸ºå…¶ä»–çš„åˆå§‹åŒ–ä»¥åŠé”€æ¯å›è°ƒæ–¹æ³•ä½¿ç”¨åŒæ ·çš„åå­—ã€‚</p><p>å‡è®¾æ‚¨çš„åˆå§‹åŒ–å›è°ƒæ–¹æ³•åä¸º<code>init()</code>ï¼Œè€Œæ‚¨çš„destroyå›è°ƒæ–¹æ³•åä¸º<code>destroy()</code>ã€‚ ç„¶åï¼Œæ‚¨çš„ç±»ç±»ä¼¼äºä»¥ä¸‹ç¤ºä¾‹ä¸­çš„ç±»ï¼š</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-symbol">DefaultBlogService</span> <span class="hljs-symbol">implements</span> <span class="hljs-symbol">BlogService</span> &#123;<br>    <span class="hljs-keyword">private</span> BlogDao blogDao;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> setBlogDao(BlogDao blogDao) &#123;        <span class="hljs-keyword">this</span>.blogDao = blogDao;    &#125;<br>    <span class="hljs-comment">// this is (unsurprisingly) the initialization callback method    public void init() &#123;        if (this.blogDao == null) &#123;            throw new IllegalStateException(&quot;The [blogDao] property must be set.&quot;);        &#125;    &#125;&#125;</span><br></code></pre></td></tr></table></figure><p>ç„¶åï¼Œæ‚¨å¯ä»¥åœ¨ç±»ä¼¼äºä»¥ä¸‹å†…å®¹çš„beanä¸­ä½¿ç”¨è¯¥ç±»:</p><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs oxygene">&lt;beans <span class="hljs-keyword">default</span>-init-<span class="hljs-keyword">method</span>=&quot;<span class="hljs-title function_">init</span>&quot;&gt;<br>    &lt;<span class="hljs-title function_">bean</span> <span class="hljs-title function_">id</span>=&quot;<span class="hljs-title function_">blogService</span>&quot; <span class="hljs-title function_">class</span>=&quot;<span class="hljs-title function_">com</span>.<span class="hljs-title function_">something</span>.<span class="hljs-title function_">DefaultBlogService</span>&quot;&gt;        &lt;<span class="hljs-title function_">property</span> <span class="hljs-title function_">name</span>=&quot;<span class="hljs-title function_">blogDao</span>&quot; <span class="hljs-title function_">ref</span>=&quot;<span class="hljs-title function_">blogDao</span>&quot; /&gt;    &lt;/<span class="hljs-title function_">bean</span>&gt;<br>&lt;/<span class="hljs-title function_">beans</span>&gt;<br></code></pre></td></tr></table></figure><p>é¡¶çº§<code>&lt;beans/&gt;</code>å…ƒç´ å±æ€§ä¸Šå­˜åœ¨<code>default-init-method</code>å±æ€§ä¼šå¯¼è‡´Spring IoCå®¹å™¨å°†beanç±»ä¸Šçš„<code>init</code>æ–¹æ³•è¯†åˆ«ä¸ºåˆå§‹åŒ–æ–¹æ³•å›è°ƒã€‚ å½“beanè¢«åˆ›å»ºå’Œç»„è£…æ—¶ï¼Œå¦‚æœbeanæ‹¥æœ‰åŒåæ–¹æ³•çš„è¯ï¼Œåˆ™åœ¨é€‚å½“çš„æ—¶å€™è°ƒç”¨å®ƒã€‚</p><p>æ‚¨å¯ä»¥ä½¿ç”¨ <code>&lt;beans/&gt;</code>å…ƒç´ ä¸Šçš„<code>default-destroy-method</code>å±æ€§ï¼Œä»¥ç±»ä¼¼æ–¹å¼ï¼ˆåœ¨XMLä¸­ï¼‰é…ç½®destroyæ–¹æ³•å›è°ƒã€‚</p><p>å½“æŸäº›beanå·²æœ‰çš„å›è°ƒæ–¹æ³•ä¸é…ç½®çš„é»˜è®¤å›è°ƒæ–¹æ³•ä¸ç›¸åŒæ—¶ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡ç‰¹æŒ‡çš„æ–¹å¼æ¥è¦†ç›–æ‰é»˜è®¤çš„å›è°ƒæ–¹æ³•ã€‚ä»¥XMLä¸ºä¾‹ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨å…ƒç´ çš„<code>init-method</code> å’Œ<code>destroy-method</code>å±æ€§æ¥è¦†ç›–æ‰<code>&lt;bean/&gt;</code>ä¸­çš„é…ç½®ã€‚</p><p>Springå®¹å™¨ä¼šåšå‡ºå¦‚ä¸‹ä¿è¯ï¼Œbeanä¼šåœ¨è£…è½½äº†æ‰€æœ‰çš„ä¾èµ–ä»¥åï¼Œç«‹åˆ»å°±å¼€å§‹æ‰§è¡Œåˆå§‹åŒ–å›è°ƒã€‚è¿™æ ·çš„è¯ï¼Œåˆå§‹åŒ–å›è°ƒåªä¼šåœ¨ç›´æ¥çš„beanå¼•ç”¨è£…è½½å¥½åè°ƒç”¨ï¼Œ è€Œæ­¤æ—¶AOPæ‹¦æˆªå™¨è¿˜æ²¡æœ‰åº”ç”¨åˆ°beanä¸Šã€‚é¦–å…ˆç›®æ ‡çš„beanä¼šå…ˆå®Œå…¨åˆå§‹åŒ–ï¼Œç„¶åAOPä»£ç†å’Œæ‹¦æˆªé“¾æ‰èƒ½åº”ç”¨ã€‚å¦‚æœç›®æ ‡beanå’Œä»£ç†æ˜¯åˆ†å¼€å®šä¹‰çš„ï¼Œé‚£ä¹ˆå¼€å‘è€…çš„ä»£ç ç”šè‡³å¯ä»¥è·³è¿‡AOPè€Œç›´æ¥å’Œå¼•ç”¨çš„beanäº¤äº’ã€‚ å› æ­¤ï¼Œåœ¨åˆå§‹åŒ–æ–¹æ³•ä¸­åº”ç”¨æ‹¦æˆªå™¨ä¼šå‰åçŸ›ç›¾ï¼Œå› ä¸ºè¿™æ ·åšè€¦åˆäº†ç›®æ ‡beançš„ç”Ÿå‘½å‘¨æœŸå’Œä»£ç†&#x2F;æ‹¦æˆªå™¨ï¼Œè¿˜ä¼šå› ä¸ºä¸beanäº§ç”Ÿäº†ç›´æ¥äº¤äº’è¿›è€Œå¼•å‘ä¸å¯æ€è®®çš„ç°è±¡ã€‚</p><h5 id="ç»„åˆç”Ÿå‘½å‘¨æœŸç­–ç•¥"><a href="#ç»„åˆç”Ÿå‘½å‘¨æœŸç­–ç•¥" class="headerlink" title="ç»„åˆç”Ÿå‘½å‘¨æœŸç­–ç•¥"></a>ç»„åˆç”Ÿå‘½å‘¨æœŸç­–ç•¥</h5><p>ä»Spring 2.5å¼€å§‹ï¼Œæ‚¨æœ‰ä¸‰ç§é€‰æ‹©ç”¨äºæ§åˆ¶beanç”Ÿå‘½å‘¨æœŸè¡Œä¸º:</p><ul><li><a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-lifecycle-initializingbean"><code>InitializingBean</code></a> å’Œ <a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-lifecycle-disposablebean"><code>DisposableBean</code></a> å›è°ƒæ¥å£</li><li>è‡ªå®šä¹‰ <code>init()</code> å’Œ <code>destroy()</code> æ–¹æ³•</li><li><a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-postconstruct-and-predestroy-annotations"><code>@PostConstruct</code> å’Œ <code>@PreDestroy</code> æ³¨è§£</a>. ä½ ä¹Ÿå¯ä»¥åœ¨beanä¸ŠåŒæ—¶ä½¿ç”¨è¿™äº›æœºåˆ¶.</li></ul><p>å¦‚æœbeané…ç½®äº†å¤šä¸ªç”Ÿå‘½å‘¨æœŸæœºåˆ¶ï¼Œè€Œä¸”æ¯ä¸ªæœºåˆ¶éƒ½é…ç½®äº†ä¸åŒçš„æ–¹æ³•åå­—æ—¶ï¼Œæ¯ä¸ªé…ç½®çš„æ–¹æ³•ä¼šæŒ‰ç…§ä»¥ä¸‹æè¿°çš„é¡ºåºæ¥æ‰§è¡Œã€‚ä½†æ˜¯ï¼Œå¦‚æœé…ç½®äº†ç›¸åŒçš„åå­—ï¼Œ ä¾‹å¦‚åˆå§‹åŒ–å›è°ƒä¸º<code>init()</code>ï¼Œåœ¨ä¸æ­¢ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸæœºåˆ¶é…ç½®ä¸ºè¿™ä¸ªæ–¹æ³•çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªæ–¹æ³•åªä¼šæ‰§è¡Œä¸€æ¬¡ã€‚å¦‚<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-lifecycle-default-init-destroy-methods">ä¸Šä¸€èŠ‚ä¸­æ‰€è¿°</a>ã€‚</p><p>ä¸ºåŒä¸€ä¸ªbeané…ç½®çš„å¤šä¸ªç”Ÿå‘½å‘¨æœŸæœºåˆ¶å…·æœ‰ä¸åŒçš„åˆå§‹åŒ–æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><ol><li>åŒ…å«<code>@PostConstruct</code>æ³¨è§£çš„æ–¹æ³•</li><li>åœ¨<code>InitializingBean</code> æ¥å£ä¸­çš„<code>afterPropertiesSet()</code> æ–¹æ³•</li><li>è‡ªå®šä¹‰çš„<code>init()</code> æ–¹æ³•</li></ol><p>Destroyæ–¹æ³•ä»¥ç›¸åŒçš„é¡ºåºè°ƒç”¨:</p><ol><li>åŒ…å«<code>@PreDestroy</code>æ³¨è§£çš„æ–¹æ³•</li><li>åœ¨<code>DisposableBean</code>æ¥å£ä¸­çš„<code>destroy()</code> æ–¹æ³•</li><li>è‡ªå®šä¹‰çš„<code>destroy()</code> æ–¹æ³•</li></ol><h5 id="å¼€å§‹å’Œå…³é—­å›è°ƒ"><a href="#å¼€å§‹å’Œå…³é—­å›è°ƒ" class="headerlink" title="å¼€å§‹å’Œå…³é—­å›è°ƒ"></a>å¼€å§‹å’Œå…³é—­å›è°ƒ</h5><p><code>Lifecycle</code>æ¥å£ä¸­ä¸ºæ‰€æœ‰å…·æœ‰è‡ªå®šä¹‰ç”Ÿå‘½å‘¨æœŸéœ€æ±‚çš„å¯¹è±¡å®šä¹‰äº†ä¸€äº›åŸºæœ¬æ–¹æ³•ï¼ˆä¾‹å¦‚å¯åŠ¨æˆ–åœæ­¢ä¸€äº›åå°è¿›ç¨‹ï¼‰:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">Lifecycle</span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">start</span>()</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">stop</span>()</span>;<br>    <span class="hljs-function">boolean <span class="hljs-title">isRunning</span>()</span>;&#125;<br></code></pre></td></tr></table></figure><p>ä»»ä½•Springç®¡ç†çš„å¯¹è±¡éƒ½å¯ä»¥å®ç°<code>Lifecycle</code> æ¥å£ã€‚ç„¶åï¼Œå½“<code>ApplicationContext</code>æ¥æ”¶åˆ°å¯åŠ¨å’Œåœæ­¢ä¿¡å·æ—¶ï¼ˆä¾‹å¦‚ï¼Œå¯¹äºè¿è¡Œæ—¶çš„åœæ­¢&#x2F;é‡å¯åœºæ™¯ï¼‰ï¼ŒApplicationContextä¼šé€šçŸ¥åˆ°æ‰€æœ‰ä¸Šä¸‹æ–‡ä¸­åŒ…å«çš„ç”Ÿå‘½å‘¨æœŸå¯¹è±¡ã€‚ å®ƒé€šè¿‡å§”æ‰˜ <code>LifecycleProcessor</code>å®Œæˆæ­¤æ“ä½œï¼Œå¦‚ä¸‹é¢çš„æ¸…å•æ‰€ç¤ºï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">LifecycleProcessor</span> <span class="hljs-title">extends</span> <span class="hljs-title">Lifecycle</span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">onRefresh</span>()</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">onClose</span>()</span>;&#125;<br></code></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œ<code>LifecycleProcessor</code>æ˜¯ <code>Lifecycle</code>æ¥å£çš„æ‰©å±•ã€‚ å®ƒè¿˜æ·»åŠ äº†å¦å¤–ä¸¤ç§æ–¹æ³•æ¥å“åº”åˆ·æ–°å’Œå…³é—­çš„ä¸Šä¸‹æ–‡ã€‚</p><p>æ³¨æ„ï¼Œå¸¸è§„çš„<code>org.springframework.context.Lifecycle</code>æ¥å£åªæ˜¯ä¸ºæ˜ç¡®çš„å¼€å§‹&#x2F;åœæ­¢é€šçŸ¥æä¾›ä¸€ä¸ªçº¦æŸï¼Œè€Œå¹¶ä¸è¡¨ç¤ºåœ¨ä¸Šä¸‹æ–‡åˆ·æ–°å°±ä¼šè‡ªåŠ¨å¼€å§‹ã€‚ è¦å¯¹ç‰¹å®šbeançš„è‡ªåŠ¨å¯åŠ¨ï¼ˆåŒ…æ‹¬å¯åŠ¨é˜¶æ®µï¼‰è¿›è¡Œç»†ç²’åº¦æ§åˆ¶ï¼Œè¯·è€ƒè™‘å®ç°<code>org.springframework.context.SmartLifecycle</code>æ¥å£ã€‚</p><p>åŒæ—¶ï¼Œåœæ­¢é€šçŸ¥å¹¶ä¸èƒ½ä¿è¯åœ¨é”€æ¯ä¹‹å‰å‡ºç°ã€‚åœ¨æ­£å¸¸çš„å…³é—­æƒ…å†µä¸‹ï¼Œæ‰€æœ‰çš„<code>Lifecycle</code>éƒ½ä¼šåœ¨é”€æ¯å›è°ƒå‡†å¤‡å¥½ä¹‹å‰æ”¶åˆ°åœæ­¢é€šçŸ¥ï¼Œç„¶è€Œï¼Œ åœ¨ä¸Šä¸‹æ–‡ç”Ÿå‘½å‘¨æœŸä¸­çš„çƒ­åˆ·æ–°æˆ–è€…åœæ­¢å°è¯•åˆ·æ–°æ—¶ï¼Œåˆ™åªä¼šè°ƒç”¨é”€æ¯æ–¹æ³•ã€‚</p><p>å¯åŠ¨å’Œå…³é—­è°ƒç”¨çš„é¡ºåºéå¸¸é‡è¦ã€‚å¦‚æœä»»ä½•ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´å­˜åœ¨â€œä¾èµ–â€å…³ç³»ï¼Œåˆ™ä¾èµ–æ–¹åœ¨å…¶ä¾èµ–ä¹‹åå¼€å§‹ï¼Œå¹¶ä¸”åœ¨å…¶ä¾èµ–ä¹‹å‰åœæ­¢ã€‚ä½†æ˜¯ï¼Œæœ‰æ—¶ï¼Œç›´æ¥ä¾èµ–æ€§æ˜¯æœªçŸ¥çš„ã€‚ æ‚¨å¯èƒ½åªçŸ¥é“æŸç§ç±»å‹çš„å¯¹è±¡åº”è¯¥åœ¨å¦ä¸€ç§ç±»å‹çš„å¯¹è±¡ä¹‹å‰å¼€å§‹ã€‚ åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œ <code>SmartLifecycle</code>æ¥å£å®šä¹‰äº†å¦ä¸€ä¸ªé€‰é¡¹ï¼Œå³åœ¨å…¶è¶…çº§æ¥å£<code>Phased</code> ä¸Šå®šä¹‰çš„ <code>getPhase()</code> æ–¹æ³•ã€‚ ä»¥ä¸‹æ¸…å•æ˜¾ç¤ºäº†<code>Phased</code>æ¥å£çš„å®šä¹‰</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">Phased</span> &#123;<br>    <span class="hljs-function"><span class="hljs-built_in">int</span> <span class="hljs-title">getPhase</span>()</span>;&#125;<br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹æ¸…å•æ˜¾ç¤ºäº†<code>SmartLifecycle</code>æ¥å£çš„å®šä¹‰:</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-symbol">SmartLifecycle</span> <span class="hljs-symbol">extends</span> <span class="hljs-symbol">Lifecycle</span>, <span class="hljs-symbol">Phased</span> &#123;<br>    <span class="hljs-built_in">bool</span>ean isAutoStartup();<br>    <span class="hljs-built_in">void</span> stop(Runnable callback);&#125;<br></code></pre></td></tr></table></figure><p>å½“å¯åŠ¨æ—¶ï¼Œæ‹¥æœ‰æœ€ä½phasedçš„å¯¹è±¡ä¼šä¼˜å…ˆå¯åŠ¨ï¼Œè€Œå½“å…³é—­æ—¶ï¼Œä¼šç›¸åçš„é¡ºåºæ‰§è¡Œã€‚å› æ­¤ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡å®ç°äº†<code>SmartLifecycle</code>ï¼Œç„¶åä»¤å…¶<code>getPhase()</code>æ–¹æ³•è¿”å›<code>Integer.MIN_VALUE</code>å€¼çš„è¯ï¼Œ å°±ä¼šè®©è¯¥å¯¹è±¡æœ€æ—©å¯åŠ¨ï¼Œè€Œæœ€æ™šé”€æ¯ã€‚æ˜¾ç„¶ï¼Œå¦‚æœ<code>getPhase()</code>æ–¹æ³•è¿”å›äº†<code>Integer.MAX_VALUE</code>å€¼åˆ™è¡¨æ˜è¯¥å¯¹è±¡ä¼šæœ€æ™šå¯åŠ¨ï¼Œè€Œæœ€æ—©é”€æ¯ã€‚ å½“è€ƒè™‘åˆ°ä½¿ç”¨phasedå€¼æ—¶ï¼Œä¹ŸåŒæ—¶éœ€è¦äº†è§£æ­£å¸¸æ²¡æœ‰å®ç°<code>SmartLifecycle</code>çš„<code>Lifecycle</code>å¯¹è±¡çš„é»˜è®¤å€¼ï¼Œè¿™ä¸ªå€¼æ˜¯0ã€‚å› æ­¤ï¼Œé…ç½®ä»»æ„çš„è´Ÿå€¼éƒ½å°†è¡¨æ˜å°†å¯¹è±¡ä¼šåœ¨æ ‡å‡†ç»„ä»¶å¯åŠ¨ä¹‹å‰å¯åŠ¨ ï¼Œè€Œåœ¨æ ‡å‡†ç»„ä»¶é”€æ¯ä»¥åå†è¿›è¡Œé”€æ¯ã€‚</p><p><code>SmartLifecycle</code>æ¥å£ä¹Ÿå®šä¹‰äº†ä¸€ä¸ªåä¸ºstopçš„å›è°ƒæ–¹æ³•ï¼Œä»»ä½•å®ç°äº†<code>SmartLifecycle</code>æ¥å£çš„æ–¹æ³•éƒ½å¿…é¡»åœ¨å…³é—­æµç¨‹å®Œæˆä¹‹åè°ƒç”¨å›è°ƒä¸­çš„<code>run()</code>æ–¹æ³•ã€‚ è¿™æ ·åšå¯ä»¥è¿›è¡Œå¼‚æ­¥å…³é—­ï¼Œè€Œ<code>lifecycleProcessor</code>çš„é»˜è®¤å®ç°<code>DefaultLifecycleProcessor</code>ä¼šç­‰åˆ°é…ç½®çš„è¶…æ—¶æ—¶é—´ä¹‹åå†è°ƒç”¨å›è°ƒã€‚é»˜è®¤çš„æ¯ä¸€é˜¶æ®µçš„è¶…æ—¶æ—¶é—´ä¸º30ç§’ã€‚ æ‚¨å¯ä»¥é€šè¿‡åœ¨ä¸Šä¸‹æ–‡ä¸­å®šä¹‰åä¸º <code>lifecycleProcessor</code> çš„beanæ¥è¦†ç›–é»˜è®¤ç”Ÿå‘½å‘¨æœŸå¤„ç†å™¨å®ä¾‹ã€‚ å¦‚æœæ‚¨åªæƒ³ä¿®æ”¹è¶…æ—¶ï¼Œåˆ™å®šä¹‰ä»¥ä¸‹å†…å®¹å°±è¶³å¤Ÿäº†ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;lifecycleProcessor&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.context.support.DefaultLifecycleProcessor&quot;</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- timeout value in milliseconds --&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;timeoutPerShutdownPhase&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;10000&quot;</span>/&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å¦‚å‰æ‰€è¿°ï¼Œ<code>LifecycleProcessor</code> æ¥å£è¿˜å®šä¹‰äº†ç”¨äºåˆ·æ–°å’Œå…³é—­ä¸Šä¸‹æ–‡çš„å›è°ƒæ–¹æ³•ã€‚åœ¨å…³é—­è¿‡ç¨‹ä¸­ï¼Œå¦‚æœ<code>stop()</code>æ–¹æ³•å·²ç»è¢«è°ƒç”¨ï¼Œåˆ™å°±ä¼šæ‰§è¡Œå…³é—­æµç¨‹ã€‚ ä½†æ˜¯å¦‚æœä¸Šä¸‹æ–‡æ­£åœ¨å…³é—­ä¸­åˆ™ä¸ä¼šåœ¨è¿›è¡Œæ­¤æµç¨‹ï¼Œè€Œåˆ·æ–°çš„å›è°ƒä¼šä½¿ç”¨åˆ°<code>SmartLifecycle</code>çš„å¦ä¸€ä¸ªç‰¹æ€§ã€‚å½“ä¸Šä¸‹æ–‡åˆ·æ–°å®Œæ¯•ï¼ˆæ‰€æœ‰çš„å¯¹è±¡å·²ç»å®ä¾‹åŒ–å¹¶åˆå§‹åŒ–ï¼‰åï¼Œ å°±ä¼šè°ƒç”¨åˆ·æ–°å›è°ƒï¼Œé»˜è®¤çš„ç”Ÿå‘½å‘¨æœŸå¤„ç†å™¨ä¼šæ£€æŸ¥æ¯ä¸€ä¸ª<code>SmartLifecycle</code> å¯¹è±¡çš„<code>isAutoStartup()</code>æ–¹æ³•è¿”å›çš„Booleanå€¼.å¦‚æœä¸ºçœŸï¼Œå¯¹è±¡å°†ä¼šè‡ªåŠ¨å¯åŠ¨è€Œä¸æ˜¯ç­‰å¾…æ˜ç¡®çš„ä¸Šä¸‹æ–‡è°ƒç”¨ï¼Œ æˆ–è€…è°ƒç”¨è‡ªå·±çš„<code>start()</code>æ–¹æ³•(ä¸åŒäºä¸Šä¸‹æ–‡åˆ·æ–°ï¼Œæ ‡å‡†çš„ä¸Šä¸‹æ–‡å®ç°æ˜¯ä¸ä¼šè‡ªåŠ¨å¯åŠ¨çš„ï¼‰ã€‚<code>phase</code>çš„å€¼ä»¥åŠâ€œdepends-onâ€å…³ç³»ä¼šå†³å®šå¯¹è±¡å¯åŠ¨å’Œé”€æ¯çš„é¡ºåºã€‚</p><h5 id="åœ¨éWebåº”ç”¨ä¸­ä¼˜é›…åœ°å…³é—­Spring-IoCå®¹å™¨"><a href="#åœ¨éWebåº”ç”¨ä¸­ä¼˜é›…åœ°å…³é—­Spring-IoCå®¹å™¨" class="headerlink" title="åœ¨éWebåº”ç”¨ä¸­ä¼˜é›…åœ°å…³é—­Spring IoCå®¹å™¨"></a>åœ¨éWebåº”ç”¨ä¸­ä¼˜é›…åœ°å…³é—­Spring IoCå®¹å™¨</h5><p>æœ¬èŠ‚ä»…é€‚ç”¨äºéWebåº”ç”¨ç¨‹åºã€‚ Springçš„åŸºäºWebçš„<code>ApplicationContext</code> å®ç°å·²ç»å…·æœ‰ä»£ç ï¼Œå¯ä»¥åœ¨å…³é—­ç›¸å…³Webåº”ç”¨ç¨‹åºæ—¶æ­£å¸¸å…³é—­Spring IoCå®¹å™¨ã€‚</p><p>å¦‚æœå¼€å‘è€…åœ¨éWebåº”ç”¨ç¯å¢ƒä½¿ç”¨Spring IoCå®¹å™¨çš„è¯ï¼ˆä¾‹å¦‚ï¼Œåœ¨æ¡Œé¢å®¢æˆ·ç«¯çš„ç¯å¢ƒä¸‹ï¼‰å¼€å‘è€…éœ€è¦åœ¨JVMä¸Šæ³¨å†Œä¸€ä¸ªå…³é—­çš„é’©å­ï¼Œæ¥ç¡®ä¿åœ¨å…³é—­Spring IoCå®¹å™¨çš„æ—¶å€™èƒ½å¤Ÿè°ƒç”¨ç›¸å…³çš„é”€æ¯æ–¹æ³•æ¥é‡Šæ”¾æ‰å¼•ç”¨çš„èµ„æºã€‚ å½“ç„¶ï¼Œå¼€å‘è€…ä¹Ÿå¿…é¡»æ­£ç¡®é…ç½®å’Œå®ç°é‚£äº›é”€æ¯å›è°ƒã€‚</p><p>è¦æ³¨å†Œå…³é—­é’©å­ï¼Œè¯·è°ƒç”¨<code>ConfigurableApplicationContext</code>æ¥å£ä¸Šå£°æ˜çš„<code>registerShutdownHook()</code> æ–¹æ³•ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.springframework.context.ConfigurableApplicationContext;<span class="hljs-keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Boot</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-keyword">final</span> String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;        <span class="hljs-type">ConfigurableApplicationContext</span> <span class="hljs-variable">ctx</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathXmlApplicationContext</span>(<span class="hljs-string">&quot;beans.xml&quot;</span>);<br>        <span class="hljs-comment">// add a shutdown hook for the above context...        ctx.registerShutdownHook();</span><br>        <span class="hljs-comment">// app runs here...</span><br>        <span class="hljs-comment">// main method exits, hook is called prior to the app shutting down...    &#125;&#125;</span><br></code></pre></td></tr></table></figure><h4 id="1-6-2-ApplicationContextAware-å’Œ-BeanNameAware"><a href="#1-6-2-ApplicationContextAware-å’Œ-BeanNameAware" class="headerlink" title="1.6.2. ApplicationContextAware å’Œ BeanNameAware"></a>1.6.2. <code>ApplicationContextAware</code> å’Œ <code>BeanNameAware</code></h4><p>å½“<code>ApplicationContext</code> åˆ›å»ºå®ç°<code>org.springframework.context.ApplicationContextAware</code>æ¥å£çš„å¯¹è±¡å®ä¾‹æ—¶ï¼Œå°†ä¸ºè¯¥å®ä¾‹æä¾›å¯¹è¯¥ <code>ApplicationContext</code>.çš„å¼•ç”¨ã€‚ ä»¥ä¸‹æ¸…å•æ˜¾ç¤ºäº†<code>ApplicationContextAware</code>æ¥å£çš„å®šä¹‰ï¼š</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ApplicationContextAware</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setApplicationContext</span><span class="hljs-params">(ApplicationContext applicationContext)</span> <span class="hljs-keyword">throws</span> BeansException</span>;&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·beanå°±èƒ½å¤Ÿé€šè¿‡ç¼–ç¨‹çš„æ–¹å¼åˆ›å»ºå’Œæ“ä½œ<code>ApplicationContext</code> äº†ã€‚é€šè¿‡<code>ApplicationContext</code> æ¥å£ï¼Œæˆ–è€…é€šè¿‡å°†å¼•ç”¨è½¬æ¢æˆå·²çŸ¥çš„æ¥å£çš„å­ç±»ï¼Œ ä¾‹å¦‚<code>ConfigurableApplicationContext</code>å°±èƒ½å¤Ÿæä¾›ä¸€äº›é¢å¤–çš„åŠŸèƒ½ã€‚å…¶ä¸­çš„ä¸€ä¸ªç”¨æ³•å°±æ˜¯å¯ä»¥é€šè¿‡ç¼–ç¨‹çš„æ–¹å¼æ¥è·å–å…¶ä»–çš„beanã€‚ æœ‰æ—¶å€™è¿™ä¸ªèƒ½åŠ›éå¸¸æœ‰ç”¨ã€‚å½“ç„¶ï¼ŒSpringå›¢é˜Ÿå¹¶ä¸æ¨èè¿™æ ·åšï¼Œå› ä¸ºè¿™æ ·ä¼šä½¿ä»£ç ä¸Springæ¡†æ¶è€¦åˆï¼ŒåŒæ—¶ä¹Ÿæ²¡æœ‰éµå¾ªIoCçš„é£æ ¼ã€‚ <code>ApplicationContext</code> ä¸­å…¶å®ƒçš„æ–¹æ³•å¯ä»¥æä¾›ä¸€äº›è¯¸å¦‚èµ„æºçš„è®¿é—®ã€å‘å¸ƒåº”ç”¨äº‹ä»¶æˆ–è€…æ·»åŠ <code>MessageSource</code>ä¹‹ç±»çš„åŠŸèƒ½ã€‚<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#context-introduction"><code>ApplicationContext</code>çš„é™„åŠ åŠŸèƒ½</a>ä¸­æè¿°äº†è¿™äº›é™„åŠ åŠŸèƒ½ã€‚</p><p>ä»Spring 2.5å¼€å§‹ï¼Œ è‡ªåŠ¨è£…é…æ˜¯å¦ä¸€ç§è·å–<code>ApplicationContext</code>å¼•ç”¨çš„æ›¿ä»£æ–¹æ³•ã€‚ä¼ ç»Ÿçš„çš„<code>æ„é€ å‡½æ•°</code> å’Œ <code>byType</code>çš„è£…è½½æ–¹å¼è‡ªåŠ¨è£…é…æ¨¡å¼ï¼ˆå¦‚<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-autowire">è‡ªåŠ¨è£…é…</a>ä¸­æ‰€è¿°ï¼‰ å¯ä»¥é€šè¿‡æ„é€ å‡½æ•°æˆ–setteræ–¹æ³•çš„æ–¹å¼æ³¨å…¥ï¼Œå¼€å‘è€…ä¹Ÿå¯ä»¥é€šè¿‡æ³¨è§£æ³¨å…¥çš„æ–¹å¼ã€‚ä¸ºäº†æ›´ä¸ºæ–¹ä¾¿ï¼ŒåŒ…æ‹¬å¯ä»¥æ³¨å…¥çš„å­—æ®µå’Œå¤šä¸ªå‚æ•°æ–¹æ³•ï¼Œè¯·ä½¿ç”¨æ–°çš„åŸºäºæ³¨è§£çš„è‡ªåŠ¨è£…é…åŠŸèƒ½ã€‚ è¿™æ ·ï¼Œ<code>ApplicationContext</code>å°†è‡ªåŠ¨è£…é…å­—æ®µã€æ„é€ å‡½æ•°å‚æ•°æˆ–æ–¹æ³•å‚æ•°ï¼Œå¦‚æœç›¸å…³çš„å­—æ®µï¼Œæ„é€ å‡½æ•°æˆ–æ–¹æ³•å¸¦æœ‰ <code>@Autowired</code>æ³¨è§£ï¼Œåˆ™è¯¥å‚æ•°éœ€è¦<code>ApplicationContext</code>ç±»å‹ã€‚ æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-autowired-annotation">ä½¿ç”¨ <code>@Autowired</code></a>@Autowiredã€‚</p><p>å½“<code>ApplicationContext</code>åˆ›å»ºå®ç°äº†<code>org.springframework.beans.factory.BeanNameAware</code>æ¥å£çš„ç±»ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»å°±å¯ä»¥é’ˆå¯¹å…¶åå­—è¿›è¡Œé…ç½®ã€‚ä»¥ä¸‹æ¸…å•æ˜¾ç¤ºäº†BeanNameAwareæ¥å£çš„å®šä¹‰ï¼š:</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">BeanNameAware</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setBeanName</span><span class="hljs-params">(String name)</span> <span class="hljs-keyword">throws</span> BeansException</span>;&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå›è°ƒçš„è°ƒç”¨åœ¨å±æ€§é…ç½®å®Œæˆä¹‹åï¼Œä½†æ˜¯åœ¨åˆå§‹åŒ–å›è°ƒä¹‹å‰ã€‚ä¾‹å¦‚<code>InitializingBean</code>, <code>afterPropertiesSet</code>æ–¹æ³•ä»¥åŠè‡ªå®šä¹‰çš„åˆå§‹åŒ–æ–¹æ³•ç­‰ã€‚</p><h4 id="1-6-3-å…¶ä»–çš„-Awareæ¥å£"><a href="#1-6-3-å…¶ä»–çš„-Awareæ¥å£" class="headerlink" title="1.6.3. å…¶ä»–çš„ Awareæ¥å£"></a>1.6.3. å…¶ä»–çš„ <code>Aware</code>æ¥å£</h4><p>é™¤äº† <code>ApplicationContextAware</code>å’Œ<code>BeanNameAware</code>ï¼ˆå‰é¢å·²è®¨è®ºè¿‡ï¼‰ä¹‹å¤–ï¼ŒSpringè¿˜æä¾›äº†ä¸€ç³»åˆ—<code>Aware</code>æ¥å£ï¼Œè®©beanå‘Šè¯‰å®¹å™¨ï¼Œå®ƒä»¬éœ€è¦ä¸€äº›å…·ä½“çš„åŸºç¡€é…ç½®ä¿¡æ¯ã€‚ã€‚ ä¸€äº›é‡è¦çš„<code>Aware</code>æ¥å£å‚çœ‹ä¸‹è¡¨ï¼š</p><p>Table 4. Aware æ¥å£</p><table><thead><tr><th>åç§°</th><th>æ³¨å…¥çš„ä¾èµ–</th><th>æ‰€å¯¹åº”çš„ç« èŠ‚</th></tr></thead><tbody><tr><td><code>ApplicationContextAware</code></td><td>å£°æ˜ <code>ApplicationContext</code></td><td><a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-aware"><code>ApplicationContextAware</code> å’Œ <code>BeanNameAware</code></a></td></tr><tr><td><code>ApplicationEventPublisherAware</code></td><td><code>ApplicationContext</code>çš„äº‹ä»¶å‘å¸ƒè€…</td><td><a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#context-introduction"><code>ApplicationContext</code>çš„å…¶ä»–åŠŸèƒ½</a></td></tr><tr><td><code>BeanClassLoaderAware</code></td><td>ç”¨äºåŠ è½½beanç±»çš„ç±»åŠ è½½å™¨</td><td><a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-class">å®ä¾‹åŒ–Bean</a></td></tr><tr><td><code>BeanFactoryAware</code></td><td>å£°æ˜ <code>BeanFactory</code>.</td><td><a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-aware"><code>ApplicationContextAware</code> å’Œ <code>BeanNameAware</code></a></td></tr><tr><td><code>BeanNameAware</code></td><td>å£°æ˜beançš„åç§°.</td><td><a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-aware"><code>ApplicationContextAware</code> å’Œ <code>BeanNameAware</code></a></td></tr><tr><td><code>BootstrapContextAware</code></td><td>å®¹å™¨è¿è¡Œçš„èµ„æºé€‚é…å™¨<code>BootstrapContext</code>ã€‚é€šå¸¸ä»…åœ¨JCAæ„ŸçŸ¥çš„ <code>ApplicationContext</code> å®ä¾‹ä¸­å¯ç”¨</td><td><a href="https://github.com/DocsHome/spring-docs/blob/master/pages/integration/integration.md#cci">JCA CCI</a></td></tr><tr><td><code>LoadTimeWeaverAware</code></td><td>å®šä¹‰çš„weaverç”¨äºåœ¨åŠ è½½æ—¶å¤„ç†ç±»å®šä¹‰.</td><td><a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#aop-aj-ltw">åœ¨Springæ¡†æ¶ä¸­ä½¿ç”¨AspectJè¿›è¡ŒåŠ è½½æ—¶ç»‡å…¥</a></td></tr><tr><td><code>MessageSourceAware</code></td><td>ç”¨äºè§£ææ¶ˆæ¯çš„å·²é…ç½®ç­–ç•¥ï¼ˆæ”¯æŒå‚æ•°åŒ–å’Œå›½é™…åŒ–ï¼‰</td><td><a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#context-introduction"><code>ApplicationContext</code>çš„å…¶ä»–ä½œç”¨</a></td></tr><tr><td><code>NotificationPublisherAware</code></td><td>Spring JMXé€šçŸ¥å‘å¸ƒè€…</td><td><a href="https://github.com/DocsHome/spring-docs/blob/master/pages/integration/integration.md#jmx-notifications">é€šçŸ¥</a></td></tr><tr><td><code>ResourceLoaderAware</code></td><td>é…ç½®çš„èµ„æºåŠ è½½å™¨</td><td><a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#resources">èµ„æº</a></td></tr><tr><td><code>ServletConfigAware</code></td><td>å½“å‰<code>ServletConfig</code>å®¹å™¨è¿è¡Œã€‚ä»…åœ¨Webä¸‹çš„Spring <code>ApplicationContext</code>ä¸­æœ‰æ•ˆ</td><td><a href="https://github.com/DocsHome/spring-docs/blob/master/pages/web/web.md#mvc">Spring MVC</a></td></tr><tr><td><code>ServletContextAware</code></td><td>å®¹å™¨è¿è¡Œçš„å½“å‰ServletContextã€‚ä»…åœ¨Webä¸‹çš„Spring <code>ApplicationContext</code>ä¸­æœ‰æ•ˆã€‚</td><td><a href="https://github.com/DocsHome/spring-docs/blob/master/pages/web/web.md#mvc">Spring MVC</a></td></tr></tbody></table><p>è¯·å†æ¬¡æ³¨æ„ï¼Œä½¿ç”¨è¿™äº›æ¥å£ä¼šå°†æ‚¨çš„ä»£ç ç»‘å®šåˆ°Spring APIï¼Œè€Œä¸ä¼šéµå¾ªIoCåŸåˆ™ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å»ºè®®å°†å®ƒä»¬ç”¨äºéœ€è¦ä»¥ç¼–ç¨‹æ–¹å¼è®¿é—®å®¹å™¨çš„åŸºç¡€æ¶æ„beanã€‚</p><h3 id="1-7-beanå®šä¹‰çš„ç»§æ‰¿"><a href="#1-7-beanå®šä¹‰çš„ç»§æ‰¿" class="headerlink" title="1.7. beanå®šä¹‰çš„ç»§æ‰¿"></a>1.7. beanå®šä¹‰çš„ç»§æ‰¿</h3><p>beanå®šä¹‰å¯ä»¥åŒ…å«è®¸å¤šé…ç½®ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ„é€ å‡½æ•°å‚æ•°ï¼Œå±æ€§å€¼å’Œç‰¹å®šäºå®¹å™¨çš„ä¿¡æ¯ï¼Œä¾‹å¦‚åˆå§‹åŒ–æ–¹æ³•ï¼Œé™æ€å·¥å‚æ–¹æ³•åç§°ç­‰ã€‚ å­beanå®šä¹‰ä»çˆ¶å®šä¹‰ç»§æ‰¿é…ç½®æ•°æ®ã€‚ å­å®šä¹‰å¯ä»¥è¦†ç›–æŸäº›å€¼æˆ–æ ¹æ®éœ€è¦æ·»åŠ å…¶ä»–å€¼ã€‚ ä½¿ç”¨çˆ¶å­beanå®šä¹‰å¯ä»¥èŠ‚çœå¾ˆå¤šé…ç½®è¾“å…¥ã€‚ å®é™…ä¸Šï¼Œè¿™æ˜¯ä¸€ç§æ¨¡æ¿å½¢å¼ã€‚</p><p>å¦‚æœå¼€å‘è€…ç¼–ç¨‹å¼åœ°ä½¿ç”¨<code>ApplicationContext</code>æ¥å£ï¼Œå­beanå®šä¹‰å¯ä»¥é€šè¿‡<code>ChildBeanDefinition</code>ç±»æ¥è¡¨ç¤ºã€‚å¾ˆå¤šå¼€å‘è€…ä¸ä¼šä½¿ç”¨è¿™ä¸ªçº§åˆ«çš„æ–¹æ³•ï¼Œ è€Œæ˜¯ä¼šåœ¨ç±»ä¼¼äº<code>ClassPathXmlApplicationContext</code>ä¸­å£°æ˜å¼åœ°é…ç½®beanå®šä¹‰ã€‚å½“ä½ ä½¿ç”¨åŸºäºXMLçš„é…ç½®æ—¶ï¼Œä½ å¯ä»¥åœ¨å­beanä¸­ä½¿ç”¨parentå±æ€§ï¼Œè¯¥å±æ€§çš„å€¼ç”¨æ¥è¯†åˆ«çˆ¶beanã€‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;inheritedTestBean&quot;</span> <span class="hljs-attr">abstract</span>=<span class="hljs-string">&quot;true&quot;</span>        <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.beans.TestBean&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;parent&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;age&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;1&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;inheritsWithDifferentClass&quot;</span>        <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.beans.DerivedTestBean&quot;</span>        <span class="hljs-attr">parent</span>=<span class="hljs-string">&quot;inheritedTestBean&quot;</span> <span class="hljs-attr">init-method</span>=<span class="hljs-string">&quot;initialize&quot;</span>&gt;</span>  (1)    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;override&quot;</span>/&gt;</span>    <span class="hljs-comment">&lt;!-- the age property value of 1 will be inherited from parent --&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>1</strong>ã€‚è¯·æ³¨æ„<code>parent</code>å±æ€§ã€‚</p><p>å­beanå¦‚æœæ²¡æœ‰æŒ‡å®šclassï¼Œå®ƒå°†ä½¿ç”¨çˆ¶beanå®šä¹‰çš„classã€‚ä½†ä¹Ÿå¯ä»¥è¿›è¡Œé‡å†™ã€‚åœ¨åä¸€ç§æƒ…å†µä¸­ï¼Œå­beanå¿…é¡»ä¸çˆ¶beanå…¼å®¹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒå¿…é¡»æ¥å—çˆ¶beançš„å±æ€§å€¼ã€‚</p><p>å­beanå®šä¹‰ä»çˆ¶ç±»ç»§æ‰¿ä½œç”¨åŸŸã€æ„é€ å™¨å‚æ•°ã€å±æ€§å€¼å’Œå¯é‡å†™çš„æ–¹æ³•ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥å¢åŠ æ–°å€¼ã€‚å¼€å‘è€…æŒ‡å®šä»»ä½•ä½œç”¨åŸŸã€åˆå§‹åŒ–æ–¹æ³•ã€é”€æ¯æ–¹æ³•å’Œ&#x2F;æˆ–è€…é™æ€å·¥å‚æ–¹æ³•è®¾ç½®éƒ½ä¼šè¦†ç›–ç›¸åº”çš„çˆ¶beanè®¾ç½®ã€‚</p><p>å‰©ä¸‹çš„è®¾ç½®ä¼šå–å­beanå®šä¹‰ï¼šä¾èµ–ã€è‡ªåŠ¨æ³¨å…¥æ¨¡å¼ã€ä¾èµ–æ£€æŸ¥ã€å•ä¾‹ã€å»¶è¿ŸåŠ è½½ã€‚</p><p>å‰é¢çš„ç¤ºä¾‹é€šè¿‡ä½¿ç”¨<code>abstract</code>å±æ€§å°†çˆ¶beanå®šä¹‰æ˜¾å¼æ ‡è®°ä¸º<code>abstract</code>ã€‚ å¦‚æœçˆ¶å®šä¹‰æœªæŒ‡å®šç±»ï¼Œåˆ™éœ€è¦å°†çˆ¶beanå®šä¹‰æ˜¾å¼æ ‡è®°ä¸º<code>abstract</code>ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;inheritedTestBeanWithoutClass&quot;</span> <span class="hljs-attr">abstract</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;parent&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;age&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;1&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;inheritsWithClass&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.beans.DerivedTestBean&quot;</span>        <span class="hljs-attr">parent</span>=<span class="hljs-string">&quot;inheritedTestBeanWithoutClass&quot;</span> <span class="hljs-attr">init-method</span>=<span class="hljs-string">&quot;initialize&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;override&quot;</span>/&gt;</span>    <span class="hljs-comment">&lt;!-- age will inherit the value of 1 from the parent bean definition--&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p>çˆ¶beanä¸èƒ½å•ç‹¬å®ä¾‹åŒ–ï¼Œå› ä¸ºå®ƒä¸å®Œæ•´ï¼Œå¹¶ä¸”ä¹Ÿæ˜ç¡®æ ‡è®°ä¸º<code>abstract</code>ã€‚å½“å®šä¹‰æ˜¯<code>abstract</code>çš„æ—¶ï¼Œå®ƒåªèƒ½ç”¨ä½œçº¯æ¨¡æ¿beanå®šä¹‰ï¼Œç”¨ä½œå­å®šä¹‰çš„çˆ¶å®šä¹‰ã€‚å¦‚æœè¯•å›¾å•ç‹¬åœ°ä½¿ç”¨å£°æ˜äº†<code>abstract</code>çš„çˆ¶beanï¼Œ é€šè¿‡å¼•ç”¨å®ƒä½œä¸ºå¦ä¸€ä¸ªbeançš„refå±æ€§ï¼Œæˆ–è€…ä½¿ç”¨çˆ¶bean idè¿›è¡Œæ˜¾å¼çš„<code>getBean()</code>è°ƒç”¨ï¼Œéƒ½å°†è¿”å›ä¸€ä¸ªé”™è¯¯ã€‚åŒæ ·ï¼Œå®¹å™¨å†…éƒ¨çš„ <code>preInstantiateSingletons()</code>æ–¹æ³•ä¹Ÿä¼šå¿½ç•¥å®šä¹‰ä¸º<code>abstract</code>çš„beanã€‚</p><p><code>ApplicationContext</code> é»˜è®¤ä¼šé¢„å…ˆå®ä¾‹åŒ–æ‰€æœ‰çš„å•ä¾‹beanã€‚å› æ­¤ï¼Œå¦‚æœå¼€å‘è€…æ‰“ç®—æŠŠ(çˆ¶ï¼‰beanå®šä¹‰ä»…ä»…ä½œä¸ºæ¨¡æ¿æ¥ä½¿ç”¨ï¼ŒåŒæ—¶ä¸ºå®ƒæŒ‡å®šäº†classå±æ€§ï¼Œ é‚£ä¹ˆå¿…é¡»ç¡®ä¿è®¾ç½®_abstract_çš„å±æ€§å€¼ä¸ºtrueã€‚å¦åˆ™ï¼Œåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¼š(å°è¯•ï¼‰é¢„å®ä¾‹åŒ–è¿™ä¸ª<code>abstract</code> beanã€‚</p><h3 id="1-8-å®¹å™¨çš„æ‰©å±•ç‚¹"><a href="#1-8-å®¹å™¨çš„æ‰©å±•ç‚¹" class="headerlink" title="1.8. å®¹å™¨çš„æ‰©å±•ç‚¹"></a>1.8. å®¹å™¨çš„æ‰©å±•ç‚¹</h3><p>é€šå¸¸ï¼Œåº”ç”¨ç¨‹åºå¼€å‘è€…æ— éœ€ç»§æ‰¿<code>ApplicationContext</code>çš„å®ç°ç±»ã€‚ç›¸åï¼ŒSpring IoCå®¹å™¨å¯ä»¥é€šè¿‡æ’å…¥ç‰¹æ®Šçš„é›†æˆæ¥å£å®ç°è¿›è¡Œæ‰©å±•ã€‚æ¥ä¸‹æ¥çš„å‡ èŠ‚å°†ä»‹ç»è¿™äº›é›†æˆæ¥å£ã€‚</p><h4 id="1-8-1-ä½¿ç”¨BeanPostProcessorè‡ªå®šä¹‰Bean"><a href="#1-8-1-ä½¿ç”¨BeanPostProcessorè‡ªå®šä¹‰Bean" class="headerlink" title="1.8.1. ä½¿ç”¨BeanPostProcessorè‡ªå®šä¹‰Bean"></a>1.8.1. ä½¿ç”¨<code>BeanPostProcessor</code>è‡ªå®šä¹‰Bean</h4><p><code>BeanPostProcessor</code>æ¥å£å®šä¹‰äº†å¯ä»¥å®ç°çš„å›è°ƒæ–¹æ³•ï¼Œä»¥æä¾›æ‚¨è‡ªå·±çš„ï¼ˆæˆ–è¦†ç›–å®¹å™¨çš„é»˜è®¤ï¼‰å®ä¾‹åŒ–é€»è¾‘ï¼Œä¾èµ–å…³ç³»è§£æé€»è¾‘ç­‰ã€‚ å¦‚æœè¦åœ¨Springå®¹å™¨å®Œæˆå®ä¾‹åŒ–ï¼Œé…ç½®å’Œåˆå§‹åŒ–beanä¹‹åå®ç°æŸäº›è‡ªå®šä¹‰é€»è¾‘ï¼Œåˆ™å¯ä»¥æ’å…¥ä¸€ä¸ªæˆ–å¤šä¸ª<code>BeanPostProcessor</code>å®ç°ã€‚</p><p>æ‚¨å¯ä»¥é…ç½®å¤šä¸ª<code>BeanPostProcessor</code> å®ä¾‹ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡è®¾ç½®<code>order</code>å±æ€§æ¥æ§åˆ¶è¿™äº› <code>BeanPostProcessor</code> å®ä¾‹çš„æ‰§è¡Œé¡ºåºã€‚ ä»…å½“<code>BeanPostProcessor</code>å®ç° <code>Ordered</code>æ¥å£æ—¶ï¼Œæ‰èƒ½è®¾ç½®æ­¤å±æ€§ã€‚å¦‚æœç¼–å†™è‡ªå·±çš„<code>BeanPostProcessor</code>ï¼Œåˆ™åº”è€ƒè™‘å®ç°Orderedæ¥å£ã€‚ æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œ è¯·å‚é˜…<a href="https://docs.spring.io/spring-framework/docs/5.1.3.BUILD-SNAPSHOT/javadoc-api/org/springframework/beans/factory/config/BeanPostProcessor.html"><code>BeanPostProcessor</code></a> å’Œ <a href="https://docs.spring.io/spring-framework/docs/5.1.3.BUILD-SNAPSHOT/javadoc-api/org/springframework/core/Ordered.html"><code>Ordered</code></a>çš„javadocã€‚ å¦è¯·å‚é˜…æœ‰å…³<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-programmatically-registering-beanpostprocessors"><code>BeanPostProcessor</code> å®ä¾‹</a>çš„ç¼–ç¨‹æ³¨å†Œçš„è¯´æ˜ã€‚</p><p><code>BeanPostProcessor</code>å®ä¾‹åœ¨beanï¼ˆæˆ–å¯¹è±¡ï¼‰å®ä¾‹ä¸Šè¿è¡Œã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼ŒSpring IoCå®¹å™¨å®ä¾‹åŒ–ä¸€ä¸ªbeanå®ä¾‹ï¼Œç„¶åæ‰èƒ½ç”¨<code>BeanPostProcessor</code> å¯¹è¿™ä¸ªå®ä¾‹è¿›è¡Œå¤„ç†ã€‚</p><p><code>BeanPostProcessor</code>ä¼šåœ¨æ•´ä¸ªå®¹å™¨å†…èµ·ä½œç”¨ï¼Œæ‰€æœ‰å®ƒä»…ä»…ä¸æ­£åœ¨ä½¿ç”¨çš„å®¹å™¨ç›¸å…³ã€‚å¦‚æœåœ¨ä¸€ä¸ªå®¹å™¨ä¸­å®šä¹‰äº†<code>BeanPostProcessor</code>ï¼Œé‚£ä¹ˆå®ƒåªä¼šå¤„ç†é‚£ä¸ªå®¹å™¨ä¸­çš„beanã€‚ æ¢å¥è¯è¯´ï¼Œåœ¨ä¸€ä¸ªå®¹å™¨ä¸­å®šä¹‰çš„beanä¸ä¼šè¢«å¦ä¸€ä¸ªå®¹å™¨å®šä¹‰çš„<code>BeanPostProcessor</code>å¤„ç†ï¼Œå³ä½¿è¿™ä¸¤ä¸ªå®¹å™¨éƒ½æ˜¯åŒä¸€å±‚æ¬¡ç»“æ„çš„ä¸€éƒ¨åˆ†ã€‚</p><p>è¦æ›´æ”¹å®é™…çš„beanå®šä¹‰ï¼ˆå³å®šä¹‰beançš„è“å›¾ï¼‰ï¼Œæ‚¨éœ€è¦ä½¿ç”¨<code>BeanFactoryPostProcessor</code>ï¼Œä½¿ç”¨BeanFactoryPostProcessorè‡ªå®šä¹‰é…ç½®å…ƒæ•°æ®ã€‚ <a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-extension-factory-postprocessors">ä½¿ç”¨ <code>BeanFactoryPostProcessor</code>è‡ªå®šä¹‰é…ç½®å…ƒæ•°æ®</a>.</p><p><code>org.springframework.beans.factory.config.BeanPostProcessor</code>æ¥å£ç”±ä¸¤ä¸ªå›è°ƒæ–¹æ³•ç»„æˆï¼Œå½“ä¸€ä¸ªç±»è¢«æ³¨å†Œä¸ºå®¹å™¨çš„åç½®å¤„ç†å™¨æ—¶ï¼Œå¯¹äºå®¹å™¨åˆ›å»ºçš„æ¯ä¸ªbeanå®ä¾‹ï¼Œ åç½®å¤„ç†å™¨éƒ½ä¼šåœ¨å®¹å™¨åˆå§‹åŒ–æ–¹æ³•ï¼ˆå¦‚<code>InitializingBean.afterPropertiesSet()</code>ä¹‹å‰å’Œå®¹å™¨å£°æ˜çš„<code>init</code>æ–¹æ³•ï¼‰ä»¥åŠä»»ä½•beanåˆå§‹åŒ–å›è°ƒä¹‹åè¢«è°ƒç”¨ã€‚åç½®å¤„ç†å™¨å¯ä»¥å¯¹beanå®ä¾‹æ‰§è¡Œä»»ä½•æ“ä½œï¼Œ åŒ…æ‹¬å®Œå…¨å¿½ç•¥å›è°ƒã€‚beanåç½®å¤„ç†å™¨ï¼Œé€šå¸¸ä¼šæ£€æŸ¥å›è°ƒæ¥å£æˆ–è€…ä½¿ç”¨ä»£ç†åŒ…è£…beanã€‚ä¸€äº›Spring AOPåŸºç¡€æ¶æ„ç±»ä¸ºäº†æä¾›åŒ…è£…å¥½çš„ä»£ç†é€»è¾‘ï¼Œä¼šè¢«å®ç°ä¸ºbeanåç½®å¤„ç†å™¨ã€‚</p><p><code>ApplicationContext</code>ä¼šè‡ªåŠ¨åœ°æ£€æµ‹æ‰€æœ‰å®šä¹‰åœ¨é…ç½®å…ƒæ–‡ä»¶ä¸­ï¼Œå¹¶å®ç°äº†<code>BeanPostProcessor</code> æ¥å£çš„beanã€‚<code>ApplicationContext</code>ä¼šæ³¨å†Œè¿™äº›beansä¸ºåç½®å¤„ç†å™¨ï¼Œ ä½¿ä»–ä»¬å¯ä»¥åœ¨beanåˆ›å»ºå®Œæˆä¹‹åè¢«è°ƒç”¨ã€‚beanåç½®å¤„ç†å™¨å¯ä»¥åƒå…¶ä»–beanä¸€æ ·éƒ¨ç½²åˆ°å®¹å™¨ä¸­ã€‚</p><p>å½“åœ¨é…ç½®ç±»ä¸Šä½¿ç”¨ <code>@Bean</code> å·¥å‚æ–¹æ³•å£°æ˜<code>BeanPostProcessor</code>æ—¶ï¼Œå·¥å‚æ–¹æ³•è¿”å›çš„ç±»å‹åº”è¯¥æ˜¯å®ç°ç±»è‡ªèº«ã€‚ï¼Œæˆ–è‡³å°‘ä¹Ÿæ˜¯<code>org.springframework.beans.factory.config.BeanPostProcessor</code>æ¥å£ï¼Œ è¦æ¸…æ¥šåœ°è¡¨æ˜è¿™ä¸ªbeançš„åç½®å¤„ç†å™¨çš„æœ¬è´¨ç‰¹ç‚¹ã€‚å¦åˆ™ï¼Œåœ¨å®ƒå®Œå…¨åˆ›å»ºä¹‹å‰ï¼Œ<code>ApplicationContext</code>å°†ä¸èƒ½é€šè¿‡ç±»å‹è‡ªåŠ¨æ¢æµ‹å®ƒã€‚ç”±äº<code>BeanPostProcessor</code>åœ¨æ—©æœŸå°±éœ€è¦è¢«å®ä¾‹åŒ–ï¼Œ ä»¥é€‚åº”ä¸Šä¸‹æ–‡ä¸­å…¶ä»–beançš„å®ä¾‹åŒ–ï¼Œå› æ­¤è¿™ä¸ªæ—©æœŸçš„ç±»å‹æ£€æŸ¥æ˜¯è‡³å…³é‡è¦çš„ã€‚</p><p>ä»¥ç¼–ç¨‹æ–¹å¼æ³¨å†Œ<code>BeanPostProcessor</code>å®ä¾‹ï¼Œè™½ç„¶<code>BeanPostProcessor</code>æ³¨å†Œçš„æ¨èæ–¹æ³•æ˜¯é€šè¿‡<code>ApplicationContext</code>è‡ªåŠ¨æ£€æµ‹ï¼ˆå¦‚å‰æ‰€è¿°ï¼‰ï¼Œä½†æ‚¨å¯ä»¥ä»¥ç¼–ç¨‹çš„æ–¹å¼ä½¿ç”¨<code>ConfigurableBeanFactory</code>çš„<code>addBeanPostProcessor</code>æ–¹æ³•è¿›è¡Œæ³¨å†Œã€‚ è¿™å¯¹äºåœ¨æ³¨å†Œä¹‹å‰éœ€è¦å¯¹æ¡ä»¶é€»è¾‘è¿›è¡Œè¯„ä¼°ï¼Œæˆ–è€…æ˜¯åœ¨ç»§æ‰¿å±‚æ¬¡çš„ä¸Šä¸‹æ–‡ä¹‹é—´å¤åˆ¶beançš„åç½®å¤„ç†å™¨ä¸­æ˜¯æœ‰å¾ˆæœ‰ç”¨çš„ã€‚ ä½†è¯·æ³¨æ„ï¼Œä»¥ç¼–ç¨‹æ–¹å¼æ·»åŠ çš„<code>BeanPostProcessor</code>å®ä¾‹ä¸éµå¾ª<code>Ordered</code>æ¥å£ã€‚è¿™é‡Œï¼Œæ³¨å†Œé¡ºåºå†³å®šäº†æ‰§è¡Œçš„é¡ºåºã€‚ å¦è¯·æ³¨æ„ï¼Œä»¥ç¼–ç¨‹æ–¹å¼æ³¨å†Œçš„<code>BeanPostProcessor</code>å®ä¾‹å§‹ç»ˆåœ¨é€šè¿‡è‡ªåŠ¨æ£€æµ‹æ³¨å†Œçš„å®ä¾‹ä¹‹å‰å¤„ç†ï¼Œè€Œä¸ç®¡ä»»ä½•æ˜¾å¼æ’åºã€‚</p><p><code>BeanPostProcessor</code> å®ä¾‹ and AOP è‡ªåŠ¨ä»£ç†</p><p>å®ç°<code>BeanPostProcessor</code> æ¥å£çš„ç±»æ˜¯ç‰¹æ®Šçš„ï¼Œå®¹å™¨ä¼šå¯¹å®ƒä»¬è¿›è¡Œä¸åŒçš„å¤„ç†ã€‚æ‰€æœ‰<code>BeanPostProcessor</code> å’Œä»–ä»¬ç›´æ¥å¼•ç”¨çš„beanséƒ½ä¼šåœ¨å®¹å™¨å¯åŠ¨çš„æ—¶å€™è¢«å®ä¾‹åŒ–ï¼Œ å¹¶ä½œä¸º<code>ApplicationContext</code>ç‰¹æ®Šå¯åŠ¨é˜¶æ®µçš„ä¸€éƒ¨åˆ†ã€‚æ¥ç€ï¼Œæ‰€æœ‰çš„<code>BeanPostProcessor</code> éƒ½ä¼šä»¥ä¸€ä¸ªæœ‰åºçš„æ–¹å¼è¿›è¡Œæ³¨å†Œï¼Œå¹¶åº”ç”¨äºå®¹å™¨ä¸­çš„æ‰€æœ‰beanã€‚ å› ä¸ºAOPè‡ªåŠ¨ä»£ç†æœ¬èº«è¢«å®ç°ä¸º<code>BeanPostProcessor</code>ï¼Œè¿™ä¸ª<code>BeanPostProcessor</code>å’Œå®ƒç›´æ¥åº”ç”¨çš„beanséƒ½ä¸é€‚åˆè¿›è¡Œè‡ªåŠ¨ä»£ç†ï¼Œå› æ­¤ä¹Ÿå°±æ— æ³•åœ¨å®ƒä»¬ä¸­ç»‡å…¥åˆ‡é¢ã€‚</p><p>å¯¹äºæ‰€æœ‰è¿™æ ·çš„beanï¼Œæ‚¨åº”è¯¥çœ‹åˆ°ä¸€æ¡ä¿¡æ¯æ€§æ—¥å¿—æ¶ˆæ¯: <code>Bean someBean is not eligible for getting processed by all BeanPostProcessor interfaces (for example: not eligible for auto-proxying)</code>.</p><p>å¦‚æœä½ ä½¿ç”¨è‡ªåŠ¨è£…é…æˆ– <code>@Resource</code>ï¼ˆå¯èƒ½ä¼šå›é€€åˆ°è‡ªåŠ¨è£…é…ï¼‰å°†Beanè¿æ¥åˆ°<code>BeanPostProcessor</code>ä¸­ï¼ŒSpringå¯èƒ½ä¼šåœ¨æœç´¢ç±»å‹åŒ¹é…çš„ä¾èµ–å…³ç³»å€™é€‰æ—¶è®¿é—®åˆ°æ„å¤–ç±»å‹çš„beanï¼› å› æ­¤ï¼Œå¯¹å®ƒä»¬ä¸é€‚åˆè¿›è¡Œè‡ªåŠ¨ä»£ç†ï¼Œæˆ–è€…å¯¹å…¶ä»–ç±»å‹çš„beanè¿›è¡Œåç½®å¤„ç†ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæœ‰ä¸€ä¸ªä½¿ç”¨ <code>@Resource</code> æ³¨è§£çš„ä¾èµ–é¡¹ï¼Œå…¶ä¸­å­—æ®µæˆ–setteråç§°ä¸ç›´æ¥å¯¹åº”äºbeançš„å£°æ˜åç§°è€Œä¸”æ²¡æœ‰ä½¿ç”¨nameå±æ€§ï¼Œ åˆ™Springä¼šè®¿é—®å…¶ä»–beanä»¥æŒ‰ç±»å‹åŒ¹é…å®ƒä»¬ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•åœ¨<code>ApplicationContext</code>ä¸­ç¼–å†™ï¼Œæ³¨å†Œå’Œä½¿ç”¨<code>BeanPostProcessor</code>å®ä¾‹ã€‚</p><h5 id="ç¤ºä¾‹-Hello-World-BeanPostProcessor-style"><a href="#ç¤ºä¾‹-Hello-World-BeanPostProcessor-style" class="headerlink" title="ç¤ºä¾‹: Hello World, BeanPostProcessor-style"></a>ç¤ºä¾‹: Hello World, <code>BeanPostProcessor</code>-style</h5><p>ç¬¬ä¸€ä¸ªä¾‹å­è¯´æ˜äº†åŸºæœ¬ç”¨æ³•ã€‚ è¯¥ç¤ºä¾‹æ˜¾ç¤ºäº†ä¸€ä¸ªè‡ªå®šä¹‰<code>BeanPostProcessor</code>å®ç°ï¼Œè¯¥å®ç°åœ¨å®¹å™¨åˆ›å»ºæ—¶è°ƒç”¨æ¯ä¸ªbeançš„ <code>toString()</code> æ–¹æ³•ï¼Œå¹¶å°†ç”Ÿæˆçš„å­—ç¬¦ä¸²è¾“å‡ºåˆ°ç³»ç»Ÿæ§åˆ¶å°ã€‚</p><p>ä»¥ä¸‹æ¸…å•æ˜¾ç¤ºäº†è‡ªå®šä¹‰<code>BeanPostProcessor</code> å®ç°ç±»å®šä¹‰:</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript">package scripting;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.config.BeanPostProcessor;<br>public <span class="hljs-keyword">class</span> <span class="hljs-title class_">InstantiationTracingBeanPostProcessor</span> implements BeanPostProcessor &#123;<br>    <span class="hljs-regexp">//</span> simply <span class="hljs-keyword">return</span> the instantiated bean <span class="hljs-keyword">as</span>-<span class="hljs-keyword">is</span>    public <span class="hljs-built_in">Object</span> postProcessBeforeInitialization(<span class="hljs-built_in">Object</span> bean, <span class="hljs-built_in">String</span> beanName) &#123;        <span class="hljs-keyword">return</span> bean; <span class="hljs-regexp">//</span> we could potentially <span class="hljs-keyword">return</span> any object reference here...    &#125;<br>    public <span class="hljs-built_in">Object</span> postProcessAfterInitialization(<span class="hljs-built_in">Object</span> bean, <span class="hljs-built_in">String</span> beanName) &#123;        System.out.println(<span class="hljs-string">&quot;Bean &#x27;&quot;</span> + beanName + <span class="hljs-string">&quot;&#x27; created : &quot;</span> + bean.toString());        <span class="hljs-keyword">return</span> bean;    &#125;&#125;<br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹beanså…ƒç´ ä½¿ç”¨<code>InstantiationTracingBeanPostProcessor</code>:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span>    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>    <span class="hljs-attr">xmlns:lang</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/lang&quot;</span>    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans.xsd        http://www.springframework.org/schema/lang        http://www.springframework.org/schema/lang/spring-lang.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">lang:groovy</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;messenger&quot;</span>            <span class="hljs-attr">script-source</span>=<span class="hljs-string">&quot;classpath:org/springframework/scripting/groovy/Messenger.groovy&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">lang:property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;message&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Fiona Apple Is Just So Dreamy.&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">lang:groovy</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--    when the above bean (messenger) is instantiated, this custom    BeanPostProcessor implementation will output the fact to the system console    --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;scripting.InstantiationTracingBeanPostProcessor&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æ³¨æ„<code>InstantiationTracingBeanPostProcessor</code>æ˜¯å¦‚ä½•å®šä¹‰çš„ï¼Œå®ƒç”šè‡³æ²¡æœ‰åå­—ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªbeanï¼Œæ‰€ä»¥å®ƒå¯ä»¥åƒä»»ä½•å…¶ä»–beanä¸€æ ·è¿›è¡Œä¾èµ–æ³¨å…¥ ï¼ˆå‰é¢çš„é…ç½®è¿˜å®šä¹‰äº†ä¸€ä¸ªç”±Groovyè„šæœ¬æ”¯æŒçš„beanã€‚åœ¨<a href="https://github.com/DocsHome/spring-docs/blob/master/pages/languages/languages.md#dynamic-language">åŠ¨æ€è¯­è¨€æ”¯æŒ</a>ä¸€ç« ä¸­è¯¦ç»†ä»‹ç»äº†SpringåŠ¨æ€è¯­è¨€æ”¯æŒï¼‰ã€‚</p><p>ä¸‹é¢ç®€å•çš„Javaåº”ç”¨æ‰§è¡Œäº†å‰é¢ä»£ç å’Œé…ç½®:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.springframework.context.ApplicationContext;<span class="hljs-keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;<span class="hljs-keyword">import</span> org.springframework.scripting.Messenger;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Boot</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-keyword">final</span> String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;        <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">ctx</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathXmlApplicationContext</span>(<span class="hljs-string">&quot;scripting/beans.xml&quot;</span>);        <span class="hljs-type">Messenger</span> <span class="hljs-variable">messenger</span> <span class="hljs-operator">=</span> (Messenger) ctx.getBean(<span class="hljs-string">&quot;messenger&quot;</span>);        System.out.println(messenger);    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°åº”ç”¨ç¨‹åºçš„è¾“å‡ºç±»ä¼¼äºä»¥ä¸‹å†…å®¹:</p><p>Bean â€˜messengerâ€™ created : org.springframework.scripting.groovy.GroovyMessenger@272961 org.springframework.scripting.groovy.GroovyMessenger@272961</p><h5 id="ç¤ºä¾‹-The-RequiredAnnotationBeanPostProcessor"><a href="#ç¤ºä¾‹-The-RequiredAnnotationBeanPostProcessor" class="headerlink" title="ç¤ºä¾‹: The RequiredAnnotationBeanPostProcessor"></a>ç¤ºä¾‹: The <code>RequiredAnnotationBeanPostProcessor</code></h5><p>è‡ªå®šä¹‰<code>BeanPostProcessor</code>å®ç°ä¸å›è°ƒæ¥å£æˆ–æ³¨è§£é…åˆä½¿ç”¨ï¼Œæ˜¯ä¸€ç§å¸¸è§çš„æ‰©å±•Spring IoCå®¹å™¨æ‰‹æ®µï¼Œä¸€ä¸ªä¾‹å­å°±æ˜¯<code>RequiredAnnotationBeanPostProcessor</code>ï¼Œè¿™æ˜¯<code>BeanPostProcessor</code>å®ç°ã€‚ å®ƒç¡®ä¿ç”¨ï¼ˆä»»æ„ï¼‰æ³¨è§£æ ‡è®°çš„beanä¸Šçš„JavaBeanå±æ€§å®é™…ä¸Šï¼ˆé…ç½®ä¸ºï¼‰ä¾èµ–æ³¨å…¥å€¼ã€‚</p><h4 id="1-8-2-ä½¿ç”¨BeanFactoryPostProcessorè‡ªå®šä¹‰å…ƒæ•°æ®é…ç½®"><a href="#1-8-2-ä½¿ç”¨BeanFactoryPostProcessorè‡ªå®šä¹‰å…ƒæ•°æ®é…ç½®" class="headerlink" title="1.8.2. ä½¿ç”¨BeanFactoryPostProcessorè‡ªå®šä¹‰å…ƒæ•°æ®é…ç½®"></a>1.8.2. ä½¿ç”¨<code>BeanFactoryPostProcessor</code>è‡ªå®šä¹‰å…ƒæ•°æ®é…ç½®</h4><p>ä¸‹ä¸€ä¸ªæˆ‘ä»¬è¦å…³æ³¨çš„æ‰©å±•ç‚¹æ˜¯<code>org.springframework.beans.factory.config.BeanFactoryPostProcessor</code>ã€‚è¿™ä¸ªæ¥å£çš„è¯­ä¹‰ä¸<code>BeanPostProcessor</code>ç±»ä¼¼ï¼Œ ä½†æœ‰ä¸€å¤„ä¸åŒï¼Œ<code>BeanFactoryPostProcessor</code>æ“ä½œbeançš„å…ƒæ•°æ®é…ç½®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒSpring IoCå®¹å™¨å…è®¸<code>BeanFactoryPostProcessor</code>è¯»å–é…ç½®å…ƒæ•°æ®ï¼Œ å¹¶å¯èƒ½åœ¨å®¹å™¨å®ä¾‹åŒ–é™¤<code>BeanFactoryPostProcessor</code>å®ä¾‹ä¹‹å¤–çš„ä»»ä½•beanä¹‹å‰æ›´æ”¹å®ƒã€‚</p><p>æ‚¨å¯ä»¥é…ç½®å¤šä¸ª<code>BeanFactoryPostProcessor</code>å®ä¾‹ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡è®¾ç½®<code>order</code>å±æ€§æ¥æ§åˆ¶è¿™äº›<code>BeanFactoryPostProcessor</code>å®ä¾‹çš„è¿è¡Œé¡ºåºï¼ˆ<code>BeanFactoryPostProcessor</code>å¿…é¡»å®ç°äº†<code>Ordered</code>æ¥å£æ‰èƒ½è®¾ç½®è¿™ä¸ªå±æ€§ï¼‰ã€‚ å¦‚æœç¼–å†™è‡ªå·±çš„BeanFactoryPostProcessorï¼Œåˆ™åº”è€ƒè™‘å®ç°Orderedæ¥å£ã€‚ æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œ è¯·å‚é˜…<a href="https://docs.spring.io/spring-framework/docs/5.1.3.BUILD-SNAPSHOT/javadoc-api/org/springframework/beans/factory/config/BeanFactoryPostProcessor.html"><code>BeanFactoryPostProcessor</code></a> å’Œ <a href="https://docs.spring.io/spring-framework/docs/5.1.3.BUILD-SNAPSHOT/javadoc-api/org/springframework/core/Ordered.html"><code>Ordered</code></a> æ¥å£çš„javadoc.</p><p>å¦‚æœæƒ³ä¿®æ”¹å®é™…çš„beanå®ä¾‹ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œä»å…ƒæ•°æ®é…ç½®ä¸­åˆ›å»ºçš„å¯¹è±¡ï¼‰é‚£ä¹ˆéœ€è¦ä½¿ç”¨<code>BeanPostProcessor</code>ï¼ˆå‰é¢åœ¨ä½¿ç”¨<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-extension-bpp"><code>BeanPostProcessor</code>è‡ªå®šä¹‰Bean</a>ä¸­è¿›è¡Œäº†æè¿°ï¼‰æ¥æ›¿ä»£ã€‚ åœ¨<code>BeanFactoryPostProcessor</code>ï¼ˆä¾‹å¦‚ä½¿ç”¨<code>BeanFactory.getBean()</code>ï¼‰ä¸­ä½¿ç”¨è¿™äº›beançš„å®ä¾‹è™½ç„¶åœ¨æŠ€æœ¯ä¸Šæ˜¯å¯è¡Œçš„ï¼Œä½†è¿™ä¹ˆæ¥åšä¼šå°†beanè¿‡æ—©å®ä¾‹åŒ–ï¼Œ è¿™è¿åäº†æ ‡å‡†çš„å®¹å™¨ç”Ÿå‘½å‘¨æœŸã€‚åŒæ—¶ä¹Ÿä¼šå¼•å‘ä¸€äº›å‰¯ä½œç”¨ï¼Œä¾‹å¦‚ç»•è¿‡beançš„åç½®å¤„ç†ã€‚</p><p><code>BeanFactoryPostProcessor</code>ä¼šåœ¨æ•´ä¸ªå®¹å™¨å†…èµ·ä½œç”¨ï¼Œæ‰€æœ‰å®ƒä»…ä»…ä¸æ­£åœ¨ä½¿ç”¨çš„å®¹å™¨ç›¸å…³ã€‚å¦‚æœåœ¨ä¸€ä¸ªå®¹å™¨ä¸­å®šä¹‰äº†<code>BeanFactoryPostProcessor</code>ï¼Œ é‚£ä¹ˆå®ƒåªä¼šå¤„ç†é‚£ä¸ªå®¹å™¨ä¸­çš„beanã€‚ æ¢å¥è¯è¯´ï¼Œåœ¨ä¸€ä¸ªå®¹å™¨ä¸­å®šä¹‰çš„beanä¸ä¼šè¢«å¦ä¸€ä¸ªå®¹å™¨å®šä¹‰çš„<code>BeanFactoryPostProcessor</code>å¤„ç†ï¼Œå³ä½¿è¿™ä¸¤ä¸ªå®¹å™¨éƒ½æ˜¯åŒä¸€å±‚æ¬¡ç»“æ„çš„ä¸€éƒ¨åˆ†ã€‚</p><p>beanå·¥å‚åç½®å¤„ç†å™¨åœ¨<code>ApplicationContext</code>ä¸­å£°æ˜æ—¶è‡ªåŠ¨æ‰§è¡Œï¼Œè¿™æ ·å°±å¯ä»¥å¯¹å®šä¹‰åœ¨å®¹å™¨ä¸­çš„å…ƒæ•°æ®é…ç½®è¿›è¡Œä¿®æ”¹ã€‚ SpringåŒ…å«è®¸å¤šé¢„å®šä¹‰çš„beanå·¥å‚åå¤„ç†å™¨ï¼Œ ä¾‹å¦‚<code>PropertyOverrideConfigurer</code> å’Œ<code>PropertyPlaceholderConfigurer</code>ã€‚ æ‚¨è¿˜å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰<code>BeanFactoryPostProcessor</code>ã€‚ ä¾‹å¦‚ï¼Œæ³¨å†Œè‡ªå®šä¹‰å±æ€§ç¼–è¾‘å™¨ã€‚ .</p><p><code>ApplicationContext</code> è‡ªåŠ¨æ£€æµ‹éƒ¨ç½²åˆ°å…¶ä¸­çš„ä»»ä½•å®ç°<code>BeanFactoryPostProcessor</code>æ¥å£çš„beanã€‚ å®ƒåœ¨é€‚å½“çš„æ—¶å€™ä½¿ç”¨è¿™äº›beanä½œä¸ºbeanå·¥å‚åç½®å¤„ç†å™¨ã€‚ ä½ å¯ä»¥éƒ¨ç½²è¿™äº›åç½®å¤„ç†å™¨ä¸ºä½ æƒ³ç”¨çš„ä»»æ„å…¶å®ƒbeanã€‚</p><p>æ³¨æ„ï¼Œå’Œ<code>BeanPostProcessor</code>ä¸€æ ·ï¼Œé€šå¸¸ä¸åº”è¯¥é…ç½®<code>BeanFactoryPostProcessor</code>æ¥è¿›è¡Œå»¶è¿Ÿåˆå§‹åŒ–ã€‚å¦‚æœæ²¡æœ‰å…¶å®ƒbeanå¼•ç”¨<code>Bean(Factory)PostProcessor</code>ï¼Œ é‚£ä¹ˆåç½®å¤„ç†å™¨å°±ä¸ä¼šè¢«åˆå§‹åŒ–ã€‚å› æ­¤ï¼Œæ ‡è®°å®ƒä¸ºå»¶è¿Ÿåˆå§‹åŒ–å°±ä¼šè¢«å¿½ç•¥ï¼Œï¼Œå³ä¾¿ä½ åœ¨<code>&lt;beans /&gt;</code>å…ƒç´ å£°æ˜ä¸­è®¾ç½®<code>default-lazy-init</code>&#x3D;trueå±æ€§ï¼Œ<code>Bean(Factory)PostProcessor</code>ä¹Ÿä¼šæå‰åˆå§‹åŒ–beanã€‚</p><h5 id="ç¤ºä¾‹-ç±»åæ›¿æ¢PropertyPlaceholderConfigurer"><a href="#ç¤ºä¾‹-ç±»åæ›¿æ¢PropertyPlaceholderConfigurer" class="headerlink" title="ç¤ºä¾‹: ç±»åæ›¿æ¢PropertyPlaceholderConfigurer"></a>ç¤ºä¾‹: ç±»åæ›¿æ¢<code>PropertyPlaceholderConfigurer</code></h5><p>æ‚¨å¯ä»¥ä½¿ç”¨<code>PropertyPlaceholderConfigurer</code>é€šè¿‡ä½¿ç”¨æ ‡å‡†Java <code>Properties</code>æ ¼å¼ä»å•ç‹¬æ–‡ä»¶ä¸­çš„beanå®šä¹‰å¤–éƒ¨åŒ–å±æ€§å€¼ã€‚ è¿™æ ·åšå¯ä»¥ä½¿éƒ¨ç½²åº”ç”¨ç¨‹åºçš„äººèƒ½å¤Ÿå®šåˆ¶ç‰¹å®šäºç¯å¢ƒçš„å±æ€§ï¼Œå¦‚æ•°æ®åº“URLå’Œå¯†ç ï¼Œè€Œæ— éœ€ä¿®æ”¹å®¹å™¨çš„ä¸»XMLå®šä¹‰æ–‡ä»¶æˆ–æ–‡ä»¶çš„å¤æ‚æ€§æˆ–é£é™©ã€‚</p><p>è€ƒè™‘ä»¥ä¸‹è¿™ä¸ªåŸºäºXMLçš„å…ƒæ•°æ®é…ç½®ä»£ç ç‰‡æ®µï¼Œè¿™é‡Œçš„DataSourceä½¿ç”¨äº†å ä½ç¬¦æ¥å®šä¹‰:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;bean <span class="hljs-attribute">class</span>=<span class="hljs-string">&quot;org.springframework.beans.factory.config.PropertyPlaceholderConfigurer&quot;</span>&gt;    &lt;property <span class="hljs-attribute">name</span>=<span class="hljs-string">&quot;locations&quot;</span> <span class="hljs-attribute">value</span>=<span class="hljs-string">&quot;classpath:com/something/jdbc.properties&quot;</span>/&gt;&lt;/bean&gt;<br>&lt;bean <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;dataSource&quot;</span> <span class="hljs-attribute">destroy-method</span>=<span class="hljs-string">&quot;close&quot;</span>        <span class="hljs-attribute">class</span>=<span class="hljs-string">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span>&gt;    &lt;property <span class="hljs-attribute">name</span>=<span class="hljs-string">&quot;driverClassName&quot;</span> <span class="hljs-attribute">value</span>=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;jdbc.driverClassName&#125;</span>&quot;</span>/&gt;    &lt;property <span class="hljs-attribute">name</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attribute">value</span>=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;jdbc.url&#125;</span>&quot;</span>/&gt;    &lt;property <span class="hljs-attribute">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attribute">value</span>=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;jdbc.username&#125;</span>&quot;</span>/&gt;    &lt;property <span class="hljs-attribute">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attribute">value</span>=<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;jdbc.password&#125;</span>&quot;</span>/&gt;&lt;/bean&gt;<br></code></pre></td></tr></table></figure><p>è¯¥ç¤ºä¾‹æ˜¾ç¤ºäº†ä»å¤–éƒ¨å±æ€§æ–‡ä»¶é…ç½®çš„å±æ€§ã€‚åœ¨è¿è¡Œæ—¶ï¼Œ<code>PropertyPlaceholderConfigurer</code>åº”ç”¨äºæ›¿æ¢DataSourceçš„æŸäº›å±æ€§çš„å…ƒæ•°æ®ã€‚ è¦æ›¿æ¢çš„å€¼è¢«æŒ‡å®šä¸º$ {property-name}å½¢å¼çš„å ä½ç¬¦ï¼Œå®ƒéµå¾ªAntå’Œlog4jä»¥åŠJSP ELæ ·å¼ã€‚</p><p>è€ŒçœŸæ­£çš„å€¼æ˜¯æ¥è‡ªäºæ ‡å‡†çš„Java <code>Properties</code>æ ¼å¼çš„æ–‡ä»¶:</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">jdbc.driverClassName</span>=org.hsqldb.jdbcDriver<br><br><span class="hljs-attr">jdbc.url</span>=jdbc:hsqldb:hsql://production:<span class="hljs-number">9002</span><br><br><span class="hljs-attr">jdbc.username</span>=sa<br><br><span class="hljs-attr">jdbc.password</span>=root<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ<code>$&#123;jdbc.username&#125;</code> å­—ç¬¦ä¸²åœ¨è¿è¡Œæ—¶å°†æ›¿æ¢ä¸ºå€¼â€™saâ€™ï¼Œå¹¶ä¸”åŒæ ·é€‚ç”¨äºä¸å±æ€§æ–‡ä»¶ä¸­çš„é”®åŒ¹é…çš„å…¶ä»–å ä½ç¬¦å€¼ã€‚ <code>PropertyPlaceholderConfigurer</code>æ£€æŸ¥beanå®šä¹‰çš„å¤§å¤šæ•°å±æ€§å’Œå±æ€§ä¸­çš„å ä½ç¬¦ã€‚ æ­¤å¤–ï¼Œæ‚¨å¯ä»¥è‡ªå®šä¹‰å ä½ç¬¦å‰ç¼€å’Œåç¼€ã€‚</p><p>ä½¿ç”¨Spring 2.5ä¸­å¼•å…¥çš„<code>context</code> å‘½åç©ºé—´ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¸“ç”¨é…ç½®å…ƒç´ é…ç½®å±æ€§å ä½ç¬¦ã€‚ æ‚¨å¯ä»¥åœ¨<code>location</code>å±æ€§ä¸­ä»¥é€—å·åˆ†éš”åˆ—è¡¨çš„å½¢å¼æä¾›ä¸€ä¸ªæˆ–å¤šä¸ªä½ç½®ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;context:property-placeholder <span class="hljs-attribute">location</span>=<span class="hljs-string">&quot;classpath:com/something/jdbc.properties&quot;</span>/&gt;<br></code></pre></td></tr></table></figure><p><code>PropertyPlaceholderConfigurer</code>ä¸ä»…åœ¨æ‚¨æŒ‡å®šçš„å±æ€§æ–‡ä»¶ä¸­æŸ¥æ‰¾å±æ€§ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœå®ƒåœ¨æŒ‡å®šçš„å±æ€§æ–‡ä»¶ä¸­æ‰¾ä¸åˆ°å±æ€§ï¼Œå®ƒè¿˜ä¼šæ£€æŸ¥Java <code>System</code>å±æ€§ã€‚ å¼€å‘è€…å¯ä»¥é€šè¿‡è®¾ç½®<code>systemPropertiesMode</code>å±æ€§ï¼Œä½¿ç”¨ä¸‹é¢ä¸‰ä¸ªæ•´æ•°çš„æŸä¸€ä¸ªæ¥è‡ªå®šä¹‰è¿™ç§è¡Œä¸ºï¼š</p><ul><li><code>never</code> (0): ä»ä¸æ£€æŸ¥ç³»ç»Ÿå±æ€§ã€‚</li><li><code>fallback</code> (1): å¦‚æœæ²¡æœ‰åœ¨æŒ‡å®šçš„å±æ€§æ–‡ä»¶ä¸­è§£æåˆ°å±æ€§ï¼Œé‚£ä¹ˆå°±æ£€æŸ¥ç³»ç»Ÿå±æ€§ï¼ˆé»˜è®¤ï¼‰ã€‚</li><li><code>override</code> (2): åœ¨æ£€æŸ¥æŒ‡å®šçš„å±æ€§æ–‡ä»¶ä¹‹å‰ï¼Œé¦–å…ˆå»æ£€æŸ¥ç³»ç»Ÿå±æ€§ï¼Œå…è®¸ç³»ç»Ÿå±æ€§è¦†ç›–å…¶å®ƒä»»æ„çš„å±æ€§èµ„æºã€‚</li></ul><p>æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<a href="https://docs.spring.io/spring-framework/docs/5.1.3.BUILD-SNAPSHOT/javadoc-api/org/springframework/beans/factory/config/PropertyPlaceholderConfigurer.html"><code>PropertyPlaceholderConfigurer</code></a> javadoc</p><p>ä½ å¯ä»¥ä½¿ç”¨<code>PropertyPlaceholderConfigurer</code>æ¥æ›¿æ¢ç±»åï¼Œå½“å¼€å‘è€…åœ¨è¿è¡Œæ—¶éœ€è¦é€‰æ‹©æŸä¸ªç‰¹å®šçš„å®ç°ç±»æ—¶ï¼Œè¿™æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚ä¾‹å¦‚</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.beans.factory.config.PropertyPlaceholderConfigurer&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;locations&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>classpath:com/something/strategy.properties<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;properties&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>custom.strategy.class=com.something.DefaultStrategy<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;serviceStrategy&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;custom.strategy.class&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>/&gt;</span></span><br></code></pre></td></tr></table></figure><p>å¦‚æœåœ¨è¿è¡Œæ—¶æ— æ³•å°†ç±»è§£æä¸ºæœ‰æ•ˆç±»ï¼Œåˆ™åœ¨å³å°†åˆ›å»ºbeanæ—¶ï¼Œbeançš„è§£æå°†å¤±è´¥ï¼Œè¿™æ˜¯ <code>ApplicationContext</code>åœ¨å¯¹éå»¶è¿Ÿåˆå§‹åŒ–beançš„<code>preInstantiateSingletons()</code>é˜¶æ®µå‘ç”Ÿçš„äº‹ã€‚</p><h5 id="ç¤ºä¾‹-PropertyOverrideConfigurer"><a href="#ç¤ºä¾‹-PropertyOverrideConfigurer" class="headerlink" title="ç¤ºä¾‹: PropertyOverrideConfigurer"></a>ç¤ºä¾‹: <code>PropertyOverrideConfigurer</code></h5><p><code>PropertyOverrideConfigurer</code>, å¦å¤–ä¸€ç§beanå·¥å‚åç½®å¤„ç†å™¨ï¼Œç±»ä¼¼äº<code>PropertyPlaceholderConfigurer</code>ï¼Œä½†ä¸åè€…ä¸åŒçš„æ˜¯ï¼šå¯¹äºæ‰€æœ‰çš„beanå±æ€§ï¼ŒåŸå§‹å®šä¹‰å¯ä»¥æœ‰é»˜è®¤å€¼æˆ–ä¹Ÿå¯èƒ½æ²¡æœ‰å€¼ã€‚ å¦‚æœä¸€ä¸ª<code>Properties</code>è¦†ç›–æ–‡ä»¶æ²¡æœ‰é…ç½®ç‰¹å®šçš„beanå±æ€§ï¼Œåˆ™å°±ä¼šä½¿ç”¨é»˜è®¤çš„ä¸Šä¸‹æ–‡å®šä¹‰</p><p>æ³¨æ„ï¼Œbeanå®šä¹‰æ˜¯ä¸çŸ¥é“æ˜¯å¦è¢«è¦†ç›–çš„ï¼Œæ‰€ä»¥ä»XMLå®šä¹‰æ–‡ä»¶ä¸­ä¸èƒ½é©¬ä¸Šçœ‹åˆ°é‚£ä¸ªé…ç½®æ­£åœ¨è¢«ä½¿ç”¨ã€‚åœ¨æ‹¥æœ‰å¤šä¸ª<code>PropertyOverrideConfigurer</code> å®ä¾‹çš„æƒ…å†µä¸‹ï¼Œä¸ºç›¸åŒbeançš„å±æ€§å®šä¹‰ä¸åŒçš„å€¼æ—¶ï¼ŒåŸºäºè¦†ç›–æœºåˆ¶åªä¼šæœ‰æœ€åä¸€ä¸ªç”Ÿæ•ˆã€‚</p><p>å±æ€§æ–‡ä»¶é…ç½®è¡Œé‡‡ç”¨ä»¥ä¸‹æ ¼å¼:</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">beanName.property</span>=value<br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚:</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">dataSource.driverClassName</span>=com.mysql.jdbc.Driver<br><br><span class="hljs-attr">dataSource.url</span>=jdbc:mysql:mydb<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªç¤ºä¾‹æ–‡ä»¶å¯ä»¥å’Œå®¹å™¨å®šä¹‰ä¸€èµ·ä½¿ç”¨ï¼Œè¯¥å®¹å™¨å®šä¹‰åŒ…å«ä¸€ä¸ªåä¸º<code>dataSource</code>çš„beanï¼Œè¯¥beanå…·æœ‰ <code>driver</code>å’Œ<code>url</code>å±æ€§</p><p>å¤åˆå±æ€§åç§°ä¹Ÿæ˜¯è¢«æ”¯æŒçš„ï¼Œåªè¦è¢«é‡å†™çš„æœ€åä¸€ä¸ªå±æ€§ä»¥å¤–çš„è·¯å¾„ä¸­æ¯ä¸ªç»„ä»¶éƒ½å·²ç»æ˜¯éç©ºæ—¶ï¼ˆå‡è®¾ç”±æ„é€ æ–¹æ³•åˆå§‹åŒ–ï¼‰ã€‚ åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œ<code>tom</code> beançš„<code>fred</code>å±æ€§çš„ <code>bob</code>å±æ€§çš„<code>sammy</code>å±æ€§è®¾ç½®å€¼ä¸º<code>123</code>ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">tom.fred.bob.sammy</span>=<span class="hljs-number">123</span><br></code></pre></td></tr></table></figure><p>æŒ‡å®šçš„è¦†ç›–å€¼é€šå¸¸æ˜¯æ–‡å­—å€¼ï¼Œå®ƒä»¬ä¸ä¼šè¢«è½¬æ¢æˆbeançš„å¼•ç”¨ã€‚è¿™ä¸ªçº¦å®šä¹Ÿé€‚ç”¨äºå½“XMLä¸­çš„beanå®šä¹‰çš„åŸå§‹å€¼æŒ‡å®šäº†beanå¼•ç”¨æ—¶ã€‚</p><p>ä½¿ç”¨Spring 2.5ä¸­å¼•å…¥çš„<code>context</code>å‘½åç©ºé—´ï¼Œå¯ä»¥ä½¿ç”¨ä¸“ç”¨é…ç½®å…ƒç´ é…ç½®å±æ€§è¦†ç›–ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;context:property-override <span class="hljs-attribute">location</span>=<span class="hljs-string">&quot;classpath:override.properties&quot;</span>/&gt;<br></code></pre></td></tr></table></figure><h4 id="1-8-3-ä½¿ç”¨FactoryBeanè‡ªå®šä¹‰åˆå§‹åŒ–é€»è¾‘"><a href="#1-8-3-ä½¿ç”¨FactoryBeanè‡ªå®šä¹‰åˆå§‹åŒ–é€»è¾‘" class="headerlink" title="1.8.3. ä½¿ç”¨FactoryBeanè‡ªå®šä¹‰åˆå§‹åŒ–é€»è¾‘"></a>1.8.3. ä½¿ç”¨<code>FactoryBean</code>è‡ªå®šä¹‰åˆå§‹åŒ–é€»è¾‘</h4><p>ä¸ºè‡ªå·±å·¥å‚çš„å¯¹è±¡å®ç°<code>org.springframework.beans.factory.FactoryBean</code>æ¥å£ã€‚</p><p><code>FactoryBean</code>æ¥å£å°±æ˜¯Spring IoCå®¹å™¨å®ä¾‹åŒ–é€»è¾‘çš„å¯æ’æ‹”ç‚¹ï¼Œå¦‚æœä½ çš„åˆå§‹åŒ–ä»£ç éå¸¸å¤æ‚ï¼Œé‚£ä¹ˆç›¸å¯¹äºï¼ˆæ½œåœ¨åœ°ï¼‰å¤§é‡è¯¦ç»†çš„XMLè€Œè¨€ï¼Œæœ€å¥½æ˜¯ä½¿ç”¨Javaè¯­è¨€æ¥è¡¨è¾¾ã€‚ ä½ å¯ä»¥åˆ›å»ºè‡ªå®šä¹‰çš„<code>FactoryBean</code>ï¼Œåœ¨è¯¥ç±»ä¸­ç¼–å†™å¤æ‚çš„åˆå§‹åŒ–ä»£ç ã€‚ç„¶åå°†è‡ªå®šä¹‰çš„<code>FactoryBean</code>æ’å…¥åˆ°å®¹å™¨ä¸­ã€‚</p><p><code>FactoryBean</code>æ¥å£æä¾›ä¸‹é¢ä¸‰ä¸ªæ–¹æ³•</p><ul><li><code>Object getObject()</code>: è¿”å›è¿™ä¸ªå·¥å‚åˆ›å»ºçš„å¯¹è±¡å®ä¾‹ã€‚è¿™ä¸ªå®ä¾‹å¯èƒ½æ˜¯å…±äº«çš„ï¼Œè¿™å–å†³äºè¿™ä¸ªå·¥å‚è¿”å›çš„æ˜¯å•ä¾‹è¿˜æ˜¯åŸå‹å®ä¾‹ã€‚</li><li><code>boolean isSingleton()</code>: å¦‚æœ<code>FactoryBean</code>è¿”å›å•ä¾‹ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ³•å°±è¿”å›<code>true</code>ï¼Œå¦åˆ™è¿”å›<code>false</code>ã€‚</li><li><code>Class getObjectType()</code>: è¿”å›ç”±<code>getObject()</code>æ–¹æ³•è¿”å›çš„å¯¹è±¡ç±»å‹ï¼Œå¦‚æœäº‹å…ˆä¸çŸ¥é“çš„ç±»å‹åˆ™ä¼šè¿”å›nullã€‚</li></ul><p>Springæ¡†æ¶å¤§é‡åœ°ä½¿ç”¨äº†<code>FactoryBean</code> çš„æ¦‚å¿µå’Œæ¥å£ï¼Œ<code>FactoryBean</code> æ¥å£çš„50å¤šä¸ªå®ç°éƒ½éšç€Springä¸€åŒæä¾›ã€‚</p><p>å½“å¼€å‘è€…éœ€è¦å‘å®¹å™¨è¯·æ±‚ä¸€ä¸ªçœŸå®çš„<code>FactoryBean</code>å®ä¾‹ï¼ˆè€Œä¸æ˜¯å®ƒç”Ÿäº§çš„beanï¼‰æ—¶ï¼Œè°ƒç”¨ <code>ApplicationContext</code>çš„<code>getBean()</code>æ–¹æ³•æ—¶åœ¨beançš„idä¹‹å‰éœ€è¦æ·»åŠ è¿å­—ç¬¦ï¼ˆ&amp;ï¼‰ æ‰€ä»¥å¯¹äºä¸€ä¸ªç»™å®šidä¸ºmyBeançš„<code>FactoryBean</code>ï¼Œè°ƒç”¨å®¹å™¨çš„<code>getBean(&quot;myBean&quot;)</code>æ–¹æ³•è¿”å›çš„æ˜¯FactoryBeançš„ä»£ç†ï¼Œè€Œè°ƒç”¨<code>getBean(&quot;&amp;myBean&quot;)</code>æ–¹æ³•åˆ™è¿”å›FactoryBeanå®ä¾‹æœ¬èº«</p><h3 id="1-9-åŸºäºæ³¨è§£çš„å®¹å™¨é…ç½®"><a href="#1-9-åŸºäºæ³¨è§£çš„å®¹å™¨é…ç½®" class="headerlink" title="1.9. åŸºäºæ³¨è§£çš„å®¹å™¨é…ç½®"></a>1.9. åŸºäºæ³¨è§£çš„å®¹å™¨é…ç½®</h3><p>æ³¨è§£æ˜¯å¦æ¯”é…ç½®Springçš„XMLæ›´å¥½?</p><p>åœ¨å¼•å…¥åŸºäºæ³¨è§£çš„é…ç½®ä¹‹å,å¼•å‘äº†è¿™ç§æ–¹æ³•æ˜¯å¦æ¯”XMLæ›´ä¼˜ç§€çš„é—®é¢˜.ç®€çŸ­çš„ç­”æ¡ˆæ˜¯å¾—çœ‹æƒ…å†µ,æ¯ç§æ–¹æ³•éƒ½æœ‰å…¶ä¼˜ç¼ºç‚¹ã€‚é€šå¸¸ç”±å¼€å‘äººå‘˜å†³å®šä½¿ç”¨æ›´é€‚åˆä»–ä»¬çš„ç­–ç•¥ã€‚ é¦–å…ˆçœ‹çœ‹ä¸¤ç§å®šä¹‰æ–¹å¼,æ³¨è§£åœ¨å®ƒä»¬çš„å£°æ˜ä¸­æä¾›äº†å¾ˆå¤šä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä½¿å¾—é…ç½®å˜å¾—æ›´çŸ­ã€æ›´ç®€æ´ï¼›ä½†æ˜¯ï¼ŒXMLæ“…é•¿äºåœ¨ä¸æ¥è§¦æºç æˆ–è€…æ— éœ€åç¼–è¯‘çš„æƒ…å†µä¸‹è£…é…ç»„ä»¶ï¼Œä¸€äº›å¼€å‘äººå‘˜æ›´å–œæ¬¢åœ¨æºç ä¸Šä½¿ç”¨æ³¨è§£é…ç½®ã€‚ è€Œå¦ä¸€äº›äººè®¤ä¸ºæ³¨è§£ç±»ä¸å†æ˜¯POJOï¼ŒåŒæ—¶è®¤ä¸ºæ³¨è§£é…ç½®ä¼šå¾ˆåˆ†æ•£ï¼Œæœ€ç»ˆéš¾ä»¥æ§åˆ¶ã€‚</p><p>æ— è®ºé€‰æ‹©å¦‚ä½•ï¼ŒSpringéƒ½å¯ä»¥å…¼é¡¾ä¸¤ç§é£æ ¼ï¼Œç”šè‡³å¯ä»¥å°†å®ƒä»¬æ··åˆåœ¨ä¸€èµ·ã€‚Springé€šè¿‡å…¶<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-java">JavaConfig</a> é€‰é¡¹ï¼Œå…è®¸æ³¨è§£ä»¥æ— ä¾µå…¥çš„æ–¹å¼ä½¿ç”¨ï¼Œå³æ— éœ€æ¥è§¦ç›®æ ‡ç»„ä»¶æºä»£ç ã€‚ è€Œä¸”åœ¨å·¥å…·åº”ç”¨æ–¹é¢ï¼Œ <a href="https://spring.io/tools/sts">Spring Tool Suite</a>æ”¯æŒæ‰€æœ‰é…ç½®å½¢å¼ã€‚</p><p>XMLè®¾ç½®çš„æ›¿ä»£æ–¹æ³•æ˜¯åŸºäºæ³¨è§£çš„é…ç½®ï¼Œå®ƒä¾èµ–äºå­—èŠ‚ç å…ƒæ•°æ®æ¥è¿æ¥ç»„ä»¶è¿›è€Œæ›¿ä»£XMLå£°æ˜ã€‚å¼€å‘äººå‘˜é€šè¿‡ä½¿ç”¨ç›¸å…³ç±»ã€æ–¹æ³•æˆ–å­—æ®µå£°æ˜ä¸Šçš„æ³¨è§£æ¥å°†é…ç½®ç§»åŠ¨åˆ°ç»„ä»¶ç±»æœ¬èº«ã€‚è€Œä¸æ˜¯ä½¿ç”¨XML beanæ¥é…ç½®ã€‚ å¦‚ç¤ºä¾‹ä¸­æ‰€è¿°ï¼Œ<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-extension-bpp-examples-rabpp"><code>RequiredAnnotationBeanPostProcessor</code></a>,å°†<code>BeanPostProcessor</code> ä¸æ³¨è§£æ··åˆä½¿ç”¨æ˜¯æ‰©å±•Spring IoCå®¹å™¨çš„å¸¸ç”¨æ–¹æ³•ã€‚ ä¾‹å¦‚ï¼ŒSpring 2.0å¼•å…¥äº†ä½¿ç”¨<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-required-annotation"><code>@Required</code></a>æ³¨è§£å¼ºåˆ¶å±æ€§å¿…é¡»åœ¨é…ç½®çš„æ—¶å€™è¢«å¡«å……ï¼Œ Spring 2.5ä½¿ç”¨åŒæ ·çš„æ–¹å¼æ¥é©±åŠ¨Springçš„ä¾èµ–æ³¨å…¥ã€‚æœ¬è´¨ä¸Šï¼Œ<code>@Autowired</code>æ³¨è§£æä¾›çš„åŠŸèƒ½ä¸<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-autowire">è‡ªåŠ¨è£…é…åä½œ</a>ä¸­æè¿°çš„ç›¸åŒï¼Œä½†å…·æœ‰æ›´ç»†ç²’åº¦çš„æ§åˆ¶å’Œæ›´å¹¿æ³›çš„é€‚ç”¨æ€§ã€‚ Spring 2.5è¿˜å¢åŠ äº†å¯¹JSR-250æ³¨è§£çš„æ”¯æŒï¼Œä¾‹å¦‚<code>@PostConstruct</code>å’Œ<code>@PreDestroy</code>ã€‚ Spring 3.0å¢åŠ äº†å¯¹<code>javax.inject</code>åŒ…ä¸­åŒ…å«çš„JSR-330ï¼ˆJavaçš„ä¾èµ–æ³¨å…¥ï¼‰æ³¨è§£çš„æ”¯æŒï¼Œ ä¾‹å¦‚<code>@Inject</code>å’Œ<code>@Named</code>ã€‚æœ‰å…³è¿™äº›æ³¨è§£çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-standard-annotations">ç›¸å…³ç« èŠ‚</a>ã€‚</p><p>æ³¨è§£æ³¨å…¥åœ¨XMLæ³¨å…¥ä¹‹å‰æ‰§è¡Œï¼Œå› æ­¤åŒæ—¶ä½¿ç”¨è¿™ä¸¤ç§æ–¹å¼è¿›è¡Œæ³¨å…¥æ—¶ï¼ŒXMLé…ç½®ä¼šè¦†ç›–æ³¨è§£é…ç½®ã€‚</p><p>ä¸ä¹‹å‰ä¸€æ ·ï¼Œä½ å¯ä»¥å°†å®ƒä»¬æ³¨å†Œä¸ºå•ç‹¬çš„beanå®šä¹‰ï¼Œä½†ä¹Ÿå¯ä»¥é€šè¿‡åœ¨åŸºäºXMLçš„Springé…ç½®ä¸­åŒ…å«ä»¥ä¸‹æ ‡è®°æ¥éšå¼æ³¨å†Œå®ƒä»¬ï¼ˆè¯·æ³¨æ„åŒ…å«<code>context</code>å‘½åç©ºé—´ï¼‰ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span>    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>    <span class="hljs-attr">xmlns:context</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/context&quot;</span>    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans.xsd        http://www.springframework.org/schema/context        http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">context:annotation-config</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ï¼ˆéšå¼æ³¨å†Œçš„åå¤„ç†å™¨åŒ…æ‹¬ <a href="https://docs.spring.io/spring-framework/docs/5.1.3.BUILD-SNAPSHOT/javadoc-api/org/springframework/beans/factory/annotation/AutowiredAnnotationBeanPostProcessor.html"><code>AutowiredAnnotationBeanPostProcessor</code></a>, <a href="https://docs.spring.io/spring-framework/docs/5.1.3.BUILD-SNAPSHOT/javadoc-api/org/springframework/context/annotation/CommonAnnotationBeanPostProcessor.html"><code>CommonAnnotationBeanPostProcessor</code></a>, <a href="https://docs.spring.io/spring-framework/docs/5.1.3.BUILD-SNAPSHOT/javadoc-api/org/springframework/orm/jpa/support/PersistenceAnnotationBeanPostProcessor.html"><code>PersistenceAnnotationBeanPostProcessor</code></a>, å’Œå‰é¢æåˆ°çš„ <a href="https://docs.spring.io/spring-framework/docs/5.1.3.BUILD-SNAPSHOT/javadoc-api/org/springframework/beans/factory/annotation/RequiredAnnotationBeanPostProcessor.html"><code>RequiredAnnotationBeanPostProcessor</code></a>.)</p><p><code>&lt;context:annotation-config/&gt;</code>åªæœ‰åœ¨å®šä¹‰beançš„ç›¸åŒåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­æŸ¥æ‰¾beanä¸Šçš„æ³¨è§£ã€‚ è¿™æ„å‘³ç€ï¼Œå¦‚æœå°† <code>&lt;context:annotation-config/&gt;</code> æ”¾åœ¨<code>DispatcherServlet</code>çš„<code>WebApplicationContext</code>ä¸­ï¼Œ å®ƒåªæ£€æŸ¥æ§åˆ¶å™¨ä¸­çš„<code>@Autowired</code> beanï¼Œè€Œä¸æ£€æŸ¥æ‚¨çš„æœåŠ¡ã€‚ æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="https://github.com/DocsHome/spring-docs/blob/master/pages/web/web.md#mvc-servlet">DispatcherServlet</a>ã€‚</p><h4 id="1-9-1-Required"><a href="#1-9-1-Required" class="headerlink" title="1.9.1. @Required"></a>1.9.1. @Required</h4><p><code>@Required</code>æ³¨è§£é€‚ç”¨äºbeanå±æ€§setteræ–¹æ³•ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleMovieLister</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">MovieFinder</span> movieFinder;<br>    <span class="hljs-meta">@Required</span>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setMovieFinder</span>(<span class="hljs-params">MovieFinder movieFinder</span>) &#123;        <span class="hljs-variable language_">this</span>.<span class="hljs-property">movieFinder</span> = movieFinder;    &#125;<br>    <span class="hljs-comment">// ...&#125;</span><br></code></pre></td></tr></table></figure><p>æ­¤æ³¨è§£ä»…è¡¨ç¤ºå—å½±å“çš„beanå±æ€§å¿…é¡»åœ¨é…ç½®æ—¶é€šè¿‡beanå®šä¹‰ä¸­çš„æ˜¾å¼èµ‹å€¼æˆ–è‡ªåŠ¨æ³¨å…¥å€¼ã€‚å¦‚æœå—å½±å“çš„beanå±æ€§å°šæœªæŒ‡å®šå€¼ï¼Œå®¹å™¨å°†æŠ›å‡ºå¼‚å¸¸ï¼›è¿™å¯¼è‡´åŠæ—¶çš„ã€æ˜ç¡®çš„å¤±è´¥ï¼Œé¿å…åœ¨è¿è¡Œåå†æŠ›å‡º<code>NullPointerException</code>æˆ–ç±»ä¼¼çš„å¼‚å¸¸ã€‚ åœ¨è¿™é‡Œï¼Œå»ºè®®å¼€å‘è€…å°†æ–­è¨€æ”¾å…¥beanç±»æœ¬èº«ï¼Œä¾‹å¦‚æ”¾å…¥initæ–¹æ³•ã€‚è¿™æ ·åšå¼ºåˆ¶æ‰§è¡Œé‚£äº›å¿…éœ€çš„å¼•ç”¨å’Œå€¼ï¼Œå³ä½¿æ˜¯åœ¨å®¹å™¨å¤–ä½¿ç”¨è¿™ä¸ªç±»ã€‚</p><h4 id="1-9-2-Autowired"><a href="#1-9-2-Autowired" class="headerlink" title="1.9.2. @Autowired"></a>1.9.2. <code>@Autowired</code></h4><p>å¯ä»¥ä½¿ç”¨JSR 330çš„ <code>@Inject</code>æ³¨è§£ä»£æ›¿æœ¬èŠ‚ä¸­åŒ…å«çš„ç¤ºä¾‹ä¸­çš„Springçš„<code>@Autowired</code>æ³¨è§£ã€‚ æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œ<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-standard-annotations">è¯·å‚è§æ­¤å¤„</a></p><p>å¼€å‘è€…å¯ä»¥åœ¨æ„é€ å™¨ä¸Šä½¿ç”¨<code>@Autowired</code>æ³¨è§£:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MovieRecommender</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> CustomerPreferenceDao customerPreferenceDao;<br>    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">public</span> MovieRecommender(CustomerPreferenceDao customerPreferenceDao) &#123;        <span class="hljs-keyword">this</span>.customerPreferenceDao = customerPreferenceDao;    &#125;<br>    <span class="hljs-comment">// ...&#125;</span><br></code></pre></td></tr></table></figure><p>ä»Spring Framework 4.3å¼€å§‹ï¼Œå¦‚æœç›®æ ‡beanä»…å®šä¹‰ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œåˆ™ä¸å†éœ€è¦<code>@Autowired</code>æ„é€ å‡½æ•°ã€‚å¦‚æœæœ‰å¤šä¸ªæ„é€ å‡½æ•°å¯ç”¨ï¼Œåˆ™è‡³å°‘æœ‰ä¸€ä¸ªå¿…é¡»æ³¨è§£<code>@Autowired</code>ä»¥è®©å®¹å™¨çŸ¥é“å®ƒä½¿ç”¨çš„æ˜¯å“ªä¸ª</p><p>æ‚¨è¿˜å¯ä»¥å°†<code>@Autowired</code>æ³¨è§£åº”ç”¨äºâ€œä¼ ç»Ÿâ€setteræ–¹æ³•ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleMovieLister</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">MovieFinder</span> movieFinder;<br>    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setMovieFinder</span>(<span class="hljs-params">MovieFinder movieFinder</span>) &#123;        <span class="hljs-variable language_">this</span>.<span class="hljs-property">movieFinder</span> = movieFinder;    &#125;<br>    <span class="hljs-comment">// ...&#125;</span><br></code></pre></td></tr></table></figure><p>æ‚¨è¿˜å¯ä»¥å°†æ³¨è§£åº”ç”¨äºå…·æœ‰ä»»æ„åç§°å’Œå¤šä¸ªå‚æ•°çš„æ–¹æ³•ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MovieRecommender</span> &#123;<br>    <span class="hljs-keyword">private</span> MovieCatalog movieCatalog;<br>    <span class="hljs-keyword">private</span> CustomerPreferenceDao customerPreferenceDao;<br>    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">public</span> void prepare(MovieCatalog movieCatalog,            CustomerPreferenceDao customerPreferenceDao) &#123;        <span class="hljs-keyword">this</span>.movieCatalog = movieCatalog;        <span class="hljs-keyword">this</span>.customerPreferenceDao = customerPreferenceDao;    &#125;<br>    <span class="hljs-comment">// ...&#125;</span><br></code></pre></td></tr></table></figure><p>è¿˜å¯ä»¥å°†<code>@Autowired</code>åº”ç”¨äºå­—æ®µï¼Œç”šè‡³å¯ä»¥å’Œæ„é€ å‡½æ•°æ··åˆä½¿ç”¨:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MovieRecommender</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> CustomerPreferenceDao customerPreferenceDao;<br>    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">private</span> MovieCatalog movieCatalog;<br>    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">public</span> MovieRecommender(CustomerPreferenceDao customerPreferenceDao) &#123;        <span class="hljs-keyword">this</span>.customerPreferenceDao = customerPreferenceDao;    &#125;<br>    <span class="hljs-comment">// ...&#125;</span><br></code></pre></td></tr></table></figure><p>ç¡®ä¿æ‚¨çš„ç»„ä»¶ï¼ˆä¾‹å¦‚ï¼Œ<code>MovieCatalog</code>æˆ–<code>CustomerPreferenceDao</code>ï¼‰å§‹ç»ˆæŒ‰ç…§ç”¨äº@Autowiredæ³¨å…¥ç‚¹çš„ç±»å‹å£°æ˜ã€‚ å¦åˆ™ï¼Œç”±äºåœ¨è¿è¡Œæ—¶æœªæ‰¾åˆ°ç±»å‹åŒ¹é…ï¼Œæ³¨å…¥å¯èƒ½ä¼šå¤±è´¥ã€‚</p><p>å¯¹äºé€šè¿‡ç±»è·¯å¾„æ‰«ææ‰¾åˆ°çš„XMLå®šä¹‰çš„beanæˆ–ç»„ä»¶ç±»ï¼Œå®¹å™¨é€šå¸¸é¢„å…ˆçŸ¥é“å…·ä½“ç±»å‹ã€‚ ä½†æ˜¯ï¼Œå¯¹äº<code>@Bean</code>å·¥å‚æ–¹æ³•ï¼Œæ‚¨éœ€è¦ç¡®ä¿å…¶å£°æ˜çš„å…·ä½“è¿”å›ç±»å‹ã€‚ å¯¹äºå®ç°å¤šä¸ªæ¥å£çš„ç»„ä»¶æˆ–å¯èƒ½ç”±å…¶å®ç°ç±»å‹å¼•ç”¨çš„ç»„ä»¶ï¼Œè¯·è€ƒè™‘åœ¨å·¥å‚æ–¹æ³•ä¸Šå£°æ˜æœ€å…·ä½“çš„è¿”å›ç±»å‹ï¼ˆè‡³å°‘ä¸å¼•ç”¨beançš„æ³¨å…¥ç‚¹æ‰€éœ€çš„ç‰¹å®šç±»å‹ä¸€è‡´ï¼‰ã€‚ .</p><p>ä¹Ÿå¯ä»¥ç”¨åœ¨æ•°ç»„ä¸Šï¼Œæ³¨è§£ç”¨äºæ ‡æ³¨å±æ€§æˆ–æ–¹æ³•ï¼Œæ•°ç»„çš„ç±»å‹æ˜¯<code>ApplicationContext</code>ä¸­å®šä¹‰çš„beanç±»å‹ã€‚å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MovieRecommender</span> &#123;<br>    <span class="hljs-variable">@Autowired</span>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">MovieCatalog</span>[] movieCatalogs;<br>    <span class="hljs-regexp">//</span> ...&#125;<br></code></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥åº”ç”¨äºé›†åˆç±»å‹ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MovieRecommender</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Set</span>&lt;<span class="hljs-title class_">MovieCatalog</span>&gt; movieCatalogs;<br>    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setMovieCatalogs</span>(<span class="hljs-params"><span class="hljs-built_in">Set</span>&lt;MovieCatalog&gt; movieCatalogs</span>) &#123;        <span class="hljs-variable language_">this</span>.<span class="hljs-property">movieCatalogs</span> = movieCatalogs;    &#125;<br>    <span class="hljs-comment">// ...&#125;</span><br></code></pre></td></tr></table></figure><p>å¦‚æœæƒ³è®©æ•°ç»„å…ƒç´ æˆ–é›†åˆå…ƒç´ æŒ‰ç‰¹å®šé¡ºåºæ’åˆ—ï¼Œåº”ç”¨çš„beanå¯ä»¥å®ç°<code>org.springframework.core.Ordered</code>ï¼Œ æˆ–è€…ä½¿ç”¨<code>@Order</code>æˆ–æ ‡å‡†çš„@<code>@Priority</code> æ³¨è§£ï¼Œå¦åˆ™ï¼Œå®ƒä»¬çš„é¡ºåºéµå¾ªå®¹å™¨ä¸­ç›¸åº”ç›®æ ‡beanå®šä¹‰çš„æ³¨å†Œé¡ºåºã€‚</p><p>æ‚¨å¯ä»¥åœ¨ç±»çº§åˆ«å’Œ<code>@Bean</code>æ–¹æ³•ä¸Šå£°æ˜ <code>@Order</code>æ³¨è§£ï¼Œå¯èƒ½æ˜¯é€šè¿‡å•ä¸ªbeanå®šä¹‰ï¼ˆåœ¨å¤šä¸ªå®šä¹‰ä½¿ç”¨ç›¸åŒbeanç±»çš„æƒ…å†µä¸‹ï¼‰ã€‚ <code>@Order</code>å€¼å¯èƒ½ä¼šå½±å“æ³¨å…¥ç‚¹çš„ä¼˜å…ˆçº§ï¼Œä½†è¦æ³¨æ„å®ƒä»¬ä¸ä¼šå½±å“å•ä¾‹å¯åŠ¨é¡ºåºï¼Œè¿™æ˜¯ç”±ä¾èµ–å…³ç³»å’Œ<code>@DependsOn</code>å£°æ˜ç¡®å®šçš„ã€‚</p><p>è¯·æ³¨æ„ï¼Œæ ‡å‡†çš„<code>javax.annotation.Priority</code>æ³¨è§£åœ¨<code>@Bean</code>çº§åˆ«ä¸å¯ç”¨ï¼Œå› ä¸ºå®ƒæ— æ³•åœ¨æ–¹æ³•ä¸Šå£°æ˜ã€‚ å®ƒçš„è¯­ä¹‰å¯ä»¥é€šè¿‡<code>@Order</code>å€¼ä¸<code>@Primary</code>å®šä¹‰æ¯ä¸ªç±»å‹çš„å•ä¸ªbeanä¸Šã€‚</p><p>åªè¦é”®ç±»å‹æ˜¯<code>String</code>ï¼Œ<code>Map</code>ç±»å‹å°±å¯ä»¥è‡ªåŠ¨æ³¨å…¥ã€‚ Mapå€¼å°†åŒ…å«æ‰€æœ‰ç±»å‹çš„beanï¼Œå¹¶ä¸”é”®å°†åŒ…å«ç›¸åº”çš„beanåç§°ã€‚å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MovieRecommender</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">MovieCatalog</span>&gt; movieCatalogs;<br>    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setMovieCatalogs</span>(<span class="hljs-params"><span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, MovieCatalog&gt; movieCatalogs</span>) &#123;        <span class="hljs-variable language_">this</span>.<span class="hljs-property">movieCatalogs</span> = movieCatalogs;    &#125;<br>    <span class="hljs-comment">// ...&#125;</span><br></code></pre></td></tr></table></figure><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“æ²¡æœ‰å€™é€‰çš„beanå¯ç”¨æ—¶ï¼Œè‡ªåŠ¨æ³¨å…¥å°†ä¼šå¤±è´¥ï¼›é»˜è®¤çš„å¤„ç†æ–¹å¼æ˜¯å°†å¸¦æœ‰æ³¨è§£çš„æ–¹æ³•ï¼Œã€æ„é€ å‡½æ•°å’Œå­—æ®µæ ‡æ˜ä¸ºrequired&#x3D;falseå±æ€§ã€‚è¿™ç§è®¾ç½®ä¸æ˜¯å¿…é¡»çš„ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleMovieLister</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">MovieFinder</span> movieFinder;<br>    <span class="hljs-meta">@Autowired</span>(required = <span class="hljs-literal">false</span>)    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setMovieFinder</span>(<span class="hljs-params">MovieFinder movieFinder</span>) &#123;        <span class="hljs-variable language_">this</span>.<span class="hljs-property">movieFinder</span> = movieFinder;    &#125;<br>    <span class="hljs-comment">// ...&#125;</span><br></code></pre></td></tr></table></figure><p>åªæœ‰ä¸€ä¸ªå¸¦æ³¨è§£çš„æ„é€ å‡½æ•°per-class å¯ä»¥æ ‡è®°ä¸ºrequiredï¼Œä½†æ˜¯å¯ä»¥æ³¨è§£å¤šä¸ªéå¿…éœ€çš„æ„é€ å‡½æ•°ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¯ä¸ªé¡¹éƒ½ä¼šæ˜¯å€™é€‰è€…ï¼Œè€ŒSpringä½¿ç”¨çš„æ˜¯æœ€è´ªå©ªçš„æ„é€ å‡½æ•°ã€‚ è¿™ä¸ªæ„é€ å‡½æ•°çš„ä¾èµ–å…³ç³»å¯ä»¥å¾—åˆ°æ»¡è¶³ï¼Œé‚£å°±æ˜¯å…·æœ‰æœ€å¤šå‚æ•°çš„æ„é€ å‡½æ•°ã€‚</p><p>æ¨èä½¿ç”¨<code>@Required</code>æ³¨è§£æ¥ä»£æ›¿<code>@Autowired</code>çš„requiredå±æ€§ï¼Œrequiredå±æ€§è¡¨ç¤ºè¯¥å±æ€§ä¸æ˜¯è‡ªåŠ¨è£…é…å¿…éœ€çš„ï¼Œå¦‚æœè¯¥å±æ€§ä¸èƒ½è¢«è‡ªåŠ¨è£…é…ã€‚ åˆ™è¯¥å±æ€§ä¼šè¢«å¿½ç•¥ã€‚ å¦ä¸€æ–¹é¢ï¼Œ <code>@Required</code>ä¼šå¼ºè°ƒé€šè¿‡å®¹å™¨æ”¯æŒçš„ä»»ä½•æ–¹å¼æ¥è®¾ç½®å±æ€§ã€‚ å¦‚æœæ²¡æœ‰å€¼è¢«æ³¨å…¥çš„è¯ï¼Œä¼šå¼•å‘ç›¸åº”çš„å¼‚å¸¸ã€‚</p><p>æˆ–è€…ï¼Œæ‚¨å¯ä»¥é€šè¿‡Java 8çš„<code>java.util.Optional</code>è¡¨è¾¾ç‰¹å®šä¾èµ–é¡¹çš„éå¿…éœ€ç‰¹æ€§ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleMovieLister</span> &#123;<br>    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setMovieFinder</span>(<span class="hljs-params">Optional&lt;MovieFinder&gt; movieFinder</span>) &#123;        ...    &#125;&#125;<br></code></pre></td></tr></table></figure><p>ä»Spring Framework 5.0å¼€å§‹ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨<code>@Nullable</code> æ³¨è§£ï¼ˆä»»ä½•åŒ…ä¸­çš„ä»»ä½•ç±»å‹ï¼Œä¾‹å¦‚ï¼Œæ¥è‡ªJSR-305çš„ <code>javax.annotation.Nullable</code>ï¼‰ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">SimpleMovieLister</span> &#123;<br>    <span class="hljs-variable">@Autowired</span>    public void <span class="hljs-built_in">setMovieFinder</span>(<span class="hljs-variable">@Nullable</span> MovieFinder movieFinder) &#123;        ...    &#125;&#125;<br></code></pre></td></tr></table></figure><p>æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨<code>@Autowired</code>ä½œä¸ºå¸¸è§çš„å¯è§£æä¾èµ–å…³ç³»çš„æ¥å£ï¼Œ<code>BeanFactory</code>, <code>ApplicationContext</code>, <code>Environment</code>, <code>ResourceLoader</code>, <code>ApplicationEventPublisher</code>, å’Œ <code>MessageSource</code> è¿™äº›æ¥å£åŠå…¶æ‰©å±•æ¥å£ï¼ˆä¾‹å¦‚<code>ConfigurableApplicationContext</code> æˆ– <code>ResourcePatternResolver</code>ï¼‰ ä¼šè‡ªåŠ¨è§£æï¼Œæ— éœ€ç‰¹æ®Šè®¾ç½®ã€‚ ä»¥ä¸‹ç¤ºä¾‹è‡ªåŠ¨è£…é…<code>ApplicationContext</code>å¯¹è±¡ï¼š</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MovieRecommender</span> </span>&#123;<br>    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">private</span> ApplicationContext context;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MovieRecommender</span><span class="hljs-params">()</span> </span>&#123;    &#125;<br>    <span class="hljs-comment">// ...&#125;</span><br></code></pre></td></tr></table></figure><p><code>@Autowired</code>, <code>@Inject</code>, <code>@Resource</code>, å’Œ <code>@Value</code> æ³¨è§£ ç”± Spring <code>BeanPostProcessor</code> å®ç°.ä¹Ÿå°±æ˜¯è¯´å¼€å‘è€…ä¸èƒ½ä½¿ç”¨è‡ªå®šä¹‰çš„<code>BeanPostProcessor</code>æˆ–è€…è‡ªå®šä¹‰<code>BeanFactoryPostProcessor</code>ræ¥ä½¿ç”¨è¿™äº›æ³¨è§£ å¿…é¡»ä½¿ç”¨XMLæˆ–Spring @Beanæ–¹æ³•æ˜¾å¼åœ°â€œè¿æ¥â€è¿™äº›ç±»å‹ã€‚</p><h4 id="1-9-3-Primary"><a href="#1-9-3-Primary" class="headerlink" title="1.9.3. @Primary"></a>1.9.3. <code>@Primary</code></h4><p>ç”±äºæŒ‰ç±»å‹çš„è‡ªåŠ¨æ³¨å…¥å¯èƒ½åŒ¹é…åˆ°å¤šä¸ªå€™é€‰è€…ï¼Œæ‰€ä»¥é€šå¸¸éœ€è¦å¯¹é€‰æ‹©è¿‡ç¨‹æ·»åŠ æ›´å¤šçš„çº¦æŸã€‚ä½¿ç”¨Springçš„<code>@Primary</code>æ³¨è§£æ˜¯å®ç°è¿™ä¸ªçº¦æŸçš„ä¸€ç§æ–¹æ³•ã€‚ å®ƒè¡¨ç¤ºå¦‚æœå­˜åœ¨å¤šä¸ªå€™é€‰è€…ä¸”å¦ä¸€ä¸ªbeanåªéœ€è¦ä¸€ä¸ªç‰¹å®šç±»å‹çš„beanä¾èµ–æ—¶ï¼Œå°±æ˜ç¡®ä½¿ç”¨æ ‡è®°æœ‰<code>@Primary</code>æ³¨è§£çš„é‚£ä¸ªä¾èµ–ã€‚å¦‚æœå€™é€‰ä¸­åªæœ‰ä¸€ä¸ªâ€Primaryâ€ beanï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯è‡ªåŠ¨æ³¨å…¥çš„å€¼</p><p>è¯·è€ƒè™‘ä»¥ä¸‹é…ç½®ï¼Œå°†<code>firstMovieCatalog</code>å®šä¹‰ä¸ºä¸»è¦<code>MovieCatalog</code>ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Configurationpublic</span> class MovieConfiguration &#123;<br>    <span class="hljs-variable">@Bean</span>    <span class="hljs-variable">@Primary</span>    public MovieCatalog <span class="hljs-built_in">firstMovieCatalog</span>() &#123; ... &#125;<br>    <span class="hljs-variable">@Bean</span>    public MovieCatalog <span class="hljs-built_in">secondMovieCatalog</span>() &#123; ... &#125;<br>    <span class="hljs-comment">// ...&#125;</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ä¸Šè¿°é…ç½®ï¼Œä»¥ä¸‹ <code>MovieRecommender</code>å°†ä¸<code>firstMovieCatalog</code>ä¸€èµ·è‡ªåŠ¨è£…é…ï¼š</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MovieRecommender</span> &#123;<br>    <span class="hljs-variable">@Autowired</span>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">MovieCatalog</span> movieCatalog;<br>    <span class="hljs-regexp">//</span> ...&#125;<br></code></pre></td></tr></table></figure><p>ç›¸åº”çš„beanå®šä¹‰å¦‚ä¸‹:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span>    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>    <span class="hljs-attr">xmlns:context</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/context&quot;</span>    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans.xsd        http://www.springframework.org/schema/context        http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">context:annotation-config</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;example.SimpleMovieCatalog&quot;</span> <span class="hljs-attr">primary</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span>        <span class="hljs-comment">&lt;!-- inject any dependencies required by this bean --&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;example.SimpleMovieCatalog&quot;</span>&gt;</span>        <span class="hljs-comment">&lt;!-- inject any dependencies required by this bean --&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;movieRecommender&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;example.MovieRecommender&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="1-9-4-ä½¿ç”¨qualifierså¾®è°ƒåŸºäºæ³¨è§£çš„è‡ªåŠ¨è£…é…"><a href="#1-9-4-ä½¿ç”¨qualifierså¾®è°ƒåŸºäºæ³¨è§£çš„è‡ªåŠ¨è£…é…" class="headerlink" title="1.9.4. ä½¿ç”¨qualifierså¾®è°ƒåŸºäºæ³¨è§£çš„è‡ªåŠ¨è£…é…"></a>1.9.4. ä½¿ç”¨qualifierså¾®è°ƒåŸºäºæ³¨è§£çš„è‡ªåŠ¨è£…é…</h4><p><code>@Primary</code> æ˜¯ä¸€ç§ç”¨äºè§£å†³è‡ªåŠ¨è£…é…å¤šä¸ªå€¼çš„æ³¨å…¥çš„æœ‰æ•ˆçš„æ–¹æ³•ï¼Œå½“éœ€è¦å¯¹é€‰æ‹©è¿‡ç¨‹åšæ›´å¤šçš„çº¦æŸæ—¶ï¼Œå¯ä»¥ä½¿ç”¨Springçš„<code>@Qualifier</code>æ³¨è§£ï¼Œå¯ä»¥ä¸ºæŒ‡å®šçš„å‚æ•°ç»‘å®šé™å®šçš„å€¼ã€‚ ç¼©å°ç±»å‹åŒ¹é…é›†ï¼Œä»¥ä¾¿ä¸ºæ¯ä¸ªå‚æ•°é€‰æ‹©ç‰¹å®šçš„beanã€‚ åœ¨æœ€ç®€å•çš„æƒ…å†µä¸‹ï¼Œè¿™å¯ä»¥æ˜¯ä¸€ä¸ªç®€å•çš„æè¿°æ€§å€¼ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">MovieRecommender</span> &#123;<br>    <span class="hljs-variable">@Autowired</span>    <span class="hljs-variable">@Qualifier</span>(<span class="hljs-string">&quot;main&quot;</span>)    private MovieCatalog movieCatalog;<br>    <span class="hljs-comment">// ...&#125;</span><br></code></pre></td></tr></table></figure><p>æ‚¨è¿˜å¯ä»¥åœ¨å„ä¸ªæ„é€ å‡½æ•°å‚æ•°æˆ–æ–¹æ³•å‚æ•°ä¸ŠæŒ‡å®š<code>@Qualifier</code>æ³¨è§£ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MovieRecommender</span> &#123;<br>    <span class="hljs-keyword">private</span> MovieCatalog movieCatalog;<br>    <span class="hljs-keyword">private</span> CustomerPreferenceDao customerPreferenceDao;<br>    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">public</span> void prepare(<span class="hljs-meta">@Qualifier(<span class="hljs-string">&quot;main&quot;</span>)</span>MovieCatalog movieCatalog,            CustomerPreferenceDao customerPreferenceDao) &#123;        <span class="hljs-keyword">this</span>.movieCatalog = movieCatalog;        <span class="hljs-keyword">this</span>.customerPreferenceDao = customerPreferenceDao;    &#125;<br>    <span class="hljs-comment">// ...&#125;</span><br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†ç›¸åº”çš„beanå®šä¹‰ã€‚.</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span>    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>    <span class="hljs-attr">xmlns:context</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/context&quot;</span>    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans.xsd        http://www.springframework.org/schema/context        http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">context:annotation-config</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;example.SimpleMovieCatalog&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">qualifier</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;main&quot;</span>/&gt;</span> (1)<br>        <span class="hljs-comment">&lt;!-- inject any dependencies required by this bean --&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;example.SimpleMovieCatalog&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">qualifier</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;action&quot;</span>/&gt;</span> (2)<br>        <span class="hljs-comment">&lt;!-- inject any dependencies required by this bean --&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;movieRecommender&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;example.MovieRecommender&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>1</strong>ã€å¸¦æœ‰é™å®šç¬¦â€<code>main</code>â€çš„beanä¼šè¢«è£…é…åˆ°æ‹¥æœ‰ç›¸åŒå€¼çš„æ„é€ æ–¹æ³•å‚æ•°ä¸Š.</p><p><strong>2</strong>ã€å¸¦æœ‰é™å®šç¬¦â€<code>action</code>â€çš„beanä¼šè¢«è£…é…åˆ°æ‹¥æœ‰ç›¸åŒå€¼çš„æ„é€ æ–¹æ³•å‚æ•°ä¸Š.</p><p>beançš„nameä¼šä½œä¸ºå¤‡ç”¨çš„qualifierå€¼,å› æ­¤å¯ä»¥å®šä¹‰beançš„<code>id</code>ä¸º main æ›¿ä»£å†…åµŒçš„qualifierå…ƒç´ .è¿™ç§åŒ¹é…æ–¹å¼åŒæ ·æœ‰æ•ˆã€‚ä½†æ˜¯ï¼Œè™½ç„¶å¯ä»¥ä½¿ç”¨è¿™ä¸ªçº¦å®šæ¥æŒ‰åç§°å¼•ç”¨ç‰¹å®šçš„beanï¼Œ ä½†æ˜¯<code>@Autowired</code>é»˜è®¤æ˜¯ç”±å¸¦é™å®šç¬¦çš„ç±»å‹é©±åŠ¨æ³¨å…¥çš„ã€‚è¿™å°±æ„å‘³ç€qualifierå€¼ï¼Œç”šè‡³æ˜¯beançš„nameä½œä¸ºå¤‡é€‰é¡¹ï¼Œåªæ˜¯ä¸ºäº†ç¼©å°ç±»å‹åŒ¹é…çš„èŒƒå›´ã€‚å®ƒä»¬åœ¨è¯­ä¹‰ä¸Šä¸è¡¨ç¤ºå¯¹å”¯ä¸€bean idçš„å¼•ç”¨ã€‚ è‰¯å¥½çš„é™å®šç¬¦å€¼æ˜¯åƒ<code>main</code> æˆ– <code>EMEA</code> æˆ– <code>persistent</code>è¿™æ ·çš„ï¼Œèƒ½è¡¨ç¤ºä¸bean idæ— å…³çš„ç‰¹å®šç»„ä»¶çš„ç‰¹å¾ï¼Œåœ¨åŒ¿åbeanå®šä¹‰çš„æƒ…å†µä¸‹å¯ä»¥è‡ªåŠ¨ç”Ÿæˆã€‚</p><p>Qualifiersä¹Ÿå¯ä»¥ç”¨äºé›†åˆç±»å‹ï¼Œå¦‚ä¸Šæ‰€è¿°ï¼Œä¾‹å¦‚ <code>Set&lt;MovieCatalog&gt;</code>ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ ¹æ®å£°æ˜çš„é™å®šç¬¦ï¼Œæ‰€æœ‰åŒ¹é…çš„beanéƒ½ä½œä¸ºé›†åˆæ³¨å…¥ã€‚ è¿™æ„å‘³ç€é™å®šç¬¦ä¸å¿…æ˜¯å”¯ä¸€çš„ã€‚ ç›¸åï¼Œå®ƒä»¬æ„æˆè¿‡æ»¤æ ‡å‡†ã€‚ ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ç›¸åŒçš„é™å®šç¬¦å€¼â€œactionâ€å®šä¹‰å¤šä¸ª<code>MovieCatalog</code> beanï¼Œæ‰€æœ‰è¿™äº›beanéƒ½æ³¨å…¥åˆ°ä½¿ç”¨<code>@Qualifier(&quot;action&quot;)</code>æ³¨è§£çš„<code>Set&lt;MovieCatalog&gt;</code>ä¸­ã€‚</p><p>åœ¨ç±»å‹åŒ¹é…å€™é€‰é¡¹ä¸­ï¼Œæ ¹æ®ç›®æ ‡beanåç§°é€‰æ‹©é™å®šç¬¦å€¼ï¼Œåœ¨æ³¨å…¥ç‚¹ä¸éœ€è¦<code>@Qualifier</code>æ³¨è§£ã€‚ å¦‚æœæ²¡æœ‰å…¶ä»–è§£ææŒ‡ç¤ºç¬¦ï¼ˆä¾‹å¦‚é™å®šç¬¦æˆ–ä¸»æ ‡è®°ï¼‰ï¼Œ åˆ™å¯¹äºéå”¯ä¸€ä¾èµ–æ€§æƒ…å†µï¼ŒSpringä¼šå°†æ³¨å…¥ç‚¹åç§°ï¼ˆå³å­—æ®µåç§°æˆ–å‚æ•°åç§°ï¼‰ä¸ç›®æ ‡beanåç§°è¿›è¡ŒåŒ¹é…ï¼Œç„¶åé€‰æ‹©åŒåçš„å€™é€‰è€…ï¼Œå¦‚æœæœ‰çš„è¯ã€‚</p><p>å¦‚æœæ‰“ç®—by nameæ¥é©±åŠ¨æ³¨è§£æ³¨å…¥ï¼Œé‚£ä¹ˆå°±ä¸è¦ä½¿ç”¨<code>@Autowired</code>ï¼ˆå¤šæ•°æƒ…å†µï¼‰ï¼Œå³ä½¿åœ¨æŠ€æœ¯ä¸Šèƒ½å¤Ÿé€šè¿‡@Qualifierå€¼å¼•ç”¨beanåå­—ã€‚ç›¸åï¼Œåº”è¯¥ä½¿ç”¨JSR-250 <code>@Resource</code> æ³¨è§£ï¼Œè¯¥æ³¨è§£åœ¨è¯­ä¹‰ä¸Šå®šä¹‰ä¸ºé€šè¿‡å…¶å”¯ä¸€åç§°æ ‡è¯†ç‰¹å®šç›®æ ‡ç»„ä»¶ï¼Œå…¶ä¸­å£°æ˜çš„ç±»å‹ä¸åŒ¹é…è¿›ç¨‹æ— å…³ã€‚<code>@Autowired</code>å…·æœ‰å¤šç§ä¸åŒçš„è¯­ä¹‰ï¼Œåœ¨by typeé€‰æ‹©å€™é€‰beanä¹‹åï¼ŒæŒ‡å®šçš„<code>String</code>é™å®šçš„å€¼åªä¼šè€ƒè™‘è¿™äº›è¢«é€‰æ‹©çš„å€™é€‰è€…ã€‚ ä¾‹å¦‚å°†<code>account</code> é™å®šç¬¦ä¸æ ‡æœ‰ç›¸åŒé™å®šç¬¦æ ‡ç­¾çš„beanç›¸åŒ¹é…ã€‚</p><p>å¯¹äºè‡ªèº«å®šä¹‰ä¸º collection, <code>Map</code>, æˆ–è€… array typeçš„beanï¼Œ <code>@Resource</code>æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡å”¯ä¸€åç§°å¼•ç”¨ç‰¹å®šçš„é›†åˆæˆ–æ•°ç»„beanã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œä»Spring4.3å¼€å§‹ï¼Œåªè¦å…ƒç´ ç±»å‹ä¿¡æ¯ä¿å­˜åœ¨ <code>@Bean</code> è¿”å›ç±»å‹ç­¾åæˆ–é›†åˆï¼ˆæˆ–å…¶å­ç±»ï¼‰ä¸­ï¼Œæ‚¨å°±å¯ä»¥é€šè¿‡Springçš„ <code>@Autowired</code>ç±»å‹åŒ¹é…ç®—æ³•åŒ¹é…Mapå’Œæ•°ç»„ç±»å‹ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨é™å®šçš„å€¼æ¥é€‰æ‹©ç›¸åŒç±»å‹çš„é›†åˆï¼Œå¦‚ä¸Šä¸€æ®µæ‰€è¿°ã€‚</p><p>ä»Spring4.3å¼€å§‹ï¼Œ<code>@Autowired</code>ä¹Ÿè€ƒè™‘äº†æ³¨å…¥çš„è‡ªå¼•ç”¨ï¼Œå³å¼•ç”¨å½“å‰æ³¨å…¥çš„beanã€‚è‡ªå¼•ç”¨åªæ˜¯ä¸€ç§åå¤‡é€‰é¡¹ï¼Œè¿˜æ˜¯ä¼˜å…ˆä½¿ç”¨æ­£å¸¸çš„ä¾èµ–æ³¨å…¥æ“ä½œå…¶å®ƒbeanã€‚ åœ¨è¿™ä¸ªæ„ä¹‰ä¸Šï¼Œè‡ªå¼•ç”¨ä¸å‚ä¸åˆ°æ­£å¸¸çš„å€™é€‰è€…é€‰æ‹©ä¸­ï¼Œå¹¶ä¸”æ€»æ˜¯æ¬¡è¦çš„ï¼Œï¼Œç›¸åï¼Œå®ƒä»¬æ€»æ˜¯æ‹¥æœ‰æœ€ä½çš„ä¼˜å…ˆçº§ã€‚åœ¨å®è·µä¸­ï¼Œè‡ªå¼•ç”¨é€šå¸¸è¢«ç”¨ä½œæœ€åçš„æ‰‹æ®µã€‚ä¾‹å¦‚ï¼Œé€šè¿‡beançš„äº‹åŠ¡ä»£ç†åœ¨åŒä¸€å®ä¾‹ä¸Šè°ƒç”¨å…¶ä»–æ–¹æ³• åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè€ƒè™‘å°†å—å½±å“çš„æ–¹æ³•åˆ†è§£ä¸ºå•ç‹¬å§”æ‰˜çš„beanï¼Œæˆ–è€…ä½¿ç”¨ <code>@Resource</code>,ï¼Œå®ƒå¯ä»¥é€šè¿‡å…¶å”¯ä¸€åç§°è·å–ä»£ç†è¿”å›åˆ°å½“å‰çš„beanä¸Šã€‚</p><p><code>@Autowired</code>å¯ä»¥åº”ç”¨åœ¨å­—æ®µã€æ„é€ å‡½æ•°å’Œå¤šå‚æ•°æ–¹æ³•ä¸Šï¼Œå…è®¸åœ¨å‚æ•°ä¸Šä½¿ç”¨qualifieré™å®šç¬¦æ³¨è§£ç¼©å°å–å€¼èŒƒå›´ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œ<code>@Resource</code>ä»…æ”¯æŒå…·æœ‰å•ä¸ªå‚æ•°çš„å­—æ®µå’Œbeanå±æ€§setteræ–¹æ³•ã€‚ å› æ­¤ï¼Œå¦‚æœæ³¨å…¥ç›®æ ‡æ˜¯æ„é€ å‡½æ•°æˆ–å¤šå‚æ•°æ–¹æ³•ï¼Œè¯·ä½¿ç”¨qualifiersé™å®šç¬¦ã€‚</p><p>å¼€å‘è€…ä¹Ÿå¯ä»¥åˆ›å»ºè‡ªå®šä¹‰çš„é™å®šç¬¦æ³¨è§£ï¼Œåªéœ€å®šä¹‰ä¸€ä¸ªæ³¨è§£ï¼Œåœ¨å…¶ä¸Šæä¾›äº†@Qualifieræ³¨è§£å³å¯ã€‚å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Target</span>(&#123;ElementType.FIELD, ElementType.PARAMETER&#125;)<span class="hljs-variable">@Retention</span>(RetentionPolicy.RUNTIME)<span class="hljs-variable">@Qualifierpublic</span> <span class="hljs-variable">@interface</span> Genre &#123;<br>    <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">value</span>();&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åï¼Œæ‚¨å¯ä»¥åœ¨è‡ªåŠ¨è£…é…çš„å­—æ®µå’Œå‚æ•°ä¸Šæä¾›è‡ªå®šä¹‰é™å®šç¬¦ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MovieRecommender</span> &#123;<br>    <span class="hljs-meta">@Autowired</span>    <span class="hljs-meta">@Genre(<span class="hljs-string">&quot;Action&quot;</span>)</span>    <span class="hljs-keyword">private</span> MovieCatalog actionCatalog;<br>    <span class="hljs-keyword">private</span> MovieCatalog comedyCatalog;<br>    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">public</span> void setComedyCatalog(<span class="hljs-meta">@Genre(<span class="hljs-string">&quot;Comedy&quot;</span>)</span> MovieCatalog comedyCatalog) &#123;        <span class="hljs-keyword">this</span>.comedyCatalog = comedyCatalog;    &#125;<br>    <span class="hljs-comment">// ...&#125;</span><br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œæä¾›å€™é€‰beanå®šä¹‰çš„ä¿¡æ¯ã€‚å¼€å‘è€…å¯ä»¥æ·»åŠ <code>&lt;qualifier/&gt;</code>æ ‡ç­¾ä½œä¸º<code>&lt;bean/&gt;</code>æ ‡ç­¾çš„å­å…ƒç´ ï¼Œç„¶åæŒ‡å®š <code>type</code>ç±»å‹å’Œ<code>value</code>å€¼æ¥åŒ¹é…è‡ªå®šä¹‰çš„qualifieræ³¨è§£ã€‚ typeæ˜¯è‡ªå®šä¹‰æ³¨è§£çš„æƒé™å®šç±»å(åŒ…è·¯å¾„+ç±»åï¼‰ã€‚å¦‚æœæ²¡æœ‰é‡åçš„æ³¨è§£ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ç±»å(ä¸å«åŒ…è·¯å¾„ï¼‰ã€‚ ä»¥ä¸‹ç¤ºä¾‹æ¼”ç¤ºäº†ä¸¤ç§æ–¹æ³•ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span>    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>    <span class="hljs-attr">xmlns:context</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/context&quot;</span>    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans.xsd        http://www.springframework.org/schema/context        http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">context:annotation-config</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;example.SimpleMovieCatalog&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">qualifier</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;Genre&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Action&quot;</span>/&gt;</span>        <span class="hljs-comment">&lt;!-- inject any dependencies required by this bean --&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;example.SimpleMovieCatalog&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">qualifier</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;example.Genre&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Comedy&quot;</span>/&gt;</span>        <span class="hljs-comment">&lt;!-- inject any dependencies required by this bean --&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;movieRecommender&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;example.MovieRecommender&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><p>åœ¨ <a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-classpath-scanning">ç±»è·¯å¾„æ‰«æå’Œç»„ä»¶ç®¡ç†</a>,å°†å±•ç¤ºä¸€ä¸ªåŸºäºæ³¨è§£çš„æ›¿ä»£æ–¹æ³•ï¼Œå¯ä»¥åœ¨XMLä¸­æä¾›qualifierå…ƒæ•°æ®, è¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-scanning-qualifiers">ä½¿ç”¨æ³¨è§£æä¾›é™å®šç¬¦å…ƒæ•°æ®ã€‚</a></p><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½¿ç”¨æ²¡æœ‰å€¼çš„æ³¨è§£å¯èƒ½å°±è¶³å¤Ÿäº†ã€‚å½“æ³¨è§£ç”¨äºæ›´é€šç”¨çš„ç›®çš„å¹¶ä¸”å¯ä»¥åº”ç”¨åœ¨å¤šç§ä¸åŒç±»å‹çš„ä¾èµ–ä¸Šæ—¶ï¼Œè¿™æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚ ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥æä¾›å¯åœ¨æ²¡æœ‰Internetè¿æ¥æ—¶æœç´¢çš„Offlineç›®å½•ã€‚ é¦–å…ˆï¼Œå®šä¹‰ç®€å•æ³¨è§£ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Target</span>(&#123;ElementType.FIELD, ElementType.PARAMETER&#125;)<span class="hljs-variable">@Retention</span>(RetentionPolicy.RUNTIME)<span class="hljs-variable">@Qualifierpublic</span> <span class="hljs-variable">@interface</span> Offline &#123;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åå°†æ³¨è§£æ·»åŠ åˆ°éœ€è¦è‡ªåŠ¨æ³¨å…¥çš„å­—æ®µæˆ–å±æ€§ä¸­:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">MovieRecommender</span> &#123;<br>    <span class="hljs-variable">@Autowired</span>    <span class="hljs-variable">@Offline</span> (<span class="hljs-number">1</span>)    private MovieCatalog offlineCatalog;<br>    <span class="hljs-comment">// ...&#125;</span><br></code></pre></td></tr></table></figure><p><strong>1</strong>ã€æ­¤è¡Œæ·»åŠ <code>@Offline</code>æ³¨è§£</p><p>ç°åœ¨beanå®šä¹‰åªéœ€è¦ä¸€ä¸ªé™å®šç¬¦ç±»å‹ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;example.SimpleMovieCatalog&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">qualifier</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;Offline&quot;</span>/&gt;</span> (1)<br><br>    <span class="hljs-comment">&lt;!-- inject any dependencies required by this bean --&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>1</strong>ã€æ­¤å…ƒç´ æŒ‡å®šé™å®šç¬¦ã€‚</p><p>å¼€å‘è€…è¿˜å¯ä»¥ä¸ºè‡ªå®šä¹‰é™å®šåqualifieræ³¨è§£å¢åŠ å±æ€§ï¼Œç”¨äºæ›¿ä»£ç®€å•çš„<code>value</code>å±æ€§ã€‚å¦‚æœåœ¨è¦è‡ªåŠ¨æ³¨å…¥çš„å­—æ®µæˆ–å‚æ•°ä¸ŠæŒ‡å®šäº†å¤šä¸ªå±æ€§å€¼ï¼Œåˆ™beançš„å®šä¹‰å¿…é¡»å…¨éƒ¨åŒ¹é…è¿™äº›å±æ€§å€¼æ‰èƒ½è¢«è§†ä¸ºè‡ªåŠ¨æ³¨å…¥å€™é€‰è€…ã€‚ ä¾‹å¦‚ï¼Œè¯·è€ƒè™‘ä»¥ä¸‹æ³¨è§£å®šä¹‰ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Target</span>(&#123;ElementType.FIELD, ElementType.PARAMETER&#125;)<span class="hljs-variable">@Retention</span>(RetentionPolicy.RUNTIME)<span class="hljs-variable">@Qualifierpublic</span> <span class="hljs-variable">@interface</span> MovieQualifier &#123;<br>    <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">genre</span>();<br>    <span class="hljs-selector-tag">Format</span> <span class="hljs-selector-tag">format</span>();&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ <code>Format</code>æ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹ï¼Œå®šä¹‰å¦‚ä¸‹:</p><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs fortran"><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-keyword">Format</span> &#123;<br><br>    VHS, DVD, BLURAY<br><br>&#125;<br></code></pre></td></tr></table></figure><p>è¦è‡ªåŠ¨è£…é…çš„å­—æ®µä½¿ç”¨è‡ªå®šä¹‰é™å®šç¬¦è¿›è¡Œæ³¨è§£ï¼Œå¹¶åŒ…å«ä¸¤ä¸ªå±æ€§çš„å€¼ï¼š<code>genre</code> å’Œ <code>format</code>ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">MovieRecommender</span> &#123;<br>    <span class="hljs-variable">@Autowired</span>    <span class="hljs-variable">@MovieQualifier</span>(format=Format.VHS, genre=<span class="hljs-string">&quot;Action&quot;</span>)    private MovieCatalog actionVhsCatalog;<br>    <span class="hljs-variable">@Autowired</span>    <span class="hljs-variable">@MovieQualifier</span>(format=Format.VHS, genre=<span class="hljs-string">&quot;Comedy&quot;</span>)    private MovieCatalog comedyVhsCatalog;<br>    <span class="hljs-variable">@Autowired</span>    <span class="hljs-variable">@MovieQualifier</span>(format=Format.DVD, genre=<span class="hljs-string">&quot;Action&quot;</span>)    private MovieCatalog actionDvdCatalog;<br>    <span class="hljs-variable">@Autowired</span>    <span class="hljs-variable">@MovieQualifier</span>(format=Format.BLURAY, genre=<span class="hljs-string">&quot;Comedy&quot;</span>)    private MovieCatalog comedyBluRayCatalog;<br>    <span class="hljs-comment">// ...&#125;</span><br></code></pre></td></tr></table></figure><p>æœ€åï¼Œbeanå®šä¹‰åº”åŒ…å«åŒ¹é…çš„é™å®šç¬¦å€¼ã€‚æ­¤ç¤ºä¾‹è¿˜æ¼”ç¤ºäº†å¯ä»¥ä½¿ç”¨bean metaå±æ€§è€Œä¸æ˜¯ä½¿ç”¨<code>&lt;qualifier/&gt;</code>å­å…ƒç´ ã€‚å¦‚æœå¯è¡Œï¼Œ<code>&lt;qualifier/&gt;</code>å…ƒç´ åŠå…¶å±æ€§ä¼˜å…ˆï¼Œ ä½†å¦‚æœä¸å­˜åœ¨æ­¤ç±»é™å®šç¬¦ï¼Œé‚£ä¹ˆè‡ªåŠ¨æ³¨å…¥æœºåˆ¶ä¼šä½¿ç”¨ <code>&lt;meta/&gt;</code> æ ‡ç­¾ä¸­æä¾›çš„å€¼ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹ä¸­çš„æœ€åä¸¤ä¸ªbeanå®šä¹‰ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span>    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>    <span class="hljs-attr">xmlns:context</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/context&quot;</span>    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans.xsd        http://www.springframework.org/schema/context        http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">context:annotation-config</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;example.SimpleMovieCatalog&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">qualifier</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;MovieQualifier&quot;</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">attribute</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;format&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;VHS&quot;</span>/&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">attribute</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;genre&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Action&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">qualifier</span>&gt;</span>        <span class="hljs-comment">&lt;!-- inject any dependencies required by this bean --&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;example.SimpleMovieCatalog&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">qualifier</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;MovieQualifier&quot;</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">attribute</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;format&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;VHS&quot;</span>/&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">attribute</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;genre&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Comedy&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">qualifier</span>&gt;</span>        <span class="hljs-comment">&lt;!-- inject any dependencies required by this bean --&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;example.SimpleMovieCatalog&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;format&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;DVD&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;genre&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Action&quot;</span>/&gt;</span>        <span class="hljs-comment">&lt;!-- inject any dependencies required by this bean --&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;example.SimpleMovieCatalog&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;format&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;BLURAY&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;genre&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Comedy&quot;</span>/&gt;</span>        <span class="hljs-comment">&lt;!-- inject any dependencies required by this bean --&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="1-9-5-ä½¿ç”¨æ³›å‹ä½œä¸ºè‡ªåŠ¨è£…é…é™å®šç¬¦"><a href="#1-9-5-ä½¿ç”¨æ³›å‹ä½œä¸ºè‡ªåŠ¨è£…é…é™å®šç¬¦" class="headerlink" title="1.9.5. ä½¿ç”¨æ³›å‹ä½œä¸ºè‡ªåŠ¨è£…é…é™å®šç¬¦"></a>1.9.5. ä½¿ç”¨æ³›å‹ä½œä¸ºè‡ªåŠ¨è£…é…é™å®šç¬¦</h4><p>é™¤äº†<code>@Qualifier</code> æ³¨è§£ä¹‹å¤–ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨Javaæ³›å‹ç±»å‹ä½œä¸ºéšå¼çš„é™å®šå½¢å¼ã€‚ ä¾‹å¦‚ï¼Œå‡è®¾æ‚¨å…·æœ‰ä»¥ä¸‹é…ç½®ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Configurationpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyConfiguration</span> &#123;<br>    <span class="hljs-meta">@Bean</span>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">StringStore</span> <span class="hljs-title function_">stringStore</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringStore</span>();    &#125;<br>    <span class="hljs-meta">@Bean</span>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">IntegerStore</span> <span class="hljs-title function_">integerStore</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IntegerStore</span>();    &#125;&#125;<br></code></pre></td></tr></table></figure><p>å‡è®¾ä¸Šé¢çš„beanéƒ½å®ç°äº†æ³›å‹æ¥å£,å³ <code>Store&lt;String&gt;</code>å’Œ<code>Store&lt;Integer&gt;</code>,é‚£ä¹ˆå¯ä»¥ç”¨<code>@Autowire</code>æ¥æ³¨è§£<code>Store</code> æ¥å£, å¹¶å°†æ³›å‹ç”¨ä½œé™å®šç¬¦ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Autowiredprivate</span> Store&lt;String&gt; s1; <span class="hljs-comment">// &lt;String&gt; qualifier, injects the stringStore bean</span><br><span class="hljs-variable">@Autowiredprivate</span> Store&lt;Integer&gt; s2; <span class="hljs-comment">// &lt;Integer&gt; qualifier, injects the integerStore bean</span><br></code></pre></td></tr></table></figure><p>é€šç”¨é™å®šç¬¦ä¹Ÿé€‚ç”¨äºè‡ªåŠ¨è£…é…åˆ—è¡¨ï¼Œ<code>Map</code>å®ä¾‹å’Œæ•°ç»„ã€‚ ä»¥ä¸‹ç¤ºä¾‹è‡ªåŠ¨è£…é…é€šç”¨<code>List</code>ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-comment">// Inject all Store beans as long as they have an &lt;Integer&gt; generic</span><br><br><span class="hljs-comment">// Store&lt;String&gt; beans will not appear in this list</span><br><br><span class="hljs-meta">@Autowired</span><br><br><span class="hljs-keyword">private</span> <span class="hljs-type">List</span>&lt;<span class="hljs-type">Store</span>&lt;<span class="hljs-type">Integer</span>&gt;&gt; s;<br></code></pre></td></tr></table></figure><h4 id="1-9-6-CustomAutowireConfigurer"><a href="#1-9-6-CustomAutowireConfigurer" class="headerlink" title="1.9.6. CustomAutowireConfigurer"></a>1.9.6. <code>CustomAutowireConfigurer</code></h4><p><a href="https://docs.spring.io/spring-framework/docs/5.1.3.BUILD-SNAPSHOT/javadoc-api/org/springframework/beans/factory/annotation/CustomAutowireConfigurer.html"><code>CustomAutowireConfigurer</code></a> æ˜¯ä¸€ä¸ª<code>BeanFactoryPostProcessor</code>ï¼Œå®ƒå…è®¸å¼€å‘è€…æ³¨å†Œè‡ªå®šä¹‰çš„qualifieræ³¨è§£ç±»å‹ï¼Œè€Œæ— éœ€æŒ‡å®š<code>@Qualifier</code>æ³¨è§£ï¼Œä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•ä½¿ç”¨<code>CustomAutowireConfigurer</code>:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;customAutowireConfigurer&quot;</span></span><br><span class="hljs-tag"></span><br><span class="hljs-tag">        <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.beans.factory.annotation.CustomAutowireConfigurer&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;customQualifierTypes&quot;</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">set</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>example.CustomQualifier<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">set</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p><code>AutowireCandidateResolver</code> é€šè¿‡ä»¥ä¸‹æ–¹å¼ç¡®å®šè‡ªåŠ¨æ³¨å…¥çš„å€™é€‰è€…:</p><ul><li>æ¯ä¸ªbeanå®šä¹‰çš„<code>autowire-candidate</code>å€¼</li><li>åœ¨<code>&lt;beans/&gt;</code>å…ƒç´ ä¸Šä½¿ç”¨ä»»ä½•å¯ç”¨çš„ <code>default-autowire-candidates</code> æ¨¡å¼</li><li>å­˜åœ¨ <code>@Qualifier</code> æ³¨è§£ä»¥åŠä½¿ç”¨<code>CustomAutowireConfigurer</code>æ³¨å†Œçš„ä»»ä½•è‡ªå®šä¹‰æ³¨è§£</li></ul><p>å½“å¤šä¸ªbeanæœ‰èµ„æ ¼ä½œä¸ºè‡ªåŠ¨æ³¨å…¥çš„å€™é€‰é¡¹æ—¶ï¼Œâ€œprimaryâ€çš„ç¡®å®šå¦‚ä¸‹ï¼šå¦‚æœå€™é€‰è€…ä¸­åªæœ‰ä¸€ä¸ªbeanå®šä¹‰çš„ <code>primary</code>å±æ€§è®¾ç½®ä¸º<code>true</code>ï¼Œåˆ™é€‰æ‹©å®ƒã€‚</p><h4 id="1-9-7-Resource"><a href="#1-9-7-Resource" class="headerlink" title="1.9.7. @Resource"></a>1.9.7. <code>@Resource</code></h4><p>Springè¿˜é€šè¿‡åœ¨å­—æ®µæˆ–beanå±æ€§setteræ–¹æ³•ä¸Šä½¿ç”¨JSR-250 <code>@Resource</code>æ³¨è§£æ¥æ”¯æŒæ³¨å…¥ã€‚ è¿™æ˜¯Java EE 5å’Œ6ä¸­çš„å¸¸è§æ¨¡å¼ï¼ˆä¾‹å¦‚ï¼Œåœ¨JSF 1.2æ‰˜ç®¡beanæˆ–JAX-WS 2.0ç«¯ç‚¹ä¸­ï¼‰ã€‚ Springä¹Ÿä¸ºSpringç®¡ç†å¯¹è±¡æä¾›è¿™ç§æ¨¡å¼ã€‚</p><p><code>@Resource</code> æ¥å—ä¸€ä¸ªnameå±æ€§.ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpringå°†è¯¥å€¼è§£é‡Šä¸ºè¦æ³¨å…¥çš„beanåç§°ã€‚ æ¢å¥è¯è¯´ï¼Œå®ƒéµå¾ªæŒ‰åç§°è¯­ä¹‰ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleMovieLister</span> &#123;<br>    <span class="hljs-keyword">private</span> MovieFinder movieFinder;<br>    <span class="hljs-meta">@Resource(name=<span class="hljs-string">&quot;myMovieFinder&quot;</span>)</span> (<span class="hljs-number">1</span>)    <span class="hljs-keyword">public</span> void setMovieFinder(MovieFinder movieFinder) &#123;        <span class="hljs-keyword">this</span>.movieFinder = movieFinder;    &#125;&#125;<br></code></pre></td></tr></table></figure><p><strong>1</strong>ã€è¿™è¡Œæ³¨å…¥ä¸€ä¸ª<code>@Resource</code>.</p><p>å¦‚æœæœªæ˜ç¡®æŒ‡å®šåç§°ï¼Œåˆ™é»˜è®¤åç§°æ˜¯ä»å­—æ®µåç§°æˆ–setteræ–¹æ³•æ´¾ç”Ÿçš„ã€‚ å¦‚æœæ˜¯å­—æ®µï¼Œåˆ™é‡‡ç”¨å­—æ®µåç§°ã€‚ åœ¨setteræ–¹æ³•çš„æƒ…å†µä¸‹ï¼Œå®ƒé‡‡ç”¨beanå±æ€§åç§°ã€‚ ä¸‹é¢çš„ä¾‹å­å°†æŠŠåä¸º<code>movieFinder</code>çš„beanæ³¨å…¥å…¶setteræ–¹æ³•ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleMovieLister</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">MovieFinder</span> movieFinder;<br>    <span class="hljs-meta">@Resource</span>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setMovieFinder</span>(<span class="hljs-params">MovieFinder movieFinder</span>) &#123;        <span class="hljs-variable language_">this</span>.<span class="hljs-property">movieFinder</span> = movieFinder;    &#125;&#125;<br></code></pre></td></tr></table></figure><p><code>ApplicationContext</code>è‹¥ä½¿ç”¨äº†<code>CommonAnnotationBeanPostProcessor</code>ï¼Œæ³¨è§£æä¾›çš„nameåå­—å°†è¢«è§£æä¸ºbeançš„nameåå­—ã€‚ å¦‚æœé…ç½®äº†Springçš„ <a href="https://docs.spring.io/spring-framework/docs/5.1.3.BUILD-SNAPSHOT/javadoc-api/org/springframework/jndi/support/SimpleJndiBeanFactory.html"><code>SimpleJndiBeanFactory</code></a>ï¼Œè¿™äº›nameåç§°å°±å¯ä»¥é€šè¿‡JNDIè§£æã€‚ä½†æ˜¯ï¼Œæ¨èä½¿ç”¨é»˜è®¤çš„é…ç½®ï¼Œç®€å•åœ°ä½¿ç”¨Springçš„JNDIï¼Œè¿™æ ·å¯ä»¥ä¿æŒé€»è¾‘å¼•ç”¨ã€‚è€Œä¸æ˜¯ç›´æ¥å¼•ç”¨ã€‚</p><p>@Resourceåœ¨æ²¡æœ‰æ˜ç¡®æŒ‡å®šnameæ—¶ï¼Œå…¶è¡Œä¸ºç±»ä¼¼äº<code>@Autowired</code>ï¼Œå¯¹äºç‰¹å®šbean(Spring APIå†…çš„beanï¼‰ï¼Œ <code>@Resource</code> æ‰¾åˆ°ä¸»è¦ç±»å‹åŒ¹é…è€Œä¸æ˜¯ç‰¹å®šçš„å‘½åbeanï¼Œ å¹¶è§£æä¼—æ‰€å‘¨çŸ¥çš„å¯è§£æä¾èµ–é¡¹ï¼š<code>ApplicationContext</code>, <code>ResourceLoader</code>, <code>ApplicationEventPublisher</code>, å’Œ <code>MessageSource</code>æ¥å£ã€‚</p><p>å› æ­¤ï¼Œåœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œ<code>customerPreferenceDao</code>å­—æ®µé¦–å…ˆæŸ¥æ‰¾åä¸ºcustomerPreferenceDaoçš„beanï¼Œå¦‚æœæœªæ‰¾åˆ°ï¼Œåˆ™ä¼šä½¿ç”¨ç±»å‹åŒ¹é…<code>CustomerPreferenceDao</code>ç±»çš„å®ä¾‹ï¼š</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MovieRecommender</span> </span>&#123;<br>    <span class="hljs-meta">@Resource</span>    <span class="hljs-keyword">private</span> CustomerPreferenceDao customerPreferenceDao;<br>    <span class="hljs-meta">@Resource</span>    <span class="hljs-keyword">private</span> ApplicationContext context; (<span class="hljs-number">1</span>)<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MovieRecommender</span><span class="hljs-params">()</span> </span>&#123;    &#125;<br>    <span class="hljs-comment">// ...&#125;</span><br></code></pre></td></tr></table></figure><p><strong>1</strong>ã€<code>context</code>åŸŸå°†ä¼šæ³¨å…¥<code>ApplicationContext</code></p><h4 id="1-9-8-PostConstruct-å’Œ-PreDestroy"><a href="#1-9-8-PostConstruct-å’Œ-PreDestroy" class="headerlink" title="1.9.8. @PostConstruct å’Œ @PreDestroy"></a>1.9.8. <code>@PostConstruct</code> å’Œ <code>@PreDestroy</code></h4><p><code>CommonAnnotationBeanPostProcessor</code> ä¸ä»…ä»…è¯†åˆ«<code>@Resource</code> æ³¨è§£ï¼Œè¿˜è¯†åˆ«JSR-250ç”Ÿå‘½å‘¨æœŸæ³¨è§£ã€‚ï¼Œåœ¨Spring 2.5ä¸­å¼•å…¥äº†è¿™äº›æ³¨è§£ï¼Œ å®ƒä»¬æä¾›äº†å¦ä¸€ä¸ªæ›¿ä»£<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-lifecycle-initializingbean">åˆå§‹åŒ–å›è°ƒ</a>å’Œ<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-lifecycle-disposablebean">é”€æ¯å›è°ƒ</a>ã€‚ å¦‚æœ<code>CommonAnnotationBeanPostProcessor</code>åœ¨Spring <code>ApplicationContext</code>ä¸­æ³¨å†Œï¼Œå®ƒä¼šåœ¨ç›¸åº”çš„Spring beanç”Ÿå‘½å‘¨æœŸä¸­è°ƒç”¨ç›¸åº”çš„æ–¹æ³•ï¼Œå°±åƒæ˜¯Springç”Ÿå‘½å‘¨æœŸæ¥å£æ–¹æ³•ï¼Œæˆ–è€…æ˜¯æ˜ç¡®å£°æ˜çš„å›è°ƒå‡½æ•°é‚£æ ·ã€‚ åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œç¼“å­˜åœ¨åˆå§‹åŒ–æ—¶é¢„å…ˆå¡«å……å¹¶åœ¨é”€æ¯æ—¶æ¸…é™¤ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CachingMovieLister</span> &#123;<br>    <span class="hljs-meta">@PostConstruct</span>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">populateMovieCache</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-comment">// populates the movie cache upon initialization...    &#125;</span><br>    <span class="hljs-meta">@PreDestroy</span>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">clearMovieCache</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-comment">// clears the movie cache upon destruction...    &#125;&#125;</span><br></code></pre></td></tr></table></figure><p>æœ‰å…³ç»„åˆå„ç§ç”Ÿå‘½å‘¨æœŸæœºåˆ¶çš„å½±å“çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…ç»„åˆ<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-lifecycle-combined-effects">ç”Ÿå‘½å‘¨æœŸæœºåˆ¶</a>ã€‚</p><h3 id="1-10-ç±»è·¯å¾„æ‰«æå’Œç®¡ç†ç»„ä»¶"><a href="#1-10-ç±»è·¯å¾„æ‰«æå’Œç®¡ç†ç»„ä»¶" class="headerlink" title="1.10. ç±»è·¯å¾„æ‰«æå’Œç®¡ç†ç»„ä»¶"></a>1.10. ç±»è·¯å¾„æ‰«æå’Œç®¡ç†ç»„ä»¶</h3><p>æœ¬ç« ä¸­çš„å¤§å¤šæ•°ç¤ºä¾‹ä¼šä½¿ç”¨XMLé…ç½®æŒ‡å®šåœ¨Springå®¹å™¨ä¸­ç”Ÿæˆæ¯ä¸ª<code>BeanDefinition</code>çš„å…ƒæ•°æ®ï¼Œä¸Šä¸€èŠ‚ï¼ˆ<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-annotation-config">åŸºäºæ³¨è§£çš„å®¹å™¨é…ç½®</a>ï¼‰æ¼”ç¤ºäº†å¦‚ä½•é€šè¿‡æºä»£ç æ³¨è§£æä¾›å¤§é‡çš„å…ƒæ•°æ®é…ç½®ã€‚ ç„¶è€Œï¼Œå³ä½¿åœ¨è¿™äº›ç¤ºä¾‹ä¸­ï¼Œæ³¨è§£ä¹Ÿä»…ä»…ç”¨äºé©±åŠ¨ä¾èµ–æ³¨å…¥ã€‚ â€œbaseâ€ beanä¾ç„¶ä¼šæ˜¾å¼åœ°åœ¨XMLæ–‡ä»¶ä¸­å®šä¹‰ã€‚æœ¬èŠ‚ä»‹ç»é€šè¿‡æ‰«æç±»è·¯å¾„éšå¼æ£€æµ‹å€™é€‰ç»„ä»¶çš„é€‰é¡¹ã€‚å€™é€‰è€…ç»„ä»¶æ˜¯classç±»ï¼Œ è¿™äº›ç±»ç»è¿‡è¿‡æ»¤åŒ¹é…ï¼Œç”±Springå®¹å™¨æ³¨å†Œçš„beanå®šä¹‰ä¼šæˆä¸ºSpring beanã€‚è¿™æ¶ˆé™¤äº†ä½¿ç”¨XMLæ‰§è¡Œbeanæ³¨å†Œçš„éœ€è¦(ä¹Ÿå°±æ˜¯æ²¡æœ‰XMLä»€ä¹ˆäº‹å„¿äº†),å¯ä»¥ä½¿ç”¨æ³¨è§£(ä¾‹å¦‚<code>@Component</code>)ï¼Œ AspectJç±»å‹è¡¨è¾¾å¼æˆ–å¼€å‘è€…è‡ªå®šä¹‰è¿‡æ»¤æ¡ä»¶æ¥é€‰æ‹©å“ªäº›ç±»å°†åœ¨å®¹å™¨ä¸­æ³¨å†Œbeanå®šä¹‰ã€‚</p><p>ä»Spring 3.0å¼€å§‹ï¼ŒSpring JavaConfigé¡¹ç›®æä¾›çš„è®¸å¤šåŠŸèƒ½éƒ½æ˜¯æ ¸å¿ƒSpring æ¡†æ¶çš„ä¸€éƒ¨åˆ†ã€‚è¿™å…è®¸å¼€å‘è€…ä½¿ç”¨Javaè€Œä¸æ˜¯ä½¿ç”¨ä¼ ç»Ÿçš„XMLæ–‡ä»¶æ¥å®šä¹‰beanã€‚ æœ‰å…³å¦‚ä½•ä½¿ç”¨è¿™äº›æ–°åŠŸèƒ½çš„ç¤ºä¾‹ï¼Œè¯·æŸ¥çœ‹<code>@Configuration</code>, <code>@Bean</code>,<code>@Import</code>, å’Œ <code>@DependsOn</code>æ³¨è§£ã€‚</p><h4 id="1-10-1-Componentæ³¨è§£å’Œæ›´å¤šæ¨¡æ¿æ³¨è§£"><a href="#1-10-1-Componentæ³¨è§£å’Œæ›´å¤šæ¨¡æ¿æ³¨è§£" class="headerlink" title="1.10.1. @Componentæ³¨è§£å’Œæ›´å¤šæ¨¡æ¿æ³¨è§£"></a>1.10.1. <code>@Component</code>æ³¨è§£å’Œæ›´å¤šæ¨¡æ¿æ³¨è§£</h4><p><code>@Repository</code>æ³¨è§£ç”¨äºæ»¡è¶³å­˜å‚¨åº“(ä¹Ÿç§°ä¸ºæ•°æ®è®¿é—®å¯¹è±¡æˆ–DAO)çš„æƒ…å†µ,è¿™ä¸ªæ³¨è§£çš„ç”¨é€”æ˜¯è‡ªåŠ¨è½¬æ¢å¼‚å¸¸ã€‚å¦‚<a href="https://github.com/DocsHome/spring-docs/blob/master/pages/dataaccess/data-access.md#orm-exception-translation">å¼‚å¸¸è½¬æ¢</a>ä¸­æ‰€è¿°ã€‚</p><p>Springæä¾›äº†æ›´å¤šçš„æ„é€ å‹æ³¨è§£ï¼š<code>@Component</code>, <code>@Service</code>, å’Œ<code>@Controller</code>. <code>@Component</code> å¯ç”¨äºç®¡ç†ä»»ä½•Springçš„ç»„ä»¶ã€‚ <code>@Repository</code>, <code>@Service</code>, æˆ– <code>@Controller</code>æ˜¯<code>@Component</code>çš„ç‰¹æ®ŠåŒ–ã€‚ç”¨äºæ›´å…·ä½“çš„ç”¨ä¾‹ï¼ˆåˆ†åˆ«åœ¨æŒä¹…æ€§ï¼ŒæœåŠ¡å’Œè¡¨ç¤ºå±‚ä¸­ï¼‰ã€‚ å› æ­¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<code>@Component</code>æ³¨è§£ç»„ä»¶ç±»ï¼Œä½†æ˜¯ï¼Œé€šè¿‡ä½¿ç”¨<code>@Repository</code>, <code>@Service</code>, å’Œ <code>@Controller</code>æ³¨è§£å®ƒä»¬ï¼Œèƒ½å¤Ÿè®©ä½ çš„ç±»æ›´æ˜“äºè¢«åˆé€‚çš„å·¥å…·å¤„ç†æˆ–ä¸ç›¸åº”çš„åˆ‡é¢å…³è”ã€‚ ä¾‹å¦‚ï¼Œè¿™äº›æ³¨è§£å¯ä»¥ä½¿ç›®æ ‡ç»„ä»¶å˜æˆåˆ‡å…¥ç‚¹ã€‚åœ¨Springæ¡†æ¶çš„æœªæ¥ç‰ˆæœ¬ä¸­ï¼Œ<code>@Repository</code>, <code>@Service</code>, å’Œ <code>@Controller</code>ä¹Ÿå¯èƒ½å¸¦æœ‰é™„åŠ çš„è¯­ä¹‰ã€‚ å› æ­¤ï¼Œå¦‚æœåœ¨ä½¿ç”¨<code>@Component</code> æˆ– <code>@Service</code> æ¥é€‰æ‹©æœåŠ¡å±‚æ—¶ï¼Œ@Serviceæ˜¾ç„¶æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚åŒç†ï¼Œåœ¨æŒä¹…åŒ–å±‚è¦é€‰æ‹©<code>@Repository</code>ï¼Œå®ƒèƒ½è‡ªåŠ¨è½¬æ¢å¼‚å¸¸ã€‚</p><h4 id="1-10-2-ä½¿ç”¨å…ƒæ³¨è§£å’Œç»„åˆæ³¨è§£"><a href="#1-10-2-ä½¿ç”¨å…ƒæ³¨è§£å’Œç»„åˆæ³¨è§£" class="headerlink" title="1.10.2. ä½¿ç”¨å…ƒæ³¨è§£å’Œç»„åˆæ³¨è§£"></a>1.10.2. ä½¿ç”¨å…ƒæ³¨è§£å’Œç»„åˆæ³¨è§£</h4><p>Springæä¾›çš„è®¸å¤šæ³¨è§£éƒ½å¯ä»¥åœ¨æ‚¨è‡ªå·±çš„ä»£ç ä¸­ç”¨ä½œå…ƒæ³¨è§£ã€‚ å…ƒæ³¨è§£æ˜¯å¯ä»¥åº”ç”¨äºå¦ä¸€ä¸ªæ³¨è§£çš„æ³¨è§£ã€‚ ä¾‹å¦‚ï¼Œ<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-stereotype-annotations">å‰é¢æåˆ°çš„</a> <code>@Service</code>æ³¨è§£æ˜¯ä½¿ç”¨<code>@Component</code>è¿›è¡Œå…ƒæ³¨è§£çš„ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Target</span>(ElementType.TYPE)<span class="hljs-variable">@Retention</span>(RetentionPolicy.RUNTIME)<span class="hljs-variable">@Documented</span><span class="hljs-variable">@Component</span> (<span class="hljs-number">1</span>)public <span class="hljs-variable">@interface</span> Service &#123;<br>    <span class="hljs-comment">// ....&#125;</span><br></code></pre></td></tr></table></figure><p><strong>1</strong>ã€<code>Component</code>ä½¿<code>@Service</code>ä»¥ä¸@<code>@Component</code>ç›¸åŒçš„æ–¹å¼å¤„ç†ã€‚</p><p>å…ƒæ³¨è§£ä¹Ÿå¯ä»¥è¿›è¡Œç»„åˆï¼Œè¿›è€Œåˆ›å»ºç»„åˆæ³¨è§£ã€‚ä¾‹å¦‚ï¼Œæ¥è‡ªSpring MVCçš„<code>@RestController</code>æ³¨è§£æ˜¯ç”±<code>@Controller</code>å’Œ<code>@ResponseBody</code>ç»„æˆçš„</p><p>æ­¤å¤–ï¼Œç»„åˆæ³¨è§£ä¹Ÿå¯ä»¥é‡æ–°å®šä¹‰æ¥è‡ªå…ƒæ³¨è§£çš„å±æ€§ã€‚è¿™åœ¨åªæƒ³å…¬å¼€å…ƒæ³¨è§£çš„éƒ¨åˆ†å±æ€§æ—¶éå¸¸æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼ŒSpringçš„<code>@SessionScope</code>æ³¨è§£å°†å®ƒçš„ä½œç”¨åŸŸç¡¬ç¼–ç ä¸º<code>session</code>ï¼Œä½†ä»å…è®¸è‡ªå®šä¹‰<code>proxyMode</code>ã€‚ ä»¥ä¸‹æ¸…å•æ˜¾ç¤ºäº†<code>SessionScope</code>æ³¨è§£çš„å®šä¹‰ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Target</span>(&#123;ElementType.TYPE, ElementType.METHOD&#125;)<span class="hljs-variable">@Retention</span>(RetentionPolicy.RUNTIME)<span class="hljs-variable">@Documented</span><span class="hljs-variable">@Scope</span>(WebApplicationContext.SCOPE_SESSION)public <span class="hljs-variable">@interface</span> SessionScope &#123;<br>    <span class="hljs-comment">/**     * Alias for &#123;@link Scope#proxyMode&#125;.     * &lt;p&gt;Defaults to &#123;@link ScopedProxyMode#TARGET_CLASS&#125;.     */</span>    <span class="hljs-variable">@AliasFor</span>(annotation = Scope.class)    ScopedProxyMode <span class="hljs-built_in">proxyMode</span>() default ScopedProxyMode.TARGET_CLASS;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<code>@SessionScope</code>è€Œä¸å£°æ˜<code>proxyMode</code>ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Service</span><br><br><span class="hljs-variable">@SessionScope</span><br><br>public class SessionScopedService &#123;<br><br>    <span class="hljs-comment">// ...</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p>æ‚¨è¿˜å¯ä»¥è¦†ç›–<code>proxyMode</code>çš„å€¼ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Service</span><br><br><span class="hljs-variable">@SessionScope</span>(proxyMode = ScopedProxyMode.INTERFACES)<br><br>public class SessionScopedUserService implements UserService &#123;<br><br>    <span class="hljs-comment">// ...</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p>æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://github.com/spring-projects/spring-framework/wiki/Spring-Annotation-Programming-Model">Springæ³¨è§£ç¼–ç¨‹æ¨¡å‹</a>wikié¡µé¢.</p><h4 id="1-10-3-è‡ªåŠ¨æ¢æµ‹ç±»å¹¶æ³¨å†Œbeanå®šä¹‰"><a href="#1-10-3-è‡ªåŠ¨æ¢æµ‹ç±»å¹¶æ³¨å†Œbeanå®šä¹‰" class="headerlink" title="1.10.3. è‡ªåŠ¨æ¢æµ‹ç±»å¹¶æ³¨å†Œbeanå®šä¹‰"></a>1.10.3. è‡ªåŠ¨æ¢æµ‹ç±»å¹¶æ³¨å†Œbeanå®šä¹‰</h4><p>Springå¯ä»¥è‡ªåŠ¨æ£€æµ‹å„ä»£ç å±‚ä¸­è¢«æ³¨è§£çš„ç±»ï¼Œå¹¶ä½¿ç”¨<code>ApplicationContext</code>å†…æ³¨å†Œç›¸åº”çš„<code>BeanDefinition</code>ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹ä¸¤ä¸ªç±»å°±å¯ä»¥è¢«è‡ªåŠ¨æ¢æµ‹ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@Servicepublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleMovieLister</span> &#123;<br>    <span class="hljs-keyword">private</span> MovieFinder movieFinder;<br>    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">public</span> SimpleMovieLister(MovieFinder movieFinder) &#123;        <span class="hljs-keyword">this</span>.movieFinder = movieFinder;    &#125;&#125;<br><span class="hljs-meta">@Repositorypublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JpaMovieFinder</span> <span class="hljs-title">implements</span> <span class="hljs-title">MovieFinder</span> &#123;    <span class="hljs-comment">// implementation elided for clarity&#125;</span><br></code></pre></td></tr></table></figure><p>æƒ³è¦è‡ªåŠ¨æ£€æµ‹è¿™äº›ç±»å¹¶æ³¨å†Œç›¸åº”çš„beanï¼Œéœ€è¦åœ¨<code>@Configuration</code>é…ç½®ä¸­æ·»åŠ <code>@ComponentScan</code>æ³¨è§£ï¼Œå…¶ä¸­<code>basePackages</code>å±æ€§æ˜¯ä¸¤ä¸ªç±»çš„çˆ¶åŒ…è·¯å¾„ã€‚ ï¼ˆæˆ–è€…ï¼Œæ‚¨å¯ä»¥æŒ‡å®šä»¥é€—å·æˆ–åˆ†å·æˆ–ç©ºæ ¼åˆ†éš”çš„åˆ—è¡¨ï¼Œå…¶ä¸­åŒ…å«æ¯ä¸ªç±»çš„çˆ¶åŒ…ï¼‰ã€‚</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Configuration</span><br><br><span class="hljs-variable">@ComponentScan</span>(basePackages = <span class="hljs-string">&quot;org.example&quot;</span>)<br><br>public class AppConfig  &#123;<br><br>    ...<br><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸ºç®€æ´èµ·è§ï¼Œå‰é¢çš„ç¤ºä¾‹å¯èƒ½ä½¿ç”¨äº†æ³¨è§£çš„<code>value</code>å±æ€§ï¼ˆå³<code>@ComponentScan(&quot;org.example&quot;)</code>ï¼‰ã€‚</p><p>æˆ–è€…ä½¿ç”¨XMLé…ç½®ä»£æ›¿æ‰«æ:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span>    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>    <span class="hljs-attr">xmlns:context</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/context&quot;</span>    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans.xsd        http://www.springframework.org/schema/context        http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">&quot;org.example&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨<code>&lt;context:component-scan&gt;</code>éšå¼å¯ç”¨<code>&lt;context:annotation-config&gt;</code>çš„åŠŸèƒ½ã€‚ ä½¿ç”¨<code>&lt;context:component-scan&gt;</code>æ—¶ï¼Œé€šå¸¸ä¸éœ€è¦åŒ…å«<code>&lt;context:annotation-config&gt;</code>å…ƒç´ ã€‚</p><p>ç±»è·¯å¾„æ‰«æçš„åŒ…å¿…é¡»ä¿è¯è¿™äº›åŒ…å‡ºç°åœ¨ç±»è·¯å¾„ä¸­ã€‚å½“ä½¿ç”¨Antæ„å»ºJARæ—¶ï¼Œè¯·ç¡®ä¿ä½ æ²¡æœ‰æ¿€æ´»JARä»»åŠ¡çš„çº¯æ–‡ä»¶å¼€å…³ã€‚æ­¤å¤–åœ¨æŸäº›ç¯å¢ƒè£…ç”±äºå®‰å…¨ç­–ç•¥ï¼Œç±»è·¯å¾„ç›®å½•å¯èƒ½ä¸èƒ½è®¿é—®ã€‚ JDK 1.7.0_45åŠæ›´é«˜ç‰ˆæœ¬ä¸Šçš„ç‹¬ç«‹åº”ç”¨ç¨‹åºï¼ˆéœ€è¦åœ¨æ¸…å•ä¸­è®¾ç½®â€œTrusted-Libraryâ€ï¼‰ - è¯·å‚é˜… <a href="https://stackoverflow.com/questions/19394570/java-jre-7u45-breaks-classloader-getresources">http://stackoverflow.com/questions/19394570/java-jre-7u45-breaks-classloader-getresources</a>ï¼‰ã€‚</p><p>åœ¨JDK 9çš„æ¨¡å—è·¯å¾„ï¼ˆJigsawï¼‰ä¸Šï¼ŒSpringçš„ç±»è·¯å¾„æ‰«æé€šå¸¸æŒ‰é¢„æœŸå·¥ä½œã€‚ï¼Œä½†æ˜¯ï¼Œè¯·ç¡®ä¿åœ¨æ¨¡å—ä¿¡æ¯æè¿°ç¬¦ä¸­å¯¼å‡ºç»„ä»¶ç±»ã€‚ å¦‚æœæ‚¨å¸Œæœ›Springè°ƒç”¨ç±»çš„éå…¬å…±æˆå‘˜ï¼Œè¯·ç¡®ä¿å®ƒä»¬å·²â€œæ‰“å¼€â€ï¼ˆå³ï¼Œå®ƒä»¬åœ¨<code>module-info</code>æè¿°ç¬¦ä¸­ä½¿ç”¨<code>opens</code> å£°æ˜è€Œä¸æ˜¯<code>exports</code>å£°æ˜ï¼‰ã€‚</p><p>åœ¨ä½¿ç”¨component-scanå…ƒç´ æ—¶ï¼Œ <code>AutowiredAnnotationBeanPostProcessor</code> å’Œ <code>CommonAnnotationBeanPostProcessor</code>éƒ½ä¼šéšå¼åŒ…å«ã€‚æ„å‘³ç€è¿™ä¸¤ä¸ªç»„ä»¶ä¹Ÿæ˜¯è‡ªåŠ¨æ¢æµ‹å’Œæ³¨å…¥çš„ã€‚ æ‰€æœ‰è¿™äº›éƒ½æ— éœ€XMLé…ç½®ã€‚</p><p>æ‚¨å¯ä»¥é€šè¿‡annotation-config&#x3D;falseå±æ€§æ¥ç¦ç”¨<code>AutowiredAnnotationBeanPostProcessor</code> å’Œ<code>CommonAnnotationBeanPostProcessor</code>çš„æ³¨å†Œã€‚</p><h4 id="1-10-4-åœ¨è‡ªå®šä¹‰æ‰«æä¸­ä½¿ç”¨è¿‡æ»¤å™¨"><a href="#1-10-4-åœ¨è‡ªå®šä¹‰æ‰«æä¸­ä½¿ç”¨è¿‡æ»¤å™¨" class="headerlink" title="1.10.4. åœ¨è‡ªå®šä¹‰æ‰«æä¸­ä½¿ç”¨è¿‡æ»¤å™¨"></a>1.10.4. åœ¨è‡ªå®šä¹‰æ‰«æä¸­ä½¿ç”¨è¿‡æ»¤å™¨</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨<code>@Component</code>, <code>@Repository</code>, <code>@Service</code>,<code>@Controller</code>æ³¨è§£çš„ç±»æˆ–è€…æ³¨è§£ä¸º<code>@Component</code>çš„è‡ªå®šä¹‰æ³¨è§£ç±»æ‰èƒ½è¢«æ£€æµ‹ä¸ºå€™é€‰ç»„ä»¶ã€‚ ä½†æ˜¯ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡åº”ç”¨è‡ªå®šä¹‰è¿‡æ»¤å™¨æ¥ä¿®æ”¹å’Œæ‰©å±•æ­¤è¡Œä¸ºã€‚å°†å®ƒä»¬æ·»åŠ ä¸º<code>@ComponentScan</code>æ³¨è§£çš„<code>includeFilters</code>æˆ–<code>excludeFilters</code>å‚æ•°(æˆ–ä½œä¸º<code>component-scan</code> å…ƒç´ ã€‚å…ƒç´ çš„<code>include-filter</code>æˆ–<code>exclude-filter</code>å­å…ƒç´ ã€‚æ¯ä¸ªfilterå…ƒç´ éƒ½éœ€è¦åŒ…å«<code>type</code>å’Œ<code>expression</code>å±æ€§ã€‚ä¸‹è¡¨ä»‹ç»äº†ç­›é€‰é€‰é¡¹ï¼š</p><p>Table 5.è¿‡æ»¤ç±»å‹</p><table><thead><tr><th>è¿‡æ»¤ç±»å‹</th><th>è¡¨è¾¾å¼ä¾‹å­</th><th>æè¿°</th></tr></thead><tbody><tr><td>annotation (default)</td><td><code>org.example.SomeAnnotation</code></td><td>è¦åœ¨ç›®æ ‡ç»„ä»¶ä¸­çš„ç±»çº§åˆ«å‡ºç°çš„æ³¨è§£ã€‚</td></tr><tr><td>assignable</td><td><code>org.example.SomeClass</code></td><td>ç›®æ ‡ç»„ä»¶å¯åˆ†é…ç»™ï¼ˆç»§æ‰¿æˆ–å®ç°ï¼‰çš„ç±»ï¼ˆæˆ–æ¥å£ï¼‰ã€‚</td></tr><tr><td>aspectj</td><td><code>org.example..*Service+</code></td><td>è¦ç”±ç›®æ ‡ç»„ä»¶åŒ¹é…çš„AspectJç±»å‹è¡¨è¾¾å¼ã€‚</td></tr><tr><td>regex</td><td><code>org\.example\.Default.*</code></td><td>è¦ç”±ç›®æ ‡ç»„ä»¶ç±»ååŒ¹é…çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚</td></tr><tr><td>custom</td><td><code>org.example.MyTypeFilter</code></td><td><code>org.springframework.core.type .TypeFilter</code>æ¥å£çš„è‡ªå®šä¹‰å®ç°ã€‚</td></tr></tbody></table><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¿½ç•¥æ‰€æœ‰<code>@Repository</code> æ³¨è§£å¹¶ä½¿ç”¨â€œstubâ€å­˜å‚¨åº“çš„é…ç½®ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Configuration</span><br><br><span class="hljs-variable">@ComponentScan</span>(basePackages = <span class="hljs-string">&quot;org.example&quot;</span>,<br><br>        includeFilters = <span class="hljs-variable">@Filter</span>(type = FilterType.REGEX, pattern = <span class="hljs-string">&quot;.*Stub.*Repository&quot;</span>),<br><br>        excludeFilters = <span class="hljs-variable">@Filter</span>(Repository.class))<br><br>public class AppConfig &#123;<br><br>    ...<br><br>&#125;<br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹æ¸…å•æ˜¾ç¤ºäº†ç­‰æ•ˆçš„XMLï¼š:</p><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs vhdl">&lt;beans&gt;<br><br>    &lt;<span class="hljs-keyword">context</span>:<span class="hljs-keyword">component</span>-scan base-<span class="hljs-keyword">package</span>=<span class="hljs-string">&quot;org.example&quot;</span>&gt;<br><br>        &lt;<span class="hljs-keyword">context</span>:include-filter <span class="hljs-keyword">type</span>=<span class="hljs-string">&quot;regex&quot;</span><br><br>                expression=<span class="hljs-string">&quot;.*Stub.*Repository&quot;</span>/&gt;<br><br>        &lt;<span class="hljs-keyword">context</span>:exclude-filter <span class="hljs-keyword">type</span>=<span class="hljs-string">&quot;annotation&quot;</span><br><br>                expression=<span class="hljs-string">&quot;org.springframework.stereotype.Repository&quot;</span>/&gt;<br><br>    &lt;/<span class="hljs-keyword">context</span>:<span class="hljs-keyword">component</span>-scan&gt;<br><br>&lt;/beans&gt;<br></code></pre></td></tr></table></figure><p>ä½ è¿˜å¯ä»¥é€šè¿‡åœ¨æ³¨è§£ä¸Šè®¾ç½®<code>useDefaultFilters=false</code>æˆ–é€šè¿‡<code>use-default-filters=&quot;false&quot;</code>ä½œä¸º&lt;<code>&lt;component-scan/&gt;</code> å…ƒç´ çš„å±æ€§æ¥ç¦ç”¨é»˜è®¤è¿‡æ»¤å™¨ã€‚è¿™æ ·å°†ä¸ä¼šè‡ªåŠ¨æ£€æµ‹å¸¦æœ‰<code>@Component</code>, <code>@Repository</code>,<code>@Service</code>, <code>@Controller</code>, æˆ– <code>@Configuration</code>.</p><h4 id="1-10-5-åœ¨ç»„ä»¶ä¸­å®šä¹‰beançš„å…ƒæ•°æ®"><a href="#1-10-5-åœ¨ç»„ä»¶ä¸­å®šä¹‰beançš„å…ƒæ•°æ®" class="headerlink" title="1.10.5.åœ¨ç»„ä»¶ä¸­å®šä¹‰beançš„å…ƒæ•°æ®"></a>1.10.5.åœ¨ç»„ä»¶ä¸­å®šä¹‰beançš„å…ƒæ•°æ®</h4><p>Springç»„ä»¶ä¹Ÿå¯ä»¥å‘å®¹å™¨æä¾›beanå®šä¹‰å…ƒæ•°æ®ï¼Œã€‚åœ¨<code>@Configuration</code>æ³¨è§£çš„ç±»ä¸­ä½¿ç”¨<code>@Bean</code>æ³¨è§£å®šä¹‰beanå…ƒæ•°æ®(ä¹Ÿå°±æ˜¯Spring bean),ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Componentpublic</span> class FactoryMethodComponent &#123;<br>    <span class="hljs-variable">@Bean</span>    <span class="hljs-variable">@Qualifier</span>(<span class="hljs-string">&quot;public&quot;</span>)    public TestBean <span class="hljs-built_in">publicInstance</span>() &#123;        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">TestBean</span>(<span class="hljs-string">&quot;publicInstance&quot;</span>);    &#125;<br>    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">doWork</span>() &#123;        <span class="hljs-comment">// Component method implementation omitted    &#125;&#125;</span><br></code></pre></td></tr></table></figure><p>è¿™ä¸ªç±»æ˜¯ä¸€ä¸ªSpringç»„ä»¶ï¼Œå®ƒæœ‰ä¸ª <code>doWork()</code>æ–¹æ³•ã€‚ç„¶è€Œï¼Œå®ƒè¿˜æœ‰ä¸€ä¸ªå·¥å‚æ–¹æ³• <code>publicInstance()</code>ç”¨äºäº§ç”Ÿbeanå®šä¹‰ã€‚<code>@Bean</code>æ³¨è§£äº†å·¥å‚æ–¹æ³•ï¼Œ è¿˜è®¾ç½®äº†å…¶ä»–beanå®šä¹‰çš„å±æ€§ï¼Œä¾‹å¦‚é€šè¿‡<code>@Qualifier</code>æ³¨è§£çš„qualifierå€¼ã€‚å¯ä»¥æŒ‡å®šçš„å…¶ä»–æ–¹æ³•çº§åˆ«çš„æ³¨è§£æ˜¯ <code>@Scope</code>, <code>@Lazy</code>ä»¥åŠè‡ªå®šä¹‰çš„qualifieræ³¨è§£ã€‚</p><p>é™¤äº†ç”¨äºç»„ä»¶åˆå§‹åŒ–çš„è§’è‰²ä¹‹å¤–ï¼Œ<code>@Lazy</code>æ³¨è§£ä¹Ÿå¯ä»¥åœ¨<code>@Autowired</code>æˆ–è€…code&gt;@Injectæ³¨è§£ä¸Šï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯¥æ³¨å…¥å°†ä¼šå˜æˆå»¶è¿Ÿæ³¨å…¥ä»£ç†lazy-resolution proxyï¼ˆä¹Ÿå°±æ˜¯æ‡’åŠ è½½ï¼‰ã€‚</p><p>è‡ªåŠ¨æ³¨å…¥çš„å­—æ®µå’Œæ–¹æ³•ä¹Ÿå¯ä»¥åƒå‰é¢è®¨è®ºçš„ä¸€æ ·è¢«æ”¯æŒï¼Œä¹Ÿæ”¯æŒ<code>@Bean</code>æ–¹æ³•çš„è‡ªåŠ¨æ³¨å…¥ã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œï¼š:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Componentpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FactoryMethodComponent</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> int i;<br>    <span class="hljs-meta">@Bean</span>    <span class="hljs-meta">@Qualifier</span>(<span class="hljs-string">&quot;public&quot;</span>)    <span class="hljs-keyword">public</span> <span class="hljs-title class_">TestBean</span> <span class="hljs-title function_">publicInstance</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestBean</span>(<span class="hljs-string">&quot;publicInstance&quot;</span>);    &#125;<br>    <span class="hljs-comment">// use of a custom qualifier and autowiring of method parameters    @Bean    protected TestBean protectedInstance(            @Qualifier(&quot;public&quot;) TestBean spouse,            @Value(&quot;#&#123;privateInstance.age&#125;&quot;) String country) &#123;        TestBean tb = new TestBean(&quot;protectedInstance&quot;, 1);        tb.setSpouse(spouse);        tb.setCountry(country);        return tb;    &#125;</span><br>    <span class="hljs-meta">@Bean</span>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">TestBean</span> <span class="hljs-title function_">privateInstance</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestBean</span>(<span class="hljs-string">&quot;privateInstance&quot;</span>, i++);    &#125;<br>    <span class="hljs-meta">@Bean</span>    <span class="hljs-meta">@RequestScope</span>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">TestBean</span> <span class="hljs-title function_">requestScopedInstance</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestBean</span>(<span class="hljs-string">&quot;requestScopedInstance&quot;</span>, <span class="hljs-number">3</span>);    &#125;&#125;<br></code></pre></td></tr></table></figure><p>è¯¥ç¤ºä¾‹å°†æ–¹æ³•å‚æ•°ä¸º<code>String</code>ï¼Œåç§°ä¸º<code>country</code>çš„beanè‡ªåŠ¨è£…é…ä¸ºå¦ä¸€ä¸ªåä¸º<code>privateInstance</code>çš„beançš„<code>age</code>å±æ€§å€¼ã€‚ Springè¡¨è¾¾å¼è¯­è¨€å…ƒç´ é€šè¿‡è®°å·<code>#&#123; &lt;expression&gt; &#125;</code>æ¥å®šä¹‰å±æ€§çš„å€¼ã€‚å¯¹äº <code>@Value</code>æ³¨è§£ï¼Œè¡¨è¾¾å¼è§£æå™¨åœ¨è§£æè¡¨è¾¾å¼åï¼Œä¼šæŸ¥æ‰¾beançš„åå­—å¹¶è®¾ç½®valueå€¼ã€‚</p><p>ä»Spring4.3å¼€å§‹ï¼Œæ‚¨è¿˜å¯ä»¥å£°æ˜ä¸€ä¸ªç±»å‹ä¸º<code>InjectionPoint</code>çš„å·¥å‚æ–¹æ³•å‚æ•°ï¼ˆæˆ–å…¶æ›´å…·ä½“çš„å­ç±»ï¼š<code>DependencyDescriptor</code>ï¼‰ä»¥è®¿é—®è§¦å‘åˆ›å»ºå½“å‰beançš„è¯·æ±‚æ³¨å…¥ç‚¹ã€‚ è¯·æ³¨æ„ï¼Œè¿™ä»…é€‚ç”¨äºçœŸå®åˆ›å»ºçš„beanå®ä¾‹ï¼Œè€Œä¸é€‚ç”¨äºæ³¨å…¥ç°æœ‰å®ä¾‹ã€‚å› æ­¤ï¼Œè¿™ä¸ªç‰¹æ€§å¯¹prototype scopeçš„beanæœ€æœ‰æ„ä¹‰ã€‚å¯¹äºå…¶ä»–ä½œç”¨åŸŸï¼Œå·¥å‚æ–¹æ³•å°†åªèƒ½çœ‹åˆ°è§¦å‘åœ¨ç»™å®šscopeä¸­åˆ›å»ºæ–°beanå®ä¾‹çš„æ³¨å…¥ç‚¹ã€‚ ä¾‹å¦‚ï¼Œè§¦å‘åˆ›å»ºä¸€ä¸ªå»¶è¿Ÿå•ä¾‹beançš„ä¾èµ–ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨æä¾›çš„æ³¨å…¥ç‚¹å…ƒæ•°æ®æ‹¥æœ‰ä¼˜é›…çš„è¯­ä¹‰ã€‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•ä½¿ç”¨<code>InjectionPoint</code>:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Componentpublic</span> class FactoryMethodComponent &#123;<br>    <span class="hljs-variable">@Bean</span> <span class="hljs-variable">@Scope</span>(<span class="hljs-string">&quot;prototype&quot;</span>)    public TestBean <span class="hljs-built_in">prototypeInstance</span>(InjectionPoint injectionPoint) &#123;        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">TestBean</span>(<span class="hljs-string">&quot;prototypeInstance for &quot;</span> + injectionPoint.<span class="hljs-built_in">getMember</span>());    &#125;&#125;<br></code></pre></td></tr></table></figure><p>åœ¨Springç»„ä»¶ä¸­å¤„ç†<code>@Bean</code>å’Œåœ¨code&gt;@Configurationä¸­å¤„ç†æ˜¯ä¸ä¸€æ ·çš„ï¼ŒåŒºåˆ«åœ¨äºï¼Œåœ¨<code>@Component</code>ä¸­ï¼Œä¸ä¼šä½¿ç”¨CGLIBå¢å¼ºå»æ‹¦æˆªæ–¹æ³•å’Œå±æ€§çš„è°ƒç”¨ã€‚åœ¨<code>@Configuration</code>æ³¨è§£çš„ç±»ä¸­ï¼Œ <code>@Bean</code>æ³¨è§£åˆ›å»ºçš„beanå¯¹è±¡ä¼šä½¿ç”¨CGLIBä»£ç†å¯¹æ–¹æ³•å’Œå±æ€§è¿›è¡Œè°ƒç”¨ã€‚æ–¹æ³•çš„è°ƒç”¨ä¸æ˜¯å¸¸è§„çš„Javaè¯­æ³•ï¼Œè€Œæ˜¯é€šè¿‡å®¹å™¨æ¥æä¾›é€šç”¨çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†å’Œä»£ç†Spring beanï¼Œ ç”šè‡³åœ¨é€šè¿‡ç¼–ç¨‹çš„æ–¹å¼è°ƒç”¨<code>@Bean</code>æ–¹æ³•æ—¶ä¹Ÿä¼šäº§ç”Ÿå¯¹å…¶å®ƒbeançš„å¼•ç”¨ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œåœ¨ä¸€ä¸ªç®€å•çš„<code>@Component</code>ç±»ä¸­è°ƒç”¨<code>@Bean</code>æ–¹æ³•ä¸­çš„æ–¹æ³•æˆ–å­—æ®µå…·æœ‰æ ‡å‡†Javaè¯­ä¹‰ï¼Œè¿™é‡Œæ²¡æœ‰ç”¨åˆ°ç‰¹æ®Šçš„CGLIBå¤„ç†æˆ–å…¶ä»–çº¦æŸã€‚</p><p>å¼€å‘è€…å¯ä»¥å°†<code>@Bean</code>æ–¹æ³•å£°æ˜ä¸º<code>static</code>çš„ï¼Œå¹¶å…è®¸åœ¨ä¸å°†å…¶åŒ…å«çš„é…ç½®ç±»ä½œä¸ºå®ä¾‹çš„æƒ…å†µä¸‹è°ƒç”¨å®ƒä»¬ã€‚è¿™åœ¨å®šä¹‰åç½®å¤„ç†å™¨beanæ—¶æ˜¯ç‰¹åˆ«æœ‰æ„ä¹‰çš„ã€‚ ä¾‹å¦‚<code>BeanFactoryPostProcessor</code> æˆ–<code>BeanPostProcessor</code>),ï¼Œå› ä¸ºè¿™ç±»beanä¼šåœ¨å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸå‰æœŸè¢«åˆå§‹åŒ–ï¼Œè€Œä¸ä¼šè§¦å‘å…¶å®ƒéƒ¨åˆ†çš„é…ç½®ã€‚</p><p>å¯¹é™æ€<code>@Bean</code>æ–¹æ³•çš„è°ƒç”¨æ°¸è¿œä¸ä¼šè¢«å®¹å™¨æ‹¦æˆªï¼Œå³ä½¿åœ¨<code>@Configuration</code>ç±»å†…éƒ¨ã€‚è¿™æ˜¯ç”¨ä¸ºCGLIBçš„å­ç±»ä»£ç†é™åˆ¶äº†åªä¼šé‡å†™éé™æ€æ–¹æ³•ã€‚å› æ­¤ï¼Œ å¯¹å¦ä¸€ä¸ª<code>@Bean</code>æ–¹æ³•çš„ç›´æ¥è°ƒç”¨åªèƒ½ä½¿ç”¨æ ‡å‡†çš„Javaè¯­æ³•ã€‚ä¹Ÿåªèƒ½ä»å·¥å‚æ–¹æ³•æœ¬èº«ç›´æ¥è¿”å›ä¸€ä¸ªç‹¬ç«‹çš„å®ä¾‹ã€‚</p><p>ç”±äºJavaè¯­è¨€çš„å¯è§æ€§ï¼Œ<code>@Bean</code>æ–¹æ³•å¹¶ä¸ä¸€å®šä¼šå¯¹å®¹å™¨ä¸­çš„beanæœ‰æ•ˆã€‚å¼€å‘è€…å¯èƒ½å¾ˆéšæ„çš„åœ¨é<code>@Configuration</code>ç±»ä¸­å®šä¹‰æˆ–å®šä¹‰ä¸ºé™æ€æ–¹æ³•ã€‚ç„¶è€Œï¼Œ åœ¨<code>@Configuration</code>ç±»ä¸­çš„æ­£å¸¸<code>@Bean</code>æ–¹æ³•éƒ½ä¼šè¢«é‡å†™ï¼Œå› æ­¤ï¼Œå®ƒä»¬ä¸åº”è¯¥å®šä¹‰ä¸º<code>private</code>æˆ–<code>final</code>ã€‚</p><p><code>@Bean</code>æ–¹æ³•ä¹Ÿå¯ä»¥ç”¨åœ¨çˆ¶ç±»ä¸­ï¼ŒåŒæ ·é€‚ç”¨äºJava 8æ¥å£ä¸­çš„é»˜è®¤æ–¹æ³•ã€‚è¿™ä½¿å¾—ç»„å»ºå¤æ‚çš„é…ç½®æ—¶èƒ½å…·æœ‰æ›´å¥½çš„çµæ´»æ€§ï¼Œç”šè‡³å¯èƒ½é€šè¿‡Java 8çš„é»˜è®¤æ–¹æ³•å®ç°å¤šé‡ç»§æ‰¿ã€‚ è¿™ç§ç‰¹æ€§åœ¨Spring 4.2å¼€å§‹æ”¯æŒã€‚</p><p>æœ€åï¼Œè¯·æ³¨æ„ï¼Œå•ä¸ªç±»å¯ä»¥ä¸ºåŒä¸€ä¸ªbeanä¿å­˜å¤šä¸ª<code>@Bean</code>æ–¹æ³•ï¼Œä¾‹å¦‚æ ¹æ®è¿è¡Œæ—¶å¯ç”¨çš„ä¾èµ–å…³ç³»é€‰æ‹©åˆé€‚çš„å·¥å‚æ–¹æ³•ã€‚ä½¿ç”¨ç®—æ³•ä¼šé€‰æ‹© â€œæœ€è´ªå©ªâ€œçš„æ„é€ æ–¹æ³•ï¼Œ ä¸€äº›åœºæ™¯å¯èƒ½ä¼šæŒ‰å¦‚ä¸‹æ–¹æ³•é€‰æ‹©ç›¸åº”çš„å·¥å‚æ–¹æ³•ï¼šæ»¡è¶³æœ€å¤šä¾èµ–çš„ä¼šè¢«é€‰æ‹©ï¼Œè¿™ä¸ä½¿ç”¨<code>@Autowired</code> æ—¶é€‰æ‹©å¤šä¸ªæ„é€ æ–¹æ³•æ—¶ç±»ä¼¼ã€‚</p><h4 id="1-10-6-å‘½åè‡ªåŠ¨æ³¨å†Œç»„ä»¶"><a href="#1-10-6-å‘½åè‡ªåŠ¨æ³¨å†Œç»„ä»¶" class="headerlink" title="1.10.6. å‘½åè‡ªåŠ¨æ³¨å†Œç»„ä»¶"></a>1.10.6. å‘½åè‡ªåŠ¨æ³¨å†Œç»„ä»¶</h4><p>æ‰«æå¤„ç†è¿‡ç¨‹ï¼Œå…¶ä¸­ä¸€æ­¥å°±æ˜¯è‡ªåŠ¨æ¢æµ‹ç»„ä»¶ï¼Œæ‰«æå™¨ä½¿ç”¨<code>BeanNameGenerator</code>å¯¹æ¢æµ‹åˆ°çš„ç»„ä»¶å‘½åã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå„ä»£ç å±‚æ³¨è§£(<code>@Component</code>, <code>@Repository</code>, <code>@Service</code>, å’Œ <code>@Controller</code>)æ‰€åŒ…å«çš„nameå€¼ï¼Œå°†ä¼šä½œä¸ºç›¸åº”çš„beanå®šä¹‰çš„åå­—ã€‚</p><p>å¦‚æœè¿™äº›æ³¨è§£æ²¡æœ‰nameå€¼ï¼Œæˆ–è€…æ˜¯å…¶ä»–ä¸€äº›è¢«æ¢æµ‹åˆ°çš„ç»„ä»¶ï¼ˆæ¯”å¦‚ä½¿ç”¨è‡ªå®šä¹‰è¿‡æ»¤å™¨æ¢æµ‹åˆ°çš„)ï¼Œé»˜è®¤ä¼šåˆbean nameç”Ÿæˆå™¨ç”Ÿæˆï¼Œä½¿ç”¨å°å†™ç±»åä½œä¸ºbeanåå­—ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœæ£€æµ‹åˆ°ä»¥ä¸‹ç»„ä»¶ç±»ï¼Œåˆ™åç§°ä¸º<code>myMovieLister</code>å’Œ<code>movieFinderImpl</code>:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@Service(<span class="hljs-string">&quot;myMovieLister&quot;</span>)</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleMovieLister</span> &#123;    <span class="hljs-comment">// ...&#125;</span><br><span class="hljs-meta">@Repositorypublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MovieFinderImpl</span> <span class="hljs-title">implements</span> <span class="hljs-title">MovieFinder</span> &#123;    <span class="hljs-comment">// ...&#125;</span><br></code></pre></td></tr></table></figure><p>å¦‚æœæ‚¨ä¸æƒ³ä¾èµ–é»˜è®¤çš„beanå‘½åç­–ç•¥ï¼Œåˆ™å¯ä»¥æä¾›è‡ªå®šä¹‰beanå‘½åç­–ç•¥ã€‚é¦–å…ˆï¼Œå®ç° <a href="https://docs.spring.io/spring-framework/docs/5.1.3.BUILD-SNAPSHOT/javadoc-api/org/springframework/beans/factory/support/BeanNameGenerator.html"><code>BeanNameGenerator</code></a>æ¥å£ï¼Œå¹¶ç¡®ä¿åŒ…æ‹¬ä¸€ä¸ªé»˜è®¤çš„æ— å‚æ„é€ å‡½æ•°ã€‚ ç„¶åï¼Œåœ¨é…ç½®æ‰«æç¨‹åºæ—¶æä¾›å®Œå…¨é™å®šçš„ç±»åï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ³¨è§£å’Œbeanå®šä¹‰æ‰€ç¤ºï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Configuration</span><span class="hljs-variable">@ComponentScan</span>(basePackages = <span class="hljs-string">&quot;org.example&quot;</span>, nameGenerator = MyNameGenerator.class)public class AppConfig &#123;    ...&#125;<br>&lt;beans&gt;    &lt;<span class="hljs-attribute">context</span>:component-scan base-package=<span class="hljs-string">&quot;org.example&quot;</span>        name-generator=<span class="hljs-string">&quot;org.example.MyNameGenerator&quot;</span> /&gt;&lt;/beans&gt;<br></code></pre></td></tr></table></figure><p>ä½œä¸ºä¸€èˆ¬è§„åˆ™ï¼Œè€ƒè™‘åœ¨å…¶ä»–ç»„ä»¶å¯èƒ½å¯¹å…¶è¿›è¡Œæ˜¾å¼å¼•ç”¨æ—¶ä½¿ç”¨æ³¨è§£æŒ‡å®šåç§°ã€‚ å¦ä¸€æ–¹é¢ï¼Œåªè¦å®¹å™¨è´Ÿè´£è£…é…æ—¶ï¼Œè‡ªåŠ¨ç”Ÿæˆçš„åç§°å°±è¶³å¤Ÿäº†ã€‚</p><h4 id="1-10-7-ä¸ºè‡ªåŠ¨æ£€æµ‹ç»„ä»¶æä¾›èŒƒå›´"><a href="#1-10-7-ä¸ºè‡ªåŠ¨æ£€æµ‹ç»„ä»¶æä¾›èŒƒå›´" class="headerlink" title="1.10.7.ä¸ºè‡ªåŠ¨æ£€æµ‹ç»„ä»¶æä¾›èŒƒå›´"></a>1.10.7.ä¸ºè‡ªåŠ¨æ£€æµ‹ç»„ä»¶æä¾›èŒƒå›´</h4><p>ä¸ä¸€èˆ¬çš„Springç®¡ç†ç»„ä»¶ä¸€æ ·ï¼Œè‡ªåŠ¨æ£€æµ‹ç»„ä»¶çš„é»˜è®¤å’Œæœ€å¸¸è§çš„ä½œç”¨åŸŸæ˜¯<code>singleton</code>ã€‚ä½†æ˜¯ï¼Œæœ‰æ—¶æ‚¨éœ€è¦ä¸€ä¸ªå¯ç”±<code>@Scope</code>æ³¨è§£æŒ‡å®šçš„ä¸åŒä½œç”¨åŸŸã€‚ æ‚¨å¯ä»¥åœ¨æ³¨è§£ä¸­æä¾›ä½œç”¨åŸŸçš„åç§°ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Scope</span>(<span class="hljs-string">&quot;prototype&quot;</span>)<br><br><span class="hljs-variable">@Repository</span><br><br>public class MovieFinderImpl implements MovieFinder &#123;<br><br>    <span class="hljs-comment">// ...</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p><code>@Scope</code>æ³¨è§£ä»…åœ¨å…·ä½“beanç±»ï¼ˆç”¨äºå¸¦æ³¨è§£çš„ç»„ä»¶ï¼‰æˆ–å·¥å‚æ–¹æ³•ï¼ˆç”¨äº<code>@Bean</code>æ–¹æ³•ï¼‰ä¸Šè¿›è¡Œå…³è”ã€‚ ä¸XML beanå®šä¹‰ç›¸æ¯”ï¼Œæ²¡æœ‰beanç»§æ‰¿çš„æ¦‚å¿µï¼Œå¹¶ä¸” ç±»çº§åˆ«çš„ç»§æ‰¿ç»“æ„ä¸å…ƒæ•°æ®æ— å…³ã€‚</p><p>æœ‰å…³ç‰¹å®šäºWebçš„èŒƒå›´ï¼ˆå¦‚Springä¸Šä¸‹æ–‡ä¸­çš„â€œrequestâ€ or â€œsessionâ€ï¼‰çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-scopes-other">è¯·æ±‚ï¼Œä¼šè¯ï¼Œåº”ç”¨ç¨‹åºå’ŒWebSocketä½œç”¨åŸŸ</a>ã€‚ è¿™äº›ä½œç”¨åŸŸä¸æ„å»ºæ³¨è§£ä¸€æ ·ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨Springçš„å…ƒæ³¨è§£æ–¹æ³•ç¼–å†™è‡ªå·±çš„ä½œç”¨åŸŸæ³¨è§£ï¼šä¾‹å¦‚ï¼Œä½¿ç”¨<code>@Scope(&quot;prototype&quot;)</code>è¿›è¡Œå…ƒæ³¨è§£çš„è‡ªå®šä¹‰æ³¨è§£ï¼Œå¯èƒ½è¿˜ä¼šå£°æ˜è‡ªå®šä¹‰ä½œç”¨åŸŸä»£ç†æ¨¡å¼ã€‚</p><p>æƒ³è¦æä¾›è‡ªå®šä¹‰ä½œç”¨åŸŸçš„è§£æç­–ç•¥ï¼Œè€Œä¸æ˜¯ä¾èµ–äºåŸºäºæ³¨è§£çš„æ–¹æ³•ï¼Œé‚£ä¹ˆéœ€è¦å®ç°<a href="https://docs.spring.io/spring-framework/docs/5.1.3.BUILD-SNAPSHOT/javadoc-api/org/springframework/context/annotation/ScopeMetadataResolver.html"><code>ScopeMetadataResolver</code></a>æ¥å£ï¼Œå¹¶ç¡®ä¿åŒ…å«ä¸€ä¸ªé»˜è®¤çš„æ— å‚æ•°æ„é€ å‡½æ•°ã€‚ ç„¶åï¼Œåœ¨é…ç½®æ‰«æç¨‹åºæ—¶æä¾›å®Œå…¨é™å®šç±»åã€‚ä»¥ä¸‹æ³¨è§£å’Œbeanå®šä¹‰ç¤ºä¾‹æ˜¾ç¤ºï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Configuration</span><span class="hljs-variable">@ComponentScan</span>(basePackages = <span class="hljs-string">&quot;org.example&quot;</span>, scopeResolver = MyScopeResolver.class)public class AppConfig &#123;    ...&#125;<br>&lt;beans&gt;    &lt;<span class="hljs-attribute">context</span>:component-scan base-package=<span class="hljs-string">&quot;org.example&quot;</span> scope-resolver=<span class="hljs-string">&quot;org.example.MyScopeResolver&quot;</span>/&gt;&lt;/beans&gt;<br></code></pre></td></tr></table></figure><p>å½“ä½¿ç”¨æŸä¸ªéå•ä¾‹ä½œç”¨åŸŸæ—¶ï¼Œä¸ºä½œç”¨åŸŸå¯¹è±¡ç”Ÿæˆä»£ç†å¯èƒ½éå¸¸å¿…è¦ï¼ŒåŸå› å‚çœ‹ <a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-scopes-other-injection">ä½œä¸ºä¾èµ–å…³ç³»çš„ä½œç”¨åŸŸbean</a>ã€‚ ä¸ºæ­¤ï¼Œç»„ä»¶æ‰«æå…ƒç´ ä¸Šæä¾›äº†scoped-proxyå±æ€§ã€‚ ä¸‰ä¸ªå¯èƒ½çš„å€¼æ˜¯ï¼š<code>no</code>, <code>interfaces</code>, å’Œ <code>targetClass</code>ã€‚ ä¾‹å¦‚ï¼Œä»¥ä¸‹é…ç½®å¯¼è‡´æ ‡å‡†JDKåŠ¨æ€ä»£ç†ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Configuration</span><span class="hljs-variable">@ComponentScan</span>(basePackages = <span class="hljs-string">&quot;org.example&quot;</span>, scopedProxy = ScopedProxyMode.INTERFACES)public class AppConfig &#123;    ...&#125;<br>&lt;beans&gt;    &lt;<span class="hljs-attribute">context</span>:component-scan base-package=<span class="hljs-string">&quot;org.example&quot;</span> scoped-proxy=<span class="hljs-string">&quot;interfaces&quot;</span>/&gt;&lt;/beans&gt;<br></code></pre></td></tr></table></figure><h4 id="1-10-8-ä¸ºæ³¨è§£æä¾›Qualifierå…ƒæ•°æ®"><a href="#1-10-8-ä¸ºæ³¨è§£æä¾›Qualifierå…ƒæ•°æ®" class="headerlink" title="1.10.8. ä¸ºæ³¨è§£æä¾›Qualifierå…ƒæ•°æ®"></a>1.10.8. ä¸ºæ³¨è§£æä¾›Qualifierå…ƒæ•°æ®</h4><p>åœ¨å‰é¢<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-autowired-annotation-qualifiers">ä½¿ç”¨qualifierså¾®è°ƒåŸºäºæ³¨è§£è‡ªåŠ¨è£…é…</a>è®¨è®ºè¿‡<code>@Qualifier</code> æ³¨è§£ã€‚è¯¥éƒ¨åˆ†ä¸­çš„ç¤ºä¾‹æ¼”ç¤ºäº†åœ¨è§£æè‡ªåŠ¨æ³¨å…¥å€™é€‰è€…æ—¶ä½¿ç”¨ <code>@Qualifier</code>æ³¨è§£å’Œè‡ªå®šä¹‰é™å®šç¬¦æ³¨è§£ä»¥æä¾›ç»†ç²’åº¦æ§åˆ¶ã€‚ å› ä¸ºè¿™äº›ç¤ºä¾‹åŸºäºXML beanå®šä¹‰ï¼Œæ‰€ä»¥ä½¿ç”¨XMLä¸­çš„<code>bean</code>å…ƒç´ çš„ <code>qualifier</code> æˆ– <code>meta</code>å­å…ƒç´ åœ¨å€™é€‰beanå®šä¹‰ä¸Šæä¾›äº†é™å®šç¬¦å…ƒæ•°æ®ã€‚å½“ä¾é ç±»è·¯å¾„æ‰«æå¹¶è‡ªåŠ¨æ£€æµ‹ç»„ä»¶æ—¶ï¼Œ å¯ä»¥åœ¨å€™é€‰ç±»ä¸Šæä¾›å…·æœ‰ç±»å‹çº§åˆ«æ³¨è§£çš„é™å®šç¬¦å…ƒæ•°æ®ã€‚ä»¥ä¸‹ä¸‰ä¸ªç¤ºä¾‹æ¼”ç¤ºäº†æ­¤æŠ€æœ¯ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Component</span><span class="hljs-variable">@Qualifier</span>(<span class="hljs-string">&quot;Action&quot;</span>)public class ActionMovieCatalog implements MovieCatalog &#123;    <span class="hljs-comment">// ...&#125;</span><br><span class="hljs-variable">@Component</span><span class="hljs-variable">@Genre</span>(<span class="hljs-string">&quot;Action&quot;</span>)public class ActionMovieCatalog implements MovieCatalog &#123;    <span class="hljs-comment">// ...&#125;</span><br><span class="hljs-variable">@Component</span><span class="hljs-variable">@Offlinepublic</span> class CachingMovieCatalog implements MovieCatalog &#123;    <span class="hljs-comment">// ...&#125;</span><br></code></pre></td></tr></table></figure><p>ä¸å¤§å¤šæ•°åŸºäºæ³¨è§£çš„æ›¿ä»£æ–¹æ³•ä¸€æ ·ï¼Œæ³¨è§£å…ƒæ•°æ®ç»‘å®šåˆ°ç±»å®šä¹‰æœ¬èº«ï¼Œè€Œä½¿ç”¨åœ¨XMLé…ç½®æ—¶ï¼Œå…è®¸åŒä¸€ç±»å‹çš„beansåœ¨qualifierå…ƒæ•°æ®ä¸­æä¾›å˜é‡ï¼Œ å› ä¸ºå…ƒæ•°æ®æ˜¯ä¾æ®å®ä¾‹è€Œä¸æ˜¯ç±»æ¥æä¾›çš„ã€‚</p><h4 id="1-10-9-ç”Ÿæˆå€™é€‰ç»„ä»¶çš„ç´¢å¼•"><a href="#1-10-9-ç”Ÿæˆå€™é€‰ç»„ä»¶çš„ç´¢å¼•" class="headerlink" title="1.10.9. ç”Ÿæˆå€™é€‰ç»„ä»¶çš„ç´¢å¼•"></a>1.10.9. ç”Ÿæˆå€™é€‰ç»„ä»¶çš„ç´¢å¼•</h4><p>è™½ç„¶ç±»è·¯å¾„æ‰«æéå¸¸å¿«ï¼Œä½†é€šè¿‡åœ¨ç¼–è¯‘æ—¶åˆ›å»ºå€™é€‰çš„é™æ€åˆ—è¡¨ã€‚å¯ä»¥æé«˜å¤§å‹åº”ç”¨ç¨‹åºçš„å¯åŠ¨æ€§èƒ½ã€‚åœ¨æ­¤æ¨¡å¼ä¸‹ï¼Œåº”ç”¨ç¨‹åºçš„æ‰€æœ‰æ¨¡å—éƒ½å¿…é¡»ä½¿ç”¨æ­¤æœºåˆ¶ï¼Œ å½“ <code>ApplicationContext</code>æ£€æµ‹åˆ°æ­¤ç±»ç´¢å¼•æ—¶ï¼Œå®ƒå°†è‡ªåŠ¨ä½¿ç”¨å®ƒï¼Œè€Œä¸æ˜¯æ‰«æç±»è·¯å¾„ã€‚</p><p>è‹¥è¦ç”Ÿæˆç´¢å¼•ï¼Œ åªéœ€å‘åŒ…å«ç»„ä»¶æ‰«ææŒ‡ä»¤ç›®æ ‡ç»„ä»¶çš„æ¯ä¸ªæ¨¡å—æ·»åŠ ä¸€ä¸ªé™„åŠ ä¾èµ–é¡¹ã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•ä½¿ç”¨Mavenæ‰§è¡Œæ­¤æ“ä½œï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-context-indexer<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.3.BUILD-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•ä½¿ç”¨Gradleæ‰§è¡Œæ­¤æ“ä½œ:</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-variable">dependencies</span> &#123;<br><br>    <span class="hljs-function"><span class="hljs-title">compileOnly</span>(<span class="hljs-string">&quot;org.springframework:spring-context-indexer:5.1.3.BUILD-SNAPSHOT&quot;</span>)</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªè¿‡ç¨‹å°†äº§ç”Ÿä¸€ä¸ªåä¸º<code>META-INF/spring.components</code>çš„æ–‡ä»¶ï¼Œå¹¶å°†åŒ…å«åœ¨jaråŒ…ä¸­ã€‚</p><p>åœ¨IDEä¸­ä½¿ç”¨æ­¤æ¨¡å¼æ—¶ï¼Œå¿…é¡»å°†<code>spring-context-indexer</code>æ³¨å†Œä¸ºæ³¨è§£å¤„ç†å™¨ï¼Œ ä»¥ç¡®ä¿æ›´æ–°å€™é€‰ç»„ä»¶æ—¶ç´¢å¼•æ˜¯æœ€æ–°çš„ã€‚</p><p>å¦‚æœåœ¨ç±»è·¯å¾„ä¸­æ‰¾åˆ° <code>META-INF/spring.components</code> æ—¶ï¼Œå°†è‡ªåŠ¨å¯ç”¨ç´¢å¼•ã€‚å¦‚æœæŸä¸ªç´¢å¼•å¯¹äºæŸäº›åº“(æˆ–ç”¨ä¾‹)æ˜¯ä¸å¯ç”¨çš„ï¼Œ ä½†ä¸èƒ½ä¸ºæ•´ä¸ªåº”ç”¨ç¨‹åºæ„å»ºï¼Œåˆ™å¯ä»¥å°†<code>spring.index.ignore</code>è®¾ç½®ä¸º<code>true</code>ï¼Œä»è€Œå°†å…¶å›é€€åˆ°å¸¸è§„ç±»è·¯å¾„çš„æ’åˆ—(å³æ ¹æœ¬ä¸å­˜åœ¨ç´¢å¼•)ï¼Œ æˆ–è€…ä½œä¸ºç³»ç»Ÿå±æ€§æˆ–åœ¨<code>spring.properties</code>æ–‡ä»¶ä½äºç±»è·¯å¾„çš„æ ¹ç›®å½•ä¸­ã€‚</p><h3 id="1-11-ä½¿ç”¨JSR-330æ ‡å‡†æ³¨è§£"><a href="#1-11-ä½¿ç”¨JSR-330æ ‡å‡†æ³¨è§£" class="headerlink" title="1.11. ä½¿ç”¨JSR 330æ ‡å‡†æ³¨è§£"></a>1.11. ä½¿ç”¨JSR 330æ ‡å‡†æ³¨è§£</h3><p>ä»Spring 3.0å¼€å§‹ï¼ŒSpringæä¾›å¯¹JSR-330æ ‡å‡†æ³¨è§£ï¼ˆä¾èµ–æ³¨å…¥ï¼‰çš„æ”¯æŒã€‚ è¿™äº›æ³¨è§£çš„æ‰«ææ–¹å¼ä¸Springæ³¨è§£ç›¸åŒã€‚ è¦ä½¿ç”¨å®ƒä»¬ï¼Œæ‚¨éœ€è¦åœ¨ç±»è·¯å¾„ä¸­åŒ…å«ç›¸å…³çš„jarã€‚</p><p>å¦‚æœä½¿ç”¨Mavenå·¥å…·ï¼Œé‚£ä¹ˆ<code>@javax.inject.Inject</code>å¯ä»¥åœ¨Mavenä¸­å¤®ä»“åº“ä¸­æ‰¾åˆ°( <a href="https://repo1.maven.org/maven2/javax/inject/javax.inject/1/">http://repo1.maven.org/maven2/javax/inject/javax.inject/1/</a>). æ‚¨å¯ä»¥å°†ä»¥ä¸‹ä¾èµ–é¡¹æ·»åŠ åˆ°æ–‡ä»¶pom.xmlï¼š:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.inject<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>javax.inject<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="1-11-1-ä½¿ç”¨-Inject-å’Œ-Namedæ³¨è§£å®ç°ä¾èµ–æ³¨å…¥"><a href="#1-11-1-ä½¿ç”¨-Inject-å’Œ-Namedæ³¨è§£å®ç°ä¾èµ–æ³¨å…¥" class="headerlink" title="1.11.1. ä½¿ç”¨@Inject å’Œ @Namedæ³¨è§£å®ç°ä¾èµ–æ³¨å…¥"></a>1.11.1. ä½¿ç”¨<code>@Inject</code> å’Œ <code>@Named</code>æ³¨è§£å®ç°ä¾èµ–æ³¨å…¥</h4><p><code>@javax.inject.Inject</code>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹çš„æ–¹å¼æ¥æ›¿ä»£<code>@Autowired</code>æ³¨è§£:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> javax.<span class="hljs-property">inject</span>.<span class="hljs-property">Inject</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleMovieLister</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">MovieFinder</span> movieFinder;<br>    <span class="hljs-meta">@Inject</span>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setMovieFinder</span>(<span class="hljs-params">MovieFinder movieFinder</span>) &#123;        <span class="hljs-variable language_">this</span>.<span class="hljs-property">movieFinder</span> = movieFinder;    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">listMovies</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-variable language_">this</span>.<span class="hljs-property">movieFinder</span>.<span class="hljs-title function_">findMovies</span>(...);        ...    &#125;&#125;<br></code></pre></td></tr></table></figure><p>ä¸ <code>@Autowired</code>ä¸€æ ·ï¼Œæ‚¨å¯ä»¥åœ¨å­—æ®µï¼Œæ–¹æ³•å’Œæ„é€ å‡½æ•°å‚æ•°çº§åˆ«ä½¿ç”¨<code>@Inject</code>æ³¨è§£ã€‚æ­¤å¤–ï¼Œè¿˜å¯ä»¥å°†æ³¨å…¥ç‚¹å£°æ˜ä¸º<code>Provider</code>ã€‚ å®ƒå…è®¸æŒ‰éœ€è®¿é—®ä½œç”¨åŸŸè¾ƒå°çš„beanæˆ–é€šè¿‡<code>Provider.get()</code>è°ƒç”¨å¯¹å…¶ä»–beanè¿›è¡Œå»¶è¿Ÿè®¿é—®ã€‚ä»¥ä¸‹ç¤ºä¾‹æä¾›äº†å‰é¢ç¤ºä¾‹çš„å˜ä½“ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> javax.<span class="hljs-property">inject</span>.<span class="hljs-property">Inject</span>;<span class="hljs-keyword">import</span> javax.<span class="hljs-property">inject</span>.<span class="hljs-property">Provider</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleMovieLister</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Provider</span>&lt;<span class="hljs-title class_">MovieFinder</span>&gt; movieFinder;<br>    <span class="hljs-meta">@Inject</span>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setMovieFinder</span>(<span class="hljs-params">Provider&lt;MovieFinder&gt; movieFinder</span>) &#123;        <span class="hljs-variable language_">this</span>.<span class="hljs-property">movieFinder</span> = movieFinder;    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">listMovies</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-variable language_">this</span>.<span class="hljs-property">movieFinder</span>.<span class="hljs-title function_">get</span>().<span class="hljs-title function_">findMovies</span>(...);        ...    &#125;&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœæƒ³è¦ä¸ºæ³¨å…¥çš„ä¾èµ–é¡¹ä½¿ç”¨é™å®šåç§°ï¼Œåˆ™åº”è¯¥ä½¿ç”¨<code>@Named</code>æ³¨è§£ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> javax.<span class="hljs-property">inject</span>.<span class="hljs-property">Inject</span>;<span class="hljs-keyword">import</span> javax.<span class="hljs-property">inject</span>.<span class="hljs-property">Named</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleMovieLister</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">MovieFinder</span> movieFinder;<br>    <span class="hljs-meta">@Inject</span>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setMovieFinder</span>(<span class="hljs-params"><span class="hljs-meta">@Named</span>(<span class="hljs-string">&quot;main&quot;</span>) MovieFinder movieFinder</span>) &#123;        <span class="hljs-variable language_">this</span>.<span class="hljs-property">movieFinder</span> = movieFinder;    &#125;<br>    <span class="hljs-comment">// ...&#125;</span><br></code></pre></td></tr></table></figure><p>ä¸<code>@Autowired</code>ä¸€æ ·ï¼Œ<code>@Inject</code> ä¹Ÿå¯ä»¥ä¸<code>java.util.Optional</code>æˆ–<code>@Nullable</code>ä¸€èµ·ä½¿ç”¨ã€‚ è¿™åœ¨è¿™é‡Œç”¨æ›´é€‚ç”¨ï¼Œå› ä¸º<code>@Inject</code>æ²¡æœ‰<code>required</code>çš„å±æ€§ã€‚ ä»¥ä¸‹ä¸€å¯¹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•ä½¿ç”¨<code>@Inject</code>å’Œ<code>@Nullable</code>:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">SimpleMovieLister</span> &#123;<br>    <span class="hljs-variable">@Inject</span>    public void <span class="hljs-built_in">setMovieFinder</span>(Optional&lt;MovieFinder&gt; movieFinder) &#123;        ...    &#125;&#125;<br><span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">SimpleMovieLister</span> &#123;<br>    <span class="hljs-variable">@Inject</span>    public void <span class="hljs-built_in">setMovieFinder</span>(<span class="hljs-variable">@Nullable</span> MovieFinder movieFinder) &#123;        ...    &#125;&#125;<br></code></pre></td></tr></table></figure><h4 id="1-11-2-Named-å’Œ-ManagedBeanæ³¨è§£-æ ‡å‡†ä¸-Component-æ³¨è§£ç›¸åŒ"><a href="#1-11-2-Named-å’Œ-ManagedBeanæ³¨è§£-æ ‡å‡†ä¸-Component-æ³¨è§£ç›¸åŒ" class="headerlink" title="1.11.2. @Named å’Œ @ManagedBeanæ³¨è§£: æ ‡å‡†ä¸ @Component æ³¨è§£ç›¸åŒ"></a>1.11.2. <code>@Named</code> å’Œ <code>@ManagedBean</code>æ³¨è§£: æ ‡å‡†ä¸ <code>@Component</code> æ³¨è§£ç›¸åŒ</h4><p><code>@javax.inject.Named</code> æˆ– <code>javax.annotation.ManagedBean</code>å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼æ¥æ›¿ä»£<code>@Component</code>æ³¨è§£ï¼š</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">import</span> javax.<span class="hljs-keyword">inject</span>.<span class="hljs-keyword">Inject</span>;<span class="hljs-keyword">import</span> javax.<span class="hljs-keyword">inject</span>.Named;<br>@Named(<span class="hljs-string">&quot;movieListener&quot;</span>)  <span class="hljs-comment">// @ManagedBean(&quot;movieListener&quot;) could be used as wellpublic class SimpleMovieLister &#123;</span><br>    <span class="hljs-keyword">private</span> MovieFinder movieFinder;<br>    @<span class="hljs-keyword">Inject</span>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> setMovieFinder(MovieFinder movieFinder) &#123;        <span class="hljs-keyword">this</span>.movieFinder = movieFinder;    &#125;<br>    <span class="hljs-comment">// ...&#125;</span><br></code></pre></td></tr></table></figure><p>åœ¨ä¸æŒ‡å®šç»„ä»¶åç§°çš„æƒ…å†µä¸‹ä½¿ç”¨<code>@Component</code>æ˜¯å¾ˆå¸¸è§çš„ã€‚ <code>@Named</code>å¯ä»¥ä»¥ç±»ä¼¼çš„æ–¹å¼ä½¿ç”¨ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">import</span> javax.<span class="hljs-keyword">inject</span>.<span class="hljs-keyword">Inject</span>;<span class="hljs-keyword">import</span> javax.<span class="hljs-keyword">inject</span>.Named;<br>@Namedpublic <span class="hljs-keyword">class</span> SimpleMovieLister &#123;<br>    <span class="hljs-keyword">private</span> MovieFinder movieFinder;<br>    @<span class="hljs-keyword">Inject</span>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> setMovieFinder(MovieFinder movieFinder) &#123;        <span class="hljs-keyword">this</span>.movieFinder = movieFinder;    &#125;<br>    <span class="hljs-comment">// ...&#125;</span><br></code></pre></td></tr></table></figure><p>å½“ä½¿ç”¨<code>@Named</code> æˆ– <code>@ManagedBean</code>æ—¶ï¼Œå¯ä»¥ä¸Springæ³¨è§£å®Œå…¨ç›¸åŒçš„æ–¹å¼ä½¿ç”¨component-scanningç»„ä»¶æ‰«æã€‚ å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤º:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Configuration</span><br><br><span class="hljs-variable">@ComponentScan</span>(basePackages = <span class="hljs-string">&quot;org.example&quot;</span>)<br><br>public class AppConfig  &#123;<br><br>    ...<br><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸<code>@Component</code>ç›¸åï¼ŒJSR-330 <code>@Named</code> å’Œ JSR-250 <code>ManagedBean</code>æ³¨è§£ä¸å¯ç»„åˆã€‚ è¯·ä½¿ç”¨Springçš„åŸå‹æ¨¡å‹ï¼ˆstereotype mode)æ¥æ„å»ºè‡ªå®šä¹‰ç»„ä»¶æ³¨è§£ã€‚</p><h4 id="1-11-3-ä½¿ç”¨-JSR-330æ ‡å‡†æ³¨è§£çš„é™åˆ¶"><a href="#1-11-3-ä½¿ç”¨-JSR-330æ ‡å‡†æ³¨è§£çš„é™åˆ¶" class="headerlink" title="1.11.3. ä½¿ç”¨ JSR-330æ ‡å‡†æ³¨è§£çš„é™åˆ¶"></a>1.11.3. ä½¿ç”¨ JSR-330æ ‡å‡†æ³¨è§£çš„é™åˆ¶</h4><p>ä½¿ç”¨æ ‡å‡†æ³¨è§£æ—¶ï¼Œéœ€è¦çŸ¥é“å“ªäº›é‡è¦åŠŸèƒ½æ˜¯ä¸å¯ç”¨çš„ã€‚å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p><p>Table 6. Springçš„ç»„ä»¶æ¨¡å‹å…ƒç´  vs JSR-330 å˜é‡</p><table><thead><tr><th>Spring</th><th>javax.inject.*</th><th>javax.inject restrictions &#x2F; comments</th></tr></thead><tbody><tr><td>@Autowired</td><td>@Inject</td><td><code>@Inject</code> æ²¡æœ‰â€™requiredâ€™å±æ€§ã€‚ å¯ä»¥ä¸Java 8çš„ <code>Optional</code>ä¸€èµ·ä½¿ç”¨ã€‚</td></tr><tr><td>@Component</td><td>@Named &#x2F; @ManagedBean</td><td>JSR-330ä¸æä¾›å¯ç»„åˆæ¨¡å‹ï¼Œåªæ˜¯ä¸€ç§è¯†åˆ«å‘½åç»„ä»¶çš„æ–¹æ³•ã€‚</td></tr><tr><td>@Scope(â€œsingletonâ€)</td><td>@Singleton</td><td>JSR-330çš„é»˜è®¤ä½œç”¨åŸŸå°±åƒSpringçš„<code>prototype</code>ã€‚ ä½†æ˜¯ï¼Œä¸ºäº†ä½¿å…¶ä¸Springçš„ä¸€èˆ¬é»˜è®¤å€¼ä¿æŒä¸€è‡´ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒSpringå®¹å™¨ä¸­å£°æ˜çš„JSR-330 beanæ˜¯ä¸€ä¸ª <code>singleton</code>ã€‚ ä¸ºäº†ä½¿ç”¨é™¤ <code>singleton</code>ä¹‹å¤–çš„èŒƒå›´ï¼Œæ‚¨åº”è¯¥ä½¿ç”¨Springçš„<code>@Scope</code>æ³¨è§£ã€‚ <code>javax.inject</code>è¿˜æä¾›äº†<a href="https://download.oracle.com/javaee/6/api/javax/inject/Scope.html">@Scope</a>æ³¨è§£ã€‚ ç„¶è€Œï¼Œè¿™ä¸ªä»…ç”¨äºåˆ›å»ºè‡ªå·±çš„æ³¨è§£ã€‚</td></tr><tr><td>@Qualifier</td><td>@Qualifier &#x2F; @Named</td><td><code>javax.inject.Qualifier</code> åªæ˜¯ç”¨äºæ„å»ºè‡ªå®šä¹‰é™å®šç¬¦çš„å…ƒæ³¨è§£ã€‚ å¯ä»¥é€šè¿‡<code>javax.inject.Named</code>åˆ›å»ºä¸Springä¸­<code>@Qualifier</code>ä¸€æ ·çš„é™å®šç¬¦ã€‚</td></tr><tr><td>@Value</td><td>-</td><td>æ— </td></tr><tr><td>@Required</td><td>-</td><td>æ— </td></tr><tr><td>@Lazy</td><td>-</td><td>æ— </td></tr><tr><td>ObjectFactory</td><td>Provider</td><td><code>javax.inject.Provider</code> avax.inject.Provideræ˜¯Springçš„<code>ObjectFactory</code>çš„ç›´æ¥æ›¿ä»£å“ï¼Œ ä»…ä»…ä½¿ç”¨ç®€çŸ­çš„<code>get()</code>æ–¹æ³•å³å¯ã€‚ å®ƒä¹Ÿå¯ä»¥ä¸Springçš„<code>@Autowired</code>ç»“åˆä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ä¸éæ³¨è§£çš„æ„é€ å‡½æ•°å’Œsetteræ–¹æ³•ç»“åˆä½¿ç”¨ã€‚</td></tr></tbody></table><h3 id="1-12-åŸºäºJavaçš„å®¹å™¨é…ç½®"><a href="#1-12-åŸºäºJavaçš„å®¹å™¨é…ç½®" class="headerlink" title="1.12. åŸºäºJavaçš„å®¹å™¨é…ç½®"></a>1.12. åŸºäºJavaçš„å®¹å™¨é…ç½®</h3><p>æœ¬èŠ‚ä»‹ç»å¦‚ä½•åœ¨Javaä»£ç ä¸­ä½¿ç”¨æ³¨è§£æ¥é…ç½®Springå®¹å™¨ã€‚ å®ƒåŒ…æ‹¬ä»¥ä¸‹ä¸»é¢˜ï¼š:</p><ul><li><a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-java-basic-concepts">åŸºæœ¬æ¦‚å¿µ: <code>@Bean</code> å’Œ <code>@Configuration</code></a></li><li><a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-java-instantiating-container">ä½¿ç”¨<code>AnnotationConfigApplicationContext</code>å®ä¾‹åŒ–Springå®¹å™¨</a></li><li><a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-java-bean-annotation">ä½¿ç”¨<code>@Bean</code>æ³¨è§£</a></li><li><a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-java-configuration-annotation">ä½¿ç”¨<code>@Configuration</code>æ³¨è§£</a></li><li><a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-java-composing-configuration-classes">ç¼–å†™åŸºäºJavaçš„é…ç½®</a></li><li><a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-definition-profiles">å®šä¹‰Beané…ç½®æ–‡ä»¶</a></li><li><a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-property-source-abstraction"><code>PropertySource</code> æŠ½è±¡</a></li><li><a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-using-propertysource">ä½¿ç”¨ <code>@PropertySource</code></a></li><li><a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-placeholder-resolution-in-statements">å£°æ˜ä¸­çš„å ä½ç¬¦</a></li></ul><h4 id="1-12-1-åŸºæœ¬æ¦‚å¿µ-Bean-å’Œ-Configuration"><a href="#1-12-1-åŸºæœ¬æ¦‚å¿µ-Bean-å’Œ-Configuration" class="headerlink" title="1.12.1. åŸºæœ¬æ¦‚å¿µ: @Bean å’Œ @Configuration"></a>1.12.1. åŸºæœ¬æ¦‚å¿µ: <code>@Bean</code> å’Œ <code>@Configuration</code></h4><p>Springæ–°çš„åŸºäºJavaé…ç½®çš„æ ¸å¿ƒå†…å®¹æ˜¯<code>@Configuration</code>æ³¨è§£çš„ç±»å’Œ<code>@Bean</code>æ³¨è§£çš„æ–¹æ³•ã€‚</p><p><code>@Bean</code>æ³¨è§£ç”¨äºè¡¨æ˜æ–¹æ³•çš„å®ä¾‹åŒ–ï¼Œã€é…ç½®å’Œåˆå§‹åŒ–éƒ½æ˜¯ç”±Spring IoCå®¹å™¨ç®¡ç†çš„æ–°å¯¹è±¡ï¼Œå¯¹äºé‚£äº›ç†Ÿæ‚‰Springçš„<code>&lt;beans/&gt;</code>XMLé…ç½®çš„äººæ¥è¯´ï¼Œ <code>@Bean</code>æ³¨è§£æ‰®æ¼”çš„è§’è‰²ä¸<code>&lt;bean /&gt;</code>å…ƒç´ ç›¸åŒã€‚å¼€å‘è€…å¯ä»¥åœ¨ä»»æ„çš„Spring <code>@Component</code>ä¸­ä½¿ç”¨<code>@Bean</code>æ³¨è§£æ–¹æ³• ï¼Œä½†å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œ<code>@Bean</code>æ˜¯é…åˆ<code>@Configuration</code>ä½¿ç”¨çš„ã€‚</p><p>ä½¿ç”¨<code>@Configuration</code>æ³¨è§£ç±»æ—¶ï¼Œè¿™ä¸ªç±»çš„ç›®çš„å°±æ˜¯ä½œä¸ºbeanå®šä¹‰çš„åœ°æ–¹ã€‚æ­¤å¤–ï¼Œ<code>@Configuration</code>ç±»å…è®¸é€šè¿‡è°ƒç”¨åŒä¸€ä¸ªç±»ä¸­çš„å…¶ä»–<code>@Bean</code>æ–¹æ³•æ¥å®šä¹‰beané—´ä¾èµ–å…³ç³»ã€‚ æœ€ç®€å•çš„<code>@Configuration</code>ç±»å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Configurationpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> &#123;<br>    <span class="hljs-meta">@Bean</span>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">MyService</span> <span class="hljs-title function_">myService</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyServiceImpl</span>();    &#125;&#125;<br></code></pre></td></tr></table></figure><p>å‰é¢çš„<code>AppConfig</code>ç±»ç­‰æ•ˆäºä»¥ä¸‹Spring <code>&lt;beans/&gt;</code>XMLï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;myService&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.acme.services.MyServiceImpl&quot;</span>/&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å®Œæ•´çš„@Configurationæ¨¡å¼å¯¹æ¯”â€œliteâ€æ¨¡å¼çš„@Bean?</p><p>å½“<code>@Bean</code>æ–¹æ³•åœ¨æ²¡æœ‰ç”¨ <code>@Configuration</code>æ³¨è§£çš„ç±»ä¸­å£°æ˜æ—¶ï¼Œå®ƒä»¬å°†ä¼šè¢«ç§°ä¸ºâ€œliteâ€çš„æ¨¡å¼å¤„ç†ã€‚ä¾‹å¦‚ï¼Œ<code>@Component</code>ä¸­å£°æ˜çš„beanæ–¹æ³•æˆ–è€…ä¸€ä¸ªæ™®é€šçš„æ—§ç±»ä¸­çš„beanæ–¹æ³•å°†è¢«è§†ä¸º â€œliteâ€çš„ã€‚åŒ…å«ç±»çš„ä¸»è¦ç›®çš„ä¸åŒï¼Œè€Œ<code>@Bean</code>æ–¹æ³•åœ¨è¿™é‡Œæ˜¯ä¸€ç§é¢å¤–çš„å¥½å¤„ã€‚ã€‚ä¾‹å¦‚ï¼ŒæœåŠ¡ç»„ä»¶å¯ä»¥é€šè¿‡åœ¨æ¯ä¸ªé€‚ç”¨çš„ç»„ä»¶ç±»ä¸Šä½¿ç”¨é¢å¤–çš„ <code>@Bean</code>æ–¹æ³•å°†ç®¡ç†è§†å›¾å…¬å¼€ç»™å®¹å™¨ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>@Bean</code>æ–¹æ³•æ˜¯ä¸€ç§é€šç”¨çš„å·¥å‚æ–¹æ³•æœºåˆ¶ã€‚</p><p>ä¸å®Œæ•´çš„ <code>@Configuration</code>ä¸åŒï¼Œliteçš„<code>@Bean</code>æ–¹æ³•ä¸èƒ½å£°æ˜beanä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚ ç›¸åï¼Œå®ƒä»¬å¯¹å…¶åŒ…å«ç»„ä»¶çš„å†…éƒ¨çŠ¶æ€è¿›è¡Œæ“ä½œï¼Œå¹¶ä¸”å¯ä»¥æœ‰é€‰æ‹©çš„å¯¹å®ƒä»¬å¯èƒ½å£°æ˜çš„å‚æ•°è¿›è¡Œæ“ä½œã€‚å› æ­¤ï¼Œè¿™æ ·çš„<code>@Bean</code>æ³¨è§£çš„æ–¹æ³•ä¸åº”è¯¥è°ƒç”¨å…¶ä»–<code>@Bean</code>æ³¨è§£çš„æ–¹æ³•ã€‚ æ¯ä¸ªè¿™æ ·çš„æ–¹æ³•å®é™…ä¸Šåªæ˜¯ç‰¹å®šbeanå¼•ç”¨çš„å·¥å‚æ–¹æ³•ï¼Œæ²¡æœ‰ä»»ä½•ç‰¹æ®Šçš„è¿è¡Œæ—¶è¯­ä¹‰ã€‚ä¸ç»è¿‡CGLIBå¤„ç†ï¼Œæ‰€ä»¥åœ¨ç±»è®¾è®¡æ–¹é¢æ²¡æœ‰é™åˆ¶ï¼ˆå³ï¼ŒåŒ…å«ç±»å¯èƒ½æ˜¯æœ€ç»ˆçš„ï¼‰ã€‚</p><p>åœ¨å¸¸è§çš„åœºæ™¯ä¸­ï¼Œ<code>@Bean</code>æ–¹æ³•å°†åœ¨<code>@Configuration</code>ç±»ä¸­å£°æ˜ï¼Œç¡®ä¿å§‹ç»ˆä½¿ç”¨â€œfullâ€æ¨¡å¼ï¼Œè¿™å°†é˜²æ­¢ç›¸åŒçš„<code>@Bean</code>æ–¹æ³•è¢«æ„å¤–åœ°å¤šæ¬¡è°ƒç”¨ï¼Œè¿™æœ‰åŠ©äºå‡å°‘åœ¨ â€œliteâ€æ¨¡å¼ä¸‹æ“ä½œæ—¶éš¾ä»¥è·Ÿè¸ªçš„ç»†å¾®é”™è¯¯ã€‚</p><p><code>@Bean</code>å’Œ<code>@Configuration</code>æ³¨è§£å°†åœ¨ä¸‹é¢çš„ç« èŠ‚æ·±å…¥è®¨è®ºï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬å°†ä»‹ç»ä½¿ç”¨åŸºäºJavaä»£ç çš„é…ç½®æ¥åˆ›å»ºSpringå®¹å™¨çš„å„ç§æ–¹æ³•ã€‚</p><h4 id="1-12-2-ä½¿ç”¨AnnotationConfigApplicationContextåˆå§‹åŒ–Springå®¹å™¨"><a href="#1-12-2-ä½¿ç”¨AnnotationConfigApplicationContextåˆå§‹åŒ–Springå®¹å™¨" class="headerlink" title="1.12.2. ä½¿ç”¨AnnotationConfigApplicationContextåˆå§‹åŒ–Springå®¹å™¨"></a>1.12.2. ä½¿ç”¨<code>AnnotationConfigApplicationContext</code>åˆå§‹åŒ–Springå®¹å™¨</h4><p>ä»¥ä¸‹éƒ¨åˆ†ä»‹ç»äº†Springçš„<code>AnnotationConfigApplicationContext</code>ï¼Œå®ƒæ˜¯åœ¨Spring 3.0ä¸­å¼•å…¥çš„ã€‚è¿™æ˜¯ä¸€ä¸ªå¼ºå¤§çš„(versatile)<code>ApplicationContext</code> å®ç°,å®ƒä¸ä»…èƒ½è§£æ<code>@Configuration</code>æ³¨è§£ç±» ,ä¹Ÿèƒ½è§£æ <code>@Component</code>æ³¨è§£çš„ç±»å’Œä½¿ç”¨JSR-330æ³¨è§£çš„ç±».</p><p>å½“ä½¿ç”¨<code>@Configuration</code>ç±»ä½œä¸ºè¾“å…¥æ—¶,<code>@Configuration</code>ç±»æœ¬èº«è¢«æ³¨å†Œä¸ºä¸€ä¸ªbeanå®šä¹‰,ç±»ä¸­æ‰€æœ‰å£°æ˜çš„<code>@Bean</code>æ–¹æ³•ä¹Ÿè¢«æ³¨å†Œä¸ºbeanå®šä¹‰.</p><p>å½“æä¾› <code>@Component</code>å’ŒJSR-330ç±»æ—¶ï¼Œå®ƒä»¬è¢«æ³¨å†Œä¸ºbeanå®šä¹‰ï¼Œå¹¶ä¸”å‡å®šåœ¨å¿…è¦æ—¶åœ¨è¿™äº›ç±»ä¸­ä½¿ç”¨DIå…ƒæ•°æ®ï¼Œä¾‹å¦‚<code>@Autowired</code> æˆ– <code>@Inject</code>ã€‚</p><h5 id="ç®€å•ç»“æ„"><a href="#ç®€å•ç»“æ„" class="headerlink" title="ç®€å•ç»“æ„"></a>ç®€å•ç»“æ„</h5><p>ä¸å®ä¾‹åŒ–<code>ClassPathXmlApplicationContext</code>æ—¶Spring XMLæ–‡ä»¶ç”¨ä½œè¾“å…¥çš„æ–¹å¼å¤§è‡´ç›¸åŒï¼Œ åœ¨å®ä¾‹åŒ–<code>AnnotationConfigApplicationContext</code>æ—¶å¯ä»¥ä½¿ç”¨<code>@Configuration</code> ç±»ä½œä¸ºè¾“å…¥ã€‚ è¿™å…è®¸å®Œå…¨æ— XMLä½¿ç”¨Springå®¹å™¨ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">String</span>[] args)</span> </span>&#123;<br><br>    ApplicationContext ctx = <span class="hljs-keyword">new</span> <span class="hljs-built_in">AnnotationConfigApplicationContext</span>(AppConfig.<span class="hljs-keyword">class</span>);<br><br>    MyService myService = ctx.<span class="hljs-built_in">getBean</span>(MyService.<span class="hljs-keyword">class</span>);<br><br>    myService.<span class="hljs-built_in">doStuff</span>();<br><br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚å‰æ‰€è¿°ï¼Œ<code>AnnotationConfigApplicationContext</code>ä¸ä»…é™äºä½¿ç”¨<code>@Configuration</code>ç±»ã€‚ ä»»ä½•<code>@Component</code>æˆ–JSR-330å¸¦æ³¨è§£çš„ç±»éƒ½å¯ä»¥ä½œä¸ºè¾“å…¥æä¾›ç»™æ„é€ å‡½æ•°ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">String</span>[] args)</span> </span>&#123;<br><br>    ApplicationContext ctx = <span class="hljs-keyword">new</span> <span class="hljs-built_in">AnnotationConfigApplicationContext</span>(MyServiceImpl.<span class="hljs-keyword">class</span>, Dependency1.<span class="hljs-keyword">class</span>, Dependency2.<span class="hljs-keyword">class</span>);<br><br>    MyService myService = ctx.<span class="hljs-built_in">getBean</span>(MyService.<span class="hljs-keyword">class</span>);<br><br>    myService.<span class="hljs-built_in">doStuff</span>();<br><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢å‡è®¾<code>MyServiceImpl</code>, <code>Dependency1</code>, å’Œ <code>Dependency2</code>ä½¿ç”¨Springä¾èµ–æ³¨å…¥æ³¨è§£ï¼Œä¾‹å¦‚<code>@Autowired</code>ã€‚</p><h5 id="ä½¿ç”¨register-Classâ€¦-ç¼–ç¨‹æ„å»ºå®¹å™¨"><a href="#ä½¿ç”¨register-Classâ€¦-ç¼–ç¨‹æ„å»ºå®¹å™¨" class="headerlink" title="ä½¿ç”¨register(Class&lt;?&gt;â€¦)ç¼–ç¨‹æ„å»ºå®¹å™¨"></a>ä½¿ç”¨<code>register(Class&lt;?&gt;â€¦)</code>ç¼–ç¨‹æ„å»ºå®¹å™¨</h5><p><code>AnnotationConfigApplicationContext</code>å¯ä»¥é€šè¿‡æ— å‚æ„é€ å‡½æ•°å®ä¾‹åŒ–ï¼Œç„¶åè°ƒç”¨<code>register()</code> æ–¹æ³•è¿›è¡Œé…ç½®ã€‚ è¿™ç§æ–¹æ³•åœ¨ä»¥ç¼–ç¨‹çš„æ–¹å¼æ„å»º <code>AnnotationConfigApplicationContext</code>æ—¶ç‰¹åˆ«æœ‰ç”¨ã€‚ä¸‹åˆ—ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œ</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">String</span>[] args)</span> </span>&#123;<br><br>    AnnotationConfigApplicationContext ctx = <span class="hljs-keyword">new</span> <span class="hljs-built_in">AnnotationConfigApplicationContext</span>();<br><br>    ctx.<span class="hljs-built_in">register</span>(AppConfig.<span class="hljs-keyword">class</span>, OtherConfig.<span class="hljs-keyword">class</span>);<br><br>    ctx.<span class="hljs-built_in">register</span>(AdditionalConfig.<span class="hljs-keyword">class</span>);<br><br>    ctx.<span class="hljs-built_in">refresh</span>();<br><br>    MyService myService = ctx.<span class="hljs-built_in">getBean</span>(MyService.<span class="hljs-keyword">class</span>);<br><br>    myService.<span class="hljs-built_in">doStuff</span>();<br><br>&#125;<br></code></pre></td></tr></table></figure><h5 id="3-ä½¿ç”¨scan-Stringâ€¦-æ‰«æç»„ä»¶"><a href="#3-ä½¿ç”¨scan-Stringâ€¦-æ‰«æç»„ä»¶" class="headerlink" title="3 ä½¿ç”¨scan(Stringâ€¦)æ‰«æç»„ä»¶"></a>3 ä½¿ç”¨<code>scan(Stringâ€¦)</code>æ‰«æç»„ä»¶</h5><p>è¦å¯ç”¨ç»„ä»¶æ‰«æï¼Œå¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼æ³¨è§£<code>@Configuration</code>ç±»:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Configuration</span><br><br><span class="hljs-variable">@ComponentScan</span>(basePackages = <span class="hljs-string">&quot;com.acme&quot;</span>) (<span class="hljs-number">1</span>)<br><br>public class AppConfig  &#123;<br><br>    ...<br><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>1</strong>ã€æ­¤æ³¨è§£å¯å¯ç”¨ç»„ä»¶æ‰«æã€‚</p><p>æœ‰ç»éªŒçš„ç”¨æˆ·å¯èƒ½æ›´ç†Ÿæ‚‰ä½¿ç”¨XMLçš„ç­‰ä»·é…ç½®å½¢å¼ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">&quot;com.acme&quot;</span>/&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ<code>com.acme</code>åŒ…ä¼šè¢«æ‰«æï¼Œåªè¦æ˜¯ä½¿ç”¨äº†<code>@Component</code>æ³¨è§£çš„ç±»ï¼Œéƒ½ä¼šè¢«æ³¨å†Œè¿›å®¹å™¨ä¸­ã€‚åŒæ ·åœ°ï¼Œ<code>AnnotationConfigApplicationContext</code>å…¬å¼€çš„<code>scan(Stringâ€¦)</code> æ–¹æ³•ä¹Ÿå…è®¸æ‰«æç±»å®ŒæˆåŒæ ·çš„åŠŸèƒ½ å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">String</span>[] args)</span> </span>&#123;<br><br>    AnnotationConfigApplicationContext ctx = <span class="hljs-keyword">new</span> <span class="hljs-built_in">AnnotationConfigApplicationContext</span>();<br><br>    ctx.<span class="hljs-built_in">scan</span>(<span class="hljs-string">&quot;com.acme&quot;</span>);<br><br>    ctx.<span class="hljs-built_in">refresh</span>();<br><br>    MyService myService = ctx.<span class="hljs-built_in">getBean</span>(MyService.<span class="hljs-keyword">class</span>);<br><br>&#125;<br></code></pre></td></tr></table></figure><p>è¯·è®°ä½<code>@Configuration</code>ç±»æ˜¯ä½¿ç”¨<code>@Component</code>è¿›è¡Œ<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-meta-annotations">å…ƒæ³¨è§£</a>çš„ï¼Œå› æ­¤å®ƒä»¬æ˜¯ç»„ä»¶æ‰«æçš„å€™é€‰è€…ã€‚ åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œ å‡è®¾AppConfigåœ¨com.acmeåŒ…ï¼ˆæˆ–ä¸‹é¢çš„ä»»ä½•åŒ…ï¼‰ä¸­å£°æ˜ï¼Œå®ƒåœ¨<code>scan()</code>è°ƒç”¨æœŸé—´è¢«æ‹¾å–ã€‚ åœ¨<code>refresh()</code>ä¹‹åï¼Œå®ƒçš„æ‰€æœ‰<code>@Bean</code>æ–¹æ³•éƒ½è¢«å¤„ç†å¹¶åœ¨å®¹å™¨ä¸­æ³¨å†Œä¸ºbeanå®šä¹‰ã€‚</p><h5 id="ä½¿ç”¨AnnotationConfigWebApplicationContextæ”¯æŒWebåº”ç”¨ç¨‹åº"><a href="#ä½¿ç”¨AnnotationConfigWebApplicationContextæ”¯æŒWebåº”ç”¨ç¨‹åº" class="headerlink" title="ä½¿ç”¨AnnotationConfigWebApplicationContextæ”¯æŒWebåº”ç”¨ç¨‹åº"></a>ä½¿ç”¨<code>AnnotationConfigWebApplicationContext</code>æ”¯æŒWebåº”ç”¨ç¨‹åº</h5><p><code>WebApplicationContext</code>ä¸<code>AnnotationConfigApplicationContext</code>çš„å˜ç§æ˜¯ <code>AnnotationConfigWebApplicationContext</code>é…ç½®ã€‚è¿™ä¸ªå®ç°å¯ä»¥ç”¨äºé…ç½®Spring <code>ContextLoaderListener</code> servletç›‘å¬å™¨ ï¼ŒSpring MVCçš„ <code>DispatcherServlet</code>ç­‰ç­‰ã€‚ä»¥ä¸‹web.xmlä»£ç æ®µé…ç½®å…¸å‹çš„Spring MVC Webåº”ç”¨ç¨‹åºï¼ˆè¯·æ³¨æ„<code>contextClass</code> context-paramå’Œinit-paramçš„ä½¿ç”¨ï¼‰ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">web-app</span>&gt;</span>    <span class="hljs-comment">&lt;!-- Configure ContextLoaderListener to use AnnotationConfigWebApplicationContext        instead of the default XmlWebApplicationContext --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">context-param</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>contextClass<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>            org.springframework.web.context.support.AnnotationConfigWebApplicationContext        <span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">context-param</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- Configuration locations must consist of one or more comma- or space-delimited        fully-qualified @Configuration classes. Fully-qualified packages may also be        specified for component-scanning --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">context-param</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>contextConfigLocation<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>com.acme.AppConfig<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">context-param</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- Bootstrap the root application context as usual using ContextLoaderListener --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">listener</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="hljs-tag">&lt;/<span class="hljs-name">listener-class</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">listener</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- Declare a Spring MVC DispatcherServlet as usual --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>dispatcher<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span>        <span class="hljs-comment">&lt;!-- Configure DispatcherServlet to use AnnotationConfigWebApplicationContext            instead of the default XmlWebApplicationContext --&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>contextClass<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>                org.springframework.web.context.support.AnnotationConfigWebApplicationContext            <span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span>        <span class="hljs-comment">&lt;!-- Again, config locations must consist of one or more comma- or space-delimited            and fully-qualified @Configuration classes --&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>contextConfigLocation<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>com.acme.web.MvcConfig<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- map all requests for /app/* to the dispatcher servlet --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>dispatcher<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/app/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">web-app</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="1-12-3-ä½¿ç”¨-Bean-æ³¨è§£"><a href="#1-12-3-ä½¿ç”¨-Bean-æ³¨è§£" class="headerlink" title="1.12.3. ä½¿ç”¨@Bean æ³¨è§£"></a>1.12.3. ä½¿ç”¨<code>@Bean</code> æ³¨è§£</h4><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs oxygene">@Bean` @Beanæ˜¯ä¸€ä¸ªæ–¹æ³•çº§åˆ«çš„æ³¨è§£ï¼Œå®ƒä¸XMLä¸­çš„ `&lt;bean/&gt;`å…ƒç´ ç±»ä¼¼ã€‚æ³¨è§£æ”¯æŒ `&lt;bean/&gt;`æä¾›çš„ä¸€äº›å±æ€§ï¼Œä¾‹å¦‚ * [init-<span class="hljs-keyword">method</span>]<span class="hljs-params">(https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-lifecycle-initializingbean)</span> * [<span class="hljs-title function_">destroy</span>-<span class="hljs-title function_">method</span>]<span class="hljs-params">(https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-lifecycle-disposablebean)</span> * [<span class="hljs-title function_">autowiring</span>]<span class="hljs-params">(https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-autowire)</span> * `<span class="hljs-title function_">name</span><br></code></pre></td></tr></table></figure><p>å¼€å‘è€…å¯ä»¥åœ¨<code>@Configuration</code>ç±»æˆ–<code>@Component</code>ç±»ä¸­ä½¿ç”¨<code>@Bean</code>æ³¨è§£ã€‚</p><h5 id="å£°æ˜ä¸€ä¸ªBean"><a href="#å£°æ˜ä¸€ä¸ªBean" class="headerlink" title="å£°æ˜ä¸€ä¸ªBean"></a>å£°æ˜ä¸€ä¸ªBean</h5><p>è¦å£°æ˜ä¸€ä¸ªbeanï¼Œåªéœ€ä½¿ç”¨<code>@Bean</code>æ³¨è§£æ–¹æ³•å³å¯ã€‚ä½¿ç”¨æ­¤æ–¹æ³•ï¼Œå°†ä¼šåœ¨<code>ApplicationContext</code>å†…æ³¨å†Œä¸€ä¸ªbeanï¼Œbeançš„ç±»å‹æ˜¯æ–¹æ³•çš„è¿”å›å€¼ç±»å‹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ beanåç§°å°†ä¸æ–¹æ³•åç§°ç›¸åŒã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†<code>@Bean</code>æ–¹æ³•å£°æ˜ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Configurationpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> &#123;<br>    <span class="hljs-meta">@Bean</span>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">TransferServiceImpl</span> <span class="hljs-title function_">transferService</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransferServiceImpl</span>();    &#125;&#125;<br></code></pre></td></tr></table></figure><p>å‰é¢çš„é…ç½®å®Œå…¨ç­‰åŒäºä»¥ä¸‹Spring XML:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;transferService&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.acme.TransferServiceImpl&quot;</span>/&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><p>è¿™ä¸¤ä¸ªå£°æ˜éƒ½åœ¨<code>ApplicationContext</code>ä¸­åˆ›å»ºä¸€ä¸ªåä¸º<code>transferService</code>çš„beanï¼Œå¹¶ä¸”ç»‘å®šäº†<code>TransferServiceImpl</code>çš„å®ä¾‹ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p>transferService -&gt; com.acme.TransferServiceImpl</p><p>æ‚¨è¿˜å¯ä»¥ä½¿ç”¨æ¥å£ï¼ˆæˆ–åŸºç±»ï¼‰è¿”å›ç±»å‹å£°æ˜<code>@Bean</code>æ–¹æ³•ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Configurationpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> &#123;<br>    <span class="hljs-meta">@Bean</span>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">TransferService</span> <span class="hljs-title function_">transferService</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransferServiceImpl</span>();    &#125;&#125;<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œè¿™ä¼šå°†é¢„å…ˆç±»å‹é¢„æµ‹çš„å¯è§æ€§é™åˆ¶ä¸ºæŒ‡å®šçš„æ¥å£ç±»å‹(<code>TransferService</code>),ç„¶ååœ¨å®ä¾‹åŒ–å—å½±å“çš„å•ä¸€beanæ—¶,åªçŸ¥é“å®¹å™¨çš„å®Œæ•´ç±»å‹(<code>TransferServiceImpl</code>ï¼‰ã€‚ ã€‚éå»¶è¿Ÿçš„å•ä¾‹beanæ ¹æ®å®ƒä»¬çš„å£°æ˜é¡ºåºè¿›è¡Œå®ä¾‹åŒ–ï¼Œå› æ­¤å¼€å‘è€…å¯èƒ½ä¼šçœ‹åˆ°ä¸åŒç±»å‹çš„åŒ¹é…ç»“æœï¼Œè¿™å…·ä½“å–å†³äºå¦ä¸€ä¸ªç»„ä»¶å°è¯•æŒ‰æœªç±»å‹åŒ¹é…çš„æ—¶é—´(å¦‚<code>@Autowired TransferServiceImpl</code>ï¼Œ ä¸€æ—¦<code>transferService</code> beanå·²è¢«å®ä¾‹åŒ–,è¿™ä¸ªé—®é¢˜å°±è¢«è§£å†³äº†).</p><p>å¦‚æœé€šè¿‡å£°æ˜çš„æœåŠ¡æ¥å£éƒ½æ˜¯å¼•ç”¨ç±»å‹,é‚£ä¹ˆ<code>@Bean</code> è¿”å›ç±»å‹å¯ä»¥å®‰å…¨åœ°åŠ å…¥è¯¥è®¾è®¡å†³ç­–.ä½†æ˜¯,å¯¹äºå®ç°å¤šä¸ªæ¥å£çš„ç»„ä»¶æˆ–å¯èƒ½ç”±å…¶å®ç°ç±»å‹å¼•ç”¨çš„ç»„ä»¶, æ›´å®‰å…¨çš„æ–¹æ³•æ˜¯å£°æ˜å¯èƒ½çš„æœ€å…·ä½“çš„è¿”å›ç±»å‹(è‡³å°‘æŒ‰ç…§æ³¨å…¥ç‚¹æ‰€è¦æ±‚çš„ç‰¹å®šä½ çš„beanï¼‰ã€‚</p><h5 id="Beanä¹‹é—´çš„ä¾èµ–"><a href="#Beanä¹‹é—´çš„ä¾èµ–" class="headerlink" title="Beanä¹‹é—´çš„ä¾èµ–"></a>Beanä¹‹é—´çš„ä¾èµ–</h5><p>ä¸€ä¸ªä½¿ç”¨<code>@Bean</code>æ³¨è§£çš„æ–¹æ³•å¯ä»¥å…·æœ‰ä»»æ„æ•°é‡çš„å‚æ•°æè¿°æ„å»ºè¯¥beanæ‰€éœ€çš„ä¾èµ–ï¼Œä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬çš„<code>TransferService</code>éœ€è¦<code>AccountRepository</code>ï¼Œ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ–¹æ³•å‚æ•°æ¥å®ç°è¯¥ä¾èµ–å…³ç³»ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Configurationpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> &#123;<br>    <span class="hljs-meta">@Bean</span>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">TransferService</span> <span class="hljs-title function_">transferService</span>(<span class="hljs-params">AccountRepository accountRepository</span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransferServiceImpl</span>(accountRepository);    &#125;&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªè§£ææœºåˆ¶ä¸åŸºäºæ„é€ å‡½æ•°çš„ä¾èµ–æ³¨å…¥éå¸¸ç›¸ä¼¼ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-constructor-injection">ç›¸å…³éƒ¨åˆ†</a>ã€‚</p><h5 id="æ¥æ”¶ç”Ÿå‘½å‘¨æœŸå›è°ƒ"><a href="#æ¥æ”¶ç”Ÿå‘½å‘¨æœŸå›è°ƒ" class="headerlink" title="æ¥æ”¶ç”Ÿå‘½å‘¨æœŸå›è°ƒ"></a>æ¥æ”¶ç”Ÿå‘½å‘¨æœŸå›è°ƒ</h5><p>ä½¿ç”¨<code>@Bean</code>æ³¨è§£å®šä¹‰çš„ä»»ä½•ç±»éƒ½æ”¯æŒå¸¸è§„çš„ç”Ÿå‘½å‘¨æœŸå›è°ƒï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨JSR-çš„<code>@PostConstruct</code>å’Œ<code>@PreDestroy</code>æ³¨è§£ã€‚ æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-postconstruct-and-predestroy-annotations">JSR-250</a> æ³¨è§£ã€‚</p><p>å®Œå…¨æ”¯æŒå¸¸è§„çš„Spring<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-nature">ç”Ÿå‘½å‘¨æœŸ</a>å›è°ƒã€‚ å¦‚æœbeanå®ç°<code>InitializingBean</code>, <code>DisposableBean</code>, æˆ– <code>Lifecycle</code>ï¼Œåˆ™å®ƒä»¬å„è‡ªçš„æ–¹æ³•ç”±å®¹å™¨è°ƒç”¨ã€‚</p><p>åŒæ ·åœ°ï¼Œè¿˜å®Œå…¨æ”¯æŒæ ‡å‡†çš„<code>*Aware</code>ï¼Œå¦‚<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-beanfactory">BeanFactoryAware</a>, <a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-aware">BeanNameAware</a>, <a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#context-functionality-messagesource">MessageSourceAware</a>, <a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-aware">ApplicationContextAware</a>ã€‚</p><p><code>@Bean</code>æ³¨è§£æ”¯æŒæŒ‡å®šä»»æ„åˆå§‹åŒ–å’Œé”€æ¯å›è°ƒæ–¹æ³•ï¼Œå°±åƒ<code>bean</code>å…ƒç´ ä¸Šçš„Spring XMLçš„ <code>init-method</code>å’Œ<code>destroy-method</code> å±æ€§ä¸€æ ·ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BeanOne</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-comment">// initialization logic    &#125;&#125;</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BeanTwo</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">cleanup</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-comment">// destruction logic    &#125;&#125;</span><br><span class="hljs-meta">@Configurationpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> &#123;<br>    <span class="hljs-meta">@Bean</span>(initMethod = <span class="hljs-string">&quot;init&quot;</span>)    <span class="hljs-keyword">public</span> <span class="hljs-title class_">BeanOne</span> <span class="hljs-title function_">beanOne</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanOne</span>();    &#125;<br>    <span class="hljs-meta">@Bean</span>(destroyMethod = <span class="hljs-string">&quot;cleanup&quot;</span>)    <span class="hljs-keyword">public</span> <span class="hljs-title class_">BeanTwo</span> <span class="hljs-title function_">beanTwo</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanTwo</span>();    &#125;&#125;<br></code></pre></td></tr></table></figure><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨Java Configå®šä¹‰çš„beanä¸­<code>close</code>æ–¹æ³•æˆ–è€…<code>shutdown</code>æ–¹æ³•ï¼Œä¼šä½œä¸ºé”€æ¯å›è°ƒè€Œè‡ªåŠ¨è°ƒç”¨ã€‚è‹¥beanä¸­æœ‰<code>close</code> æˆ– <code>shutdown</code> æ–¹æ³•ï¼Œå¹¶ä¸”æ‚¨ä¸å¸Œæœ›åœ¨å®¹å™¨å…³é—­æ—¶è°ƒç”¨å®ƒï¼Œåˆ™å¯ä»¥å°†<code>@Bean(destroyMethod=&quot;&quot;)</code> æ·»åŠ åˆ°beanå®šä¹‰ä¸­ä»¥ç¦ç”¨é»˜è®¤<code>(inferred)</code> æ¨¡å¼ã€‚</p><p>å¼€å‘è€…å¯èƒ½å¸Œæœ›å¯¹é€šè¿‡JNDIè·å–çš„èµ„æºæ‰§è¡Œæ­¤æ“ä½œï¼Œå› ä¸ºå®ƒçš„ç”Ÿå‘½å‘¨æœŸæ˜¯åœ¨åº”ç”¨ç¨‹åºå¤–éƒ¨ç®¡ç†çš„ã€‚æ›´è¿›ä¸€æ­¥ï¼Œä½¿ç”¨ <code>DataSource</code>æ—¶ä¸€å®šè¦å…³é—­å®ƒï¼Œä¸å…³é—­å°†ä¼šå‡ºé—®é¢˜ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹è¯´æ˜å¦‚ä½•é˜²æ­¢<code>DataSource</code>çš„è‡ªåŠ¨é”€æ¯å›è°ƒï¼š</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-meta">@Bean</span>(destroyMethod=<span class="hljs-string">&quot;&quot;</span>)<br><br><span class="hljs-keyword">public</span> <span class="hljs-function">DataSource <span class="hljs-title">dataSource</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> NamingException </span>&#123;<br><br>    <span class="hljs-keyword">return</span> (DataSource) jndiTemplate.lookup(<span class="hljs-string">&quot;MyDS&quot;</span>);<br><br>&#125;<br></code></pre></td></tr></table></figure><p>åŒæ ·åœ°ï¼Œä½¿ç”¨<code>@Bean</code>æ–¹æ³•ï¼Œé€šå¸¸ä¼šé€‰æ‹©ä½¿ç”¨ç¨‹åºåŒ–çš„JNDIæŸ¥æ‰¾ï¼šä½¿ç”¨Springçš„<code>JndiTemplate</code> &#x2F; <code>JndiLocatorDelegate</code>å¸®åŠ©ç±»æˆ–ç›´æ¥ä½¿ç”¨JNDIçš„<code>InitialContext</code> ï¼Œä½†æ˜¯ä¸è¦ä½¿ç”¨<code>JndiObjectFactoryBean</code>çš„å˜ä½“ï¼Œå› ä¸ºå®ƒä¼šå¼ºåˆ¶å¼€å‘è€…å£°æ˜ä¸€ä¸ªè¿”å›ç±»å‹ä½œä¸º<code>FactoryBean</code>çš„ç±»å‹ç”¨äºä»£æ›¿å®é™…çš„ç›®æ ‡ç±»å‹ï¼Œè¿™ä¼šä½¿å¾—äº¤å‰å¼•ç”¨å˜å¾—å¾ˆå›°éš¾ã€‚</p><p>å¯¹äºå‰é¢æ³¨è§£ä¸­ä¸Šé¢ç¤ºä¾‹ä¸­çš„<code>BeanOne</code>ï¼Œåœ¨æ„é€ æœŸé—´ç›´æ¥è°ƒç”¨<code>init()</code>æ–¹æ³•åŒæ ·æœ‰æ•ˆï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configurationpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> &#123;<br>    <span class="hljs-meta">@Bean</span>    <span class="hljs-keyword">public</span> BeanOne <span class="hljs-title function_">beanOne</span><span class="hljs-params">()</span> &#123;        <span class="hljs-type">BeanOne</span> <span class="hljs-variable">beanOne</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanOne</span>();        beanOne.init();        <span class="hljs-keyword">return</span> beanOne;    &#125;<br>    <span class="hljs-comment">// ...&#125;</span><br></code></pre></td></tr></table></figure><p>å½“æ‚¨ç›´æ¥ä½¿ç”¨Javaï¼ˆnewå¯¹è±¡é‚£ç§ï¼‰å·¥ä½œæ—¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å¯¹è±¡æ‰§è¡Œä»»ä½•æ‚¨å–œæ¬¢çš„æ“ä½œï¼Œå¹¶ä¸”ä¸å¿…æ€»æ˜¯ä¾èµ–äºå®¹å™¨ç”Ÿå‘½å‘¨æœŸã€‚</p><h5 id="æŒ‡å®šBeanèŒƒå›´"><a href="#æŒ‡å®šBeanèŒƒå›´" class="headerlink" title="æŒ‡å®šBeanèŒƒå›´"></a>æŒ‡å®šBeanèŒƒå›´</h5><p>SpringåŒ…å«<code>@Scope</code>æ³¨è§£ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥æŒ‡å®šbeançš„èŒƒå›´ã€‚</p><h6 id="ä½¿ç”¨-Scope-æ³¨è§£"><a href="#ä½¿ç”¨-Scope-æ³¨è§£" class="headerlink" title="ä½¿ç”¨ @Scope æ³¨è§£"></a>ä½¿ç”¨ <code>@Scope</code> æ³¨è§£</h6><p>å¯ä»¥ä½¿ç”¨ä»»æ„æ ‡å‡†çš„æ–¹å¼ä¸º <code>@Bean</code>æ³¨è§£çš„beanæŒ‡å®šä¸€ä¸ªä½œç”¨åŸŸï¼Œä½ å¯ä»¥ä½¿ç”¨<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-scopes">Bean Scopes</a>ä¸­çš„ä»»æ„æ ‡å‡†ä½œç”¨åŸŸ</p><p>é»˜è®¤èŒƒå›´æ˜¯<code>singleton</code>çš„ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨ <code>@Scope</code>æ³¨è§£æ¥è¦†ç›–ã€‚å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Configurationpublic</span> class MyConfiguration &#123;<br>    <span class="hljs-variable">@Bean</span>    <span class="hljs-variable">@Scope</span>(<span class="hljs-string">&quot;prototype&quot;</span>)    public Encryptor <span class="hljs-built_in">encryptor</span>() &#123;        <span class="hljs-comment">// ...    &#125;&#125;</span><br></code></pre></td></tr></table></figure><h6 id="Scope-and-scoped-proxy"><a href="#Scope-and-scoped-proxy" class="headerlink" title="@Scope and scoped-proxy"></a><code>@Scope</code> and <code>scoped-proxy</code></h6><p>Springæä¾›äº†ä¸€ç§é€šè¿‡<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-scopes-other-injection">scoped proxies</a>å¤„ç†ä½œç”¨åŸŸä¾èµ–é¡¹çš„ä¾¿æ·æ–¹æ³•ã€‚ä½¿ç”¨XMLé…ç½®æ—¶åˆ›å»ºæ­¤ç±»ä»£ç†çš„æœ€ç®€å•æ–¹æ³•æ˜¯<code>&lt;aop:scoped-proxy/&gt;</code>å…ƒç´ ã€‚ ä½¿ç”¨<code>@Scope</code>æ³¨è§£åœ¨Javaä¸­é…ç½®beanæä¾›äº†ä¸<code>proxyMode</code>å±æ€§çš„ç­‰æ•ˆæ”¯æŒã€‚ é»˜è®¤å€¼ä¸ºæ— ä»£ç†ï¼ˆ<code>ScopedProxyMode.NO</code>ï¼‰ï¼Œä½†æ‚¨å¯ä»¥æŒ‡å®š<code>ScopedProxyMode.TARGET_CLASS</code> æˆ– <code>ScopedProxyMode.INTERFACES</code>ã€‚</p><p>å¦‚æœä½¿ç”¨Javaå°†XMLå‚è€ƒæ–‡æ¡£ï¼ˆè¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-scopes-other-injection">scoped proxies</a>ï¼‰çš„ä½œç”¨åŸŸä»£ç†ç¤ºä¾‹ç§»æ¤åˆ°æˆ‘ä»¬çš„ <code>@Bean</code>ï¼Œå®ƒç±»ä¼¼äºä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript"><span class="hljs-regexp">//</span> an HTTP Session-scoped bean exposed <span class="hljs-keyword">as</span> a proxy@Bean@SessionScopepublic UserPreferences userPreferences() &#123;    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> UserPreferences();&#125;<br>@Beanpublic Service userService() &#123;    UserService service = <span class="hljs-keyword">new</span> SimpleUserService();    <span class="hljs-regexp">//</span> a reference to the proxied userPreferences bean    service.setUserPreferences(userPreferences());    <span class="hljs-keyword">return</span> service;&#125;<br></code></pre></td></tr></table></figure><h5 id="è‡ªå®šä¹‰Beanå‘½å"><a href="#è‡ªå®šä¹‰Beanå‘½å" class="headerlink" title="è‡ªå®šä¹‰Beanå‘½å"></a>è‡ªå®šä¹‰Beanå‘½å</h5><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œé…ç½®ç±»ä½¿ç”¨<code>@Bean</code>æ–¹æ³•çš„åç§°ä½œä¸ºç»“æœbeançš„åç§°ã€‚ ä½†æ˜¯ï¼Œå¯ä»¥ä½¿ç”¨<code>name</code>å±æ€§è¦†ç›–æ­¤åŠŸèƒ½ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@Configurationpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> &#123;<br>    <span class="hljs-meta">@Bean(name = <span class="hljs-string">&quot;myThing&quot;</span>)</span>    <span class="hljs-keyword">public</span> Thing thing() &#123;        <span class="hljs-keyword">return</span> new Thing();    &#125;&#125;<br></code></pre></td></tr></table></figure><h5 id="beanåˆ«å"><a href="#beanåˆ«å" class="headerlink" title="beanåˆ«å"></a>beanåˆ«å</h5><p>æ­£å¦‚<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-beanname">Beançš„ å‘½å</a>ä¸­æ‰€è®¨è®ºçš„ï¼Œæœ‰æ—¶éœ€è¦ä¸ºå•ä¸ªbeanæä¾›å¤šä¸ªåç§°ï¼Œä¹Ÿç§°ä¸ºbeanåˆ«åã€‚ <code>@Bean</code>æ³¨è§£çš„ <code>name</code>å±æ€§ä¸ºæ­¤æ¥å—Stringæ•°ç»„ã€‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•ä¸ºbeanè®¾ç½®å¤šä¸ªåˆ«åï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@Configurationpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> &#123;<br>    <span class="hljs-meta">@Bean(name = &#123; <span class="hljs-string">&quot;dataSource&quot;</span>, <span class="hljs-string">&quot;subsystemA-dataSource&quot;</span>, <span class="hljs-string">&quot;subsystemB-dataSource&quot;</span> &#125;)</span>    <span class="hljs-keyword">public</span> DataSource dataSource() &#123;        <span class="hljs-comment">// instantiate, configure and return DataSource bean...    &#125;&#125;</span><br></code></pre></td></tr></table></figure><h5 id="Bean-çš„æè¿°"><a href="#Bean-çš„æè¿°" class="headerlink" title="Bean çš„æè¿°"></a>Bean çš„æè¿°</h5><p>æœ‰æ—¶ï¼Œæä¾›æ›´è¯¦ç»†çš„beanæ–‡æœ¬æè¿°ä¼šå¾ˆæœ‰å¸®åŠ©ã€‚ å½“beanè¢«æš´éœ²ï¼ˆå¯èƒ½é€šè¿‡JMXï¼‰ç”¨äºç›‘è§†ç›®çš„æ—¶ï¼Œè¿™å¯èƒ½ç‰¹åˆ«æœ‰ç”¨ã€‚</p><p>è¦å‘@Beanæ·»åŠ æè¿°ï¼Œå¯ä»¥ä½¿ç”¨<a href="https://docs.spring.io/spring-framework/docs/5.1.3.BUILD-SNAPSHOT/javadoc-api/org/springframework/context/annotation/Description.html"><code>@Description</code></a>æ³¨è§£ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Configurationpublic</span> class AppConfig &#123;<br>    <span class="hljs-variable">@Bean</span>    <span class="hljs-variable">@Description</span>(<span class="hljs-string">&quot;Provides a basic example of a bean&quot;</span>)    public Thing <span class="hljs-built_in">thing</span>() &#123;        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">Thing</span>();    &#125;&#125;<br></code></pre></td></tr></table></figure><h4 id="1-12-4-ä½¿ç”¨-Configuration-æ³¨è§£"><a href="#1-12-4-ä½¿ç”¨-Configuration-æ³¨è§£" class="headerlink" title="1.12.4. ä½¿ç”¨ @Configuration æ³¨è§£"></a>1.12.4. ä½¿ç”¨ <code>@Configuration</code> æ³¨è§£</h4><p><code>@Configuration</code>æ˜¯ä¸€ä¸ªç±»çº§åˆ«çš„æ³¨è§£,è¡¨æ˜è¯¥ç±»å°†ä½œä¸ºbeanå®šä¹‰çš„å…ƒæ•°æ®é…ç½®. <code>@Configuration</code>ç±»ä¼šå°†æœ‰<code>@Bean</code>æ³¨è§£çš„å…¬å¼€æ–¹æ³•å£°æ˜ä¸ºbean, .åœ¨ <code>@Configuration</code>ç±»ä¸Šè°ƒç”¨<code>@Bean</code>æ–¹æ³•ä¹Ÿå¯ä»¥ç”¨äºå®šä¹‰beané—´ä¾èµ–å…³ç³», æœ‰å…³ä¸€èˆ¬ä»‹ç»ï¼Œè¯·å‚é˜… <a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-java-basic-concepts">åŸºæœ¬æ¦‚å¿µ: <code>@Bean</code> å’Œ <code>@Configuration</code></a></p><h5 id="æ³¨å…¥å†…éƒ¨beanä¾èµ–"><a href="#æ³¨å…¥å†…éƒ¨beanä¾èµ–" class="headerlink" title="æ³¨å…¥å†…éƒ¨beanä¾èµ–"></a>æ³¨å…¥å†…éƒ¨beanä¾èµ–</h5><p>å½“Beanå½¼æ­¤æœ‰ä¾èµ–å…³ç³»æ—¶,è¡¨ç¤ºä¾èµ–å…³ç³»å°±åƒè°ƒç”¨å¦ä¸€ä¸ªbeanæ–¹æ³•ä¸€æ ·ç®€å•.å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Configurationpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> &#123;<br>    <span class="hljs-meta">@Bean</span>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">BeanOne</span> <span class="hljs-title function_">beanOne</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanOne</span>(<span class="hljs-title function_">beanTwo</span>());    &#125;<br>    <span class="hljs-meta">@Bean</span>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">BeanTwo</span> <span class="hljs-title function_">beanTwo</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanTwo</span>();    &#125;&#125;<br></code></pre></td></tr></table></figure><p>åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œ<code>beanOne</code>é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥æ¥æ”¶å¯¹<code>beanTwo</code>çš„å¼•ç”¨ã€‚</p><p>è¿™ç§å£°æ˜beané—´ä¾èµ–å…³ç³»çš„æ–¹æ³•åªæœ‰åœ¨ <code>@Configuration</code> ç±»ä¸­å£°æ˜<code>@Bean</code>æ–¹æ³•æ—¶æ‰æœ‰æ•ˆã€‚ æ‚¨ä¸èƒ½ä½¿ç”¨æ™®é€šçš„<code>@Component</code>ç±»å£°æ˜beané—´ä¾èµ–å…³ç³»ã€‚</p><h5 id="æŸ¥æ‰¾æ–¹æ³•æ³¨å…¥-1"><a href="#æŸ¥æ‰¾æ–¹æ³•æ³¨å…¥-1" class="headerlink" title="æŸ¥æ‰¾æ–¹æ³•æ³¨å…¥"></a>æŸ¥æ‰¾æ–¹æ³•æ³¨å…¥</h5><p>å¦‚å‰æ‰€è¿°ï¼Œ<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-method-injection">æŸ¥æ‰¾æ–¹æ³•æ³¨å…¥</a>æ˜¯ä¸€é¡¹å¾ˆå°‘ä½¿ç”¨çš„é«˜çº§åŠŸèƒ½ã€‚ åœ¨å•ä¾‹èŒƒå›´çš„beanä¾èµ–äºåŸå‹èŒƒå›´çš„beançš„æƒ…å†µä¸‹ï¼Œå®ƒå¾ˆæœ‰ç”¨ã€‚ Javaæä¾›äº†å¾ˆå‹å¥½çš„APIæ¥å®ç°è¿™ç§æ¨¡å¼ã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•ä½¿ç”¨æŸ¥æ‰¾æ–¹æ³•æ³¨å…¥ï¼š</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs smali">public<span class="hljs-keyword"> abstract</span> class CommandManager &#123;   <span class="hljs-keyword"> public</span> Object process(Object commandState) &#123;        // grab a<span class="hljs-built_in"> new </span>instance of the appropriate Command interface        Command command = createCommand();        // set the state on the (hopefully brand new) Command<span class="hljs-built_in"> instance </span>       command.setState(commandState);       <span class="hljs-built_in"> return </span>command.execute();    &#125;<br>    // okay... but where is the implementation of this method?   <span class="hljs-keyword"> protected</span><span class="hljs-keyword"> abstract</span> Command createCommand();&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡ä½¿ç”¨Javaé…ç½®ï¼Œæ‚¨å¯ä»¥åˆ›å»º <code>CommandManager</code>çš„å­ç±»ï¼Œå…¶ä¸­æŠ½è±¡çš„ <code>createCommand()</code> æ–¹æ³•è¢«è¦†ç›–ï¼Œä»¥ä¾¿æŸ¥æ‰¾æ–°çš„ï¼ˆåŸå‹ï¼‰å¯¹è±¡ã€‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Bean</span><span class="hljs-meta">@Scope</span>(<span class="hljs-string">&quot;prototype&quot;</span>)<span class="hljs-keyword">public</span> <span class="hljs-title class_">AsyncCommand</span> <span class="hljs-title function_">asyncCommand</span>(<span class="hljs-params"></span>) &#123;    <span class="hljs-title class_">AsyncCommand</span> command = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AsyncCommand</span>();    <span class="hljs-comment">// inject dependencies here as required    return command;&#125;</span><br><span class="hljs-meta">@Beanpublic</span> <span class="hljs-title class_">CommandManager</span> <span class="hljs-title function_">commandManager</span>(<span class="hljs-params"></span>) &#123;    <span class="hljs-comment">// return new anonymous implementation of CommandManager with command() overridden    // to return a new prototype Command object    return new CommandManager() &#123;        protected Command createCommand() &#123;            return asyncCommand();        &#125;    &#125;&#125;</span><br></code></pre></td></tr></table></figure><h5 id="æœ‰å…³åŸºäºJavaçš„é…ç½®å¦‚ä½•åœ¨å†…éƒ¨å·¥ä½œçš„æ›´å¤šä¿¡æ¯"><a href="#æœ‰å…³åŸºäºJavaçš„é…ç½®å¦‚ä½•åœ¨å†…éƒ¨å·¥ä½œçš„æ›´å¤šä¿¡æ¯" class="headerlink" title="æœ‰å…³åŸºäºJavaçš„é…ç½®å¦‚ä½•åœ¨å†…éƒ¨å·¥ä½œçš„æ›´å¤šä¿¡æ¯"></a>æœ‰å…³åŸºäºJavaçš„é…ç½®å¦‚ä½•åœ¨å†…éƒ¨å·¥ä½œçš„æ›´å¤šä¿¡æ¯</h5><p>è¯·è€ƒè™‘ä»¥ä¸‹ç¤ºä¾‹ï¼Œè¯¥ç¤ºä¾‹æ˜¾ç¤ºäº†è¢«è°ƒç”¨ä¸¤æ¬¡çš„<code>@Bean</code>æ³¨è§£æ–¹æ³•:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Configurationpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> &#123;<br>    <span class="hljs-meta">@Bean</span>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">ClientService</span> <span class="hljs-title function_">clientService1</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-title class_">ClientServiceImpl</span> clientService = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClientServiceImpl</span>();        clientService.<span class="hljs-title function_">setClientDao</span>(<span class="hljs-title function_">clientDao</span>());        <span class="hljs-keyword">return</span> clientService;    &#125;<br>    <span class="hljs-meta">@Bean</span>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">ClientService</span> <span class="hljs-title function_">clientService2</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-title class_">ClientServiceImpl</span> clientService = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClientServiceImpl</span>();        clientService.<span class="hljs-title function_">setClientDao</span>(<span class="hljs-title function_">clientDao</span>());        <span class="hljs-keyword">return</span> clientService;    &#125;<br>    <span class="hljs-meta">@Bean</span>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">ClientDao</span> <span class="hljs-title function_">clientDao</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClientDaoImpl</span>();    &#125;&#125;<br></code></pre></td></tr></table></figure><p><code>clientDao()</code>åœ¨<code>clientService1()</code>ä¸­è°ƒç”¨ä¸€æ¬¡ï¼Œåœ¨<code>clientService2()</code>ä¸­è°ƒç”¨ä¸€æ¬¡ã€‚ç”±äºæ­¤æ–¹æ³•åˆ›å»ºäº†<code>ClientDaoImpl</code>çš„æ–°å®ä¾‹å¹¶å°†å…¶è¿”å›ï¼Œå› æ­¤é€šå¸¸å¸Œæœ›æœ‰ä¸¤ä¸ªå®ä¾‹ï¼ˆæ¯ä¸ªæœåŠ¡ä¸€ä¸ªï¼‰ã€‚ è¿™è‚¯å®šä¼šæœ‰é—®é¢˜ï¼šåœ¨Springä¸­ï¼Œå®ä¾‹åŒ–çš„beané»˜è®¤å…·æœ‰<code>singleton</code>èŒƒå›´ã€‚è¿™å°±æ˜¯å®ƒçš„ç¥å¥‡ä¹‹å¤„:æ‰€æœ‰<code>@Configuration</code>ç±»åœ¨å¯åŠ¨æ—¶éƒ½ä½¿ç”¨ <code>CGLIB</code>è¿›è¡Œå­ç±»åŒ–ã€‚ åœ¨å­ç±»ä¸­ï¼Œå­æ–¹æ³•åœ¨è°ƒç”¨çˆ¶æ–¹æ³•å¹¶åˆ›å»ºæ–°å®ä¾‹ä¹‹å‰ï¼Œé¦–å…ˆæ£€æŸ¥å®¹å™¨æ˜¯å¦æœ‰ä»»ä½•ç¼“å­˜ï¼ˆä½œç”¨åŸŸï¼‰beanã€‚</p><p>è¿™ç§è¡Œä¸ºå¯ä»¥æ ¹æ®beançš„ä½œç”¨åŸŸè€Œå˜åŒ–,æˆ‘ä»¬è¿™é‡Œåªæ˜¯è®¨è®ºå•ä¾‹.</p><p>ä»Spring 3.2å¼€å§‹ï¼Œä¸å†éœ€è¦å°†CGLIBæ·»åŠ åˆ°ç±»è·¯å¾„ä¸­ï¼Œå› ä¸ºCGLIBç±»å·²ç»åœ¨<code>org.springframework.cglib</code>ä¸‹é‡æ–°æ‰“åŒ…å¹¶ç›´æ¥åŒ…å«åœ¨spring-core JARä¸­ã€‚</p><p>ç”±äºCGLIBåœ¨å¯åŠ¨æ—¶åŠ¨æ€æ·»åŠ åŠŸèƒ½ï¼Œå› æ­¤å­˜åœ¨ä¸€äº›é™åˆ¶ã€‚ ç‰¹åˆ«æ˜¯ï¼Œé…ç½®ç±»ä¸èƒ½æ˜¯ finalçš„ã€‚ ä½†æ˜¯ï¼Œä»4.3å¼€å§‹ï¼Œé…ç½®ç±»å…è®¸ä½¿ç”¨ä»»ä½•æ„é€ å‡½æ•°ï¼ŒåŒ…æ‹¬ä½¿ç”¨<code>@Autowired</code>æˆ–å•ä¸ªéé»˜è®¤æ„é€ å‡½æ•°å£°æ˜è¿›è¡Œé»˜è®¤æ³¨å…¥ã€‚</p><p>å¦‚æœæƒ³é¿å…å› CGLIBå¸¦æ¥çš„é™åˆ¶,è¯·è€ƒè™‘å£°æ˜é<code>@Configuration</code>ç±»çš„<code>@Bean</code>æ–¹æ³•ï¼Œä¾‹å¦‚åœ¨çº¯çš„<code>@Component</code>ç±» .è¿™æ ·åœ¨<code>@Bean</code>æ–¹æ³•ä¹‹é—´çš„äº¤å‰æ–¹æ³•è°ƒç”¨å°†ä¸ä¼šè¢«æ‹¦æˆª,æ­¤æ—¶å¿…é¡»åœ¨æ„é€ å‡½æ•°æˆ–æ–¹æ³•çº§åˆ«ä¸Šè¿›è¡Œä¾èµ–æ³¨å…¥ã€‚</p><h4 id="1-12-5-ç¼–å†™åŸºäºJavaçš„é…ç½®"><a href="#1-12-5-ç¼–å†™åŸºäºJavaçš„é…ç½®" class="headerlink" title="1.12.5. ç¼–å†™åŸºäºJavaçš„é…ç½®"></a>1.12.5. ç¼–å†™åŸºäºJavaçš„é…ç½®</h4><p>Springçš„åŸºäºJavaçš„é…ç½®åŠŸèƒ½å…è®¸æ‚¨æ’°å†™æ³¨è§£ï¼Œè¿™å¯ä»¥é™ä½é…ç½®çš„å¤æ‚æ€§ã€‚</p><h5 id="ä½¿ç”¨-Import-æ³¨è§£"><a href="#ä½¿ç”¨-Import-æ³¨è§£" class="headerlink" title="ä½¿ç”¨@Import æ³¨è§£"></a>ä½¿ç”¨<code>@Import</code> æ³¨è§£</h5><p>å°±åƒåœ¨Spring XMLæ–‡ä»¶ä¸­ä½¿ç”¨<code>&lt;import/&gt;</code>å…ƒç´ æ¥å¸®åŠ©æ¨¡å—åŒ–é…ç½®ä¸€æ ·ï¼Œ<code>@Import</code> æ³¨è§£å…è®¸ä»å¦ä¸€ä¸ªé…ç½®ç±»åŠ è½½<code>@Bean</code>å®šä¹‰ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Configurationpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigA</span> &#123;<br>    <span class="hljs-meta">@Bean</span>    <span class="hljs-keyword">public</span> A <span class="hljs-title function_">a</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title function_">A</span>();    &#125;&#125;<br><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@Import</span>(<span class="hljs-title class_">ConfigA</span>.<span class="hljs-property">class</span>)<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigB</span> &#123;<br>    <span class="hljs-meta">@Bean</span>    <span class="hljs-keyword">public</span> B <span class="hljs-title function_">b</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title function_">B</span>();    &#125;&#125;<br></code></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œåœ¨å®ä¾‹åŒ–ä¸Šä¸‹æ–‡æ—¶ï¼Œä¸éœ€è¦åŒæ—¶æŒ‡å®š<code>ConfigA.class</code>å’Œ <code>ConfigB.class</code>ï¼Œåªéœ€è¦æ˜¾å¼æä¾›<code>ConfigB</code>ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">String</span>[] args)</span> </span>&#123;    ApplicationContext ctx = <span class="hljs-keyword">new</span> <span class="hljs-built_in">AnnotationConfigApplicationContext</span>(ConfigB.<span class="hljs-keyword">class</span>);<br>    <span class="hljs-comment">// now both beans A and B will be available...    A a = ctx.getBean(A.class);    B b = ctx.getBean(B.class);&#125;</span><br></code></pre></td></tr></table></figure><p>è¿™ç§æ–¹æ³•ç®€åŒ–äº†å®¹å™¨å®ä¾‹åŒ–ï¼Œå› ä¸ºåªéœ€è¦å¤„ç†ä¸€ä¸ªç±»ï¼Œè€Œä¸æ˜¯è¦æ±‚æ‚¨åœ¨æ„é€ æœŸé—´è®°ä½å¯èƒ½å¤§é‡çš„<code>@Configuration</code>ç±»ã€‚</p><p>ä»Spring Framework 4.2å¼€å§‹ï¼Œ<code>@Import</code>è¿˜æ”¯æŒå¼•ç”¨å¸¸è§„ç»„ä»¶ç±»ï¼Œç±»ä¼¼äº<code>AnnotationConfigApplicationContext.register</code>æ–¹æ³•ã€‚ å¦‚æœè¦é¿å…ç»„ä»¶æ‰«æï¼Œè¿™ä¸€ç‚¹ç‰¹åˆ«æœ‰ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ä¸€äº›é…ç½®ç±»ä½œä¸ºæ˜ç¡®å®šä¹‰æ‰€æœ‰ç»„ä»¶çš„å…¥å£ç‚¹ã€‚</p><h6 id="åœ¨å¯¼å…¥çš„-Beanå®šä¹‰ä¸Šæ³¨å…¥ä¾èµ–é¡¹"><a href="#åœ¨å¯¼å…¥çš„-Beanå®šä¹‰ä¸Šæ³¨å…¥ä¾èµ–é¡¹" class="headerlink" title="åœ¨å¯¼å…¥çš„@Beanå®šä¹‰ä¸Šæ³¨å…¥ä¾èµ–é¡¹"></a>åœ¨å¯¼å…¥çš„<code>@Bean</code>å®šä¹‰ä¸Šæ³¨å…¥ä¾èµ–é¡¹</h6><p>ä¸Šé¢çš„ä¾‹å­å¯ä»¥è¿è¡Œ,,ä½†æ˜¯å¤ªç®€å•äº†ã€‚åœ¨å¤§å¤šæ•°å®é™…æƒ…å†µä¸‹ï¼Œbeanå°†åœ¨é…ç½®ç±»ä¹‹é—´ç›¸äº’ä¾èµ–.åœ¨ä½¿ç”¨XMLæ—¶,è¿™æœ¬èº«ä¸æ˜¯é—®é¢˜,å› ä¸ºæ²¡æœ‰æ¶‰åŠåˆ°ç¼–è¯‘å™¨. å¯ä»¥ç®€å•åœ°å£°æ˜ <code>ref=&quot;someBean&quot;</code>,å¹¶ä¸”ç›¸ä¿¡Springå°†åœ¨å®¹å™¨åˆå§‹åŒ–æœŸé—´å¯ä»¥å¾ˆå¥½åœ°å¤„ç†å®ƒã€‚å½“ç„¶ï¼Œå½“ä½¿ç”¨<code>@Configuration</code>ç±»æ—¶ï¼ŒJavaç¼–è¯‘å™¨ä¼šæœ‰ä¸€äº›é™åˆ¶ ï¼Œå³éœ€ç¬¦åˆJavaçš„è¯­æ³•ã€‚</p><p>å¹¸è¿çš„æ˜¯ï¼Œè§£å†³è¿™ä¸ªé—®é¢˜å¾ˆç®€å•ã€‚æ­£å¦‚æˆ‘ä»¬<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-java-dependencies">å·²ç»è®¨è®ºè¿‡</a>çš„ï¼Œ<code>@Bean</code>æ–¹æ³•å¯ä»¥æœ‰ä»»æ„æ•°é‡çš„å‚æ•°æ¥æè¿°beançš„ä¾èµ–å…³ç³»ã€‚ è€ƒè™‘ä»¥ä¸‹æ›´å¤šçœŸå®åœºæ™¯ï¼Œå…¶ä¸­åŒ…å«å‡ ä¸ª <code>@Configuration</code>ç±»ï¼Œæ¯ä¸ªç±»éƒ½å–å†³äºå…¶ä»–ç±»ä¸­å£°æ˜çš„beanï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Configurationpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServiceConfig</span> &#123;<br>    <span class="hljs-meta">@Bean</span>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">TransferService</span> <span class="hljs-title function_">transferService</span>(<span class="hljs-params">AccountRepository accountRepository</span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransferServiceImpl</span>(accountRepository);    &#125;&#125;<br><span class="hljs-meta">@Configurationpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RepositoryConfig</span> &#123;<br>    <span class="hljs-meta">@Bean</span>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">AccountRepository</span> <span class="hljs-title function_">accountRepository</span>(<span class="hljs-params">DataSource dataSource</span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JdbcAccountRepository</span>(dataSource);    &#125;&#125;<br><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@Import</span>(&#123;<span class="hljs-title class_">ServiceConfig</span>.<span class="hljs-property">class</span>, <span class="hljs-title class_">RepositoryConfig</span>.<span class="hljs-property">class</span>&#125;)<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SystemTestConfig</span> &#123;<br>    <span class="hljs-meta">@Bean</span>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">DataSource</span> <span class="hljs-title function_">dataSource</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-comment">// return new DataSource    &#125;&#125;</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) &#123;    <span class="hljs-title class_">ApplicationContext</span> ctx = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotationConfigApplicationContext</span>(<span class="hljs-title class_">SystemTestConfig</span>.<span class="hljs-property">class</span>);    <span class="hljs-comment">// everything wires up across configuration classes...    TransferService transferService = ctx.getBean(TransferService.class);    transferService.transfer(100.00, &quot;A123&quot;, &quot;C456&quot;);&#125;</span><br></code></pre></td></tr></table></figure><p>è¿˜æœ‰å¦ä¸€ç§æ–¹æ³•å¯ä»¥è¾¾åˆ°ç›¸åŒçš„æ•ˆæœã€‚è¯·è®°ä½ï¼Œ<code>@Configuration</code>ç±»æœ€ç»ˆåªæ˜¯å®¹å™¨ä¸­çš„å¦ä¸€ä¸ªbeanï¼š è¿™æ„å‘³ç€å®ƒä»¬å¯ä»¥åˆ©ç”¨<code>@Autowired</code> å’Œ <code>@Value</code> æ³¨å…¥ä»¥åŠä¸ä»»ä½•å…¶ä»–beanç›¸åŒçš„å…¶ä»–åŠŸèƒ½ã€‚</p><p>ç¡®ä¿ä»¥è¿™ç§æ–¹å¼æ³¨å…¥çš„ä¾èµ–é¡¹åªæ˜¯æœ€ç®€å•çš„ã€‚<code>@Configuration</code>ç±»åœ¨ä¸Šä¸‹æ–‡åˆå§‹åŒ–æœŸé—´å¾ˆæ—©å°±è¢«å¤„ç†ï¼Œå¹¶ä¸”å¼ºåˆ¶ä»¥è¿™ç§æ–¹å¼æ³¨å…¥ä¾èµ–é¡¹å¯èƒ½ä¼šå¯¼è‡´æ„å¤–çš„æ—©æœŸåˆå§‹åŒ–ã€‚ å°½å¯èƒ½é‡‡ç”¨åŸºäºå‚æ•°çš„æ³¨å…¥ï¼Œå¦‚å‰é¢çš„ç¤ºä¾‹æ‰€ç¤ºã€‚</p><p>å¦å¤–ï¼Œè¦ç‰¹åˆ«æ³¨æ„é€šè¿‡<code>@Bean</code>çš„<code>BeanPostProcessor</code> å’Œ <code>BeanFactoryPostProcessor</code>å®šä¹‰ã€‚ è¿™äº›é€šå¸¸åº”è¯¥å£°æ˜ä¸ºé™æ€<code>@Bean</code>æ–¹æ³•ï¼Œè€Œä¸æ˜¯è§¦å‘å…¶åŒ…å«é…ç½®ç±»çš„å®ä¾‹åŒ–ã€‚å¦åˆ™ï¼Œ<code>@Autowired</code> å’Œ <code>@Value</code>ä¸èƒ½åœ¨é…ç½®ç±»æœ¬èº«ä¸Šå·¥ä½œï¼Œå› ä¸ºå®ƒè¿‡æ—©åœ°è¢«åˆ›å»ºä¸ºbeanå®ä¾‹ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•å°†ä¸€ä¸ªbeanè‡ªåŠ¨è¿æ¥åˆ°å¦ä¸€ä¸ªbean:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Configurationpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServiceConfig</span> &#123;<br>    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">AccountRepository</span> accountRepository;<br>    <span class="hljs-meta">@Bean</span>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">TransferService</span> <span class="hljs-title function_">transferService</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransferServiceImpl</span>(accountRepository);    &#125;&#125;<br><span class="hljs-meta">@Configurationpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RepositoryConfig</span> &#123;<br>    <span class="hljs-keyword">private</span> final <span class="hljs-title class_">DataSource</span> dataSource;<br>    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">RepositoryConfig</span>(<span class="hljs-title class_">DataSource</span> dataSource) &#123;        <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataSource</span> = dataSource;    &#125;<br>    <span class="hljs-meta">@Bean</span>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">AccountRepository</span> <span class="hljs-title function_">accountRepository</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JdbcAccountRepository</span>(dataSource);    &#125;&#125;<br><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@Import</span>(&#123;<span class="hljs-title class_">ServiceConfig</span>.<span class="hljs-property">class</span>, <span class="hljs-title class_">RepositoryConfig</span>.<span class="hljs-property">class</span>&#125;)<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SystemTestConfig</span> &#123;<br>    <span class="hljs-meta">@Bean</span>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">DataSource</span> <span class="hljs-title function_">dataSource</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-comment">// return new DataSource    &#125;&#125;</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) &#123;    <span class="hljs-title class_">ApplicationContext</span> ctx = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotationConfigApplicationContext</span>(<span class="hljs-title class_">SystemTestConfig</span>.<span class="hljs-property">class</span>);    <span class="hljs-comment">// everything wires up across configuration classes...    TransferService transferService = ctx.getBean(TransferService.class);    transferService.transfer(100.00, &quot;A123&quot;, &quot;C456&quot;);&#125;</span><br></code></pre></td></tr></table></figure><p>ä»…åœ¨Spring Framework 4.3ä¸­æ”¯æŒ<code>@Configuration</code>ç±»ä¸­çš„æ„é€ å‡½æ•°æ³¨å…¥ã€‚ å¦è¯·æ³¨æ„ï¼Œå¦‚æœç›®æ ‡beanä»…å®šä¹‰äº†ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œåˆ™æ— éœ€æŒ‡å®š<code>@Autowired</code>ã€‚ åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œ<code>RepositoryConfig</code>æ„é€ å‡½æ•°ä¸­ä¸éœ€è¦<code>@Autowired</code>ã€‚</p><p>å®Œå…¨å¯¼å…¥beanä¾¿äºæŸ¥æ‰¾</p><p>åœ¨ä¸Šé¢çš„åœºæ™¯ä¸­,<code>@Autowired</code>å¯ä»¥å¾ˆå¥½çš„å·¥ä½œ,ä½¿è®¾è®¡æ›´å…·æ¨¡å—åŒ–,ä½†æ˜¯è‡ªåŠ¨æ³¨å…¥å“ªä¸ªbeanä¾ç„¶æœ‰äº›æ¨¡ç³Šä¸æ¸….ä¾‹å¦‚, ä½œä¸ºä¸€ä¸ªå¼€å‘è€…æŸ¥çœ‹<code>ServiceConfig</code>ç±»æ—¶,ä½ æ€ä¹ˆçŸ¥é“<code>@Autowired AccountRepository</code>åœ¨å“ªå®šä¹‰çš„å‘¢?ä»£ç ä¸­å¹¶æœªæ˜ç¡®æŒ‡å‡º, è¿˜å¥½, <a href="https://spring.io/tools/sts">Spring Tool Suite</a>æä¾›çš„å·¥å…·å¯ä»¥å‘ˆç°å›¾è¡¨ï¼Œæ˜¾ç¤ºæ‰€æœ‰å†…å®¹çš„è¿çº¿æ–¹å¼ï¼Œè¿™å¯èƒ½å°±æ˜¯æ‚¨æ‰€éœ€è¦çš„ã€‚ æ­¤å¤–ï¼Œæ‚¨çš„Java IDEå¯ä»¥è½»æ¾æ‰¾åˆ°<code>AccountRepository</code>ç±»å‹çš„æ‰€æœ‰å£°æ˜å’Œç”¨æ³•ï¼Œå¹¶å¿«é€Ÿæ˜¾ç¤ºè¿”å›è¯¥ç±»å‹çš„<code>@Bean</code>æ–¹æ³•çš„ä½ç½®ã€‚</p><p>ä¸‡ä¸€éœ€æ±‚ä¸å…è®¸è¿™ç§æ¨¡ç³Šçš„è£…é…,å¹¶ä¸”æ‚¨å¸Œæœ›ä»IDEä¸­ä»ä¸€ä¸ª<code>@Configuration</code>ç±»ç›´æ¥å¯¼èˆªåˆ°å¦ä¸€ä¸ª<code>@Configuration</code>ç±»ï¼Œè¯·è€ƒè™‘è‡ªåŠ¨è£…é…é…ç½®ç±»æœ¬èº«ã€‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œï¼š</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-variable">@Configurationpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServiceConfig</span> &#123;<br>    <span class="hljs-variable">@Autowired</span>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">RepositoryConfig</span> repositoryConfig;<br>    <span class="hljs-variable">@Bean</span>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">TransferService</span> transferService() &#123;        <span class="hljs-regexp">//</span> navigate <span class="hljs-string">&#x27;through&#x27;</span> the config <span class="hljs-keyword">class</span> to the <span class="hljs-variable">@Bean</span> method!        <span class="hljs-keyword">return</span> new <span class="hljs-title class_">TransferServiceImpl</span>(repositoryConfig.accountRepository());    &#125;&#125;<br></code></pre></td></tr></table></figure><p>åœ¨å‰é¢çš„æƒ…å†µä¸­ï¼Œå®šä¹‰<code>AccountRepository</code> æ˜¯å®Œå…¨æ˜ç¡®çš„ã€‚ä½†æ˜¯ï¼Œ<code>ServiceConfig</code>ç°åœ¨ä¸<code>RepositoryConfig</code>ç´§å¯†è€¦åˆã€‚è¿™æ˜¯ä¸€ç§æƒè¡¡çš„æ–¹æ³•ã€‚ é€šè¿‡ä½¿ç”¨åŸºäºæ¥å£çš„æˆ–åŸºäºç±»çš„æŠ½è±¡<code>@Configuration</code> ç±»ï¼Œå¯ä»¥åœ¨æŸç§ç¨‹åº¦ä¸Šå‡è½»è¿™ç§ç´§å¯†è€¦åˆã€‚è¯·è€ƒè™‘ä»¥ä¸‹ç¤ºä¾‹ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Configurationpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServiceConfig</span> &#123;<br>    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">RepositoryConfig</span> repositoryConfig;<br>    <span class="hljs-meta">@Bean</span>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">TransferService</span> <span class="hljs-title function_">transferService</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransferServiceImpl</span>(repositoryConfig.<span class="hljs-title function_">accountRepository</span>());    &#125;&#125;<br><span class="hljs-meta">@Configurationpublic</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">RepositoryConfig</span> &#123;<br>    <span class="hljs-meta">@Bean</span>    <span class="hljs-title class_">AccountRepository</span> <span class="hljs-title function_">accountRepository</span>();&#125;<br><span class="hljs-meta">@Configurationpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultRepositoryConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">RepositoryConfig</span> &#123;<br>    <span class="hljs-meta">@Bean</span>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">AccountRepository</span> <span class="hljs-title function_">accountRepository</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JdbcAccountRepository</span>(...);    &#125;&#125;<br><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@Import</span>(&#123;<span class="hljs-title class_">ServiceConfig</span>.<span class="hljs-property">class</span>, <span class="hljs-title class_">DefaultRepositoryConfig</span>.<span class="hljs-property">class</span>&#125;)  <span class="hljs-comment">// import the concrete config!public class SystemTestConfig &#123;</span><br>    <span class="hljs-meta">@Bean</span>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">DataSource</span> <span class="hljs-title function_">dataSource</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-comment">// return DataSource    &#125;</span><br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) &#123;    <span class="hljs-title class_">ApplicationContext</span> ctx = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotationConfigApplicationContext</span>(<span class="hljs-title class_">SystemTestConfig</span>.<span class="hljs-property">class</span>);    <span class="hljs-title class_">TransferService</span> transferService = ctx.<span class="hljs-title function_">getBean</span>(<span class="hljs-title class_">TransferService</span>.<span class="hljs-property">class</span>);    transferService.<span class="hljs-title function_">transfer</span>(<span class="hljs-number">100.00</span>, <span class="hljs-string">&quot;A123&quot;</span>, <span class="hljs-string">&quot;C456&quot;</span>);&#125;<br></code></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œ<code>ServiceConfig</code>ä¸å…·ä½“çš„<code>DefaultRepositoryConfig</code>æ¾æ•£è€¦åˆï¼Œå†…ç½®çš„IDEå·¥å…·ä»ç„¶å¾ˆæœ‰ç”¨ï¼šæ‚¨å¯ä»¥å¾ˆå®¹æ˜“è·å–<code>RepositoryConfig</code>å®ç°ç±»çš„ç»§æ‰¿ä½“ç³»ã€‚ ä»¥è¿™ç§æ–¹å¼,æ“ä½œ<code>@Configuration</code>ç±»åŠå…¶ä¾èµ–å…³ç³»ä¸æ“ä½œåŸºäºæ¥å£çš„ä»£ç çš„è¿‡ç¨‹æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«</p><p>å¦‚æœè¦å½±å“æŸäº›beançš„å¯åŠ¨åˆ›å»ºé¡ºåºï¼Œå¯ä»¥è€ƒè™‘å°†å…¶ä¸­ä¸€äº›å£°æ˜ä¸º<code>@Lazy</code> ï¼ˆç”¨äºåœ¨é¦–æ¬¡è®¿é—®æ—¶åˆ›å»ºè€Œä¸æ˜¯åœ¨å¯åŠ¨æ—¶ï¼‰æˆ–<code>@DependsOn</code>æŸäº›å…¶ä»–beanï¼ˆç¡®ä¿åœ¨åˆ›å»ºä¹‹å‰åˆ›å»ºç‰¹å®šçš„å…¶ä»–beanï¼ˆå½“å‰çš„beanï¼Œè¶…å‡ºåè€…çš„ç›´æ¥ä¾èµ–æ€§æ‰€æš—ç¤ºçš„ï¼‰ï¼‰ã€‚</p><h5 id="æœ‰æ¡ä»¶åœ°åŒ…å«-Configurationç±»æˆ–-Beanæ–¹æ³•"><a href="#æœ‰æ¡ä»¶åœ°åŒ…å«-Configurationç±»æˆ–-Beanæ–¹æ³•" class="headerlink" title="æœ‰æ¡ä»¶åœ°åŒ…å«@Configurationç±»æˆ–@Beanæ–¹æ³•"></a>æœ‰æ¡ä»¶åœ°åŒ…å«<code>@Configuration</code>ç±»æˆ–<code>@Bean</code>æ–¹æ³•</h5><p>åŸºäºæŸäº›ä»»æ„ç³»ç»ŸçŠ¶æ€ï¼Œæœ‰æ¡ä»¶åœ°å¯ç”¨æˆ–ç¦ç”¨å®Œæ•´çš„<code>@Configuration</code>ç±»ç”šè‡³å•ç‹¬çš„ <code>@Bean</code> æ–¹æ³•é€šå¸¸å¾ˆæœ‰ç”¨ã€‚ ä¸€ä¸ªå¸¸è§çš„ä¾‹å­æ˜¯ï¼Œ åªæœ‰åœ¨Springç¯å¢ƒä¸­å¯ç”¨äº†ç‰¹å®šçš„é…ç½®æ–‡ä»¶æ—¶æ‰ä½¿ç”¨<code>@Profile</code> æ³¨è§£æ¥æ¿€æ´»beanï¼ˆæœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…Bean<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-definition-profiles">å®šä¹‰é…ç½®æ–‡ä»¶</a>ï¼‰ã€‚</p><p><code>@Profile</code>æ³¨è§£å®é™…ä¸Šæ˜¯é€šè¿‡ä½¿ç”¨æ›´çµæ´»çš„æ³¨è§£<code>@Conditional</code>å®ç°çš„ã€‚<a href="https://docs.spring.io/spring-framework/docs/5.1.3.BUILD-SNAPSHOT/javadoc-api/org/springframework/context/annotation/Conditional.html"><code>@Conditional</code></a>æ³¨è§£è¡¨ç¤ºç‰¹å®šçš„<code>org.springframework.context.annotation.Condition</code>å®ç°ã€‚ å®ƒè¡¨æ˜<code>@Bean</code>è¢«æ³¨å†Œä¹‹å‰ä¼šå…ˆâ€è¯¢é—®â€<code>@Conditional</code>æ³¨è§£ã€‚</p><p><code>Condition</code>æ¥å£çš„å®ç°æä¾›äº†ä¸€ä¸ªè¿”å›<code>true</code> æˆ– <code>false</code>çš„<code>matches(â€¦)</code>æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹æ¸…å•æ˜¾ç¤ºäº†ç”¨äº <code>@Profile</code>çš„å®é™…<code>Condition</code>å®ç°ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Override</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">matches</span>(<span class="hljs-params">ConditionContext context, AnnotatedTypeMetadata metadata</span>) &#123;<br><br>    <span class="hljs-keyword">if</span> (context.<span class="hljs-title function_">getEnvironment</span>() != <span class="hljs-literal">null</span>) &#123;<br><br>        <span class="hljs-comment">// Read the @Profile annotation attributes</span><br><br>        <span class="hljs-title class_">MultiValueMap</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt; attrs = metadata.<span class="hljs-title function_">getAllAnnotationAttributes</span>(<span class="hljs-title class_">Profile</span>.<span class="hljs-property">class</span>.<span class="hljs-title function_">getName</span>());<br><br>        <span class="hljs-keyword">if</span> (attrs != <span class="hljs-literal">null</span>) &#123;<br><br>            <span class="hljs-keyword">for</span> (<span class="hljs-title class_">Object</span> value : attrs.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;value&quot;</span>)) &#123;<br><br>                <span class="hljs-keyword">if</span> (context.<span class="hljs-title function_">getEnvironment</span>().<span class="hljs-title function_">acceptsProfiles</span>(((<span class="hljs-title class_">String</span>[]) value))) &#123;<br><br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br><br>                &#125;<br><br>            &#125;<br><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br><br>        &#125;<br><br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://docs.spring.io/spring-framework/docs/5.1.3.BUILD-SNAPSHOT/javadoc-api/org/springframework/context/annotation/Conditional.html"><code>@Conditional</code></a>javadocã€‚</p><h5 id="ç»“åˆJavaå’ŒXMLé…ç½®"><a href="#ç»“åˆJavaå’ŒXMLé…ç½®" class="headerlink" title="ç»“åˆJavaå’ŒXMLé…ç½®"></a>ç»“åˆJavaå’ŒXMLé…ç½®</h5><p>Springçš„<code>@Configuration</code>ç±»æ”¯æŒä½†ä¸ä¸€å®šæˆä¸ºSpring XMLçš„100ï¼…å®Œå…¨æ›¿ä»£å“ã€‚ æŸäº›å·¥å…·ï¼ˆå¦‚Spring XMLå‘½åç©ºé—´ï¼‰ä»ç„¶æ˜¯é…ç½®å®¹å™¨çš„ç†æƒ³æ–¹æ³•ã€‚åœ¨XMLæ–¹ä¾¿æˆ–å¿…è¦çš„æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥é€‰æ‹©ï¼šé€šè¿‡ä½¿ç”¨ä¾‹å¦‚<code>ClassPathXmlApplicationContext</code>ä»¥â€œä»¥XMLä¸ºä¸­å¿ƒâ€çš„æ–¹å¼å®ä¾‹åŒ–å®¹å™¨ï¼Œ æˆ–è€…é€šè¿‡ä½¿ç”¨<code>AnnotationConfigApplicationContext</code>ä»¥â€œä»¥Javaä¸ºä¸­å¿ƒâ€çš„æ–¹å¼å®ä¾‹åŒ–å®ƒã€‚<code>@ImportResource</code>æ³¨è§£ï¼Œæ ¹æ®éœ€è¦å¯¼å…¥XMLã€‚</p><h6 id="ä»¥XMLä¸ºä¸­å¿ƒä½¿ç”¨-Configurationç±»"><a href="#ä»¥XMLä¸ºä¸­å¿ƒä½¿ç”¨-Configurationç±»" class="headerlink" title="ä»¥XMLä¸ºä¸­å¿ƒä½¿ç”¨@Configurationç±»"></a>ä»¥XMLä¸ºä¸­å¿ƒä½¿ç”¨<code>@Configuration</code>ç±»</h6><p>æ›´å—äººå–œçˆ±çš„æ–¹æ³•æ˜¯ä»åŒ…å«<code>@Configuration</code>ç±»çš„XMLå¯åŠ¨å®¹å™¨.ä¾‹å¦‚ï¼Œåœ¨ä½¿ç”¨Springçš„ç°æœ‰ç³»ç»Ÿä¸­,å¤§é‡ä½¿ç”¨çš„æ˜¯Spring XMLé…ç½®,æ‰€ä»¥å¾ˆå®¹æ˜“æ ¹æ®éœ€è¦åˆ›å»º<code>@Configuration</code>ç±» ,å¹¶å°†ä»–ä»¬åˆ°åŒ…å«XMLæ–‡ä»¶ä¸­ã€‚æˆ‘ä»¬å°†ä»‹ç»åœ¨è¿™ç§â€œä»¥XMLä¸ºä¸­å¿ƒâ€çš„æƒ…å†µä¸‹ä½¿ç”¨<code>@Configuration</code>ç±»çš„é€‰é¡¹ã€‚</p><p>å°†<code>@Configuration</code>ç±»å£°æ˜ä¸ºæ™®é€šçš„Spring<code>&lt;bean/&gt;</code> å…ƒç´ </p><p>è¯·è®°ä½,<code>@Configuration</code>ç±»æœ€ç»ˆä¹Ÿåªæ˜¯å®¹å™¨ä¸­çš„beanå®šä¹‰ã€‚åœ¨æœ¬ç³»åˆ—ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸ºAppConfigçš„<code>@Configuration</code>ç±»ï¼Œå¹¶å°†å…¶ä½œä¸º<code>&lt;bean/&gt;</code>å®šä¹‰åŒ…å«åœ¨<code>system-test-config.xml</code>ä¸­ã€‚ ç”±äº <code>&lt;context:annotation-config/&gt;</code>å·²æ‰“å¼€ï¼Œå®¹å™¨ä¼šè¯†åˆ«<code>@Configuration</code> æ³¨è§£å¹¶æ­£ç¡®å¤„ç†<code>AppConfig</code>ä¸­å£°æ˜çš„<code>@Bean</code> æ–¹æ³•ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†Javaä¸­çš„æ™®é€šé…ç½®ç±»:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Configurationpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> &#123;<br>    <span class="hljs-meta">@Autowired</span>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">DataSource</span> dataSource;<br>    <span class="hljs-meta">@Bean</span>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">AccountRepository</span> <span class="hljs-title function_">accountRepository</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JdbcAccountRepository</span>(dataSource);    &#125;<br>    <span class="hljs-meta">@Bean</span>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">TransferService</span> <span class="hljs-title function_">transferService</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransferService</span>(<span class="hljs-title function_">accountRepository</span>());    &#125;&#125;<br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†ç¤ºä¾‹<code>system-test-config.xml</code>æ–‡ä»¶çš„ä¸€éƒ¨åˆ†ï¼š</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span>&gt;</span>    <span class="hljs-comment">&lt;!-- enable processing of annotations such as @Autowired and @Configuration --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">context:annotation-config</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">context:property-placeholder</span> <span class="hljs-attr">location</span>=<span class="hljs-string">&quot;classpath:/com/acme/jdbc.properties&quot;</span>/&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.acme.AppConfig&quot;</span>/&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;jdbc.url&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;jdbc.username&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;jdbc.password&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¯èƒ½çš„<code>jdbc.properties</code>æ–‡ä»¶:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java">jdbc.url=jdbc:hsqldb:hsql:<span class="hljs-comment">//localhost/xdb</span><br><br>jdbc.username=sa<br><br>jdbc.password=<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>    <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">ctx</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathXmlApplicationContext</span>(<span class="hljs-string">&quot;classpath:/com/acme/system-test-config.xml&quot;</span>);<br><br>    <span class="hljs-type">TransferService</span> <span class="hljs-variable">transferService</span> <span class="hljs-operator">=</span> ctx.getBean(TransferService.class);<br><br>    <span class="hljs-comment">// ...</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ <code>system-test-config.xml</code>æ–‡ä»¶ä¸­ï¼Œ <code>AppConfig</code> <code>&lt;bean/&gt;</code>ä¸å£°æ˜<code>id</code>å…ƒç´ ã€‚è™½ç„¶è¿™æ ·åšæ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯æ²¡æœ‰å¿…è¦ï¼Œå› ä¸ºæ²¡æœ‰å…¶ä»–beanå¼•ç”¨å®ƒï¼Œå¹¶ä¸”ä¸å¤ªå¯èƒ½é€šè¿‡åç§°ä»å®¹å™¨ä¸­æ˜ç¡®åœ°è·å–å®ƒã€‚ ç±»ä¼¼åœ°ï¼Œ<code>DataSource</code> beanåªæ˜¯æŒ‰ç±»å‹è‡ªåŠ¨è£…é…ï¼Œå› æ­¤ä¸ä¸¥æ ¼è¦æ±‚æ˜¾å¼çš„bean<code>id</code>ã€‚</p><p>ä½¿ç”¨<a href="context:component-scan/">context:component-scan&#x2F;</a> æ¥è·å–<code>@Configuration</code> ç±»</p><p>å› ä¸º<code>@Configuration</code>æ˜¯<code>@Component</code>æ³¨è§£çš„å…ƒæ³¨è§£,æ‰€ä»¥<code>@Configuration</code>æ³¨è§£çš„ç±»ä¹Ÿå¯ä»¥è¢«è‡ªåŠ¨æ‰«æã€‚ä½¿ç”¨ä¸ä¸Šé¢ç›¸åŒçš„åœºæ™¯ï¼Œå¯ä»¥é‡æ–°å®šä¹‰<code>system-test-config.xml</code> ä»¥ä½¿ç”¨ç»„ä»¶æ‰«æã€‚ è¯·æ³¨æ„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ˜¾å¼å£°æ˜ <code>&lt;context:annotation-config/&gt;</code>,ï¼Œå› ä¸º<code>&lt;context:component-scan/&gt;</code> å¯ç”¨ç›¸åŒçš„åŠŸèƒ½ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å·²ä¿®æ”¹çš„<code>system-test-config.xml</code>æ–‡ä»¶:</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span>&gt;</span>    <span class="hljs-comment">&lt;!-- picks up and registers AppConfig as a bean definition --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">&quot;com.acme&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">context:property-placeholder</span> <span class="hljs-attr">location</span>=<span class="hljs-string">&quot;classpath:/com/acme/jdbc.properties&quot;</span>/&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;jdbc.url&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;jdbc.username&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;jdbc.password&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></span><br></code></pre></td></tr></table></figure><h6 id="åŸºäº-Configurationæ··åˆXMLçš„-ImportResource"><a href="#åŸºäº-Configurationæ··åˆXMLçš„-ImportResource" class="headerlink" title="åŸºäº@Configurationæ··åˆXMLçš„@ImportResource"></a>åŸºäº<code>@Configuration</code>æ··åˆXMLçš„<code>@ImportResource</code></h6><p>åœ¨ <code>@Configuration</code>ç±»ä¸ºé…ç½®å®¹å™¨çš„ä¸»è¦æ–¹å¼çš„åº”ç”¨ç¨‹åºä¸­,ä¹Ÿéœ€è¦ä½¿ç”¨ä¸€äº›XMLé…ç½®ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹,åªéœ€ä½¿ç”¨<code>@ImportResource</code> ,å¹¶åªå®šä¹‰æ‰€éœ€çš„XMLã€‚è¿™æ ·åšå¯ä»¥å®ç°â€œä»¥Javaä¸ºä¸­å¿ƒâ€çš„æ–¹æ³•æ¥é…ç½®å®¹å™¨å¹¶å°½å¯èƒ½å°‘çš„ä½¿ç”¨XMLã€‚ ä»¥ä¸‹ç¤ºä¾‹ï¼ˆåŒ…æ‹¬é…ç½®ç±»ï¼Œå®šä¹‰beançš„XMLæ–‡ä»¶ï¼Œå±æ€§æ–‡ä»¶å’Œä¸»ç±»ï¼‰æ˜¾ç¤ºäº†å¦‚ä½•ä½¿ç”¨<code>@ImportResource</code> æ³¨è§£æ¥å®ç°æ ¹æ®éœ€è¦ä½¿ç”¨XMLçš„â€œä»¥Javaä¸ºä¸­å¿ƒâ€çš„é…ç½®ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@ImportResource</span>(<span class="hljs-string">&quot;classpath:/com/acme/properties-config.xml&quot;</span>)<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> &#123;<br>    <span class="hljs-meta">@Value</span>(<span class="hljs-string">&quot;$&#123;jdbc.url&#125;&quot;</span>)    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> url;<br>    <span class="hljs-meta">@Value</span>(<span class="hljs-string">&quot;$&#123;jdbc.username&#125;&quot;</span>)    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> username;<br>    <span class="hljs-meta">@Value</span>(<span class="hljs-string">&quot;$&#123;jdbc.password&#125;&quot;</span>)    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> password;<br>    <span class="hljs-meta">@Bean</span>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">DataSource</span> <span class="hljs-title function_">dataSource</span>(<span class="hljs-params"></span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DriverManagerDataSource</span>(url, username, password);    &#125;&#125;<br>properties-config.<span class="hljs-property">xml</span>&lt;beans&gt;    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">context:property-placeholder</span> <span class="hljs-attr">location</span>=<span class="hljs-string">&quot;classpath:/com/acme/jdbc.properties&quot;</span>/&gt;</span></span>&lt;/beans&gt;<br>jdbc.<span class="hljs-property">properties</span><br><br>jdbc.<span class="hljs-property">url</span>=<span class="hljs-attr">jdbc</span>:<span class="hljs-attr">hsqldb</span>:<span class="hljs-attr">hsql</span>:<span class="hljs-comment">//localhost/xdb</span><br><br>jdbc.<span class="hljs-property">username</span>=sa<br><br>jdbc.<span class="hljs-property">password</span>=<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) &#123;<br><br>    <span class="hljs-title class_">ApplicationContext</span> ctx = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotationConfigApplicationContext</span>(<span class="hljs-title class_">AppConfig</span>.<span class="hljs-property">class</span>);<br><br>    <span class="hljs-title class_">TransferService</span> transferService = ctx.<span class="hljs-title function_">getBean</span>(<span class="hljs-title class_">TransferService</span>.<span class="hljs-property">class</span>);<br><br>    <span class="hljs-comment">// ...</span><br><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="1-13-æŠ½è±¡ç¯å¢ƒ"><a href="#1-13-æŠ½è±¡ç¯å¢ƒ" class="headerlink" title="1.13. æŠ½è±¡ç¯å¢ƒ"></a>1.13. æŠ½è±¡ç¯å¢ƒ</h3><p><a href="https://docs.spring.io/spring-framework/docs/5.1.3.BUILD-SNAPSHOT/javadoc-api/org/springframework/core/env/Environment.html"><code>Environment</code></a>æ¥å£æ˜¯é›†æˆåœ¨å®¹å™¨ä¸­çš„æŠ½è±¡ï¼Œå®ƒæ¨¡æ‹Ÿäº†åº”ç”¨ç¨‹åºç¯å¢ƒçš„ä¸¤ä¸ªå…³é”®æ–¹é¢ï¼š<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-definition-profiles">profiles</a> å’Œ <a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-property-source-abstraction">properties</a>ã€‚</p><p>profileé…ç½®æ˜¯ä¸€ä¸ªè¢«å‘½åçš„,beanå®šä¹‰çš„é€»è¾‘ç»„,è¿™äº›beanåªæœ‰åœ¨ç»™å®šçš„profileé…ç½®æ¿€æ´»æ—¶æ‰ä¼šæ³¨å†Œåˆ°å®¹å™¨.æ— è®ºæ˜¯ä»¥XMLè¿˜æ˜¯é€šè¿‡æ³¨è§£å®šä¹‰,Beanéƒ½å¯ä»¥åˆ†é…ç»™é…ç½®æ–‡ä»¶ ã€‚<code>Environment</code>å¯¹è±¡åœ¨profileä¸­çš„è§’è‰²æ˜¯åˆ¤æ–­å“ªä¸€ä¸ªprofileåº”è¯¥åœ¨å½“å‰æ¿€æ´»å’Œå“ªä¸€ä¸ªprofileåº”è¯¥åœ¨é»˜è®¤æƒ…å†µä¸‹æ¿€æ´»ã€‚</p><p>å±æ€§åœ¨å‡ ä¹æ‰€æœ‰åº”ç”¨ç¨‹åºä¸­éƒ½å‘æŒ¥ç€é‡è¦ä½œç”¨ï¼Œå¯èƒ½æºè‡ªå„ç§æºï¼šå±æ€§æ–‡ä»¶ï¼ŒJVMç³»ç»Ÿå±æ€§ï¼Œç³»ç»Ÿç¯å¢ƒå˜é‡ï¼ŒJNDIï¼Œservletä¸Šä¸‹æ–‡å‚æ•°ï¼Œad-hocå±æ€§å¯¹è±¡ï¼ŒMapå¯¹è±¡ç­‰ã€‚ ä¸å±æ€§ç›¸å…³çš„<code>Environment</code>å¯¹è±¡çš„ä½œç”¨æ˜¯ä¸ºç”¨æˆ·æä¾›æ–¹ä¾¿çš„æœåŠ¡æ¥å£ï¼Œç”¨äºé…ç½®å±æ€§æºå’Œä»ä¸­è§£æå±æ€§ã€‚</p><h4 id="1-13-1-Beanå®šä¹‰Profiles"><a href="#1-13-1-Beanå®šä¹‰Profiles" class="headerlink" title="1.13.1. Beanå®šä¹‰Profiles"></a>1.13.1. Beanå®šä¹‰Profiles</h4><p>beanå®šä¹‰profilesæ˜¯æ ¸å¿ƒå®¹å™¨å†…çš„ä¸€ç§æœºåˆ¶ï¼Œè¯¥æœºåˆ¶èƒ½åœ¨ä¸åŒç¯å¢ƒä¸­æ³¨å†Œä¸åŒçš„beanã€‚â€œç¯å¢ƒâ€è¿™ä¸ªè¯å¯¹ä¸åŒçš„ç”¨æˆ·æ¥è¯´æ„å‘³ç€ä¸åŒçš„ä¸œè¥¿ï¼Œè¿™ä¸ªåŠŸèƒ½å¯ä»¥å¸®åŠ©è§£å†³è®¸å¤šç”¨ä¾‹ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>åœ¨QAæˆ–ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œé’ˆå¯¹å¼€å‘ä¸­çš„å†…å­˜æ•°æ®æºè€Œä¸æ˜¯ä»JNDIæŸ¥æ‰¾ç›¸åŒçš„æ•°æ®æºã€‚</li><li>å¼€å‘æœŸä½¿ç”¨ç›‘æ§ç»„ä»¶ï¼Œå½“éƒ¨ç½²ä»¥ååˆ™å…³é—­ç›‘æ§ç»„ä»¶ï¼Œä½¿åº”ç”¨æ›´é«˜æ•ˆ</li><li>ä¸ºç”¨æˆ·å„è‡ªæ³¨å†Œè‡ªå®šä¹‰beanå®ç°</li></ul><p>è€ƒè™‘<code>DataSource</code>çš„å®é™…åº”ç”¨ç¨‹åºä¸­çš„ç¬¬ä¸€ä¸ªç”¨ä¾‹ã€‚ åœ¨æµ‹è¯•ç¯å¢ƒä¸­ï¼Œé…ç½®å¯èƒ½ç±»ä¼¼äºä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-keyword">@Bean</span><br><br>public DataSource dataSource() &#123;<br><br>    return new <span class="hljs-built_in">EmbeddedDatabaseBuilder</span>()<br><br>        <span class="hljs-selector-class">.setType</span>(EmbeddedDatabaseType.HSQL)<br><br>        <span class="hljs-selector-class">.addScript</span>(&quot;my-schema.sql&quot;)<br><br>        <span class="hljs-selector-class">.addScript</span>(&quot;my-test-data.sql&quot;)<br><br>        <span class="hljs-selector-class">.build</span>();<br><br>&#125;<br></code></pre></td></tr></table></figure><p>ç°åœ¨è€ƒè™‘å¦‚ä½•å°†æ­¤åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°QAæˆ–ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå‡è®¾åº”ç”¨ç¨‹åºçš„æ•°æ®æºå·²æ³¨å†Œåˆ°ç”Ÿäº§åº”ç”¨ç¨‹åºæœåŠ¡å™¨çš„JNDIç›®å½•ã€‚ æˆ‘ä»¬çš„<code>dataSource</code> beanç°åœ¨çœ‹èµ·æ¥å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean(destroyMethod=&quot;&quot;)</span><br><br><span class="hljs-keyword">public</span> DataSource <span class="hljs-title function_">dataSource</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>    <span class="hljs-type">Context</span> <span class="hljs-variable">ctx</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InitialContext</span>();<br><br>    <span class="hljs-keyword">return</span> (DataSource) ctx.lookup(<span class="hljs-string">&quot;java:comp/env/jdbc/datasource&quot;</span>);<br><br>&#125;<br></code></pre></td></tr></table></figure><p>é—®é¢˜æ˜¯å¦‚ä½•æ ¹æ®å½“å‰ç¯å¢ƒåœ¨ä½¿ç”¨è¿™ä¸¤ç§å˜ä½“ä¹‹é—´åˆ‡æ¢ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼ŒSpring ç”¨æˆ·å·²ç»è®¾è®¡äº†è®¸å¤šæ–¹æ³•æ¥å®Œæˆè¿™é¡¹å·¥ä½œï¼Œé€šå¸¸ä¾èµ–äºç³»ç»Ÿç¯å¢ƒå˜é‡å’ŒåŒ…å«<code>$&#123;placeholder&#125;</code>æ ‡è®°çš„XML<code>&lt;import/&gt;</code>è¯­å¥çš„ç»„åˆï¼Œ è¿™äº›æ ‡è®°æ ¹æ®å€¼è§£æä¸ºæ­£ç¡®çš„é…ç½®æ–‡ä»¶è·¯å¾„ä¸€ä¸ªç¯å¢ƒå˜é‡ã€‚ Bean å®šä¹‰ profiles æ˜¯æ ¸å¿ƒå®¹å™¨åŠŸèƒ½ï¼Œå¯ä¸ºæ­¤é—®é¢˜æä¾›è§£å†³æ–¹æ¡ˆã€‚</p><p>æ¦‚æ‹¬ä¸€ä¸‹ä¸Šé¢çš„åœºæ™¯ï¼Œç¯å¢ƒå†³å®šbeanå®šä¹‰,æœ€åå‘ç°,æˆ‘ä»¬éœ€è¦åœ¨æŸäº›ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­ä½¿ç”¨æŸäº›bean,åœ¨å…¶ä»–ç¯å¢ƒä¸­åˆ™ä¸ç”¨è¿™äº›bean.æˆ–è€…è¯´, åœ¨åœºæ™¯Aä¸­æ³¨å†Œä¸€ç»„beanå®šä¹‰,è€Œåœ¨åœºæ™¯Bä¸­æ³¨å†Œå¦å¤–ä¸€ç»„ã€‚å…ˆçœ‹çœ‹å¦‚ä½•é€šè¿‡ä¿®æ”¹é…ç½®æ¥å®Œæˆæ­¤éœ€æ±‚ï¼š</p><h5 id="ä½¿ç”¨-Profile"><a href="#ä½¿ç”¨-Profile" class="headerlink" title="ä½¿ç”¨ @Profile"></a>ä½¿ç”¨ <code>@Profile</code></h5><p><a href="https://docs.spring.io/spring-framework/docs/5.1.3.BUILD-SNAPSHOT/javadoc-api/org/springframework/context/annotation/Profile.html"><code>@Profile</code></a>æ³¨è§£ç”¨äºå½“ä¸€ä¸ªæˆ–å¤šä¸ªé…ç½®æ–‡ä»¶æ¿€æ´»çš„æ—¶å€™,ç”¨æ¥æŒ‡å®šç»„ä»¶æ˜¯å¦æœ‰èµ„æ ¼æ³¨å†Œã€‚ä½¿ç”¨å‰é¢çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥é‡å†™<code>dataSource</code>é…ç½®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@Profile(<span class="hljs-string">&quot;development&quot;</span>)</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StandaloneDataConfig</span> &#123;<br>    <span class="hljs-meta">@Bean</span>    <span class="hljs-keyword">public</span> DataSource dataSource() &#123;        <span class="hljs-keyword">return</span> new EmbeddedDatabaseBuilder()            .setType(EmbeddedDatabaseType.HSQL)            .addScript(<span class="hljs-string">&quot;classpath:com/bank/config/sql/schema.sql&quot;</span>)            .addScript(<span class="hljs-string">&quot;classpath:com/bank/config/sql/test-data.sql&quot;</span>)            .build();    &#125;&#125;<br><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@Profile(<span class="hljs-string">&quot;production&quot;</span>)</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JndiDataConfig</span> &#123;<br>    <span class="hljs-meta">@Bean(destroyMethod=<span class="hljs-string">&quot;&quot;</span>)</span>    <span class="hljs-keyword">public</span> DataSource dataSource() throws Exception &#123;        Context ctx = new InitialContext();        <span class="hljs-keyword">return</span> (DataSource) ctx.lookup(<span class="hljs-string">&quot;java:comp/env/jdbc/datasource&quot;</span>);    &#125;&#125;<br></code></pre></td></tr></table></figure><p>å¦‚å‰æ‰€è¿°ï¼Œä½¿ç”¨<code>@Bean</code>æ–¹æ³•ï¼Œæ‚¨é€šå¸¸é€‰æ‹©ä½¿ç”¨Springçš„<code>JndiTemplate</code>&#x2F;<code>JndiLocatorDelegate</code>å¸®åŠ©ç¨‹åºæˆ–å‰é¢æ˜¾ç¤ºçš„ ç›´æ¥JNDI <code>InitialContext</code>ç”¨æ³•ä½†ä¸ä½¿ç”¨<code>JndiObjectFactoryBean</code>å˜é‡æ¥ä½¿ç”¨ç¼–ç¨‹JNDIæŸ¥æ‰¾ï¼Œè¿™ä¼šå¼ºåˆ¶æ‚¨å°†è¿”å›ç±»å‹å£°æ˜ä¸º <code>FactoryBean</code>ç±»å‹ã€‚ As mentioned earlier, with <code>@Bean</code> methods, you typically choose to use programmatic JNDI lookups, by using either Springâ€™s <code>JndiTemplate</code>&#x2F;<code>JndiLocatorDelegate</code> helpers or the straight JNDI <code>InitialContext</code> usage shown earlier but not the <code>JndiObjectFactoryBean</code> variant, which would force you to declare the return type as the <code>FactoryBean</code> type.</p><p>profileå­—ç¬¦ä¸²å¯ä»¥åŒ…å«ç®€å•çš„profileåç§°ï¼ˆä¾‹å¦‚ï¼Œ<code>production</code>ï¼‰æˆ–profileè¡¨è¾¾å¼ã€‚ profileè¡¨è¾¾å¼å…è®¸è¡¨è¾¾æ›´å¤æ‚çš„æ¦‚è¦é€»è¾‘ï¼ˆä¾‹å¦‚ï¼Œ<code>production &amp; us-east</code>ï¼‰ã€‚ profileè¡¨è¾¾å¼æ”¯æŒä»¥ä¸‹è¿ç®—ç¬¦ï¼š</p><ul><li><code>!</code>: A logical â€œnotâ€ of the profile</li><li><code>&amp;</code>: A logical â€œandâ€ of the profiles</li><li><code>|</code>: A logical â€œorâ€ of the profiles</li></ul><p>ä½ ä¸èƒ½ä¸ä½¿ç”¨æ‹¬å·è€Œæ··åˆ <code>&amp;</code> å’Œ <code>|</code> ã€‚ ä¾‹å¦‚ï¼Œ<code>production &amp; us-east | eu-central</code>ä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„è¡¨è¾¾ã€‚ å®ƒå¿…é¡»è¡¨ç¤ºä¸º <code>production &amp; (us-east | eu-central)</code>.ã€‚</p><p>æ‚¨å¯ä»¥å°†<code>@Profile</code>ç”¨ä½œ<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-meta-annotations">å…ƒæ³¨è§£</a>ï¼Œä»¥åˆ›å»ºè‡ªå®šä¹‰ç»„åˆæ³¨è§£ã€‚ ä»¥ä¸‹ç¤ºä¾‹å®šä¹‰äº†ä¸€ä¸ªè‡ªå®šä¹‰<code>@Production</code>æ³¨è§£ï¼Œæ‚¨å¯ä»¥å°†å…¶ç”¨ä½œ<code>@Profile(&quot;production&quot;)</code>çš„æ›¿ä»£å“ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Target</span>(ElementType.TYPE)<br><br><span class="hljs-variable">@Retention</span>(RetentionPolicy.RUNTIME)<br><br><span class="hljs-variable">@Profile</span>(<span class="hljs-string">&quot;production&quot;</span>)<br><br>public <span class="hljs-variable">@interface</span> Production &#123;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœ<code>@Configuration</code>ç±»æ ‡æœ‰ <code>@Profile</code>,ç±»ä¸­æ‰€æœ‰<code>@Bean</code>å’Œ<code>@Import</code>æ³¨è§£ç›¸å…³çš„ç±»éƒ½å°†è¢«å¿½ç•¥,é™¤éè¯¥profileè¢«æ¿€æ´»ã€‚ å¦‚æœä¸€ä¸ª<code>@Component</code>æˆ–<code>@Configuration</code>ç±»è¢«æ ‡è®°ä¸º<code>@Profile(&#123;&quot;p1&quot;, &quot;p2&quot;&#125;)</code>ã€‚é‚£ä¹ˆé™¤éprofile â€˜p1â€™ or â€˜p2â€™ å·²è¢«æ¿€æ´»ã€‚ å¦åˆ™è¯¥ç±»å°†ä¸ä¼šæ³¨å†Œ&#x2F;å¤„ç†ã€‚å¦‚æœç»™å®šçš„é…ç½®æ–‡ä»¶ä»¥NOTè¿ç®—ç¬¦(<code>!</code>)ä¸ºå‰ç¼€ï¼Œå¦‚æœé…ç½®æ–‡ä»¶ä¸ºnot activeï¼Œåˆ™æ³¨å†Œçš„å…ƒç´ å°†è¢«æ³¨å†Œã€‚ ä¾‹å¦‚ï¼Œç»™å®š<code>@Profile(&#123;&quot;p1&quot;, &quot;!p2&quot;&#125;)</code>ï¼Œå¦‚æœé…ç½®æ–‡ä»¶â€œp1â€å¤„äºæ´»åŠ¨çŠ¶æ€æˆ–é…ç½®æ–‡ä»¶â€œp2â€æœªæ¿€æ´»ï¼Œåˆ™ä¼šè¿›è¡Œæ³¨å†Œã€‚</p><p><code>@Profile</code>ä¹Ÿèƒ½æ³¨è§£æ–¹æ³•ï¼Œç”¨äºé…ç½®ä¸€ä¸ªé…ç½®ç±»ä¸­çš„æŒ‡å®šbeanã€‚å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@Configurationpublic</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> &#123;<br>    <span class="hljs-meta">@Bean(<span class="hljs-string">&quot;dataSource&quot;</span>)</span>    <span class="hljs-meta">@Profile(<span class="hljs-string">&quot;development&quot;</span>)</span> (<span class="hljs-number">1</span>)    <span class="hljs-keyword">public</span> DataSource standaloneDataSource() &#123;        <span class="hljs-keyword">return</span> new EmbeddedDatabaseBuilder()            .setType(EmbeddedDatabaseType.HSQL)            .addScript(<span class="hljs-string">&quot;classpath:com/bank/config/sql/schema.sql&quot;</span>)            .addScript(<span class="hljs-string">&quot;classpath:com/bank/config/sql/test-data.sql&quot;</span>)            .build();    &#125;<br>    <span class="hljs-meta">@Bean(<span class="hljs-string">&quot;dataSource&quot;</span>)</span>    <span class="hljs-meta">@Profile(<span class="hljs-string">&quot;production&quot;</span>)</span> (<span class="hljs-number">2</span>)    <span class="hljs-keyword">public</span> DataSource jndiDataSource() throws Exception &#123;        Context ctx = new InitialContext();        <span class="hljs-keyword">return</span> (DataSource) ctx.lookup(<span class="hljs-string">&quot;java:comp/env/jdbc/datasource&quot;</span>);    &#125;&#125;<br></code></pre></td></tr></table></figure><p><strong>1</strong>ã€<code>standaloneDataSource</code> æ–¹æ³•ä»…åœ¨ <code>development</code> ç¯å¢ƒå¯ç”¨.</p><p><strong>2</strong>ã€<code>jndiDataSource</code>æ–¹æ³•ä»…åœ¨ <code>production</code> ç¯å¢ƒå¯ç”¨.</p><p>åœ¨<code>@Bean</code> æ–¹æ³•ä¸Šè¿˜æ·»åŠ æœ‰<code>@Profile</code>æ³¨è§£,å¯èƒ½ä¼šåº”ç”¨åœ¨ç‰¹æ®Šæƒ…å†µã€‚åœ¨ç›¸åŒJavaæ–¹æ³•åç§°çš„é‡è½½<code>@Bean</code>æ–¹æ³•(ç±»ä¼¼äºæ„é€ å‡½æ•°é‡è½½ï¼‰çš„æƒ…å†µä¸‹ï¼Œ éœ€è¦åœ¨æ‰€æœ‰é‡è½½æ–¹æ³•ä¸Šä¸€è‡´å£°æ˜<code>@Profile</code>æ¡ä»¶ï¼Œå¦‚æœæ¡ä»¶ä¸ä¸€è‡´ï¼Œåˆ™åªæœ‰é‡è½½æ–¹æ³•ä¸­ç¬¬ä¸€ä¸ªå£°æ˜çš„æ¡ä»¶æ‰é‡è¦ã€‚å› æ­¤ï¼Œ<code>@Profile</code>ä¸èƒ½ç”¨äºé€‰æ‹©å…·æœ‰ç‰¹å®šå‚æ•°ç­¾åçš„é‡è½½æ–¹æ³•ï¼Œ æ‰€æœ‰å·¥å‚æ–¹æ³•å¯¹ç›¸åŒçš„beanåœ¨Springæ„é€ å™¨ä¸­çš„è§£æç®—æ³•åœ¨åˆ›å»ºæ—¶æ˜¯ç›¸åŒçš„ã€‚</p><p>å¦‚æœæƒ³å®šä¹‰å…·æœ‰ä¸åŒé…ç½®æ–‡ä»¶æ¡ä»¶çš„å¤‡ç”¨beanï¼Œè¯·ä½¿ç”¨ä¸åŒçš„Javaæ–¹æ³•åç§°ï¼Œé€šè¿‡<code>@Bean</code>åç§°å±æ€§æŒ‡å‘ç›¸åŒçš„beanåç§°ã€‚å¦‚ä¸Šä¾‹æ‰€ç¤ºã€‚ å¦‚æœå‚æ•°ç­¾åéƒ½æ˜¯ç›¸åŒçš„ï¼ˆä¾‹å¦‚ï¼Œæ‰€æœ‰çš„å˜ä½“éƒ½æ˜¯æ— å‚çš„å·¥å‚æ–¹æ³•ï¼‰ï¼Œè¿™æ˜¯å®‰æ’æœ‰æ•ˆJavaç±»æ”¾åœ¨é¦–è¦ä½ç½®çš„å”¯ä¸€æ–¹æ³•ï¼ˆå› ä¸ºåªæœ‰ä¸€ä¸ª ç‰¹å®šåç§°å’Œå‚æ•°ç­¾åçš„æ–¹æ³•ï¼‰ã€‚</p><h5 id="XML-beanå®šä¹‰profiles"><a href="#XML-beanå®šä¹‰profiles" class="headerlink" title="XML beanå®šä¹‰profiles"></a>XML beanå®šä¹‰profiles</h5><p>XMLä¸­çš„<code>&lt;beans&gt;</code> å…ƒç´ æœ‰ä¸€ä¸ª<code>profile</code> å±æ€§,æˆ‘ä»¬ä¹‹å‰çš„ç¤ºä¾‹é…ç½®å¯ä»¥åœ¨ä¸¤ä¸ªXMLæ–‡ä»¶ä¸­é‡å†™ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">profile</span>=<span class="hljs-string">&quot;development&quot;</span>    <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span>    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>    <span class="hljs-attr">xmlns:jdbc</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/jdbc&quot;</span>    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;...&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">jdbc:embedded-database</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;dataSource&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">jdbc:script</span> <span class="hljs-attr">location</span>=<span class="hljs-string">&quot;classpath:com/bank/config/sql/schema.sql&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">jdbc:script</span> <span class="hljs-attr">location</span>=<span class="hljs-string">&quot;classpath:com/bank/config/sql/test-data.sql&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">jdbc:embedded-database</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">profile</span>=<span class="hljs-string">&quot;production&quot;</span>    <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span>    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>    <span class="hljs-attr">xmlns:jee</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/jee&quot;</span>    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;...&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">jee:jndi-lookup</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;dataSource&quot;</span> <span class="hljs-attr">jndi-name</span>=<span class="hljs-string">&quot;java:comp/env/jdbc/datasource&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ä¸ç”¨åˆ†å¼€2ä¸ªæ–‡ä»¶ï¼Œåœ¨åŒä¸€ä¸ªXMLä¸­é…ç½®2ä¸ª<code>&lt;beans/&gt;</code>ï¼Œ<code>&lt;beans/&gt;</code>å…ƒç´ ä¹Ÿæœ‰profileå±æ€§ã€‚å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span>    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>    <span class="hljs-attr">xmlns:jdbc</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/jdbc&quot;</span>    <span class="hljs-attr">xmlns:jee</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/jee&quot;</span>    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;...&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- other bean definitions --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">profile</span>=<span class="hljs-string">&quot;development&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">jdbc:embedded-database</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;dataSource&quot;</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">jdbc:script</span> <span class="hljs-attr">location</span>=<span class="hljs-string">&quot;classpath:com/bank/config/sql/schema.sql&quot;</span>/&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">jdbc:script</span> <span class="hljs-attr">location</span>=<span class="hljs-string">&quot;classpath:com/bank/config/sql/test-data.sql&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">jdbc:embedded-database</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">profile</span>=<span class="hljs-string">&quot;production&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">jee:jndi-lookup</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;dataSource&quot;</span> <span class="hljs-attr">jndi-name</span>=<span class="hljs-string">&quot;java:comp/env/jdbc/datasource&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><p><code>spring-bean.xsd</code> å¼ºåˆ¶å…è®¸å°†profileå…ƒç´ å®šä¹‰åœ¨æ–‡ä»¶çš„æœ€åé¢ï¼Œè¿™æœ‰åŠ©äºåœ¨XMLæ–‡ä»¶ä¸­æä¾›çµæ´»çš„æ–¹å¼è€Œåˆä¸å¼•èµ·æ··ä¹±ã€‚</p><p>å¯¹åº”XMLä¸æ”¯æŒå‰é¢æè¿°çš„profileè¡¨è¾¾å¼ã€‚ ä½†æ˜¯ï¼Œæœ‰å¯èƒ½é€šè¿‡ä½¿ç”¨<code>!</code> æ¥å¦å®šä¸€ä¸ªprofileè¡¨è¾¾å¼ã€‚ ä¹Ÿå¯ä»¥é€šè¿‡åµŒå¥—profilesæ¥åº”ç”¨â€œandâ€ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span>    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>    <span class="hljs-attr">xmlns:jdbc</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/jdbc&quot;</span>    <span class="hljs-attr">xmlns:jee</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/jee&quot;</span>    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;...&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- other bean definitions --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">profile</span>=<span class="hljs-string">&quot;production&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">profile</span>=<span class="hljs-string">&quot;us-east&quot;</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">jee:jndi-lookup</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;dataSource&quot;</span> <span class="hljs-attr">jndi-name</span>=<span class="hljs-string">&quot;java:comp/env/jdbc/datasource&quot;</span>/&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><p>åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œå¦‚æœ<code>production</code> å’Œ<code>us-east</code> profileséƒ½å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œåˆ™ä¼šæš´éœ²<code>dataSource</code> beanã€‚</p><h5 id="å¯ç”¨profile"><a href="#å¯ç”¨profile" class="headerlink" title="å¯ç”¨profile"></a>å¯ç”¨profile</h5><p>ç°åœ¨å·²ç»æ›´æ–°äº†é…ç½®,ä½†ä»ç„¶éœ€è¦æŒ‡å®šè¦æ¿€æ´»å“ªä¸ªé…ç½®æ–‡ä»¶, å¦‚æœæˆ‘ä»¬ç°åœ¨å¼€å§‹æˆ‘ä»¬çš„ç¤ºä¾‹åº”ç”¨ç¨‹åºï¼Œ æˆ‘ä»¬ä¼šçœ‹åˆ°æŠ›å‡º<code>NoSuchBeanDefinitionException</code>ï¼Œå› ä¸ºå®¹å™¨æ‰¾ä¸åˆ°åä¸º<code>dataSource</code>çš„Spring beanã€‚</p><p>æ¿€æ´»é…ç½®æ–‡ä»¶å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å®Œæˆï¼Œä½†æœ€ç›´æ¥çš„æ–¹æ³•æ˜¯ä»¥ç¼–ç¨‹æ–¹å¼å¯¹å¯é€šè¿‡<code>ApplicationContext</code>æä¾›çš„<code>Environment</code> APIè¿›è¡Œæ“ä½œã€‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">AnnotationConfigApplicationContext ctx = <span class="hljs-built_in">new</span> AnnotationConfigApplicationContext();<br><br>ctx.getEnvironment().setActiveProfiles(&quot;development&quot;);<br><br>ctx.register(SomeConfig.<span class="hljs-keyword">class</span>, StandaloneDataConfig.<span class="hljs-keyword">class</span>, JndiDataConfig.<span class="hljs-keyword">class</span>);<br><br>ctx.<span class="hljs-keyword">refresh</span>();<br></code></pre></td></tr></table></figure><p>æ­¤å¤–,é…ç½®æ–‡ä»¶ä¹Ÿå¯ä»¥é€šè¿‡<code>spring.profiles.active</code>å±æ€§å£°æ˜å¼æ€§åœ°æ¿€æ´»,å¯ä»¥é€šè¿‡ç³»ç»Ÿç¯å¢ƒå˜é‡ï¼ŒJVMç³»ç»Ÿå±æ€§ï¼Œ<code>web.xml</code>ä¸­çš„Servletä¸Šä¸‹æ–‡å‚æ•°æŒ‡å®šï¼Œ ç”šè‡³ä½œä¸ºJNDIä¸­çš„ä¸€ä¸ªæ¡ç›®è®¾ç½®ï¼ˆ<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-property-source-abstraction"><code>PropertySource</code> æŠ½è±¡</a>ï¼‰ã€‚åœ¨é›†æˆæµ‹è¯•ä¸­ï¼Œå¯ä»¥é€šè¿‡ <code>spring-test</code>æ¨¡å—ä¸­çš„<code>@ActiveProfiles</code>æ³¨è§£æ¥å£°æ˜æ´»åŠ¨é…ç½®æ–‡ä»¶(å‚è§ä½¿ç”¨<a href="https://github.com/DocsHome/spring-docs/blob/master/pages/test/testing.mdl#testcontext-ctx-management-env-profiles">ç¯å¢ƒé…ç½®æ–‡ä»¶çš„ä¸Šä¸‹æ–‡é…ç½®</a>)</p><p>é…ç½®æ–‡ä»¶ä¸æ˜¯â€œäºŒé€‰ä¸€â€çš„ã€‚å¼€å‘è€…å¯ä»¥ä¸€æ¬¡æ¿€æ´»å¤šä¸ªé…ç½®æ–‡ä»¶ã€‚ä½¿ç”¨ç¼–ç¨‹æ–¹å¼ï¼Œæ‚¨å¯ä»¥ä¸º<code>setActiveProfiles()</code>æ–¹æ³•æä¾›å¤šä¸ªé…ç½®æ–‡ä»¶åç§°ï¼Œè¯¥æ–¹æ³•æ¥å— <code>Stringâ€¦</code>varargsã€‚ ä»¥ä¸‹ç¤ºä¾‹æ¿€æ´»å¤šä¸ªé…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pf">ctx.getEnvironment().<span class="hljs-built_in">set</span>ActiveProfiles(<span class="hljs-string">&quot;profile1&quot;</span>, <span class="hljs-string">&quot;profile2&quot;</span>);<br></code></pre></td></tr></table></figure><p>å£°æ˜æ€§åœ°ï¼Œ<code>spring.profiles.active</code>å¯ä»¥æ¥å—ä»¥é€—å·åˆ†éš”çš„profileååˆ—è¡¨ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">-Dspring.profiles.active</span>=<span class="hljs-string">&quot;profile1,profile2&quot;</span><br></code></pre></td></tr></table></figure><h5 id="é»˜è®¤-Profile"><a href="#é»˜è®¤-Profile" class="headerlink" title="é»˜è®¤ Profile"></a>é»˜è®¤ Profile</h5><p>defaulté…ç½®æ–‡ä»¶è¡¨ç¤ºé»˜è®¤å¼€å¯çš„profileé…ç½®ã€‚è€ƒè™‘ä»¥ä¸‹é…ç½®:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Configuration</span><span class="hljs-variable">@Profile</span>(<span class="hljs-string">&quot;default&quot;</span>)public class DefaultDataConfig &#123;<br>    <span class="hljs-variable">@Bean</span>    public DataSource <span class="hljs-built_in">dataSource</span>() &#123;        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">EmbeddedDatabaseBuilder</span>()            <span class="hljs-selector-class">.setType</span>(EmbeddedDatabaseType.HSQL)            <span class="hljs-selector-class">.addScript</span>(<span class="hljs-string">&quot;classpath:com/bank/config/sql/schema.sql&quot;</span>)            <span class="hljs-selector-class">.build</span>();    &#125;&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰é…ç½®æ–‡ä»¶æ¿€æ´»ï¼Œä¸Šé¢çš„<code>dataSource</code>å°±ä¼šè¢«åˆ›å»ºã€‚è¿™æä¾›äº†ä¸€ç§é»˜è®¤çš„æ–¹å¼ï¼Œå¦‚æœæœ‰ä»»ä½•ä¸€ä¸ªé…ç½®æ–‡ä»¶å¯ç”¨ï¼Œdefaulté…ç½®å°±ä¸ä¼šç”Ÿæ•ˆã€‚</p><p>é»˜è®¤é…ç½®æ–‡ä»¶çš„åå­—(defaultï¼‰å¯ä»¥é€šè¿‡<code>Environment</code>çš„<code>setDefaultProfiles()</code>æ–¹æ³•æˆ–è€…<code>spring.profiles.default</code>å±æ€§ä¿®æ”¹ã€‚</p><h4 id="1-13-2-PropertySource-æŠ½è±¡"><a href="#1-13-2-PropertySource-æŠ½è±¡" class="headerlink" title="1.13.2. PropertySource æŠ½è±¡"></a>1.13.2. <code>PropertySource</code> æŠ½è±¡</h4><p>Springçš„<code>Environment</code>æŠ½è±¡æä¾›ç”¨äºä¸€ç³»åˆ—çš„propertysourceså±æ€§é…ç½®æ–‡ä»¶çš„æœç´¢æ“ä½œ.è¯·è€ƒè™‘ä»¥ä¸‹åˆ—è¡¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">ctx</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GenericApplicationContext</span>();<br><br><span class="hljs-type">Environment</span> <span class="hljs-variable">env</span> <span class="hljs-operator">=</span> ctx.getEnvironment();<br><br><span class="hljs-type">boolean</span> <span class="hljs-variable">containsMyProperty</span> <span class="hljs-operator">=</span> env.containsProperty(<span class="hljs-string">&quot;my-property&quot;</span>);<br><br>System.out.println(<span class="hljs-string">&quot;Does my environment contain the &#x27;my-property&#x27; property? &quot;</span> + containsMyProperty);<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä»£ç æ®µä¸­,ä¸€ä¸ªé«˜çº§åˆ«çš„æ–¹æ³•ç”¨äºè®¿é—®Springæ˜¯å¦ä¸ºå½“å‰ç¯å¢ƒå®šä¹‰äº†<code>my-property</code> å±æ€§ã€‚ä¸ºäº†å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œ<code>Environment</code>å¯¹è±¡å¯¹ä¸€ç»„PropertySourceå¯¹è±¡è¿›è¡Œæœç´¢ã€‚ <a href="https://docs.spring.io/spring-framework/docs/5.1.3.BUILD-SNAPSHOT/javadoc-api/org/springframework/core/env/PropertySource.html"><code>PropertySource</code></a>æ˜¯å¯¹ä»»ä½•é”®å€¼å¯¹çš„ç®€å•æŠ½è±¡ï¼ŒSpringçš„<a href="https://docs.spring.io/spring-framework/docs/5.1.3.BUILD-SNAPSHOT/javadoc-api/org/springframework/core/env/StandardEnvironment.html"><code>StandardEnvironment</code></a>é…ç½®æœ‰ä¸¤ä¸ª<code>PropertySource</code>å¯¹è±¡ ï¼Œä¸€ä¸ªè¡¨ç¤ºJVMç³»ç»Ÿå±æ€§(<code>System.getProperties()</code>),ä¸€ä¸ªè¡¨ç¤ºç³»ç»Ÿç¯å¢ƒå˜é‡(<code>System.getenv()</code>)ã€‚</p><p>è¿™äº›é»˜è®¤propertyæºä½äº<code>StandardEnvironment</code>ä¸­,ç”¨äºç‹¬ç«‹åº”ç”¨ç¨‹åºã€‚<a href="https://docs.spring.io/spring-framework/docs/5.1.3.BUILD-SNAPSHOT/javadoc-api/org/springframework/web/context/support/StandardServletEnvironment.html"><code>StandardServletEnvironment</code></a>ç”¨é»˜è®¤çš„propertyé…ç½®æºå¡«å……ã€‚ é»˜è®¤é…ç½®æºåŒ…æ‹¬Servleté…ç½®å’ŒServletä¸Šä¸‹æ–‡å‚æ•°ï¼Œå®ƒå¯ä»¥é€‰æ‹©å¯ç”¨<a href="https://docs.spring.io/spring-framework/docs/5.1.3.BUILD-SNAPSHOT/javadoc-api/org/springframework/jndi/JndiPropertySource.html"><code>JndiPropertySource</code></a>ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…å®ƒçš„javadocs</p><p>å…·ä½“åœ°è¯´ï¼Œå½“æ‚¨ä½¿ç”¨<code>StandardEnvironment</code>æ—¶ï¼Œå¦‚æœåœ¨è¿è¡Œæ—¶å­˜åœ¨<code>my-property</code>ç³»ç»Ÿå±æ€§æˆ–<code>my-propertyi</code>ç¯å¢ƒå˜é‡ï¼Œåˆ™å¯¹ <code>env.containsProperty(&quot;my-property&quot;)</code>çš„è°ƒç”¨å°†è¿”å›trueã€‚</p><p>æ‰§è¡Œçš„æœç´¢æ˜¯åˆ†å±‚çš„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç³»ç»Ÿå±æ€§ä¼˜å…ˆäºç¯å¢ƒå˜é‡ï¼Œå› æ­¤å¦‚æœåœ¨è°ƒç”¨<code>env.getProperty(&quot;my-property&quot;)</code>æœŸé—´ç¢°å·§åœ¨ä¸¤ä¸ªä½ç½®éƒ½è®¾ç½®äº†<code>my-property</code>å±æ€§ï¼Œ ç³»ç»Ÿå±æ€§å€¼è¿”å›ä¼˜å…ˆäºç¯å¢ƒå˜é‡ã€‚ è¯·æ³¨æ„ï¼Œå±æ€§å€¼æœªåˆå¹¶ï¼Œè€Œæ˜¯ç”±å‰é¢çš„æ¡ç›®å®Œå…¨è¦†ç›–ã€‚</p><p>å¯¹äºå¸¸è§çš„ <code>StandardServletEnvironment</code>ï¼Œå®Œæ•´å±‚æ¬¡ç»“æ„å¦‚ä¸‹ï¼Œæœ€é«˜ä¼˜å…ˆçº§æ¡ç›®ä½äºé¡¶éƒ¨ï¼š</p><ol><li>ServletConfigå‚æ•°ï¼ˆå¦‚æœé€‚ç”¨ - ä¾‹å¦‚ï¼Œåœ¨DispatcherServletä¸Šä¸‹æ–‡çš„æƒ…å†µä¸‹ï¼‰</li><li>ServletContextå‚æ•°ï¼ˆweb.xml context-paramæ¡ç›®ï¼‰</li><li>JNDIç¯å¢ƒå˜é‡ï¼ˆ<code>java:comp/env/</code>entriesï¼‰</li><li>JVMç³»ç»Ÿå±æ€§ï¼ˆ<code>-D</code>å‘½ä»¤è¡Œå‚æ•°ï¼‰</li><li>JVMç³»ç»Ÿç¯å¢ƒï¼ˆæ“ä½œç³»ç»Ÿç¯å¢ƒå˜é‡ï¼‰</li></ol><p>æœ€é‡è¦çš„æ˜¯,æ•´ä¸ªæœºåˆ¶éƒ½æ˜¯å¯é…ç½®çš„ã€‚ä¹Ÿè®¸å¼€å‘è€…éœ€è¦ä¸€ä¸ªè‡ªå®šä¹‰çš„propertiesæºï¼Œå¹¶å°†è¯¥æºæ•´åˆåˆ°è¿™ä¸ªæ£€ç´¢å±‚çº§ä¸­ã€‚ä¸ºæ­¤ï¼Œè¯·å®ç°å¹¶å®ä¾‹åŒ–æ‚¨è‡ªå·±çš„<code>PropertySource</code>ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°å½“å‰<code>Environment</code>çš„<code>PropertySource</code>é›†åˆä¸­ã€‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs abnf">ConfigurableApplicationContext ctx <span class="hljs-operator">=</span> new GenericApplicationContext()<span class="hljs-comment">;</span><br><br>MutablePropertySources sources <span class="hljs-operator">=</span> ctx.getEnvironment().getPropertySources()<span class="hljs-comment">;</span><br><br>sources.addFirst(new MyPropertySource())<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œ <code>MyPropertySource</code>åœ¨æœç´¢ä¸­æ·»åŠ äº†æœ€é«˜ä¼˜å…ˆçº§ã€‚å¦‚æœå®ƒåŒ…å«<code>my-property</code>å±æ€§ï¼Œåˆ™ä¼šæ£€æµ‹å¹¶è¿”å›è¯¥å±æ€§ï¼Œ ä¼˜å…ˆäºå…¶ä»– <code>PropertySource</code>ä¸­çš„ä»»ä½•<code>my-property</code>å±æ€§ã€‚ <a href="https://docs.spring.io/spring-framework/docs/5.1.3.BUILD-SNAPSHOT/javadoc-api/org/springframework/core/env/MutablePropertySources.html"><code>MutablePropertySources</code></a> APIå…¬å¼€äº†è®¸å¤šæ–¹æ³•ï¼Œå…è®¸ä½ æ˜¾å¼æ“ä½œpropertyå±æ€§æºã€‚</p><h4 id="1-13-3-ä½¿ç”¨-PropertySource"><a href="#1-13-3-ä½¿ç”¨-PropertySource" class="headerlink" title="1.13.3. ä½¿ç”¨ @PropertySource"></a>1.13.3. ä½¿ç”¨ <code>@PropertySource</code></h4><p><a href="https://docs.spring.io/spring-framework/docs/5.1.3.BUILD-SNAPSHOT/javadoc-api/org/springframework/context/annotation/PropertySource.html"><code>@PropertySource</code></a> æ³¨è§£æä¾›äº†ä¾¿æ·çš„æ–¹å¼ï¼Œç”¨äºå¢åŠ <code>PropertySource</code>åˆ°Springçš„ <code>Environment</code>ä¸­ã€‚</p><p>ç»™å®šä¸€ä¸ªåä¸º<code>app.properties</code>çš„æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«é”®å€¼å¯¹<code>testbean.name=myTestBean</code>ï¼Œ ä»¥ä¸‹<code>@Configuration</code>ç±»ä½¿ç”¨<code>@PropertySource</code>ï¼Œä»¥ä¾¿è°ƒç”¨<code>testBean.getName()</code> è¿”å›<code>myTestBean</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@PropertySource(&quot;classpath:/com/myco/app.properties&quot;)</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> &#123;<br>    <span class="hljs-meta">@Autowired</span>    Environment env;<br>    <span class="hljs-meta">@Bean</span>    <span class="hljs-keyword">public</span> TestBean <span class="hljs-title function_">testBean</span><span class="hljs-params">()</span> &#123;        <span class="hljs-type">TestBean</span> <span class="hljs-variable">testBean</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestBean</span>();        testBean.setName(env.getProperty(<span class="hljs-string">&quot;testbean.name&quot;</span>));        <span class="hljs-keyword">return</span> testBean;    &#125;&#125;<br></code></pre></td></tr></table></figure><p>ä»»ä½•çš„å­˜åœ¨äº<code>@PropertySource</code>ä¸­çš„<code>$&#123;â€¦&#125;</code>å ä½ç¬¦ï¼Œå°†ä¼šè¢«è§£æä¸ºå®šä¹‰åœ¨ç¯å¢ƒä¸­çš„å±æ€§é…ç½®æ–‡ä»¶ä¸­çš„å±æ€§å€¼ã€‚ å¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@PropertySource(<span class="hljs-string">&quot;classpath:/com/<span class="hljs-subst">$&#123;my.placeholder:default/path&#125;</span>/app.properties&quot;</span>)</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> &#123;<br>    <span class="hljs-meta">@Autowired</span>    Environment env;<br>    <span class="hljs-meta">@Bean</span>    <span class="hljs-keyword">public</span> TestBean testBean() &#123;        TestBean testBean = new TestBean();        testBean.setName(env.getProperty(<span class="hljs-string">&quot;testbean.name&quot;</span>));        <span class="hljs-keyword">return</span> testBean;    &#125;&#125;<br></code></pre></td></tr></table></figure><p>å‡è®¾<code>my.placeholder</code>å­˜åœ¨äºå·²æ³¨å†Œçš„å…¶ä¸­ä¸€ä¸ªå±æ€§æºä¸­ï¼ˆä¾‹å¦‚ï¼Œç³»ç»Ÿå±æ€§æˆ–ç¯å¢ƒå˜é‡ï¼‰ï¼Œåˆ™å ä½ç¬¦å°†è§£æä¸ºç›¸åº”çš„å€¼ã€‚ å¦‚æœä¸æ˜¯ï¼Œåˆ™<code>default/path</code>ç”¨ä½œé»˜è®¤å€¼ã€‚ å¦‚æœæœªæŒ‡å®šé»˜è®¤å€¼ä¸”æ— æ³•è§£æå±æ€§ï¼Œåˆ™æŠ›å‡º<code>IllegalArgumentException</code>ã€‚</p><p>æ ¹æ®Java 8æƒ¯ä¾‹ï¼Œ<code>@PropertySource</code>æ³¨è§£æ˜¯å¯é‡å¤çš„ã€‚ ä½†æ˜¯ï¼Œæ‰€æœ‰è¿™äº›<code>@PropertySource</code>æ³¨è§£éƒ½éœ€è¦åœ¨åŒä¸€çº§åˆ«å£°æ˜ï¼Œå¯ä»¥ç›´æ¥åœ¨é…ç½®ç±»ä¸Šå£°æ˜ï¼Œ ä¹Ÿå¯ä»¥åœ¨åŒä¸€è‡ªå®šä¹‰æ³¨è§£ä¸­ä½œä¸ºå…ƒæ³¨è§£å£°æ˜ã€‚ ä¸å»ºè®®æ··åˆç›´æ¥æ³¨è§£å’Œå…ƒæ³¨è§£ï¼Œå› ä¸ºç›´æ¥æ³¨è§£æœ‰æ•ˆåœ°è¦†ç›–äº†å…ƒæ³¨è§£ã€‚</p><h4 id="1-13-4-åœ¨å£°æ˜ä¸­çš„å ä½ç¬¦"><a href="#1-13-4-åœ¨å£°æ˜ä¸­çš„å ä½ç¬¦" class="headerlink" title="1.13.4. åœ¨å£°æ˜ä¸­çš„å ä½ç¬¦"></a>1.13.4. åœ¨å£°æ˜ä¸­çš„å ä½ç¬¦</h4><p>ä¹‹å‰ï¼Œå…ƒç´ ä¸­å ä½ç¬¦çš„å€¼åªèƒ½é’ˆå¯¹JVMç³»ç»Ÿå±æ€§æˆ–ç¯å¢ƒå˜é‡è¿›è¡Œè§£æã€‚ç°åœ¨å·²ç»æ‰“ç ´äº†è¿™ç§æƒ…å†µã€‚å› ä¸ºç¯å¢ƒæŠ½è±¡é›†æˆåœ¨æ•´ä¸ªå®¹å™¨ä¸­ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“é€šè¿‡å®ƒæ¥å¯¹å ä½ç¬¦è¿›è¡Œè§£æ. è¿™æ„å‘³ç€å¼€å‘è€…å¯ä»¥ä»¥ä»»ä½•å–œæ¬¢çš„æ–¹å¼æ¥é…ç½®è¿™ä¸ªè§£æè¿‡ç¨‹ï¼Œå¯ä»¥æ”¹å˜æ˜¯ä¼˜å…ˆæŸ¥æ‰¾ç³»ç»Ÿpropertiesæˆ–è€…æ˜¯æœ‰é™æŸ¥æ‰¾ç¯å¢ƒå˜é‡ï¼Œæˆ–è€…åˆ é™¤å®ƒä»¬ï¼›å¢åŠ è‡ªå®šä¹‰propertyæºï¼Œä½¿ä¹‹æˆä¸ºæ›´åˆé€‚çš„é…ç½®</p><p>å…·ä½“è€Œè¨€ï¼Œåªè¦åœ¨<code>Environment</code>ä¸­å¯ç”¨ï¼Œæ— è®º<code>customer</code>å±æ€§åœ¨ä½•å¤„å®šä¹‰ï¼Œä»¥ä¸‹è¯­å¥éƒ½å¯ä»¥å·¥ä½œï¼š</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">import</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;com/bank/service/$</span></span></span><span class="hljs-template-variable">&#123;customer&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">-config.xml&quot;</span>/&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></span><br></code></pre></td></tr></table></figure><h3 id="1-14-æ³¨å†ŒLoadTimeWeaver"><a href="#1-14-æ³¨å†ŒLoadTimeWeaver" class="headerlink" title="1.14. æ³¨å†ŒLoadTimeWeaver"></a>1.14. æ³¨å†Œ<code>LoadTimeWeaver</code></h3><p><code>LoadTimeWeaver</code>è¢«Springç”¨æ¥åœ¨å°†ç±»åŠ è½½åˆ°Javaè™šæ‹Ÿæœº(JVM)ä¸­æ—¶åŠ¨æ€åœ°è½¬æ¢ç±»</p><p>è‹¥è¦å¼€å¯åŠ è½½æ—¶ç»‡å…¥,è¦åœ¨<code>@Configuration</code>ç±»ä¸­å¢åŠ <code>@EnableLoadTimeWeaving</code>æ³¨è§£ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Configuration</span><br><br><span class="hljs-variable">@EnableLoadTimeWeaving</span><br><br>public class AppConfig &#123;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ–è€…ï¼Œå¯¹äºXMLé…ç½®ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<code>context:load-time-weaver</code> å…ƒç´ :</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-section">&lt;beans&gt;</span><br><br>    <span class="hljs-section">&lt;context:load-time-weaver/&gt;</span><br><br><span class="hljs-section">&lt;/beans&gt;</span><br></code></pre></td></tr></table></figure><p>ä¸€æ—¦é…ç½®ä¸º <code>ApplicationContext</code>,è¯¥ <code>ApplicationContext</code>ä¸­çš„ä»»ä½•beanéƒ½å¯ä»¥å®ç°<code>LoadTimeWeaverAware</code>,ä»è€Œæ¥æ”¶å¯¹load-time weaverå®ä¾‹çš„å¼•ç”¨ã€‚ è¿™ç‰¹åˆ«é€‚ç”¨äº<a href="https://github.com/DocsHome/spring-docs/blob/master/pages/dataaccess/data-access.md#orm-jpa">Springçš„JPAæ”¯æŒ</a>ã€‚å…¶ä¸­JPAç±»è½¬æ¢å¯èƒ½éœ€è¦åŠ è½½æ—¶ç»‡å…¥ã€‚ æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://docs.spring.io/spring-framework/docs/5.1.3.BUILD-SNAPSHOT/javadoc-api/org/springframework/orm/jpa/LocalContainerEntityManagerFactoryBean.html"><code>LocalContainerEntityManagerFactoryBean</code></a>.ã€‚ æœ‰å…³AspectJåŠ è½½æ—¶ç¼–ç»‡çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#aop-aj-ltw">Spring Frameworkä¸­ä½¿ç”¨AspectJçš„åŠ è½½æ—¶ç»‡å…¥</a>ã€‚</p><h3 id="1-15-ApplicationContextçš„é™„åŠ åŠŸèƒ½"><a href="#1-15-ApplicationContextçš„é™„åŠ åŠŸèƒ½" class="headerlink" title="1.15.ApplicationContextçš„é™„åŠ åŠŸèƒ½"></a>1.15.<code>ApplicationContext</code>çš„é™„åŠ åŠŸèƒ½</h3><p>æ­£å¦‚ <a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans">å‰é¢ç« èŠ‚</a>ä¸­è®¨è®ºçš„ï¼Œ<code>org.springframework.beans.factory</code>åŒ…æä¾›äº†ç®¡ç†å’Œæ“ä½œbeançš„åŸºæœ¬åŠŸèƒ½ï¼ŒåŒ…æ‹¬ä»¥ç¼–ç¨‹æ–¹å¼ã€‚ <code>org.springframework.context</code>åŒ…æ·»åŠ äº†<a href="https://docs.spring.io/spring-framework/docs/5.1.3.BUILD-SNAPSHOT/javadoc-api/org/springframework/context/ApplicationContext.html"><code>ApplicationContext</code></a>æ¥å£ï¼Œè¯¥æ¥å£æ‰©å±•äº†<code>BeanFactory</code>æ¥å£ï¼Œæ­¤å¤–è¿˜æ‰©å±•äº†å…¶ä»–æ¥å£ï¼Œä»¥æ›´é¢å‘åº”ç”¨ç¨‹åºæ¡†æ¶çš„æ–¹å¼æä¾›å…¶ä»–åŠŸèƒ½ã€‚ è®¸å¤šäººä»¥å®Œå…¨å£°æ˜çš„æ–¹å¼ä½¿ç”¨<code>ApplicationContext</code>ï¼Œ ç”šè‡³ä¸ä»¥ç¼–ç¨‹æ–¹å¼åˆ›å»ºå®ƒï¼Œè€Œæ˜¯ä¾èµ–äºè¯¸å¦‚<code>ContextLoader</code>ä¹‹ç±»çš„æ”¯æŒç±»æ¥è‡ªåŠ¨å®ä¾‹åŒ–<code>ApplicationContext</code>ï¼Œä½œä¸ºJava EE Webåº”ç”¨ç¨‹åºçš„æ­£å¸¸å¯åŠ¨è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ã€‚</p><p>ä¸ºäº†ä»¥æ›´åŠ é¢å‘æ¡†æ¶çš„æ–¹å¼å¢å¼º<code>BeanFactory</code>çš„åŠŸèƒ½,ä¸Šä¸‹æ–‡åŒ…è¿˜æä¾›äº†ä»¥ä¸‹åŠŸèƒ½ã€‚</p><ul><li>é€šè¿‡<code>MessageSource</code>æ¥å£è®¿é—®i18né£æ ¼çš„æ¶ˆæ¯ã€‚</li><li>é€šè¿‡<code>ResourceLoader</code>æ¥å£è®¿é—®URLå’Œæ–‡ä»¶ç­‰èµ„æºã€‚</li><li>äº‹ä»¶å‘å¸ƒï¼Œå³é€šè¿‡ä½¿ç”¨<code>ApplicationEventPublisher</code>æ¥å£å®ç°<code>ApplicationListener</code>æ¥å£çš„beanã€‚</li><li>é€šè¿‡<code>HierarchicalBeanFactory</code>æ¥å£ï¼ŒåŠ è½½å¤šçº§contextsï¼Œå…è®¸å…³æ³¨æŸä¸€å±‚çº§contextï¼Œæ¯”å¦‚åº”ç”¨çš„Webå±‚ã€‚</li></ul><h4 id="1-15-1-ä½¿ç”¨MessageSourceå®ç°å›½é™…åŒ–"><a href="#1-15-1-ä½¿ç”¨MessageSourceå®ç°å›½é™…åŒ–" class="headerlink" title="1.15.1. ä½¿ç”¨MessageSourceå®ç°å›½é™…åŒ–"></a>1.15.1. ä½¿ç”¨<code>MessageSource</code>å®ç°å›½é™…åŒ–</h4><p><code>ApplicationContext</code> æ¥å£æ‰©å±•äº†ä¸€ä¸ªåä¸º<code>MessageSource</code>çš„æ¥å£ï¼Œå› æ­¤æä¾›äº†å›½é™…åŒ–(â€œi18nâ€)åŠŸèƒ½ã€‚ Springè¿˜æä¾›äº†<code>HierarchicalMessageSource</code>æ¥å£ï¼Œè¯¥æ¥å£å¯ä»¥åˆ†å±‚æ¬¡åœ°è§£ææ¶ˆæ¯ã€‚ è¿™äº›æ¥å£å…±åŒæä¾›äº†Springå½±å“æ¶ˆæ¯è§£æçš„åŸºç¡€ã€‚ è¿™äº›æ¥å£ä¸Šå®šä¹‰çš„æ–¹æ³•åŒ…æ‹¬ï¼š</p><ul><li><code>String getMessage(String code, Object[] args, String default, Locale loc)</code>: ç”¨äºä»<code>MessageSource</code>æ£€ç´¢æ¶ˆæ¯çš„åŸºæœ¬æ–¹æ³•ã€‚ å¦‚æœæœªæ‰¾åˆ°æŒ‡å®šåŒºåŸŸè®¾ç½®çš„æ¶ˆæ¯ï¼Œåˆ™ä½¿ç”¨é»˜è®¤æ¶ˆæ¯ã€‚ ä¼ å…¥çš„ä»»ä½•å‚æ•°éƒ½ä½¿ç”¨æ ‡å‡†åº“æä¾›çš„<code>MessageFormat</code>åŠŸèƒ½æˆä¸ºæ›¿æ¢å€¼ã€‚</li><li><code>String getMessage(String code, Object[] args, Locale loc)</code>: åŸºæœ¬ä¸Šä¸å‰ä¸€ä¸ªæ–¹æ³•ç›¸åŒï¼Œä½†æœ‰ä¸€ä¸ªåŒºåˆ«ï¼šä¸èƒ½æŒ‡å®šé»˜è®¤æ¶ˆæ¯ã€‚ å¦‚æœæ‰¾ä¸åˆ°è¯¥æ¶ˆæ¯ï¼Œåˆ™æŠ›å‡º<code>NoSuchMessageException</code> ã€‚</li><li><code>String getMessage(MessageSourceResolvable resolvable, Locale locale)</code>: å‰é¢æ–¹æ³•ä¸­ä½¿ç”¨çš„æ‰€æœ‰å±æ€§ä¹ŸåŒ…è£…åœ¨åä¸º <code>MessageSourceResolvable</code>çš„ç±»ä¸­ï¼Œæ‚¨å¯ä»¥å°†æ­¤æ–¹æ³•ç”¨äºæ­¤ç±»ã€‚</li></ul><p>å½“ä¸€ä¸ª<code>ApplicationContext</code>è¢«åŠ è½½æ—¶,å®ƒä¼šè‡ªåŠ¨æœç´¢åœ¨ä¸Šä¸‹æ–‡ä¸­å®šä¹‰çš„ä¸€ä¸ª<code>MessageSource</code>,beanå¿…é¡»åŒ…å«åç§°<code>messageSource</code>,å¦‚æœæ‰¾åˆ°è¿™æ ·çš„bean åˆ™å°†å¯¹å‰é¢æ–¹æ³•çš„æ‰€æœ‰è°ƒç”¨å§”æ´¾ç»™æ¶ˆæ¯æºã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°æ¶ˆæ¯æºï¼Œ<code>ApplicationContext</code>ä¼šå°è¯•æ‰¾åˆ°ä¸€ä¸ªåŒ…å«åŒåbeançš„çˆ¶å¯¹è±¡ã€‚å¦‚æœæœ‰ï¼Œå®ƒä½¿ç”¨é‚£ä¸ªbeanä½œä¸º<code>MessageSource</code>ã€‚ å¦‚æœ<code>ApplicationContext</code>æ‰¾ä¸åˆ°æ¶ˆæ¯çš„ä»»ä½•æºï¼Œåˆ™ä¼šå®ä¾‹åŒ–ç©ºçš„<code>DelegatingMessageSource</code>ï¼Œä»¥ä¾¿èƒ½å¤Ÿæ¥å—å¯¹ä¸Šé¢å®šä¹‰çš„æ–¹æ³•çš„è°ƒç”¨ã€‚</p><p>Springæä¾›äº†ä¸¤ä¸ªMessageSourceå®ç°ï¼Œ <code>ResourceBundleMessageSource</code>å’Œ<code>StaticMessageSource</code>ï¼Œä¸ºäº†åšåµŒå¥—æ¶ˆæ¯ä¸¤è€…éƒ½å®ç°äº†<code>HierarchicalMessageSource</code>ã€‚ <code>StaticMessageSource</code>å¾ˆå°‘ä½¿ç”¨ï¼Œä½†æä¾›äº†ä»¥ç¼–ç¨‹æ–¹å¼å‘æºæ·»åŠ æ¶ˆæ¯ã€‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†<code>ResourceBundleMessageSource</code>ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;messageSource&quot;</span></span><br><span class="hljs-tag"></span><br><span class="hljs-tag">            <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.context.support.ResourceBundleMessageSource&quot;</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;basenames&quot;</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span><br><br>                <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>format<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br><br>                <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>exceptions<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br><br>                <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>windows<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><p>è¯¥ç¤ºä¾‹å‡å®šæ‚¨åœ¨ç±»è·¯å¾„ä¸­å®šä¹‰äº†ä¸‰ä¸ªèµ„æºåŒ…ï¼Œ<code>format</code>, <code>exceptions</code> and <code>windows</code>ã€‚ä»»ä½•è§£ææ¶ˆæ¯çš„è¯·æ±‚éƒ½å°†ä»¥JDKæ ‡å‡†æ–¹å¼å¤„ç†, é€šè¿‡<code>ResourceBundle</code>è§£ææ¶ˆæ¯ã€‚å‡ºäºç¤ºä¾‹çš„ç›®çš„ï¼Œå‡è®¾ä¸Šè¿°ä¸¤ä¸ªèµ„æºåŒ…æ–‡ä»¶çš„å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dart"># <span class="hljs-keyword">in</span> format.propertiesmessage=Alligators rock!<br># <span class="hljs-keyword">in</span> exceptions.propertiesargument.<span class="hljs-keyword">required</span>=The &#123;<span class="hljs-number">0</span>&#125; argument <span class="hljs-keyword">is</span> <span class="hljs-keyword">required</span>.<br></code></pre></td></tr></table></figure><p>ä¸‹ä¸€ä¸ªç¤ºä¾‹æ˜¾ç¤ºäº†æ‰§è¡Œ<code>MessageSource</code> åŠŸèƒ½çš„ç¨‹åºã€‚ è¯·è®°ä½ï¼Œæ‰€æœ‰<code>ApplicationContext</code>å®ç°ä¹Ÿéƒ½æ˜¯<code>MessageSource</code> å®ç°ï¼Œå› æ­¤å¯ä»¥å¼ºåˆ¶è½¬æ¢ä¸º<code>MessageSource</code> æ¥å£ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) &#123;<br><br>    <span class="hljs-title class_">MessageSource</span> resources = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathXmlApplicationContext</span>(<span class="hljs-string">&quot;beans.xml&quot;</span>);<br><br>    <span class="hljs-title class_">String</span> message = resources.<span class="hljs-title function_">getMessage</span>(<span class="hljs-string">&quot;message&quot;</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">&quot;Default&quot;</span>, <span class="hljs-literal">null</span>);<br><br>    <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(message);<br><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ç¨‹åºäº§ç”Ÿçš„ç»“æœå¦‚ä¸‹:</p><p>Alligators rock!</p><p>æ€»è€Œè¨€ä¹‹ï¼Œ<code>MessageSource</code>åœ¨åä¸º<code>beans.xml</code>çš„æ–‡ä»¶ä¸­å®šä¹‰ï¼Œè¯¥æ–‡ä»¶å­˜åœ¨äºç±»è·¯å¾„çš„æ ¹ç›®å½•ä¸­ã€‚<code>messageSource</code>beanå®šä¹‰é€šè¿‡å…¶basenameså±æ€§å¼•ç”¨è®¸å¤šèµ„æºåŒ…ã€‚ åœ¨åˆ—è¡¨ä¸­ä¼ é€’ç»™<code>basenames</code>å±æ€§çš„ä¸‰ä¸ªæ–‡ä»¶ä½œä¸ºç±»è·¯å¾„æ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶å­˜åœ¨ï¼Œåˆ†åˆ«ç§°ä¸º<code>format.properties</code>, <code>exceptions.properties</code>å’Œ<code>windows.properties</code>ã€‚</p><p>ä¸‹ä¸€ä¸ªç¤ºä¾‹æ˜¾ç¤ºä¼ é€’ç»™æ¶ˆæ¯æŸ¥è¯¢çš„å‚æ•°ï¼Œè¿™äº›å‚æ•°å°†è¢«è½¬æ¢ä¸ºå­—ç¬¦ä¸²å¹¶æ’å…¥æŸ¥æ‰¾æ¶ˆæ¯ä¸­çš„å ä½ç¬¦ã€‚</p><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xquery"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-comment">&lt;!-- this MessageSource is being used in a web application --&gt;</span>    </span><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;messageSource&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.context.support.ResourceBundleMessageSource&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;basename&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;exceptions&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></span><span class="language-xml"></span><br><span class="language-xml">    <span class="hljs-comment">&lt;!-- lets inject the above MessageSource into this POJO --&gt;</span>    </span><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;example&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.something.Example&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;messages&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;messageSource&quot;</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></span><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></span><br>public class Example &#123;<br>    private MessageSource messages;<br>    public void setMessages(MessageSource messages) &#123;        this.messages = messages;    &#125;<br>    public void execute() &#123;        String message = this.messages.getMessage(<span class="hljs-string">&quot;argument.required&quot;</span>,            new Object [] &#123;<span class="hljs-string">&quot;userDao&quot;</span>&#125;, <span class="hljs-string">&quot;Required&quot;</span>, null);        System.out.println(message);    &#125;&#125;<br></code></pre></td></tr></table></figure><p>è°ƒç”¨ <code>execute()</code>æ–¹æ³•å¾—åˆ°çš„ç»“æœå¦‚ä¸‹:</p><p>The userDao argument is required.</p><p>å…³äºå›½é™…åŒ–(â€œi18nâ€)ï¼ŒSpringçš„å„ç§ <code>MessageSource</code>å®ç°éµå¾ªä¸æ ‡å‡†JDK <code>ResourceBundle</code>ç›¸åŒçš„åŒºåŸŸè®¾ç½®è§£æå’Œå›é€€è§„åˆ™ã€‚ ç®€è€Œè¨€ä¹‹ï¼Œç»§ç»­å‰é¢å®šä¹‰çš„ç¤ºä¾‹<code>messageSource</code>ï¼Œå¦‚æœè¦æ ¹æ®British(<code>en-GB</code>)è¯­è¨€ç¯å¢ƒè§£ææ¶ˆæ¯ï¼Œåˆ™åº”åˆ†åˆ«åˆ›å»ºåä¸º<code>format_en_GB.properties</code>ï¼Œ<code>exceptions_en_GB.properties</code>å’Œ<code>windows_en_GB.properties</code>çš„æ–‡ä»¶ã€‚</p><p>é€šå¸¸ï¼ŒåŒºåŸŸè®¾ç½®è§£æç”±åº”ç”¨ç¨‹åºçš„ç¯å¢ƒé…ç½®ç®¡ç†ã€‚åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œæ‰‹åŠ¨æŒ‡å®šè§£æï¼ˆè‹±å›½ï¼‰æ¶ˆæ¯çš„åŒºåŸŸè®¾ç½®ï¼š</p><p># in exceptions_en_GB.properties argument.required&#x3D;Ebagum lad, the {0} argument is required, I say, required.</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params">final <span class="hljs-built_in">String</span>[] args</span>) &#123;<br><br>    <span class="hljs-title class_">MessageSource</span> resources = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathXmlApplicationContext</span>(<span class="hljs-string">&quot;beans.xml&quot;</span>);<br><br>    <span class="hljs-title class_">String</span> message = resources.<span class="hljs-title function_">getMessage</span>(<span class="hljs-string">&quot;argument.required&quot;</span>,<br><br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span> [] &#123;<span class="hljs-string">&quot;userDao&quot;</span>&#125;, <span class="hljs-string">&quot;Required&quot;</span>, <span class="hljs-title class_">Locale</span>.<span class="hljs-property">UK</span>);<br><br>    <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(message);<br><br>&#125;<br></code></pre></td></tr></table></figure><p>è¿è¡Œä¸Šè¿°ç¨‹åºäº§ç”Ÿçš„ç»“æœå¦‚ä¸‹:</p><p>Ebagum lad, the â€˜userDaoâ€™ argument is required, I say, required.</p><p>æ‚¨è¿˜å¯ä»¥ä½¿ç”¨<code>MessageSourceAware</code>æ¥å£è·å–å¯¹å·²å®šä¹‰çš„ä»»ä½•<code>MessageSource</code>çš„å¼•ç”¨ã€‚ åœ¨åˆ›å»ºå’Œé…ç½®beanæ—¶ï¼Œåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡çš„<code>MessageSource</code>ä¼šæ³¨å…¥å®ç°<code>MessageSourceAware</code>æ¥å£çš„<code>ApplicationContext</code>ä¸­å®šä¹‰çš„ä»»ä½•beanã€‚</p><p>ä½œä¸º<code>ResourceBundleMessageSource</code>çš„æ›¿ä»£ï¼ŒSpringæä¾›äº†ä¸€ä¸ª<code>ReloadableResourceBundleMessageSource</code>ç±»ã€‚ æ­¤å˜ä½“æ”¯æŒç›¸åŒçš„bundleæ–‡ä»¶æ ¼å¼ï¼Œä½†æ¯”åŸºäºæ ‡å‡†JDKçš„<code>ResourceBundleMessageSource</code>å®ç°æ›´çµæ´»ã€‚ç‰¹åˆ«æ˜¯ï¼Œå®ƒå…è®¸ä»ä»»ä½•Springèµ„æºä½ç½®ï¼ˆä¸ä»…ä»ç±»è·¯å¾„ï¼‰è¯»å–æ–‡ä»¶ï¼Œå¹¶æ”¯æŒbundleå±æ€§æ–‡ä»¶çš„çƒ­é‡æ–°åŠ è½½ï¼ˆåŒæ—¶åœ¨å…¶é—´æœ‰æ•ˆåœ°ç¼“å­˜å®ƒä»¬ï¼‰ã€‚ æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://docs.spring.io/spring-framework/docs/5.1.3.BUILD-SNAPSHOT/javadoc-api/org/springframework/context/support/ReloadableResourceBundleMessageSource.html"><code>ReloadableResourceBundleMessageSource</code></a> javadocã€‚</p><h4 id="1-15-2-æ ‡å‡†å’Œè‡ªå®šä¹‰äº‹ä»¶"><a href="#1-15-2-æ ‡å‡†å’Œè‡ªå®šä¹‰äº‹ä»¶" class="headerlink" title="1.15.2. æ ‡å‡†å’Œè‡ªå®šä¹‰äº‹ä»¶"></a>1.15.2. æ ‡å‡†å’Œè‡ªå®šä¹‰äº‹ä»¶</h4><p><code>ApplicationContext</code>ä¸­çš„äº‹ä»¶å¤„ç†æ˜¯é€šè¿‡<code>ApplicationEvent</code>ç±»å’Œ<code>ApplicationListener</code>æ¥å£æä¾›çš„ã€‚å¦‚æœå°†å®ç°<code>ApplicationListener</code>æ¥å£çš„beanéƒ¨ç½²åˆ°ä¸Šä¸‹æ–‡ä¸­ï¼Œåˆ™æ¯æ¬¡å°†<code>ApplicationEvent</code>å‘å¸ƒåˆ°<code>ApplicationContext</code>æ—¶ï¼Œéƒ½ä¼šé€šçŸ¥è¯¥beanã€‚ ä»æœ¬è´¨ä¸Šè®²ï¼Œè¿™æ˜¯æ ‡å‡†çš„Observerè®¾è®¡æ¨¡å¼ã€‚</p><p>ä»Spring 4.2å¼€å§‹ï¼Œäº‹ä»¶æ¶æ„å·²ç»å¾—åˆ°æ˜¾ç€æ”¹è¿›ï¼Œå¹¶æä¾›äº†ä¸€ä¸ª<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#context-functionality-events-annotation">åŸºäºæ³¨è§£çš„æ¨¡å‹</a>ä½¿å…¶æœ‰å‘å¸ƒä»»æ„äº‹ä»¶çš„èƒ½åŠ›ï¼ˆå³ï¼Œä¸ä¸€å®šä»<code>ApplicationEvent</code>æ‰©å±•çš„å¯¹è±¡ï¼‰ ã€‚å½“å‘å¸ƒè¿™æ ·çš„å¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬å°†å®ƒåŒ…è£…åœ¨ä¸€ä¸ªäº‹ä»¶ä¸­ã€‚</p><p>ä¸‹è¡¨æè¿°äº†Springæä¾›çš„æ ‡å‡†äº‹ä»¶ï¼š:</p><p>Table 7. Built-in Events</p><table><thead><tr><th>äº‹ä»¶</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>ContextRefreshedEvent</code></td><td>åˆå§‹åŒ–æˆ–åˆ·æ–°<code>ApplicationContext</code>æ—¶å‘å¸ƒï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡ä½¿ç”¨<code>ConfigurableApplicationContext</code> æ¥å£ä¸Šçš„<code>refresh()</code> æ–¹æ³•ï¼‰ã€‚ è¿™é‡Œï¼Œâ€œinitializedâ€æ„å‘³ç€åŠ è½½æ‰€æœ‰beanï¼Œæ£€æµ‹å¹¶æ¿€æ´»beançš„åç½®å¤„ç†å™¨ï¼Œé¢„å…ˆå®ä¾‹åŒ–å•ä¾‹ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨<code>ApplicationContext</code>å¯¹è±¡ã€‚ åªè¦ä¸Šä¸‹æ–‡å°šæœªå…³é—­ï¼Œåªè¦æ‰€é€‰çš„<code>ApplicationContext</code>å®é™…æ”¯æŒè¿™ç§â€œçƒ­â€åˆ·æ–°ï¼Œå°±å¯ä»¥å¤šæ¬¡è§¦å‘åˆ·æ–°ã€‚ ä¾‹å¦‚ï¼Œ<code>XmlWebApplicationContext</code>æ”¯æŒçƒ­åˆ·æ–°ï¼Œä½†<code>GenericApplicationContext</code> ä¸æ”¯æŒã€‚</td></tr><tr><td><code>ContextStartedEvent</code></td><td>é€šè¿‡ä½¿ç”¨<code>ConfigurableApplicationContext</code>æ¥å£ä¸Šçš„<code>start()</code>æ–¹æ³•å¯åŠ¨<code>ApplicationContext</code> æ—¶å‘å¸ƒã€‚ é€šå¸¸ï¼Œæ­¤ä¿¡å·ç”¨äºåœ¨æ˜¾å¼åœæ­¢åé‡æ–°å¯åŠ¨Beanï¼Œä½†å®ƒä¹Ÿå¯ç”¨äºå¯åŠ¨å°šæœªä¸ºè‡ªåŠ¨å¯åŠ¨é…ç½®çš„ç»„ä»¶ï¼ˆä¾‹å¦‚ï¼Œåœ¨åˆå§‹åŒ–æ—¶å°šæœªå¯åŠ¨çš„ç»„ä»¶ï¼‰ã€‚</td></tr><tr><td><code>ContextStoppedEvent</code></td><td>é€šè¿‡ä½¿ç”¨<code>ConfigurableApplicationContext</code>æ¥å£ä¸Šçš„<code>close()</code> æ–¹æ³•åœæ­¢<code>ApplicationContext</code>æ—¶å‘å¸ƒã€‚ è¿™é‡Œï¼Œâ€œå·²åœæ­¢â€è¡¨ç¤ºæ‰€æœ‰ç”Ÿå‘½å‘¨æœŸbeanéƒ½ä¼šæ”¶åˆ°æ˜ç¡®çš„åœæ­¢ä¿¡å·ã€‚ å¯ä»¥é€šè¿‡<code>start()</code>è°ƒç”¨é‡æ–°å¯åŠ¨å·²åœæ­¢çš„ä¸Šä¸‹æ–‡ã€‚</td></tr><tr><td><code>ContextClosedEvent</code></td><td>é€šè¿‡ä½¿ç”¨<code>ConfigurableApplicationContext</code>æ¥å£ä¸Šçš„<code>close()</code>æ–¹æ³•å…³é—­<code>ApplicationContext</code>æ—¶å‘å¸ƒã€‚ è¿™é‡Œï¼Œ â€œå…³é—­â€ æ„å‘³ç€æ‰€æœ‰å•ä¾‹beanéƒ½è¢«é”€æ¯ã€‚ å°é—­çš„ç¯å¢ƒè¾¾åˆ°å…¶å¯¿å‘½ç»ˆç»“ã€‚ å®ƒæ— æ³•åˆ·æ–°æˆ–é‡æ–°å¯åŠ¨ã€‚</td></tr><tr><td><code>RequestHandledEvent</code></td><td>ä¸€ä¸ªç‰¹å®šäºWebçš„äº‹ä»¶ï¼Œå‘Šè¯‰æ‰€æœ‰beanå·²ç»ä¸ºHTTPè¯·æ±‚æä¾›æœåŠ¡ã€‚ è¯·æ±‚å®Œæˆåå‘å¸ƒæ­¤äº‹ä»¶ã€‚ æ­¤äº‹ä»¶ä»…é€‚ç”¨äºä½¿ç”¨Springçš„DispatcherServletçš„Webåº”ç”¨ç¨‹åºã€‚</td></tr></tbody></table><p>æ‚¨è¿˜å¯ä»¥åˆ›å»ºå’Œå‘å¸ƒè‡ªå·±çš„è‡ªå®šä¹‰äº‹ä»¶ã€‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†ä¸€ä¸ªæ‰©å±•Springçš„<code>ApplicationEvent</code>åŸºç±»çš„ç®€å•ç±»ï¼š</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs scala">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BlackListEvent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ApplicationEvent</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> address;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> content;<br>    public <span class="hljs-type">BlackListEvent</span>(<span class="hljs-type">Object</span> source, <span class="hljs-type">String</span> address, <span class="hljs-type">String</span> content) &#123;        <span class="hljs-keyword">super</span>(source);        <span class="hljs-keyword">this</span>.address = address;        <span class="hljs-keyword">this</span>.content = content;    &#125;<br>    <span class="hljs-comment">// accessor and other methods...&#125;</span><br></code></pre></td></tr></table></figure><p>è¦å‘å¸ƒè‡ªå®šä¹‰<code>ApplicationEvent</code>ï¼Œè¯·åœ¨<code>ApplicationEventPublisher</code>ä¸Šè°ƒç”¨<code>publishEvent()</code>æ–¹æ³•ã€‚ é€šå¸¸ï¼Œè¿™æ˜¯é€šè¿‡åˆ›å»ºä¸€ä¸ªå®ç° <code>ApplicationEventPublisherAware</code>å¹¶å°†å…¶æ³¨å†Œä¸ºSpring beançš„ç±»æ¥å®Œæˆçš„ã€‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†è¿™æ ·ä¸€ä¸ªç±»ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EmailService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ApplicationEventPublisherAware</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">String</span>&gt; blackList;    <span class="hljs-keyword">private</span> <span class="hljs-title class_">ApplicationEventPublisher</span> publisher;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setBlackList</span>(<span class="hljs-params">List&lt;<span class="hljs-built_in">String</span>&gt; blackList</span>) &#123;        <span class="hljs-variable language_">this</span>.<span class="hljs-property">blackList</span> = blackList;    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setApplicationEventPublisher</span>(<span class="hljs-params">ApplicationEventPublisher publisher</span>) &#123;        <span class="hljs-variable language_">this</span>.<span class="hljs-property">publisher</span> = publisher;    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">sendEmail</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> address, <span class="hljs-built_in">String</span> content</span>) &#123;        <span class="hljs-keyword">if</span> (blackList.<span class="hljs-title function_">contains</span>(address)) &#123;            publisher.<span class="hljs-title function_">publishEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BlackListEvent</span>(<span class="hljs-variable language_">this</span>, address, content));            <span class="hljs-keyword">return</span>;        &#125;        <span class="hljs-comment">// send email...    &#125;&#125;</span><br></code></pre></td></tr></table></figure><p>åœ¨é…ç½®æ—¶ï¼ŒSpringå®¹å™¨æ£€æµ‹åˆ°<code>EmailService</code>å®ç°<code>ApplicationEventPublisherAware</code>å¹¶è‡ªåŠ¨è°ƒç”¨<code>setApplicationEventPublisher()</code>ã€‚ å®é™…ä¸Šï¼Œä¼ å…¥çš„å‚æ•°æ˜¯Springå®¹å™¨æœ¬èº«ã€‚ æ‚¨æ­£åœ¨é€šè¿‡å…¶<code>ApplicationEventPublisher</code>æ¥å£ä¸åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡è¿›è¡Œäº¤äº’ã€‚</p><p>è¦æ¥æ”¶è‡ªå®šä¹‰ <code>ApplicationEvent</code>ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªå®ç°<code>ApplicationListener</code>çš„ç±»å¹¶å°†å…¶æ³¨å†Œä¸ºSpring beanã€‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†è¿™æ ·ä¸€ä¸ªç±»ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BlackListNotifier</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ApplicationListener</span>&lt;<span class="hljs-title class_">BlackListEvent</span>&gt; &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> notificationAddress;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setNotificationAddress</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> notificationAddress</span>) &#123;        <span class="hljs-variable language_">this</span>.<span class="hljs-property">notificationAddress</span> = notificationAddress;    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">onApplicationEvent</span>(<span class="hljs-params">BlackListEvent event</span>) &#123;        <span class="hljs-comment">// notify appropriate parties via notificationAddress...    &#125;&#125;</span><br></code></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œ<code>ApplicationListener</code>é€šå¸¸ä½¿ç”¨è‡ªå®šä¹‰äº‹ä»¶çš„ç±»å‹è¿›è¡Œå‚æ•°åŒ–ï¼ˆå‰é¢ç¤ºä¾‹ä¸­ä¸º<code>BlackListEvent</code>ï¼‰ã€‚è¿™æ„å‘³ç€<code>onApplicationEvent()</code>æ–¹æ³•å¯ä»¥ä¿æŒç±»å‹å®‰å…¨ï¼Œä»è€Œé¿å…ä»»ä½•å‘ä¸‹è½¬æ¢çš„éœ€è¦ã€‚ æ‚¨å¯ä»¥æ ¹æ®éœ€è¦æ³¨å†Œä»»æ„æ•°é‡çš„äº‹ä»¶ä¾¦å¬å™¨ï¼Œä½†è¯·æ³¨æ„ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œäº‹ä»¶ä¾¦å¬å™¨ä¼šåŒæ­¥æ¥æ”¶äº‹ä»¶ã€‚è¿™æ„å‘³ç€<code>publishEvent()</code>æ–¹æ³•å°†é˜»å¡ï¼Œç›´åˆ°æ‰€æœ‰ä¾¦å¬å™¨éƒ½å·²å®Œæˆå¯¹äº‹ä»¶çš„å¤„ç†ã€‚ è¿™ç§åŒæ­¥å’Œå•çº¿ç¨‹æ–¹æ³•çš„ä¸€ä¸ªä¼˜ç‚¹æ˜¯ï¼Œå½“ä¾¦å¬å™¨æ¥æ”¶åˆ°äº‹ä»¶æ—¶ï¼Œå¦‚æœäº‹åŠ¡ä¸Šä¸‹æ–‡å¯ç”¨ï¼Œå®ƒå°†åœ¨å‘å¸ƒè€…çš„äº‹åŠ¡ä¸Šä¸‹æ–‡å†…è¿è¡Œã€‚å¦‚æœéœ€è¦å¦ä¸€ä¸ªäº‹ä»¶å‘å¸ƒç­–ç•¥ï¼Œè¯·å‚é˜…Springçš„<a href="https://docs.spring.io/spring-framework/docs/5.1.3.BUILD-SNAPSHOT/javadoc-api/org/springframework/context/event/ApplicationEventMulticaster.html"><code>ApplicationEventMulticaster</code></a>æ¥å£çš„javadocã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†ç”¨äºæ³¨å†Œå’Œé…ç½®ä¸Šè¿°æ¯ä¸ªç±»çš„beanå®šä¹‰:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;emailService&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;example.EmailService&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;blackList&quot;</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>[email protected]<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>[email protected]<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>[email protected]<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;blackListNotifier&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;example.BlackListNotifier&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;notificationAddress&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;[email protected]&quot;</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æ€»è€Œè¨€ä¹‹ï¼Œå½“è°ƒç”¨<code>emailService</code> beançš„<code>sendEmail()</code>æ–¹æ³•æ—¶ï¼Œå¦‚æœæœ‰ä»»ä½•åº”åˆ—å…¥é»‘åå•çš„ç”µå­é‚®ä»¶æ¶ˆæ¯ï¼Œåˆ™ä¼šå‘å¸ƒ<code>BlackListEvent</code>ç±»å‹çš„è‡ªå®šä¹‰äº‹ä»¶ã€‚ <code>blackListNotifier</code> beanæ³¨å†Œä¸º<code>ApplicationListener</code> å¹¶æ¥æ”¶<code>BlackListEvent</code> ï¼Œæ­¤æ—¶å®ƒå¯ä»¥é€šçŸ¥ç›¸å…³æ–¹ã€‚</p><p>Springçš„äº‹ä»¶æœºåˆ¶æ˜¯ä¸ºåœ¨åŒä¸€åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­çš„Spring beanä¹‹é—´çš„ç®€å•é€šä¿¡è€Œè®¾è®¡çš„ã€‚ä½†æ˜¯ï¼Œå¯¹äºæ›´å¤æ‚çš„ä¼ä¸šé›†æˆéœ€æ±‚ï¼Œå•ç‹¬ç»´æŠ¤çš„<a href="https://projects.spring.io/spring-integration/">Spring Integration</a> é¡¹ç›®æä¾›äº†å®Œæ•´çš„æ”¯æŒå¹¶å¯ç”¨äºæ„å»ºè½»é‡çº§ï¼Œ<a href="http://www.enterpriseintegrationpatterns.com/">pattern-oriented</a>(é¢å‘æ¨¡å¼ï¼‰ï¼Œä¾èµ–Springç¼–ç¨‹æ¨¡å‹çš„äº‹ä»¶é©±åŠ¨æ¶æ„ã€‚</p><h5 id="åŸºäºæ³¨è§£çš„äº‹ä»¶ç›‘å¬å™¨"><a href="#åŸºäºæ³¨è§£çš„äº‹ä»¶ç›‘å¬å™¨" class="headerlink" title="åŸºäºæ³¨è§£çš„äº‹ä»¶ç›‘å¬å™¨"></a>åŸºäºæ³¨è§£çš„äº‹ä»¶ç›‘å¬å™¨</h5><p>ä»Spring 4.2å¼€å§‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<code>EventListener</code>æ³¨è§£åœ¨æ‰˜ç®¡beançš„ä»»ä½•å…¬å…±æ–¹æ³•ä¸Šæ³¨å†Œäº‹ä»¶ç›‘å¬å™¨ã€‚ <code>BlackListNotifier</code>å¯ä»¥é‡å†™å¦‚ä¸‹ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BlackListNotifier</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> notificationAddress;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setNotificationAddress</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> notificationAddress</span>) &#123;        <span class="hljs-variable language_">this</span>.<span class="hljs-property">notificationAddress</span> = notificationAddress;    &#125;<br>    <span class="hljs-meta">@EventListener</span>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">processBlackListEvent</span>(<span class="hljs-params">BlackListEvent event</span>) &#123;        <span class="hljs-comment">// notify appropriate parties via notificationAddress...    &#125;&#125;</span><br></code></pre></td></tr></table></figure><p>æ–¹æ³•ç­¾åå†æ¬¡å£°æ˜å®ƒä¾¦å¬çš„äº‹ä»¶ç±»å‹ï¼Œä½†è¿™æ¬¡ä½¿ç”¨çµæ´»çš„åç§°å¹¶ä¸”æ²¡æœ‰å®ç°ç‰¹å®šçš„ä¾¦å¬å™¨æ¥å£ã€‚åªè¦å®é™…äº‹ä»¶ç±»å‹åœ¨å…¶å®ç°å±‚æ¬¡ç»“æ„ä¸­è§£æé€šç”¨å‚æ•°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ³›å‹ç¼©å°äº‹ä»¶ç±»å‹ã€‚</p><p>å¦‚æœæ‚¨çš„æ–¹æ³•åº”è¯¥ç›‘å¬å¤šä¸ªäº‹ä»¶ï¼Œæˆ–è€…æ‚¨æƒ³è¦æ ¹æ®ä»»ä½•å‚æ•°è¿›è¡Œå®šä¹‰ï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥åœ¨æ³¨è§£æœ¬èº«ä¸ŠæŒ‡å®šäº‹ä»¶ç±»å‹ã€‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œï¼š:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs csharp">@EventListener(&#123;ContextStartedEvent.<span class="hljs-keyword">class</span>, ContextRefreshedEvent.<span class="hljs-keyword">class</span>&#125;)<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handleContextStart</span>()</span> &#123;<br><br>    ...<br><br>&#125;<br></code></pre></td></tr></table></figure><p>è¿˜å¯ä»¥é€šè¿‡ä½¿ç”¨å®šä¹‰<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#expressions"><code>SpEL</code> è¡¨è¾¾å¼</a>çš„æ³¨è§£çš„<code>condition</code>å±æ€§æ¥æ·»åŠ é¢å¤–çš„è¿è¡Œæ—¶è¿‡æ»¤ï¼Œè¯¥è¡¨è¾¾å¼åº”åŒ¹é…ä»¥å®é™…è°ƒç”¨ç‰¹å®šäº‹ä»¶çš„æ–¹æ³•ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†ä»…å½“äº‹ä»¶çš„<code>content</code>å±æ€§ç­‰äº<code>my-event</code>æ—¶æ‰èƒ½é‡å†™æˆ‘ä»¬çš„é€šçŸ¥ç¨‹åºä»¥è¿›è¡Œè°ƒç”¨ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@EventListener</span>(condition = <span class="hljs-string">&quot;#blEvent.content == &#x27;my-event&#x27;&quot;</span>)<br><br><span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">processBlackListEvent</span>(<span class="hljs-params">BlackListEvent blEvent</span>) &#123;<br><br>    <span class="hljs-comment">// notify appropriate parties via notificationAddress...</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p>æ¯ä¸ª<code>SpEL</code>è¡¨è¾¾å¼éƒ½é’ˆå¯¹ä¸“ç”¨ä¸Šä¸‹æ–‡è¿›è¡Œè¯„ä¼°ã€‚ ä¸‹è¡¨åˆ—å‡ºäº†å¯ç”¨äºä¸Šä¸‹æ–‡çš„é¡¹ç›®ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥å°†å®ƒä»¬ç”¨äºæ¡ä»¶äº‹ä»¶å¤„ç†ï¼š</p><p>Table 8. äº‹ä»¶SpELå¯ç”¨çš„å…ƒæ•°æ®</p><table><thead><tr><th>åå­—</th><th>ä½ç½®</th><th>æè¿°</th><th>ä¾‹å­</th></tr></thead><tbody><tr><td>Event</td><td>root</td><td>å®é™…<code>ApplicationEvent</code></td><td><code>#root.event</code></td></tr><tr><td>Arguments array</td><td>root object</td><td>ç”¨äºè°ƒç”¨ç›®æ ‡çš„å‚æ•°ï¼ˆä½œä¸ºæ•°ç»„ï¼‰</td><td><code>#root.args[0]</code></td></tr><tr><td><em>Argument name</em></td><td>evaluation context</td><td>ä»»ä½•æ–¹æ³•å‚æ•°çš„åç§°ã€‚ å¦‚æœç”±äºæŸç§åŸå› ï¼Œåç§°ä¸å¯ç”¨ï¼ˆä¾‹å¦‚ï¼Œå› ä¸ºæ²¡æœ‰è°ƒè¯•ä¿¡æ¯ï¼‰ï¼Œå‚æ•°åç§°ä¹Ÿå¯ä»¥åœ¨#a <code>#a&lt;#arg&gt;</code>ä¸‹è·å¾—ï¼Œå…¶ä¸­<code>#arg</code>ä»£è¡¨å‚æ•°ç´¢å¼•ï¼ˆä»0å¼€å§‹ï¼‰ã€‚</td><td><code>#blEvent</code> or <code>#a0</code> (you can also use <code>#p0</code> or <code>#p&lt;#arg&gt;</code> notation as an alias)</td></tr></tbody></table><p>è¯·æ³¨æ„ï¼Œå³ä½¿æ‚¨çš„æ–¹æ³•ç­¾åå®é™…å¼•ç”¨å·²å‘å¸ƒçš„ä»»æ„å¯¹è±¡ï¼Œ<code>#root.event</code>ä¹Ÿå…è®¸æ‚¨è®¿é—®åŸºç¡€äº‹ä»¶ã€‚</p><p>å¦‚æœéœ€è¦å‘å¸ƒä¸€ä¸ªäº‹ä»¶ä½œä¸ºå¤„ç†å¦ä¸€ä¸ªäº‹ä»¶çš„ç»“æœï¼Œåˆ™å¯ä»¥æ›´æ”¹æ–¹æ³•ç­¾åä»¥è¿”å›åº”å‘å¸ƒçš„äº‹ä»¶ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@EventListener</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-title class_">ListUpdateEvent</span> <span class="hljs-title function_">handleBlackListEvent</span>(<span class="hljs-params">BlackListEvent event</span>) &#123;<br><br>    <span class="hljs-comment">// notify appropriate parties via notificationAddress and</span><br><br>    <span class="hljs-comment">// then publish a ListUpdateEvent...</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p><a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#context-functionality-events-async">å¼‚æ­¥ä¾¦å¬å™¨</a>ä¸æ”¯æŒæ­¤åŠŸèƒ½ã€‚</p><p>è¿™å°†é€šè¿‡ä¸Šè¿°æ–¹æ³•å¤„ç†æ¯ä¸ª<code>BlackListEvent</code>å¹¶å‘å¸ƒä¸€ä¸ªæ–°çš„<code>ListUpdateEvent</code>ï¼Œå¦‚æœéœ€è¦å‘å¸ƒå¤šä¸ªäº‹ä»¶ï¼Œåˆ™å¯ä»¥è¿”å›äº‹ä»¶ <code>é›†åˆ</code>ã€‚</p><h5 id="å¼‚æ­¥çš„ç›‘å¬å™¨"><a href="#å¼‚æ­¥çš„ç›‘å¬å™¨" class="headerlink" title="å¼‚æ­¥çš„ç›‘å¬å™¨"></a>å¼‚æ­¥çš„ç›‘å¬å™¨</h5><p>å¦‚æœå¸Œæœ›ç‰¹å®šä¾¦å¬å™¨å¼‚æ­¥å¤„ç†äº‹ä»¶ï¼Œåˆ™å¯ä»¥é‡ç”¨<a href="https://github.com/DocsHome/spring-docs/blob/master/pages/integration/integration.md#scheduling-annotation-support-async">å¸¸è§„ <code>@Async</code>æ”¯æŒ</a>ã€‚ ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@EventListener</span><br><br><span class="hljs-variable">@Async</span><br><br>public void <span class="hljs-built_in">processBlackListEvent</span>(BlackListEvent event) &#123;<br><br>    <span class="hljs-comment">// BlackListEvent is processed in a separate thread</span><br><br>&#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨å¼‚æ­¥äº‹ä»¶æ—¶è¯·æ³¨æ„ä»¥ä¸‹é™åˆ¶:</p><ul><li>å¦‚æœäº‹ä»¶ä¾¦å¬å™¨æŠ›å‡º<code>Exception</code>ï¼Œåˆ™ä¸ä¼šå°†å…¶ä¼ æ’­ç»™è°ƒç”¨è€…ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… <code>AsyncUncaughtExceptionHandler</code>ã€‚</li><li>æ­¤ç±»äº‹ä»¶ç›‘å¬å™¨æ— æ³•å‘é€å›å¤ã€‚ å¦‚æœæ‚¨éœ€è¦ä½œä¸ºå¤„ç†ç»“æœå‘é€å¦ä¸€ä¸ªäº‹ä»¶ï¼Œè¯·æ³¨å…¥<a href="https://docs.spring.io/spring-framework/docs/5.1.3.BUILD-SNAPSHOT/javadoc-api/org/springframework/aop/interceptor/AsyncUncaughtExceptionHandler.html"><code>ApplicationEventPublisher</code></a>ä»¥æ‰‹åŠ¨å‘é€äº‹ä»¶ã€‚</li></ul><h5 id="ç›‘å¬å™¨çš„æ’åº"><a href="#ç›‘å¬å™¨çš„æ’åº" class="headerlink" title="ç›‘å¬å™¨çš„æ’åº"></a>ç›‘å¬å™¨çš„æ’åº</h5><p>å¦‚æœéœ€è¦åœ¨å¦ä¸€ä¸ªä¾¦å¬å™¨ä¹‹å‰è°ƒç”¨ä¸€ä¸ªä¾¦å¬å™¨ï¼Œåˆ™å¯ä»¥å°†<code>@Order</code>æ³¨è§£æ·»åŠ åˆ°æ–¹æ³•å£°æ˜ä¸­ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@EventListener</span><br><br><span class="hljs-variable">@Order</span>(<span class="hljs-number">42</span>)<br><br>public void <span class="hljs-built_in">processBlackListEvent</span>(BlackListEvent event) &#123;<br><br>    <span class="hljs-comment">// notify appropriate parties via notificationAddress...</span><br><br>&#125;<br></code></pre></td></tr></table></figure><h5 id="æ³›å‹çš„äº‹ä»¶"><a href="#æ³›å‹çš„äº‹ä»¶" class="headerlink" title="æ³›å‹çš„äº‹ä»¶"></a>æ³›å‹çš„äº‹ä»¶</h5><p>æ‚¨è¿˜å¯ä»¥ä½¿ç”¨æ³›å‹æ¥è¿›ä¸€æ­¥å®šä¹‰äº‹ä»¶çš„ç»“æ„ã€‚ è€ƒè™‘ä½¿ç”¨<code>EntityCreatedEvent&lt;T&gt;</code>ï¼Œå…¶ä¸­<code>T</code>æ˜¯åˆ›å»ºçš„å®é™…å®ä½“çš„ç±»å‹ã€‚ ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä»¥ä¸‹ä¾¦å¬å™¨å®šä¹‰ä»¥ä»…æ¥æ”¶<code>Person</code>çš„<code>EntityCreatedEvent</code>ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@EventListener</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">onPersonCreated</span>(<span class="hljs-params">EntityCreatedEvent&lt;Person&gt; event</span>) &#123;<br><br>    ...<br><br>&#125;<br></code></pre></td></tr></table></figure><p>ç”±äºæ³›å‹æ“¦é™¤ï¼Œåªæœ‰æ­¤äº‹ä»¶ç¬¦åˆäº‹ä»¶ç›‘å¬å™¨æ‰€è¿‡æ»¤çš„é€šç”¨å‚æ•°æ¡ä»¶é‚£ä¹ˆæ‰ä¼šè§¦å‘ç›¸åº”çš„å¤„ç†äº‹ä»¶(æœ‰ç‚¹ç±»ä¼¼äº<code>class PersonCreatedEvent extends EntityCreatedEvent&lt;Person&gt; &#123; â€¦ &#125;</code>ï¼‰</p><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¦‚æœæ‰€æœ‰äº‹ä»¶éµå¾ªç›¸åŒçš„ç»“æ„(å¦‚ä¸Šè¿°äº‹ä»¶çš„æƒ…å†µï¼‰ï¼Œè¿™å¯èƒ½å˜å¾—ç›¸å½“ä¹å‘³ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¼€å‘è€…å¯ä»¥å®ç°<code>ResolvableTypeProvider</code>æ¥å¼•å¯¼æ¡†æ¶è¶…å‡ºæ‰€æä¾›çš„è¿è¡Œæ—¶ç¯å¢ƒèŒƒå›´ã€‚</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs scala">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EntityCreatedEvent&lt;T&gt;</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ApplicationEvent</span> <span class="hljs-title">implements</span> <span class="hljs-title">ResolvableTypeProvider</span> </span>&#123;<br>    public <span class="hljs-type">EntityCreatedEvent</span>(<span class="hljs-type">T</span> entity) &#123;        <span class="hljs-keyword">super</span>(entity);    &#125;<br>    <span class="hljs-meta">@Override</span>    public <span class="hljs-type">ResolvableType</span> getResolvableType() &#123;        <span class="hljs-keyword">return</span> <span class="hljs-type">ResolvableType</span>.forClassWithGenerics(getClass(), <span class="hljs-type">ResolvableType</span>.forInstance(getSource()));    &#125;&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ä»…é€‚ç”¨äº<code>ApplicationEvent</code> ï¼Œä¹Ÿé€‚ç”¨äºä½œä¸ºäº‹ä»¶å‘é€çš„ä»»æ„å¯¹è±¡ã€‚</p><h4 id="1-15-3-é€šè¿‡ä¾¿æ·çš„æ–¹å¼è®¿é—®åº•å±‚èµ„æº"><a href="#1-15-3-é€šè¿‡ä¾¿æ·çš„æ–¹å¼è®¿é—®åº•å±‚èµ„æº" class="headerlink" title="1.15.3.é€šè¿‡ä¾¿æ·çš„æ–¹å¼è®¿é—®åº•å±‚èµ„æº"></a>1.15.3.é€šè¿‡ä¾¿æ·çš„æ–¹å¼è®¿é—®åº•å±‚èµ„æº</h4><p>ä¸ºäº†æœ€ä½³åœ°ä½¿ç”¨å’Œç†è§£åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ï¼Œæ‚¨åº”è¯¥ç†Ÿæ‚‰Springçš„èµ„æºæŠ½è±¡ï¼Œå¦‚å‚è€ƒèµ„æ–™ä¸­æ‰€è¿°<a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#resources">èµ„æº</a>ã€‚</p><p>åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡æ˜¯<code>ResourceLoader</code>ï¼Œå¯ç”¨äºåŠ è½½<code>Resource</code>å¯¹è±¡ã€‚ <code>Resource</code>æœ¬è´¨ä¸Šæ˜¯JDK<code>java.net.URL</code>ç±»çš„åŠŸèƒ½æ›´ä¸°å¯Œçš„ç‰ˆæœ¬ã€‚å®é™…ä¸ŠResourceçš„å®ç°ç±»ä¸­å¤§å¤šå«æœ‰<code>java.net.URL</code>çš„å®ä¾‹ã€‚ <code>Resource</code>å‡ ä¹èƒ½ä»ä»»ä½•åœ°æ–¹é€æ˜çš„è·å–åº•å±‚èµ„æºï¼Œå¯ä»¥æ˜¯classpathç±»è·¯å¾„ã€æ–‡ä»¶ç³»ç»Ÿã€æ ‡å‡†çš„URLèµ„æºåŠå˜ç§URLèµ„æºã€‚å¦‚æœèµ„æºå®šä½å­—ä¸²æ˜¯ç®€å•çš„è·¯å¾„ï¼Œ æ²¡æœ‰ä»»ä½•ç‰¹æ®Šå‰ç¼€ï¼Œå°±é€‚åˆäºå®é™…åº”ç”¨ä¸Šä¸‹æ–‡ç±»å‹ã€‚</p><p>å¯ä»¥é…ç½®ä¸€ä¸ªbeanéƒ¨ç½²åˆ°åº”ç”¨ä¸Šä¸‹æ–‡ä¸­ï¼Œç”¨ä»¥å®ç°ç‰¹æ®Šçš„å›è°ƒæ¥å£ï¼Œ<code>ResourceLoaderAware</code>å®ƒä¼šåœ¨åˆå§‹åŒ–æœŸé—´è‡ªåŠ¨å›è°ƒã€‚åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡æœ¬èº«ä½œä¸º<code>ResourceLoader</code>ä¼ å…¥ã€‚å¯ä»¥å…¬å¼€<code>Resource</code>çš„typeå±æ€§ï¼Œè¿™æ ·å°±å¯ä»¥è®¿é—®é™æ€èµ„æº é™æ€èµ„æºå¯ä»¥åƒå…¶ä»–propertiesé‚£æ ·è¢«æ³¨å…¥<code>Resource</code>ã€‚å¯ä»¥ä½¿ç”¨ç®€å•çš„å­—ä¸²è·¯å¾„æŒ‡å®šèµ„æºï¼Œè¿™éœ€è¦ä¾èµ–äºç‰¹æ®Šçš„JavaBean <code>PropertyEditor</code>ï¼ˆç”±ä¸Šä¸‹æ–‡è‡ªåŠ¨æ³¨å†Œï¼‰ï¼Œå½“beanéƒ¨ç½²æ—¶å€™å®ƒå°†è½¬æ¢èµ„æºä¸­çš„å­—ä¸²ä¸ºå®é™…çš„èµ„æºå¯¹è±¡ã€‚</p><p>æä¾›ç»™<code>ApplicationContext</code>æ„é€ å‡½æ•°çš„ä¸€ä¸ªæˆ–å¤šä¸ªä½ç½®è·¯å¾„å®é™…ä¸Šæ˜¯èµ„æºå­—ç¬¦ä¸²ï¼Œå¹¶ä¸”ä»¥ç®€å•å½¢å¼å¯¹ç‰¹å®šä¸Šä¸‹æ–‡å®ç°è¿›è¡Œé€‚å½“å¤„ç†ã€‚ <code>ClassPathXmlApplicationContext</code>å°†ä¸€ä¸ªç®€å•çš„å®šä½è·¯å¾„è§†ä¸ºç±»è·¯å¾„ä½ç½®ã€‚å¼€å‘è€…è¿˜å¯ä»¥ä½¿ç”¨å¸¦æœ‰ç‰¹æ®Šå‰ç¼€çš„å®šä½è·¯å¾„ï¼Œè¿™æ ·å°±å¯ä»¥å¼ºåˆ¶ä»classpathæˆ–è€…URLå®šä¹‰åŠ è½½è·¯å¾„ï¼Œ è€Œä¸ç”¨è€ƒè™‘å®é™…çš„ä¸Šä¸‹æ–‡ç±»å‹ã€‚</p><h4 id="1-15-4-å¿«é€Ÿå¯¹Webåº”ç”¨çš„ApplicationContextå®ä¾‹åŒ–"><a href="#1-15-4-å¿«é€Ÿå¯¹Webåº”ç”¨çš„ApplicationContextå®ä¾‹åŒ–" class="headerlink" title="1.15.4. å¿«é€Ÿå¯¹Webåº”ç”¨çš„ApplicationContextå®ä¾‹åŒ–"></a>1.15.4. å¿«é€Ÿå¯¹Webåº”ç”¨çš„ApplicationContextå®ä¾‹åŒ–</h4><p>å¼€å‘è€…å¯ä»¥é€šè¿‡ä½¿ç”¨<code>ContextLoader</code>æ¥å£°æ˜æ€§åœ°åˆ›å»º<code>ApplicationContext</code>å®ä¾‹ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡ä½¿ç”¨<code>ApplicationContext</code>çš„å®ç°æ¥ç¼–ç¨‹å®ç°<code>ApplicationContext</code>ã€‚</p><p>æ‚¨å¯ä»¥ä½¿ç”¨<code>ContextLoaderListener</code>æ³¨å†Œ<code>ApplicationContext</code> ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">context-param</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>contextConfigLocation<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>/WEB-INF/daoContext.xml /WEB-INF/applicationContext.xml<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">context-param</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">listener</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="hljs-tag">&lt;/<span class="hljs-name">listener-class</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">listener</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä¾¦å¬å™¨æ£€æŸ¥<code>contextConfigLocation</code>å‚æ•°ã€‚ å¦‚æœå‚æ•°ä¸å­˜åœ¨ï¼Œåˆ™ä¾¦å¬å™¨å°†<code>/WEB-INF/applicationContext.xml</code>ç”¨ä½œé»˜è®¤å€¼ã€‚ å½“å‚æ•°ç¡®å®å­˜åœ¨æ—¶ï¼Œä¾¦å¬å™¨ä½¿ç”¨é¢„å®šä¹‰çš„åˆ†éš”ç¬¦ï¼ˆé€—å·ï¼Œåˆ†å·å’Œç©ºæ ¼ï¼‰åˆ†éš”Stringï¼Œå¹¶å°†å€¼ç”¨ä½œæœç´¢åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡çš„ä½ç½®ã€‚ è¿˜æ”¯æŒAntæ ·å¼çš„è·¯å¾„æ¨¡å¼ã€‚ ç¤ºä¾‹æ˜¯<code>/WEB-INF/*Context.xml</code>ï¼ˆå¯¹äºæ‰€æœ‰åç§°ä»¥<code>Context.xml</code>ç»“å°¾ä¸”ä½äº<code>WEB-INF</code> ç›®å½•ä¸­çš„æ–‡ä»¶ï¼‰å’Œ<code>/WEB-INF/**/*Context.xml</code>ï¼ˆå¯¹äºæ‰€æœ‰è¿™æ ·çš„æ–‡ä»¶ï¼‰ <code>WEB-INF</code>çš„ä»»ä½•å­ç›®å½•ä¸­çš„æ–‡ä»¶ã€‚</p><h4 id="1-15-5-ä½¿ç”¨Java-EE-RARæ–‡ä»¶éƒ¨ç½²Springçš„ApplicationContext"><a href="#1-15-5-ä½¿ç”¨Java-EE-RARæ–‡ä»¶éƒ¨ç½²Springçš„ApplicationContext" class="headerlink" title="1.15.5. ä½¿ç”¨Java EE RARæ–‡ä»¶éƒ¨ç½²Springçš„ApplicationContext"></a>1.15.5. ä½¿ç”¨Java EE RARæ–‡ä»¶éƒ¨ç½²Springçš„<code>ApplicationContext</code></h4><p>å¯ä»¥å°†Spring <code>ApplicationContext</code>éƒ¨ç½²ä¸ºRARæ–‡ä»¶ï¼Œå°†ä¸Šä¸‹æ–‡åŠå…¶æ‰€æœ‰å¿…éœ€çš„beanç±»å’Œåº“JARå°è£…åœ¨Java EE RARéƒ¨ç½²å•å…ƒä¸­ï¼Œè¿™ç›¸å½“äºå¼•å¯¼ä¸€ä¸ªç‹¬ç«‹çš„<code>ApplicationContext</code>ã€‚ åªæ˜¯æ‰˜ç®¡åœ¨Java EEç¯å¢ƒä¸­ï¼Œèƒ½å¤Ÿè®¿é—®Java EEæœåŠ¡å™¨è®¾æ–½ã€‚åœ¨éƒ¨ç½²æ— å¤´WARæ–‡ä»¶(å®é™…ä¸Šï¼Œæ²¡æœ‰ä»»ä½•HTTPå…¥å£ç‚¹ï¼Œä»…ç”¨äºåœ¨Java EEç¯å¢ƒä¸­å¼•å¯¼Spring <code>ApplicationContext</code>çš„WARæ–‡ä»¶ï¼‰çš„æƒ…å†µä¸‹RARéƒ¨ç½²æ˜¯æ›´è‡ªç„¶çš„æ›¿ä»£æ–¹æ¡ˆ</p><p>RARéƒ¨ç½²éå¸¸é€‚åˆä¸éœ€è¦HTTPå…¥å£ç‚¹ä½†ä»…ç”±æ¶ˆæ¯ç«¯ç‚¹å’Œè°ƒåº¦ä½œä¸šç»„æˆçš„åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒBeanå¯ä»¥ä½¿ç”¨åº”ç”¨ç¨‹åºæœåŠ¡å™¨èµ„æºï¼Œ ä¾‹å¦‚JTAäº‹åŠ¡ç®¡ç†å™¨å’ŒJNDIç»‘å®šçš„JDBC <code>DataSource</code>å’ŒJMS <code>ConnectionFactory</code>å®ä¾‹ï¼Œå¹¶ä¸”è¿˜å¯ä»¥é€šè¿‡Springçš„æ ‡å‡†äº‹åŠ¡ç®¡ç†å’ŒJNDIå’ŒJMXæ”¯æŒè®¾æ–½å‘å¹³å°çš„JMXæœåŠ¡å™¨æ³¨å†Œã€‚ åº”ç”¨ç¨‹åºç»„ä»¶è¿˜å¯ä»¥é€šè¿‡Springçš„<code>TaskExecutor</code>æŠ½è±¡å®ç°ä¸åº”ç”¨ç¨‹åºæœåŠ¡å™¨çš„JCA <code>WorkManager</code> äº¤äº’</p><p>æœ‰å…³RARéƒ¨ç½²ä¸­æ¶‰åŠçš„é…ç½®è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="https://docs.spring.io/spring-framework/docs/5.1.3.BUILD-SNAPSHOT/javadoc-api/org/springframework/jca/context/SpringContextResourceAdapter.html"><code>SpringContextResourceAdapter</code></a>ç±»çš„javadoc</p><p>å¯¹äºå°†Spring ApplicationContextç®€å•éƒ¨ç½²ä¸ºJava EE RARæ–‡ä»¶ï¼š</p><ol><li>å°†æ‰€æœ‰åº”ç”¨ç¨‹åºç±»æ‰“åŒ…åˆ°ä¸€ä¸ªRARæ–‡ä»¶ï¼ˆè¿™æ˜¯ä¸€ä¸ªå…·æœ‰ä¸åŒæ–‡ä»¶æ‰©å±•åçš„æ ‡å‡†JARæ–‡ä»¶ï¼‰ã€‚å°†æ‰€æœ‰å¿…éœ€çš„åº“JARæ·»åŠ åˆ°RARå­˜æ¡£çš„æ ¹ç›®å½•ä¸­ã€‚ ã€‚æ·»åŠ <code>META-INF/ra.xml</code>éƒ¨ç½²æè¿°ç¬¦ ï¼ˆå¦‚<a href="https://docs.spring.io/spring-framework/docs/5.1.3.BUILD-SNAPSHOT/javadoc-api/org/springframework/jca/context/SpringContextResourceAdapter.html"><code>SpringContextResourceAdapter</code></a>çš„javadocæ‰€ç¤ºï¼‰ å’Œç›¸åº”çš„Spring XML beanå®šä¹‰æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯ META-INF&#x2F;applicationContext.xmlï¼‰ã€‚</li><li>å°†ç”Ÿæˆçš„RARæ–‡ä»¶æ”¾å…¥åº”ç”¨ç¨‹åºæœåŠ¡å™¨çš„éƒ¨ç½²ç›®å½•ä¸­ã€‚</li></ol><p>è¿™ç§RARéƒ¨ç½²å•å…ƒé€šå¸¸æ˜¯ç‹¬ç«‹çš„ã€‚å®ƒä»¬ä¸ä¼šå°†ç»„ä»¶æš´éœ²ç»™å¤–éƒ¨ä¸–ç•Œï¼Œç”šè‡³ä¸ä¼šæš´éœ²ç»™åŒä¸€åº”ç”¨ç¨‹åºçš„å…¶ä»–æ¨¡å—ã€‚ ä¸åŸºäºRARçš„<code>ApplicationContext</code>çš„äº¤äº’é€šå¸¸é€šè¿‡ä¸å…¶ä»–æ¨¡å—å…±äº«çš„JMSç›®æ ‡è¿›è¡Œã€‚ ä¾‹å¦‚ï¼ŒåŸºäºRARçš„<code>ApplicationContext</code>è¿˜å¯ä»¥è°ƒåº¦ä¸€äº›ä½œä¸šæˆ–å¯¹æ–‡ä»¶ç³»ç»Ÿï¼ˆç­‰ç­‰ï¼‰ä¸­çš„æ–°æ–‡ä»¶ä½œå‡ºååº”ã€‚ å¦‚æœå®ƒéœ€è¦å…è®¸æ¥è‡ªå¤–éƒ¨çš„åŒæ­¥è®¿é—®ï¼Œå®ƒå¯ä»¥ï¼ˆä¾‹å¦‚ï¼‰å¯¼å‡ºRMIç«¯ç‚¹ï¼Œè¿™å¯ä»¥ç”±åŒä¸€å°æœºå™¨ä¸Šçš„å…¶ä»–åº”ç”¨ç¨‹åºæ¨¡å—ä½¿ç”¨ã€‚</p><h3 id="1-16-BeanFactory"><a href="#1-16-BeanFactory" class="headerlink" title="1.16.BeanFactory"></a>1.16.<code>BeanFactory</code></h3><p><code>BeanFactory</code> APIä¸ºSpringçš„IoCåŠŸèƒ½æä¾›äº†åŸºç¡€ã€‚ å®ƒçš„ç‰¹å®šå¥‘çº¦ä¸»è¦ç”¨äºä¸Springçš„å…¶ä»–éƒ¨åˆ†å’Œç›¸å…³çš„ç¬¬ä¸‰æ–¹æ¡†æ¶é›†æˆå…¶<code>DefaultListableBeanFactory</code>å®ç°æ˜¯æ›´é«˜çº§åˆ«<code>GenericApplicationContext</code>å®¹å™¨ä¸­çš„å¯†é’¥å§”æ‰˜ã€‚</p><p><code>BeanFactory</code>å’Œç›¸å…³æ¥å£ï¼ˆä¾‹å¦‚<code>BeanFactoryAware</code>, <code>InitializingBean</code>ï¼Œ<code>DisposableBean</code>ï¼‰æ˜¯å…¶ä»–æ¡†æ¶ç»„ä»¶çš„é‡è¦é›†æˆç‚¹ã€‚ é€šè¿‡ä¸éœ€è¦ä»»ä½•æ³¨è§£æˆ–ç”šè‡³åå°„ï¼Œå®ƒä»¬å…è®¸å®¹å™¨ä¸å…¶ç»„ä»¶ä¹‹é—´çš„éå¸¸æœ‰æ•ˆçš„äº¤äº’ã€‚ åº”ç”¨ç¨‹åºçº§beanå¯ä»¥ä½¿ç”¨ç›¸åŒçš„å›è°ƒæ¥å£ï¼Œä½†é€šå¸¸æ›´å–œæ¬¢é€šè¿‡æ³¨è§£æˆ–é€šè¿‡ç¼–ç¨‹é…ç½®è¿›è¡Œå£°æ˜æ€§ä¾èµ–æ³¨å…¥ã€‚</p><p>è¯·æ³¨æ„ï¼Œæ ¸å¿ƒ<code>BeanFactory</code> APIçº§åˆ«åŠå…¶ <code>DefaultListableBeanFactory</code>å®ç°ä¸ä¼šå¯¹é…ç½®æ ¼å¼æˆ–è¦ä½¿ç”¨çš„ä»»ä½•ç»„ä»¶æ³¨è§£åšå‡ºå‡è®¾ã€‚ æ‰€æœ‰è¿™äº›é£æ ¼éƒ½é€šè¿‡æ‰©å±•ï¼ˆä¾‹å¦‚<code>XmlBeanDefinitionReader</code>å’Œ<code>AutowiredAnnotationBeanPostProcessor</code>ï¼‰è¿›è¡Œï¼Œå¹¶ä½œä¸ºæ ¸å¿ƒå…ƒæ•°æ®è¡¨ç¤ºåœ¨å…±äº«<code>BeanDefinition</code>å¯¹è±¡ä¸Šè¿è¡Œã€‚ è¿™æ˜¯ä½¿Springçš„å®¹å™¨å¦‚æ­¤çµæ´»å’Œå¯æ‰©å±•çš„æœ¬è´¨ã€‚</p><h4 id="1-16-1-é€‰æ‹©BeanFactoryè¿˜æ˜¯ApplicationContext"><a href="#1-16-1-é€‰æ‹©BeanFactoryè¿˜æ˜¯ApplicationContext" class="headerlink" title="1.16.1. é€‰æ‹©BeanFactoryè¿˜æ˜¯ApplicationContext?"></a>1.16.1. é€‰æ‹©<code>BeanFactory</code>è¿˜æ˜¯<code>ApplicationContext</code>?</h4><p>æœ¬èŠ‚ä»‹ç»<code>BeanFactory</code>å’Œ<code>ApplicationContext</code>å®¹å™¨çº§åˆ«ä¹‹é—´çš„å·®å¼‚ä»¥åŠå½±å“ã€‚</p><p>æ‚¨åº”è¯¥ä½¿ç”¨<code>ApplicationContext</code>ï¼Œé™¤éæ‚¨æœ‰å……åˆ†çš„ç†ç”±ä¸è¿™æ ·åšï¼Œä½¿ç”¨<code>GenericApplicationContext</code>åŠå…¶å­ç±»<code>AnnotationConfigApplicationContext</code>ä½œä¸ºè‡ªå®šä¹‰å¼•å¯¼çš„å¸¸è§å®ç°ã€‚ è¿™äº›æ˜¯Springç”¨äºæ‰€æœ‰å¸¸è§ç›®çš„çš„æ ¸å¿ƒå®¹å™¨çš„ä¸»è¦å…¥å£ç‚¹ï¼šåŠ è½½é…ç½®æ–‡ä»¶ï¼Œè§¦å‘ç±»è·¯å¾„æ‰«æï¼Œä»¥ç¼–ç¨‹æ–¹å¼æ³¨å†Œbeanå®šä¹‰å’Œå¸¦æ³¨è§£çš„ç±»ï¼Œä»¥åŠï¼ˆä»5.0å¼€å§‹ï¼‰æ³¨å†ŒåŠŸèƒ½beanå®šä¹‰ã€‚</p><p>å› ä¸º<code>ApplicationContext</code>åŒ…æ‹¬<code>BeanFactory</code>çš„æ‰€æœ‰åŠŸèƒ½ï¼Œå’Œ<code>BeanFactory</code>ç›¸æ¯”æ›´å€¼å¾—æ¨èï¼Œé™¤äº†ä¸€äº›ç‰¹å®šçš„åœºæ™¯ï¼Œä¾‹å¦‚åœ¨èµ„æºå—é™çš„è®¾å¤‡ä¸Šè¿è¡Œçš„å†…åµŒçš„åº”ç”¨ã€‚ åœ¨<code>ApplicationContext</code>ï¼ˆä¾‹å¦‚<code>GenericApplicationContext</code>å®ç°ï¼‰ä¸­ï¼ŒæŒ‰ç…§çº¦å®šï¼ˆå³é€šè¿‡beanåç§°æˆ–beanç±»å‹ - ç‰¹åˆ«æ˜¯åå¤„ç†å™¨ï¼‰æ£€æµ‹åˆ°å‡ ç§beanï¼Œ è€Œæ™®é€šçš„<code>DefaultListableBeanFactory</code>å¯¹ä»»ä½•ç‰¹æ®Šbeanéƒ½æ˜¯ä¸å¯çŸ¥çš„ã€‚</p><p>å¯¹äºè®¸å¤šæ‰©å±•å®¹å™¨åŠŸèƒ½ï¼Œä¾‹å¦‚æ³¨è§£å¤„ç†å’ŒAOPä»£ç†ï¼Œ <a href="https://sca.aliyun.com/learn/spring/core/ioc/?spm=5176.29160081.0.0.74aa3d07VSkV2g#beans-factory-extension-bpp"><code>BeanPostProcessor</code>æ‰©å±•ç‚¹æ˜¯å¿…ä¸å¯å°‘çš„ã€‚å¦‚æœä»…ä½¿ç”¨æ™®é€šçš„<code>DefaultListableBeanFactory</code>ï¼Œåˆ™é»˜è®¤æƒ…å†µä¸‹ä¸ä¼šæ£€æµ‹åˆ°å¹¶æ¿€æ´»æ­¤ç±»åç½®å¤„ç†å™¨ã€‚ è¿™ç§æƒ…å†µå¯èƒ½ä»¤äººå›°æƒ‘ï¼Œå› ä¸ºæ‚¨çš„beané…ç½®å®é™…ä¸Šæ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚ ç›¸åï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®¹å™¨éœ€è¦è‡³å°‘å¾—å¤šä¸€äº›é¢å¤–çš„å¤„ç†ã€‚</a></p><p>ä¸‹è¡¨åˆ—å‡ºäº†<code>BeanFactory</code>å’Œ<code>ApplicationContext</code>æ¥å£å’Œå®ç°æä¾›çš„åŠŸèƒ½ã€‚</p><p>Table 9.ç‰¹æ€§çŸ©é˜µ</p><table><thead><tr><th>Feature</th><th><code>BeanFactory</code></th><th><code>ApplicationContext</code></th></tr></thead><tbody><tr><td>Bean Beanå®ä¾‹åŒ–&#x2F;è£…é…</td><td>Yes</td><td>Yes</td></tr><tr><td>é›†æˆçš„ç”Ÿå‘½å‘¨æœŸç®¡ç†</td><td>No</td><td>Yes</td></tr><tr><td>è‡ªåŠ¨æ³¨å†Œ <code>BeanPostProcessor</code></td><td>No</td><td>Yes</td></tr><tr><td>è‡ªåŠ¨æ³¨å†Œ <code>BeanFactoryPostProcessor</code></td><td>No</td><td>Yes</td></tr><tr><td>ä¾¿åˆ©çš„ <code>MessageSource</code> è®¿é—® (å›½é™…åŒ–)</td><td>No</td><td>Yes</td></tr><tr><td>å†…ç½®<code>ApplicationEvent</code> å‘å¸ƒæœºåˆ¶</td><td>No</td><td>Yes</td></tr></tbody></table><p>è¦ä½¿ç”¨ <code>DefaultListableBeanFactory</code>æ˜¾å¼æ³¨å†Œbeançš„åç½®å¤„ç†å™¨ï¼Œæ‚¨éœ€è¦ä»¥ç¼–ç¨‹æ–¹å¼è°ƒç”¨ <code>addBeanPostProcessor</code>ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart">DefaultListableBeanFactory <span class="hljs-keyword">factory</span> = <span class="hljs-keyword">new</span> DefaultListableBeanFactory();<span class="hljs-comment">// populate the factory with bean definitions</span><br><span class="hljs-comment">// now register any needed BeanPostProcessor instancesfactory.addBeanPostProcessor(new AutowiredAnnotationBeanPostProcessor());factory.addBeanPostProcessor(new MyBeanPostProcessor());</span><br><span class="hljs-comment">// now start using the factory</span><br></code></pre></td></tr></table></figure><p>è¦å°†<code>BeanFactoryPostProcessor</code> åº”ç”¨äºæ™®é€šçš„<code>DefaultListableBeanFactory</code>ï¼Œéœ€è¦è°ƒç”¨å…¶<code>postProcessBeanFactory</code>æ–¹æ³•ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs haxe">DefaultListableBeanFactory factory = <span class="hljs-keyword">new</span> <span class="hljs-type">DefaultListableBeanFactory</span>();XmlBeanDefinitionReader reader = <span class="hljs-keyword">new</span> <span class="hljs-type">XmlBeanDefinitionReader</span>(factory);reader.loadBeanDefinitions(<span class="hljs-keyword">new</span> <span class="hljs-type">FileSystemResource</span>(<span class="hljs-string">&quot;beans.xml&quot;</span>));<br><span class="hljs-comment">// bring in some property values from a Properties filePropertyPlaceholderConfigurer cfg = new PropertyPlaceholderConfigurer();cfg.setLocation(new FileSystemResource(&quot;jdbc.properties&quot;));</span><br><span class="hljs-comment">// now actually do the replacementcfg.postProcessBeanFactory(factory);</span><br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œæ˜¾ç¤ºæ³¨å†Œæ­¥éª¤éƒ½ä¸æ–¹ä¾¿ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå„ç§<code>ApplicationContext</code>å˜ä½“ä¼˜å…ˆäºSpringæ”¯æŒçš„åº”ç”¨ç¨‹åºä¸­çš„æ™®é€š<code>DefaultListableBeanFactory</code>ï¼Œ å°¤å…¶æ˜¯åœ¨å…¸å‹ä¼ä¸šè®¾ç½®ä¸­ä¾èµ–<code>BeanFactoryPostProcessor</code> å’Œ <code>BeanPostProcessor</code>å®ä¾‹æ¥æ‰©å±•å®¹å™¨åŠŸèƒ½æ—¶ã€‚</p><p><code>AnnotationConfigApplicationContext</code>å…·æœ‰æ³¨å†Œçš„æ‰€æœ‰å¸¸è§æ³¨è§£åç½®å¤„ç†å™¨ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡é…ç½®æ³¨è§£ï¼ˆä¾‹å¦‚<code>@EnableTransactionManagement</code>ï¼‰åœ¨å°é¢ä¸‹å¼•å…¥å…¶ä»–å¤„ç†å™¨ã€‚ åœ¨Springçš„åŸºäºæ³¨è§£çš„é…ç½®æ¨¡å‹çš„æŠ½è±¡çº§åˆ«ï¼Œbeançš„åç½®å¤„ç†å™¨çš„æ¦‚å¿µå˜æˆä»…ä»…æ˜¯å†…éƒ¨å®¹å™¨ç»†èŠ‚ã€‚</p><blockquote><p>Rod Johnson, Juergen Hoeller, Keith Donald, Colin Sampaleanu, Rob Harrop, Thomas Risberg, Alef Arendsen, Darren Davison, Dmitriy Kopylenko, Mark Pollack, Thierry Templier, Erwin Vervaet, Portia Tung, Ben Hale, Adrian Colyer, John Lewis, Costin Leau, Mark Fisher, Sam Brannen, Ramnivas Laddad, Arjen Poutsma, Chris Beams, Tareq Abedrabbo, Andy Clement, Dave Syer, Oliver Gierke, Rossen Stoyanchev, Phillip Webb, Rob Winch, Brian Clozel, Stephane Nicoll, Sebastien Deleuze, Jay Bryant, Mark Paluch</p></blockquote><blockquote><p>Copyright Â© 2002 - 2024 VMware, Inc. All Rights Reserved.</p></blockquote><blockquote><p>Copies of this document may be made for your own use and for distribution to others, provided that you do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically.</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>Spring æ•™ç¨‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Spring</tag>
      
      <tag>IOC</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022.11æœˆCè¯­è¨€å¤ä¹ é¢˜.docx</title>
    <link href="/post/22ca3782-bd81-46b5-ba49-ef6d6b47f61a/"/>
    <url>/post/22ca3782-bd81-46b5-ba49-ef6d6b47f61a/</url>
    
    <content type="html"><![CDATA[<h3 id="2022-11-æœˆ-C-è¯­è¨€å¤ä¹ é¢˜-docx"><a href="#2022-11-æœˆ-C-è¯­è¨€å¤ä¹ é¢˜-docx" class="headerlink" title="2022.11 æœˆ C è¯­è¨€å¤ä¹ é¢˜.docx"></a>2022.11 æœˆ C è¯­è¨€å¤ä¹ é¢˜.docx</h3><p><code>hexo template generate by typora plugin templater</code></p><ol><li>ç”¨ C è¯­è¨€ç¼–å†™çš„ä»£ç ç¨‹åºï¼ˆDï¼‰ã€‚<br>A.å¯ç«‹å³æ‰§è¡ŒB.æ˜¯ä¸€ä¸ªæºç¨‹åº<br>C.ç»è¿‡ç¼–è¯‘å³å¯æ‰§è¡ŒD.ç»è¿‡ç¼–è¯‘è§£é‡Šæ‰èƒ½æ‰§è¡Œ</li><li>å°† C è¯­è¨€æºç¨‹åºè¿›è¡Œï¼ˆBï¼‰å¯å¾—åˆ°ç›®æ ‡ç¨‹åºã€‚<br>A.ç¼–è¾‘B.ç¼–è¯‘C.è¿æ¥D.æ‰§è¡Œ</li><li>ï¼ˆaï¼‰æ˜¯ C è¯­è¨€æä¾›çš„åˆæ³•çš„æ•°æ®ç±»å‹å…³é”®å­—ã€‚<br>A.FloatB.UnsignedC.IntegerD.Char</li><li>   è‹¥ int k &#x3D; 7, x &#x3D; 12; åˆ™èƒ½ä½¿å€¼ä¸º 3 çš„è¡¨è¾¾å¼æ˜¯ï¼ˆCï¼‰ã€‚<br>A.x%&#x3D;(k%&#x3D; 5)12%&#x3D; 2B.x%&#x3D;(kï¼k%5)12%&#x3D; 5<br>C.x%&#x3D; kï¼k%5D.(x%&#x3D; k)ï¼(k%&#x3D; 5) 1 - 1<br>X &#x3D; x%k-k%5</li></ol><p>5.C è¯­è¨€æºç¨‹åºæ–‡ä»¶ç»è¿‡ C ç¼–è¯‘ç¨‹åºç¼–è¯‘åç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶çš„åç¼€ä¸ºï¼ˆBï¼‰ã€‚<br>A. .c        B.  .obj     C..exe       D..bas<br>6.C è¯­è¨€è¯­å¥çš„ç»“æŸç¬¦æ˜¯ï¼ˆBï¼‰ã€‚<br>A. å›è½¦ç¬¦    B. åˆ†å·          C. é€—å·      D. å¥å·<br>7.ä»¥ä¸‹ç¨‹åºçš„åŠŸèƒ½æ˜¯ç»™ r è¾“å…¥æ•°æ®åè®¡ç®—åŠå¾„ä¸º r çš„åœ†é¢ç§¯ sã€‚ç¨‹åºåœ¨ç¼–è¯‘æ—¶å‡ºé”™ï¼Œå‡ºé”™çš„åŸå› æ˜¯ï¼ˆDï¼‰ã€‚<br>#include &lt;stdio.h&gt;<br>int main()<br>&#x2F;* Beginning <em>&#x2F;<br>{  int r; float s;   &#x2F;&#x2F;float ä»£è¡¨æµ®ç‚¹ç±»å‹ï¼Œå³å°æ•°ï¼Œå…¶å¯¹åº”çš„æ ¼å¼ä¸º%f<br>   scanf(â€œ%dâ€,&amp;r);<br>   s &#x3D; p <em>r</em> r;<br>   printf(â€œs &#x3D;%f\nâ€, s);<br>   return 0;<br>}<br>A.æ³¨é‡Šè¯­å¥ä¹¦å†™ä½ç½®é”™è¯¯<br>B.å­˜æ”¾åœ†åŠå¾„çš„å˜é‡ r ä¸åº”è¯¥å®šä¹‰ä¸ºæ•´å‹<br>C.è¾“å‡ºè¯­å¥ä¸­æ ¼å¼æè¿°ç¬¦éæ³•<br>D.è®¡ç®—åœ†é¢ç§¯çš„èµ‹å€¼è¯­å¥ä¸­ä½¿ç”¨äº†æœªå®šä¹‰çš„å˜é‡<br>8.åœ¨ C è¯­è¨€ä¸­, è¦æ±‚å‚åŠ è¿ç®—çš„æ•°å¿…é¡»æ˜¯æ•´æ•°çš„è¿ç®—ç¬¦æ˜¯(A)ã€‚<br>A.%       B.&#x2F;        C.!           D.</em><br>9.è‹¥å·²å®šä¹‰ x å’Œ y ä¸º double ç±»å‹, åˆ™è¡¨è¾¾å¼ â€œx &#x3D; 1, y &#x3D; x+3&#x2F;2â€ çš„å€¼æ˜¯(D)ã€‚<br>A.1       B.2      C.2.0          D.2.5<br>10.ä¸‹åˆ—å˜é‡ä¸­åˆæ³•çš„æ˜¯(C)ã€‚<br>A.        B.3a6b       C._6a7b         D.$ABC<br>11.ä»¥ä¸‹ä¸æ­£ç¡®çš„å™è¿°æ˜¯(D)ã€‚<br>A.åœ¨ C ç¨‹åºä¸­æ‰€ç”¨çš„å˜é‡å¿…é¡»å…ˆå®šä¹‰åä½¿ç”¨<br>B.ç¨‹åºä¸­, APH å’Œ aph æ˜¯ä¸¤ä¸ªä¸åŒçš„å˜é‡<br>C.è‹¥ a å’Œ b ç±»å‹ç›¸åŒ, åœ¨æ‰§è¡Œäº†èµ‹å€¼è¯­å¥ a &#x3D; b; å b ä¸­çš„å€¼å°†æ”¾å…¥ a ä¸­, b ä¸­çš„å€¼ä¸å˜<br>D.å½“è¾“å…¥æ•°å€¼æ•°æ®æ—¶, å¯¹äºæ•´å‹å˜é‡åªèƒ½è¾“å…¥æ•´å‹å€¼; å¯¹äºå®å‹å˜é‡åªèƒ½è¾“å…¥å®å‹å€¼<br>12.è‹¥ x &#x3D; 2, y &#x3D; 3 åˆ™ x||y çš„ç»“æœæ˜¯(B)ã€‚<br>A.0          B.1            C.2          D.3<br>13.C è¯­è¨€çš„ if è¯­å¥åµŒå¥—æ—¶, if ä¸ else çš„é…å¯¹å…³ç³»æ˜¯(D)ã€‚<br>A. æ¯ä¸ª else æ€»æ˜¯ä¸å®ƒä¸Šé¢çš„ if é…å¯¹<br>B. æ¯ä¸ª else æ€»æ˜¯ä¸æœ€å¤–å±‚çš„ if é…å¯¹<br>C. æ¯ä¸ª else ä¸ if çš„é…å¯¹æ˜¯ä»»æ„çš„<br>D. æ¯ä¸ª else æ€»æ˜¯ä¸å®ƒä¸Šé¢çš„æœ€è¿‘çš„å¹¶ä¸”å°šæœªä¸å…¶ä»– else åŒ¹é…çš„ if é…å¯¹<br>14.C è¯­è¨€çš„ switch è¯­å¥ä¸­ case å(B)ã€‚<br>A.åªèƒ½ä¸ºå¸¸é‡                                    B.åªèƒ½ä¸ºå¸¸é‡æˆ–å¸¸é‡è¡¨è¾¾å¼<br>C.å¯ä¸ºå¸¸é‡æˆ–è¡¨è¾¾å¼æˆ–æœ‰ç¡®å®šå€¼çš„å˜é‡åŠè¡¨è¾¾å¼     D.å¯ä¸ºä»»ä½•é‡æˆ–è¡¨è¾¾å¼<br>15.æœ‰ä»¥ä¸‹ç¨‹åºæ®µ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>, p;<br><span class="hljs-keyword">do</span><br>&#123;  scanf(<span class="hljs-string">&quot;%d&quot;</span>,&amp;p);<br>n++;<br>&#125;<span class="hljs-keyword">while</span>(p!= <span class="hljs-number">12345</span>&amp;&amp;n &lt; <span class="hljs-number">3</span>);<br></code></pre></td></tr></table></figure><p>æ­¤å¤„ do-while å¾ªç¯çš„ç»“æŸæ¡ä»¶æ˜¯(D)ã€‚<br>A.p çš„å€¼ä¸ç­‰äº 12345 å¹¶ä¸” n çš„å€¼å°äº 3<br>B.p çš„å€¼ç­‰äº 12345 å¹¶ä¸” n çš„å€¼å¤§äºç­‰äº 3<br>C.p çš„å€¼ä¸ç­‰äº 12345 æˆ–è€… n çš„å€¼å°äº 3<br>D.p çš„å€¼ç­‰äº 12345 æˆ–è€… n çš„å€¼å¤§äºç­‰äº 3<br>16.è‹¥ i ä¸ºæ•´å‹å˜é‡, åˆ™ä»¥ä¸‹å¾ªç¯æ‰§è¡Œæ¬¡æ•°æ˜¯(D)ã€‚<br>for(i &#x3D; 2; i &#x3D;&#x3D; 0;)  printf(â€œ%dâ€, iâ€“);<br>A.æ— é™æ¬¡     B. 0 æ¬¡     C. 1 æ¬¡     D. 2 æ¬¡<br>17.ä¸‹é¢æœ‰å…³ for å¾ªç¯çš„æ­£ç¡®æè¿°æ˜¯(D)ã€‚<br>A.for å¾ªç¯åªèƒ½ç”¨äºå¾ªç¯æ¬¡æ•°å·²ç»ç¡®å®šçš„æƒ…å†µ<br>B.for å¾ªç¯æ˜¯å…ˆæ‰§è¡Œå¾ªç¯å¾ªç¯ä½“è¯­å¥, ååˆ¤æ–­è¡¨è¾¾å¼<br>C.åœ¨ for å¾ªç¯ä¸­, ä¸èƒ½ç”¨ break è¯­å¥è·³å‡ºå¾ªç¯ä½“<br>D.for å¾ªç¯çš„å¾ªç¯ä½“è¯­å¥ä¸­, å¯ä»¥åŒ…å«å¤šæ¡è¯­å¥, ä½†å¿…é¡»ç”¨èŠ±æ‹¬å·æ‹¬èµ·æ¥<br>18.è‹¥æœ‰è¯´æ˜: int a [10]; åˆ™å¯¹ a æ•°ç»„å…ƒç´ çš„æ­£ç¡®å¼•ç”¨æ˜¯(D)ã€‚<br>A. a [10]        B. a [3,5]      C.a(5)       D.a [10-10]<br>19.è‹¥äºŒç»´æ•°ç»„ a æœ‰ m åˆ—, åˆ™åœ¨ a [i][j] å‰çš„å…ƒç´ ä¸ªæ•°ä¸º(A)ã€‚<br>ä»¤ m &#x3D; 4 , i &#x3D; 2, j &#x3D; 2<br>A [2][2] å‰ æœ‰ 21 20 13 12 11 10 03 02 01 00  j*m+i<br>A. j <em>m+I        B.i</em> m+j        C.i <em>m+j-1    D.i</em> m+j+1<br>20.è‹¥æœ‰è¯´æ˜: int a [ ][3] &#x3D;{1,2,3,4,5,6,7}; åˆ™ a æ•°ç»„ç¬¬ä¸€ç»´çš„å¤§å°æ˜¯(B)ã€‚<br>A. 2            B.3            C.4          D.æ— ç¡®å®šå€¼<br>21. ä»¥ä¸‹ä¸æ­£ç¡®çš„å®šä¹‰è¯­å¥æ˜¯(B)ã€‚<br>A.double x [5] &#x3D;{2.0,4.0,6.0,8.0,10.0};    B. int y [5] &#x3D;{0,1,3,5,7,9};<br>C.char c1 [ ] &#x3D;{â€˜1â€™,â€™2â€™,â€™3â€™,â€™4â€™,â€™5â€™};      D. char c2 [ ] &#x3D;{â€˜\x10â€™,â€™\xaâ€™,â€™\x8â€™};<br>22.å·²çŸ¥ int p(); p æ˜¯(C)ã€‚<br>A.int å‹å˜é‡                                  B.å‡½æ•° p çš„è°ƒç”¨<br>C.ä¸€ä¸ªå‡½æ•°å£°æ˜, è¯¥å‡½æ•°çš„è¿”å›å€¼æ˜¯ int å‹çš„å€¼     D.å¼ºåˆ¶ç±»å‹è½¬æ¢è¡¨è¾¾å¼ä¸­çš„å˜é‡<br>23. C è¯­è¨€ä¸­çš„å‡½æ•°(D)ã€‚<br>A.å¯ä»¥åµŒå¥—å®šä¹‰                     B.ä¸å¯ä»¥åµŒå¥—è°ƒç”¨<br>C.å¯ä»¥åµŒå¥—è°ƒç”¨, ä½†ä¸èƒ½è°ƒç”¨è‡ªå·±      D.åµŒå¥—è°ƒç”¨å’Œè°ƒç”¨è‡ªå·±å‡å¯<br>24.å…³äº return è¯­å¥, ä¸‹åˆ—æ­£ç¡®çš„è¯´æ³•æ˜¯(A)ã€‚<br>A. å¯ä»¥åœ¨åŒä¸€å‡½æ•°ä¸­å‡ºç°å¤šæ¬¡   B.åœ¨ä¸»å‡½æ•°ä¸­ä¸èƒ½å‡ºç°<br>C. å¿…é¡»åœ¨æ¯ä¸ªå‡½æ•°ä¸­å‡ºç°       D.åªèƒ½åœ¨é™¤ä¸»å‡½æ•°ä¹‹å¤–çš„å‡½æ•°ä¸­å‡ºç°ä¸€æ¬¡</p><p>1.C è¯­è¨€æœ¬èº«ä¸æä¾›è¾“å…¥è¾“å‡ºè¯­å¥, è¾“å…¥å’Œè¾“å‡ºæ“ä½œæ˜¯ç”±å‡½æ•°æ¥å®ç°çš„ã€‚ï¼ˆVï¼‰<br>2.ä¸€ä¸ª C ç¨‹åºå¯ä»¥åŒ…å«è‹¥å¹²ä¸ªå‡½æ•°ã€‚ï¼ˆVï¼‰<br>3ï¼C ç¨‹åºçš„æ³¨é‡Šéƒ¨åˆ†å¯ä»¥å‡ºç°åœ¨ç¨‹åºçš„ä»»ä½•ä½ç½®ï¼Œå®ƒå¯¹ç¨‹åºçš„ç¼–è¯‘å’Œè¿è¡Œä¸èµ·ä»»ä½•ä½œç”¨ã€‚ä½†æ˜¯å¯ä»¥å¢åŠ ç¨‹åºçš„å¯è¯»æ€§ã€‚ï¼ˆVï¼‰<br>4ï¼C ç¨‹åºçš„æ³¨é‡Šä¸èƒ½æ˜¯ä¸­æ–‡æ–‡å­—ä¿¡æ¯ã€‚ï¼ˆXï¼‰<br>5.while å’Œ doâ€¦while å¾ªç¯ä¸è®ºä»€ä¹ˆæ¡ä»¶ä¸‹å®ƒä»¬çš„ç»“æœéƒ½æ˜¯ç›¸åŒçš„ã€‚(X)<br>6.ä¸‰ç§å¾ªç¯(while è¯­å¥ã€ for è¯­å¥ã€ do-while è¯­å¥)éƒ½å¯ä»¥ç”¨æ¥å¤„ç†åŒä¸€ä¸ªé—®é¢˜, ä¸€èˆ¬å®ƒä»¬å¯ä»¥ç›¸äº’ä»£æ›¿ã€‚(V)<br>7.å¾ªç¯åµŒå¥—æ‰§è¡Œæ—¶, å…ˆç”±å†…å±‚å¾ªç¯è¿›å…¥å¤–å±‚å¾ªç¯ã€‚(X)<br>8.break è¯­å¥åªèƒ½ç”¨äºå¾ªç¯è¯­å¥ä¸­ã€‚(X)<br>9.å¾ªç¯ç»“æ„ä¸­çš„ continue è¯­å¥æ˜¯ä½¿æ•´ä¸ªå¾ªç¯ç»ˆæ­¢æ‰§è¡Œã€‚(X)<br>10.C è¯­è¨€çš„ if è¯­å¥åµŒå¥—æ—¶, if ä¸ else çš„åŒ¹é…å…³ç³»æ˜¯æ¯ä¸ª else ä¸ if çš„åŒ¹é…æ˜¯ä»»æ„çš„ã€‚ï¼ˆXï¼‰<br>11.main å‡½æ•°å¿…é¡»å†™åœ¨ä¸€ä¸ª C ç¨‹åºçš„æœ€å‰é¢ã€‚ï¼ˆ  X  ï¼‰<br>12.ä¸€ä¸ª C ç¨‹åºå¯ä»¥åŒ…å«è‹¥å¹²çš„å‡½æ•°ã€‚ï¼ˆ   V ï¼‰<br>13.C ç¨‹åºçš„æ³¨é‡Šéƒ¨åˆ†å¯ä»¥å‡ºç°åœ¨ç¨‹åºçš„ä»»ä½•ä½ç½®ï¼Œå®ƒå¯¹ç¨‹åºçš„ç¼–è¯‘å’Œè¿è¡Œä¸èµ·ä»»ä½•ä½œç”¨ã€‚ä½†æ˜¯å¯ä»¥å¢åŠ ç¨‹åºçš„å¯è¯»æ€§ã€‚ï¼ˆ  V ï¼‰<br>14.C ç¨‹åºçš„æ³¨é‡Šä¸èƒ½æ˜¯ä¸­æ–‡æ–‡å­—ä¿¡æ¯ã€‚ï¼ˆ  X ï¼‰<br>15.åœ¨ C ç¨‹åºä¸­å¯¹ç”¨åˆ°çš„æ‰€æœ‰æ•°æ®éƒ½å¿…é¡»æŒ‡å®šå…¶æ•°æ®ç±»å‹ã€‚ï¼ˆ V  ï¼‰<br>16.å¯¹å‡ ä¸ªå˜é‡åœ¨å®šä¹‰æ—¶èµ‹åˆå€¼å¯ä»¥å†™æˆï¼šint a &#x3D; b &#x3D; c &#x3D; 3; ï¼ˆ  X ï¼‰<br>17.è‡ªå¢è¿ç®—ç¬¦(++)æˆ–è‡ªå‡è¿ç®—ç¬¦(â€“)åªèƒ½ç”¨äºå˜é‡ï¼Œä¸èƒ½ç”¨äºå¸¸é‡æˆ–è¡¨è¾¾å¼ã€‚ï¼ˆ V ï¼‰<br>18.åœ¨ C ç¨‹åºçš„è¡¨è¾¾å¼ä¸­ï¼Œä¸ºäº†æ˜ç¡®è¡¨è¾¾å¼çš„è¿ç®—æ¬¡åºï¼Œå¸¸ä½¿ç”¨æ‹¬å· â€œï¼ˆï¼‰â€ã€‚ï¼ˆ  V ï¼‰</p><p>1.è‹¥ä»é”®ç›˜è¾“å…¥ 58ï¼Œåˆ™ä»¥ä¸‹ç¨‹åºè¾“å‡ºçš„ç»“æœæ˜¯           ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123; <span class="hljs-type">int</span> a;<br> <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>,&amp;a);<br> <span class="hljs-keyword">if</span>(a &gt; <span class="hljs-number">50</span>) <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d&quot;</span>, a);<br> <span class="hljs-keyword">if</span>(a &gt; <span class="hljs-number">40</span>) <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d&quot;</span>, a);<br> <span class="hljs-keyword">if</span>(a &gt; <span class="hljs-number">30</span>) <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d&quot;</span>, a);<br>&#125;<br></code></pre></td></tr></table></figure><p>58<br>2.ç¨‹åºçš„åŠŸèƒ½æ˜¯ä½¿ä¸€ä¸ªå­—ç¬¦ä¸²æŒ‰é€†åºå­˜æ”¾ï¼Œè¯·å¡«ç©ºã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">( )</span><br>&#123;<br>    <span class="hljs-type">char</span> str [] =&#123;<span class="hljs-string">&quot;abcdefghijl&quot;</span>&#125;, m;<br>    <span class="hljs-type">int</span> i, j;<br>    <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>, j = <span class="hljs-built_in">strlen</span>(str); i &lt;   j        ; i++, j--)<br>    &#123;m = str [i];<br>     str [i] =  str [j<span class="hljs-number">-1</span>]           ;<br>     str [j<span class="hljs-number">-1</span>] = m;<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s\n&quot;</span>, str);<br>&#125;<span class="hljs-comment">//äº¤æ¢å­—ç¬¦ä¸²çš„ç¬¬ i ä¸ªå­—ç¬¦ä¸å€’æ•°ç¬¬ I ä¸ªå­—ç¬¦</span><br></code></pre></td></tr></table></figure><p>4.è‹¥æœ‰ä»¥ä¸‹ç¨‹åº<br>i</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c">nt <span class="hljs-title function_">f</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y)</span><br>&#123;<br>    <span class="hljs-keyword">return</span>(y-x)*x; <br>&#125;<br>main()<br>&#123;<br>    <span class="hljs-type">int</span> a = <span class="hljs-number">3</span>, b = <span class="hljs-number">4</span>, c = <span class="hljs-number">5</span>, d;<br>    d = f(f(<span class="hljs-number">3</span>,<span class="hljs-number">4</span>), f(<span class="hljs-number">3</span>,<span class="hljs-number">5</span>));<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\n&quot;</span>, d);<br>&#125;<br>F(<span class="hljs-number">3</span>,<span class="hljs-number">4</span>)=(<span class="hljs-number">4</span><span class="hljs-number">-3</span>)*<span class="hljs-number">3</span> = <span class="hljs-number">3</span><br>    F(<span class="hljs-number">3</span>,<span class="hljs-number">5</span>)=(<span class="hljs-number">5</span><span class="hljs-number">-3</span>)*<span class="hljs-number">3</span> = <span class="hljs-number">6</span><br>    F(<span class="hljs-number">3</span>,<span class="hljs-number">6</span>)=(<span class="hljs-number">6</span><span class="hljs-number">-3</span>)*<span class="hljs-number">3</span> = <span class="hljs-number">9</span><br></code></pre></td></tr></table></figure><p>æ‰§è¡Œåè¾“å‡ºç»“æœæ˜¯       9<br>5.ä¸‹åˆ—ç¨‹åºçš„è¾“å‡ºç»“æœæ˜¯(   1,0           )ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;  <span class="hljs-type">int</span> x = <span class="hljs-number">1</span>, a = <span class="hljs-number">0</span>, b = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">switch</span> (x)<br>  &#123; <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>: b++; <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: a++; <span class="hljs-keyword">break</span>;<span class="hljs-comment">//a = 1</span><br>    <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>: a++; b++;<br>&#125;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d,%d&quot;</span>, a, b);<br>&#125; <br><span class="hljs-number">6.</span>ä»¥ä¸‹ç¨‹åºçš„è¿è¡Œç»“æœæ˜¯(   <span class="hljs-number">12457810</span>  )ã€‚<br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;  <span class="hljs-type">int</span> n;<br><span class="hljs-keyword">for</span>(n = <span class="hljs-number">1</span>; n &lt;= <span class="hljs-number">10</span>; n++)<br>&#123;<br><span class="hljs-keyword">if</span>(n%<span class="hljs-number">3</span> == <span class="hljs-number">0</span>) <span class="hljs-keyword">continue</span>;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d&quot;</span>, n);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>7.ä¸‹åˆ—ç¨‹åºçš„è¿è¡Œç»“æœæ˜¯(    1       )ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123; <span class="hljs-type">int</span> i, j, m = <span class="hljs-number">55</span>;<br><span class="hljs-keyword">for</span>(i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">3</span>; i++)<br><span class="hljs-keyword">for</span>(j = <span class="hljs-number">3</span>; j &lt;= i; j++) <br>m = m%j;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\n&quot;</span>, m);<br><br>i = <span class="hljs-number">1</span>; j = <span class="hljs-number">3</span> &gt; <span class="hljs-number">1</span><br>i = <span class="hljs-number">2</span>; j = <span class="hljs-number">3</span> &gt; <span class="hljs-number">2</span><br>i = <span class="hljs-number">3</span>; j = <span class="hljs-number">3</span> = <span class="hljs-number">3</span>; m = <span class="hljs-number">55</span>%<span class="hljs-number">3</span> = <span class="hljs-number">1</span><br>i = <span class="hljs-number">4</span>; <span class="hljs-keyword">break</span><br>m = <span class="hljs-number">1</span><br>&#125;<br></code></pre></td></tr></table></figure><p>8.ç¨‹åºè¿è¡Œåçš„è¾“å‡ºç»“æœæ˜¯(     D          )ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123; <span class="hljs-type">char</span> a [ ] =&#123;<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;b&#x27;</span>,<span class="hljs-string">&#x27;c&#x27;</span>,<span class="hljs-string">&#x27;d&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;f&#x27;</span>,<span class="hljs-string">&#x27;g&#x27;</span>,<span class="hljs-string">&#x27;h&#x27;</span>,<span class="hljs-string">&#x27;\0&#x27;</span>&#125;;<br> <span class="hljs-type">int</span> i, j;<br> i = <span class="hljs-keyword">sizeof</span>(a)<span class="hljs-number">9</span>; j = <span class="hljs-built_in">strlen</span>(a)<span class="hljs-number">8</span>;<br> <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d,%d\n&quot;</span>, i, j); &#125;<br></code></pre></td></tr></table></figure><p>A) 9,9<br>B) 8,9<br>C) 1,8<br>D) 9,8<br>9.ä»¥ä¸‹ç¨‹åºçš„è¿è¡Œç»“æœæ˜¯(       10,20       )ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br>func(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)<br>&#123;<br>    <span class="hljs-type">int</span> temp = a;<br>    a = b;<br>    b = temp; &#125;<br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123; <br>    <span class="hljs-type">int</span> x, y;<br>    x = <span class="hljs-number">10</span>; y = <span class="hljs-number">20</span>;<br>    func(x, y);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d,%d\n&quot;</span>, x, y); &#125;<br></code></pre></td></tr></table></figure><p>å››ã€ç¼–ç¨‹é¢˜ï¼š</p><p>1.ç¼–å†™ç¨‹åºå®ç°ï¼Œæ ¹æ®è¾“å…¥çš„å¹´å·å’Œæœˆä»½ï¼Œè¾“å‡ºè¯¥æœˆçš„å¤©æ•°ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-type">int</span> year;<br><span class="hljs-type">int</span> month;<br><span class="hljs-type">int</span> day;<br><span class="hljs-built_in">scanf</span>(â€œè¯·è¾“å…¥å¹´ä»½ year =%dâ€,&amp;year);<br><span class="hljs-built_in">scanf</span>(â€œè¯·è¾“å…¥æœˆä»½ month =%dâ€,&amp;month);<br><span class="hljs-keyword">if</span>(month &gt;= <span class="hljs-number">1</span>&amp;&amp;month &lt;= <span class="hljs-number">12</span>)&#123;<br>    <span class="hljs-keyword">switch</span>(month)&#123;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">7</span>:;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">8</span>:;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">10</span>:;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">12</span>: day = <span class="hljs-number">31</span>; <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>: <span class="hljs-keyword">if</span>(year%<span class="hljs-number">4</span> ==<span class="hljs-number">0</span>||year%<span class="hljs-number">100</span>== <span class="hljs-number">0</span>)&#123;day = <span class="hljs-number">29</span>&#125;<span class="hljs-keyword">else</span>&#123;day = <span class="hljs-number">28</span>&#125;; <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">6</span>:;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">9</span>:;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">11</span>: day = <span class="hljs-number">30</span>; <span class="hljs-keyword">break</span>;<br>    &#125;<br>    Print(â€œ%d å¹´%d æœˆæœ‰%d å¤©â€, year, month, day);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-built_in">printf</span>(â€œæœˆä»½é”™è¯¯,<span class="hljs-number">1</span> &lt;= month &lt;= <span class="hljs-number">12</span>â€);<br>&#125;<br><span class="hljs-number">2.</span>æ±‚ <span class="hljs-number">100</span>ï½<span class="hljs-number">200</span> é—´çš„å…¨éƒ¨ç´ æ•°<br>    <span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br>    <span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> n = <span class="hljs-number">100</span>; n &lt;= <span class="hljs-number">200</span>; n++)&#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">2</span>; i &lt;= n; i++)&#123;<br>            <span class="hljs-keyword">if</span>(i == n)&#123;<br>                print(â€œ%dâ€, n);<br>            &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(n%i == <span class="hljs-number">0</span>)&#123;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>3.ç¼–å†™ç¨‹åºå®ç°ï¼šä¸€ä¸ªç­ 10 åå­¦ç”Ÿï¼Œæ¯åå­¦ç”Ÿé€‰ä¿®äº†ä¸‰é—¨è¯¾ç¨‹ï¼Œæ¯åå­¦ç”Ÿæ¯é—¨è¯¾ç¨‹æœ‰ä¸€ä¸ªæˆç»©ï¼Œæ±‚æ¯é—¨è¯¾ç¨‹ 10 åå­¦ç”Ÿå¹³å‡æˆç»©.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br>Typedf <span class="hljs-class"><span class="hljs-keyword">struct</span>&#123;</span><br><span class="hljs-type">int</span> num;<br><span class="hljs-type">float</span> score [<span class="hljs-number">3</span>];<br>&#125; student;<br><br>Void <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>student Students [<span class="hljs-number">10</span>];<br><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++)&#123;<br><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">3</span>; j++)&#123;<br><span class="hljs-built_in">scanf</span>(â€œè¯·è¾“å…¥ç¬¬%d åå­¦ç”Ÿçš„ç¬¬%d é—¨è¯¾ç¨‹åˆ†æ•°â€,(i+<span class="hljs-number">1</span>),(j+<span class="hljs-number">1</span>), Students [i]-&gt; score [j]);<br>&#125;<br>&#125; <br>Float avg [<span class="hljs-number">3</span>];<br>Float sum [<span class="hljs-number">3</span>];<br>For(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++)&#123;<br>For(<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">3</span>; j++)&#123;<br>sum [j] += Students [i]-&gt; score [j];<br>&#125;<br>&#125;<br>Printf(â€œæ¯é—¨è¯¾ç¨‹çš„å¹³å‡åˆ†æ•°ä¾æ¬¡æ˜¯:\nâ€)<br>For(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++)&#123;<br>avg [i] = sum [i]/<span class="hljs-number">10</span>;<br><span class="hljs-built_in">printf</span>(â€œç¬¬%d é—¨è¯¾ç¨‹å¹³å‡åˆ†ä¸º %f åˆ†\nâ€, i+<span class="hljs-number">1</span>, avg [i]);<br>&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å­¦æ ¡è¯¾ç¨‹</category>
      
      <category>å¤ä¹ é¢˜</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¤ä¹ é¢˜</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>145. äºŒå‰æ ‘çš„ååºéå†</title>
    <link href="/post/0293a069-f8d9-4fcd-a321-127459fe4d7d/"/>
    <url>/post/0293a069-f8d9-4fcd-a321-127459fe4d7d/</url>
    
    <content type="html"><![CDATA[<h3 id="145-äºŒå‰æ ‘çš„ååºéå†"><a href="#145-äºŒå‰æ ‘çš„ååºéå†" class="headerlink" title="145. äºŒå‰æ ‘çš„ååºéå†"></a>145. äºŒå‰æ ‘çš„ååºéå†</h3><p><code>hexo template generate by typora plugin templater</code></p><h4 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h4><p>ç»™ä½ ä¸€æ£µäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ <code>root</code> ï¼Œè¿”å›å…¶èŠ‚ç‚¹å€¼çš„ <strong>ååºéå†</strong> ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs inform7">è¾“å…¥ï¼šroot = <span class="hljs-comment">[1,null,2,3]</span><br>è¾“å‡ºï¼š<span class="hljs-comment">[3,2,1]</span><br></code></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs inform7">è¾“å…¥ï¼šroot = <span class="hljs-comment">[]</span><br>è¾“å‡ºï¼š<span class="hljs-comment">[]</span><br></code></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs inform7">è¾“å…¥ï¼šroot = <span class="hljs-comment">[1]</span><br>è¾“å‡ºï¼š<span class="hljs-comment">[1]</span><br></code></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li>æ ‘ä¸­èŠ‚ç‚¹çš„æ•°ç›®åœ¨èŒƒå›´ <code>[0, 100]</code> å†…</li><li><code>-100 &lt;= Node.val &lt;= 100</code></li></ul><p><strong>è¿›é˜¶ï¼š</strong>é€’å½’ç®—æ³•å¾ˆç®€å•ï¼Œä½ å¯ä»¥é€šè¿‡è¿­ä»£ç®—æ³•å®Œæˆå—ï¼Ÿ</p><h4 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h4><h5 id="é€’å½’æ–¹å¼"><a href="#é€’å½’æ–¹å¼" class="headerlink" title="é€’å½’æ–¹å¼"></a>é€’å½’æ–¹å¼</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Definition for a binary tree node.</span><br><span class="hljs-comment"> * public class TreeNode &#123;</span><br><span class="hljs-comment"> *     int val;</span><br><span class="hljs-comment"> *     TreeNode left;</span><br><span class="hljs-comment"> *     TreeNode right;</span><br><span class="hljs-comment"> *     TreeNode() &#123;&#125;</span><br><span class="hljs-comment"> *     TreeNode(int val) &#123; this.val = val; &#125;</span><br><span class="hljs-comment"> *     TreeNode(int val, TreeNode left, TreeNode right) &#123;</span><br><span class="hljs-comment"> *         this.val = val;</span><br><span class="hljs-comment"> *         this.left = left;</span><br><span class="hljs-comment"> *         this.right = right;</span><br><span class="hljs-comment"> *     &#125;</span><br><span class="hljs-comment"> * &#125;</span><br><span class="hljs-comment"> */</span><br> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br>        <span class="hljs-keyword">final</span> ArrayList&lt;Integer&gt; integers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-keyword">public</span> List&lt;Integer&gt; <span class="hljs-title function_">postorderTraversal</span><span class="hljs-params">(TreeNode root)</span> &#123;<br>            <span class="hljs-keyword">if</span> (root==<span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> integers;<br>            <span class="hljs-keyword">if</span> (root.left != <span class="hljs-literal">null</span>) postorderTraversal(root.left);<br>            <span class="hljs-keyword">if</span> (root.right != <span class="hljs-literal">null</span>) postorderTraversal(root.right);<br>            integers.add(root.val);<br>            <span class="hljs-keyword">return</span> integers;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
      <category>Leetcode</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Leetcode</tag>
      
      <tag>ç®€å•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>724. å¯»æ‰¾æ•°ç»„çš„ä¸­å¿ƒä¸‹æ ‡</title>
    <link href="/post/f7b981ec-6bba-4292-9a59-8cb044181eda/"/>
    <url>/post/f7b981ec-6bba-4292-9a59-8cb044181eda/</url>
    
    <content type="html"><![CDATA[<h3 id="724-å¯»æ‰¾æ•°ç»„çš„ä¸­å¿ƒä¸‹æ ‡"><a href="#724-å¯»æ‰¾æ•°ç»„çš„ä¸­å¿ƒä¸‹æ ‡" class="headerlink" title="724. å¯»æ‰¾æ•°ç»„çš„ä¸­å¿ƒä¸‹æ ‡"></a>724. å¯»æ‰¾æ•°ç»„çš„ä¸­å¿ƒä¸‹æ ‡</h3><p><code>hexo template generate by typora plugin templater</code></p><p>**Description **</p><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>nums</code> ï¼Œè¯·è®¡ç®—æ•°ç»„çš„ <strong>ä¸­å¿ƒä¸‹æ ‡</strong> ã€‚</p><p>æ•°ç»„ <strong>ä¸­å¿ƒä¸‹æ ‡</strong> æ˜¯æ•°ç»„çš„ä¸€ä¸ªä¸‹æ ‡ï¼Œå…¶å·¦ä¾§æ‰€æœ‰å…ƒç´ ç›¸åŠ çš„å’Œç­‰äºå³ä¾§æ‰€æœ‰å…ƒç´ ç›¸åŠ çš„å’Œã€‚</p><p>å¦‚æœä¸­å¿ƒä¸‹æ ‡ä½äºæ•°ç»„æœ€å·¦ç«¯ï¼Œé‚£ä¹ˆå·¦ä¾§æ•°ä¹‹å’Œè§†ä¸º <code>0</code> ï¼Œå› ä¸ºåœ¨ä¸‹æ ‡çš„å·¦ä¾§ä¸å­˜åœ¨å…ƒç´ ã€‚è¿™ä¸€ç‚¹å¯¹äºä¸­å¿ƒä¸‹æ ‡ä½äºæ•°ç»„æœ€å³ç«¯åŒæ ·é€‚ç”¨ã€‚</p><p>å¦‚æœæ•°ç»„æœ‰å¤šä¸ªä¸­å¿ƒä¸‹æ ‡ï¼Œåº”è¯¥è¿”å› <strong>æœ€é è¿‘å·¦è¾¹</strong> çš„é‚£ä¸€ä¸ªã€‚å¦‚æœæ•°ç»„ä¸å­˜åœ¨ä¸­å¿ƒä¸‹æ ‡ï¼Œè¿”å› <code>-1</code> ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs tap">è¾“å…¥ï¼šnums = [1, 7, 3, 6, 5, 6]<br>è¾“å‡ºï¼š3<br>è§£é‡Šï¼š<br>ä¸­å¿ƒä¸‹æ ‡æ˜¯<span class="hljs-number"> 3 </span>ã€‚<br>å·¦ä¾§æ•°ä¹‹å’Œ sum = nums[0] + nums[1] + nums[2] =<span class="hljs-number"> 1 </span>+<span class="hljs-number"> 7 </span>+<span class="hljs-number"> 3 </span>=<span class="hljs-number"> 11 </span>ï¼Œ<br>å³ä¾§æ•°ä¹‹å’Œ sum = nums[4] + nums[5] =<span class="hljs-number"> 5 </span>+<span class="hljs-number"> 6 </span>=<span class="hljs-number"> 11 </span>ï¼ŒäºŒè€…ç›¸ç­‰ã€‚<br></code></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight fix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs fix"><span class="hljs-attr">è¾“å…¥ï¼šnums </span>=<span class="hljs-string"> [1, 2, 3]</span><br><span class="hljs-string">è¾“å‡ºï¼š-1</span><br><span class="hljs-string">è§£é‡Šï¼š</span><br><span class="hljs-string">æ•°ç»„ä¸­ä¸å­˜åœ¨æ»¡è¶³æ­¤æ¡ä»¶çš„ä¸­å¿ƒä¸‹æ ‡ã€‚</span><br></code></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs tap">è¾“å…¥ï¼šnums = [2, 1, -1]<br>è¾“å‡ºï¼š0<br>è§£é‡Šï¼š<br>ä¸­å¿ƒä¸‹æ ‡æ˜¯<span class="hljs-number"> 0 </span>ã€‚<br>å·¦ä¾§æ•°ä¹‹å’Œ sum =<span class="hljs-number"> 0 </span>ï¼Œï¼ˆä¸‹æ ‡<span class="hljs-number"> 0 </span>å·¦ä¾§ä¸å­˜åœ¨å…ƒç´ ï¼‰ï¼Œ<br>å³ä¾§æ•°ä¹‹å’Œ sum = nums[1] + nums[2] =<span class="hljs-number"> 1 </span>+ -1 =<span class="hljs-number"> 0 </span>ã€‚<br></code></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li><code>1 &lt;= nums.length &lt;= 104</code></li><li><code>-1000 &lt;= nums[i] &lt;= 1000</code></li></ul><p><strong>æ³¨æ„ï¼š</strong> æœ¬é¢˜ä¸ä¸»ç«™ 1991 é¢˜ç›¸åŒï¼š<a href="https://leetcode-cn.com/problems/find-the-middle-index-in-array/">https://leetcode-cn.com/problems/find-the-middle-index-in-array/</a></p><h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ:"></a>åˆ†æ:</h3><p>æ‰¾åˆ°ä¸€ä¸ªä½ç½® , ä½¿å¾— å·¦å³ä¹‹å’Œç›¸åŒ</p><p>å³æ»¡è¶³å…³ç³» <strong>å·¦ä¾§å’Œ &#x3D; æ€»å’Œ - nums[i] - å·¦ä¾§å’Œ</strong> </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">pivotIndex</span><span class="hljs-params">(<span class="hljs-type">int</span>[] nums)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">total</span> <span class="hljs-operator">=</span> Arrays.stream(nums).sum();<br>        <span class="hljs-type">int</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; nums.length; ++i) &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-number">2</span> * sum + nums[i] == total) &#123;<br>                <span class="hljs-keyword">return</span> i;<br>            &#125;<br>            sum += nums[i];<br>        &#125;<br>        <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;<br>    &#125;<br>&#125;<br><br>ä½œè€…ï¼šåŠ›æ‰£å®˜æ–¹é¢˜è§£<br>é“¾æ¥ï¼šhttps:<span class="hljs-comment">//leetcode.cn/problems/find-pivot-index/solutions/579264/xun-zhao-shu-zu-de-zhong-xin-suo-yin-by-gzjle/</span><br>æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰<br>è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">pivotIndex</span><span class="hljs-params">(<span class="hljs-type">int</span>[] nums)</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> nums.length;<br>    <span class="hljs-comment">//1.ç»´æŠ¤ä¸¤ä¸ªå˜é‡ï¼Œåˆ†åˆ«è¡¨ç¤ºå½“å‰ä½ç½®çš„å‰åç¼€å’Œ</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">prefix</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">suffix</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-comment">//2.ç¬¬ä¸€ä¸ªä½ç½®çš„åç¼€å’Œä¸º[1, n-1]å…ƒç´ å’Œ</span><br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt; n; i++) &#123;<br>        suffix += nums[i];<br>    &#125;<br>    <span class="hljs-comment">//å¦‚æœ0ä½ç½®å°±æ˜¯ä¸­å¿ƒä¸‹æ ‡ï¼Œç›´æ¥è¿”å›</span><br>    <span class="hljs-keyword">if</span>(prefix == suffix) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>    <span class="hljs-comment">//3.æ¯æ¬¡æ›´æ–°å½“å‰ä½ç½®çš„å‰åç¼€å’Œ</span><br>    <span class="hljs-comment">//å½“å‰ä½ç½®å‰ç¼€å’Œï¼šæ¯æ¬¡åŠ ä¸Ši-1çš„æ•° å½“å‰ä½ç½®åç¼€å’Œï¼Œæ¯æ¬¡æ‰£é™¤iä½ç½®æ•°</span><br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt; n; i++) &#123;<br>        prefix += nums[i - <span class="hljs-number">1</span>];<br>        suffix -= nums[i];<br>        <span class="hljs-keyword">if</span>(prefix == suffix) &#123;<br>            <span class="hljs-keyword">return</span> i;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ç®—æ³•</category>
      
      <category>Leetcode</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Leetcode</tag>
      
      <tag>ç®€å•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Minioå¯¹è±¡å­˜å‚¨</title>
    <link href="/post/5ba1c0a2-54bf-4057-b728-bd1ab9191349/"/>
    <url>/post/5ba1c0a2-54bf-4057-b728-bd1ab9191349/</url>
    
    <content type="html"><![CDATA[<h3 id="Minioå¯¹è±¡å­˜å‚¨"><a href="#Minioå¯¹è±¡å­˜å‚¨" class="headerlink" title="Minioå¯¹è±¡å­˜å‚¨"></a>Minioå¯¹è±¡å­˜å‚¨</h3><p><code>hexo template generate by typora plugin templater</code></p><h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><p><strong>Docker å¿«é€Ÿå®‰è£… minio</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java">sudo mkdir -p /mnt/minio/data<br><br>sudo docker run \<br>   -p <span class="hljs-number">9000</span>:<span class="hljs-number">9000</span> \<br>   -p <span class="hljs-number">9001</span>:<span class="hljs-number">9001</span> \<br>   --name minio_instance \<br>   -v /mnt/minio/data:/data \<br>   -e <span class="hljs-string">&quot;MINIO_ROOT_USER=minio&quot;</span> \<br>   -e <span class="hljs-string">&quot;MINIO_ROOT_PASSWORD=CYhZ632Fa1DnclQXzvmp&quot;</span> \<br>   quay.io/minio/minio server /data --console-address <span class="hljs-string">&quot;:9001&quot;</span><br></code></pre></td></tr></table></figure><p><img src="image-20240707235948167.png" alt="image-20240707235948167"></p><h2 id="MinIO-root-ç”¨æˆ·"><a href="#MinIO-root-ç”¨æˆ·" class="headerlink" title="MinIO root ç”¨æˆ·"></a><a href="https://www.minio.org.cn/docs/minio/container/administration/identity-access-management/minio-user-management.html#id9">MinIO <code>root</code> ç”¨æˆ·</a></h2><p>MinIOéƒ¨ç½²ä¸­æœ‰ä¸€ä¸ªåä¸º <code>root</code> çš„ç”¨æˆ·ï¼Œè¯¥ç”¨æˆ·å¯ä»¥è®¿é—®éƒ¨ç½²ä¸Šçš„æ‰€æœ‰ æ“ä½œå’Œèµ„æºï¼Œæ— è®ºé…ç½®äº†å“ªç§ <a href="https://www.minio.org.cn/docs/minio/container/administration/identity-access-management.html#minio-authentication-and-identity-management">èº«ä»½ç®¡ç†å™¨ï¼ˆidentity managerï¼‰</a>ã€‚å½“ä¸€ä¸ªMinIOæœåŠ¡å™¨é¦–æ¬¡å¯åŠ¨æ—¶ï¼Œ å®ƒä¼šé€šè¿‡æ£€æŸ¥ä»¥ä¸‹ç¯å¢ƒå˜é‡çš„å€¼æ¥è®¾ç½® <code>root</code> ç”¨æˆ·çš„å‡­æ®ï¼š</p><ul><li><code>MINIO_ROOT_USER</code></li><li><code>MINIO_ROOT_PASSWORD</code></li></ul><p>è¦è½®æ¢æ ¹ç”¨æˆ·å‡­æ®ï¼Œéœ€è¦æ›´æ–°éƒ¨ç½²ä¸­æ‰€æœ‰MinIOæœåŠ¡å™¨ä¸Š çš„ä¸€ä¸ªæˆ–ä¸¤ä¸ªç¯å¢ƒå˜é‡ã€‚ä¸ºæ ¹å‡­æ®æŒ‡å®š <em>é•¿ã€ å”¯ä¸€ä¸”éšæœº</em> çš„å­—ç¬¦ä¸²ã€‚ åœ¨å­˜å‚¨è®¿é—®å¯†é’¥å’Œç§˜å¯†å¯†é’¥æ—¶ï¼Œ åº”é‡‡å–æ‰€æœ‰å¯èƒ½çš„é¢„é˜²æªæ–½ï¼Œä»¥ç¡®ä¿åªæœ‰é‚£äº›å·²çŸ¥ä¸”å—ä¿¡ä»»ä¸” <em>éœ€è¦</em> è¶…çº§ç”¨æˆ·è®¿é—®æƒé™çš„ä¸ªäººæ‰èƒ½æ£€ç´¢åˆ° <code>root</code> å‡­æ®ã€‚</p><ul><li>MinIO <em>å¼ºçƒˆå»ºè®®</em> ä¸è¦åœ¨ä»»ä½•ç¯å¢ƒï¼ˆå¼€å‘ã€æµ‹è¯•æˆ–ç”Ÿäº§ï¼‰ ä¸­ä½¿ç”¨ <code>root</code> ç”¨æˆ·è¿›è¡Œå¸¸è§„å®¢æˆ·ç«¯è®¿é—®ã€‚</li><li>MinIO <em>å¼ºçƒˆå»ºè®®</em> åˆ›å»ºç”¨æˆ·ï¼Œä»¥ä¾¿æ¯ä¸ªå®¢æˆ·ç«¯éƒ½èƒ½è®¿é—® åˆ°æ‰§è¡Œå…¶åˆ†é…çš„å·¥ä½œè´Ÿè½½æ‰€éœ€çš„æœ€å°åŠ¨ä½œå’Œ èµ„æºé›†ã€‚</li></ul><p>å¦‚æœè¿™äº›å˜é‡æœªè®¾ç½®ï¼Œ<code>minio</code> å°†é»˜è®¤ä½¿ç”¨ <code>minioadmin</code> ä½œä¸º è®¿é—®å¯†é’¥ï¼Œä»¥åŠ <code>minioadmin</code> ä½œä¸ºç§˜å¯†å¯†é’¥ã€‚ MinIO <em>å¼ºçƒˆå»ºè®®</em> ä¸è¦åœ¨ä»»ä½•éƒ¨ç½²ç¯å¢ƒä¸­ ä½¿ç”¨é»˜è®¤å‡­æ®ã€‚</p><h1 id="åˆ›å»ºæ¡¶"><a href="#åˆ›å»ºæ¡¶" class="headerlink" title="åˆ›å»ºæ¡¶"></a>åˆ›å»ºæ¡¶</h1><p><img src="image-20240708000100406.png" alt="image-20240708000100406"></p><p><img src="image-20240708001654973.png" alt="image-20240708001654973"></p><p>æ¡¶é»˜è®¤å¯ä»¥æœ‰ä¸‰ç§<strong>Access Policy</strong>ç­–ç•¥ï¼š</p><ul><li><p><strong>public</strong> : ä¸ç»è¿‡ä»»ä½•è®¤è¯å¯ä»¥ç›´æ¥è®¿é—®èµ„æº</p></li><li><p><strong>private</strong>  : æ¡¶è®¾ç½®ä¸º<strong>private</strong>åï¼Œæœªç»æˆæƒä¸èƒ½è¿›è¡Œä»»ä½•æ“ä½œï¼Œæ‰€æœ‰<strong>Access Rules</strong>å¤±æ•ˆ</p></li><li><p><strong>custom</strong> : è¿™ç§<strong>Access Policy</strong>ç­–ç•¥æ˜¯é€šè¿‡å¦‚ä¸‹è‡ªå®šä¹‰<strong>Access Rules</strong>å‡ºç°çš„</p><ul><li><p><strong>readonly</strong> : å¯ä»¥è®¾ç½®èµ„æºä¸ç»è¿‡æˆæƒï¼Œåªèƒ½è¯»å–</p></li><li><p><strong>writeonly</strong> : èµ„æºä¸ç»è¿‡æˆæƒï¼Œåªèƒ½å†™å…¥</p></li><li><p><strong>readwrite</strong> èµ„æºä¸ç»è¿‡æˆæƒï¼Œå¯è¯»å¯å†™</p></li></ul></li></ul><p><img src="image-20240708002956819.png" alt="image-20240708002956819"></p><p>æ‰‹åŠ¨ä¸Šä¼ ä¸€äº›æµ‹è¯•æ–‡ä»¶åˆ° <code>minio-example-bucket/images</code> </p><p>è®¾ç½®æ¡¶ç­–ç•¥ä¸º <strong>public</strong> æ—¶ , è®¿é—®èµ„æº  <strong>logo.jpg</strong></p><p>è·¯å¾„ä¸º <code>APIåœ°å€/æ¡¶/è·¯å¾„/æ–‡ä»¶</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">http:<span class="hljs-comment">//192.168.0.104:9000/minio-example-bucket/images/logo.jpg</span><br></code></pre></td></tr></table></figure><p>è®¿é—®æˆåŠŸ</p><p><img src="image-20240708003312049.png" alt="image-20240708003312049"></p><p>ä¿®æ”¹æˆ <strong>private</strong>åå†æ¬¡è®¿é—®</p><p><img src="image-20240708003356384.png" alt="image-20240708003356384"></p>]]></content>
    
    
    <categories>
      
      <category>åç«¯</category>
      
      <category>ä¸­é—´ä»¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Minio</tag>
      
      <tag>å¯¹è±¡å­˜å‚¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ”¶è—å¤¹</title>
    <link href="/post/b828993e-4e2e-44ac-8d7f-b449d09b28d7/"/>
    <url>/post/b828993e-4e2e-44ac-8d7f-b449d09b28d7/</url>
    
    <content type="html"><![CDATA[<h3 id="æ”¶è—å¤¹"><a href="#æ”¶è—å¤¹" class="headerlink" title="æ”¶è—å¤¹"></a>æ”¶è—å¤¹</h3><p><code>hexo template generate by typora plugin templater</code></p><h1 id="Bookmarks"><a href="#Bookmarks" class="headerlink" title="Bookmarks"></a>Bookmarks</h1><ul><li>æ”¶è—å¤¹æ ç½‘é¡µå·¥å…·Edgeæ’ä»¶<a href="https://microsoftedge.microsoft.com/addons/detail/adguard-%E5%B9%BF%E5%91%8A%E6%8B%A6%E6%88%AA%E5%99%A8/pdffkfellgipmhklpdmokmckkkfcopbh?hl=zh-CN">AdGuard å¹¿å‘Šæ‹¦æˆªå™¨ - Microsoft Edge Addons</a><a href="https://microsoftedge.microsoft.com/addons/detail/%E7%AF%A1%E6%94%B9%E7%8C%B4/iikmkjmpaadaobahmlepeloendndfphd?hl=zh-CN">ç¯¡æ”¹çŒ´ - Microsoft Edge Addons</a><a href="https://microsoftedge.microsoft.com/addons/detail/%E6%B2%99%E6%8B%89%E6%9F%A5%E8%AF%8D%E8%81%9A%E5%90%88%E8%AF%8D%E5%85%B8%E5%88%92%E8%AF%8D%E7%BF%BB%E8%AF%91/idghocbbahafpfhjnfhpbfbmpegphmmp?hl=zh-CN">æ²™æ‹‰æŸ¥è¯-èšåˆè¯å…¸åˆ’è¯ç¿»è¯‘ - Microsoft Edge Addons</a><a href="https://microsoftedge.microsoft.com/addons/detail/dark-reader/ifoakfbpdcdoeenechcleahebpibofpc?hl=zh-CN">Dark Reader - Microsoft Edge Addons</a><a href="https://chat2.jinshutuan.com/#/chat/1702545336821">AIchatOS</a><a href="https://up.woozooo.com/mydisk.php">è“å¥äº‘</a><a href="http://24mail.chacuo.net/">ä¸´æ—¶é‚®ç®±</a><a href="https://htmlrev.com/">Free HTML Templates on HTMLrev</a><a href="https://tools.liumingye.cn/">åˆ˜æ˜é‡çš„å·¥å…·ç®±</a><a href="https://wannengrun.net/zh/">ä¸‡èƒ½å‘½ä»¤</a><a href="https://dict.youdao.com/">ç½‘æ˜“æœ‰é“</a><a href="https://mail.qq.com/cgi-bin/frame_html?sid=HGTR89w-rXEKE0ci&r=d96cd9437067b2597aef84cf9f0eab0c&lang=zh">QQé‚®ç®±</a><a href="https://qwerty.liumingye.cn/">Qwerty Learner</a><a href="https://chat18.aichatos.xyz/#/chat/1703125037985">AIchatOS</a><a href="https://portal.he3app.com/home/category">My categories - He3</a><a href="https://www.laoyujianli.com/">å†™ç®€å†ä»æœªå¦‚æ­¤ç®€å• - è€é±¼ç®€å†</a><a href="https://www.jyshare.com/front-end/854/">æ­£åˆ™è¡¨è¾¾å¼åœ¨çº¿æµ‹è¯• | èœé¸Ÿå·¥å…·</a><a href="https://tool.lu/">åœ¨çº¿å·¥å…· - ä½ çš„å·¥å…·ç®±</a>å›¾ç‰‡å·¥å…·<a href="https://bigjpg.com/zh">AIå›¾ç‰‡æ— æŸæ”¾å¤§</a>[PNGè½¬ICOè½¬æ¢å™¨](<a href="https://pngtoicon.com/cn#:~:text=%E5%A6%82%E4%BD%95%E5%9C%A8%E7%BA%BF%E5%B0%86PNG%E8%BD%AC%E6%8D%A2%E4%B8%BAICO">https://pngtoicon.com/cn#:~:text=å¦‚ä½•åœ¨çº¿å°†PNGè½¬æ¢ä¸ºICO</a> 1 è¦å¼€å§‹è½¬æ¢ï¼Œè¯·å°†ä¸€ä¸ªæˆ–å¤šä¸ªPNGå›¾åƒä¸Šä¼ åˆ°è½¬æ¢å™¨åŒºåŸŸã€‚,2 æ¥ä¸‹æ¥ï¼Œä½¿ç”¨è½¬æ¢è®¾ç½®ï¼Œç„¶åå•å‡»â€œè½¬æ¢â€æŒ‰é’®ã€‚ 3 è½¬æ¢å®Œæˆåï¼Œæ‚¨å¯ä»¥å•ç‹¬æˆ–åœ¨å•ä¸ªå­˜æ¡£ä¸­ä¸‹è½½ICOå›¾åƒã€‚)<a href="https://photokit.com/editor/?lang=zh">å›¾ç‰‡ç¼–è¾‘å™¨</a><a href="https://watermark.liumingye.cn/">çŸ­è§†é¢‘å»æ°´å°</a><a href="https://imagetostl.com/cn/convert/file/png/to/svg">å…è´¹å°† PNG è½¬æ¢ä¸º SVG - ImageToStl</a><a href="https://products.aspose.app/svg/zh/conversion/png-to-svg">PNG åˆ° SVG è½¬æ¢å™¨ | åœ¨çº¿å…è´¹å°† PNG è½¬æ¢ä¸º SVGï¼</a><a href="https://www.aconvert.com/cn/image/png-to-svg/">PNGè½¬SVG - åœ¨çº¿è½¬æ¢å›¾åƒæ–‡ä»¶</a>åŠ å¯†å·¥å…·<a href="https://www.cmd5.com/default.aspx">md5åœ¨çº¿è§£å¯†ç ´è§£,md5è§£å¯†åŠ å¯†</a><a href="https://openui.fly.dev/ai/f1BV6D01DxmRws93J2Ul9">Chat Application UI</a><a href="https://cyberchef.org/">CyberChef</a><a href="https://cdkm.com/cn/ppt-to-doc">PPTè½¬WORD - å…è´¹åœ¨çº¿å°†PPTæ–‡ä»¶è½¬æ¢æˆWORD</a><a href="https://mylivewallpapers.com/page/4/">MyLiveWallpapers.com - Best Live Wallpaper For Your Desktop PC and Mobile Phone</a><a href="https://pan.baidu.com/s/1u7PNExeoEsYGh5pAnSyocg?from=init&pwd=9987#list/path=%2F">3ã€é»‘é©¬ç¨‹åºå‘˜Javaå¾®æœåŠ¡é¡¹ç›®ã€Šé»‘é©¬å¤´æ¡ã€‹_å…è´¹é«˜é€Ÿä¸‹è½½|ç™¾åº¦ç½‘ç›˜-åˆ†äº«æ— é™åˆ¶</a>å­¦æ ¡<a href="https://www.sasu.edu.cn/">å››å·æ–‡ç†å­¦é™¢æ¬¢è¿æ‚¨ï¼</a><a href="http://jwc.sasu.edu.cn/web/web/web/index">æ¬¢è¿è¿›å…¥å››å·æ–‡ç†å­¦é™¢æ•™å­¦ç»¼åˆç®¡ç†ç³»ç»Ÿ</a><a href="https://hszg.sasu.edu.cn/index.htm">å·´å±±çº¢-å¤§å­¦ç”Ÿæ€æƒ³æ”¿æ²»æ•™è‚²ç‰¹è‰²èµ„æºåº“</a><a href="https://www.zhihuishu.com/">æ™ºæ…§æ ‘ç½‘</a><a href="https://i.mooc.chaoxing.com/space/index">å­¦ä¹ é€š</a>å¨±ä¹<a href="https://music.163.com/">ç½‘æ˜“äº‘éŸ³ä¹</a><a href="https://y.qq.com/">QQéŸ³ä¹</a><a href="https://www.kugou.com/">é…·ç‹—éŸ³ä¹</a><a href="https://tools.liumingye.cn/music/#/">MyFreeMP3</a><a href="http://www.wpsseo.cn/">å…¨æ°‘è§£æç½‘</a><a href="https://www.douyin.com/">æŠ–éŸ³</a><a href="https://v.qq.com/">è…¾è®¯è§†é¢‘</a><a href="https://youku.com/">ä¼˜é…·</a><a href="https://www.iqiyi.com/">çˆ±å¥‡è‰º</a><a href="https://zhutix.com/">è‡´ç¾åŒ–</a><a href="https://player.cmov.cn/?url=">å…¨æ°‘è§£æè®¡è´¹ - é«˜æ¸…æ’­æ”¾å™¨</a>åŠ¨æ¼«<a href="https://v.qq.com/x/cover/324olz7ilvo2j5f/y0048yce1wk.html">åå™¬æ˜Ÿç©ºç¬¬107è¯_åŠ¨æ¼«_é«˜æ¸…å®Œæ•´ç‰ˆè§†é¢‘åœ¨çº¿è§‚çœ‹_è…¾è®¯è§†é¢‘</a><a href="http://pic.netbian.com/">4Kå£çº¸_4Kæ‰‹æœºå£çº¸_4Ké«˜æ¸…å£çº¸å¤§å…¨_ç”µè„‘å£çº¸_4K,5K,6K,7K,8Kå£çº¸å›¾ç‰‡ç´ æ_å½¼å²¸å›¾ç½‘</a>å­¦ä¹ <a href="https://yiyan.baidu.com/">æ–‡å¿ƒä¸€è¨€</a>ç¤¾åŒº<a href="https://www.csdn.net/">CSDN</a><a href="https://gitee.com/">Gitee</a><a href="https://github.com/">GitHub</a><a href="https://juejin.cn/">ç¨€åœŸæ˜é‡‘</a><a href="https://leetcode.cn/">LeetCode</a><a href="https://www.nowcoder.com/">ç‰›å®¢ç½‘</a><a href="https://www.osrc.com/">OSRC-Open Source Runtime Community</a>å¼€å‘æ–‡æ¡£åç«¯<a href="https://sa-token.cc/index.html">Sa-Token</a><a href="https://www.justauth.cn/">JustAuth</a><a href="https://www.springcloud.cc/spring-security.html#oauth2login-sample-initial-setup">Spring Security ä¸­æ–‡æ–‡æ¡£ å‚è€ƒæ‰‹å†Œ ä¸­æ–‡ç‰ˆ</a><a href="https://doc.qzxdp.cn/spring/spring-boot.html#web.servlet">Spring Bootä¸­æ–‡æ–‡æ¡£</a><a href="https://mybatis.org/spring/zh/index.html">Mybatis-Spring</a><a href="https://baomidou.com/">MyBatis-Plus</a><a href="https://mybatis.net.cn/index.html">MyBatisä¸­æ–‡ç½‘</a><a href="https://webmagic.io/docs/zh/">WebMagic Documents</a><a href="https://www.yuque.com/zilvbenxiangziyou/fue6m0">èœ—ç‰›javaé‡ç‚¹ç²¾è®²</a><a href="https://www.easy-es.cn/">Easy-Es</a><a href="https://mybatis-flex.com/">MyBatis-Flex - MyBatis-Flex å®˜æ–¹ç½‘ç«™</a><a href="https://multipass.run/install">Multipass ç¼–æ’è™šæ‹Ÿ Ubuntu å®ä¾‹</a>å‰ç«¯<a href="https://www.w3school.com.cn/">w3school åœ¨çº¿æ•™ç¨‹</a><a href="http://www.layui-vue.com/zh-CN/components/icon">Layui - Vue å‰ç«¯ UI æ¡†æ¶</a><a href="https://element-plus.org/zh-CN/#/zh-CN">ä¸€ä¸ª Vue 3 UI æ¡†æ¶ | Element Plus</a><a href="https://router.vuejs.org/zh/">Vue Router | Vue.js çš„å®˜æ–¹è·¯ç”±</a><a href="https://cn.vuejs.org/">Vue.js - æ¸è¿›å¼ JavaScript æ¡†æ¶ | Vue.js</a><a href="https://uniapp.dcloud.net.cn/quickstart.html#">uni-appå¿«é€Ÿä¸Šæ‰‹ | uni-appå®˜ç½‘</a><a href="https://ts.nodejs.cn/">TypeScript ä¸­æ–‡ç½‘</a><a href="https://echarts.apache.org/handbook/zh/get-started/">Apache ECharts</a><a href="https://developer.harmonyos.com/">HarmonyOSåº”ç”¨å¼€å‘å®˜ç½‘ - åä¸ºHarmonyOSæ‰“é€ å…¨åœºæ™¯æ–°æœåŠ¡</a><a href="https://www.mdui.org/zh-cn/">mdui - Material Design 3 (Material You) å¼€æºå‰ç«¯ç»„ä»¶åº“ï¼Œä½¿ç”¨ Web Components å®ç°</a><a href="https://layui.dev/">Layui - æç®€æ¨¡å—åŒ–å‰ç«¯ UI ç»„ä»¶åº“(å®˜æ–¹æ–‡æ¡£)</a><a href="https://www.tampermonkey.net/documentation.php#api:GM_deleteValue">æ–‡æ¡£ | Tampermonkey</a><a href="https://element.eleme.io/">Element - The worldâ€™s most popular Vue UI framework</a><a href="https://v2.cn.vuejs.org/">Vue.js</a><a href="https://www.wangeditor.com/">wangEditor</a><a href="https://www.wangeditor.com/v5/content.html#ajax-%E5%BC%82%E6%AD%A5%E8%AE%BE%E7%BD%AE%E5%86%85%E5%AE%B9">å†…å®¹å¤„ç† | wangEditor</a><a href="https://varlet.gitee.io/varlet-ui/#/zh-CN/link">é¢å‘ Vue3 çš„ Material é£æ ¼ç§»åŠ¨ç«¯ç»„ä»¶åº“</a><a href="https://primevue.org/uikit/">UI Kit - PrimeVue</a>åç«¯æ‰©å±•oauth<a href="https://gitee.com/api/v5/oauth_doc#/">Gitee OAuth æ–‡æ¡£</a><a href="https://docs.github.com/zh">GitHub Docs</a><a href="https://wiki.connect.qq.com/%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C_oauth2-0">å‡†å¤‡å·¥ä½œ_OAuth2.0 â€” QQäº’è”WIKI</a><a href="http://localhost:8080/api/auth/oauth2/code/gitee?code=002633296b0f1b5f38aa0e918ac119cad4cf1b218532b28ab705ad910a4019ce">localhost:8080&#x2F;api&#x2F;auth&#x2F;oauth2&#x2F;code&#x2F;gitee?code&#x3D;002633296b0f1b5f38aa0e918ac119cad4cf1b218532b28ab705ad910a4019ce</a><a href="https://app.open.qq.com/p/developer/team_manage/info">å¼€å‘è€…ä¿¡æ¯å±•ç¤ºé¡µ</a><a href="https://connect.qq.com/manage.html#/">QQäº’è”ç®¡ç†ä¸­å¿ƒ</a><a href="https://www.thymeleaf.org/doc/articles/standarddialect5minutes.html">5 åˆ†é’Ÿå†…å¼€å§‹ä½¿ç”¨æ ‡å‡†æ–¹è¨€ - Thymeleaf</a><a href="https://javen205.gitee.io/ijpay/">IJPay</a><a href="https://easyexcel.opensource.alibaba.com/">EasyExcelå®˜æ–¹æ–‡æ¡£ - åŸºäºJavaçš„Excelå¤„ç†å·¥å…· | Easy Excel</a><a href="https://sparkjava.com/documentation">Spark Framework</a><a href="https://www.linuxcool.com/">Linuxå‘½ä»¤å¤§å…¨(æ‰‹å†Œ) â€“ çœŸæ­£å¥½ç”¨çš„Linuxå‘½ä»¤åœ¨çº¿æŸ¥è¯¢ç½‘ç«™</a><a href="https://www.thymeleaf.org/doc/tutorials/3.1/usingthymeleaf.html">æ•™ç¨‹ï¼šä½¿ç”¨ Thymeleaf</a><a href="http://easy-trans.fhs-opensource.top/components/faq.html">Easy-Trans | Easy-Trans</a><a href="https://x-file-storage.xuyanwu.cn/#/">XFileStorage</a>QQæœºå™¨äººQQå®˜æ–¹æœºå™¨äºº(apiå¤ªå¡äº†)<a href="https://bot.q.qq.com/wiki/develop/pythonsdk/#sdk-%E5%AE%89%E8%A3%85">Python SDK æ¥å…¥æŒ‡å— | QQæœºå™¨äººæ–‡æ¡£</a><a href="https://bot.q.qq.com/wiki/#%E7%AE%80%E4%BB%8B">QQ æœºå™¨äºº | QQæœºå™¨äººæ–‡æ¡£</a><a href="https://github.com/tencent-connect/botpy">GitHub - tencent-connect&#x2F;botpy: QQé¢‘é“æœºå™¨äººPythonSDK</a>mirai<a href="https://docs.mirai.mamoe.net/">Mirai QQæœºå™¨äºº</a><a href="https://github.com/mamoe/mirai">GitHub - mamoe&#x2F;mirai: é«˜æ•ˆç‡ QQ æœºå™¨äººæ”¯æŒåº“</a>go-cqhttp<a href="https://docs.go-cqhttp.org/">go-cqhttp å¸®åŠ©ä¸­å¿ƒ</a><a href="https://github.com/Mrs4s/go-cqhttp">GitHub - Mrs4s&#x2F;go-cqhttp: cqhttpçš„golangå®ç°ï¼Œè½»é‡ã€åŸç”Ÿè·¨å¹³å°.</a>å…¶ä»–<a href="http://blog.fondme.cn/apidoc/jdk-1.8-google/">Overview (Java Platform SE 8 )</a><a href="https://www.w3xue.com/manual/">åœ¨çº¿é€ŸæŸ¥æ‰‹å†Œ - W3xue</a><a href="https://developers.weixin.qq.com/doc/">åŸºç¡€ | å¾®ä¿¡å¼€æ”¾æ–‡æ¡£</a><a href="https://q.qq.com/#/">QQ å¼€æ”¾å¹³å°</a><a href="https://developer.open-douyin.com/console?type=5">æ§åˆ¶å° - æŠ–éŸ³å¼€æ”¾å¹³å°</a><a href="https://www.runoob.com/">èœé¸Ÿæ•™ç¨‹ - å­¦çš„ä¸ä»…æ˜¯æŠ€æœ¯ï¼Œæ›´æ˜¯æ¢¦æƒ³ï¼</a>å¼€å‘å·¥å…·<a href="https://devhints.io/">å¼€å‘è€…é€ŸæŸ¥è¡¨</a><a href="https://uiverse.io/all">3727 UI elements: CSS &amp; Tailwind</a><a href="https://www.free-api.com/">æ¥å£å¤§å…¨-å…è´¹API,æ”¶é›†æ‰€æœ‰å…è´¹çš„API</a><a href="https://www.89ip.cn/">å…è´¹ä»£ç†IP_å…è´¹HTTPä»£ç†IP_SOCKS5ä»£ç†æœåŠ¡å™¨_ä¼˜è´¨IPä»£ç†_89å…è´¹ä»£ç†IP</a><a href="https://shijianchuo.net/md5/">åœ¨çº¿MD5åŠ å¯†</a><a href="https://chat2.jinshutuan.com/#/chat/1702529636770">AIchatOS</a><a href="https://api.gumengya.com/Docs/#/Doc/news">API - æ•…æ¢¦</a><a href="https://uiverse.io/">Explore 3000+ Free UI Elements: CSS &amp; Tailwind</a><a href="https://www.iconfont.cn/">iconfont-é˜¿é‡Œå·´å·´çŸ¢é‡å›¾æ ‡åº“</a><a href="https://svgwave.in/">Svg Wave - A free &amp; beautiful gradient SVG wave Generator.</a><a href="https://www.ventoy.net/cn/index.html">Ventoy</a><a href="https://learngitbranching.js.org/?locale=zh_CN">Learn Git Branching</a>æ“ä½œç³»ç»Ÿ<a href="https://mirrors.tuna.tsinghua.edu.cn/">æ¸…åå¤§å­¦å¼€æºè½¯ä»¶é•œåƒç«™ | Tsinghua Open Source Mirror</a><a href="https://next.itellyou.cn/Original/">åŸç‰ˆè½¯ä»¶</a><a href="https://wiki.archlinuxcn.org/zh-hans/">Arch Linux ä¸­æ–‡ç»´åŸº</a><a href="https://cn.ubuntu.com/download">Ubuntuç³»ç»Ÿä¸‹è½½ | Ubuntu</a><a href="https://www.deepin.org/index/zh">deepin - åŸºäºLinuxçš„å¼€æºå›½äº§æ“ä½œç³»ç»Ÿ</a><a href="https://kubuntu.org/">Kubuntu | Friendly Computing</a>åšå®¢Maven<a href="https://blog.csdn.net/weixin_44985115/article/details/115253160?ops_request_misc=%7B%22request_id%22:%22170279043216800182182372%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=170279043216800182182372&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-115253160-null-null.142%5Ev96%5Epc_search_result_base8&utm_term=maven&spm=1018.2226.3001.4187">å²ä¸Šæœ€å…¨å®‰è£…Mavenæ•™ç¨‹</a><a href="https://blog.csdn.net/Q176782/article/details/126628947">Mavenæ‰“åŒ…æ’ä»¶ä»‹ç»</a><a href="https://blog.csdn.net/weixin_47201411/article/details/125803485">è§£å†³mavené¡¹ç›®æ‰“åŒ…è¿è¡Œæ—¶å‡ºç°â€œæ²¡æœ‰ä¸»æ¸…å•å±æ€§â€é—®é¢˜_mavenæ‰“åŒ…æ²¡æœ‰ä¸»æ¸…å•å±æ€§-CSDNåšå®¢</a><a href="https://blog.csdn.net/CSDN13822805069/article/details/122858429">JavaWebé¡¹ç›®ç›¸å…³çš„ä¾èµ–(Mavenä»“åº“)_javawebé¡¹ç›®éœ€è¦çš„ä¾èµ–-CSDNåšå®¢</a>JavaEESpring<a href="https://blog.csdn.net/weixin_39709134/article/details/131854218">åŸºäºJava+SpringBoot+vueå‰åç«¯åˆ†ç¦»åœ¨çº¿æ–‡æ¡£ç®¡ç†ç³»ç»Ÿè®¾è®¡å®ç°_vueæ–‡æ¡£ç®¡ç†ç³»ç»Ÿ-CSDNåšå®¢</a><a href="https://blog.csdn.net/qq_41367934/article/details/120268860">Javaä¹‹springæ–°æ‰‹æ•™ç¨‹(åŒ…æ•™åŒ…ä¼š)_java spring-CSDNåšå®¢</a><a href="https://blog.csdn.net/Object_de_Father/article/details/111737733">SpringAOPæ˜¯å•¥ï¼Œæ€ä¹ˆç”¨ï¼Ÿ_ä»€ä¹ˆæ˜¯springaop-CSDNåšå®¢</a><a href="https://blog.csdn.net/fmwind/article/details/81235401">Spring Booté…ç½®æ¥å£ WebMvcConfigurer_å®ç°webmvcconfigurer-CSDNåšå®¢</a><a href="https://blog.csdn.net/weixin_52850476/article/details/124847728">SSM æ•´åˆè¯¦ç»†æ­¥éª¤ä¸é…ç½®ï¼ˆçº¯æ³¨è§£ï¼‰_ssmæ•´åˆ-CSDNåšå®¢</a><a href="https://blog.csdn.net/zhangpower1993/article/details/89016503">SpringBootâ€”WebMvcConfigurerè¯¦è§£-CSDNåšå®¢</a><a href="https://blog.csdn.net/weixin_44207403/article/details/106736102">Spring-å…¨é¢è¯¦è§£ï¼ˆå­¦ä¹ æ€»ç»“ï¼‰_springå…¨é¢è¯¦è§£-CSDNåšå®¢</a><a href="https://blog.csdn.net/qq_44823283/article/details/125448132">ssmæ¡†æ¶ä¸­æ³¨è§£æ€»ç»“_ssmæ¡†æ¶æ³¨è§£-CSDNåšå®¢</a><a href="https://blog.csdn.net/guorui_java/article/details/107347754">Springå¸¸ç”¨æ³¨è§£ï¼ˆç»å¯¹ç»å…¸ï¼‰_springæ³¨è§£-CSDNåšå®¢</a><a href="https://blog.csdn.net/Weixiaohuai/article/details/120853683?ops_request_misc=%7B%22request_id%22:%22170265578916800182118455%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=170265578916800182118455&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-120853683-null-null.142%5Ev96%5Epc_search_result_base8&utm_term=@autowired%E5%92%8C@resource%E5%8C%BA%E5%88%AB&spm=1018.2226.3001.4187">Springä¸­@Autowiredå’Œ@Resourceçš„åŒºåˆ«_spring resourceå’Œautowired-CSDNåšå®¢</a><a href="https://blog.csdn.net/xu12387/article/details/88818278?ops_request_misc=%7B%22request_id%22:%22170272983116800184119479%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=170272983116800184119479&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-88818278-null-null.142%5Ev96%5Epc_search_result_base8&utm_term=SpringBoot%E4%BD%BF%E7%94%A8Websocket&spm=1018.2226.3001.4187">springbootï¼ˆåä¸€ï¼‰WebSocketå®ç°å‰åç«¯æ¶ˆæ¯æ¨é€_javaä½¿ç”¨webstocketå®ç°å‰åç«¯äº’å‘æ¶ˆæ¯-CSDNåšå®¢</a><a href="https://blog.csdn.net/qq_36942720/article/details/135223537?ops_request_misc=%7B%22request_id%22:%22170661795816800185893998%22,%22scm%22:%2220140713.130102334.pc_all.%22%7D&request_id=170661795816800185893998&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~times_rank-1-135223537-null-null.142%5Ev99%5Epc_search_result_base1&utm_term=springboot3%E9%9B%86%E6%88%90swagger3&spm=1018.2226.3001.4187">SpringBoot3 æ•´åˆSwagger_springboot3é›†æˆswagger-CSDNåšå®¢</a><a href="https://blog.csdn.net/shijizhe1/article/details/130495081?ops_request_misc=&request_id=&biz_id=102&utm_term=SpringDoc%E9%85%8D%E7%BD%AE&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-0-130495081.142%5Ev99%5Epc_search_result_base1&spm=1018.2226.3001.4187">åŸºäºSpringBoot3ä»é›¶é…ç½®SpringDoc_springdoc é…ç½®-CSDNåšå®¢</a><a href="https://blog.csdn.net/glenshappy/article/details/127526427?ops_request_misc=%7B%22request_id%22:%22171073909316800186583736%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=171073909316800186583736&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-127526427-null-null.142%5Ev99%5Epc_search_result_base1&utm_term=spring%E4%BA%8B%E5%8A%A1%E5%A4%B1%E6%95%88%E5%9C%BA%E6%99%AF&spm=1018.2226.3001.4187">springäº‹åŠ¡å¤±æ•ˆçš„å„ç§åœºæ™¯ï¼ˆ13ç§ï¼‰_äº‹åŠ¡å¤±æ•ˆçš„å‡ ç§åœºæ™¯-CSDNåšå®¢</a><a href="https://blog.csdn.net/dayuiicghaid/article/details/125260092?ops_request_misc=%7B%22request_id%22:%22171073934416800184193163%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=171073934416800184193163&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-125260092-null-null.142%5Ev99%5Epc_search_result_base1&utm_term=spring%E4%BA%8B%E5%8A%A1%E4%BC%A0%E6%92%AD%E6%9C%BA%E5%88%B6&spm=1018.2226.3001.4187">Springçš„7ç§äº‹åŠ¡ä¼ æ’­æœºåˆ¶_springäº‹åŠ¡ä¼ æ’­æœºåˆ¶-CSDNåšå®¢</a>SpirngSecurity<a href="https://blog.csdn.net/q66562636/article/details/124914906">SpringSecurityåŠ¨æ€é‰´æƒæµç¨‹è§£æ_springsecurityé‰´æƒ-CSDNåšå®¢</a><a href="https://blog.csdn.net/weixin_50569789/article/details/123766739?ops_request_misc=%7B%22request_id%22:%22170340687316800180682901%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=170340687316800180682901&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-123766739-null-null.142%5Ev96%5Epc_search_result_base8&utm_term=springsecurity&spm=1018.2226.3001.4187">SpringSecurityæ¡†æ¶ã€è¯¦è§£ã€‘-CSDNåšå®¢</a><a href="https://blog.csdn.net/weixin_50569789/article/details/123766739">SpringSecurityæ¡†æ¶ã€è¯¦è§£ã€‘-CSDNåšå®¢</a><a href="https://blog.csdn.net/heshengfu1211/article/details/123725104">æ‰‹æŠŠæ‰‹å¸¦ä½ åœ¨é›†æˆSpringSecurityçš„SpringBootåº”ç”¨ä¸­æ·»åŠ çŸ­ä¿¡éªŒè¯ç ç™»å½•è®¤è¯åŠŸèƒ½_springsecurityè´¦å·å¯†ç ç™»å½•æˆ– çŸ­ä¿¡éªŒè¯ç ç™»å½•-CSDNåšå®¢</a><a href="https://blog.csdn.net/heshengfu1211/article/details/123621872">ä¸€æ–‡æ¢³ç†SpringSecurityä¸­çš„ç™»å½•è®¤è¯æµç¨‹_public void com.boco.sdp.auth.handler.authenticati-CSDNåšå®¢</a>[Spring Security 6.x ç³»åˆ—ï¼ˆ5ï¼‰â€”â€” Servlet è®¤è¯ä½“ç³»ç»“æ„ä»‹ç»_springsecurity 6.1-CSDNåšå®¢](<a href="https://blog.csdn.net/ctwy291314/article/details/134615099?ops_request_misc=%7B%22request_id%22:%22170392388416800185894522%22,%22scm%22:%2220140713.130102334.pc_all.%22%7D&request_id=170392388416800185894522&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-4-134615099-null-null.142%5Ev99%5Epc_search_result_base8&utm_term=SpringSecurity6">https://blog.csdn.net/ctwy291314/article/details/134615099?ops_request_misc=%7B%22request%5Fid%22%3A%22170392388416800185894522%22%2C%22scm%22%3A%2220140713.130102334.pc%5Fall.%22%7D&amp;request_id=170392388416800185894522&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-4-134615099-null-null.142^v99^pc_search_result_base8&amp;utm_term=SpringSecurity6</a> è·å– providermanager&amp;spm&#x3D;1018.2226.3001.4187)<a href="https://blog.csdn.net/yorickjun/article/details/116645852?ops_request_misc=%7B%22request_id%22:%22170403015016800226518424%22,%22scm%22:%2220140713.130102334.pc_all.%22%7D&request_id=170403015016800226518424&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-1-116645852-null-null.142%5Ev99%5Epc_search_result_base8&utm_term=SpringSecurity%E4%BD%BF%E7%94%A8OAuth%E8%BF%9B%E8%A1%8C%E7%AC%AC%E4%B8%89%E6%96%B9%E6%8E%88%E6%9D%83&spm=1018.2226.3001.4187">SpringSecurityç»“åˆOAuth2å®ç°ç¬¬ä¸‰æ–¹æˆæƒ-CSDNåšå®¢</a><a href="https://docs.spring.io/spring-security/reference/migration-7/configuration.html#_use_the_lambda_dsl">Configuration Migrations :: Spring Security</a><a href="https://blog.csdn.net/weixin_41866717/article/details/128889475?ops_request_misc=%7B%22request_id%22:%22170434988216800213097969%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=170434988216800213097969&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~baidu_landing_v2~default-1-128889475-null-null.142%5Ev99%5Epc_search_result_base8&utm_term=AuthorizationRequestRepository&spm=1018.2226.3001.4187">Spring Security æºç è§£è¯»ï¼šOAuth2.0 Login Client_spring oauth2.0 login-CSDNåšå®¢</a>[æ–°ç‰ˆSpringSecurityé…ç½®ï¼ˆSpringBootï¼2.7&amp;SpringSecurityï¼5.7ï¼‰_spring security5.7 é…ç½®-CSDNåšå®¢](<a href="https://blog.csdn.net/zhongjianboy/article/details/130721399?ops_request_misc=%7B%22request_id%22:%22170454049716777224459308%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=170454049716777224459308&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~baidu_landing_v2~default-1-130721399-null-null.142%5Ev99%5Epc_search_result_base8&utm_term=%E6%96%B0%E7%89%88">https://blog.csdn.net/zhongjianboy/article/details/130721399?ops_request_misc=%7B%22request%5Fid%22%3A%22170454049716777224459308%22%2C%22scm%22%3A%2220140713.130102334..%22%7D&amp;request_id=170454049716777224459308&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~baidu_landing_v2~default-1-130721399-null-null.142^v99^pc_search_result_base8&amp;utm_term=æ–°ç‰ˆ</a> AuthenticationManager&amp;spm&#x3D;1018.2226.3001.4187)[SpringSecurityç³»åˆ—&#x2F;spring_security_04&#x2F;Spring Security æ•´åˆJWTï¼ˆå››ï¼‰.md Â· zhengqingya&#x2F;java-workspace - Gitee.com](<a href="https://gitee.com/zhengqingya/java-workspace/blob/master/SpringSecurity%E7%B3%BB%E5%88%97/spring_security_04/Spring">https://gitee.com/zhengqingya/java-workspace/blob/master/SpringSecurityç³»åˆ—/spring_security_04/Spring</a> Security æ•´åˆJWTï¼ˆå››ï¼‰.md#3securityè®¿é—®é‰´æƒä¸­è®¤è¯ç”¨æˆ·ä¿¡æ¯)Mybatis &amp; Mysqlæ•°æ®åº“<a href="https://blog.csdn.net/progammer10086/article/details/131123422?ops_request_misc=%7B%22request_id%22:%22171080925916800226586423%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=171080925916800226586423&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-131123422-null-null.142%5Ev99%5Epc_search_result_base1&utm_term=mybatisplus%E6%95%B0%E6%8D%AE%E6%9D%83%E9%99%90%E8%BF%87%E6%BB%A4&spm=1018.2226.3001.4187">MyBatis Plus æ‹¦æˆªå™¨å®ç°æ•°æ®æƒé™æ§åˆ¶(å®Œæ•´ç‰ˆ)_mybatisplusæ•°æ®æƒé™è¿‡æ»¤-CSDNåšå®¢</a><a href="https://blog.csdn.net/qq_43437874/article/details/118330067?ops_request_misc=&request_id=&biz_id=102&utm_term=mybatisplus%E6%95%B0%E6%8D%AE%E6%9D%83%E9%99%90&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-3-118330067.142%5Ev99%5Epc_search_result_base1&spm=1018.2226.3001.4187">Mybatis-Pluså…¥é—¨ç³»åˆ—(18) -åŸºäºæ³¨è§£çš„åŠ¨æ€æ•°æ®æƒé™å®ç°æ–¹æ¡ˆ_setoperationlist-CSDNåšå®¢</a><a href="https://blog.csdn.net/ZGL_cyy/article/details/110668927">Mybatisä½¿ç”¨æ³¨è§£æ–¹å¼é…ç½®_mybatis é…ç½®ç±»-CSDNåšå®¢</a><a href="https://blog.csdn.net/qq_41057885/article/details/125824289">@MapKeyç”¨æ³•è¯´æ˜-CSDNåšå®¢</a><a href="https://blog.csdn.net/chenbo19867758/article/details/80022354">æ•°æ®åº“æ•°å€¼ç±»å‹å¯¹åº”Integerè¿˜æ˜¯int_integerå¯¹åº”æ•°æ®åº“ä»€ä¹ˆç±»å‹-CSDNåšå®¢</a><a href="https://blog.csdn.net/weixin_44207403/article/details/106565877">mysqlå…¨é¢è¯¦è§£_mysql -h$ip -p$port -u$user -p-CSDNåšå®¢</a><a href="https://ximeneschen.blog.csdn.net/article/details/126085063">mybatisä¸­@Results,@ResultMapæ³¨è§£ä½¿ç”¨-CSDNåšå®¢</a><a href="https://blog.csdn.net/weixin_45851945/article/details/114287877">MySQL æœ‰è¿™ä¸€ç¯‡å°±å¤Ÿï¼ˆå‘•å¿ƒç‹‚æ•²37kå­—ï¼Œåªä¸ºåšå›ä¸€ç‚¹èµï¼ï¼ï¼ï¼‰_mysql æœ‰è¿™ä¸€ç¯‡å°±å¤Ÿ(å‘•å¿ƒç‹‚æ•²37kå­—,åªä¸ºåšå›ä¸€ç‚¹èµ!!!)-CSDNåšå®¢</a><a href="https://blog.csdn.net/zzzgd_666/article/details/100709605?ops_request_misc=%7B%22request_id%22:%22170308102016800182713615%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=170308102016800182713615&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-100709605-null-null.142%5Ev96%5Epc_search_result_base8&utm_term=%E9%87%87%E7%94%A8%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86&spm=1018.2226.3001.4187">ä½¿ç”¨äºŒè¿›åˆ¶ä½æ¥æ§åˆ¶æƒé™,è¡¨è®¾è®¡_äºŒè¿›åˆ¶æƒé™-CSDNåšå®¢</a>[Mysqlå­˜å‚¨jsonæ ¼å¼æ•°æ®éœ€è¦æŒæ¡çš„-CSDNåšå®¢](<a href="https://blog.csdn.net/weixin_43888891/article/details/130225150?ops_request_misc=%7B%22request_id%22:%22170876648416800213052264%22,%22scm%22:%2220140713.130102334.pc_all.%22%7D&request_id=170876648416800213052264&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-1-130225150-null-null.142%5Ev99%5Epc_search_result_base1&utm_term=mysql">https://blog.csdn.net/weixin_43888891/article/details/130225150?ops_request_misc=%7B%22request%5Fid%22%3A%22170876648416800213052264%22%2C%22scm%22%3A%2220140713.130102334.pc%5Fall.%22%7D&amp;request_id=170876648416800213052264&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-1-130225150-null-null.142^v99^pc_search_result_base1&amp;utm_term=mysql</a> ä½¿ç”¨JSONä¸€å¼ è¡¨å­˜ç³»ç»Ÿæ‰€æœ‰æ•°æ®&amp;spm&#x3D;1018.2226.3001.4187)[MYSQL JSON å‡½æ•°_mysql jsonå‡½æ•°-CSDNåšå®¢](<a href="https://blog.csdn.net/qq_28204635/article/details/125554612?ops_request_misc=%7B%22request_id%22:%22171073176516800184180673%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=171073176516800184180673&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-2-125554612-null-null.142%5Ev99%5Epc_search_result_base1&utm_term=mysql">https://blog.csdn.net/qq_28204635/article/details/125554612?ops_request_misc=%7B%22request%5Fid%22%3A%22171073176516800184180673%22%2C%22scm%22%3A%2220140713.130102334..%22%7D&amp;request_id=171073176516800184180673&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-2-125554612-null-null.142^v99^pc_search_result_base1&amp;utm_term=mysql</a> jsonå‡½æ•°&amp;spm&#x3D;1018.2226.3001.4187)<a href="https://blog.csdn.net/qq_41071754/article/details/130173193?ops_request_misc=%7B%22request_id%22:%22171080985216800227460728%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=171080985216800227460728&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-130173193-null-null.142%5Ev99%5Epc_search_result_base1&utm_term=mybatisplus%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8F%92%E4%BB%B6&spm=1018.2226.3001.4187">ã€MyBatis Plusã€‘004 â€“ MyBatis Plusé«˜çº§ï¼ˆARã€MPæ’ä»¶ã€è‡ªå®šä¹‰å…¨å±€æ“ä½œã€è‡ªåŠ¨å¡«å……ã€é€»è¾‘åˆ é™¤ã€æšä¸¾ã€ä»£ç ç”Ÿæˆå™¨ï¼‰_mybatisplusè‡ªå®šä¹‰æ’ä»¶-CSDNåšå®¢</a><a href="https://blog.csdn.net/qq_45732538/article/details/132540943?ops_request_misc=%7B%22request_id%22:%22171082757416800186580596%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=171082757416800186580596&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-132540943-null-null.142%5Ev99%5Epc_search_result_base1&utm_term=ruoyi%E6%95%B0%E6%8D%AE%E6%9D%83%E9%99%90&spm=1018.2226.3001.4187">ruoyiâ€“æ•°æ®æƒé™_è‹¥ä¾æ•°æ®æƒé™-CSDNåšå®¢</a><a href="https://blog.csdn.net/qq_32077121/article/details/135754286?ops_request_misc=%7B%22request_id%22:%22171602962216800215047119%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=171602962216800215047119&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-135754286-null-null.142%5Ev100%5Epc_search_result_base3&utm_term=mysql%E7%9A%84data%E6%96%87%E4%BB%B6%E6%80%8E%E4%B9%88%E8%BF%81%E7%A7%BB&spm=1018.2226.3001.4187">mysqlæ•°æ®è¿ç§»ä¹‹dataç›®å½•å¤åˆ¶æ–¹æ³•_mysql dataæ–‡ä»¶ç§»æ¤-CSDNåšå®¢</a>JSP<a href="https://blog.csdn.net/a_helloword/article/details/80193810">JSTLæ ¸å¿ƒæ ‡ç­¾è¶…è¯¦ç»†_jstlæ ¸å¿ƒæ ‡ç­¾åº“-CSDNåšå®¢</a><a href="https://blog.csdn.net/IT_WEH_coder/article/details/126620622">åŸºäºMVCä¸‰å±‚æ¶æ„çš„å›¾ä¹¦ç®¡ç†ç³»ç»Ÿï¼ˆJavaWeb+Mavené¡¹ç›®ï¼‰_åŸºäºmvcæ¡†æ¶çš„å›¾ä¹¦ç®¡ç†ç³»ç»Ÿ-CSDNåšå®¢</a><a href="https://blog.csdn.net/weixin_29002595/article/details/114113009">java web controller_Java web ç¼–ç¨‹è§„èŒƒ ä¹‹ controllerè§„èŒƒ-CSDNåšå®¢</a><a href="https://blog.csdn.net/weixin_41995541/article/details/119716580">Javaå­¦ä¹ ä¹‹JavaWebç¯‡_java web-CSDNåšå®¢</a><a href="https://blog.csdn.net/liuduke1/article/details/108302474">é€šè¿‡å†…ç½‘ç©¿é€è®©åˆ«äººè®¿é—®è‡ªå·±çš„JavaWebé¡¹ç›®_è®©åˆ«äººè®¿é—®åˆ°æˆ‘çš„webé¡¹ç›®-CSDNåšå®¢</a>Redis<a href="https://blog.csdn.net/weixin_43811057/article/details/120382906?ops_request_misc=&request_id=&biz_id=102&utm_term=springBoot%E4%B8%AD%E4%BD%BF%E7%94%A8Redis&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-2-120382906.142%5Ev99%5Epc_search_result_base8&spm=1018.2226.3001.4187">springBootæ•´åˆredisä½¿ç”¨ä»‹ç»ï¼ˆè¯¦ç»†æ¡ˆä¾‹ï¼‰_redis springboot-CSDNåšå®¢</a><a href="https://www.runoob.com/redis/redis-keys.html">Redis é”®(key) | èœé¸Ÿæ•™ç¨‹</a><a href="https://blog.csdn.net/zl1zl2zl3/article/details/110987968?ops_request_misc=%7B%22request_id%22:%22170663375516800215083900%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=170663375516800215083900&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-110987968-null-null.142%5Ev99%5Epc_search_result_base1&utm_term=Cacheable&spm=1018.2226.3001.4187">SpringBoot ç¼“å­˜ä¹‹ @Cacheable è¯¦ç»†ä»‹ç»-CSDNåšå®¢</a><a href="https://blog.csdn.net/qq_56098414/article/details/124770709?ops_request_misc=%7B%22request_id%22:%22170663458516800222856260%22,%22scm%22:%2220140713.130102334.pc_all.%22%7D&request_id=170663458516800222856260&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-8-124770709-null-null.142%5Ev99%5Epc_search_result_base1&utm_term=@cacheable%E4%B8%8D%E7%94%9F%E6%95%88&spm=1018.2226.3001.4187">@Cacheableæœªç”Ÿæ•ˆçš„åŸå› _cacheableæ³¨è§£ä¸ç”Ÿæ•ˆ-CSDNåšå®¢</a>å®ç”¨ä¸šåŠ¡<a href="https://blog.csdn.net/wu1317581750/article/details/89355622?ops_request_misc=&request_id=&biz_id=102&utm_term=%E7%BB%91%E5%AE%9A%E7%AC%AC%E4%B8%89%E6%96%B9%E8%A1%A8&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-2-89355622.142%5Ev99%5Epc_search_result_base1&spm=1018.2226.3001.4187">å¦‚ä½•è®¾è®¡ user è¡¨ï¼ŸåŠ å…¥ç¬¬ä¸‰æ–¹ç™»å½•å‘¢ï¼Ÿ_user identifer è¡¨-CSDNåšå®¢</a><a href="https://blog.csdn.net/weixin_65549694/article/details/125055243?ops_request_misc=&request_id=&biz_id=102&utm_term=%E9%9B%AA%E8%8A%B1%E7%AE%97%E6%B3%95%E5%A4%B1%E5%8E%BB%E7%B2%BE%E5%BA%A6%E9%97%AE%E9%A2%98&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-2-125055243.142%5Ev99%5Epc_search_result_base1&spm=1018.2226.3001.4187">é›ªèŠ±ç®—æ³•ç”Ÿæˆidï¼Œjså¤„ç†è¿‡ç¨‹ä¸­ç²¾åº¦æŸå¤±_è§£å†³å®˜æ–¹é›ªèŠ±ç®—æ³•é•¿åº¦è¿‡é•¿å¯¼è‡´jsç²¾åº¦ä¸¢å¤±é—®é¢˜-CSDNåšå®¢</a><a href="https://blog.csdn.net/L___K__/article/details/132535554?ops_request_misc=%7B%22request_id%22:%22170687047716800180663150%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=170687047716800180663150&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-132535554-null-null.142%5Ev99%5Epc_search_result_base1&utm_term=%E6%9E%9A%E4%B8%BE%E7%B1%BB%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%8E%E5%8F%8D%E5%BA%8F%E5%88%97&spm=1018.2226.3001.4187">Jacksonåºåˆ—åŒ–å’Œååºåˆ—åŒ–æšä¸¾ç±»å‹_jackson æšä¸¾ ååºåˆ—åŒ–-CSDNåšå®¢</a>[ä¸€æ–‡ææ‡‚Mybatis Plusé€šç”¨æšä¸¾åŠŸèƒ½ä½¿ç”¨_mybatisplus æšä¸¾-CSDNåšå®¢](<a href="https://blog.csdn.net/qq_37132495/article/details/121433185?ops_request_misc=&request_id=&biz_id=102&utm_term=mybatisplus">https://blog.csdn.net/qq_37132495/article/details/121433185?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=mybatisplus</a> æšä¸¾&amp;utm_medium&#x3D;distribute.pc_search_result.none-task-blog-2<del>all</del>sobaiduweb<del>default-5-121433185.142^v99^pc_search_result_base1&amp;spm&#x3D;1018.2226.3001.4187)[springmvc&#x2F;springboot åºåˆ—åŒ–æšä¸¾ç±»&#x2F;æšä¸¾è½¬jsonã€è½¬jsonå¿½ç•¥å­—æ®µã€fastjon&#x2F;jacksonæŒ‡å®šå­—æ®µåç§°&#x2F;è‡ªå®šä¹‰å­—æ®µåç§°_æšä¸¾ç±»è½¬json-CSDNåšå®¢](<a href="https://blog.csdn.net/wangjun5159/article/details/122012182?ops_request_misc=%7B%22request_id%22:%22170687120016800180636269%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=170687120016800180636269&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2">https://blog.csdn.net/wangjun5159/article/details/122012182?ops_request_misc=%7B%22request%5Fid%22%3A%22170687120016800180636269%22%2C%22scm%22%3A%2220140713.130102334..%22%7D&amp;request_id=170687120016800180636269&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2</a></del>all<del>sobaiduend</del>default-1-122012182-null-null.142^v99^pc_search_result_base1&amp;utm_term&#x3D;fastjsonåºåˆ—åŒ–æšä¸¾&amp;spm&#x3D;1018.2226.3001.4187)<a href="https://blog.csdn.net/fzlhz/article/details/130488405">SpringBoot é‡‡ç”¨JsonSerializerå’ŒAop å®ç°å¯æ§åˆ¶çš„æ•°æ®è„±æ•-CSDNåšå®¢</a><a href="https://blog.csdn.net/weixin_41347419/article/details/132811499?ops_request_misc=%7B%22request_id%22:%22171034484416800226538701%22,%22scm%22:%2220140713.130102334.pc_all.%22%7D&request_id=171034484416800226538701&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-7-132811499-null-null.142%5Ev99%5Epc_search_result_base1&utm_term=%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3+JsonSerializer&spm=1018.2226.3001.4187">Jackson è‡ªå®šä¹‰æ³¨è§£æ‰©å±•å®æˆ˜-CSDNåšå®¢</a><a href="https://blog.csdn.net/weixin_43888891/article/details/130438841">Mybatisè¯»å–å’Œå­˜å‚¨jsonç±»å‹çš„æ•°æ®_mybatis json-CSDNåšå®¢</a><a href="https://blog.csdn.net/weixin_42633131/article/details/82873731?ops_request_misc=%7B%22request_id%22:%22171204787016800182169692%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=171204787016800182169692&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-82873731-null-null.142%5Ev100%5Epc_search_result_base1&utm_term=lucene&spm=1018.2226.3001.4187">Luceneä»‹ç»ä¸ä½¿ç”¨-CSDNåšå®¢</a><a href="https://blog.csdn.net/m0_37694106/article/details/103997854?ops_request_misc=%7B%22request_id%22:%22171206307016800192263070%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=171206307016800192263070&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-2-103997854-null-null.142%5Ev100%5Epc_search_result_base1&utm_term=lucene%E5%AE%9E%E6%88%98&spm=1018.2226.3001.4187">Luceneå…¥é—¨+å®æˆ˜_luceneå®æˆ˜-CSDNåšå®¢</a>[æœ€è¯¦ç»†çš„Luceneå®ç°å…¨æ–‡æ£€ç´¢_luceneå…¨æ–‡æ£€ç´¢çš„å®ç°-CSDNåšå®¢](<a href="https://blog.csdn.net/wxc1207/article/details/104968781#2">https://blog.csdn.net/wxc1207/article/details/104968781#2</a>. Luceneä»‹ç»)<a href="https://github.com/houbb/sensitive-word?tab=readme-ov-file">houbb&#x2F;sensitive-word: ğŸ‘®â€â™‚ï¸The sensitive word tool for java.(æ•æ„Ÿè¯&#x2F;è¿ç¦è¯&#x2F;è¿æ³•è¯&#x2F;è„è¯ã€‚åŸºäº DFA ç®—æ³•å®ç°çš„é«˜æ€§èƒ½ java æ•æ„Ÿè¯è¿‡æ»¤å·¥å…·æ¡†æ¶ã€‚è¯·å‹¿å‘å¸ƒæ¶‰åŠæ”¿æ²»ã€å¹¿å‘Šã€è¥é”€ã€ç¿»å¢™ã€è¿åå›½å®¶æ³•å¾‹æ³•è§„ç­‰å†…å®¹ã€‚é«˜æ€§èƒ½æ•æ„Ÿè¯æ£€æµ‹è¿‡æ»¤ç»„ä»¶ï¼Œé™„å¸¦ç¹ä½“ç®€ä½“äº’æ¢ï¼Œæ”¯æŒå…¨è§’åŠè§’äº’æ¢ï¼Œæ±‰å­—è½¬æ‹¼éŸ³ï¼Œæ¨¡ç³Šæœç´¢ç­‰åŠŸèƒ½ã€‚)</a><a href="https://blog.csdn.net/Ares___/article/details/122102581?ops_request_misc=%7B%22request_id%22:%22170956614116800188551806%22,%22scm%22:%2220140713.130102334.pc_all.%22%7D&request_id=170956614116800188551806&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-14-122102581-null-null.142%5Ev99%5Epc_search_result_base1&utm_term=vo%E5%8C%85,dto%E5%8C%85%E8%BF%98%E6%9C%89entity%E5%8C%85%E5%BA%94%E8%AF%A5%E5%88%86%E5%88%AB%E6%94%BE%E5%9C%A8%E4%BB%80%E4%B9%88%E4%BD%8D%E7%BD%AE%E5%90%88%E9%80%82&spm=1018.2226.3001.4187">å¿«é€Ÿç†è§£ POJOï¼ŒVOï¼ŒDOï¼ŒDTOï¼ŒEntity_pojoä¸­çš„voåŒ…-CSDNåšå®¢</a><a href="https://blog.csdn.net/qq_42146402/article/details/127133435">ã€Javaå…¨æ ˆå­¦ä¹ è·¯çº¿ã€‘æœ€å…¨çš„Javaå­¦ä¹ è·¯çº¿åŠçŸ¥è¯†æ¸…å•ï¼ŒJavaè‡ªå­¦æ–¹å‘æŒ‡å¼•_csdnjavaè·¯çº¿-CSDNåšå®¢</a>JavaSEswing&amp;&amp;awt<a href="https://blog.csdn.net/weixin_41571493/article/details/81415327">JavaFXæç®€å…¥é—¨ï¼ˆåˆ©ç”¨FXMLæ–‡ä»¶ï¼‰åˆ°ç²¾é€š-CSDNåšå®¢</a><a href="https://blog.csdn.net/weixin_42436686/article/details/114007170">swing uiä¸»é¢˜_ä»¿IntelliJ Darculaçš„Swingä¸»é¢˜FlatLafä½¿ç”¨æ–¹æ³•-CSDNåšå®¢</a><a href="https://blog.csdn.net/Rwenkai/article/details/103750099">Graphicsç±»ä½¿ç”¨çš„è§£é‡Šä¸æ€è€ƒ_getgraphics()-CSDNåšå®¢</a><a href="https://blog.csdn.net/weixin_44893902/article/details/107021644">ä½¿ç”¨ Eclipse å¯è§†åŒ–æ’ä»¶ windowbuilder è¿›è¡ŒJava GUIå¼€å‘ï¼ˆæ’ä»¶å®‰è£…çš„ä¸¤ç§æ–¹æ³•ï¼‰_eclipse jframeæ’ä»¶-CSDNåšå®¢</a><a href="https://blog.csdn.net/dkbnull/article/details/48368913">Eclipseå¼€å‘ç¯å¢ƒä¸‹Javaå¯è§†åŒ–ç•Œé¢ç¼–ç¨‹-CSDNåšå®¢</a><a href="https://blog.csdn.net/xietansheng/article/details/72814492">Java Swing å›¾å½¢ç•Œé¢å¼€å‘ï¼ˆç›®å½•ï¼‰_swing ç›®å½•é¡µæ•ˆæœ-CSDNåšå®¢</a><a href="https://blog.csdn.net/weixin_43901038/article/details/105527424">javaâ€“å›¾å½¢ç»˜ç»˜åˆ¶_java ç»˜åˆ¶å½©å›¾å’Œçº¿å›¾-CSDNåšå®¢</a><a href="https://blog.csdn.net/weixin_51201930/article/details/122618959">Java Swingç•Œé¢è®¾è®¡UIï¼ˆå…¨ï¼‰_swing ui-CSDNåšå®¢</a><a href="https://blog.csdn.net/myweishanli/article/details/39005139">ç®€è¿° Java å›¾å½¢ç”¨æˆ·ç•Œé¢è®¾è®¡ (Swing)_(1)ç®€è¿°javaä¸­å›¾å½¢ç•Œé¢è®¾è®¡è¿‡ç¨‹-CSDNåšå®¢</a>JDBC<a href="https://blog.csdn.net/weixin_45195665/article/details/108627965">JDBCä»å…¥é—¨åˆ°ç†Ÿç»ƒä½¿ç”¨â€”â€”åŠŸèƒ½ç±»è¯¦è§£ã€å¢åˆ æ”¹æŸ¥(CRUD)ã€sqlæ³¨å…¥ã€äº‹åŠ¡ã€è¿æ¥æ± -CSDNåšå®¢</a><a href="https://blog.csdn.net/qq_44890539/article/details/106102018">æ•°æ®åº“è¿æ¥æ± ï¼ˆå¸¸ç”¨çš„å¾·é²ä¼Šï¼‰_è¿æ¥æ± çš„æµæ˜¯ä¸å…³é—­çš„å—-CSDNåšå®¢</a>åå°„<a href="https://blog.csdn.net/sinat_38259539/article/details/71799078">JavaåŸºç¡€ä¹‹â€”åå°„ï¼ˆéå¸¸é‡è¦ï¼‰-CSDNåšå®¢</a>IOæµ<a href="https://blog.csdn.net/mu_wind/article/details/108674284">ã€JavaåŸºç¡€-3ã€‘åƒé€Java IOï¼šå­—èŠ‚æµã€å­—ç¬¦æµã€ç¼“å†²æµ_ç¼“å†²æµæ˜¯å­—èŠ‚æµå—-CSDNåšå®¢</a><a href="https://blog.csdn.net/qq_44543508/article/details/102831084">å²ä¸Šæœ€éªšæœ€å…¨æœ€è¯¦ç»†çš„IOæµæ•™ç¨‹ï¼Œå°ç™½éƒ½èƒ½çœ‹æ‡‚ï¼_start_input_stream-CSDNåšå®¢</a><a href="https://blog.csdn.net/guorui_java/article/details/120643691">Javaå­¦ä¹ è·¯çº¿æ€»ç»“ï¼ˆæ€ç»´å¯¼å›¾ç¯‡ï¼‰-CSDNåšå®¢</a><a href="https://blog.csdn.net/keep12moving/article/details/92666633">ä»€ä¹ˆæ˜¯javabeanåŠå…¶ç”¨æ³•-CSDNåšå®¢</a><a href="https://blog.csdn.net/William0318/article/details/102775217">å²ä¸Šæœ€å…¨æ­£åˆ™è¡¨è¾¾å¼è¯­æ³•ï¼Œæ–‡æœ«é™„å¸¸ç”¨è¡¨è¾¾å¼ï¼_æ­£åˆ™è¡¨è¾¾å¼ è¯­æ³•-CSDNåšå®¢</a><a href="https://xiaoqijava.blog.csdn.net/article/details/125382015">Javaå­¦ä¹ è·¯çº¿å›¾-CSDNåšå®¢</a><a href="https://blog.csdn.net/m0_37989980/article/details/123391450">Javaå¸¸ç”¨å·¥å…·ç±» : StringUtilsã€CollectionUtilsã€ArrayUtilsã€Listsã€Mapsç­‰_collectionutils map-CSDNåšå®¢</a><a href="https://blog.csdn.net/weixin_54963748/article/details/122792274">Javaè·å–å›¾ç‰‡çš„RGBå€¼ï¼ˆæ•°å­—å›¾åƒå¤„ç†ï¼‰_javaç”Ÿæˆrgbå›¾ç‰‡-CSDNåšå®¢</a><a href="https://blog.csdn.net/weixin_44427181/article/details/124868953">æ¯•ä¸šè®¾è®¡ä¸è¦å†åš XX ç®¡ç†ç³»ç»Ÿäº†_xxç®¡ç†ç³»ç»Ÿ-CSDNåšå®¢</a><a href="https://blog.csdn.net/weixin_44556968/article/details/106568259">Eclipse ä»å®‰è£…ã€é…ç½®ã€ä½¿ç”¨ã€åˆ°å¸¸è§é—®é¢˜ä»¥åŠå¸¸ç”¨å¿«æ·é”®_eclipseå®‰è£…æ—¶å‡ºç°çš„æ¯ä¸€ä¸ªé€‰é¡¹æ˜¯ä»€ä¹ˆ-CSDNåšå®¢</a>[Javaä»å…¥é—¨åˆ°ç†Ÿæ‚‰çš„48é“ç»ƒä¹ é¢˜<a href="https://blog.csdn.net/m0_47224070/article/details/107349992">å®Œç»“]_javaç»ƒä¹ é¢˜-CSDNåšå®¢</a><a href="https://blog.csdn.net/m0_47224070/article/details/106289745">æœ€å®ç”¨eclipseå¸¸ç”¨å¿«æ·é”®_eclipseå¿«é€Ÿè‡³äºæœ«å°¾-CSDNåšå®¢</a>é—²è°ˆ<a href="https://blog.csdn.net/qq_28168421/article/details/108633288">Githubæ ‡æ˜Ÿè¶…200Kï¼Œè¿™10ä¸ªæµè¡Œçš„å¯è§†åŒ–é¢æ¿ä½ çŸ¥é“å‡ ä¸ª-CSDNåšå®¢</a>çˆ¬è™«<a href="https://blog.csdn.net/GodTao111/article/details/125260189">javaçˆ¬è™«æŠ€æœ¯ä¹‹Seleniumçˆ¬è™«_java selenium çˆ¬è™«-CSDNåšå®¢</a><a href="https://blog.csdn.net/weixin_43582101/article/details/125905855">sgã€xbåˆ†æ_æŠ–éŸ³webmssdk.es5.js-CSDNåšå®¢</a><a href="https://blog.csdn.net/u012756235/article/details/123590369">Seleniumå…¥é—¨ç”¨æ³•è¯¦è§£ã€Javaçˆ¬è™«ã€‘_selenium-java-CSDNåšå®¢</a><a href="https://my.oschina.net/flashsword/blog/147334">ä½¿ç”¨Seleniumæ¥æŠ“å–åŠ¨æ€åŠ è½½çš„é¡µé¢ - é»„äº¿åçš„ä¸ªäººç©ºé—´ - OSCHINA - ä¸­æ–‡å¼€æºæŠ€æœ¯äº¤æµç¤¾åŒº</a><a href="https://developer.microsoft.com/en-us/microsoft-edge/tools/webdriver/?form=MA13LH">Microsoft Edge WebDriver | Microsoft Edge Developer æµè§ˆå™¨é©±åŠ¨</a><a href="https://blog.csdn.net/CYK_byte/article/details/128991985?ops_request_misc=%7B%22request_id%22:%22170978705316800225546993%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=170978705316800225546993&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-2-128991985-null-null.142%5Ev99%5Epc_search_result_base1&utm_term=Seleniumapi&spm=1018.2226.3001.4187">Seleniumå¸¸ç”¨APIè¯¦è§£ï¼Œä»å…¥é—¨åˆ°è¿›é˜¶ï¼ˆå…¨å¥—ï¼‰_selenium api-CSDNåšå®¢</a><a href="https://www.wetools.com/js-compress">JavaScript ä»£ç å‹ç¼©å·¥å…· - åœ¨çº¿å·¥å…·-wetools.comå¾®å·¥å…·</a><a href="https://www.wetools.com/">åœ¨çº¿å·¥å…·å¤§å…¨ | JSåŠ è§£å¯† | Base64åŠ è§£å¯† | JSONæ ¼å¼åŒ–-wetoolså¾®å·¥å…· - åœ¨çº¿å·¥å…·-wetools.comå¾®å·¥å…·</a>æ•°æ®ç»“æ„<a href="https://blog.csdn.net/weixin_45682058/article/details/121326496">äºŒå‰æ ‘ï¼šååºéå†éé€’å½’ç®—æ³•_äºŒå‰æ ‘ååºéå†éé€’å½’-CSDNåšå®¢</a><a href="https://blog.csdn.net/jc_hook/article/details/113267537">æ±‚å­é›†(é€’å½’è§£æ³•ï¼‰_é€’å½’æ±‚å­é›†-CSDNåšå®¢</a>Linux<a href="https://blog.csdn.net/qiaoyurensheng/article/details/127872664">windows to go å’Œ linux to go åˆ¶ä½œæ•™ç¨‹-CSDNåšå®¢</a><a href="https://blog.csdn.net/qq_51714354/article/details/116357105">arch linuxå®‰è£…å’Œdwmçª—å£ç®¡ç†å™¨å®‰è£…_linux dwm-CSDNåšå®¢</a><a href="https://blog.csdn.net/nineya_com/article/details/128244009">Ubuntu 22.04 æ¡Œé¢ç¾åŒ–ä¹‹Mac Big Suré£æ ¼_ubuntuç¾åŒ–mac-CSDNåšå®¢</a><a href="https://blog.csdn.net/oschina_40530576/article/details/108825394">ubuntu18.04 + windows10åŒç³»ç»Ÿä½¿ç”¨rEFIndå¼•å¯¼(å®‰è£…rEFInd-minimalä¸»é¢˜)_refindä¸»é¢˜-CSDNåšå®¢</a><a href="https://blog.csdn.net/XM_89/article/details/120403647">ã€è™šæ‹Ÿæœºã€‘Arch Linux å®‰è£…æ•™ç¨‹(UEFI+GPT)_è™šæ‹Ÿæœºviratualboxå®‰è£…archlinuxæ•™ç¨‹-CSDNåšå®¢</a><a href="https://blog.csdn.net/Linuxprobe18/article/details/127161096">åœ¨ Arch Linux å’Œå…¶ä»–å‘è¡Œç‰ˆä¸­ä½¿ç”¨ç»ˆç«¯è¿æ¥åˆ° WiFi_archlinuxå¦‚ä½•è¿æ¥wifi-CSDNåšå®¢</a><a href="https://blog.csdn.net/weixin_39517241/article/details/116944600">linuxåŒç³»ç»Ÿ å¼•å¯¼ä¿®å¤,Linuxä¸windowsåŒç³»ç»ŸGRUBå¼•å¯¼ä¿®å¤-CSDNåšå®¢</a><a href="https://blog.csdn.net/tkzky001/article/details/109110092">dpkgå’Œapt_é“¶æ²³éº’éºŸä¸­dpkgæ‰¾ä¸åˆ°å‘½ä»¤-CSDNåšå®¢</a><a href="https://cunyu1943.blog.csdn.net/article/details/106248806">ç©è½¬ Manjoraï¼ŒåŸæ¥å¤§ç¥éƒ½æ˜¯è¿™ä¹ˆç”¨ Linuxï¼_manjora linuxç®€ä»‹-CSDNåšå®¢</a><a href="https://lpwmm.blog.csdn.net/article/details/119056455">åœ¨å·²å®‰è£…Ventoyçš„ç§»åŠ¨è®¾å¤‡ä¸Šå®‰è£…Linuxä¸é…ç½®å¼•å¯¼_ventoy linux å®‰è£…-CSDNåšå®¢</a>è§£å†³Bug[No converter for <a href="https://blog.csdn.net/qq_51401283/article/details/126184469">class com.duan.domain.User] with preset Content-Type â€˜nullâ€˜-CSDNåšå®¢</a><a href="https://blog.csdn.net/qq_52889967/article/details/113393225">ä½¿ç”¨exe4jå°†javaç¨‹åºæ‰“åŒ…æˆå¯æ‰§è¡Œæ–‡ä»¶(.exe)ä¸”å¯ä»¥åœ¨æ²¡æœ‰JDKå’Œjreçš„ç”µè„‘ä¸­è¿è¡Œ_exe4j ç®¡ç†å‘˜-CSDNåšå®¢</a><a href="https://blog.csdn.net/qq_42701414/article/details/104810570">IDEA ç‚¹å‡»å³ä¸Šæµè§ˆå™¨è®¿é—®æ—¶ç›´æ¥è®¿é—®jspæºæ–‡ä»¶IDEA ç‚¹å‡»å³ä¸Šæµè§ˆå™¨è®¿é—®æ—¶ç›´æ¥è®¿é—®jspæºæ–‡ä»¶_ideaç‚¹å‡»åç›´æ¥æ˜¾ç¤ºjspæ–‡ä»¶-CSDNåšå®¢</a><a href="https://justdoit.blog.csdn.net/article/details/89290195">æ•´ç†ä¸€äº›å®Œå…¨å…è´¹å¼€æ”¾çš„APIæ¥å£_å¼€æ”¾æ€§api-CSDNåšå®¢</a><a href="https://blog.csdn.net/qq_35999017/article/details/123922952">seleniumå¯åŠ¨è°·æ­Œæµè§ˆå™¨çš„å‚æ•°è®¾ç½®_enable-automation-CSDNåšå®¢</a><a href="https://blog.csdn.net/qq_55069056/article/details/118105044">Tomcat 10ä¸­Servletæ— æ³•æ­£å¸¸ä½¿ç”¨çš„è§£å†³åŠæ³•_tomcat 10 ser-CSDNåšå®¢</a><a href="https://blog.csdn.net/qq_42898112/article/details/125687691">è§£å†³jspé‡Œé¢å†™javaä»£ç  HTTP çŠ¶æ€ 500 - æ— æ³•ä¸º JSP ç¼–è¯‘ç±» System.out cannot be resolved to a type_æ— æ³•ä¸ºjspç¼–è¯‘ç±»-CSDNåšå®¢</a>[openJDK17å®˜æ–¹é•œåƒæŠ¥Error loading shared library libfreetype.so_openjdk17dockeré•œåƒ-CSDNåšå®¢](<a href="https://blog.csdn.net/shengfakun1234/article/details/136565950?ops_request_misc=&request_id=&biz_id=102&utm_term=Error">https://blog.csdn.net/shengfakun1234/article/details/136565950?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=Error</a> loading shared library l&amp;utm_medium&#x3D;distribute.pc_search_result.none-task-blog-2<del>all</del>sobaiduweb<del>default-0-136565950.142^v100^pc_search_result_base1&amp;spm&#x3D;1018.2226.3001.4187)Cè¯­è¨€<a href="https://blog.csdn.net/m0_63312733/article/details/122145605">Cè¯­è¨€åˆé˜¶â€”â€”æ‰‹æŠŠæ‰‹æ•™é›¶åŸºç¡€&#x2F;æ–°æ‰‹å…¥é—¨ï¼ˆä¸‡å­—å¿ƒå¾—ç¬”è®°ï¼‰_cè¯­è¨€å…¥é—¨è‡ªå­¦é›¶åŸºç¡€-CSDNåšå®¢</a>Python<a href="https://blog.csdn.net/qq_34160248/article/details/128509402">æ•´ç†äº†ä¸Šåƒä¸ª Python å·¥å…·åº“ï¼Œæ¶µç›–24ä¸ªå¤§æ–¹å‘-CSDNåšå®¢</a><a href="https://blog.csdn.net/weixin_47163937/article/details/115818021">ã€å»ºè®®æ”¶è—ã€‘ä¸‰æœˆä»½å¼€å§‹ï¼ŒäºŒåäºŒä¸ªçˆ¬è™«é¡¹ç›®ï¼Œæ— å¥—è·¯ï¼Œé™„ä¸Šæºç  å…¨éƒ¨æ‹¿èµ°_3æœˆçˆ¬è™«-CSDNåšå®¢</a><a href="https://blog.csdn.net/newlw/article/details/125231235">åŸºäºPythonçš„æ ¡å›­å­¦ç”Ÿä¸€å¡é€šç®¡ç†ç³»ç»Ÿ_ttps:&#x2F;&#x2F;download.csdn.net&#x2F;download&#x2F;sheziqiong&#x2F;85609-CSDNåšå®¢</a>IDEA[ä½¿ç”¨ Idea çš„ Diagram åŠŸèƒ½æŸ¥çœ‹ UML ç±»å›¾_idea æ˜¾ç¤ºç±»å›¾-CSDNåšå®¢](<a href="https://blog.csdn.net/ttzommed/article/details/114905865?ops_request_misc=%7B%22request_id%22:%22170254113316800211539733%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=170254113316800211539733&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2">https://blog.csdn.net/ttzommed/article/details/114905865?ops_request_misc=%7B%22request%5Fid%22%3A%22170254113316800211539733%22%2C%22scm%22%3A%2220140713.130102334..%22%7D&amp;request_id=170254113316800211539733&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2</a></del>all<del>sobaiduend</del>default-1-114905865-null-null.142^v96^pc_search_result_base8&amp;utm_term&#x3D;IDEAæ€ä¹ˆæ‰“å¼€ç±»å›¾&amp;spm&#x3D;1018.2226.3001.4187)å‰ç«¯<a href="https://blog.csdn.net/lunahaijiao/article/details/123625379?ops_request_misc=%7B%22request_id%22:%22170279255416800182770520%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=170279255416800182770520&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-123625379-null-null.142%5Ev96%5Epc_search_result_base8&utm_term=TS%E6%95%99%E7%A8%8B&spm=1018.2226.3001.4187">ã€Œ1.9Wå­—æ€»ç»“ã€ä¸€ä»½é€šä¿—æ˜“æ‡‚çš„ TS æ•™ç¨‹ï¼Œå…¥é—¨ + å®æˆ˜ï¼-CSDNåšå®¢</a><a href="https://blog.csdn.net/weixin_47511959/article/details/118152956">CSSâ€”â€”CSSåŸºç¡€ï¼ˆä¸€ç¯‡å°±å¤Ÿç”¨ï¼‰_cssä¸€ç¯‡-CSDNåšå®¢</a><a href="https://blog.csdn.net/weixin_47511959/article/details/118178073">CSS3æ€»ç»“ï¼ˆæ ¸å¿ƒï¼‰_css3 æ€»ç»“-CSDNåšå®¢</a><a href="https://blog.csdn.net/qq_56973906/article/details/126774381?ops_request_misc=%7B%22request_id%22:%22170279174016800180639697%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=170279174016800180639697&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-126774381-null-null.142%5Ev96%5Epc_search_result_base8&utm_term=vue%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5&spm=1018.2226.3001.4187">Vue-ä¾èµ–æ³¨å…¥ï¼ˆprovide-injectï¼‰_vue inject-CSDNåšå®¢</a><a href="https://blog.csdn.net/weixin_47124112/article/details/126730114?ops_request_misc=%7B%22request_id%22:%22170279146716800188596694%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=170279146716800188596694&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_click~default-2-126730114-null-null.142%5Ev96%5Epc_search_result_base8&utm_term=vue-router&spm=1018.2226.3001.4187">vue-router è·¯ç”±è¶…è¯¦ç»†æ•™ç¨‹_vue router-CSDNåšå®¢</a>[Vueä¸­watchçš„è¯¦è§£_vue watch-CSDNåšå®¢](<a href="https://blog.csdn.net/weixin_45112114/article/details/125672584?ops_request_misc=%7B%22request_id%22:%22170279200516777224418911%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=170279200516777224418911&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-125672584-null-null.142%5Ev96%5Epc_search_result_base8&utm_term=vue">https://blog.csdn.net/weixin_45112114/article/details/125672584?ops_request_misc=%7B%22request%5Fid%22%3A%22170279200516777224418911%22%2C%22scm%22%3A%2220140713.130102334..%22%7D&amp;request_id=170279200516777224418911&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-125672584-null-null.142^v96^pc_search_result_base8&amp;utm_term=vue</a> watch&amp;spm&#x3D;1018.2226.3001.4187)<a href="https://blog.csdn.net/yifei1234567/article/details/123801171">äºŒã€ã€Vue3ã€‘â€”â€”refå’Œreactiveçš„ä½¿ç”¨ã€åŒºåˆ«_vue3refå’ŒreactiveåŒºåˆ«-CSDNåšå®¢</a><a href="https://blog.csdn.net/yifei1234567/article/details/123975970">å…­ã€ã€Vue3ã€‘â€”â€”Vue3ç”Ÿå‘½å‘¨æœŸæœ‰å“ªäº›ä¸åŒ_vue3ç”Ÿå‘½å‘¨æœŸçš„å˜åŒ–-CSDNåšå®¢</a><a href="https://blog.csdn.net/yifei1234567/article/details/123992972?ops_request_misc=%7B%22request_id%22:%22170279213616800215079099%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=170279213616800215079099&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-123992972-null-null.142%5Ev96%5Epc_search_result_base8&utm_term=vue%E7%BB%84%E5%90%88%E5%BC%8Fapi%E6%95%99%E7%A8%8B&spm=1018.2226.3001.4187">å…«ã€ã€Vue3ã€‘â€”â€”ç»„åˆå¼APIï¼ˆComposition APIï¼‰_ç»„åˆå¼apiçš„åŠŸèƒ½ä»£ç ä¸€èˆ¬éƒ½æ”¾åœ¨ä»€ä¹ˆä½ç½®-CSDNåšå®¢</a>[Vue Router è·¯ç”±ï¼ˆè·¯ç”±å®ˆå«ï¼‰â€”route_6. vue-router å®ˆå«?-CSDNåšå®¢](<a href="https://blog.csdn.net/yiyueqinghui/article/details/107291509?ops_request_misc=&request_id=&biz_id=102&utm_term=vue-router">https://blog.csdn.net/yiyueqinghui/article/details/107291509?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=vue-router</a> è·¯ç”±å®ˆå«&amp;utm_medium&#x3D;distribute.pc_search_result.none-task-blog-2<del>all</del>sobaiduweb<del>default-1-107291509.142^v96^pc_search_result_base8&amp;spm&#x3D;1018.2226.3001.4187)[vueè·¯ç”±åˆ‡æ¢ä¹‹æ·¡å…¥æ·¡å‡º_elmentplusé¡µé¢åˆ‡æ¢è¿‡åº¦æ•ˆæœ-CSDNåšå®¢](<a href="https://blog.csdn.net/qq_39197547/article/details/81911396?ops_request_misc=%7B%22request_id%22:%22170326018716800213081146%22,%22scm%22:%2220140713.130102334.pc_all.%22%7D&request_id=170326018716800213081146&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2">https://blog.csdn.net/qq_39197547/article/details/81911396?ops_request_misc=%7B%22request%5Fid%22%3A%22170326018716800213081146%22%2C%22scm%22%3A%2220140713.130102334.pc%5Fall.%22%7D&amp;request_id=170326018716800213081146&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2</a></del>all<del>first_rank_ecpm_v1</del>rank_v31_ecpm-3-81911396-null-null.142^v96^pc_search_result_base8&amp;utm_term&#x3D;elementplus è·¯ç”±è¿‡æ¸¡&amp;spm&#x3D;1018.2226.3001.4187)<a href="https://vue3js.cn/">Vue one peice</a><a href="http://120.79.202.7/">RuoYi è‹¥ä¾å®˜æ–¹ç½‘ç«™ |åå°ç®¡ç†ç³»ç»Ÿ|æƒé™ç®¡ç†ç³»ç»Ÿ|å¿«é€Ÿå¼€å‘æ¡†æ¶|ä¼ä¸šç®¡ç†ç³»ç»Ÿ|å¼€æºæ¡†æ¶|å¾®æœåŠ¡æ¡†æ¶|å‰åç«¯åˆ†ç¦»æ¡†æ¶|å¼€æºåå°ç³»ç»Ÿ|RuoYi|RuoYi-Vue|RuoYi-Cloud|RuoYiæ¡†æ¶|RuoYiå¼€æº|RuoYiè§†é¢‘|è‹¥ä¾è§†é¢‘|RuoYiå¼€å‘æ–‡æ¡£|è‹¥ä¾å¼€å‘æ–‡æ¡£|Javaå¼€æºæ¡†æ¶|Java|SpringBoot|SrpingBoot2.0|SrpingCloud|Alibaba|MyBatis|Shiro|OAuth2.0|Thymeleaf|BootStrap|Vue|Element-UI||www.ruoyi.vip</a><a href="https://blog.csdn.net/qinglingLS/article/details/88866438">å…¨æ ˆå·¥ç¨‹å¸ˆå­¦ä¹ è·¯çº¿ï¼ˆè‡ªç”¨ï¼‰_å…¨æ ˆå­¦ä¹ è·¯çº¿-CSDNåšå®¢</a>Vue<a href="https://juejin.cn/post/7228990409909108793">Vue3.3 + Vite+ Element-Plus + TypeScript ä»0åˆ°1æ­å»ºä¼ä¸šçº§åå°ç®¡ç†ç³»ç»Ÿï¼ˆå‰åç«¯å¼€æºï¼‰ - æ˜é‡‘</a><a href="edge://newtab/">oo</a><a href="https://juejin.cn/post/6844903476661583880">æ‰‹æ‘¸æ‰‹ï¼Œå¸¦ä½ ç”¨vueæ’¸åå° ç³»åˆ—ä¸€ï¼ˆåŸºç¡€ç¯‡ï¼‰ - æ˜é‡‘</a><a href="http://localhost:5173/#/home">Vite App</a><a href="http://localhost:8080/hello">hello.html</a><a href="https://blog.csdn.net/lhblmd/article/details/125547525?ops_request_misc=%7B%22request_id%22:%22170862261416800180640925%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=170862261416800180640925&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~baidu_landing_v2~default-4-125547525-null-null.142%5Ev99%5Epc_search_result_base1&utm_term=%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86&spm=1018.2226.3001.4187">çŠ¶æ€ç®¡ç† Pinia-CSDNåšå®¢</a><a href="http://127.0.0.1:8080/#/page/4.html">Home</a><a href="https://blog.csdn.net/weixin_43877799/article/details/121536943">js Promiseä¸async&#x2F;awaitç”¨æ³•è¯¦è§£_js promise away-CSDNåšå®¢</a><a href="https://blog.csdn.net/m0_64892344/article/details/131723052?ops_request_misc=%7B%22request_id%22:%22170869066016777224489020%22,%22scm%22:%2220140713.130102334.pc_all.%22%7D&request_id=170869066016777224489020&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-1-131723052-null-null.142%5Ev99%5Epc_search_result_base1&utm_term=pinina%E6%8C%81%E4%B9%85%E5%8C%96%E6%8F%92%E4%BB%B6&spm=1018.2226.3001.4187">Piniaæ•°æ®æŒä¹…åŒ–æ’ä»¶_piniaçš„æŒä¹…åŒ–æ’ä»¶-CSDNåšå®¢</a><a href="https://blog.csdn.net/weixin_44860226/article/details/127101707?ops_request_misc=%7B%22request_id%22:%22170869532216800213014190%22,%22scm%22:%2220140713.130102334.pc_all.%22%7D&request_id=170869532216800213014190&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-1-127101707-null-null.142%5Ev99%5Epc_search_result_base1&utm_term=npm%E6%8C%89%E7%85%A7%E4%BE%9D%E8%B5%96%E9%80%9F%E5%BA%A6%E6%85%A2&spm=1018.2226.3001.4187">npmä¸åŒ…åŠnpmåŒ…ä¸‹è½½é€Ÿåº¦æ…¢é—®é¢˜çš„è§£å†³_npmä¸‹è½½-CSDNåšå®¢</a><a href="https://blog.csdn.net/G_ing/article/details/128192480?ops_request_misc=%7B%22request_id%22:%22170869639516800227495235%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=170869639516800227495235&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~baidu_landing_v2~default-1-128192480-null-null.142%5Ev99%5Epc_search_result_base1&utm_term=pinina%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8&spm=1018.2226.3001.4187">å¿«é€Ÿææ‡‚PiniaåŠæ•°æ®æŒä¹…åŒ–å­˜å‚¨(è¯¦ç»†æ•™ç¨‹)_piniaæŒä¹…åŒ–-CSDNåšå®¢</a><a href="https://blog.csdn.net/G_ing/article/details/128242848?spm=1001.2014.3001.5502">Piniaå®ç°æ•°æ®æŒä¹…åŒ–å­˜å‚¨_piniaæ•°æ®æŒä¹…å­˜å‚¨-CSDNåšå®¢</a><a href="https://www.douyin.com/user/MS4wLjABAAAAg31Bd6DkzftOlOyPm4k3mJPQXykir-N50cxhZngfbjgKNDkD3D2vlmt5rdxUXgU_?is_search=0&list_name=follow&modal_id=7287424783573093691&nt=0">vue3çš„æŠ–éŸ³ - æŠ–éŸ³ pinia æŒä¹…è¯å­˜å‚¨ æ’ä»¶</a><a href="https://blog.csdn.net/dongzi_yu/article/details/126786022?ops_request_misc=&request_id=&biz_id=102&utm_term=fetch%E5%8F%91%E9%80%81post%E8%A1%A8%E5%8D%95%E5%8F%82%E6%95%B0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-1-126786022.142%5Ev99%5Epc_search_result_base1&spm=1018.2226.3001.4187">js fetchè¯·æ±‚ä½¿ç”¨_js fetch post-CSDNåšå®¢</a><a href="https://blog.csdn.net/qq_59747594/article/details/130303158?ops_request_misc=%7B%22request_id%22:%22170887831016800222880693%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=170887831016800222880693&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_click~default-2-130303158-null-null.142%5Ev99%5Epc_search_result_base1&utm_term=vue%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1%E6%9D%83%E9%99%90%E9%85%8D%E7%BD%AE&spm=1018.2226.3001.4187">Vueå¦‚ä½•å®ç°æƒé™ç®¡ç†ï¼ˆåŠ¨æ€è·¯ç”±addRoutesï¼‰_vueåŠ¨æ€è·¯ç”±å¯¼èˆªèœå•æƒé™ç®¡ç†-CSDNåšå®¢</a>[TSæŠ¥é”™å¤§å…¨_ä¸€ä¸ªæ¨¡å—ä¸èƒ½å…·æœ‰å¤šä¸ªé»˜è®¤å¯¼å‡º-CSDNåšå®¢](<a href="https://blog.csdn.net/sjajjajusja/article/details/126829562?ops_request_misc=%7B%22request_id%22:%22170912246516800215020782%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=170912246516800215020782&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-4-126829562-null-null.142%5Ev99%5Epc_search_result_base1&utm_term=import">https://blog.csdn.net/sjajjajusja/article/details/126829562?ops_request_misc=%7B%22request%5Fid%22%3A%22170912246516800215020782%22%2C%22scm%22%3A%2220140713.130102334..%22%7D&amp;request_id=170912246516800215020782&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-4-126829562-null-null.142^v99^pc_search_result_base1&amp;utm_term=import</a> TS1109%3A Expression expected.&amp;spm&#x3D;1018.2226.3001.4187)<a href="https://pinia.web3doc.top/">Home | Pinia ä¸­æ–‡æ–‡æ¡£</a><a href="https://www.yuque.com/zilvbenxiangziyou/fue6m0/ghe3hre1ya0qum1b">SpringåŸºç¡€ - Springæ ¸å¿ƒä¹‹æ§åˆ¶åè½¬(IOC)</a>Windows<a href="https://blog.csdn.net/weixin_45300266/article/details/122359920?ops_request_misc=%7B%22request_id%22:%22171134436816800222831444%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=171134436816800222831444&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_click~default-1-122359920-null-null.142%5Ev99%5Epc_search_result_base1&utm_term=windows%E6%B3%A8%E5%86%8C%E8%A1%A8&spm=1018.2226.3001.4187">Windows æ³¨å†Œè¡¨(Registry) å­¦ä¹ _windowæ³¨å†Œè¡¨-CSDNåšå®¢</a><a href="https://sxyz.blog/about/">About</a><a href="https://blog.csdn.net/m0_61503020/article/details/125456520?ops_request_misc=%7B%22request_id%22:%22171434564016800225530559%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=171434564016800225530559&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-125456520-null-null.142%5Ev100%5Epc_search_result_base1&utm_term=docker&spm=1018.2226.3001.4187">è¿ç»´</a>è¿ç»´<a href="https://blog.csdn.net/qq_38505969/article/details/114305742?ops_request_misc=&request_id=&biz_id=102&utm_term=docker-compose&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-0-114305742.142%5Ev100%5Epc_search_result_base1&spm=1018.2226.3001.4187">ä½¿ç”¨docker-composeé«˜æ•ˆéƒ¨ç½²å¸¸è§åº”ç”¨_docker compose-CSDNåšå®¢</a><a href="https://blog.csdn.net/kingsoft88123456/article/details/125548280?ops_request_misc=%7B%22request_id%22:%22171715632316800185891258%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=171715632316800185891258&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~baidu_landing_v2~default-1-125548280-null-null.142%5Ev100%5Epc_search_result_base9&utm_term=%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AEwsl&spm=1018.2226.3001.4187">WSLå®‰è£…åŠé…ç½®_é…ç½®wsl-CSDNåšå®¢</a>[ç”¨docker-composeç¼–æ’ELK_elk docker ç¼–æ’-CSDNåšå®¢](<a href="https://blog.csdn.net/liu1430016196/article/details/126406938?ops_request_misc=%7B%22request_id%22:%22171824878116800197011549%22,%22scm%22:%2220140713.130102334.pc_all.%22%7D&request_id=171824878116800197011549&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-2-126406938-null-null.142%5Ev100%5Epc_search_result_base9&utm_term=Kibann">https://blog.csdn.net/liu1430016196/article/details/126406938?ops_request_misc=%7B%22request%5Fid%22%3A%22171824878116800197011549%22%2C%22scm%22%3A%2220140713.130102334.pc%5Fall.%22%7D&amp;request_id=171824878116800197011549&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-2-126406938-null-null.142^v100^pc_search_result_base9&amp;utm_term=Kibann</a> docker &amp;spm&#x3D;1018.2226.3001.4187)<a href="https://blog.csdn.net/bryanwang_3099/article/details/114649881?ops_request_misc=%7B%22request_id%22:%22172011324116800222820027%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=172011324116800222820027&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-114649881-null-null.142%5Ev100%5Epc_search_result_base9&utm_term=%E5%B0%86hexo%E9%83%A8%E7%BD%B2%E5%88%B0gitee&spm=1018.2226.3001.4187">Hexo éƒ¨ç½²åˆ° Gitee_hexoéƒ¨ç½²gitee-CSDNåšå®¢</a>å¼€æºå‰ç«¯æ¡†æ¶<a href="http://admin.layui-vue.com/#/error/404">layui-vue-admin</a><a href="https://gitee.com/lyt-top/vue-next-admin?_from=gitee_search#https://lyt-top.gitee.io/vue-next-admin-preview/#/login">vue-next-admin: ğŸ‰ğŸ‰ğŸ”¥åŸºäºvue3.x ã€Typescriptã€viteã€Element plusç­‰ï¼Œé€‚é…æ‰‹æœºã€å¹³æ¿ã€pc çš„åå°å¼€æºå…è´¹æ¨¡æ¿åº“ï¼ˆvue2.xè¯·åˆ‡æ¢vue-prev-adminåˆ†æ”¯ï¼‰</a><a href="https://gitee.com/pear-admin/Pear-Admin-Layui?_from=gitee_search#https://gitee.com/link?target=http%3A%2F%2Fwww.pearadmin.com%2Fdoc">Pear Admin Layui: ğŸŒˆ Pear Admin æ˜¯ ä¸€ æ¬¾ å¼€ ç®± å³ ç”¨ çš„ å‰ ç«¯ å¼€ å‘ æ¨¡ æ¿</a><a href="https://vue.ruoyi.vip/system/menu">è‹¥ä¾ç®¡ç†ç³»ç»Ÿ</a><a href="https://uiverse.io/elements">4235 UI elements: CSS &amp; Tailwind</a>å¼€æºé¡¹ç›®<a href="https://gitee.com/Doocs/md?_from=gitee_search">md: âœ ä¸€æ¬¾é«˜åº¦ç®€æ´çš„å¾®ä¿¡ Markdown ç¼–è¾‘å™¨ï¼šæ”¯æŒ Markdown æ‰€æœ‰åŸºç¡€è¯­æ³•ã€è‰²ç›˜å–è‰²ã€ä¸€é”®å¤åˆ¶å¹¶ç²˜è´´åˆ°å…¬ä¼—å·åå°ã€å¤šå›¾ä¸Šä¼ ã€ä¸€é”®ä¸‹è½½æ–‡æ¡£ã€è‡ªå®šä¹‰ CSS æ ·å¼ã€ä¸€é”®é‡ç½®ç­‰ç‰¹æ€§</a><a href="https://gitee.com/halo-dev/halo">halo: å¼ºå¤§æ˜“ç”¨çš„å¼€æºå»ºç«™å·¥å…·ã€‚</a><a href="https://gitee.com/y_project/RuoYi-Vue">RuoYi-Vue: ğŸ‰ åŸºäºSpringBootï¼ŒSpring Securityï¼ŒJWTï¼ŒVue &amp; Element çš„å‰åç«¯åˆ†ç¦»æƒé™ç®¡ç†ç³»ç»Ÿï¼ŒåŒæ—¶æä¾›äº† Vue3 çš„ç‰ˆæœ¬</a><a href="https://gitee.com/flashsword20/webmagic?_from=gitee_search">webmagic: webmagic æ˜¯ä¸€ä¸ªæ— é¡»é…ç½®ã€ä¾¿äºäºŒæ¬¡å¼€å‘çš„çˆ¬è™«æ¡†æ¶ï¼Œå®ƒæä¾›ç®€å•çµæ´»çš„APIï¼Œåªéœ€å°‘é‡ä»£ç å³å¯å®ç°ä¸€ä¸ªçˆ¬è™«ã€‚</a><a href="https://github.com/Naccl/NBlog">Naccl&#x2F;NBlog: ğŸ“ Spring Boot + Vue å‰åç«¯åˆ†ç¦»åšå®¢ç³»ç»Ÿ https://naccl.top</a><a href="https://gitee.com/fastdfs100/fastdfs">FastDFS: FastDFSæ˜¯ä¸€æ¬¾è½»é‡çº§çš„å¼€æºåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼ŒåŠŸèƒ½åŒ…æ‹¬ï¼šæ–‡ä»¶å­˜å‚¨ã€æ–‡ä»¶åŒæ­¥ã€æ–‡ä»¶ä¸Šä¼ ã€æ–‡ä»¶ä¸‹è½½ç­‰ï¼Œè§£å†³äº†æ–‡ä»¶å¤§å®¹é‡å­˜å‚¨å’Œé«˜æ€§èƒ½è®¿é—®é—®é¢˜ã€‚ç‰¹åˆ«é€‚åˆä»¥æ–‡ä»¶ä¸ºè½½ä½“çš„åœ¨çº¿æœåŠ¡ï¼Œå¦‚å›¾ç‰‡ã€è§†é¢‘ã€æ–‡æ¡£æœåŠ¡ç­‰ç­‰ã€‚FastDFSç›¸å…³æ–‡ç« è¯·æœç´¢å¾®ä¿¡å…¬ä¼—å·ï¼šfastdfs</a><a href="https://dromara.org/zh/projects/">é¡¹ç›®</a><a href="https://github.com/Meekdai/Gmeek">Meekdai&#x2F;Gmeek: Gmeek is a Blog All in Github</a><a href="https://hexo.io/zh-cn/">Hexo</a><a href="https://hexo.io/plugins/">Plugins | Hexo</a><a href="https://github.com/obgnail/typora_plugin?tab=readme-ov-file">obgnail&#x2F;typora_plugin: Typora plugin. Feature enhancement tool | Typora æ’ä»¶ï¼ŒåŠŸèƒ½å¢å¼ºå·¥å…·</a><a href="http://localhost:4000/post/c83e1014-1e8b-401b-8369-ec9a1a9a42c3/">Hexo ä¸ Typora æœ€ä½³ç»„åˆ - Hexo</a>User<a href="https://homura.live/links/">å‹é“¾ | Homuraâ€™s Blog</a><a href="https://www.bilibili.com/">å“”å“©å“”å“©</a>åƒåœ¾<a href="https://zhuanlan.zhihu.com/p/686846115">è‹±æ–‡ç®€å†æ¨¡æ¿ï¼ˆé€šç”¨10ç¯‡ï¼‰ - çŸ¥ä¹</a><a href="https://ctool.dev/tool.html#/tool/bcrypt?category=encryption">Ctool</a>Local<a href="http://localhost:8080/">8080@localhost</a><a href="http://localhost:5173/">5173@localhost</a><a href="http://192.168.0.104:9999/">1Panel@beelink:9999</a><a href="http://192.168.0.104:9998/#/">CasaOS@beelink:9998</a><a href="http://192.168.0.104:8848/nacos/">Nacos@beelink:8848</a><a href="http://192.168.0.104:9997/">halo@beelink:9997</a><a href="http://192.168.0.104:9001/">MinIO@beelink:9001</a><a href="http://192.168.0.104:8858/#/dashboard">Sentinel Dashboard@beelink:8858</a><a href="http://192.168.0.104:44444/">YesPlayMusic@beelink:44444</a><a href="http://192.168.0.104:40157/#/">æ–‡ä»¶å¿«é€’æŸœ-FileCodeBox@beelink:40157</a><a href="http://192.168.0.104:9600/">RabbitMQ@Beelink:9600</a>AI<a href="https://xinghuo.xfyun.cn/">è®¯é£æ˜Ÿç«è®¤çŸ¥å¤§æ¨¡å‹-AIå¤§è¯­è¨€æ¨¡å‹-æ˜Ÿç«å¤§æ¨¡å‹-ç§‘å¤§è®¯é£</a><a href="https://chat18.aichatos.xyz/#/chat/1708411710252">AIchatOS</a><a href="https://yiyan.baidu.com/">æ–‡å¿ƒä¸€è¨€</a><a href="https://kimi.moonshot.cn/?utm_campaign=TR_wl2nZci6&utm_content=&utm_medium=B%E7%AB%99&utm_source=CH_E9CmoK5c&utm_term=">Kimi.ai - å¸®ä½ çœ‹æ›´å¤§çš„ä¸–ç•Œ</a><a href="https://tongyi.aliyun.com/qianwen?sessionId=a8b5f7a9ac0b4693858ee222207dd7eb">é€šä¹‰</a></li><li><a href="https://www.cnblogs.com/zs0322/p/12289403.html">çº¯æ‰‹å†™ï¼ï¼è½¬ç§»ç³»ç»Ÿç”¨æˆ·èµ„æ–™å’Œæ›´æ”¹AppDataè·¯å¾„çš„æ–¹æ³• ä¸æ¥å—åé©³ï¼ - Java_ZSæ»´æ°´ç©¿çŸ³ - åšå®¢å›­</a></li><li><a href="https://zxmls520.github.io/zxmls/#/">è«è€å¸ˆçš„é™„ä»¶è¡¨</a></li><li><a href="https://blog.csdn.net/GenuineMonster/article/details/83685479">Grub2ä¸»é¢˜ä¿®æ”¹å’Œç¾åŒ–â€”â€”â€“Linux&amp;Windows-CSDNåšå®¢</a></li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>hexoä¸»é¢˜å®‰è£…</title>
    <link href="/post/fgke1014-1e8b-5gjn-8369-ec9a1a9a42c3/"/>
    <url>/post/fgke1014-1e8b-5gjn-8369-ec9a1a9a42c3/</url>
    
    <content type="html"><![CDATA[<p><code>åƒé‡Œä¹‹è¡Œï¼Œå§‹äºè¶³ä¸‹ã€‚</code></p><p><strong>hexo å®‰è£…å‚è€ƒ</strong> <a href="https://hexo.io/zh-cn/docs/index.html">æ–‡æ¡£ | Hexo</a></p><p><strong>hexo ä¸»é¢˜å®‰è£…</strong> <a href="https://hexo.io/themes/">Themes | Hexo</a></p><p>å‰å¾€ä¸»é¢˜ç½‘ç«™ , æœç´¢ä¸»é¢˜ <code>fluid</code> , å¯ä»¥é¢„è§ˆ å’Œå‰å¾€ github å®‰è£…</p><p><img src="image-20240707152913095.png" alt="image-20240707152913095"></p><p>ç›´æ¥å…‹éš†è¿™ä¸ªä¸»é¢˜åˆ°themesç›®å½•ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> git@github.com:fluid-dev/hexo-theme-fluid.git themes/fluid<br></code></pre></td></tr></table></figure><p><img src="image-20240707153426510.png" alt="image-20240707153426510"></p><p>ä¿®æ”¹<code>Hexo/_config</code>ä¸»é¢˜é…ç½®</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">theme:</span> <span class="hljs-string">fluid</span><br></code></pre></td></tr></table></figure><p><img src="image-20240707153713218.png" alt="image-20240707153713218"></p><p>å°† <code>Hexo/themes/fluid/_config</code>.yml é…ç½®æ–‡ä»¶å¤åˆ¶ä¸€ä»½åˆ° hexo æ ¹ç›®å½• å¹¶å‘½åä¸º <code>_config.fluid.yml</code></p><p><img src="image-20240707153550259.png" alt="image-20240707153550259"></p><p>è¿™ä¸ª <code>_config.fluid.yml</code> æ˜¯ç”¨æˆ·å¯¹ä¸»é¢˜çš„é…ç½®, ä¼˜å…ˆçº§é«˜äº é»˜è®¤ä¸»é¢˜ <code>_config</code> </p><p>è¿™ä¸ªä¸»é¢˜é…ç½®ä¸­æœ‰å¾ˆå¤šå¯é…ç½®é¡¹ , è¯·è‡ªè¡Œé…ç½® </p><p>é¢„è§ˆç»“æœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">hexo clean &amp; hexo g &amp; hexo s<br></code></pre></td></tr></table></figure><p><img src="image-20240707154309268.png" alt="image-20240707154309268"></p><p><img src="image-20240707154325052.png" alt="image-20240707154325052"></p><p>æˆ‘çš„é…ç½®å¦‚ä¸‹</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment">#---------------------------</span><br><span class="hljs-comment"># Hexo Theme Fluid</span><br><span class="hljs-comment"># Author: Fluid-dev</span><br><span class="hljs-comment"># Github: https://github.com/fluid-dev/hexo-theme-fluid</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># é…ç½®æŒ‡å—: https://hexo.fluid-dev.com/docs/guide/</span><br><span class="hljs-comment"># ä½ å¯ä»¥ä»æŒ‡å—ä¸­è·å¾—æ›´è¯¦ç»†çš„è¯´æ˜</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Guide: https://hexo.fluid-dev.com/docs/en/guide/</span><br><span class="hljs-comment"># You can get more detailed help from the guide</span><br><span class="hljs-comment">#---------------------------</span><br><br><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-comment"># å…¨å±€</span><br><span class="hljs-comment"># Global</span><br><span class="hljs-comment">#---------------------------</span><br><br><span class="hljs-comment"># ç”¨äºæµè§ˆå™¨æ ‡ç­¾çš„å›¾æ ‡</span><br><span class="hljs-comment"># Icon for browser tab</span><br><span class="hljs-attr">favicon:</span> <span class="hljs-string">/img/fluid.png</span><br><br><span class="hljs-comment"># ç”¨äºè‹¹æœè®¾å¤‡çš„å›¾æ ‡</span><br><span class="hljs-comment"># Icon for Apple touch</span><br><span class="hljs-attr">apple_touch_icon:</span> <span class="hljs-string">/img/fluid.png</span><br><br><span class="hljs-comment"># æµè§ˆå™¨æ ‡ç­¾é¡µä¸­çš„æ ‡é¢˜åˆ†éš”ç¬¦ï¼Œæ•ˆæœï¼š æ–‡ç« å - ç«™ç‚¹å</span><br><span class="hljs-comment"># Title separator in browser tab, eg: article - site</span><br><span class="hljs-attr">tab_title_separator:</span> <span class="hljs-string">&quot; - &quot;</span><br><br><span class="hljs-comment"># å¼ºåˆ¶æ‰€æœ‰é“¾æ¥å‡çº§ä¸º HTTPSï¼ˆé€‚ç”¨äºå›¾ç‰‡ç­‰èµ„æºå‡ºç° HTTP æ··å…¥æŠ¥é”™ï¼‰</span><br><span class="hljs-comment"># Force all links to be HTTPS (applicable to HTTP mixed error)</span><br><span class="hljs-attr">force_https:</span> <span class="hljs-literal">false</span><br><br><span class="hljs-comment"># ä»£ç å—çš„å¢å¼ºé…ç½®</span><br><span class="hljs-comment"># Enhancements to code blocks</span><br><span class="hljs-attr">code:</span><br>  <span class="hljs-comment"># æ˜¯å¦å¼€å¯å¤åˆ¶ä»£ç çš„æŒ‰é’®</span><br>  <span class="hljs-comment"># Enable copy code button</span><br>  <span class="hljs-attr">copy_btn:</span> <span class="hljs-literal">true</span><br><br>  <span class="hljs-comment"># ä»£ç è¯­è¨€</span><br>  <span class="hljs-comment"># Code language</span><br>  <span class="hljs-attr">language:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">default:</span> <span class="hljs-string">&quot;TEXT&quot;</span><br><br>  <span class="hljs-comment"># ä»£ç é«˜äº®</span><br>  <span class="hljs-comment"># Code highlight</span><br>  <span class="hljs-attr">highlight:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br><br>    <span class="hljs-comment"># ä»£ç å—æ˜¯å¦æ˜¾ç¤ºè¡Œå·</span><br>    <span class="hljs-comment"># If true, the code block display line numbers</span><br>    <span class="hljs-attr">line_number:</span> <span class="hljs-literal">true</span><br><br>    <span class="hljs-comment"># å®ç°é«˜äº®çš„åº“ï¼Œå¯¹åº”ä¸‹é¢çš„è®¾ç½®</span><br>    <span class="hljs-comment"># Highlight library</span><br>    <span class="hljs-comment"># Options: highlightjs | prismjs</span><br>    <span class="hljs-attr">lib:</span> <span class="hljs-string">&quot;highlightjs&quot;</span><br><br>    <span class="hljs-attr">highlightjs:</span><br>      <span class="hljs-comment"># åœ¨é“¾æ¥ä¸­æŒ‘é€‰ style å¡«å…¥</span><br>      <span class="hljs-comment"># Select a style in the link</span><br>      <span class="hljs-comment"># See: https://highlightjs.org/static/demo/</span><br>      <span class="hljs-attr">style:</span> <span class="hljs-string">&quot;github gist&quot;</span><br>      <span class="hljs-attr">style_dark:</span> <span class="hljs-string">&quot;dark&quot;</span><br><br>    <span class="hljs-attr">prismjs:</span><br>      <span class="hljs-comment"># åœ¨ä¸‹æ–¹é“¾æ¥é¡µé¢å³ä¾§çš„åœ†å½¢æŒ‰é’®æŒ‘é€‰ style å¡«å…¥ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å¡«å…¥ css é“¾æ¥</span><br>      <span class="hljs-comment"># Select the style button on the right side of the link page, you can also set the CSS link</span><br>      <span class="hljs-comment"># See: https://prismjs.com/</span><br>      <span class="hljs-attr">style:</span> <span class="hljs-string">&quot;default&quot;</span><br>      <span class="hljs-attr">style_dark:</span> <span class="hljs-string">&quot;tomorrow night&quot;</span><br><br>      <span class="hljs-comment"># è®¾ä¸º true é«˜äº®å°†æœ¬åœ°é™æ€ç”Ÿæˆï¼ˆä½†åªæ”¯æŒéƒ¨åˆ† prismjs æ’ä»¶ï¼‰ï¼Œè®¾ä¸º false é«˜äº®å°†åœ¨æµè§ˆå™¨é€šè¿‡ js ç”Ÿæˆ</span><br>      <span class="hljs-comment"># If true, it will be generated locally (but some prismjs plugins are not supported). If false, it will be generated via JS in the browser</span><br>      <span class="hljs-attr">preprocess:</span> <span class="hljs-literal">true</span><br><br><span class="hljs-comment"># ä¸€äº›å¥½ç©çš„åŠŸèƒ½</span><br><span class="hljs-comment"># Some fun features</span><br><span class="hljs-attr">fun_features:</span><br>  <span class="hljs-comment"># ä¸º subtitle æ·»åŠ æ‰“å­—æœºæ•ˆæœ</span><br>  <span class="hljs-comment"># Typing animation for subtitle</span><br>  <span class="hljs-attr">typing:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br><br>    <span class="hljs-comment"># æ‰“å°é€Ÿåº¦ï¼Œæ•°å­—è¶Šå¤§è¶Šæ…¢</span><br>    <span class="hljs-comment"># Typing speed, the larger the number, the slower</span><br>    <span class="hljs-attr">typeSpeed:</span> <span class="hljs-number">70</span><br><br>    <span class="hljs-comment"># æ¸¸æ ‡å­—ç¬¦</span><br>    <span class="hljs-comment"># Cursor character</span><br>    <span class="hljs-attr">cursorChar:</span> <span class="hljs-string">&quot;_&quot;</span><br><br>    <span class="hljs-comment"># æ˜¯å¦å¾ªç¯æ’­æ”¾æ•ˆæœ</span><br>    <span class="hljs-comment"># If true, loop animation</span><br>    <span class="hljs-attr">loop:</span> <span class="hljs-literal">false</span><br><br>    <span class="hljs-comment"># åœ¨æŒ‡å®šé¡µé¢å¼€å¯ï¼Œä¸å¡«åˆ™åœ¨æ‰€æœ‰é¡µé¢å¼€å¯</span><br>    <span class="hljs-comment"># Enable in specified page, all pages by default</span><br>    <span class="hljs-comment"># Options: home | post | tag | category | about | links | page | 404</span><br>    <span class="hljs-attr">scope:</span> []<br><br>  <span class="hljs-comment"># ä¸ºæ–‡ç« å†…å®¹ä¸­çš„æ ‡é¢˜æ·»åŠ é”šå›¾æ ‡</span><br>  <span class="hljs-comment"># Add an anchor icon to the title on the post page</span><br>  <span class="hljs-attr">anchorjs:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">element:</span> <span class="hljs-string">h1,h2,h3,h4,h5,h6</span><br>    <span class="hljs-comment"># Options: left | right</span><br>    <span class="hljs-attr">placement:</span> <span class="hljs-string">left</span><br>    <span class="hljs-comment"># Options: hover | always | touch</span><br>    <span class="hljs-attr">visible:</span> <span class="hljs-string">hover</span><br>    <span class="hljs-comment"># Options: Â§ | # | â¡</span><br>    <span class="hljs-attr">icon:</span> <span class="hljs-string">&quot;&quot;</span><br><br>  <span class="hljs-comment"># åŠ è½½è¿›åº¦æ¡</span><br>  <span class="hljs-comment"># Progress bar when loading</span><br>  <span class="hljs-attr">progressbar:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">height_px:</span> <span class="hljs-number">3</span><br>    <span class="hljs-attr">color:</span> <span class="hljs-string">&quot;#29d&quot;</span><br>    <span class="hljs-comment"># See: https://github.com/rstacruz/nprogress</span><br>    <span class="hljs-attr">options:</span> &#123; <span class="hljs-attr">showSpinner:</span> <span class="hljs-literal">false</span>, <span class="hljs-attr">trickleSpeed:</span> <span class="hljs-number">100</span> &#125;<br><br><span class="hljs-comment"># ä¸»é¢˜æš—è‰²æ¨¡å¼ï¼Œå¼€å¯åèœå•ä¸­ä¼šå‡ºç°åˆ‡æ¢æŒ‰é’®ï¼Œç”¨æˆ·æµè§ˆå™¨ä¼šå­˜å‚¨åˆ‡æ¢é€‰é¡¹ï¼Œå¹¶ä¸”ä¼šéµå¾ª prefers-color-scheme è‡ªåŠ¨åˆ‡æ¢</span><br><span class="hljs-comment"># Theme dark mode. If enable, a switch button will appear on the menu, each of the visitor&#x27;s browser will store his switch option</span><br><span class="hljs-attr">dark_mode:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-comment"># é»˜è®¤çš„é€‰é¡¹ï¼ˆå½“ç”¨æˆ·æ‰‹åŠ¨åˆ‡æ¢ååˆ™ä¸å†æŒ‰ç…§é»˜è®¤æ¨¡å¼ï¼‰ï¼Œé€‰æ‹© `auto` ä¼šä¼˜å…ˆéµå¾ª prefers-color-schemeï¼Œå…¶æ¬¡æŒ‰ç”¨æˆ·æœ¬åœ°æ—¶é—´ 18 ç‚¹åˆ°æ¬¡æ—¥ 6 ç‚¹ä¹‹é—´è¿›å…¥æš—è‰²æ¨¡å¼</span><br>  <span class="hljs-comment"># Default option (when the visitor switches manually, the default mode is no longer followed), choosing `auto` will give priority to prefers-color-scheme, and then enter the dark mode from 18:00 to 6:00 in the visitorâ€™s local time</span><br>  <span class="hljs-comment"># Options: auto | light | dark</span><br>  <span class="hljs-attr">default:</span> <span class="hljs-string">auto</span><br><br><span class="hljs-comment"># ä¸»é¢˜é¢œè‰²é…ç½®ï¼Œå…¶ä»–ä¸ç”Ÿæ•ˆçš„åœ°æ–¹è¯·ä½¿ç”¨è‡ªå®šä¹‰ css è§£å†³ï¼Œé…è‰²å¯ä»¥åœ¨ä¸‹æ–¹é“¾æ¥ä¸­è·å¾—å¯å‘</span><br><span class="hljs-comment"># Theme color, please use custom CSS to solve other colors, color schema can be inspired by the links below</span><br><span class="hljs-comment"># See: https://www.webdesignrankings.com/resources/lolcolors/</span><br><span class="hljs-attr">color:</span><br>  <span class="hljs-comment"># body èƒŒæ™¯è‰²</span><br>  <span class="hljs-comment"># Color of body background</span><br>  <span class="hljs-attr">body_bg_color:</span> <span class="hljs-string">&quot;#eee&quot;</span><br>  <span class="hljs-comment"># æš—è‰²æ¨¡å¼ä¸‹çš„ body èƒŒæ™¯è‰²ï¼Œä¸‹åŒ</span><br>  <span class="hljs-comment"># Color in dark mode, the same below</span><br>  <span class="hljs-attr">body_bg_color_dark:</span> <span class="hljs-string">&quot;#181c27&quot;</span><br><br>  <span class="hljs-comment"># é¡¶éƒ¨èœå•èƒŒæ™¯è‰²</span><br>  <span class="hljs-comment"># Color of navigation bar background</span><br>  <span class="hljs-attr">navbar_bg_color:</span> <span class="hljs-string">&quot;#2f4154&quot;</span><br>  <span class="hljs-attr">navbar_bg_color_dark:</span> <span class="hljs-string">&quot;#1f3144&quot;</span><br><br>  <span class="hljs-comment"># é¡¶éƒ¨èœå•å­—ä½“è‰²</span><br>  <span class="hljs-comment"># Color of navigation bar text</span><br>  <span class="hljs-attr">navbar_text_color:</span> <span class="hljs-string">&quot;#fff&quot;</span><br>  <span class="hljs-attr">navbar_text_color_dark:</span> <span class="hljs-string">&quot;#d0d0d0&quot;</span><br><br>  <span class="hljs-comment"># å‰¯æ ‡é¢˜å­—ä½“è‰²</span><br>  <span class="hljs-comment"># Color of navigation bar text</span><br>  <span class="hljs-attr">subtitle_color:</span> <span class="hljs-string">&quot;#fff&quot;</span><br>  <span class="hljs-attr">subtitle_color_dark:</span> <span class="hljs-string">&quot;#d0d0d0&quot;</span><br><br>  <span class="hljs-comment"># å…¨å±€å­—ä½“è‰²</span><br>  <span class="hljs-comment"># Color of global text</span><br>  <span class="hljs-attr">text_color:</span> <span class="hljs-string">&quot;#3c4858&quot;</span><br>  <span class="hljs-attr">text_color_dark:</span> <span class="hljs-string">&quot;#c4c6c9&quot;</span><br><br>  <span class="hljs-comment"># å…¨å±€æ¬¡çº§å­—ä½“è‰²ï¼ˆæ‘˜è¦ã€ç®€ä»‹ç­‰ä½ç½®ï¼‰</span><br>  <span class="hljs-comment"># Color of global secondary text (excerpt, introduction, etc.)</span><br>  <span class="hljs-attr">sec_text_color:</span> <span class="hljs-string">&quot;#718096&quot;</span><br>  <span class="hljs-attr">sec_text_color_dark:</span> <span class="hljs-string">&quot;#a7a9ad&quot;</span><br><br>  <span class="hljs-comment"># ä¸»é¢æ¿èƒŒæ™¯è‰²</span><br>  <span class="hljs-comment"># Color of main board</span><br>  <span class="hljs-attr">board_color:</span> <span class="hljs-string">&quot;#fff&quot;</span><br>  <span class="hljs-attr">board_color_dark:</span> <span class="hljs-string">&quot;#252d38&quot;</span><br><br>  <span class="hljs-comment"># æ–‡ç« æ­£æ–‡å­—ä½“è‰²</span><br>  <span class="hljs-comment"># Color of post text</span><br>  <span class="hljs-attr">post_text_color:</span> <span class="hljs-string">&quot;#2c3e50&quot;</span><br>  <span class="hljs-attr">post_text_color_dark:</span> <span class="hljs-string">&quot;#c4c6c9&quot;</span><br><br>  <span class="hljs-comment"># æ–‡ç« æ­£æ–‡å­—ä½“è‰²ï¼ˆh1 h2 h3...ï¼‰</span><br>  <span class="hljs-comment"># Color of Article heading (h1 h2 h3...)</span><br>  <span class="hljs-attr">post_heading_color:</span> <span class="hljs-string">&quot;#1a202c&quot;</span><br>  <span class="hljs-attr">post_heading_color_dark:</span> <span class="hljs-string">&quot;#c4c6c9&quot;</span><br><br>  <span class="hljs-comment"># æ–‡ç« è¶…é“¾æ¥å­—ä½“è‰²</span><br>  <span class="hljs-comment"># Color of post link</span><br>  <span class="hljs-attr">post_link_color:</span> <span class="hljs-string">&quot;#0366d6&quot;</span><br>  <span class="hljs-attr">post_link_color_dark:</span> <span class="hljs-string">&quot;#1589e9&quot;</span><br><br>  <span class="hljs-comment"># è¶…é“¾æ¥æ‚¬æµ®æ—¶å­—ä½“è‰²</span><br>  <span class="hljs-comment"># Color of link when hovering</span><br>  <span class="hljs-attr">link_hover_color:</span> <span class="hljs-string">&quot;#30a9de&quot;</span><br>  <span class="hljs-attr">link_hover_color_dark:</span> <span class="hljs-string">&quot;#30a9de&quot;</span><br><br>  <span class="hljs-comment"># è¶…é“¾æ¥æ‚¬æµ®èƒŒæ™¯è‰²</span><br>  <span class="hljs-comment"># Color of link background when hovering</span><br>  <span class="hljs-attr">link_hover_bg_color:</span> <span class="hljs-string">&quot;#f8f9fa&quot;</span><br>  <span class="hljs-attr">link_hover_bg_color_dark:</span> <span class="hljs-string">&quot;#364151&quot;</span><br><br>  <span class="hljs-comment"># åˆ†éš”çº¿å’Œè¡¨æ ¼è¾¹çº¿çš„é¢œè‰²</span><br>  <span class="hljs-comment"># Color of horizontal rule and table border</span><br>  <span class="hljs-attr">line_color:</span> <span class="hljs-string">&quot;#eaecef&quot;</span><br>  <span class="hljs-attr">line_color_dark:</span> <span class="hljs-string">&quot;#435266&quot;</span><br><br>  <span class="hljs-comment"># æ»šåŠ¨æ¡é¢œè‰²</span><br>  <span class="hljs-comment"># Color of scrollbar</span><br>  <span class="hljs-attr">scrollbar_color:</span> <span class="hljs-string">&quot;#c4c6c9&quot;</span><br>  <span class="hljs-attr">scrollbar_color_dark:</span> <span class="hljs-string">&quot;#687582&quot;</span><br>  <span class="hljs-comment"># æ»šåŠ¨æ¡æ‚¬æµ®é¢œè‰²</span><br>  <span class="hljs-comment"># Color of scrollbar when hovering</span><br>  <span class="hljs-attr">scrollbar_hover_color:</span> <span class="hljs-string">&quot;#a6a6a6&quot;</span><br>  <span class="hljs-attr">scrollbar_hover_color_dark:</span> <span class="hljs-string">&quot;#9da8b3&quot;</span><br><br>  <span class="hljs-comment"># æŒ‰é’®èƒŒæ™¯è‰²</span><br>  <span class="hljs-comment"># Color of button</span><br>  <span class="hljs-attr">button_bg_color:</span> <span class="hljs-string">&quot;transparent&quot;</span><br>  <span class="hljs-attr">button_bg_color_dark:</span> <span class="hljs-string">&quot;transparent&quot;</span><br>  <span class="hljs-comment"># æŒ‰é’®æ‚¬æµ®èƒŒæ™¯è‰²</span><br>  <span class="hljs-comment"># Color of button when hovering</span><br>  <span class="hljs-attr">button_hover_bg_color:</span> <span class="hljs-string">&quot;#f2f3f5&quot;</span><br>  <span class="hljs-attr">button_hover_bg_color_dark:</span> <span class="hljs-string">&quot;#46647e&quot;</span><br><br><span class="hljs-comment"># ä¸»é¢˜å­—ä½“é…ç½®</span><br><span class="hljs-comment"># Font</span><br><span class="hljs-attr">font:</span><br>  <span class="hljs-attr">font_size:</span> <span class="hljs-string">16px</span><br>  <span class="hljs-attr">font_family:</span><br>  <span class="hljs-attr">letter_spacing:</span> <span class="hljs-number">0.</span><span class="hljs-string">02em</span><br>  <span class="hljs-attr">code_font_size:</span> <span class="hljs-number">85</span><span class="hljs-string">%</span><br><br><span class="hljs-comment"># æŒ‡å®šè‡ªå®šä¹‰ .js æ–‡ä»¶è·¯å¾„ï¼Œæ”¯æŒåˆ—è¡¨ï¼›è·¯å¾„æ˜¯ç›¸å¯¹ source ç›®å½•ï¼Œå¦‚ /js/custom.js å¯¹åº”å­˜æ”¾ç›®å½• source/js/custom.js</span><br><span class="hljs-comment"># Specify the path of your custom js file, support list. The path is relative to the source directory, such as `/js/custom.js` corresponding to the directory `source/js/custom.js`</span><br><span class="hljs-attr">custom_js:</span><br><br><span class="hljs-comment"># æŒ‡å®šè‡ªå®šä¹‰ .css æ–‡ä»¶è·¯å¾„ï¼Œç”¨æ³•å’Œ custom_js ç›¸åŒ</span><br><span class="hljs-comment"># The usage is the same as custom_js</span><br><span class="hljs-attr">custom_css:</span><br><br><span class="hljs-comment"># ç½‘é¡µè®¿é—®ç»Ÿè®¡</span><br><span class="hljs-comment"># Analysis of website visitors</span><br><span class="hljs-attr">web_analytics:</span>  <span class="hljs-comment"># ç½‘é¡µè®¿é—®ç»Ÿè®¡</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">false</span><br><br>  <span class="hljs-comment"># éµå¾ªè®¿å®¢æµè§ˆå™¨&quot;è¯·å‹¿è¿½è¸ª&quot;çš„è®¾ç½®ï¼Œå¦‚æœå¼€å¯åˆ™ä¸ç»Ÿè®¡å…¶è®¿é—®</span><br>  <span class="hljs-comment"># Follow the &quot;Do Not Track&quot; setting of the visitor&#x27;s browser</span><br>  <span class="hljs-comment"># See: https://www.w3.org/TR/tracking-dnt/</span><br>  <span class="hljs-attr">follow_dnt:</span> <span class="hljs-literal">true</span><br><br>  <span class="hljs-comment"># ç™¾åº¦ç»Ÿè®¡çš„ Keyï¼Œå€¼éœ€è¦è·å–ä¸‹æ–¹é“¾æ¥ä¸­ `hm.js?` åè¾¹çš„å­—ç¬¦ä¸²</span><br>  <span class="hljs-comment"># Baidu analytics, get the string behind `hm.js?`</span><br>  <span class="hljs-comment"># See: https://tongji.baidu.com/sc-web/10000033910/home/site/getjs?siteId=13751376</span><br>  <span class="hljs-attr">baidu:</span><br><br>  <span class="hljs-comment"># Google Analytics 4 çš„åª’ä½“èµ„æº ID</span><br>  <span class="hljs-comment"># Google Analytics 4 MEASUREMENT_ID</span><br>  <span class="hljs-comment"># See: https://support.google.com/analytics/answer/9744165#zippy=%2Cin-this-article</span><br>  <span class="hljs-attr">google:</span><br>    <span class="hljs-attr">measurement_id:</span><br><br>  <span class="hljs-comment"># è…¾è®¯ç»Ÿè®¡çš„ H5 App IDï¼Œå¼€å¯é«˜çº§åŠŸèƒ½æ‰æœ‰cid</span><br>  <span class="hljs-comment"># Tencent analytics, set APP ID</span><br>  <span class="hljs-comment"># See: https://mta.qq.com/h5/manage/ctr_app_manage</span><br>  <span class="hljs-attr">tencent:</span><br>    <span class="hljs-attr">sid:</span><br>    <span class="hljs-attr">cid:</span><br><br>  <span class="hljs-comment"># 51.la ç«™ç‚¹ç»Ÿè®¡ ID</span><br>  <span class="hljs-comment"># 51.la analytics</span><br>  <span class="hljs-comment"># See: https://www.51.la/user/site/index</span><br>  <span class="hljs-attr">woyaola:</span>  <span class="hljs-comment"># 51.la ç«™ç‚¹ç»Ÿè®¡ IDï¼Œå‚è§</span><br><br>  <span class="hljs-comment"># å‹ç›Ÿ/cnzz ç«™ç‚¹ç»Ÿè®¡ web_id</span><br>  <span class="hljs-comment"># cnzz analytics</span><br>  <span class="hljs-comment"># See: https://web.umeng.com/main.php?c=site&amp;a=show</span><br>  <span class="hljs-attr">cnzz:</span><br><br>  <span class="hljs-comment"># LeanCloud è®¡æ•°ç»Ÿè®¡ï¼Œå¯ç”¨äº PV UV å±•ç¤ºï¼Œå¦‚æœ `web_analytics: enable` æ²¡æœ‰å¼€å¯ï¼ŒPV UV å±•ç¤ºåªä¼šæŸ¥è¯¢ä¸ä¼šå¢åŠ </span><br>  <span class="hljs-comment"># LeanCloud count statistics, which can be used for PV UV display. If `web_analytics: enable` is false, PV UV display will only query and not increase</span><br>  <span class="hljs-attr">leancloud:</span><br>    <span class="hljs-attr">app_id:</span><br>    <span class="hljs-attr">app_key:</span><br>    <span class="hljs-comment"># REST API æœåŠ¡å™¨åœ°å€ï¼Œå›½é™…ç‰ˆä¸å¡«</span><br>    <span class="hljs-comment"># Only the Chinese mainland users need to set</span><br>    <span class="hljs-attr">server_url:</span><br>    <span class="hljs-comment"># ç»Ÿè®¡é¡µé¢æ—¶è·å–è·¯å¾„çš„å±æ€§</span><br>    <span class="hljs-comment"># Get the attribute of the page path during statistics</span><br>    <span class="hljs-attr">path:</span> <span class="hljs-string">window.location.pathname</span><br>    <span class="hljs-comment"># å¼€å¯åä¸ç»Ÿè®¡æœ¬åœ°è·¯å¾„( localhost ä¸ 127.0.0.1 )</span><br>    <span class="hljs-comment"># If true, ignore localhost &amp; 127.0.0.1</span><br>    <span class="hljs-attr">ignore_local:</span> <span class="hljs-literal">false</span><br><br><span class="hljs-comment"># å¯¹é¡µé¢ä¸­çš„å›¾ç‰‡å’Œè¯„è®ºæ’ä»¶è¿›è¡Œæ‡’åŠ è½½å¤„ç†ï¼Œå¯è§èŒƒå›´å¤–çš„å…ƒç´ ä¸ä¼šæå‰åŠ è½½</span><br><span class="hljs-comment"># Lazy loading of images and comment plugin on the page</span><br><span class="hljs-attr">lazyload:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br><br>  <span class="hljs-comment"># åŠ è½½æ—¶çš„å ä½å›¾ç‰‡</span><br>  <span class="hljs-comment"># The placeholder image when loading</span><br>  <span class="hljs-attr">loading_img:</span> <span class="hljs-string">/img/loading.gif</span><br><br>  <span class="hljs-comment"># å¼€å¯åæ‡’åŠ è½½ä»…åœ¨æ–‡ç« é¡µç”Ÿæ•ˆï¼Œå¦‚æœè‡ªå®šä¹‰é¡µé¢éœ€è¦ä½¿ç”¨ï¼Œå¯ä»¥åœ¨ Front-matter é‡ŒæŒ‡å®š `lazyload: true`</span><br>  <span class="hljs-comment"># If true, only enable lazyload on the post page. For custom pages, you can set &#x27;lazyload: true&#x27; in front-matter</span><br>  <span class="hljs-attr">onlypost:</span> <span class="hljs-literal">false</span><br><br>  <span class="hljs-comment"># è§¦å‘åŠ è½½çš„åç§»å€æ•°ï¼ŒåŸºæ•°æ˜¯è§†çª—é«˜åº¦ï¼Œå¯æ ¹æ®éƒ¨ç½²ç¯å¢ƒçš„è¯·æ±‚é€Ÿåº¦è°ƒèŠ‚</span><br>  <span class="hljs-comment"># The factor of viewport height that triggers loading</span><br>  <span class="hljs-attr">offset_factor:</span> <span class="hljs-number">2</span><br><br><span class="hljs-comment"># å›¾æ ‡åº“ï¼ŒåŒ…å«äº†å¤§é‡ç¤¾äº¤ç±»å›¾æ ‡ï¼Œä¸»é¢˜ä¾èµ–çš„ä¸åŒ…å«åœ¨å†…ï¼Œå› æ­¤å¯è‡ªè¡Œä¿®æ”¹ï¼Œè¯¦è§ https://hexo.fluid-dev.com/docs/icon/</span><br><span class="hljs-comment"># Icon library, which includes many social icons, does not include those theme dependent, so your can modify link by yourself. See: https://hexo.fluid-dev.com/docs/en/icon/</span><br><span class="hljs-attr">iconfont:</span> <span class="hljs-string">//at.alicdn.com/t/font_1736178_lbnruvf0jn.css</span><br><br><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-comment"># é¡µå¤´</span><br><span class="hljs-comment"># Header</span><br><span class="hljs-comment">#---------------------------</span><br><br><span class="hljs-comment"># å¯¼èˆªæ çš„ç›¸å…³é…ç½®</span><br><span class="hljs-comment"># Navigation bar</span><br><span class="hljs-attr">navbar:</span><br>  <span class="hljs-comment"># å¯¼èˆªæ å·¦ä¾§çš„æ ‡é¢˜ï¼Œä¸ºç©ºåˆ™æŒ‰ hexo config ä¸­ `title` æ˜¾ç¤º</span><br>  <span class="hljs-comment"># The title on the left side of the navigation bar. If empty, it is based on `title` in hexo config</span><br>  <span class="hljs-attr">blog_title:</span> <span class="hljs-string">&quot;Hexo&quot;</span><br><br>  <span class="hljs-comment"># å¯¼èˆªæ æ¯›ç»ç’ƒç‰¹æ•ˆï¼Œå®éªŒæ€§åŠŸèƒ½ï¼Œå¯èƒ½ä¼šé€ æˆé¡µé¢æ»šåŠ¨æ‰å¸§å’ŒæŠ–åŠ¨ï¼Œéƒ¨åˆ†æµè§ˆå™¨ä¸æ”¯æŒä¼šè‡ªåŠ¨ä¸ç”Ÿæ•ˆ</span><br>  <span class="hljs-comment"># Navigation bar frosted glass special animation. It is an experimental feature</span><br>  <span class="hljs-attr">ground_glass:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br><br>    <span class="hljs-comment"># æ¨¡ç³Šåƒç´ ï¼Œåªèƒ½ä¸ºæ•°å­—ï¼Œæ•°å­—è¶Šå¤§æ¨¡ç³Šåº¦è¶Šé«˜</span><br>    <span class="hljs-comment"># Number of blurred pixel. the larger the number, the higher the blur</span><br>    <span class="hljs-attr">px:</span> <span class="hljs-number">3</span><br><br>    <span class="hljs-comment"># ä¸é€æ˜åº¦ï¼Œæ•°å­—è¶Šå¤§é€æ˜åº¦è¶Šä½ï¼Œæ³¨æ„é€æ˜è¿‡åº¦å¯èƒ½çœ‹ä¸æ¸…èœå•å­—ä½“</span><br>    <span class="hljs-comment"># Ratio of opacity, 1.0 is completely opaque</span><br>    <span class="hljs-comment"># available: 0 - 1.0</span><br>    <span class="hljs-attr">alpha:</span> <span class="hljs-number">0.7</span><br><br>  <span class="hljs-comment"># å¯¼èˆªæ èœå•ï¼Œå¯è‡ªè¡Œå¢å‡ï¼Œkey ç”¨æ¥å…³è” languages/*.ymlï¼Œå¦‚ä¸å­˜åœ¨å…³è”åˆ™æ˜¾ç¤º key æœ¬èº«çš„å€¼ï¼›icon æ˜¯ css classï¼Œå¯ä»¥çœç•¥ï¼›å¢åŠ  name å¯ä»¥å¼ºåˆ¶æ˜¾ç¤ºæŒ‡å®šåç§°</span><br>  <span class="hljs-comment"># Navigation bar menu. `key` is used to associate languages/*.yml. If there is no association, the value of `key` itself will be displayed; if `icon` is a css class, it can be omitted; adding `name` can force the display of the specified name</span><br>  <span class="hljs-attr">menu:</span><br>    <span class="hljs-bullet">-</span> &#123; <span class="hljs-attr">key:</span> <span class="hljs-string">&quot;home&quot;</span>, <span class="hljs-attr">link:</span> <span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-attr">icon:</span> <span class="hljs-string">&quot;iconfont icon-home-fill&quot;</span> &#125;<br>    <span class="hljs-bullet">-</span> &#123; <span class="hljs-attr">key:</span> <span class="hljs-string">&quot;archive&quot;</span>, <span class="hljs-attr">link:</span> <span class="hljs-string">&quot;/archives/&quot;</span>, <span class="hljs-attr">icon:</span> <span class="hljs-string">&quot;iconfont icon-archive-fill&quot;</span> &#125;<br>    <span class="hljs-bullet">-</span> &#123; <span class="hljs-attr">key:</span> <span class="hljs-string">&quot;category&quot;</span>, <span class="hljs-attr">link:</span> <span class="hljs-string">&quot;/categories/&quot;</span>, <span class="hljs-attr">icon:</span> <span class="hljs-string">&quot;iconfont icon-category-fill&quot;</span> &#125;<br>    <span class="hljs-bullet">-</span> &#123; <span class="hljs-attr">key:</span> <span class="hljs-string">&quot;tag&quot;</span>, <span class="hljs-attr">link:</span> <span class="hljs-string">&quot;/tags/&quot;</span>, <span class="hljs-attr">icon:</span> <span class="hljs-string">&quot;iconfont icon-tags-fill&quot;</span> &#125;<br>    <span class="hljs-bullet">-</span> &#123; <span class="hljs-attr">key:</span> <span class="hljs-string">&quot;about&quot;</span>, <span class="hljs-attr">link:</span> <span class="hljs-string">&quot;/about/&quot;</span>, <span class="hljs-attr">icon:</span> <span class="hljs-string">&quot;iconfont icon-user-fill&quot;</span> &#125;<br>    <span class="hljs-bullet">-</span> &#123; <span class="hljs-attr">key:</span> <span class="hljs-string">&quot;links&quot;</span>, <span class="hljs-attr">link:</span> <span class="hljs-string">&quot;/links/&quot;</span>, <span class="hljs-attr">icon:</span> <span class="hljs-string">&quot;iconfont icon-link-fill&quot;</span> &#125;<br><br><span class="hljs-comment"># æœç´¢åŠŸèƒ½ï¼ŒåŸºäº hexo-generator-search æ’ä»¶ï¼Œè‹¥å·²å®‰è£…å…¶ä»–æœç´¢æ’ä»¶è¯·å…³é—­æ­¤åŠŸèƒ½ï¼Œä»¥é¿å…ç”Ÿæˆå¤šä½™çš„ç´¢å¼•æ–‡ä»¶</span><br><span class="hljs-comment"># Search feature, based on hexo-generator-search. If you have installed other search plugins, please disable this feature to avoid generating redundant index files</span><br><span class="hljs-attr">search:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br><br>  <span class="hljs-comment"># æœç´¢ç´¢å¼•æ–‡ä»¶çš„è·¯å¾„ï¼Œå¯ä»¥æ˜¯ç›¸å¯¹è·¯å¾„æˆ–å¤–ç«™çš„ç»å¯¹è·¯å¾„</span><br>  <span class="hljs-comment"># Path for search index file, it can be a relative path or an absolute path</span><br>  <span class="hljs-attr">path:</span> <span class="hljs-string">/local-search.xml</span><br><br>  <span class="hljs-comment"># æ–‡ä»¶ç”Ÿæˆåœ¨æœ¬åœ°çš„ä½ç½®ï¼Œå¿…é¡»æ˜¯ç›¸å¯¹è·¯å¾„</span><br>  <span class="hljs-comment"># The location where the index file is generated locally, it must be a relative location</span><br>  <span class="hljs-attr">generate_path:</span> <span class="hljs-string">/local-search.xml</span><br><br>  <span class="hljs-comment"># æœç´¢çš„èŒƒå›´</span><br>  <span class="hljs-comment"># Search field</span><br>  <span class="hljs-comment"># Options: post | page | all</span><br>  <span class="hljs-attr">field:</span> <span class="hljs-string">all</span><br><br>  <span class="hljs-comment"># æœç´¢æ˜¯å¦æ‰«ææ­£æ–‡</span><br>  <span class="hljs-comment"># If true, search will scan the post content</span><br>  <span class="hljs-attr">content:</span> <span class="hljs-literal">true</span><br><br><span class="hljs-comment"># é¦–å±å›¾ç‰‡çš„ç›¸å…³é…ç½®</span><br><span class="hljs-comment"># Config of the big image on the first screen</span><br><span class="hljs-attr">banner:</span><br>  <span class="hljs-comment"># è§†å·®æ»šåŠ¨ï¼Œå›¾ç‰‡ä¸æ¿å—ä¼šéšç€å±å¹•æ»šåŠ¨äº§ç”Ÿè§†å·®æ•ˆæœ</span><br>  <span class="hljs-comment"># Scrolling parallax</span><br>  <span class="hljs-attr">parallax:</span> <span class="hljs-literal">true</span><br><br>  <span class="hljs-comment"># å›¾ç‰‡æœ€å°çš„å®½é«˜æ¯”ï¼Œä»¥å…å›¾ç‰‡ä¸¤è¾¹è¢«è¿‡åº¦è£å‰ªï¼Œé€‚ç”¨äºç§»åŠ¨ç«¯ç«–å±æ—¶ï¼Œå¦‚éœ€å…³é—­è®¾ä¸º 0</span><br>  <span class="hljs-comment"># Minimum ratio of width to height, applicable to the vertical screen of mobile device, if you need to close it, set it to 0</span><br>  <span class="hljs-attr">width_height_ratio:</span> <span class="hljs-number">1.0</span><br><br><span class="hljs-comment"># å‘ä¸‹æ»šåŠ¨çš„ç®­å¤´</span><br><span class="hljs-comment"># Scroll down arrow</span><br><span class="hljs-attr">scroll_down_arrow:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br><br>  <span class="hljs-comment"># å¤´å›¾é«˜åº¦ä¸å°äºæŒ‡å®šæ¯”ä¾‹ï¼Œæ‰æ˜¾ç¤ºç®­å¤´</span><br>  <span class="hljs-comment"># Only the height of the banner image is greater than the ratio, the arrow is displayed</span><br>  <span class="hljs-comment"># Available: 0 - 100</span><br>  <span class="hljs-attr">banner_height_limit:</span> <span class="hljs-number">80</span><br><br>  <span class="hljs-comment"># ç¿»é¡µåè‡ªåŠ¨æ»šåŠ¨</span><br>  <span class="hljs-comment"># Auto scroll after page turning</span><br>  <span class="hljs-attr">scroll_after_turning_page:</span> <span class="hljs-literal">true</span><br><br><span class="hljs-comment"># å‘é¡¶éƒ¨æ»šåŠ¨çš„ç®­å¤´</span><br><span class="hljs-comment"># Scroll top arrow</span><br><span class="hljs-attr">scroll_top_arrow:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br><br><span class="hljs-comment"># Open Graph metadata</span><br><span class="hljs-comment"># See: https://hexo.io/docs/helpers.html#open-graph</span><br><span class="hljs-attr">open_graph:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">twitter_card:</span> <span class="hljs-string">summary_large_image</span><br>  <span class="hljs-attr">twitter_id:</span><br>  <span class="hljs-attr">twitter_site:</span><br>  <span class="hljs-attr">google_plus:</span><br>  <span class="hljs-attr">fb_admins:</span><br>  <span class="hljs-attr">fb_app_id:</span><br><br><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-comment"># é¡µè„š</span><br><span class="hljs-comment"># Footer</span><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-attr">footer:</span><br>  <span class="hljs-comment"># é¡µè„šç¬¬ä¸€è¡Œæ–‡å­—çš„ HTMLï¼Œå»ºè®®ä¿ç•™ Fluid çš„é“¾æ¥ï¼Œç”¨äºå‘æ›´å¤šäººæ¨å¹¿æœ¬ä¸»é¢˜</span><br>  <span class="hljs-comment"># HTML of the first line of the footer, it is recommended to keep the Fluid link to promote this theme to more people</span><br>  <span class="hljs-attr">content:</span> <span class="hljs-string">&#x27;</span><br><span class="hljs-string">    &lt;a href=&quot;https://hexo.io&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span&gt;Hexo&lt;/span&gt;&lt;/a&gt;</span><br><span class="hljs-string">    &lt;i class=&quot;iconfont icon-love&quot;&gt;&lt;/i&gt;</span><br><span class="hljs-string">    &lt;a href=&quot;https://github.com/fluid-dev/hexo-theme-fluid&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span&gt;Fluid&lt;/span&gt;&lt;/a&gt;</span><br><span class="hljs-string">  &lt;div style=&quot;font-size: 0.85rem&quot;&gt;</span><br><span class="hljs-string">      &lt;span id=&quot;timeDate&quot;&gt;è½½å…¥å¤©æ•°...&lt;/span&gt;</span><br><span class="hljs-string">      &lt;span id=&quot;times&quot;&gt;è½½å…¥æ—¶åˆ†ç§’...&lt;/span&gt;</span><br><span class="hljs-string">      &lt;script src=&quot;/js/duration.js&quot;&gt;&lt;/script&gt;</span><br><span class="hljs-string">    &lt;/div&gt;</span><br><span class="hljs-string">  &#x27;</span><br><br>  <span class="hljs-comment"># å±•ç¤ºç½‘ç«™çš„ PVã€UV ç»Ÿè®¡æ•°</span><br>  <span class="hljs-comment"># Display website PV and UV statistics</span><br>  <span class="hljs-attr">statistics:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">false</span><br><br>    <span class="hljs-comment"># ç»Ÿè®¡æ•°æ®æ¥æºï¼Œä½¿ç”¨ leancloud éœ€è¦è®¾ç½® `web_analytics: leancloud` ä¸­çš„å‚æ•°ï¼›ä½¿ç”¨ busuanzi ä¸éœ€è¦é¢å¤–è®¾ç½®ï¼Œä½†æ˜¯æœ‰æ—¶ä¸ç¨³å®šï¼Œå¦å¤–æœ¬åœ°è¿è¡Œæ—¶ busuanzi æ˜¾ç¤ºç»Ÿè®¡æ•°æ®å¾ˆå¤§å±äºæ­£å¸¸ç°è±¡ï¼Œéƒ¨ç½²åä¼šæ­£å¸¸</span><br>    <span class="hljs-comment"># Data source. If use leancloud, you need to set the parameter in `web_analytics: leancloud`</span><br>    <span class="hljs-comment"># Options: busuanzi | leancloud</span><br>    <span class="hljs-attr">source:</span> <span class="hljs-string">&quot;busuanzi&quot;</span><br><br>  <span class="hljs-comment"># å›½å†…å¤§é™†æœåŠ¡å™¨çš„å¤‡æ¡ˆä¿¡æ¯</span><br>  <span class="hljs-comment"># For Chinese mainland website policy, other areas keep disable</span><br>  <span class="hljs-attr">beian:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-comment"># ICPè¯å·</span><br>    <span class="hljs-attr">icp_text:</span> <span class="hljs-string">äº¬ICPè¯123456å·</span><br>    <span class="hljs-comment"># å…¬å®‰å¤‡æ¡ˆå·ï¼Œä¸å¡«åˆ™åªæ˜¾ç¤ºICP</span><br>    <span class="hljs-attr">police_text:</span> <span class="hljs-string">äº¬å…¬ç½‘å®‰å¤‡12345678å·</span><br>    <span class="hljs-comment"># å…¬å®‰å¤‡æ¡ˆçš„ç¼–å·ï¼Œç”¨äºURLè·³è½¬æŸ¥è¯¢</span><br>    <span class="hljs-attr">police_code:</span> <span class="hljs-number">12345678</span><br>    <span class="hljs-comment"># å…¬å®‰å¤‡æ¡ˆçš„å›¾ç‰‡. ä¸ºç©ºæ—¶ä¸æ˜¾ç¤ºå¤‡æ¡ˆå›¾ç‰‡</span><br>    <span class="hljs-attr">police_icon:</span> <span class="hljs-string">/img/police_beian.png</span><br><br><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-comment"># é¦–é¡µ</span><br><span class="hljs-comment"># Home Page</span><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-attr">index:</span><br>  <span class="hljs-comment"># é¦–é¡µ Banner å¤´å›¾ï¼Œå¯ä»¥æ˜¯ç›¸å¯¹è·¯å¾„æˆ–ç»å¯¹è·¯å¾„ï¼Œä»¥ä¸‹ç›¸åŒ</span><br>  <span class="hljs-comment"># Path of Banner image, can be a relative path or an absolute path, the same on other pages</span><br>  <span class="hljs-attr">banner_img:</span> <span class="hljs-string">/images/page-home.webp</span><br><br>  <span class="hljs-comment"># å¤´å›¾é«˜åº¦ï¼Œå±å¹•ç™¾åˆ†æ¯”</span><br>  <span class="hljs-comment"># Height ratio of banner image</span><br>  <span class="hljs-comment"># Available: 0 - 100</span><br>  <span class="hljs-attr">banner_img_height:</span> <span class="hljs-number">100</span><br><br>  <span class="hljs-comment"># å¤´å›¾é»‘è‰²è’™ç‰ˆçš„ä¸é€æ˜åº¦ï¼Œavailable: 0 - 1.0ï¼Œ 1 æ˜¯å®Œå…¨ä¸é€æ˜</span><br>  <span class="hljs-comment"># Opacity of the banner mask, 1.0 is completely opaque</span><br>  <span class="hljs-comment"># Available: 0 - 1.0</span><br>  <span class="hljs-attr">banner_mask_alpha:</span> <span class="hljs-number">0.3</span><br><br>  <span class="hljs-comment"># é¦–é¡µå‰¯æ ‡é¢˜çš„ç‹¬ç«‹è®¾ç½®</span><br>  <span class="hljs-comment"># Independent config of home page subtitle</span><br>  <span class="hljs-attr">slogan:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br><br>    <span class="hljs-comment"># ä¸ºç©ºåˆ™æŒ‰ hexo config.subtitle æ˜¾ç¤º</span><br>    <span class="hljs-comment"># If empty, text based on `subtitle` in hexo config</span><br>    <span class="hljs-attr">text:</span> <span class="hljs-string">&quot;An elegant Material-Design theme for Hexo&quot;</span><br><br>    <span class="hljs-comment"># é€šè¿‡ API æ¥å£ä½œä¸ºé¦–é¡µå‰¯æ ‡é¢˜çš„å†…å®¹ï¼Œå¿…é¡»è¿”å›çš„æ˜¯ JSON æ ¼å¼ï¼Œå¦‚æœè¯·æ±‚å¤±è´¥åˆ™æŒ‰ text å­—æ®µæ˜¾ç¤ºï¼Œè¯¥åŠŸèƒ½å¿…é¡»å…ˆå¼€å¯ typing æ‰“å­—æœºåŠŸèƒ½</span><br>    <span class="hljs-comment"># Subtitle of the homepage through the API, must be returned a JSON. If the request fails, it will be displayed in `text` value. This feature must first enable the typing animation</span><br>    <span class="hljs-attr">api:</span><br>      <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br><br>      <span class="hljs-comment"># è¯·æ±‚åœ°å€</span><br>      <span class="hljs-comment"># Request url</span><br>      <span class="hljs-attr">url:</span> <span class="hljs-string">&quot;https://v1.hitokoto.cn/&quot;</span><br><br>      <span class="hljs-comment"># è¯·æ±‚æ–¹æ³•</span><br>      <span class="hljs-comment"># Request method</span><br>      <span class="hljs-comment"># Available: GET | POST | PUT</span><br>      <span class="hljs-attr">method:</span> <span class="hljs-string">&quot;GET&quot;</span><br><br>      <span class="hljs-comment"># è¯·æ±‚å¤´</span><br>      <span class="hljs-comment"># Request headers</span><br>      <span class="hljs-attr">headers:</span> &#123;&#125;<br><br>      <span class="hljs-comment"># ä»è¯·æ±‚ç»“æœè·å–å­—ç¬¦ä¸²çš„å–å€¼å­—æ®µï¼Œæœ€ç»ˆå¿…é¡»æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¾‹å¦‚è¿”å›ç»“æœä¸º &#123;&quot;data&quot;: &#123;&quot;author&quot;: &quot;fluid&quot;, &quot;content&quot;: &quot;An elegant theme&quot;&#125;&#125;, åˆ™å–å€¼å­—æ®µä¸º [&#x27;data&#x27;, &#x27;content&#x27;]ï¼›å¦‚æœè¿”å›æ˜¯åˆ—è¡¨åˆ™è‡ªåŠ¨é€‰æ‹©ç¬¬ä¸€é¡¹</span><br>      <span class="hljs-comment"># The value field of the string obtained from the response. For example, the response content is &#123;&quot;data&quot;: &#123;&quot;author&quot;: &quot;fluid&quot;, &quot;content&quot;: &quot;An elegant theme&quot;&#125;&#125;, the expected `keys: [&#x27;data&#x27;,&#x27;content&#x27;]`; if the return is a list, the first item is automatically selected</span><br>      <span class="hljs-attr">keys:</span> [<span class="hljs-string">&quot;hitokoto&quot;</span>]<br><br>  <span class="hljs-comment"># è‡ªåŠ¨æˆªå–æ–‡ç« æ‘˜è¦</span><br>  <span class="hljs-comment"># Auto extract post</span><br>  <span class="hljs-attr">auto_excerpt:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br><br>  <span class="hljs-comment"># æ‰“å¼€æ–‡ç« çš„æ ‡ç­¾æ–¹å¼</span><br>  <span class="hljs-comment"># The browser tag to open the post</span><br>  <span class="hljs-comment"># Available: _blank | _self</span><br>  <span class="hljs-attr">post_url_target:</span> <span class="hljs-string">_self</span><br><br>  <span class="hljs-comment"># æ˜¯å¦æ˜¾ç¤ºæ–‡ç« ä¿¡æ¯ï¼ˆæ—¶é—´ã€åˆ†ç±»ã€æ ‡ç­¾ï¼‰</span><br>  <span class="hljs-comment"># Meta information of post</span><br>  <span class="hljs-attr">post_meta:</span><br>    <span class="hljs-attr">date:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">category:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">tag:</span> <span class="hljs-literal">true</span><br><br>  <span class="hljs-comment"># æ–‡ç« é€šè¿‡ sticky æ’åºåï¼Œåœ¨é¦–é¡µæ–‡ç« æ ‡é¢˜å‰æ˜¾ç¤ºå›¾æ ‡</span><br>  <span class="hljs-comment"># If the posts are sorted by `sticky`, an icon is displayed in front of the post title</span><br>  <span class="hljs-attr">post_sticky:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">icon:</span> <span class="hljs-string">&quot;iconfont icon-top&quot;</span><br><br><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-comment"># æ–‡ç« é¡µ</span><br><span class="hljs-comment"># Post Page</span><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-attr">post:</span><br>  <span class="hljs-attr">banner_img:</span> <span class="hljs-string">/images/page-article.webp</span><br>  <span class="hljs-attr">banner_img_height:</span> <span class="hljs-number">70</span><br>  <span class="hljs-attr">banner_mask_alpha:</span> <span class="hljs-number">0.3</span><br><br>  <span class="hljs-comment"># æ–‡ç« åœ¨é¦–é¡µçš„é»˜è®¤å°é¢å›¾ï¼Œå½“æ²¡æœ‰æŒ‡å®š index_img æ—¶ä¼šä½¿ç”¨è¯¥å›¾ç‰‡ï¼Œè‹¥ä¸¤è€…éƒ½ä¸ºç©ºåˆ™ä¸æ˜¾ç¤ºä»»ä½•å›¾ç‰‡</span><br>  <span class="hljs-comment"># Path of the default post cover when `index_img` is not set. If both are empty, no image will be displayed</span><br>  <span class="hljs-attr">default_index_img:</span><br><br>  <span class="hljs-comment"># æ–‡ç« æ ‡é¢˜ä¸‹æ–¹çš„å…ƒä¿¡æ¯</span><br>  <span class="hljs-comment"># Meta information below title</span><br>  <span class="hljs-attr">meta:</span><br>    <span class="hljs-comment"># ä½œè€…ï¼Œä¼˜å…ˆæ ¹æ® front-matter é‡Œ author å­—æ®µï¼Œå…¶æ¬¡æ˜¯ hexo é…ç½®ä¸­ author å€¼</span><br>    <span class="hljs-comment"># Author, based on `author` field in front-matter, if not set, based on `author` value in hexo config</span><br>    <span class="hljs-attr">author:</span><br>      <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br><br>    <span class="hljs-comment"># æ–‡ç« æ—¥æœŸï¼Œä¼˜å…ˆæ ¹æ® front-matter é‡Œ date å­—æ®µï¼Œå…¶æ¬¡æ˜¯ md æ–‡ä»¶æ—¥æœŸ</span><br>    <span class="hljs-comment"># Post date, based on `date` field in front-matter, if not set, based on create date of .md file</span><br>    <span class="hljs-attr">date:</span><br>      <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>      <span class="hljs-comment"># æ ¼å¼å‚ç…§ ISO-8601 æ—¥æœŸæ ¼å¼åŒ–</span><br>      <span class="hljs-comment"># ISO-8601 date format</span><br>      <span class="hljs-comment"># See: http://momentjs.cn/docs/#/parsing/string-format/</span><br>      <span class="hljs-attr">format:</span> <span class="hljs-string">&quot;LL a&quot;</span><br><br>    <span class="hljs-comment"># å­—æ•°ç»Ÿè®¡</span><br>    <span class="hljs-comment"># Word count</span><br>    <span class="hljs-attr">wordcount:</span><br>      <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br><br>    <span class="hljs-comment"># ä¼°è®¡é˜…è¯»å…¨æ–‡éœ€è¦çš„æ—¶é•¿</span><br>    <span class="hljs-comment"># Estimated reading time</span><br>    <span class="hljs-attr">min2read:</span><br>      <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>      <span class="hljs-comment"># æ¯ä¸ªå­—è¯çš„é•¿åº¦ï¼Œå»ºè®®ï¼šä¸­æ–‡â‰ˆ2ï¼Œè‹±æ–‡â‰ˆ5ï¼Œä¸­è‹±æ··åˆå¯è‡ªè¡Œè°ƒèŠ‚</span><br>      <span class="hljs-comment"># Average word length (chars count in word), ZH â‰ˆ 2, EN â‰ˆ 5</span><br>      <span class="hljs-attr">awl:</span> <span class="hljs-number">2</span><br>      <span class="hljs-comment"># æ¯åˆ†é’Ÿé˜…è¯»å­—æ•°ï¼Œå¦‚æœå¤§éƒ¨åˆ†æ˜¯æŠ€æœ¯æ–‡ç« å¯é€‚åº¦è°ƒä½</span><br>      <span class="hljs-comment"># Words per minute</span><br>      <span class="hljs-attr">wpm:</span> <span class="hljs-number">60</span><br><br>    <span class="hljs-comment"># æµè§ˆé‡è®¡æ•°</span><br>    <span class="hljs-comment"># Number of visits</span><br>    <span class="hljs-attr">views:</span><br>      <span class="hljs-attr">enable:</span> <span class="hljs-literal">false</span><br>      <span class="hljs-comment"># ç»Ÿè®¡æ•°æ®æ¥æº</span><br>      <span class="hljs-comment"># Data Source</span><br>      <span class="hljs-comment"># Options: busuanzi | leancloud</span><br>      <span class="hljs-attr">source:</span> <span class="hljs-string">&quot;busuanzi&quot;</span><br><br>  <span class="hljs-comment"># åœ¨æ–‡ç« å¼€å¤´æ˜¾ç¤ºæ–‡ç« æ›´æ–°æ—¶é—´ï¼Œè¯¥æ—¶é—´é»˜è®¤æ˜¯ md æ–‡ä»¶æ›´æ–°æ—¶é—´ï¼Œå¯é€šè¿‡ front-matter ä¸­ `updated` æ‰‹åŠ¨æŒ‡å®šï¼ˆå’Œ date ä¸€æ ·æ ¼å¼ï¼‰</span><br>  <span class="hljs-comment"># Update date is displayed at the beginning of the post. The default date is the update date of the md file, which can be manually specified by `updated` in front-matter (same format as date)</span><br>  <span class="hljs-attr">updated:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">false</span><br><br>    <span class="hljs-comment"># æ ¼å¼å‚ç…§ ISO-8601 æ—¥æœŸæ ¼å¼åŒ–</span><br>    <span class="hljs-comment"># ISO-8601 date format</span><br>    <span class="hljs-comment"># See: http://momentjs.cn/docs/#/parsing/string-format/</span><br>    <span class="hljs-attr">date_format:</span> <span class="hljs-string">&quot;LL a&quot;</span><br><br>    <span class="hljs-comment"># æ˜¯å¦ä½¿ç”¨ç›¸å¯¹æ—¶é—´è¡¨ç¤ºï¼Œæ¯”å¦‚ï¼š&quot;3 å¤©å‰&quot;</span><br>    <span class="hljs-comment"># If true, it will be a relative time, such as: &quot;3 days ago&quot;</span><br>    <span class="hljs-attr">relative:</span> <span class="hljs-literal">false</span><br><br>    <span class="hljs-comment"># æç¤ºæ ‡ç­¾ç±»å‹</span><br>    <span class="hljs-comment"># Note class</span><br>    <span class="hljs-comment"># Options: default | primary | info | success | warning | danger | light</span><br>    <span class="hljs-attr">note_class:</span> <span class="hljs-string">info</span><br><br>  <span class="hljs-comment"># ä¾§è¾¹æ å±•ç¤ºå½“å‰åˆ†ç±»ä¸‹çš„æ–‡ç« </span><br>  <span class="hljs-comment"># Sidebar of category</span><br>  <span class="hljs-attr">category_bar:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br><br>    <span class="hljs-comment"># å¼€å¯åï¼Œåªæœ‰åœ¨æ–‡ç«  Front-matter é‡ŒæŒ‡å®š `category_bar: true` æ‰ä¼šå±•ç¤ºåˆ†ç±»ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ `category_bar: [&quot;åˆ†ç±»A&quot;]` æ¥æŒ‡å®šåˆ†ç±»</span><br>    <span class="hljs-comment"># If true, only set `category_bar: true` in Front-matter will enable sidebar of category, also set `category_bar: [&quot;CategoryA&quot;]` to specify categories</span><br>    <span class="hljs-attr">specific:</span> <span class="hljs-literal">true</span><br><br>    <span class="hljs-comment"># ç½®äºæ¿å—çš„å·¦ä¾§æˆ–å³ä¾§</span><br>    <span class="hljs-comment"># place in the board</span><br>    <span class="hljs-comment"># Options: left | right</span><br>    <span class="hljs-attr">placement:</span> <span class="hljs-string">left</span><br><br>    <span class="hljs-comment"># æ–‡ç« çš„æ’åºå­—æ®µï¼Œå‰é¢å¸¦å‡å·æ˜¯å€’åºï¼Œä¸å¸¦å‡å·æ˜¯æ­£åº</span><br>    <span class="hljs-comment"># Sort field for posts, with a minus sign is reverse order</span><br>    <span class="hljs-comment"># Options: date | title | or other field of front-matter</span><br>    <span class="hljs-attr">post_order_by:</span> <span class="hljs-string">&quot;title&quot;</span><br><br>    <span class="hljs-comment"># å•ä¸ªåˆ†ç±»ä¸­æŠ˜å å±•ç¤ºæ–‡ç« æ•°çš„æœ€å¤§å€¼ï¼Œè¶…è¿‡é™åˆ¶ä¼šæ˜¾ç¤º Moreï¼Œ0 åˆ™ä¸é™åˆ¶</span><br>    <span class="hljs-comment"># The maximum number of posts in a single category. If the limit is exceeded, it will be displayed More. If 0 no limit</span><br>    <span class="hljs-attr">post_limit:</span> <span class="hljs-number">0</span><br><br>  <span class="hljs-comment"># ä¾§è¾¹æ å±•ç¤ºæ–‡ç« ç›®å½•</span><br>  <span class="hljs-comment"># Table of contents (TOC) in the sidebar</span><br>  <span class="hljs-attr">toc:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br><br>    <span class="hljs-comment"># ç½®äºæ¿å—çš„å·¦ä¾§æˆ–å³ä¾§</span><br>    <span class="hljs-comment"># place in the board</span><br>    <span class="hljs-comment"># Options: left | right</span><br>    <span class="hljs-attr">placement:</span> <span class="hljs-string">right</span><br><br>    <span class="hljs-comment"># ç›®å½•ä¼šé€‰æ‹©è¿™äº›èŠ‚ç‚¹ä½œä¸ºæ ‡é¢˜</span><br>    <span class="hljs-comment"># TOC will select these nodes as headings</span><br>    <span class="hljs-attr">headingSelector:</span> <span class="hljs-string">&quot;h1,h2,h3,h4,h5,h6&quot;</span><br><br>    <span class="hljs-comment"># å±‚çº§çš„æŠ˜å æ·±åº¦ï¼Œ0 æ˜¯å…¨éƒ¨æŠ˜å ï¼Œå¤§äº 0 åå¦‚æœå­˜åœ¨ä¸‹çº§æ ‡é¢˜åˆ™é»˜è®¤å±•å¼€</span><br>    <span class="hljs-comment"># Collapse depth. If 0, all headings collapsed. If greater than 0, it will be expanded by default if there are sub headings</span><br>    <span class="hljs-attr">collapseDepth:</span> <span class="hljs-number">0</span><br><br>  <span class="hljs-comment"># ç‰ˆæƒå£°æ˜ï¼Œä¼šæ˜¾ç¤ºåœ¨æ¯ç¯‡æ–‡ç« çš„ç»“å°¾</span><br>  <span class="hljs-comment"># Copyright, will be displayed at the end of each post</span><br>  <span class="hljs-attr">copyright:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br><br>    <span class="hljs-comment"># CreativeCommons license</span><br>    <span class="hljs-comment"># Options: BY | BY-SA | BY-ND | BY-NC | BY-NC-SA | BY-NC-ND</span><br>    <span class="hljs-attr">license:</span> <span class="hljs-string">&#x27;BY&#x27;</span><br><br>    <span class="hljs-comment"># æ˜¾ç¤ºä½œè€…</span><br>    <span class="hljs-attr">author:</span><br>      <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br><br>    <span class="hljs-comment"># æ˜¾ç¤ºå‘å¸ƒæ—¥æœŸ</span><br>    <span class="hljs-comment"># Show post date</span><br>    <span class="hljs-attr">post_date:</span><br>      <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>      <span class="hljs-attr">format:</span> <span class="hljs-string">&quot;LL&quot;</span><br><br>    <span class="hljs-comment"># æ˜¾ç¤ºæ›´æ–°æ—¥æœŸ</span><br>    <span class="hljs-comment"># Show update date</span><br>    <span class="hljs-attr">update_date:</span><br>      <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>      <span class="hljs-attr">format:</span> <span class="hljs-string">&quot;LL&quot;</span><br><br>  <span class="hljs-comment"># æ–‡ç« åº•éƒ¨ä¸Šä¸€ç¯‡ä¸‹ä¸€ç¯‡åŠŸèƒ½</span><br>  <span class="hljs-comment"># Link to previous/next post</span><br>  <span class="hljs-attr">prev_next:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br><br>  <span class="hljs-comment"># æ–‡ç« å›¾ç‰‡æ ‡é¢˜</span><br>  <span class="hljs-comment"># Image caption</span><br>  <span class="hljs-attr">image_caption:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br><br>  <span class="hljs-comment"># æ–‡ç« å›¾ç‰‡å¯ç‚¹å‡»æ”¾å¤§</span><br>  <span class="hljs-comment"># Zoom feature of images</span><br>  <span class="hljs-attr">image_zoom:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-comment"># æ”¾å¤§åå›¾ç‰‡é“¾æ¥æ›¿æ¢è§„åˆ™ï¼Œå¯ç”¨äºå°†å‹ç¼©å›¾ç‰‡é“¾æ¥æ›¿æ¢ä¸ºåŸå›¾ç‰‡é“¾æ¥ï¼Œå¦‚ [&#x27;-slim&#x27;, &#x27;&#x27;] æ˜¯å°†é“¾æ¥ä¸­ `-slim` ç§»é™¤ï¼›å¦‚æœæƒ³ä½¿ç”¨æ­£åˆ™è¯·ä½¿ç”¨ `re:` å‰ç¼€ï¼Œå¦‚ [&#x27;re:\\d&#123;3,4&#125;\\/\\d&#123;3,4&#125;\\/&#x27;, &#x27;&#x27;]</span><br>    <span class="hljs-comment"># The image url replacement when zooming, the feature can be used to replace the compressed image to the original image, eg: [&#x27;-slim&#x27;, &#x27;&#x27;] removes `-slim` from the image url when zooming; if you want to use regular, use prefix `re:`, eg: [&#x27;re:\\d&#123;3,4&#125;\\/\\d&#123;3,4&#125;\\/&#x27;,&#x27;&#x27;]</span><br>    <span class="hljs-attr">img_url_replace:</span> [<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>]<br><br>  <span class="hljs-comment"># è„šæ³¨è¯­æ³•ï¼Œä¼šåœ¨æ–‡ç« åº•éƒ¨ç”Ÿæˆè„šæ³¨ï¼Œå¦‚æœ Markdown æ¸²æŸ“å™¨æœ¬èº«æ”¯æŒï¼Œåˆ™å»ºè®®å…³é—­ï¼Œå¦åˆ™å¯èƒ½ä¼šå†²çª</span><br>  <span class="hljs-comment"># Support footnote syntax, footnotes will be generated at the bottom of the post page. If the Markdown renderer itself supports it, please disable it, otherwise it may conflict</span><br>  <span class="hljs-attr">footnote:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-comment"># è„šæ³¨çš„èŠ‚æ ‡é¢˜ï¼Œä¹Ÿå¯ä»¥åœ¨ front-matter ä¸­é€šè¿‡ `foot<span class="hljs-doctag">note:</span> &lt;h2&gt;Reference&lt;/h2&gt;` è¿™ç§å½¢å¼ä¿®æ”¹å•ç‹¬é¡µé¢çš„ header</span><br>    <span class="hljs-comment"># The section title of the footnote, you can also modify the header of a single page in the form of `foot<span class="hljs-doctag">note:</span> &lt;h2&gt;Reference&lt;/h2&gt;` in front-matter</span><br>    <span class="hljs-attr">header:</span> <span class="hljs-string">&#x27;&#x27;</span><br><br>  <span class="hljs-comment"># æ•°å­¦å…¬å¼ï¼Œå¼€å¯ä¹‹å‰éœ€è¦æ›´æ¢ Markdown æ¸²æŸ“å™¨ï¼Œå¦åˆ™å¤æ‚å…¬å¼ä¼šæœ‰å…¼å®¹é—®é¢˜ï¼Œå…·ä½“è¯·è§ï¼šhttps://hexo.fluid-dev.com/docs/guide/##latex-æ•°å­¦å…¬å¼</span><br>  <span class="hljs-comment"># Mathematical formula. If enable, you need to change the Markdown renderer, see: https://hexo.fluid-dev.com/docs/en/guide/#math</span><br>  <span class="hljs-attr">math:</span><br>    <span class="hljs-comment"># å¼€å¯åæ–‡ç« é»˜è®¤å¯ç”¨ï¼Œè‡ªå®šä¹‰é¡µé¢å¦‚éœ€ä½¿ç”¨ï¼Œéœ€åœ¨ Front-matter ä¸­æŒ‡å®š `math: true`</span><br>    <span class="hljs-comment"># If you want to use math on the custom page, you need to set `math: true` in Front-matter</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">false</span><br><br>    <span class="hljs-comment"># å¼€å¯åï¼Œåªæœ‰åœ¨æ–‡ç«  Front-matter é‡ŒæŒ‡å®š `math: true` æ‰ä¼šåœ¨æ–‡ç« é¡µå¯åŠ¨å…¬å¼è½¬æ¢ï¼Œä»¥ä¾¿åœ¨é¡µé¢ä¸åŒ…å«å…¬å¼æ—¶æé«˜åŠ è½½é€Ÿåº¦</span><br>    <span class="hljs-comment"># If true, only set `math: true` in Front-matter will enable math, to load faster when the page does not contain math</span><br>    <span class="hljs-attr">specific:</span> <span class="hljs-literal">false</span><br><br>    <span class="hljs-comment"># Options: mathjax | katex</span><br>    <span class="hljs-attr">engine:</span> <span class="hljs-string">mathjax</span><br><br>  <span class="hljs-comment"># æµç¨‹å›¾ï¼ŒåŸºäº mermaid-jsï¼Œå…·ä½“è¯·è§ï¼šhttps://hexo.fluid-dev.com/docs/guide/#mermaid-æµç¨‹å›¾</span><br>  <span class="hljs-comment"># Flow chart, based on mermaid-js, see: https://hexo.fluid-dev.com/docs/en/guide/#mermaid</span><br>  <span class="hljs-attr">mermaid:</span><br>    <span class="hljs-comment"># å¼€å¯åæ–‡ç« é»˜è®¤å¯ç”¨ï¼Œè‡ªå®šä¹‰é¡µé¢å¦‚éœ€ä½¿ç”¨ï¼Œéœ€åœ¨ Front-matter ä¸­æŒ‡å®š `mermaid: true`</span><br>    <span class="hljs-comment"># If you want to use mermaid on the custom page, you need to set `mermaid: true` in Front-matter</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">false</span><br><br>    <span class="hljs-comment"># å¼€å¯åï¼Œåªæœ‰åœ¨æ–‡ç«  Front-matter é‡ŒæŒ‡å®š `mermaid: true` æ‰ä¼šåœ¨æ–‡ç« é¡µå¯åŠ¨å…¬å¼è½¬æ¢ï¼Œä»¥ä¾¿åœ¨é¡µé¢ä¸åŒ…å«å…¬å¼æ—¶æé«˜åŠ è½½é€Ÿåº¦</span><br>    <span class="hljs-comment"># If true, only set `mermaid: true` in Front-matter will enable mermaid, to load faster when the page does not contain mermaid</span><br>    <span class="hljs-attr">specific:</span> <span class="hljs-literal">false</span><br><br>    <span class="hljs-comment"># See: http://mermaid-js.github.io/mermaid/</span><br>    <span class="hljs-attr">options:</span> &#123; <span class="hljs-attr">theme:</span> <span class="hljs-string">&#x27;default&#x27;</span> &#125;<br><br>  <span class="hljs-comment"># è¯„è®ºæ’ä»¶</span><br>  <span class="hljs-comment"># Comment plugin</span><br>  <span class="hljs-attr">comments:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-comment"># æŒ‡å®šçš„æ’ä»¶ï¼Œéœ€è¦åŒæ—¶è®¾ç½®å¯¹åº”æ’ä»¶çš„å¿…è¦å‚æ•°</span><br>    <span class="hljs-comment"># The specified plugin needs to set the necessary parameters at the same time</span><br>    <span class="hljs-comment"># Options: utterances | disqus | gitalk | valine | waline | changyan | livere | remark42 | twikoo | cusdis | giscus | discuss</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">disqus</span><br><br><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-comment"># è¯„è®ºæ’ä»¶</span><br><span class="hljs-comment"># Comment plugins</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># å¼€å¯è¯„è®ºéœ€è¦å…ˆè®¾ç½®ä¸Šæ–¹ `post: comments: enable: true`ï¼Œç„¶åæ ¹æ® `type` è®¾ç½®ä¸‹æ–¹å¯¹åº”çš„è¯„è®ºæ’ä»¶å‚æ•°</span><br><span class="hljs-comment"># Enable comments need to be set `post: comments: enable: true`, then set the corresponding comment plugin parameters below according to `type`</span><br><span class="hljs-comment">#---------------------------</span><br><br><span class="hljs-comment"># Utterances</span><br><span class="hljs-comment"># åŸºäº GitHub Issues</span><br><span class="hljs-comment"># Based on GitHub Issues</span><br><span class="hljs-comment"># See: https://utteranc.es</span><br><span class="hljs-attr">utterances:</span><br>  <span class="hljs-attr">repo:</span><br>  <span class="hljs-attr">issue_term:</span> <span class="hljs-string">pathname</span><br>  <span class="hljs-attr">label:</span> <span class="hljs-string">utterances</span><br>  <span class="hljs-attr">theme:</span> <span class="hljs-string">github-light</span><br>  <span class="hljs-attr">theme_dark:</span> <span class="hljs-string">github-dark</span><br><br><span class="hljs-comment"># Disqus</span><br><span class="hljs-comment"># åŸºäºç¬¬ä¸‰æ–¹çš„æœåŠ¡ï¼Œå›½å†…ç”¨æˆ·ç›´æ¥ä½¿ç”¨å®¹æ˜“è¢«å¢™ï¼Œå»ºè®®é…åˆ Disqusjs</span><br><span class="hljs-comment"># Based on third-party service</span><br><span class="hljs-comment"># See: https://disqus.com</span><br><span class="hljs-attr">disqus:</span><br>  <span class="hljs-attr">shortname:</span><br>  <span class="hljs-comment"># ä»¥ä¸‹ä¸º Disqusjs æ”¯æŒ, å›½å†…ç”¨æˆ·å¦‚æœæƒ³ä½¿ç”¨ Disqus å»ºè®®é…åˆä½¿ç”¨</span><br>  <span class="hljs-comment"># The following are Disqusjs configurations, please ignore if DisqusJS is not required</span><br>  <span class="hljs-comment"># See: https://github.com/SukkaW/DisqusJS</span><br>  <span class="hljs-attr">disqusjs:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">apikey:</span><br><br><span class="hljs-comment"># Gitalk</span><br><span class="hljs-comment"># åŸºäº GitHub Issues</span><br><span class="hljs-comment"># Based on GitHub Issues</span><br><span class="hljs-comment"># See: https://github.com/gitalk/gitalk#options</span><br><span class="hljs-attr">gitalk:</span><br>  <span class="hljs-attr">clientID:</span><br>  <span class="hljs-attr">clientSecret:</span><br>  <span class="hljs-attr">repo:</span><br>  <span class="hljs-attr">owner:</span><br>  <span class="hljs-attr">admin:</span> [<span class="hljs-string">&#x27;name&#x27;</span>]<br>  <span class="hljs-attr">language:</span> <span class="hljs-string">zh-CN</span><br>  <span class="hljs-attr">labels:</span> [<span class="hljs-string">&#x27;Gitalk&#x27;</span>]<br>  <span class="hljs-attr">perPage:</span> <span class="hljs-number">10</span><br>  <span class="hljs-attr">pagerDirection:</span> <span class="hljs-string">last</span><br>  <span class="hljs-attr">distractionFreeMode:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">createIssueManually:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-comment"># é»˜è®¤ proxy å¯èƒ½ä¼šå¤±æ•ˆï¼Œè§£å†³æ–¹æ³•è¯·è§ä¸‹æ–¹é“¾æ¥</span><br>  <span class="hljs-comment"># The default proxy may be invalid, refer to the links for solutions</span><br>  <span class="hljs-comment"># https://github.com/gitalk/gitalk/issues/429</span><br>  <span class="hljs-comment"># https://github.com/Zibri/cloudflare-cors-anywhere</span><br>  <span class="hljs-attr">proxy:</span> <span class="hljs-string">https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token</span><br><br><span class="hljs-comment"># Valine</span><br><span class="hljs-comment"># åŸºäº LeanCloud</span><br><span class="hljs-comment"># Based on LeanCloud</span><br><span class="hljs-comment"># See: https://valine.js.org/</span><br><span class="hljs-attr">valine:</span><br>  <span class="hljs-attr">appId:</span><br>  <span class="hljs-attr">appKey:</span><br>  <span class="hljs-attr">path:</span> <span class="hljs-string">window.location.pathname</span><br>  <span class="hljs-attr">placeholder:</span><br>  <span class="hljs-attr">avatar:</span> <span class="hljs-string">&#x27;retro&#x27;</span><br>  <span class="hljs-attr">meta:</span> [<span class="hljs-string">&#x27;nick&#x27;</span>, <span class="hljs-string">&#x27;mail&#x27;</span>, <span class="hljs-string">&#x27;link&#x27;</span>]<br>  <span class="hljs-attr">requiredFields:</span> []<br>  <span class="hljs-attr">pageSize:</span> <span class="hljs-number">10</span><br>  <span class="hljs-attr">lang:</span> <span class="hljs-string">&#x27;zh-CN&#x27;</span><br>  <span class="hljs-attr">highlight:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">recordIP:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">serverURLs:</span> <span class="hljs-string">&#x27;&#x27;</span><br>  <span class="hljs-attr">emojiCDN:</span><br>  <span class="hljs-attr">emojiMaps:</span><br>  <span class="hljs-attr">enableQQ:</span> <span class="hljs-literal">false</span><br><br><span class="hljs-comment"># Waline</span><br><span class="hljs-comment"># ä» Valine è¡ç”Ÿè€Œæ¥ï¼Œé¢å¤–å¢åŠ äº†æœåŠ¡ç«¯å’Œå¤šç§åŠŸèƒ½</span><br><span class="hljs-comment"># Derived from Valine, with self-hosted service and new features</span><br><span class="hljs-comment"># See: https://waline.js.org/</span><br><span class="hljs-attr">waline:</span><br>  <span class="hljs-attr">serverURL:</span> <span class="hljs-string">&#x27;&#x27;</span><br>  <span class="hljs-attr">path:</span> <span class="hljs-string">window.location.pathname</span><br>  <span class="hljs-attr">meta:</span> [<span class="hljs-string">&#x27;nick&#x27;</span>, <span class="hljs-string">&#x27;mail&#x27;</span>, <span class="hljs-string">&#x27;link&#x27;</span>]<br>  <span class="hljs-attr">requiredMeta:</span> [<span class="hljs-string">&#x27;nick&#x27;</span>]<br>  <span class="hljs-attr">lang:</span> <span class="hljs-string">&#x27;zh-CN&#x27;</span><br>  <span class="hljs-attr">emoji:</span> [<span class="hljs-string">&#x27;https://cdn.jsdelivr.net/gh/walinejs/emojis/weibo&#x27;</span>]<br>  <span class="hljs-attr">dark:</span> <span class="hljs-string">&#x27;html[data-user-color-scheme=&quot;dark&quot;]&#x27;</span><br>  <span class="hljs-attr">wordLimit:</span> <span class="hljs-number">0</span><br>  <span class="hljs-attr">pageSize:</span> <span class="hljs-number">10</span><br><br><span class="hljs-comment"># ç•…è¨€ Changyan</span><br><span class="hljs-comment"># åŸºäºç¬¬ä¸‰æ–¹çš„æœåŠ¡</span><br><span class="hljs-comment"># Based on third-party service, insufficient support for regions outside China</span><br><span class="hljs-comment"># http://changyan.kuaizhan.com</span><br><span class="hljs-attr">changyan:</span><br>  <span class="hljs-attr">appid:</span> <span class="hljs-string">&#x27;&#x27;</span><br>  <span class="hljs-attr">appkey:</span> <span class="hljs-string">&#x27;&#x27;</span><br><br><span class="hljs-comment"># æ¥å¿…åŠ› Livere</span><br><span class="hljs-comment"># åŸºäºç¬¬ä¸‰æ–¹çš„æœåŠ¡</span><br><span class="hljs-comment"># Based on third-party service</span><br><span class="hljs-comment"># See: https://www.livere.com</span><br><span class="hljs-attr">livere:</span><br>  <span class="hljs-attr">uid:</span> <span class="hljs-string">&#x27;&#x27;</span><br><br><span class="hljs-comment"># Remark42</span><br><span class="hljs-comment"># éœ€è¦è‡ªæ‰˜ç®¡æœåŠ¡ç«¯</span><br><span class="hljs-comment"># Based on self-hosted service</span><br><span class="hljs-comment"># See: https://remark42.com</span><br><span class="hljs-attr">remark42:</span><br>  <span class="hljs-attr">host:</span><br>  <span class="hljs-attr">site_id:</span><br>  <span class="hljs-attr">max_shown_comments:</span> <span class="hljs-number">10</span><br>  <span class="hljs-attr">locale:</span> <span class="hljs-string">zh</span><br>  <span class="hljs-attr">components:</span> [<span class="hljs-string">&#x27;embed&#x27;</span>]<br><br><span class="hljs-comment"># Twikoo</span><br><span class="hljs-comment"># æ”¯æŒè…¾è®¯äº‘ã€Vercelã€Railway ç­‰å¤šç§å¹³å°éƒ¨ç½²</span><br><span class="hljs-comment"># Based on Tencent CloudBase</span><br><span class="hljs-comment"># See: https://twikoo.js.org</span><br><span class="hljs-attr">twikoo:</span><br>  <span class="hljs-attr">envId:</span><br>  <span class="hljs-attr">region:</span> <span class="hljs-string">ap-shanghai</span><br>  <span class="hljs-attr">path:</span> <span class="hljs-string">window.location.pathname</span><br><br><span class="hljs-comment"># Cusdis</span><br><span class="hljs-comment"># åŸºäºç¬¬ä¸‰æ–¹æœåŠ¡æˆ–è‡ªæ‰˜ç®¡æœåŠ¡</span><br><span class="hljs-comment"># Based on third-party or self-hosted service</span><br><span class="hljs-comment"># See https://cusdis.com</span><br><span class="hljs-attr">cusdis:</span><br>  <span class="hljs-attr">host:</span><br>  <span class="hljs-attr">app_id:</span><br>  <span class="hljs-attr">lang:</span> <span class="hljs-string">zh-cn</span><br><br><span class="hljs-comment"># Giscus</span><br><span class="hljs-comment"># åŸºäº GitHub Discussionsï¼Œç±»ä¼¼äº Utterances</span><br><span class="hljs-comment"># Based on GitHub Discussions, similar to Utterances</span><br><span class="hljs-comment"># See: https://giscus.app/</span><br><span class="hljs-attr">giscus:</span><br>  <span class="hljs-attr">repo:</span><br>  <span class="hljs-attr">repo-id:</span><br>  <span class="hljs-attr">category:</span><br>  <span class="hljs-attr">category-id:</span><br>  <span class="hljs-attr">theme-light:</span> <span class="hljs-string">light</span><br>  <span class="hljs-attr">theme-dark:</span> <span class="hljs-string">dark</span><br>  <span class="hljs-attr">mapping:</span> <span class="hljs-string">pathname</span><br>  <span class="hljs-attr">reactions-enabled:</span> <span class="hljs-number">1</span><br>  <span class="hljs-attr">emit-metadata:</span> <span class="hljs-number">0</span><br>  <span class="hljs-attr">input-position:</span> <span class="hljs-string">top</span><br>  <span class="hljs-attr">lang:</span> <span class="hljs-string">zh-CN</span><br><br><span class="hljs-comment"># Discuss</span><br><span class="hljs-comment"># å¤šå¹³å°ã€å¤šæ•°æ®åº“ã€è‡ªæ‰˜ç®¡ã€å…è´¹å¼€æºè¯„è®ºç³»ç»Ÿ</span><br><span class="hljs-comment"># Self-hosted, small size, multi-platform, multi-database, free and open source commenting system</span><br><span class="hljs-comment"># See: https://discuss.js.org</span><br><span class="hljs-attr">discuss:</span><br>  <span class="hljs-attr">serverURLs:</span><br>  <span class="hljs-attr">path:</span> <span class="hljs-string">window.location.pathname</span><br><br><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-comment"># å½’æ¡£é¡µ</span><br><span class="hljs-comment"># Archive Page</span><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-attr">archive:</span><br>  <span class="hljs-attr">banner_img:</span> <span class="hljs-string">/images/page-archives.webp</span><br>  <span class="hljs-attr">banner_img_height:</span> <span class="hljs-number">60</span><br>  <span class="hljs-attr">banner_mask_alpha:</span> <span class="hljs-number">0.3</span><br><br><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-comment"># åˆ†ç±»é¡µ</span><br><span class="hljs-comment"># Category Page</span><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-attr">category:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">banner_img:</span> <span class="hljs-string">/images/page-categories.webp</span><br>  <span class="hljs-attr">banner_img_height:</span> <span class="hljs-number">60</span><br>  <span class="hljs-attr">banner_mask_alpha:</span> <span class="hljs-number">0.3</span><br><br>  <span class="hljs-comment"># åˆ†ç±»çš„æ’åºå­—æ®µï¼Œå‰é¢å¸¦å‡å·æ˜¯å€’åºï¼Œä¸å¸¦å‡å·æ˜¯æ­£åº</span><br>  <span class="hljs-comment"># Sort field for categories, with a minus sign is reverse order</span><br>  <span class="hljs-comment"># Options: length | name</span><br>  <span class="hljs-attr">order_by:</span> <span class="hljs-string">&quot;-length&quot;</span><br><br>  <span class="hljs-comment"># å±‚çº§çš„æŠ˜å æ·±åº¦ï¼Œ0 æ˜¯å…¨éƒ¨æŠ˜å ï¼Œå¤§äº 0 åå¦‚æœå­˜åœ¨å­åˆ†ç±»åˆ™é»˜è®¤å±•å¼€</span><br>  <span class="hljs-comment"># Collapse depth. If 0, all posts collapsed. If greater than 0, it will be expanded by default if there are subcategories</span><br>  <span class="hljs-attr">collapse_depth:</span> <span class="hljs-number">0</span><br><br>  <span class="hljs-comment"># æ–‡ç« çš„æ’åºå­—æ®µï¼Œå‰é¢å¸¦å‡å·æ˜¯å€’åºï¼Œä¸å¸¦å‡å·æ˜¯æ­£åº</span><br>  <span class="hljs-comment"># Sort field for posts, with a minus sign is reverse order</span><br>  <span class="hljs-comment"># Options: date | title | or other field of front-matter</span><br>  <span class="hljs-attr">post_order_by:</span> <span class="hljs-string">&quot;-date&quot;</span><br><br>  <span class="hljs-comment"># å•ä¸ªåˆ†ç±»ä¸­æŠ˜å å±•ç¤ºæ–‡ç« æ•°çš„æœ€å¤§å€¼ï¼Œè¶…è¿‡é™åˆ¶ä¼šæ˜¾ç¤º Moreï¼Œ0 åˆ™ä¸é™åˆ¶</span><br>  <span class="hljs-comment"># The maximum number of posts in a single category. If the limit is exceeded, it will be displayed More. If 0 no limit</span><br>  <span class="hljs-attr">post_limit:</span> <span class="hljs-number">10</span><br><br><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-comment"># æ ‡ç­¾é¡µ</span><br><span class="hljs-comment"># Tag Page</span><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-attr">tag:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">banner_img:</span> <span class="hljs-string">/images/page-tags.webp</span><br>  <span class="hljs-attr">banner_img_height:</span> <span class="hljs-number">80</span><br>  <span class="hljs-attr">banner_mask_alpha:</span> <span class="hljs-number">0.3</span><br>  <span class="hljs-attr">tagcloud:</span><br>    <span class="hljs-attr">min_font:</span> <span class="hljs-number">15</span><br>    <span class="hljs-attr">max_font:</span> <span class="hljs-number">30</span><br>    <span class="hljs-attr">unit:</span> <span class="hljs-string">px</span><br>    <span class="hljs-attr">start_color:</span> <span class="hljs-string">&quot;#e27faa&quot;</span><br>    <span class="hljs-attr">end_color:</span> <span class="hljs-string">&quot;#efff00&quot;</span><br><br><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-comment"># å…³äºé¡µ</span><br><span class="hljs-comment"># About Page</span><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-attr">about:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">banner_img:</span> <span class="hljs-string">/images/page-about.webp</span><br>  <span class="hljs-attr">banner_img_height:</span> <span class="hljs-number">60</span><br>  <span class="hljs-attr">banner_mask_alpha:</span> <span class="hljs-number">0.3</span><br>  <span class="hljs-attr">avatar:</span> <span class="hljs-string">/images/logo.jpg</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;Inyxin&quot;</span><br>  <span class="hljs-attr">intro:</span> <span class="hljs-string">&quot;An elegant theme for Hexo&quot;</span><br>  <span class="hljs-comment"># æ›´å¤šå›¾æ ‡å¯ä» https://hexo.fluid-dev.com/docs/icon/ æŸ¥æ‰¾ï¼Œ`class` ä»£è¡¨å›¾æ ‡çš„ css classï¼Œæ·»åŠ  `qrcode` åï¼Œå›¾æ ‡ä¸å†æ˜¯é“¾æ¥è€Œæ˜¯æ‚¬æµ®äºŒç»´ç </span><br>  <span class="hljs-comment"># More icons can be found from https://hexo.fluid-dev.com/docs/en/icon/  `class` is the css class of the icon. If adding `qrcode`, The icon is no longer a link, but a hovering QR code</span><br>  <span class="hljs-attr">icons:</span><br>    <span class="hljs-bullet">-</span> &#123; <span class="hljs-attr">class:</span> <span class="hljs-string">&quot;iconfont icon-github-fill&quot;</span>, <span class="hljs-attr">link:</span> <span class="hljs-string">&quot;https://github.com&quot;</span>, <span class="hljs-attr">tip:</span> <span class="hljs-string">&quot;GitHub&quot;</span> &#125;<br>    <span class="hljs-bullet">-</span> &#123; <span class="hljs-attr">class:</span> <span class="hljs-string">&quot;iconfont icon-gitee-fill&quot;</span>, <span class="hljs-attr">link:</span> <span class="hljs-string">&quot;https://gitee.com/inyxin/inyxin&quot;</span>, <span class="hljs-attr">tip:</span> <span class="hljs-string">&quot;Gitee&quot;</span> &#125;<br>    <span class="hljs-bullet">-</span> &#123; <span class="hljs-attr">class:</span> <span class="hljs-string">&quot;iconfont icon-qq-fill&quot;</span>, <span class="hljs-attr">qrcode:</span> <span class="hljs-string">&quot;/images/qrcode-qq.jpg&quot;</span>&#125;<br><br><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-comment"># è‡ªå®šä¹‰é¡µ</span><br><span class="hljs-comment"># Custom Page</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># é€šè¿‡ hexo new page å‘½ä»¤åˆ›å»ºçš„é¡µé¢</span><br><span class="hljs-comment"># Custom Page through `hexo new page`</span><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-attr">page:</span><br>  <span class="hljs-attr">banner_img:</span> <span class="hljs-string">/images/page-tags.webp</span><br>  <span class="hljs-attr">banner_img_height:</span> <span class="hljs-number">60</span><br>  <span class="hljs-attr">banner_mask_alpha:</span> <span class="hljs-number">0.3</span><br><br><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-comment"># 404é¡µ</span><br><span class="hljs-comment"># 404 Page</span><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-attr">page404:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">banner_img:</span> <span class="hljs-string">/img/default.png</span><br>  <span class="hljs-attr">banner_img_height:</span> <span class="hljs-number">85</span><br>  <span class="hljs-attr">banner_mask_alpha:</span> <span class="hljs-number">0.3</span><br>  <span class="hljs-comment"># é‡å®šå‘åˆ°é¦–é¡µçš„å»¶è¿Ÿ(æ¯«ç§’)</span><br>  <span class="hljs-comment"># Delay in redirecting to home page (milliseconds)</span><br>  <span class="hljs-attr">redirect_delay:</span> <span class="hljs-number">5000</span><br><br><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-comment"># å‹é“¾é¡µ</span><br><span class="hljs-comment"># Links Page</span><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-attr">links:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">banner_img:</span> <span class="hljs-string">/images/page-links.webp</span><br>  <span class="hljs-attr">banner_img_height:</span> <span class="hljs-number">60</span><br>  <span class="hljs-attr">banner_mask_alpha:</span> <span class="hljs-number">0.3</span><br>  <span class="hljs-comment"># å‹é“¾çš„æˆå‘˜é¡¹</span><br>  <span class="hljs-comment"># Member item of page</span><br>  <span class="hljs-attr">items:</span><br>    <span class="hljs-bullet">-</span> &#123;<br>      <span class="hljs-attr">title:</span> <span class="hljs-string">&quot;Fluid Blog&quot;</span>,<br>      <span class="hljs-attr">intro:</span> <span class="hljs-string">&quot;ä¸»é¢˜åšå®¢&quot;</span>,<br>      <span class="hljs-attr">link:</span> <span class="hljs-string">&quot;https://hexo.fluid-dev.com/&quot;</span>,<br>      <span class="hljs-attr">avatar:</span> <span class="hljs-string">&quot;/img/favicon.png&quot;</span><br>    &#125;<br>    <span class="hljs-bullet">-</span> &#123;<br>      <span class="hljs-attr">title:</span> <span class="hljs-string">&quot;Fluid Docs&quot;</span>,<br>      <span class="hljs-attr">intro:</span> <span class="hljs-string">&quot;ä¸»é¢˜ä½¿ç”¨æŒ‡å—&quot;</span>,<br>      <span class="hljs-attr">link:</span> <span class="hljs-string">&quot;https://hexo.fluid-dev.com/docs/&quot;</span>,<br>      <span class="hljs-attr">avatar:</span> <span class="hljs-string">&quot;/img/favicon.png&quot;</span><br>    &#125;<br>    <span class="hljs-bullet">-</span> &#123;<br>      <span class="hljs-attr">title:</span> <span class="hljs-string">&quot;Fluid Repo&quot;</span>,<br>      <span class="hljs-attr">intro:</span> <span class="hljs-string">&quot;ä¸»é¢˜ GitHub ä»“åº“&quot;</span>,<br>      <span class="hljs-attr">link:</span> <span class="hljs-string">&quot;https://github.com/fluid-dev/hexo-theme-fluid&quot;</span>,<br>      <span class="hljs-attr">avatar:</span> <span class="hljs-string">&quot;/img/favicon.png&quot;</span><br>    &#125;<br><br>  <span class="hljs-comment"># å½“æˆå‘˜å¤´åƒåŠ è½½å¤±è´¥æ—¶ï¼Œæ›¿æ¢ä¸ºæŒ‡å®šå›¾ç‰‡</span><br>  <span class="hljs-comment"># When the member avatar fails to load, replace the specified image</span><br>  <span class="hljs-attr">onerror_avatar:</span> <span class="hljs-string">/img/avatar.png</span><br><br>  <span class="hljs-comment"># å‹é“¾ä¸‹æ–¹è‡ªå®šä¹‰åŒºåŸŸï¼Œæ”¯æŒ HTMLï¼Œå¯æ’å…¥ä¾‹å¦‚ç”³è¯·å‹é“¾çš„æ–‡å­—</span><br>  <span class="hljs-comment"># Custom content at the bottom of the links</span><br>  <span class="hljs-attr">custom:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-attr">content:</span> <span class="hljs-string">&#x27;&lt;hr&gt;&lt;p&gt;åœ¨ä¸‹æ–¹ç•™è¨€ç”³è¯·åŠ å…¥æˆ‘çš„å‹é“¾ï¼ŒæŒ‰å¦‚ä¸‹æ ¼å¼æä¾›ä¿¡æ¯ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;åšå®¢åï¼šFluid&lt;/li&gt;&lt;li&gt;ç®€ä»‹ï¼šFluid ä¸»é¢˜å®˜æ–¹åšå®¢&lt;/li&gt;&lt;li&gt;é“¾æ¥ï¼šhttps://hexo.fluid-dev.com&lt;/li&gt;&lt;li&gt;å›¾ç‰‡ï¼šhttps://hexo.fluid-dev.com/img/favicon.png&lt;/li&gt;&lt;/ul&gt;&#x27;</span><br><br>  <span class="hljs-comment"># è¯„è®ºæ’ä»¶</span><br>  <span class="hljs-comment"># Comment plugin</span><br>  <span class="hljs-attr">comments:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-comment"># æŒ‡å®šçš„æ’ä»¶ï¼Œéœ€è¦åŒæ—¶è®¾ç½®å¯¹åº”æ’ä»¶çš„å¿…è¦å‚æ•°</span><br>    <span class="hljs-comment"># The specified plugin needs to set the necessary parameters at the same time</span><br>    <span class="hljs-comment"># Options: utterances | disqus | gitalk | valine | waline | changyan | livere | remark42 | twikoo | cusdis | giscus | discuss</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">disqus</span><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å·¥å…·</category>
      
      <category>Markdown</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
      <tag>Markdown</tag>
      
      <tag>Theme</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>èŠ±ç”Ÿå£³</title>
    <link href="/post/d2322c4d3105/"/>
    <url>/post/d2322c4d3105/</url>
    
    <content type="html"><![CDATA[<p><code>åƒé‡Œä¹‹è¡Œï¼Œå§‹äºè¶³ä¸‹ã€‚</code></p><p><a href="https://hsk.oray.com/download">èŠ±ç”Ÿå£³å®¢æˆ·ç«¯å®˜æ–¹ä¸‹è½½ - è´é”èŠ±ç”Ÿå£³å®˜ç½‘ (oray.com)</a></p><p>ä¼˜ç‚¹: å›ºå®šIP</p><p>ç¼ºç‚¹: é™æµ1M , åªæœ‰2æ¡éš§é“</p><h1 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h1><p><img src="image-20240706164818305.png" alt="image-20240706164818305"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">wget <span class="hljs-string">&quot;https://dl.oray.com/hsk/linux/phddns_5.3.0_amd64.deb&quot;</span> -O phddns_5.3.0_amd64.deb<br></code></pre></td></tr></table></figure><p><a href="https://service.oray.com/question/11630.html">Linuxç‰ˆä½¿ç”¨æ•™ç¨‹-è´é”å®˜ç½‘ (oray.com)</a></p><h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@beelink:~<span class="hljs-comment"># apt install ./phddns_5.3.0_amd64.deb</span><br>æ­£åœ¨è¯»å–è½¯ä»¶åŒ…åˆ—è¡¨... å®Œæˆ<br>æ­£åœ¨åˆ†æè½¯ä»¶åŒ…çš„ä¾èµ–å…³ç³»æ ‘... å®Œæˆ<br>æ­£åœ¨è¯»å–çŠ¶æ€ä¿¡æ¯... å®Œæˆ<br>æ³¨æ„ï¼Œé€‰ä¸­ <span class="hljs-string">&#x27;phddns&#x27;</span> è€Œé <span class="hljs-string">&#x27;./phddns_5.3.0_amd64.deb&#x27;</span><br>ä¸‹åˆ—ã€æ–°ã€‘è½¯ä»¶åŒ…å°†è¢«å®‰è£…ï¼š<br>  phddns<br>å‡çº§äº† 0 ä¸ªè½¯ä»¶åŒ…ï¼Œæ–°å®‰è£…äº† 1 ä¸ªè½¯ä»¶åŒ…ï¼Œè¦å¸è½½ 0 ä¸ªè½¯ä»¶åŒ…ï¼Œæœ‰ 48 ä¸ªè½¯ä»¶åŒ…æœª è¢«å‡çº§ã€‚<br>éœ€è¦ä¸‹è½½ 0 B/270 kB çš„å½’æ¡£ã€‚<br>è§£å‹ç¼©åä¼šæ¶ˆè€— 12.5 MB çš„é¢å¤–ç©ºé—´ã€‚<br>è·å–:1 /root/phddns_5.3.0_amd64.deb phddns amd64 5.3.0 [270 kB]<br>æ­£åœ¨é€‰ä¸­æœªé€‰æ‹©çš„è½¯ä»¶åŒ… phddnsã€‚<br>(æ­£åœ¨è¯»å–æ•°æ®åº“ ... ç³»ç»Ÿå½“å‰å…±å®‰è£…æœ‰ 224640 ä¸ªæ–‡ä»¶å’Œç›®å½•ã€‚)<br>å‡†å¤‡è§£å‹ /root/phddns_5.3.0_amd64.deb  ...<br>æ­£åœ¨è§£å‹ phddns (5.3.0) ...<br>æ­£åœ¨è®¾ç½® phddns (5.3.0) ...<br><span class="hljs-keyword">in</span> systemv<br>Installation, please later...<br>Successful installation of Phddns Service.<br><br> +--------------------------------------------------+<br> |             Oray PeanutHull Linux 5.3.0          |<br> +--------------------------------------------------+<br> |  SN: orayf7285ff174f3   Default password: admin  |<br> +--------------------------------------------------+<br> |    Remote Management Address http://b.oray.com   |<br> +--------------------------------------------------+<br>N: ç”±äºæ–‡ä»¶<span class="hljs-string">&#x27;/root/phddns_5.3.0_amd64.deb&#x27;</span>æ— æ³•è¢«ç”¨æˆ·<span class="hljs-string">&#x27;_apt&#x27;</span>è®¿é—®ï¼Œå·²è„±ç¦»æ²™ç›’å¹¶ ææƒä¸ºæ ¹ç”¨æˆ·æ¥è¿›è¡Œä¸‹è½½ã€‚ - pkgAcquire::Run (13: æƒé™ä¸å¤Ÿ)<br>root@beelink:~<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><h3 id="å¸è½½"><a href="#å¸è½½" class="headerlink" title="å¸è½½"></a>å¸è½½</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@beelink:~<span class="hljs-comment"># apt remove phddns</span><br>æ­£åœ¨è¯»å–è½¯ä»¶åŒ…åˆ—è¡¨... å®Œæˆ<br>æ­£åœ¨åˆ†æè½¯ä»¶åŒ…çš„ä¾èµ–å…³ç³»æ ‘... å®Œæˆ<br>æ­£åœ¨è¯»å–çŠ¶æ€ä¿¡æ¯... å®Œæˆ<br>ä¸‹åˆ—è½¯ä»¶åŒ…å°†è¢«ã€å¸è½½ã€‘ï¼š<br>  phddns<br>å‡çº§äº† 0 ä¸ªè½¯ä»¶åŒ…ï¼Œæ–°å®‰è£…äº† 0 ä¸ªè½¯ä»¶åŒ…ï¼Œè¦å¸è½½ 1 ä¸ªè½¯ä»¶åŒ…ï¼Œæœ‰ 48 ä¸ªè½¯ä»¶åŒ…æœª è¢«å‡çº§ã€‚<br>è§£å‹ç¼©åå°†ä¼šç©ºå‡º 12.5 MB çš„ç©ºé—´ã€‚<br>æ‚¨å¸Œæœ›ç»§ç»­æ‰§è¡Œå—ï¼Ÿ [Y/n] y<br>(æ­£åœ¨è¯»å–æ•°æ®åº“ ... ç³»ç»Ÿå½“å‰å…±å®‰è£…æœ‰ 224651 ä¸ªæ–‡ä»¶å’Œç›®å½•ã€‚)<br>æ­£åœ¨å¸è½½ phddns (5.3.0) ...<br>phdaemon: æœªæ‰¾åˆ°è¿›ç¨‹<br>phtunnel: æœªæ‰¾åˆ°è¿›ç¨‹<br>phddns_mini_httpd: æœªæ‰¾åˆ°è¿›ç¨‹<br>Remove Phtunnel Service Success.<br>Thanks For Using Phtunnel Service.<br>root@beelink:~<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><h1 id="æ‰©å±•åŠŸèƒ½"><a href="#æ‰©å±•åŠŸèƒ½" class="headerlink" title="æ‰©å±•åŠŸèƒ½"></a>æ‰©å±•åŠŸèƒ½</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@beelink:~<span class="hljs-comment"># phddns</span><br>Phtunnel Serive called with  unknown argument<br>(phddns  |start|status|stop|restart|reset|<span class="hljs-built_in">enable</span>|<span class="hljs-built_in">disable</span>|version)<br></code></pre></td></tr></table></figure><ul><li>start å¯åŠ¨</li><li>stop åœæ­¢</li><li>status çŠ¶æ€</li><li>restart é‡å¯</li><li>reset é‡ç½®</li><li>enable å¼€æœºè‡ªå¯</li><li>disable å–æ¶ˆå¼€æœºè‡ªå¯</li><li>version æŸ¥çœ‹ç‰ˆæœ¬å·</li></ul><p><strong>æ³¨æ„: é™¤phddns versionå‘½ä»¤ä¸éœ€è¦ç®¡ç†å‘˜æƒé™å¤–,å…¶ä»–å‘½ä»¤å‡éœ€è¦ç®¡ç†å‘˜æƒé™</strong></p><p><img src="image-20240706165746108.png" alt="image-20240706165746108"></p><h1 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h1><p>1ã€æµè§ˆå™¨è®¿é—®<a href="http://b.oray.com/">http://b.oray.com</a> ï¼Œè¾“å…¥èŠ±ç”Ÿå£³Linux 5.0åœ¨å®‰è£…æ—¶äº§ç”Ÿ<strong>SNç ä¸é»˜è®¤ç™»å½•å¯†ç admin</strong>ç™»å½•ã€‚</p><p><img src="image-20240706165910674.png" alt="image-20240706165910674"></p><p><img src="image-20240706165936080.png" alt="image-20240706165936080"></p><p><img src="image-20240706170003456.png" alt="image-20240706170003456"></p><p>æ¿€æ´»æˆåŠŸåå°±å¯ä»¥æ­£å¸¸ä½¿ç”¨äº†</p><h1 id="æ·»åŠ æ˜ å°„"><a href="#æ·»åŠ æ˜ å°„" class="headerlink" title="æ·»åŠ æ˜ å°„"></a>æ·»åŠ æ˜ å°„</h1><table><thead><tr><th>é€‰é¡¹</th><th>æè¿°</th></tr></thead><tbody><tr><td>åº”ç”¨åç§°</td><td>è‡ªå®šä¹‰</td></tr><tr><td>åº”ç”¨å›¾æ ‡</td><td>è‡ªè¡Œé€‰æ‹©</td></tr><tr><td>æ˜ å°„ç±»å‹</td><td>é€‰æ‹©TCP</td></tr><tr><td>æ˜ å°„æ¨¡æ¿</td><td>æš‚ä¸é€‰æ‹©æ¨¡æ¿</td></tr><tr><td>å¤–ç½‘<a href="https://domain.oray.com/">åŸŸå</a></td><td>é€‰æ‹©ç”¨ä½œå¤–ç½‘è®¿é—®çš„åŸŸå</td></tr><tr><td>å¤–ç½‘ç«¯å£</td><td>é€‰æ‹©åŠ¨æ€ç«¯å£</td></tr><tr><td>å†…ç½‘ä¸»æœº</td><td>æ˜ å°„çš„Ubuntuç³»ç»Ÿå†…ç½‘IPåœ°å€</td></tr><tr><td>å†…ç½‘ç«¯å£</td><td>æ˜ å°„çš„æœåŠ¡ç±»å‹å¯¹åº”ç«¯å£22</td></tr><tr><td>è®¿é—®æ§åˆ¶</td><td>è®¾ç½®åœ¨æŒ‡å®šæ¡ä»¶ä¸‹æ‰å¯è®¿é—®æ˜ å°„ , æå‡åº”ç”¨å®‰å…¨ã€‚é’ˆå¯¹ç½‘é¡µç±»æ˜ å°„å¯æ”¯æŒè®¾ç½®è®¿é—®å¯†ç </td></tr><tr><td>å¸¦å®½</td><td>è´­ä¹°æ˜ å°„å¸¦å®½åï¼Œå¯æ”¯æŒç»™æ˜ å°„åˆ†é…é¢å¤–å¸¦å®½ï¼Œè¿™é‡Œä¿å­˜é»˜è®¤</td></tr><tr><td>å¤œé—´å¸¦å®½</td><td>18:00-æ¬¡æ—¥8:00å¸¦å®½é€Ÿåº¦æå‡100%ï¼Œé€Ÿåº¦ä¸ä½äº5Mbpsï¼›å¸¦å®½åŸºæ•°è¶Šå¤§ï¼Œå¤œé—´è¶Šå¿«</td></tr></tbody></table><p><a href="https://console.hsk.oray.com/forward">è´é”èŠ±ç”Ÿå£³ç®¡ç† - å†…ç½‘ç©¿é€ (oray.com)</a></p><p><img src="image-20240706170558042.png" alt="image-20240706170558042"></p><p><strong>å†…ç½‘ä¸»æœº</strong> : 127.0.0.1ä¹Ÿè¡Œ</p><p>è®¿é—®éƒ¨ç½²åœ¨linux 80 ç«¯å£ä¸Šçš„nginx </p><p><img src="image-20240706172025539.png" alt="image-20240706172025539"></p><p>ç©¿é€æˆåŠŸ</p>]]></content>
    
    
    <categories>
      
      <category>å·¥å…·</category>
      
      <category>å†…ç½‘ç©¿é€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å†…ç½‘ç©¿é€</tag>
      
      <tag>èŠ±ç”Ÿå£³</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Cpolar-ä½¿ç”¨æ•™ç¨‹</title>
    <link href="/post/cb717c9eae02/"/>
    <url>/post/cb717c9eae02/</url>
    
    <content type="html"><![CDATA[<p><code>åƒé‡Œä¹‹è¡Œï¼Œå§‹äºè¶³ä¸‹ã€‚</code></p><p><a href="https://dashboard.cpolar.com/">cpolar - secure introspectable tunnels to localhost</a></p><p><strong>ä¼˜ç‚¹</strong>: ä¸é™æµé‡ , 4 æ¡éš§é“</p><p><strong>ç¼ºç‚¹</strong>: CPU å ç”¨é«˜ , éšæœº IP</p><h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">curl</span> <span class="hljs-literal">-L</span> https://www.cpolar.com/<span class="hljs-keyword">static</span>/downloads/<span class="hljs-built_in">install-release</span><span class="hljs-literal">-cpolar</span>.sh | sudo bash<br><br></code></pre></td></tr></table></figure><p><img src="image-20240706160413788.png" alt="image-20240706160413788"></p><h3 id="æŸ¥çœ‹ç‰ˆæœ¬"><a href="#æŸ¥çœ‹ç‰ˆæœ¬" class="headerlink" title="æŸ¥çœ‹ç‰ˆæœ¬"></a>æŸ¥çœ‹ç‰ˆæœ¬</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">inyxin<span class="hljs-meta">@beelink</span>:~$ cpolar version<br>cpolar version <span class="hljs-number">3.3</span><span class="hljs-number">.12</span><br></code></pre></td></tr></table></figure><h3 id="token-è®¤è¯"><a href="#token-è®¤è¯" class="headerlink" title="token è®¤è¯"></a>token è®¤è¯</h3><p>ç™»å½• <a href="https://dashboard.cpolar.com/get-started">cpolar å®˜ç½‘åå°</a>ï¼Œç‚¹å‡»å·¦ä¾§çš„éªŒè¯ï¼ŒæŸ¥çœ‹è‡ªå·±çš„è®¤è¯ tokenï¼Œä¹‹åå°† token è´´åœ¨å‘½ä»¤è¡Œé‡Œ</p><p><img src="image-20240706160658210.png" alt="image-20240706160658210"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">inyxin@beelink:~$ cpolar authtoken YWVmMDQ0NGEtMTEyZC00Yjg2LTk4ZjktZDRlOThi<br>Authtoken saved to configuration file: /usr/local/etc/cpolar/cpolar.yml<br></code></pre></td></tr></table></figure><h3 id="ç®€å•ç©¿é€æµ‹è¯•ä¸€ä¸‹"><a href="#ç®€å•ç©¿é€æµ‹è¯•ä¸€ä¸‹" class="headerlink" title="ç®€å•ç©¿é€æµ‹è¯•ä¸€ä¸‹"></a>ç®€å•ç©¿é€æµ‹è¯•ä¸€ä¸‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">cpolar <span class="hljs-number">9998</span><br>    cpolar by <span class="hljs-meta">@bestexpresser</span>                                    (Ctrl+C to quit)                                                                            Tunnel Status       online<br>Account             <span class="hljs-title function_">inyxin</span> <span class="hljs-params">(Plan: Free)</span><br>Version             <span class="hljs-number">3.12</span>/<span class="hljs-number">3.22</span><br>Web Interface       <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">4040</span><br>Forwarding          http:<span class="hljs-comment">//31526c8c.r25.cpolar.top -&gt; http://localhost: 9998 Forwarding          https://31526c8c.r25.cpolar.top -&gt; http://localhost: 9998# Conn              0</span><br>Avg Conn Time       <span class="hljs-number">0.</span>00ms                                 <br>    <br>    <br></code></pre></td></tr></table></figure><p>ç©¿é€æˆåŠŸ , åªæ˜¯ IP ä¸å›ºå®š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">https:<span class="hljs-comment">//31526c8c.r25.cpolar.top/#/</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å·¥å…·</category>
      
      <category>å†…ç½‘ç©¿é€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Cpolar</tag>
      
      <tag>å†…ç½‘ç©¿é€</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexoä¸­Typeroå›¾ç‰‡æ’å…¥é—®é¢˜</title>
    <link href="/post/8fc22e81-ab43-4043-aef1-e9092fc59e87/"/>
    <url>/post/8fc22e81-ab43-4043-aef1-e9092fc59e87/</url>
    
    <content type="html"><![CDATA[<p><strong><a href="https://hexo.io/zh-cn/">Hexo å®˜ç½‘</a></strong></p><p><strong>Question :</strong> </p><p>â€‹hexo å¤„ç† æœ¬åœ°ç¼–å†™çš„å¸¦æœ‰å›¾ç‰‡çš„markdownæ—¶, æ— æ³•æ­£ç¡®åŠ è½½å›¾ç‰‡çš„è·¯å¾„</p><p><strong>Solution :</strong></p><ol><li><p>å®‰è£…æ’ä»¶ <code>hexo-typora-img</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install hexo-typora-img --save<br></code></pre></td></tr></table></figure><p><img src="image-20240706153100037.png" alt="image-20240706153100037"></p></li><li><p>ä¿®æ”¹_config.yml</p><p><img src="image-20240706153226789.png" alt="image-20240706153226789"></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">post_asset_folder:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#å¯ç”¨ èµ„æºæ–‡ä»¶å¤¹</span><br><span class="hljs-attr">relative_link:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#æŠŠé“¾æ¥æ”¹ä¸ºä¸æ ¹ç›®å½•çš„ç›¸å¯¹ä½å€</span><br></code></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹typoraå›¾ç‰‡é…ç½®</p></li></ol><p><img src="image-20240706145214903.png" alt="image-20240706145214903"></p><p>è¿™ç§åšæ³• å°†å½“å‰ç›®å½•ä¸‹ ä¸ <strong>abc.md</strong> åŒåçš„æ–‡ä»¶å¤¹ä½œä¸º <strong>abc</strong> çš„èµ„æºç›®å½•</p>]]></content>
    
    
    <categories>
      
      <category>å·¥å…·</category>
      
      <category>Markdown</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
      <tag>Markdown</tag>
      
      <tag>Typora</tag>
      
      <tag>Bug</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Typero v1.8.10 ç ´è§£</title>
    <link href="/post/0d82c848-4ee7-4650-b0ee-ac9f4aef2ed9/"/>
    <url>/post/0d82c848-4ee7-4650-b0ee-ac9f4aef2ed9/</url>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h2 id="Download"><a href="#Download" class="headerlink" title="Download"></a>Download</h2><p><a href="https://pan.baidu.com/share/init?surl=AXfxqM9KBSp7fvbpkeQ8KA&pwd=9sla"> ğŸ‘‰ç™¾åº¦ç½‘ç›˜ä¸‹è½½ </a></p><h2 id="è§£å‹"><a href="#è§£å‹" class="headerlink" title="è§£å‹"></a>è§£å‹</h2><p><strong>è§£å‹å¯†ç </strong></p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lasso">www.ittel.<span class="hljs-literal">cn</span><br></code></pre></td></tr></table></figure><p><img src="image-20240706144336808.png" alt="image-20240706144336808"></p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p><img src="image-20240706144510255.png" alt="image-20240706144510255"></p><h2 id="æ¿€æ´»"><a href="#æ¿€æ´»" class="headerlink" title="æ¿€æ´»"></a>æ¿€æ´»</h2><h3 id="æ–¹å¼1-äº²æµ‹å¯è¡Œ"><a href="#æ–¹å¼1-äº²æµ‹å¯è¡Œ" class="headerlink" title="æ–¹å¼1 (äº²æµ‹å¯è¡Œ)"></a>æ–¹å¼1 (äº²æµ‹å¯è¡Œ)</h3><p>å°† <code>ittel/winmm.dll</code> å¤åˆ¶åˆ°Typoraå®‰è£…ç›®å½•ä¸‹</p><p><img src="image-20240706150128143.png" alt="image-20240706150128143"></p><p> <img src="image-20240706145801712.png" alt="image-20240706145801712"></p><p>æœ€åé‡å¯ æŸ¥çœ‹è®¸å¯è¯</p><p><img src="image-20240706150207507.png" alt="image-20240706150207507"></p><h3 id="æ–¹å¼2-æˆ‘ä¸è¡Œ"><a href="#æ–¹å¼2-æˆ‘ä¸è¡Œ" class="headerlink" title="æ–¹å¼2  (æˆ‘ä¸è¡Œ)"></a>æ–¹å¼2  (æˆ‘ä¸è¡Œ)</h3><p>How to use?</p><ol><li><p>è¿è¡Œ typora-setup-x64-1.7.0-dev-cracked.exe å®‰è£…Typora</p></li><li><p>è¿è¡Œ LicenseGen.exe è·å¾—æ¿€æ´»ç </p><p><img src="image-20240706144737512.png" alt="image-20240706144737512"></p></li><li><p>è¾“å…¥ä½ çš„é‚®ç®±å’Œå¾—åˆ°çš„æ¿€æ´»ç </p><p><img src="image-20240706144851917.png" alt="image-20240706144851917"></p></li><li><p>å®Œç¾æ¿€æ´»ï¼</p></li></ol><p>è¿™é‡Œä¹Ÿæä¾›å‡ ä¸ªå¯ä»¥ç”¨çš„æ¿€æ´»ç </p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">VMLM7G</span>-<span class="hljs-number">2</span>A45QN-DBM3UZ-GSC7U3<br><span class="hljs-attribute">NXYAC8</span>-NQLVG3-<span class="hljs-number">4</span>ZMB4Z-W4APQA<br><span class="hljs-attribute">7UMJ6D</span>-BWHGKL-KD7ZN9-DNFA3E<br><span class="hljs-attribute">6TFNEN</span>-EFC3MK-QC5VC7-XHWY6A<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å·¥å…·</category>
      
      <category>Markdown</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Typora</tag>
      
      <tag>ç ´è§£</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo Quick Start</title>
    <link href="/post/a6c23c07bd1b/"/>
    <url>/post/a6c23c07bd1b/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">hexo generate<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    <categories>
      
      <category>å·¥å…·</category>
      
      <category>Markdown</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
      <tag>Markdown</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è®¡ç®—æœºå›¾å½¢å­¦æœŸæœ«å¤ä¹ é¢˜</title>
    <link href="/post/9ae56c810397/"/>
    <url>/post/9ae56c810397/</url>
    
    <content type="html"><![CDATA[<p><strong>å•é¡¹é€‰æ‹©é¢˜ï¼š</strong></p><p>1ï¼è®¡ç®—æœºçš„æœ€å°å­˜å‚¨å•ä½æ˜¯   A    ã€‚</p><p>  Aï¼ ä½  Bï¼ å­—èŠ‚   Cï¼ å­—  Dï¼ åŒå­— </p><p>2ï¼å…³äºè®¡ç®—æœºå›¾å½¢å­¦ç ”ç©¶å†…å®¹ï¼Œä¸æ­£ç¡®çš„è¯´æ³•æ˜¯    D ã€‚</p><p>  Aï¼ å‡ ä½•æ¨¡å‹æ„é€ åŠå›¾å½¢ç”ŸæˆæŠ€æœ¯       Bï¼ å›¾å½¢çš„æ“ä½œä¸å¤„ç†æ–¹æ³•  </p><p>Cï¼ å›¾å½¢ä¿¡æ¯çš„å­˜å‚¨ã€æ£€ç´¢ä¸äº¤æ¢æŠ€æœ¯   Dï¼ äººæœºäº¤äº’åŠç”¨æˆ·ä¸²è”æŠ€æœ¯</p><ol start="3"><li>C&#x2F;C++ Windows åº”ç”¨ç¨‹åºçš„å…¥å£å‡½æ•°åç§°æ˜¯    B   ã€‚</li></ol><p>Aï¼ main    Bï¼ WinMain    Cï¼ mian     Dï¼ winMain</p><ol start="4"><li>æœ¬å­¦æœŸçš„è®¡ç®—æœºå›¾å½¢å­¦è¯¾ç¨‹é€‰ç”¨çš„ç¼–ç¨‹è¯­è¨€æ˜¯   A   ã€‚</li></ol><p>Aï¼ C&#x2F;C++      Bï¼ Java     Cï¼ C#      Dï¼ Python</p><ol start="5"><li>ä»¥ä¸‹å±äºæœ¬è¯¾ç¨‹é€‰ç”¨çš„ç¼–ç¨‹è¯­è¨€çš„ç‰¹ç‚¹æ˜¯   B    ã€‚</li></ol><p>Aï¼ ä¸æ”¯æŒå¤šç»§æ‰¿    Bï¼æ‰§è¡Œæ•ˆç‡é«˜    </p><p>Cï¼ éœ€è¦è§£é‡Šæ‰§è¡Œ    Dï¼ ä¸é€‚åˆç¼–å†™ç³»ç»Ÿè½¯ä»¶</p><ol start="6"><li>åœ¨Win32 Applicationå¹³å°ä¸Šç»˜åˆ¶å›¾å½¢çš„ç±»å‹æ˜¯   A   ã€‚</li></ol><p>Aï¼ HDCâ€‚â€‚â€‚â€‚â€‚â€‚Bï¼DCCâ€‚â€‚â€‚â€‚â€‚â€‚Cï¼PDCâ€‚â€‚â€‚â€‚â€‚â€‚â€‚Dï¼CDD</p><ol start="7"><li>æœ¬å­¦æœŸæœ¬è¯¾ç¨‹ä»‹ç»çš„ç»˜åˆ¶ç›´çº¿æ®µçš„ç®—æ³•å…±æœ‰    D  ç§ã€‚</li></ol><p>Aï¼ 1â€‚â€‚â€‚â€‚â€‚â€‚Bï¼ 2â€‚â€‚â€‚â€‚â€‚â€‚Cï¼ 3â€‚â€‚â€‚â€‚â€‚â€‚â€‚Dï¼ 4</p><p>8ï¼å¹³é¢ç›´è§’åæ ‡ç³»çš„ç¬¬ä¸€è±¡é™æœ‰ä¸¤ç‚¹Aï¼ˆx0,y0ï¼‰ã€Bï¼ˆx1,y1ï¼‰ï¼Œå…¶ä¸­x0ã€y0ã€x1ã€y1å‡æ˜¯æ­£æ•´æ•°ï¼Œåˆ™ç”¨é€ç‚¹æ¯”è¾ƒæ³•ç»˜åˆ¶ç›´çº¿æ®µABå…±éœ€æ‰§è¡Œ   A  æ¬¡ç”»ç‚¹å‘½ä»¤ã€‚</p><p>A. | x1-x0| + | y1-y0| + 1    B. | x1-x0| + | y1-y0| </p><p>C. | x1-x0| + | y1-y0| - 1     D. æ— æ³•ç¡®å®š</p><p>9ï¼è‹¥ç”¨é€ç‚¹æ¯”è¾ƒæ³•åœ¨å¹³é¢ç›´è§’åæ ‡ç³»çš„ç¬¬ä¸€è±¡é™å†…ç»˜åˆ¶ç›´çº¿æ®µï¼Œåˆ™éœ€è¦è¯¥çº¿æ®µçš„æ–œç‡Kçš„ç»å¯¹å€¼   A   ã€‚</p><p>A. â‰¥0  B. â‰¥1  C. æ²¡æœ‰è¦æ±‚  D. æ— æ³•ç¡®å®š</p><p>10ï¼åœ¨å¹³é¢ç›´è§’åæ ‡ç³»çš„ç¬¬ä¸€è±¡é™å†…ç»˜åˆ¶ç›´çº¿æ®µï¼Œä¸‹åˆ—  D   ç®—æ³•å¯¹çº¿æ®µçš„æ–œç‡Kæ²¡æœ‰é™åˆ¶ã€‚</p><p>A. é€ç‚¹æ¯”è¾ƒ  B. DDA  C. ä¸­ç‚¹ D. Bresenham</p><p>11ï¼ä¸å±äºBresenhamç®—æ³•ç»˜åˆ¶ç›´çº¿æ®µæ•ˆç‡é«˜çš„åŸå› æ˜¯    D   ã€‚</p><p>A. æ–œç‡Kä¸å¤§äº1  B. å‡å°‘äº†ç»˜åˆ¶æ¬¡æ•°  C. é¿å…äº†æµ®ç‚¹æ•°è¿ç”¨ç®— D. ä¸å¯è¿›è¡Œç§»ä½è¿ç®—</p><p>12ï¼é‡‡ç”¨Bresenhamç®—æ³•ç»˜åˆ¶ä»ç‚¹Aï¼ˆ10,10ï¼‰åˆ°ç‚¹Bï¼ˆ20,15ï¼‰çš„ç›´çº¿æ®µï¼Œå…±éœ€æ‰§è¡Œ A     æ¬¡ç”»ç‚¹å‘½ä»¤ã€‚</p><p>A. 11  B. 15  C. 10  D. 12</p><p>13ï¼è®¡ç®—æœºå›¾å½¢å­¦ä¸­è¡¨è¾¾ä¸€æ¡æ›²çº¿çš„æ–¹ç¨‹ä¸€èˆ¬æœ‰    C   ç§å½¢å¼ã€‚</p><p>A. ä¸€  B. äºŒ  C. ä¸‰ D. æ— ç©·</p><p>14ï¼è§£ç®—ä¸‰æ¬¡æ ·æ¡æ’å€¼å‡½æ•°éœ€è¦é¢å¤–è¡¥å……    B   ä¸ªæ¡ä»¶ã€‚</p><p>   A. 1  B. 2  C. 3 D. 0</p><p>15ï¼ä¸‹åˆ—ä¸å±äºæ›²çº¿æ’å€¼æ–¹æ³•çš„æ˜¯  D     ã€‚</p><p>A.å¤šé¡¹å¼æ’å€¼ B.åˆ†æ®µå¤šé¡¹å¼æ’å€¼ C.æ ·æ¡å‡½æ•°æ’å€¼ D.æœ€å°äºŒä¹˜æ’å€¼</p><p>16ï¼æœ€å°äºŒä¹˜æ³•æ›²çº¿æ‹Ÿåˆçš„åŸç†æ˜¯ï¼šä½¿å‹å€¼ç‚¹çš„åæ ‡å€¼ä¸æ›²çº¿ä¸Šå¯¹åº”ç‚¹çš„åæ ‡å€¼çš„åå·®çš„å¹³æ–¹å’Œè¾¾åˆ°     B  ã€‚</p><p>A.æœ€å¤§  B.æœ€å°  C.ç»™å®šçš„å–å€¼èŒƒå›´ D.ä»¥ä¸Šè¯´æ³•å‡ä¸æ­£ç¡®</p><p>17ï¼åŒºåŸŸå†…éƒ¨ç‚¹çš„åˆ¤æ–­æ–¹æ³•å¯ä»¥æ˜¯ï¼šå°„çº¿æ³•ã€æ£€éªŒå¤¹è§’ä¹‹å’Œ</p><p>18ï¼    B   ä¸å±äºç®€å•ç§å­å¡«å……ç®—æ³•çš„ç‰¹ç‚¹ã€‚</p><p>A.æ“ä½œè¿‡ç¨‹ç®€å•  B.éœ€è¿›è¡Œæ·±åº¦é€’å½’  C.ç®—æ³•çš„æ•ˆç‡ä½ D.ä»…éœ€å°‘é‡çš„å†…å­˜ç©ºé—´</p><p>19ï¼äºŒç»´å›¾å½¢çš„å‡ ä½•å˜æ¢å…±æœ‰   B   ç§åŸºæœ¬å˜æ¢å½¢å¼ã€‚</p><p>Aï¼ 2â€‚â€‚â€‚â€‚â€‚Bï¼ 3â€‚â€‚â€‚â€‚â€‚Cï¼ 5â€‚â€‚â€‚â€‚â€‚â€‚Dï¼ 4</p><p>20ï¼å¯¹äºä»»æ„ä¸€æ¡ç›´çº¿æ®µï¼Œå®ƒç›¸å¯¹äºä¸€ä¸ªå·²å®šä¹‰çš„çª—å£ä½ç½®å…³ç³»æœ€å¤šæœ‰   D   ç§æƒ…å†µã€‚</p><p>Aï¼ 2â€‚â€‚â€‚â€‚â€‚Bï¼ 3â€‚â€‚â€‚â€‚â€‚Cï¼ 5â€‚â€‚â€‚â€‚â€‚â€‚Dï¼ 4</p><p>21ï¼ç¼–ç è£å‰ªæ³•ä¸­ï¼Œæ¯ä¸ªåŒºåŸŸç”¨ä¸€ä¸ª    D  ä½ä»£ç æ¥è¡¨ç¤ºã€‚</p><p>Aï¼ 2â€‚â€‚â€‚â€‚â€‚Bï¼ 3â€‚â€‚â€‚â€‚â€‚Cï¼ 5â€‚â€‚â€‚â€‚â€‚â€‚Dï¼ 4</p><p>22ï¼ç¼–ç è£å‰ªæ³•ä¸­ï¼Œæ¯ä¸ªç‚¹çš„ç¼–ç ä»é«˜åˆ°ä½ä½ä¾æ¬¡åˆ†åˆ«ä»£è¡¨   A   ã€‚</p><p>Aï¼ä¸Šä¸‹å³å·¦â€‚â€‚â€‚â€‚â€‚Bï¼å³å·¦ä¸Šä¸‹â€‚â€‚â€‚â€‚Cï¼ä¸Šä¸‹å·¦å³â€‚â€‚â€‚â€‚â€‚Dï¼ä¸‹ä¸Šå·¦å³</p><p>23ï¼ç¼–ç è£å‰ªæ³•ä¸­ï¼Œæ¯ä½çš„ç¼–ç åªæœ‰    A  çŠ¶æ€ã€‚</p><p>Aï¼ 1â€‚â€‚â€‚â€‚Bï¼ 3â€‚â€‚â€‚â€‚â€‚Cï¼ 2â€‚â€‚â€‚â€‚â€‚â€‚Dï¼ 4</p><p>24ï¼ç¼–ç è£å‰ªæ³•ä¸­ï¼Œè‹¥çº¿æ®µä¸¤ç«¯ç‚¹ç¼–ç å‡ä¸ºé›¶ï¼Œåˆ™ä¸¤ç‚¹    A  ã€‚</p><p>Aï¼åœ¨çª—å£å¤–â€‚â€‚â€‚â€‚Bï¼åœ¨çª—å£å†…â€‚â€‚â€‚â€‚Cï¼ ä¸å¯è§â€‚â€‚â€‚â€‚â€‚â€‚Dï¼ ä¸èƒ½ç¡®å®š</p><p>25ï¼è¦åˆ¤æ–­ä¸¤ç«¯ç‚¹æ‰€æ„æˆçš„çº¿æ®µä¸çª—å£å¯¹åº”å…³ç³»ï¼Œå¯ç”¨ä¸¤ä¸ªç«¯ç‚¹ç¼–ç è¿›è¡Œ  C   è¿ç®—ã€‚</p><p>Aï¼é€»è¾‘â€œéâ€â€‚â€‚â€‚â€‚Bï¼é€»è¾‘â€œæˆ–â€â€‚â€‚â€‚â€‚Cï¼é€»è¾‘â€œä¸â€ â€‚â€‚â€‚â€‚â€‚Dï¼é€»è¾‘â€œå¼‚æˆ–â€</p><p>26ï¼è‹¥çº¿æ®µä¸¤ç«¯ç‚¹çš„ç¼–ç çš„é€»è¾‘   C  ä¸ä¸º0ï¼Œåˆ™è¿™ä¸¤ä¸ªç«¯ç‚¹å¿…ç„¶ä½äºæŸæ¡è¾¹ç•Œçš„åŒä¾§ï¼Œæ•…å¿…åœ¨çª—å£å¤–ï¼Œåº”ä¸å¯è§ã€‚</p><p>Aï¼éâ€‚â€‚â€‚â€‚Bï¼ æˆ–â€‚â€‚â€‚â€‚Cï¼ ä¸ â€‚â€‚â€‚â€‚â€‚â€‚Dï¼ å¼‚æˆ–</p><p>27ï¼å¤šè¾¹å½¢çš„é€è¾¹è£å‰ªç®—æ³•ä¸­éœ€è¦è®¾ç½®   C   ä¸ªé¡¶ç‚¹è¡¨ã€‚</p><p>Aï¼ 1â€‚â€‚â€‚â€‚Bï¼ 3â€‚â€‚â€‚â€‚â€‚Cï¼ 2â€‚â€‚â€‚â€‚â€‚â€‚Dï¼ 4</p><p>28ï¼è®¡ç®—æœºå›¾å½¢å­¦ä¸­ï¼Œä¸€èˆ¬æœ‰   B   ç§è¡¨ç¤ºä¸‰ç»´å›¾å½¢çš„æ–¹æ³•ã€‚</p><p>Aï¼ 1â€‚â€‚â€‚â€‚Bï¼ 3â€‚â€‚â€‚â€‚â€‚Cï¼ 2â€‚â€‚â€‚â€‚â€‚â€‚Dï¼ 4 (çº¿æ¡†æ¨¡å‹ã€è¡¨é¢æ¨¡å‹ã€å®ä½“æ¨¡å‹)</p><p>29ï¼åœ¨ä¸‰ç»´ç©ºé—´é‡Œï¼Œç»™å®š(nï¼‹l)Ã—(m+1)ä¸ªç©ºé—´ç‚¹,å¯ç”Ÿæˆ   D   æ¬¡Bezieræ›²é¢ã€‚</p><p>Aï¼ (nï¼‹l)Ã—(m+1)â€‚â€‚â€‚â€‚Bï¼ n Ã—(m+1)â€‚â€‚â€‚â€‚â€‚Cï¼(nï¼‹l)Ã—mâ€‚â€‚â€‚â€‚â€‚â€‚Dï¼ nÃ—m</p><p>30ï¼åœ¨ä¸‰ç»´ç©ºé—´ä¸­ï¼Œ,ç”ŸæˆåŒä¸‰æ¬¡Bezieræ›²é¢ï¼Œéœ€è¦    B  ä¸ªæ§åˆ¶é¡¶ç‚¹ã€‚</p><p>Aï¼ 9â€‚â€‚â€‚â€‚Bï¼ 16â€‚â€‚â€‚â€‚â€‚Cï¼25â€‚â€‚â€‚â€‚â€‚â€‚Dï¼ 20</p><p>31ï¼ä»¥ä¸‹ä¸å±äºæ­£è½´æµ‹æŠ•å½±çš„æ˜¯   D   ã€‚</p><p>Aï¼ æ­£ç­‰æµ‹â€‚â€‚â€‚â€‚Bï¼ æ­£äºŒæµ‹â€‚â€‚â€‚â€‚Cï¼æ­£ä¸‰æµ‹â€‚â€‚â€‚â€‚â€‚â€‚Dï¼æ­£å››æµ‹</p><ol start="32"><li>é€è§†æŠ•å½±æ˜¯é€è§†å˜æ¢ä¸   A   çš„ç»„åˆã€‚</li></ol><p>Aï¼å¹³è¡ŒæŠ•å½±å˜æ¢â€‚â€‚â€‚â€‚Bï¼ æ­£äºŒæµ‹â€‚â€‚â€‚â€‚Cï¼æ­£ä¸‰æµ‹â€‚â€‚â€‚â€‚â€‚â€‚Dï¼æ­£å››æµ‹</p><ol start="33"><li>å½±å“çœŸå®æ„Ÿå›¾å½¢å› ç´ æœ‰   D   ã€‚</li></ol><p>Aï¼ç‰©ä½“æœ¬èº«å½¢çŠ¶åŠç‰©ä½“è¡¨é¢ç‰¹å¾ â€‚Bï¼ç…§å°„ç‰©ä½“å…‰æºåŠç‰©ä½“ä¸å…‰æºç›¸å¯¹ä½ç½®</p><p>C. ç‰©ä½“å‘¨å›´ç¯å¢ƒ        D. ä»¥ä¸Šéƒ½æ˜¯</p><ol start="34"><li>å…‰ç…§åœ¨ç‰©ä½“è¡¨é¢ä¸Šé€šå¸¸æœ‰   C    ç§æƒ…å†µã€‚</li></ol><p>Aï¼ 1â€‚â€‚â€‚â€‚â€‚â€‚Bï¼ 2â€‚â€‚â€‚â€‚â€‚â€‚Cï¼ 3â€‚â€‚â€‚â€‚â€‚â€‚â€‚Dï¼ 4</p><ol start="35"><li>Lambertå…‰ç…§æ¨¡å‹ä¸»è¦è€ƒè™‘æ¼«åå°„å…‰å’Œ   A   çš„å½±å“ã€‚</li></ol><p>A. ç¯å¢ƒå…‰â€‚â€‚â€‚â€‚â€‚â€‚Bï¼ é•œé¢å…‰â€‚â€‚â€‚â€‚â€‚Cï¼ é€å°„å…‰â€‚â€‚â€‚â€‚â€‚â€‚â€‚Dï¼ é«˜å…‰</p><ol start="36"><li>Phongå…‰ç…§æ¨¡å‹æœ‰  C    ç§ç±»å‹çš„å…‰çš„å½±å“ã€‚</li></ol><p>Aï¼ 1â€‚â€‚â€‚â€‚â€‚â€‚Bï¼ 2â€‚â€‚â€‚â€‚â€‚â€‚Cï¼ 3â€‚â€‚â€‚â€‚â€‚â€‚â€‚Dï¼ 4</p><p>37ï¼ä¸‹åˆ—æœ‰å…³æŠ•å½±çš„å™è¿°è¯­å¥ä¸­,æ­£ç¡®çš„è®ºè¿°ä¸º    D  ã€‚</p><p>A. é€è§†æŠ•å½±ä¸å¹³è¡ŒæŠ•å½±ç›¸æ¯”ï¼Œèƒ½çœŸå®åœ°åæ˜ ç‰©ä½“çš„ç²¾ç¡®çš„å°ºå¯¸å’Œå½¢çŠ¶</p><p>B. å¹³è¡ŒæŠ•å½±çš„æŠ•å½±ä¸­å¿ƒåˆ°æŠ•å½±é¢çš„è·ç¦»æ˜¯æ— é™çš„</p><p>C. é€è§†æŠ•å½±å˜æ¢ä¸­ï¼Œä¸€ç»„å¹³è¡ŒäºæŠ•å½±é¢çš„çº¿çš„æŠ•å½±äº§ç”Ÿä¸€ä¸ªç­ç‚¹</p><p>D. ç­ç‚¹å¯ä»¥çœ‹ä½œæ˜¯æœ‰é™è¿œå¤„çš„ä¸€ä¸ªç‚¹åœ¨æŠ•å½±é¢ä¸Šçš„æŠ•å½±</p><p>38ï¼ä»¥ä¸‹    D  ä¸æ˜¯è´å¡å°”æ›²çº¿çš„ç‰¹ç‚¹ã€‚</p><p> A.è´å¡å°”æ›²çº¿åªè¦ç»™å‡ºæ•°æ®ç‚¹å°±å¯æ„é€ æ›²çº¿</p><p> B.è´å¡å°”æ›²çº¿æ¬¡æ•°ä¸¥æ ¼ä¾èµ–äºç¡®å®šè¯¥æ®µæ›²çº¿çš„æ•°æ®ç‚¹ä¸ªæ•°</p><p> C.è´å¡å°”æ›²çº¿ä¸å®Œå…¨é€šè¿‡æ•°æ®ç‚¹</p><p>D.è´å¡å°”æ›²çº¿å¤„å¤„å¯ä»¥è°ƒæ•´</p><p>39ï¼ä¸‰ç»´å›¾å½¢æ˜¯ç›¸å¯¹äº    A   ä½œæ—‹è½¬å˜æ¢ã€‚</p><p>A. ç‚¹   B. ç›´çº¿    C. å¹³é¢   D. æ›²çº¿</p><p>40ï¼ä¸‰ç»´ç©ºé—´XYZä¸­çš„å›¾å½¢ç»•xè½´çš„é€†æ—¶é’ˆæ—‹è½¬å¯çœ‹æˆæ˜¯å›¾å½¢åœ¨  B   ç»•åŸç‚¹Oçš„äºŒç»´æ—‹è½¬å˜æ¢ã€‚ </p><p>Aï¼XOYå¹³é¢  Bï¼YOZ å¹³é¢  Cï¼ZOX å¹³é¢  Dï¼éƒ½ä¸æ˜¯</p><p>41ï¼å·²çŸ¥å¹³é¢è£å‰ªçŸ©å½¢åŸŸçš„å·¦ä¸‹è§’ç‚¹(50,60)åŠå³ä¸Šè§’ç‚¹(200ï¼Œ200)ï¼Œåˆ©ç”¨ç¼–ç è£å‰ªç®—æ³•å¯¹æŸçº¿æ®µçš„ç«¯ç‚¹(56,115)è¿›è¡Œç¼–ç ï¼Œå…¶ç¼–ç æ˜¯   D  ã€‚</p><p>Aï¼1100  Bï¼0000   Cï¼0101  Dï¼1001</p><p>42ï¼åœ¨è¿›è¡Œæ‰«æçº¿å¤šè¾¹å½¢åŒºåŸŸå¡«å……æ—¶ï¼Œè‹¥ä½äºæ‰«æçº¿å¼‚ä¾§çš„ä¸¤ç›¸é‚»è¾¹ä¸æ‰«æçº¿ç›¸äº¤äºåŒä¸€ç‚¹ï¼Œåˆ™è¯¥ç‚¹åº”è§†ä¸º    C  ä¸ªäº¤ç‚¹ã€‚</p><p>  Aï¼èˆå¼ƒ  Bï¼1  Cï¼2  Dï¼3</p><p>43ï¼ä¸‹é¢å“ªä¸€é¡¹æ˜¯Bezieræ›²çº¿çš„ç‰¹æ€§    A   ã€‚</p><p>Aï¼å±€éƒ¨å¯è°ƒæ€§â€‚â€‚â€‚â€‚â€‚Bï¼å‡¹å‡¸æ€§â€‚â€‚â€‚â€‚Cï¼å¯¹ç§°æ€§ â€‚â€‚â€‚Dï¼ä¸­ç‚¹æ€§</p><p>44ï¼åœ¨é€è§†æŠ•å½±ä¸­ï¼Œä¸»ç­ç‚¹çš„ä¸ªæ•°æœ€å¤šæ˜¯   C    ã€‚</p><p>Aï¼ 1â€‚â€‚    Bï¼ 2â€‚â€‚   Cï¼ 3â€‚â€‚    Dï¼ 0â€‚</p><p>45ï¼ä¸‹åˆ—æœ‰å…³ç®€å•å…‰åå°„æ¨¡å‹çš„æè¿°è¯­å¥ä¸­ï¼Œæ­£ç¡®çš„æ˜¯   C  ã€‚â€‚</p><p>Aï¼ç®€å•å…‰åå°„æ¨¡å‹ï¼Œåˆç§°ä¸ºPhongæ¨¡å‹ï¼Œå®ƒæ¨¡æ‹Ÿç‰©ä½“è¡¨é¢å¯¹å…‰çš„é€å°„ä½œç”¨</p><p>Bï¼åœ¨ç®€å•å…‰åå°„æ¨¡å‹ä¸­ï¼Œå‡å®šå…‰æºæ˜¯ç‚¹å…‰æºï¼Œä¸”ä»…å…³æ³¨ç‰©ä½“è¡¨é¢å¯¹å…‰çš„é•œé¢åå°„ä½œç”¨â€‚</p><p>Cï¼ç®€å•å…‰åå°„æ¨¡å‹ä¸»è¦è€ƒè™‘ç‰©ä½“è¡¨é¢å¯¹ç›´å°„å…‰ç…§çš„æ¼«åå°„ä½œç”¨</p><p>Dï¼åœ¨ç®€å•å…‰åå°„æ¨¡å‹ä¸­ï¼Œå¯¹ç‰©ä½“é—´çš„å…‰åå°„ä½œç”¨ï¼Œåªç”¨ä¸€ä¸ªç¯å¢ƒå…‰å˜é‡åšè¿‘ä¼¼å¤„ç†</p><p>46ï¼æ­£ç­‰è½´æµ‹å›¾çš„ä¸‰ä¸ªæŠ•å½±è½´é—´çš„å¤¹è§’æ˜¯   D   åº¦ã€‚</p><p>Aï¼30 â€‚   Bï¼60 â€‚â€‚   Cï¼90 â€‚   Dï¼120</p><p>47ï¼ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸‰æ¬¡Bæ ·æ¡æ›²çº¿éœ€è¦   B  ä¸ªæ§åˆ¶é¡¶ç‚¹ã€‚â€‚</p><p>Aï¼ 5 â€‚â€‚â€‚â€‚â€‚â€‚Bï¼ 4â€‚â€‚â€‚â€‚â€‚â€‚Cï¼ 6â€‚â€‚â€‚â€‚â€‚â€‚â€‚Dï¼ 3</p><ol start="48"><li>ä¸‹åˆ—è®¾å¤‡ä¸­ï¼Œ   B    æ˜¯å›¾å½¢è¾“å‡ºè®¾å¤‡ã€‚</li></ol><p>Aï¼ æ•°å­—åŒ–ä»ªâ€‚â€‚â€‚â€‚â€‚â€‚Bï¼ ç»˜å›¾ä»ªâ€‚â€‚â€‚â€‚â€‚â€‚Cï¼æ‰«æä»ªâ€‚â€‚â€‚â€‚â€‚â€‚â€‚Dï¼é”®ç›˜</p><ol start="49"><li>ç›´çº¿DDAç®—æ³•ä¸­ï¼Œå½“æ–œç‡|m|&gt;1æ—¶ï¼Œxæ–¹å‘çš„å¢é‡â–³xå’Œyæ–¹å‘çš„å¢é‡â–³yåˆ†åˆ«</li></ol><p>æ˜¯   C  ã€‚</p><p>A. Â±må’ŒÂ±1   B. Â±1å’ŒÂ±1&#x2F;m   C. Â±1å’ŒÂ±m   D. Â±1&#x2F;må’ŒÂ±1</p><ol start="50"><li>è®¡ç®—æœºå›¾å½¢å­¦ä¸­ï¼ŒCADæ˜¯æŒ‡è®¡ç®—æœº  B   ã€‚</li></ol><p>A. è¾…åŠ©åˆ¶é€    B. è¾…åŠ©è®¾è®¡   C. è¾…åŠ©æ•™å­¦   D. è¾…åŠ©æ¢æµ‹</p><p>51ï¼è®¡ç®—æœºçš„åŸºæœ¬å­˜å‚¨å•ä½æ˜¯   D   ã€‚</p><p>  Aï¼ ä½  Bï¼ åŒå­—   Cï¼ å­—  Dï¼å­—èŠ‚</p><p>52ï¼å…³äºè®¡ç®—æœºå›¾å½¢å­¦çš„ç‰¹ç‚¹ï¼Œä¸æ­£ç¡®çš„è¯´æ³•æ˜¯    C   ã€‚</p><p>Aï¼ è®¡ç®—æœºäº§ç”Ÿçš„å›¾å½¢æœ‰è§„å¾‹ã€å…‰æ»‘ </p><p>Bï¼ è®¡ç®—æœºäº§ç”Ÿçš„å›¾å½¢çº¯å‡€ç¾è§‚ã€æ— å™ªå£°å¹²æ‰°</p><p>Cï¼é€šè¿‡è®¡ç®—æœºäº§ç”Ÿçš„å›¾å½¢ä¸èƒ½æç»˜çº¯ç²¹æ˜¯æƒ³åƒçš„ä¸»è§‚ä¸–ç•Œä¸­çš„å„ç§å¯¹è±¡ã€‚ </p><p>Dï¼äº¤äº’å¼äº§ç”Ÿçš„å›¾å½¢å¯ä¿®æ”¹æ€§å¼ºï¼Œä¸”é€Ÿåº¦å¿«ã€å·®é”™å°‘ã€‚</p><ol start="53"><li>å…³äºC&#x2F;C++ä¸­çš„ç±»çš„è¯´æ³•ä¸æ­£ç¡®çš„æ˜¯  A     ã€‚</li></ol><p>Aï¼ å®šä¹‰ç±»çš„å…³é”®å­—æ˜¯struct       Bï¼ ç±»çš„æˆå‘˜é€šå¸¸å…·æœ‰è®¿é—®å±æ€§</p><p>Cï¼ å®šä¹‰ç±»çš„å¯¹è±¡éœ€è¦æ„é€ å‡½æ•°      Dï¼ ç±»å…·æœ‰å°è£…ç‰¹æ€§</p><ol start="54"><li>æœ€å°äºŒä¹˜æ³•æ˜¯å®é™…æµ‹é‡å€¼å’ŒçœŸå®å€¼ä¹‹å·®ï¼ˆè¯¯å·®ï¼‰çš„å¹³æ–¹å’Œè¾¾åˆ°     B ã€‚</li></ol><p>Aï¼ æœ€å¤§     Bï¼ æœ€å°     Cï¼ é›¶       Dï¼ æ— ç©·å¤§</p><ol start="55"><li>ä»¥ä¸‹å±äºæœ¬è¯¾ç¨‹é€‰ç”¨çš„ç¼–ç¨‹è¯­è¨€çš„ç‰¹ç‚¹æ˜¯    A   ã€‚</li></ol><p>Aï¼ æ”¯æŒå¤šç»§æ‰¿      Bï¼ æ‰§è¡Œæ•ˆç‡ä½      </p><p>Cï¼ éœ€è¦è§£é‡Šæ‰§è¡Œ    Dï¼ ä¸é€‚åˆç¼–å†™ç³»ç»Ÿè½¯ä»¶</p><ol start="56"><li>æœ¬å­¦æœŸåœ¨MFCå¹³å°ä¸Šç»˜åˆ¶å›¾å½¢æ—¶é€šå¸¸åœ¨   C   ç±»è¿›è¡Œå®ç°ã€‚</li></ol><p>Aï¼ åº”ç”¨ç¨‹åºç±»â€‚â€‚â€‚â€‚â€‚â€‚Bï¼å¯¹è¯æ¡†ç±»â€‚â€‚â€‚â€‚â€‚â€‚Cï¼è§†å›¾ç±»â€‚â€‚â€‚â€‚â€‚â€‚â€‚Dï¼æ–‡æ¡£ç±»</p><ol start="57"><li>å¯¹äºåŒä¸€æ¡çº¿æ®µè€Œè¨€ï¼ŒBresenhamæ–¹æ³•è¾ƒDDAç»˜åˆ¶æ³•çš„æ•ˆç‡   A   ã€‚</li></ol><p>Aï¼é«˜â€‚â€‚â€‚â€‚â€‚Bï¼ ä½â€‚â€‚â€‚â€‚â€‚Cï¼ ç›¸åŒâ€‚â€‚â€‚â€‚â€‚â€‚Dï¼ æ²¡æœ‰å¯æ¯”æ€§  </p><p>58ï¼ä¸‹åˆ—æœ‰å…³å‡ ä½•å˜æ¢çš„å™è¿°è¯­å¥ä¸­ï¼Œæ­£ç¡®çš„è®ºè¿°æ˜¯  C    ã€‚</p><p>Aï¼å‡ ä½•å˜æ¢å°±æ˜¯æŠŠä¸€ä¸ªå›¾å½¢ä»ä¸€ä¸ªä½ç½®ç§»åˆ°åˆ«çš„ä½ç½®</p><p>Bï¼å‡ ä½•å˜æ¢åå›¾å½¢è¿çº¿æ¬¡åºå‘ç”Ÿæ”¹å˜</p><p>Cï¼ä¸€ä¸ªæ­£æ–¹ä½“ç»å‡ ä½•å˜æ¢åå¯èƒ½ä¼šå˜æˆé•¿æ–¹ä½“</p><p>Dï¼å‡ ä½•å˜æ¢è¿‡ç¨‹ä¸­ä¸èƒ½è®©å›¾å½¢äº§ç”Ÿå˜å½¢</p><p>59ï¼ä¸‰ç»´ç©ºé—´XYZä¸­çš„å›¾å½¢ç»•Yè½´çš„æ­£å‘æ—‹è½¬å¯ä»¥è¢«çœ‹ä½œæ˜¯åœ¨ A   ç»•åŸç‚¹Oçš„äºŒç»´æ—‹è½¬å˜æ¢ã€‚ </p><p>Aï¼XOYå¹³é¢  Bï¼YOZ å¹³é¢  Cï¼ZOX å¹³é¢  Dï¼éƒ½ä¸æ˜¯</p><p>60ï¼ ç”¨ç¼–ç è£å‰ªç®—æ³•è£å‰ªäºŒç»´çº¿æ®µæ—¶ï¼Œè‹¥ç›´çº¿æ®µä¸¤ç«¯ç‚¹Mã€Nçš„ç¼–ç åˆ†åˆ«ä¸º1001å’Œ1011ï¼Œåˆ™å¯¹è¯¥çº¿æ®µé‡‡ç”¨çš„å¤„ç†æ–¹æ³•æ˜¯   C    ã€‚</p><p>Aï¼ ç›´æ¥ä¿ç•™   Bï¼ ç›´æ¥æ”¾å¼ƒ  Cï¼ å¯¹MNåœ¨æ±‚äº¤åˆ†å‰²  Dï¼ä¸èƒ½åˆ¤æ–­</p><p>61ï¼åœ¨è¿›è¡Œæ‰«æçº¿å¤šè¾¹å½¢åŒºåŸŸå¡«å……æ—¶ï¼Œè‹¥ä½äºæ‰«æçº¿åŒä¾§çš„ä¸¤ç›¸é‚»è¾¹ä¸æ‰«æçº¿ç›¸äº¤äºåŒä¸€ç‚¹ï¼Œåˆ™è¯¥ç‚¹åº”è§†ä¸º   A ä¸ªäº¤ç‚¹ã€‚</p><p>  Aï¼ 1   Bï¼ 2   Cï¼ 3   Dï¼ èˆå¼ƒ</p><p>62ï¼ä¸‹é¢å“ªä¸€é¡¹ä¸æ˜¯Bezieræ›²çº¿çš„ç‰¹æ€§   A    ã€‚</p><p>Aï¼å¯¹ç§°æ€§â€‚â€‚â€‚â€‚Bï¼å‡¸åŒ…æ€§â€‚â€‚â€‚â€‚Cï¼å±€éƒ¨æ€§å¯è°ƒâ€‚â€‚â€‚â€‚Dï¼å‡ ä½•ä¸å˜æ€§</p><p>63ï¼åœ¨é€è§†æŠ•å½±ä¸­ï¼ŒæŠ•å½±é¢ä»…ä¸ä¸¤ä¸ªåæ ‡è½´ç›¸äº¤,æ­¤é€è§†è¢«ç§°ä¸º   B   ç‚¹é€è§†ã€‚</p><p>Aï¼1   Bï¼2    Cï¼3   Dï¼4â€‚</p><p>64ï¼ä¸‹åˆ—ä¸å±äºä¸‰è§†å›¾èŒƒå›´çš„æ˜¯      C  ã€‚</p><p>Aï¼ä¿¯è§†å›¾â€‚â€‚     Bï¼ä¸»è§†å›¾â€‚â€‚    Cï¼æ­£è½´æµ‹å›¾â€‚â€‚  Dï¼ä¾§è§†å›¾</p><p>65ï¼äºŒæ¬¡Bæ ·æ¡æ›²çº¿å…·æœ‰     B  å¯¼æ•°çš„è¿ç»­æ€§ã€‚â€‚</p><p>Aï¼0é˜¶â€‚â€‚â€‚â€‚â€‚â€‚Bï¼ä¸€é˜¶â€‚â€‚â€‚â€‚â€‚â€‚Cï¼äºŒé˜¶â€‚â€‚â€‚â€‚â€‚â€‚â€‚Dï¼ä¸‰é˜¶</p><p>66ï¼MFCåº”ç”¨ç¨‹åºçš„å…¥å£å‡½æ•°åæ˜¯   C    ã€‚â€‚</p><p>Aï¼mainâ€‚â€‚â€‚â€‚â€‚â€‚Bï¼mianâ€‚â€‚â€‚â€‚â€‚â€‚Cï¼WinMainâ€‚â€‚â€‚â€‚â€‚â€‚â€‚Dï¼winmain</p><p>67ï¼ä¸‹åˆ—æœ‰å…³Bæ ·æ¡æ›²çº¿æ€§è´¨çš„è¯´æ˜è¯­å¥ä¸­ï¼Œæ­£ç¡®çš„è®ºè¿°ä¸º   B   ã€‚</p><p>Aï¼ ä¸€æ¡ç›´çº¿ä¸nä¸ªé¡¶ç‚¹æ§åˆ¶çš„Bæ ·æ¡æ›²çº¿å¯æœ‰nä¸ªæˆ–æ›´å¤šä¸ªäº¤ç‚¹</p><p>Bï¼ Bæ ·æ¡æ›²çº¿å¯æ„é€ ç›´çº¿æ®µå’Œåˆ‡çº¿ç­‰ç‰¹æ®Šæƒ…å†µ</p><p>Cï¼ å½“ç§»åŠ¨Bæ ·æ¡æ›²çº¿ä¸€ä¸ªé¡¶ç‚¹æ—¶ï¼Œå¿…å®šä¼šå¯¹æ•´æ¡Bæ ·æ¡æ›²çº¿äº§ç”Ÿå½±å“</p><p>Dï¼ Bæ ·æ¡æ›²çº¿çš„å½¢çŠ¶ä¸åæ ‡ç³»çš„é€‰æ‹©æ— å…³</p><p>68ï¼ä¸‹åˆ—å…³äºæ•°æ®çš„é€»è¾‘ç»“æ„çš„å™è¿°ä¸­ï¼Œæ­£ç¡®çš„æ˜¯   A   ã€‚</p><p>Aï¼æ•°æ®çš„é€»è¾‘ç»“æ„æ˜¯æ•°æ®é—´å…³ç³»çš„æè¿°</p><p>Bï¼æ•°æ®çš„é€»è¾‘ç»“æ„åæ˜ äº†æ•°æ®åœ¨è®¡ç®—æœºä¸­çš„å­˜å‚¨æ–¹å¼</p><p>Cï¼æ•°æ®çš„é€»è¾‘ç»“æ„åˆ†ä¸ºé¡ºåºç»“æ„å’Œé“¾å¼ç»“æ„</p><p>Dï¼æ•°æ®çš„é€»è¾‘ç»“æ„åˆ†ä¸ºé™æ€ç»“æ„å’ŒåŠ¨æ€ç»“æ„</p><p>69ï¼ä¸‹åˆ—æœ‰å…³ç®€å•å…‰åå°„æ¨¡å‹çš„æè¿°ä¸­ï¼Œé”™è¯¯çš„è®ºè¿°ä¸º   D   ã€‚</p><p>Aï¼æ¼«åå°„å…‰æ˜¯ç”±äºè¡¨é¢ç²—ç³™ä¸å¹³å¼•èµ·çš„</p><p>Bï¼ç¯å¢ƒå…‰æ˜¯å…‰åœ¨ç‰©ä½“å’Œç¯å¢ƒä¹‹é—´å¤šæ¬¡åå°„åæœ€ç»ˆè¾¾åˆ°å¹³è¡¡æ—¶çš„ä¸€ç§å…‰</p><p>Cï¼é•œé¢åå°„å…‰äº§ç”Ÿçš„é«˜å…‰åŒºåŸŸåªåæ˜ å…‰æºçš„é¢œè‰²</p><p>Dï¼è¯¥æ¨¡å‹ä¸­å¿…é¡»è€ƒè™‘é€å°„å…‰</p><p>70ï¼è§£ç®—å¹³é¢ä¸Š5ä¸ªç‚¹æ‰€ç¡®å®šçš„4æ®µè‡ªç„¶ä¸‰æ¬¡æ ·æ¡å‡½æ•°å…±éœ€è¦   C   ä¸ªé™„åŠ æ¡ä»¶ã€‚</p><p>Aï¼1â€‚ â€‚    Bï¼2â€‚ â€‚    Cï¼3â€‚ â€‚    Dï¼4</p><p><strong>åˆ¤æ–­é¢˜ï¼š</strong></p><p>( F ) 1. è®¡ç®—æœºç”Ÿæˆå›¾å½¢æ—¶ï¼Œåªèƒ½ç”¨çŸ¢é‡æ³•è€Œæ²¡æœ‰å…¶å®ƒåˆ«çš„æ–¹æ³•ã€‚</p><p>( T ) 2. ç®€å•ç§å­å¡«å……ç®—æ³•ä¸­ï¼Œé€‰æ‹©çš„ç§å­ç‚¹å¿…é¡»ä½äºå¾…å¡«å……çš„åŒºåŸŸå†…ã€‚ </p><p>( T ) 3. å›¾å½¢å­¦ä¸­å¯ä»¥ç”¨çº¿æ®µæ¥è¿‘ä¼¼é€¼è¿‘å¹³é¢ä¸Šçš„æ›²çº¿ã€‚</p><p>( F  ) 4. ä¸¤ç©ºé—´å‘é‡v1(2ï¼Œ3ï¼Œ4)ä¸v2(4ï¼Œ6ï¼Œ8)å¯å”¯ä¸€åœ°ç¡®å®šä¸€ä¸ªå¹³é¢ã€‚</p><p>(  F ) 5.ç”±RGBé¢œè‰²æ¨¡å‹æ‰€å®šä¹‰çš„é‡æ‰€éœ€å­˜å‚¨ç©ºé—´æ˜¯15ä½ã€‚</p><p>( F ) 6. æ´»åŠ¨è¾¹è¡¨AETæ˜¯å¤šè¾¹å½¢æ‰€æœ‰è¾¹è®°å½•é“¾è¡¨ã€‚ </p><p>( T ) 7. ç”¨é½æ¬¡åæ ‡è¡¨ç¤ºæ³•å¯ä»¥éå¸¸æ–¹ä¾¿åœ°å¤„ç†å¹³ç§»å˜æ¢ã€‚</p><p>(  T  ) 8. ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé€è§†æŠ•å½±çš„æŠ•å½±ä¸­å¿ƒåˆ°æŠ•å½±é¢ä¹‹é—´çš„è·ç¦»æ˜¯æœ‰é™çš„ã€‚   </p><p>ï¼ˆ T  ï¼‰9. ç”±äºç‰©ä½“è¡¨é¢å‡¹å‡¸ä¸å¹³è€Œå‘å››å‘¨å‡åŒ€åå°„çš„å…‰å«æ¼«å°„å…‰ã€‚ </p><p>ï¼ˆ  T ï¼‰10.å¯ä»¥é€šè¿‡é€‚å½“çš„å˜æ¢å°†ä¸‰ç‚¹é€è§†è½¬æ¢ä¸ºä¸€ç‚¹é€è§†ã€‚ </p><p>ï¼ˆ  T ï¼‰11.è®¡ç®—æœºç”Ÿæˆçš„ç›´çº¿åœ¨æ˜¾ç¤ºæ—¶å¾€å¾€å‘ˆç°é”¯é½¿çŠ¶ï¼Œè¿™ç§ç°è±¡å«èµ°æ ·ã€‚   </p><p>ï¼ˆ F  ï¼‰12.åœ¨æ„å»ºBæ ·æ¡æ›²çº¿æ—¶ï¼Œç»ä¸å…è®¸å‡ºç°é‡ç»“ç‚¹ï¼Œå¦åˆ™å°†å‡ºé”™ã€‚</p><p>ï¼ˆ  T  ï¼‰13.å¹³é¢ç‚¹Pçš„é½æ¬¡åæ ‡ä¸º(16,6,2)ï¼Œå…¶å¯¹åº”çš„å®é™…åæ ‡ä¸ºï¼ˆ8,3ï¼‰ã€‚</p><p>ï¼ˆ T ï¼‰14.ç§»åŠ¨ä¸€ä¸ªæ§åˆ¶ç‚¹æ—¶ï¼Œå¯ä»¥è°ƒæ•´Bæ ·æ¡æ›²çº¿çš„å±€éƒ¨å½¢çŠ¶ã€‚</p><p>ï¼ˆ T ï¼‰15.å¹³é¢ä¸Šä¸¤ä¸ªç‚¹æ˜¯å¦ä½äºæŸç›´çº¿çš„åŒä¾§å¯ç”¨å‘é‡çš„å‰ä¹˜è¿›è¡Œåˆ¤æ–­ã€‚</p><p>ï¼ˆ  F ï¼‰16.ç»˜å›¾ä»ªç»˜åˆ¶çº¿æ®µæ˜¯ç¬”åœ¨X,Yæ–¹å‘ç§»åŠ¨ï¼Œç”»çº¿æ—¶å•æ–¹å‘çš„ä¸€æ¬¡ç§»åŠ¨è·ç¦»ç§°ä¸ºæ­¥çŸ©ï¼Œè®¾å¤‡çš„æ­¥çŸ©è¶Šå°ï¼Œç»˜å‡ºçš„å›¾å½¢è¶Šç²¾ç¡®ã€‚</p><p>ï¼ˆ  F ï¼‰17.è‡ªç”±æ›²çº¿æ˜¯ä¸€æ¡æ— æ³•ç”¨æ ‡å‡†ä»£æ•°æ–¹ç¨‹æ¥æè¿°çš„æ›²çº¿ã€‚</p><p>æ›²çº¿æ’å€¼æ–¹æ³•å¯ä½¿ç”¨ä½¿ç”¨é«˜æ¬¡å¤šé¡¹å¼ï¼Œå› ä¸ºæ¬¡æ•°è¶Šé«˜ï¼Œæ›²çº¿è¶Šç²¾ç¡®ã€‚</p><p>ï¼ˆ T ï¼‰18.ä¸‰æ¬¡æ ·æ¡æ›²çº¿è¦æ±‚é€šè¿‡æ‰€æœ‰æŒ‡å®šçš„æ•°æ®ç‚¹ï¼Œä½†æ›²çº¿çš„å½¢çŠ¶ä¾èµ–äºè¾¹ç•Œæ¡ä»¶.</p><p>ï¼ˆ  T ï¼‰19.æ›²çº¿çš„å½¢çŠ¶ç”±ç‰¹å¾å¤šè¾¹å½¢çš„é¡¶ç‚¹Piï¼ˆiï¼0ï¼Œlï¼Œâ€¦â€¦ï¼Œnï¼‰å”¯ä¸€ç¡®å®šï¼Œä¸åæ ‡ç³»çš„é€‰å–æ— å…³ã€‚è¿™å°±æ˜¯å‡ ä½•ä¸å˜æ€§ï¼ŒBezieræ›²çº¿çš„å‡ ä½•ä½œå›¾æ³•å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹è¯ã€‚</p><p>ï¼ˆ T ï¼‰20.åŒºåŸŸå¡«å……å°±æ˜¯å°†åŒºåŸŸå†…çš„åƒç´ ç½®æˆæ–°çš„é¢œè‰²å€¼æˆ–å›¾æ¡ˆã€‚</p><p>ï¼ˆ T ï¼‰21.å¹³é¢ä¸Šçš„åŒºåŸŸé€šå¸¸ç”±ä¸€ä¸ªå°é—­çš„è½®å»“æ¥å®šä¹‰ï¼Œå¤„äºä¸€ä¸ªå°é—­è½®å»“çº¿å†…çš„æ‰€æœ‰åƒç´ ç‚¹å³æ„æˆä¸€ä¸ªåŒºåŸŸã€‚</p><p>ï¼ˆ T ï¼‰22.å¤šè¾¹å½¢åŒºåŸŸå¡«å……å°±æ˜¯å°†åŒºåŸŸå†…çš„åƒç´ ç½®æˆæ–°çš„é¢œè‰²å€¼æˆ–å›¾æ¡ˆã€‚</p><p>ï¼ˆ  T ï¼‰23.ä»»ä½•ä¸€ä¸ªå°é—­æ›²çº¿éƒ½å¯ä»¥ç”¨å¤šè¾¹å½¢æ¥é€¼è¿‘ã€‚</p><p>ï¼ˆ  T ï¼‰24.å¯¹äºä¸€ä¸ªç»™å®šçš„å¤šè¾¹å½¢åŒºåŸŸè€Œè¨€ï¼Œæ˜¾ç¤ºå¹³é¢ä¸Šæ¯ä¸ªåƒç´ ç‚¹å†…å¤–ç‰¹æ€§æ˜¯äº’ç›¸å…³è”çš„ï¼Œå³ç›¸é‚»åƒç´ é—´å…·æœ‰ç›¸å…³å±æ€§ã€‚</p><p>ï¼ˆ  T ï¼‰25.æ´»åŠ¨è¾¹è¡¨AETæ˜¯ä¸€ä¸ªåªä¸å½“å‰æ‰«æçº¿ç›¸äº¤çš„è¾¹è®°å½•é“¾è¡¨ã€‚éšç€æ‰«æçº¿ä»ä¸€æ¡åˆ°å¦ä¸€æ¡çš„è½¬æ¢ï¼ŒAETè¡¨çš„å†…å®¹ä¹Ÿåº”éšä¹‹å˜åŠ¨ã€‚</p><p>ï¼ˆ  T ï¼‰26.å‡ ä½•å˜æ¢çš„è§„åˆ™å¯ä»¥ç”¨å‡½æ•°æ¥è¡¨ç¤ºã€‚</p><p>ï¼ˆ  T ï¼‰27.ä¸€èˆ¬è€Œè¨€ï¼Œå¤æ‚çš„å›¾å½¢å˜æ¢éƒ½å¯ä»¥åŸºæœ¬äº¤æ¢çš„é€‚å½“ç»„åˆæ¥å®ç°ã€‚</p><p>ï¼ˆ  T ï¼‰28.å¯¹å›¾å½¢ä½œå‡ ä½•å˜æ¢ï¼Œå…¶å®è´¨æ˜¯å¯¹ç‚¹çš„å‡ ä½•å˜æ¢ã€‚</p><p>ï¼ˆ T ï¼‰29.é½æ¬¡åæ ‡çš„åº”ç”¨ï¼Œæ‰©å¤§äº†å˜æ¢çŸ©é˜µåŠŸèƒ½ï¼Œåªè¦å¯¹çŸ©é˜µä¸­æœ‰å…³å…ƒç´ èµ‹ä»¥ä¸åŒçš„ å€¼ï¼Œå³å¯è¾¾åˆ°é¢„æœŸå˜æ¢ç›®çš„ã€‚</p><p>ï¼ˆ  T ï¼‰30.ç»„åˆå˜æ¢é¡ºåºä¸èƒ½é¢ å€’ï¼Œé¡ºåºä¸åŒï¼Œåˆ™å˜æ¢ç»“æœä¸åŒã€‚</p><p>ï¼ˆ  T ï¼‰31.è£å‰ªå°±æ˜¯å°†æŒ‡å®šçª—å£ä½œä¸ºå›¾å½¢è¾¹ç•Œï¼Œä»ä¸€å¹…å¤§çš„ç”»é¢ä¸­æŠ½å–æ‰€éœ€çš„å…·ä½“ä¿¡æ¯ï¼Œä»¥æ˜¾ç¤ºæŸä¸€å±€éƒ¨ç”»é¢æˆ–è§†å›¾ã€‚</p><p>ï¼ˆ T ï¼‰32.è£å‰ªå®è´¨ä¸Šæ˜¯ä»æ•°æ®é›†åˆä¸­æŠ½å–ä¿¡æ¯çš„è¿‡ç¨‹ã€‚</p><p>ï¼ˆ  T ï¼‰33.è§†å›¾åŒºï¼ˆè§†å›¾Viewportï¼‰ï¼Œæ˜¯åœ¨å±å¹•ä¸Šå®šä¹‰çš„ä¸€ä¸ªå°äºæˆ–ç­‰äºå±å¹•åŒºåŸŸä¸€ä¸ªçŸ©å½¢å—ã€‚</p><p>ï¼ˆ  T ï¼‰34.çª—å£â€”è§†å›¾å˜æ¢æ˜¯æ¯”ä¾‹å˜æ¢å’Œå¹³ç§»å˜æ¢çš„ç»„åˆå˜æ¢ã€‚</p><p>ï¼ˆ F ï¼‰35.ä¸­ç‚¹åˆ†å‰²è£å‰ªæ³•ä¹Ÿå«æœ€è¿œï¼ˆæˆ–è¿‘ï¼‰çš„å¯è§ç‚¹ç®—æ³•ã€‚</p><p>ï¼ˆ  T ï¼‰36.çº¿æ®µè£å‰ªç¡®è‰¯çš„å¤šè¾¹å½¢è£å‰ªçš„åŸºç¡€ã€‚</p><p>ï¼ˆ T ï¼‰37.è£å‰ªå¤šè¾¹å½¢è¦è§£å†³ä¸¤ä¸ªé—®é¢˜ã€‚å…¶ä¸€æ˜¯ä¸€ä¸ªå®Œæ•´çš„å°é—­å¤šè¾¹å½¢ç»è£å‰ªåä¸€èˆ¬ä¸å†æ˜¯å°é—­çš„ï¼Œéœ€è¦ç”¨çª—å£è¾¹ç•Œé€‚å½“éƒ¨åˆ†æ¥å°é—­å®ƒã€‚å…¶äºŒæ˜¯çŸ©å½¢çª—å£çš„å››ä¸ªè§’ç‚¹åœ¨è£å‰ªä¸­æ˜¯å¦è¦ä¸å…¶å®ƒäº¤ç‚¹è¿çº¿ã€‚</p><p>ï¼ˆ T ï¼‰38.è®¡ç®—æœºå›¾å½¢å­¦ä¸­ï¼Œå¯ä»¥ç”¨æ›²çº¿ç½‘æ ¼æ¥è¿‘ä¼¼åœ°è¡¨ç¤ºè‡ªç”±æ›²é¢ã€‚</p><p>ï¼ˆ T ï¼‰39.åœ¨äº§ç”Ÿä¸€å¼ è‡ªç”±æ›²é¢æ—¶ï¼Œå¯ä»¥åˆ©ç”¨ä¸€ç³»åˆ—çš„çºµæ¨ªäº¤é”™ä¸”ç›¸äº’å¹³è¡Œçš„æ ·æ¡æ›²çº¿æ¥æ„é€ ã€‚</p><p>ï¼ˆ T ï¼‰40.åœ¨ç©ºé—´è§£æå‡ ä½•ä¸­ï¼Œä¸‰ç»´ç©ºé—´å†…ä¸€å¼ ä»»æ„æ›²é¢ç‰‡ç”¨ä¸¤ä¸ªå‚æ•°æ›²é¢çŸ¢é‡æ–¹ç¨‹æˆ–å‚æ•°æ–¹ç¨‹è¡¨ç¤ºã€‚</p><p>ï¼ˆ  T ï¼‰41.åœ¨ä¸‰ç»´ç©ºé—´é‡Œï¼Œç»™å®š(nï¼‹l)Ã—(m+1)ä¸ªç©ºé—´ç‚¹,å¯ç”ŸæˆnÃ—mæ¬¡å‚æ•°æ›²é¢ã€‚</p><p>ï¼ˆ F ï¼‰42.åŒäºŒæ¬¡Bezieræ›²é¢ç”±å››æ¡æŠ›ç‰©çº¿æ®µåŒ…å›´è€Œï¼Œä¸­é—´çš„ä¸€ä¸ªé¡¶ç‚¹çš„å˜åŒ–å¯¹è¾¹ç•Œæ›²çº¿ä¸äº§ç”Ÿå½±å“ï¼Œè¿™æ„å‘³ç€åœ¨å‘¨è¾¹å…«ç‚¹ä¸å˜çš„æƒ…å†µä¸‹ï¼Œé€‚å½“é€‰æ‹©ä¸­å¿ƒé¡¶ç‚¹çš„ä½ç½®å¯ä»¥æ§åˆ¶æ›²é¢å‡¹å‡¸ï¼Œè¿™ç§æ§åˆ¶æ–¹å¼æ˜¯æå…¶ç›´è§‚çš„ï¼Œè€Œä¸”æå…¶ç®€æ˜“ã€‚</p><p>ï¼ˆ T ï¼‰43.åŒä¸‰æ¬¡Bezieræ›²é¢ä¸­é—´çš„å››ä¸ªé¡¶ç‚¹çš„å˜åŒ–å¯¹è¾¹ç•Œæ›²çº¿ä¸äº§ç”Ÿå½±å“ï¼Œä½†å½±å“æ›²é¢ç‰‡çš„å½¢çŠ¶ã€‚</p><p>ï¼ˆ  T ï¼‰44.NURBSæ›²é¢æ‹¥æœ‰éå¸¸è‰¯å¥½çš„æ€§è´¨ï¼Œç›®å‰å·²ç»æˆä¸ºæ›²é¢é€ å‹ä¸­æœ€ä¸ºå¹¿æ³›åº”ç”¨çš„æŠ€æœ¯ã€‚</p><p>ï¼ˆ  T ï¼‰45.ä¸‰ç»´å›¾å½¢å‡ ä½•å˜æ¢åä»ç„¶æ˜¯ä¸‰ç»´å›¾å½¢ã€‚</p><p>ï¼ˆ  T ï¼‰46. ä¸‰ç»´å›¾å½¢æ—‹è½¬å˜æ¢å‰åç«‹ä½“çš„å¤§å°å’Œå½¢çŠ¶ä¸å‘ç”Ÿå˜åŒ–ï¼Œåªæ˜¯ç©ºé—´ä½ç½®ç›¸å¯¹åŸä½ç½®å‘ç”Ÿäº†å˜åŒ–ã€‚</p><p>ï¼ˆ T ï¼‰47.é€šå¸¸å›¾å½¢è¾“å‡ºè®¾å¤‡ï¼ˆæ˜¾ç¤ºå™¨ã€ç»˜å›¾ä»ªç­‰ï¼‰éƒ½æ˜¯äºŒç»´çš„ï¼Œç”¨è¿™äº›äºŒç»´è®¾å¤‡æ¥è¾“å‡ºä¸‰ç»´å›¾å½¢ï¼Œå°±å¾—æŠŠä¸‰ç»´åæ ‡ç³»ä¸‹å›¾å½¢ä¸Šå„ç‚¹çš„åæ ‡è½¬åŒ–ä¸ºæŸä¸€å¹³é¢åæ ‡ç³»ä¸‹çš„äºŒç»´åæ ‡ã€‚</p><p>ï¼ˆ  T ï¼‰48.æŠŠä¸‰ç»´ç‰©ä½“ç”¨äºŒç»´å›¾å½¢è¡¨ç¤ºçš„è¿‡ç¨‹ç§°ä¸ºä¸‰ç»´æŠ•å½±å˜æ¢ã€‚</p><p>ï¼ˆ  T ï¼‰49.æ–œè½´æµ‹æŠ•å½±æ˜¯å…ˆå°†ç«‹ä½“æ²¿ä¸¤ä¸ªæ–¹å‘äº§ç”Ÿé”™åˆ‡ï¼Œå†å‘æŠ•å½±é¢ä½œæ­£æŠ•å½±è€Œå¾—åˆ°ã€‚</p><p>ï¼ˆ T ï¼‰50.é€è§†å›¾æ˜¯ä¸€ç§å°†ä¸‰ç»´ç‰©ä½“ç”¨äºŒç»´å¹³é¢æ¥è¡¨è¾¾çš„ç«‹ä½“å›¾ã€‚</p><p>ï¼ˆ T ï¼‰51. å°†ç«‹ä½“ä¸Šå„ç‚¹ä¸è§†ç‚¹ç›¸è¿æ‰€å¾—åˆ°çš„æŠ•å½±çº¿åˆ†åˆ«ä¸æŠ•å½±é¢ç›¸äº¤ï¼Œå…¶äº¤ç‚¹å°±æ˜¯ç«‹ä½“ä¸Šç›¸åº”ç‚¹çš„é€è§†æŠ•å½±ï¼Œå†å°†å…¶ä¾æ¬¡ç›¸è¿ï¼Œå³è·å¾—å…·æœ‰çœŸå®ç«‹ä½“æ„Ÿçš„é€è§†å›¾ã€‚</p><p>ï¼ˆ F ï¼‰52.é€è§†å˜æ¢æ˜¯å°†ç©ºé—´ä¸­çš„ç‰©ä½“é€è§†æˆç©ºé—´ä¸­çš„å¦ä¸€ç‰©ä½“ï¼Œç„¶åå†æŠŠè¿™ä¸€ç‰©ä½“å½¢æŠ•å½±åˆ°ä¸€ä¸ªå¹³é¢ä¸Šï¼Œä»è€Œå¾—åˆ°é€è§†æŠ•å½±å›¾ã€‚</p><p>ï¼ˆ  F ï¼‰53.é€è§†æŠ•å½±æ˜¯é€è§†å˜æ¢ä¸å¹³è¡ŒæŠ•å½±å˜æ¢çš„ç»„åˆã€‚</p><p>ï¼ˆ T ï¼‰54.å½“è§†ç‚¹ä½äºYè½´ä¸Šæ—¶,Yè½´ä¸Šçš„æ— é™è¿œç‚¹ï¼»0 1 0 0ï¼½è¿›è¡Œé€è§†å˜æ¢åæˆä¸ºæœ‰é™è¿œç‚¹ï¼»0 lï¼q 0 1ï¼½ã€‚ç”±æ­¤å¯ä»¥è¯æ˜ï¼ŒåŸæ¥å¹³è¡ŒäºXè½´å’ŒZè½´ç›´çº¿å˜æ¢åä»å¹³è¡Œäºå¯¹åº”åæ ‡è½´ï¼Œä½†åŸä¸Yè½´å¹³è¡Œç›´çº¿ï¼Œé€è§†å˜æ¢åä¸å†ä¸Yè½´å¹³è¡Œï¼Œè€Œæ˜¯æ±‡äº¤äºYè½´ä¸Šä¸€ç‚¹ï¼ˆ0ï¼Œ1ï¼qï¼Œ0ï¼‰ ï¼Œè¯¥ç‚¹ç§°ä¸ºé€è§†çš„ç­ç‚¹ã€‚</p><p>ï¼ˆ T ï¼‰55.ä¸‰ç‚¹é€è§†: æŠ•å½±é¢Î±ä¸Xã€Yã€Zè½´å‡æœ‰äº¤ç‚¹ã€‚ä¸‰ç‚¹é€è§†å¯è½¬æ¢ä¸ºä¸€ç‚¹é€è§†è¿›è¡Œè®¡ç®—ã€‚</p><p>ï¼ˆ  T ï¼‰56.é€è§†æŠ•å½±ç¬¦åˆäººç±»çš„ç”Ÿç†æœºåˆ¶ï¼Œå³ç¦»è§†ç‚¹è¿‘çš„ç‰©ä½“å¤§ï¼Œç¦»è§†ç‚¹è¿œçš„ç‰©ä½“å°ï¼Œè¿œåˆ°æç‚¹å³ä¸ºæ¶ˆå¤±ï¼Œæˆä¸ºç­ç‚¹ã€‚</p><p>ï¼ˆ T ï¼‰57.ä¸€ä¸ªç‰©ä½“ç¦»è§‚å¯Ÿç‚¹è¶Šè¿œï¼Œé‚£ä¹ˆå®ƒè¶Šæœ‰å¯èƒ½è¢«å…¶ä»–ç‰©ä½“æ‰€é®æŒ¡ã€‚</p><p>ï¼ˆ T ï¼‰58.ç‰©ä½“ç©ºé—´ç®—æ³•æœ‰æ¯”è¾ƒé«˜çš„ç²¾åº¦ï¼Œç”Ÿæˆçš„å›¾å½¢å³ä½¿æ”¾å¤§ä¸€å®šå€æ•°åä»æœ‰ä»¤äººæ»¡æ„çš„è§‚æ„Ÿï¼Œå› æ­¤åœ¨æ¯”è¾ƒç²¾å¯†çš„å¯¹è±¡æ˜¾ç¤ºæ–¹é¢æœ‰è¾ƒå¤šçš„åº”ç”¨ã€‚</p><p>ï¼ˆ T ï¼‰59.å›¾åƒç©ºé—´çš„ç®—æ³•åœ¨ç²¾åº¦ä¸Šä¸åŠå‰è€…ï¼Œå®ƒæœ€å¤šåˆ°å±å¹•åˆ†è¾¨ç‡æ—¶å°±æ— æ³•å†æé«˜ç²¾åº¦ï¼Œä½†è®¡ç®—æ•ˆç‡è¾ƒé«˜ï¼Œå› ä¸ºåœ¨å›¾åƒç©ºé—´ä¸­å„ç§ç›¸å…³æ€§å¯ä»¥å¾—åˆ°å……åˆ†åº”ç”¨ï¼Œæ‰€ä»¥ä¹Ÿæœ‰è®¸å¤šæ–¹æ³•æ˜¯åœ¨å›¾åƒç©ºé—´ä¸­å®ç°çš„ã€‚</p><p>ï¼ˆ T ï¼‰60.èƒŒé¢æ¶ˆé™¤ç®—æ³•ä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„éšé¢æ¶ˆé™¤æ–¹æ³•ï¼Œä½†å®ƒæ˜¯éšé¢æ¶ˆé™¤ç®—æ³•ä¸­çš„å…³é”®éƒ¨åˆ†ã€‚</p><p>ï¼ˆ T ï¼‰61.å‡¸å¤šé¢ä½“æ˜¯æŒ‡è¿æ¥å½¢ä½“ä¸Šä¸å±äºåŒä¸€è¡¨é¢çš„ä»»æ„ä¸¤ç‚¹çš„çº¿æ®µå®Œå…¨ä½äºå½¢ä½“çš„å†…éƒ¨çš„å½¢ä½“ã€‚</p><p>ï¼ˆ T ï¼‰62.è‹¥ç‚¹Aã€Bã€Cä¸‰ä¸ªç‚¹ä¸­çš„ä»»æ„ä¸¤ç‚¹æ‰€æ„æˆçš„ä¸¤ä¸ªå‘é‡çš„å‰ä¹˜ä¸º0ï¼Œåˆ™ä¸‰ç‚¹å…±çº¿ã€‚</p><p>ï¼ˆ F ï¼‰63.æ ¹æ®ä¸‰è§’å½¢é¢ç§¯çš„åæ ‡è¡¨ç¤ºæ³•æ‰€å¾—åˆ°çš„é¢ç§¯çš„ç¬¦å·å¯åˆ¤åˆ«é¡¶ç‚¹çš„æ’åˆ—é¡ºåºï¼Œè‹¥ç¬¦å·ä¸ºæ­£æ˜¯é€†åºæ’åˆ—ï¼Œä¸ºè´Ÿåˆ™ä¸ºé¡ºåºæ’åˆ—ã€‚</p><p>ï¼ˆ T ï¼‰64.åœºæ™¯åæ ‡ç³»é€šå¸¸æ˜¯å³æ‰‹åæ ‡ç³»ã€‚</p><p>ï¼ˆ F ï¼‰65.è§‚å¯Ÿåæ ‡ç³»é€šå¸¸æ˜¯å·¦æ‰‹åæ ‡ç³»ã€‚</p><p>ï¼ˆ T ï¼‰66.é•œé¢åå°„å…‰ä¸ç‰©ä½“é¢œè‰²æ— å…³ï¼Œå³é•œé¢åå°„å…‰äº§ç”Ÿçš„é«˜å…‰åŒºåŸŸåªåæ˜ å…‰æºçš„é¢œè‰²ã€‚</p><p>ï¼ˆ T ï¼‰67.é˜´å½±æ˜¯æŒ‡æ™¯ç‰©ä¸­æ²¡æœ‰è¢«å…‰æºç›´æ¥ç…§å°„çš„æš—åŒºã€‚</p><p>ï¼ˆ T ï¼‰68. çº¹ç†ï¼šç‰©ä½“è¡¨é¢çš„ç»†èŠ‚ï¼Œåˆ†é¢œè‰²çº¹ç†å’Œå‡ ä½•çº¹ç†ã€‚</p><p>ï¼ˆ T ï¼‰69. é¢œè‰²çº¹ç†ï¼šæŒ‡å…‰æ»‘è¡¨é¢ä¸Šé™„åŠ èŠ±çº¹å’Œå›¾æ¡ˆ</p><p>ï¼ˆ T ï¼‰70. å‡ ä½•çº¹ç†ï¼šæ™¯ç‰©è¡¨é¢å¾®è§‚ä¸Šå‘ˆç°çš„èµ·ä¼ä¸å¹³ï¼›</p><p>(  T ) 71. ä¸€èˆ¬è€Œè¨€ï¼ŒçŸ¢é‡å›¾æ‰€éœ€è¦çš„å­˜å‚¨ç©ºé—´è¦æ¯”ä½å›¾å°å¾—å¤šã€‚</p><p>(  T ) 72. è‹¥ç”Ÿæˆçš„æ›²çº¿å¿…é¡»é€šè¿‡ç»™å®šçš„æ¯ä¸ªå‹å€¼ç‚¹ï¼Œè¿™ç§ç”Ÿæˆæ›²çº¿çš„æ–¹æ³•å«æ’å€¼æ³•ã€‚</p><p>(  T ) 73. ç”¨å°„çº¿ä¸å¤šè¾¹å½¢è¾¹ç•Œçš„äº¤ç‚¹ä¸ªæ•°å¯åˆ¤æ•°ä¸€ä¸ªç‚¹æ˜¯å¦æ˜¯è¯¥å¤šè¾¹å½¢çš„å†…ç‚¹ã€‚</p><p>(  T ) 74. ä¸€èˆ¬æƒ…å†µä¸‹,ä¸¤ä¸ªç©ºé—´ä¸‰ç»´å‘é‡v1ä¸v2çš„å‰ç§¯æ˜¯ä¸€ä¸ªæ–°çš„å‘é‡ã€‚</p><p>(  T ) 75. åœ¨è§†ç‚¹åæ ‡ç³»ä¸­ï¼Œè§†ç‚¹æ˜¯åŸç‚¹O(0ï¼Œ0ï¼Œ0)ï¼ŒæŠ•å½±é¢ç»è¿‡ç‚¹V(0ï¼Œ1ï¼Œ1)ï¼Œåˆ™ä¸OVå‚ç›´çš„æŠ•å½±é¢æ–¹ç¨‹æ˜¯y+z-1&#x3D;0ã€‚</p><p>( T ) 76. é½æ¬¡åæ ‡è¡¨ç¤ºæ³•å¯ä»¥åœ¨è®¡ç®—æœºä¸­è¡¨ç¤ºæ— ç©·è¿œç‚¹ã€‚</p><p>( T ) 77. å¯ä»¥ç”¨æ¢¯å½¢æ³•æ¥è®¡ç®—æœºå¹³é¢å¤šè¾¹å½¢çš„é¢ç§¯ã€‚</p><p>( F ) 78. åœ¨è¿›è¡Œæ‰«æçº¿å¤šè¾¹å½¢åŒºåŸŸå¡«å……æ—¶ï¼Œé€šå¸¸éœ€è¦æ„å»ºè¾¹ç»“ç‚¹ï¼Œè¾¹ç»“ç‚¹çš„æ•°æ®ç»“æ„ä¸€èˆ¬æœ‰åŒ…å«è¯¥è¾¹æ–œç‡ä¿¡æ¯åœ¨å†…çš„4ä¸ªåŸŸã€‚</p><p>( T ) 79. ç”±äºç‰©ä½“è¡¨é¢çš„ç²—ç³™å› ç´ é€ æˆå…¥å°„å…‰å‘å‘¨å›´å‡åŒ€åå°„çš„å…‰å«ç¯å¢ƒå…‰ã€‚</p><p>( F ) 80.ç»™å®šå¹³é¢ä¸Š4ä¸ªä¸åŒç‚¹å¯ä»¥ç”Ÿæˆä¸€æ®µ4æ¬¡è´å¡å°”æ›²çº¿ã€‚</p><p>( T ) 81. Windowsç»ç»å¸¸ç”¨å¥æŸ„ï¼ˆHandleï¼‰æ¥æ ‡è¯†å¯¹è±¡ã€‚ </p><p>( T ) 82.åŸºäºå•æ–‡æ¡£çš„MFCåº”ç”¨ç¨‹åºä¼šè‡ªåŠ¨ç”ŸæˆåŒ…æ‹¬åº”ç”¨ç¨‹åºç±»åœ¨å†…çš„åŸºæœ¬ç±»ã€‚</p><p>( T ) 83.C++ä¸­ç±»çš„ææ„å‡½æ•°å¯å®Œæˆä¸€äº›æ¸…ç†æ€§çš„ä»»åŠ¡ã€‚</p><p>( T ) 84.Z_Bufferç®—æ³•æ˜¯ä¸€ç§æ¶ˆéšç®—æ³•ã€‚ </p><p>(  T ) 85.å¤æ‚å˜æ¢é€šå¸¸å¯ä»¥ç”¨ä¸€ç³»åˆ—çš„åŸºæœ¬å˜æ¢çš„ç»„åˆæ¥å®ç°ã€‚</p><p>(  T ) 86. é¢œè‰²çº¹ç†ç”¨çº¹ç†æ˜ å°„æ¥å¤„ç†ï¼Œå‡ ä½•çº¹ç†ç”¨æ‰°åŠ¨å‡½æ•°æ¥æè¿°ã€‚</p><p>(  T ) 87.å›¾å½¢æ˜¾ç¤ºå™¨æ˜¯ç”±ä¸€ä¸ªä¸ªæ’åˆ—æœ‰åºçš„åƒç´ æ‰€æ„æˆï¼Œç”»ä¸€æ¡ç›´çº¿å®é™…ä¸Š</p><p>æ˜¯æ ¹æ®ä¸€ç³»åˆ—è®¡ç®—å‡ºæ¥å¹¶ä¸è¯¥çº¿é è¿‘çš„åƒç´ è€Œç»˜åˆ¶ã€‚</p><p>Phongå…‰ç…§æ˜æ¨¡å‹ä¸­ï¼Œåå°„å…‰æ˜¯ç”±å“ªå‡ éƒ¨åˆ†ç»„æˆçš„ï¼Ÿ</p><p>ç­”ï¼šç¯å¢ƒå…‰ï¼ˆAmbient Lightï¼‰ï¼šç¯å¢ƒå…‰æ¨¡æ‹Ÿäº†åœºæ™¯ä¸­æ‰€æœ‰ç‰©ä½“éƒ½ä¼šæ¥æ”¶åˆ°çš„é—´æ¥å…‰ç…§ï¼Œå³ä½¿å®ƒä»¬æ²¡æœ‰è¢«ç›´æ¥çš„å…‰æºç…§å°„ã€‚è¿™ç§å…‰ç…§é€šå¸¸ç”¨æ¥æä¾›åœºæ™¯çš„åŸºæœ¬äº®åº¦ï¼Œä½¿å¾—ç‰©ä½“å³ä½¿åœ¨é˜´å½±ä¸­ä¹Ÿèƒ½è¢«çœ‹åˆ°ã€‚</p><p>æ¼«åå°„å…‰ï¼ˆDiffuse Lightï¼‰ï¼šæ¼«åå°„å…‰æ¨¡æ‹Ÿäº†å…‰çº¿ç…§å°„åˆ°ç²—ç³™è¡¨é¢æ—¶å‘å„ä¸ªæ–¹å‘æ•£å°„çš„ç°è±¡ã€‚è¿™ç§å…‰ç…§å–å†³äºç‰©ä½“è¡¨é¢çš„æè´¨å±æ€§ï¼ˆå¦‚æ¼«åå°„ç³»æ•°ï¼‰å’Œå…‰çº¿ä¸è¡¨é¢æ³•çº¿ä¹‹é—´çš„è§’åº¦ã€‚æ¼«åå°„å…‰ç…§ä½¿å¾—ç‰©ä½“è¡¨é¢çœ‹èµ·æ¥å‡åŒ€å—å…‰ï¼Œå¹¶ä¸”é¢œè‰²å–å†³äºç‰©ä½“æè´¨çš„é¢œè‰²ã€‚</p><p>é•œé¢åå°„å…‰ï¼ˆSpecular Lightï¼‰ï¼šé•œé¢åå°„å…‰æ¨¡æ‹Ÿäº†å…‰çº¿ç…§å°„åˆ°å…‰æ»‘è¡¨é¢æ—¶åå°„çš„ç°è±¡ã€‚è¿™ç§å…‰ç…§äº§ç”Ÿé«˜å…‰ï¼ˆspecular highlightsï¼‰ï¼Œå…¶å¼ºåº¦å’Œä½ç½®å–å†³äºå…‰æºã€è§‚å¯Ÿè€…ã€ç‰©ä½“è¡¨é¢æ³•çº¿ä»¥åŠè¡¨é¢æè´¨çš„é•œé¢åå°„ç³»æ•°ã€‚é•œé¢åå°„å…‰ç…§ä½¿å¾—ç‰©ä½“è¡¨é¢çœ‹èµ·æ¥æœ‰å…‰æ³½ï¼Œå¹¶ä¸”é«˜å…‰çš„äº®åº¦éšç€è§‚å¯Ÿè§’åº¦çš„å˜åŒ–è€Œå˜åŒ–ã€‚</p><p>é—®é¢˜ï¼šä»€ä¹ˆæ˜¯æ­£è½´æµ‹æŠ•å½±å˜æ¢ï¼Ÿ</p><p>ç­”æ¡ˆï¼šæ­£è½´æµ‹æŠ•å½±å˜æ¢æ˜¯ä¸€ç§å°†ä¸‰ç»´ç‰©ä½“æŠ•å½±åˆ°äºŒç»´å¹³é¢ä¸Šçš„æ–¹æ³•ï¼Œå®ƒä¿æŒäº†ç‰©ä½“å„ä¸ªè½´ä¹‹é—´çš„æ¯”ä¾‹å…³ç³»ã€‚åœ¨æ­£è½´æµ‹æŠ•å½±ä¸­ï¼ŒæŠ•å½±çº¿ï¼ˆå…‰çº¿ï¼‰ä¸æŠ•å½±é¢ï¼ˆé€šå¸¸æ˜¯äºŒç»´å¹³é¢ï¼‰å‚ç›´ï¼Œä¸”æŠ•å½±çº¿ä¸ç‰©ä½“çš„ä¸‰ä¸ªä¸»è¦åæ ‡è½´ï¼ˆé€šå¸¸æ˜¯xã€yã€zè½´ï¼‰æˆç›¸åŒçš„å¤¹è§’ã€‚è¿™ç§æŠ•å½±æ–¹æ³•é€šå¸¸ç”¨äºå·¥ç¨‹åˆ¶å›¾å’Œè®¡ç®—æœºå›¾å½¢å­¦ä¸­ï¼Œå› ä¸ºå®ƒå¯ä»¥æä¾›ä¸€ä¸ªç‰©ä½“çš„ä¸‰ç»´è§†å›¾ï¼ŒåŒæ—¶ä¿æŒå„ä¸ªæ–¹å‘çš„æ¯”ä¾‹ä¸€è‡´ã€‚</p><p>æ­£è½´æµ‹æŠ•å½±å¯ä»¥è¿›ä¸€æ­¥åˆ†ä¸ºå‡ ç§ç±»å‹ï¼ŒåŒ…æ‹¬ï¼š</p><ol><li><p>æ­£ç­‰æµ‹æŠ•å½±ï¼ˆIsometric Projectionï¼‰ï¼šåœ¨æ­£ç­‰æµ‹æŠ•å½±ä¸­ï¼Œä¸‰ä¸ªè½´ä¹‹é—´çš„å¤¹è§’éƒ½æ˜¯120åº¦ï¼Œä¸”æ¯ä¸ªè½´çš„é•¿åº¦åœ¨æŠ•å½±ä¸­éƒ½è¢«ç¼©çŸ­åˆ°åŸå§‹é•¿åº¦çš„âˆš2&#x2F;2å€ï¼ˆå¤§çº¦æ˜¯åŸå§‹é•¿åº¦çš„70.7%ï¼‰ã€‚è¿™ç§æŠ•å½±ä¿æŒäº†ä¸‰ä¸ªè½´ä¹‹é—´çš„æ¯”ä¾‹å…³ç³»ï¼Œä½¿å¾—ç‰©ä½“åœ¨äºŒç»´è§†å›¾ä¸Šçœ‹èµ·æ¥æ˜¯ç­‰æ¯”ä¾‹çš„ã€‚</p></li><li><p>æ­£äºŒæµ‹æŠ•å½±ï¼ˆDimetric Projectionï¼‰ï¼šåœ¨æ­£äºŒæµ‹æŠ•å½±ä¸­ï¼Œä¸¤ä¸ªè½´ä¹‹é—´çš„å¤¹è§’æ˜¯120åº¦ï¼Œè€Œç¬¬ä¸‰ä¸ªè½´ä¸è¿™ä¸¤ä¸ªè½´çš„å¤¹è§’ä¸åŒã€‚è¿™ç§æŠ•å½±ä¿æŒäº†ä¸¤ä¸ªè½´ä¹‹é—´çš„æ¯”ä¾‹å…³ç³»ï¼Œä½†ç¬¬ä¸‰ä¸ªè½´çš„æ¯”ä¾‹å¯èƒ½ä¸åŒã€‚</p></li><li><p>æ­£ä¸‰æµ‹æŠ•å½±ï¼ˆTrimetric Projectionï¼‰ï¼šåœ¨æ­£ä¸‰æµ‹æŠ•å½±ä¸­ï¼Œä¸‰ä¸ªè½´ä¹‹é—´çš„å¤¹è§’éƒ½ä¸ç›¸åŒï¼Œä¸”æ¯ä¸ªè½´çš„é•¿åº¦åœ¨æŠ•å½±ä¸­éƒ½è¢«ç¼©çŸ­åˆ°ä¸åŒçš„æ¯”ä¾‹ã€‚è¿™ç§æŠ•å½±ä¸ä¿æŒä»»ä½•è½´ä¹‹é—´çš„æ¯”ä¾‹å…³ç³»ï¼Œå› æ­¤ç‰©ä½“çš„å½¢çŠ¶åœ¨äºŒç»´è§†å›¾ä¸Šå¯èƒ½çœ‹èµ·æ¥æœ‰äº›æ‰­æ›²ã€‚</p></li></ol><p>æ­£è½´æµ‹æŠ•å½±å˜æ¢åœ¨å·¥ç¨‹åˆ¶å›¾ä¸­éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå¯ä»¥æä¾›ä¸€ä¸ªæ¸…æ™°çš„ã€æ˜“äºç†è§£çš„ç‰©ä½“ä¸‰ç»´è§†å›¾ï¼ŒåŒæ—¶é¿å…äº†é€è§†æŠ•å½±ä¸­ç”±äºè·ç¦»é€ æˆçš„å°ºå¯¸å˜åŒ–ã€‚åœ¨è®¡ç®—æœºå›¾å½¢å­¦ä¸­ï¼Œæ­£è½´æµ‹æŠ•å½±ä¹Ÿç”¨äºåˆ›å»ºæŠ€æœ¯å›¾å’Œæ¦‚å¿µè®¾è®¡å›¾ï¼Œå› ä¸ºå®ƒå¯ä»¥æä¾›ä¸€ç§ç›´è§‚çš„æ–¹å¼æ¥å±•ç¤ºç‰©ä½“çš„ä¸‰ç»´ç»“æ„ã€‚</p><p>é—®é¢˜ï¼šèƒŒé¢æ¶ˆé™¤ç®—æ³•çš„åŸºæœ¬æ­¥éª¤ã€‚</p><p>ç­”æ¡ˆï¼š</p><p>1.ç¡®å®šå¤šè¾¹å½¢çš„æ³•çº¿ï¼š å¯¹äºæ¯ä¸ªå¤šè¾¹å½¢ï¼Œè®¡ç®—å…¶æ³•çº¿å‘é‡ã€‚æ³•çº¿å‘é‡æ˜¯å‚ç›´äºå¤šè¾¹å½¢å¹³é¢çš„å‘é‡ï¼Œå¯ä»¥é€šè¿‡å–å¤šè¾¹å½¢ä¸Šä¸¤ä¸ªéå…±çº¿è¾¹çš„å‰ç§¯æ¥å¾—åˆ°ã€‚</p><p>2.è®¡ç®—è§‚å¯Ÿè€…åˆ°å¤šè¾¹å½¢çš„å‘é‡ï¼š ç¡®å®šè§‚å¯Ÿè€…çš„ä½ç½®ï¼ˆé€šå¸¸ä¸ºæ‘„åƒæœºä½ç½®ï¼‰ï¼Œå¹¶è®¡ç®—ä»è§‚å¯Ÿè€…ä½ç½®åˆ°å¤šè¾¹å½¢ä¸­å¿ƒçš„å‘é‡ã€‚</p><p>3.è®¡ç®—æ³•çº¿ä¸è§‚å¯Ÿè€…å‘é‡çš„ç‚¹ç§¯ï¼š å°†å¤šè¾¹å½¢çš„æ³•çº¿å‘é‡ä¸è§‚å¯Ÿè€…åˆ°å¤šè¾¹å½¢ä¸­å¿ƒçš„å‘é‡è¿›è¡Œç‚¹ç§¯è¿ç®—ã€‚ç‚¹ç§¯çš„ç»“æœæ˜¯ä¸€ä¸ªæ ‡é‡ï¼Œè¡¨ç¤ºä¸¤ä¸ªå‘é‡çš„å¤¹è§’çš„ä½™å¼¦å€¼ã€‚</p><p>4.åˆ¤æ–­å¤šè¾¹å½¢çš„å¯è§æ€§ï¼š</p><p>å¦‚æœç‚¹ç§¯ç»“æœå¤§äº0ï¼Œåˆ™è¡¨ç¤ºæ³•çº¿å‘é‡ä¸è§‚å¯Ÿè€…å‘é‡ä¹‹é—´çš„å¤¹è§’å°äº90åº¦ï¼Œå³å¤šè¾¹å½¢é¢å‘è§‚å¯Ÿè€…ï¼Œå› æ­¤æ˜¯å¯è§çš„ã€‚</p><p>å¦‚æœç‚¹ç§¯ç»“æœå°äºæˆ–ç­‰äº0ï¼Œåˆ™è¡¨ç¤ºæ³•çº¿å‘é‡ä¸è§‚å¯Ÿè€…å‘é‡ä¹‹é—´çš„å¤¹è§’å¤§äºæˆ–ç­‰äº90åº¦ï¼Œå³å¤šè¾¹å½¢èƒŒå‘è§‚å¯Ÿè€…ï¼Œå› æ­¤æ˜¯ä¸å¯è§çš„ã€‚</p><p>5.æ¶ˆé™¤èƒŒé¢å¤šè¾¹å½¢ï¼š å¯¹äºé‚£äº›è¢«åˆ¤å®šä¸ºä¸å¯è§çš„å¤šè¾¹å½¢ï¼Œè·³è¿‡å®ƒä»¬çš„æ¸²æŸ“è¿‡ç¨‹ï¼Œä¸è¿›è¡Œè¿›ä¸€æ­¥çš„ç»˜åˆ¶æ“ä½œã€‚</p><p>6.æ¸²æŸ“å¯è§å¤šè¾¹å½¢ï¼š å¯¹äºé‚£äº›è¢«åˆ¤å®šä¸ºå¯è§çš„å¤šè¾¹å½¢ï¼Œç»§ç»­è¿›è¡Œæ¸²æŸ“è¿‡ç¨‹ï¼ŒåŒ…æ‹¬å…‰ç…§è®¡ç®—ã€çº¹ç†æ˜ å°„ç­‰ã€‚</p><p>è¯·å†™å‡ºæ‰«æçº¿å¤šè¾¹å½¢åŒºåŸŸå¡«å……çš„ç®—æ³•è¿‡ç¨‹ã€‚</p><p>ç­”æ¡ˆï¼š<strong>é¢„å¤„ç†å¤šè¾¹å½¢ï¼Œæ„å»ºæ´»åŠ¨è¾¹è¡¨ï¼ˆ<strong><strong>AET</strong></strong>ï¼‰ï¼Œæ‰«æçº¿éå†ï¼Œå¤„ç†æ´»åŠ¨è¾¹è¡¨ï¼Œæ›´æ–°æ´»åŠ¨è¾¹è¡¨ï¼Œé‡å¤æ­¥éª¤<strong><strong>3-5</strong></strong>ï¼Œç»“æŸ</strong></p><p>ä¸‰æ¬¡è´å¡å°”æ›²çº¿æ®µçš„æœ‰å…³è®¡ç®—</p><p>ç­”ï¼š</p><p>äºŒç»´ã€ä¸‰ç»´å‡ ä½•å˜æ¢</p><p>ç­”ï¼š</p><p>äºŒç»´å‡ ä½•å˜æ¢ï¼š</p><p>å¹³ç§»å˜æ¢ï¼šå°†å›¾å½¢æ²¿ç€xè½´å’Œyè½´ç§»åŠ¨ä¸€å®šçš„è·ç¦»</p><p>æ—‹è½¬å˜æ¢ï¼šå›´ç»•åŸç‚¹æˆ–ä»»æ„ç‚¹æ—‹è½¬å›¾å½¢</p><p>ç¼©æ”¾å˜æ¢ï¼šæ”¾å¤§æˆ–ç¼©å°å›¾å½¢ã€‚</p><p>å‰ªåˆ‡å˜æ¢ï¼šæ²¿xè½´æˆ–yè½´æ–¹å‘å€¾æ–œå›¾å½¢</p><p>åå°„å˜æ¢ï¼šæ²¿xè½´æˆ–yè½´ç¿»è½¬å›¾å½¢</p><p>ä¸‰ä½å‡ ä½•å˜æ¢ï¼š</p><p>å¹³ç§»å˜æ¢ï¼šå°†å›¾å½¢æ²¿ç€xè½´ã€yè½´å’Œzè½´ç§»åŠ¨ã€‚</p><p>æ—‹è½¬å˜æ¢ï¼šå°†å›¾å½¢æ²¿ç€xè½´ã€yè½´å’Œzè½´ç§»åŠ¨ã€‚</p><p>ç¼©æ”¾å˜æ¢ï¼šæ”¾å¤§æˆ–ç¼©å°å›¾å½¢</p><p>å‰ªåˆ‡å˜æ¢ï¼šå°†å›¾å½¢æ²¿ç€xè½´ã€yè½´å’Œzè½´ç§»åŠ¨ã€‚</p><p>åå°„å˜æ¢ï¼šæ²¿xè½´ã€yè½´æˆ–zè½´ç¿»è½¬å›¾å½¢ã€‚</p><p>DDAã€é€ç‚¹æ¯”è¾ƒæ³•ç”»ç›´çº¿æ®µ</p><p>ç­”ï¼š</p><p>DDAæ­¥éª¤ï¼š</p><p><img src="clip_image002-1719382350883-1.png" alt="å±å¹•æˆªå›¾ 2024-06-13 115224"></p><p>é€ç‚¹æ¯”è¾ƒæ³•;</p><p><img src="clip_image004-1719382350883-2.png" alt="å±å¹•æˆªå›¾ 2024-06-13 115634"></p><p><strong>å·²çŸ¥å¹³é¢å››ç‚¹ä¾æ¬¡æ˜¯P0(0,0)ï¼ŒP1(1,1)ï¼ŒP2(2,1)ï¼ŒP3(3,0)ã€‚ç”¨å…¶ä½œä¸ºç‰¹å¾å¤šè¾¹å½¢P0P1P2P3æ¥æ„é€ ä¸€æ¡ä¸‰æ¬¡è´å¡å°”æ›²çº¿æ®µï¼Œè¯·å†™å‡ºè¯¥æ›²çº¿çš„å‚æ•°åŒ–è¡¨è¾¾å¼ï¼Œå¹¶åˆ†åˆ«è®¡ç®—å‚æ•°ä¸º1ã€2&#x2F;3æ—¶æ›²çº¿ä¸Šç‚¹çš„å€¼ã€‚</strong></p><p><strong>ç­”ï¼šè¡¨è¾¾å¼ï¼š<img src="clip_image005-1719382350884-5.png" alt="å±å¹•æˆªå›¾ 2024-06-13 120039"></strong></p><p><strong>è®¡ç®—<img src="clip_image007-1719382350884-3.png" alt="å±å¹•æˆªå›¾ 2024-06-13 120154"></strong></p><p><strong>ç®€è¿°GouraudåŒçº¿æ€§æ’å€¼ç®—æ³•çš„åŸºæœ¬æ­¥éª¤ã€‚</strong></p><p><strong>ç­”ï¼š</strong>1.é¡¶ç‚¹ç€è‰²ï¼šé¦–å…ˆï¼Œä¸ºå¤šè¾¹å½¢çš„æ¯ä¸ªé¡¶ç‚¹åˆ†é…é¢œè‰²å€¼ã€‚</p><p>2.è®¡ç®—è¾¹ä¸Šçš„é¢œè‰²æ¢¯åº¦ï¼šå¯¹äºå¤šè¾¹å½¢çš„æ¯æ¡è¾¹ï¼Œè®¡ç®—ä¸¤ä¸ªé¡¶ç‚¹ä¹‹é—´çš„é¢œè‰²æ¢¯åº¦ï¼Œå³é¢œè‰²å˜åŒ–ç‡ã€‚</p><p>3.çº¿æ€§æ’å€¼ï¼šæ²¿ç€æ¯æ¡è¾¹ï¼Œæ ¹æ®å‚æ•° ğ‘¡ï¼ˆé€šå¸¸æ˜¯ä»0åˆ°1çš„å€¼ï¼Œè¡¨ç¤ºä»ä¸€ä¸ªé¡¶ç‚¹åˆ°å¦ä¸€ä¸ªé¡¶ç‚¹çš„ä½ç½®ï¼‰ï¼Œä½¿ç”¨çº¿æ€§æ’å€¼è®¡ç®—è¾¹ä¸Šçš„æ¯ä¸ªç‚¹çš„é¢œè‰²ã€‚</p><p>4.å¡«å……å¤šè¾¹å½¢ï¼šä½¿ç”¨æ‰«æçº¿ç®—æ³•å¡«å……å¤šè¾¹å½¢å†…éƒ¨ã€‚å¯¹äºæ‰«æçº¿ä¸Šçš„æ¯ä¸ªç‚¹ï¼Œæ ¹æ®è¯¥ç‚¹æ‰€åœ¨çš„æ°´å¹³ä½ç½®ï¼Œä½¿ç”¨ç›¸é‚»è¾¹çš„é¢œè‰²æ’å€¼ç»“æœæ¥è®¡ç®—è¯¥ç‚¹çš„é¢œè‰²ã€‚</p><p><strong>å¦‚ä¸‹å›¾æ‰€ç¤ºä¸‰è§’å½¢ABCï¼Œå°†å…¶å…³äºAç‚¹é¡ºæ—¶é’ˆæ—‹è½¬2700ï¼Œå†™å‡ºå…¶å˜æ¢çŸ©é˜µå’Œå˜æ¢åå›¾å½¢å„ç‚¹çš„åæ ‡ã€‚</strong></p><p><img src="clip_image009-1719382350884-4.png" alt="img"></p><p><strong>ç®€è¿°è®¡ç®—æœºå›¾å½¢çš„åˆ†ç±»åŠå…¶ç‰¹ç‚¹</strong><strong>:</strong></p><p>è®¡ç®—æœºå›¾å½¢ä¸»è¦åˆ†ä¸ºä¸¤å¤§ç±»ï¼šåŸºäºçº¿æ¡ä¿¡æ¯çš„å›¾å½¢å’ŒçœŸå®æ„Ÿå›¾å½¢ã€‚</p><p>åŸºäºçº¿æ¡ä¿¡æ¯çš„å›¾å½¢ï¼š</p><p>ç‰¹ç‚¹ï¼šè¿™ç±»å›¾å½¢ä¸»è¦ä½¿ç”¨çº¿æ¡æ¥è¡¨ç¤ºç‰©ä½“çš„è½®å»“å’Œç»“æ„ï¼Œä¾‹å¦‚å·¥ç¨‹å›¾ã€ç­‰é«˜çº¿åœ°å›¾ã€æ›²é¢çš„çº¿æ¡†å›¾ç­‰ã€‚</p><p>åº”ç”¨ï¼šå¸¸ç”¨äºå·¥ç¨‹è®¾è®¡å’Œåœ°ç†ä¿¡æ¯ç³»ç»Ÿç­‰é¢†åŸŸï¼Œå¼ºè°ƒç‰©ä½“çš„ç»“æ„å’Œå‡ ä½•å½¢çŠ¶ã€‚</p><p>çœŸå®æ„Ÿå›¾å½¢ï¼š</p><p>ç‰¹ç‚¹ï¼šè¿™ç±»å›¾å½¢é€šè¿‡æ¨¡æ‹Ÿå…‰çº¿åœ¨ç‰©ä½“è¡¨é¢çš„åå°„ã€æŠ˜å°„ã€æ•£å°„ç­‰ç°è±¡ï¼Œæ¥åˆ›å»ºå…·æœ‰çœŸå®æ„Ÿçš„å›¾åƒã€‚å®ƒä»¬é€šå¸¸åŒ…å«æ˜æš—ã€çº¹ç†ã€é˜´å½±ç­‰ç»†èŠ‚ã€‚</p><p>åº”ç”¨ï¼šå¹¿æ³›åº”ç”¨äºç”µå½±ã€æ¸¸æˆã€è™šæ‹Ÿç°å®ç­‰é¢†åŸŸï¼Œç”¨äºåˆ›å»ºé€¼çœŸçš„è§†è§‰æ•ˆæœã€‚</p><p>è®¡ç®—æœºå›¾å½¢çš„è¿™ä¸¤ç±»å„æœ‰ç‰¹ç‚¹ï¼ŒåŸºäºçº¿æ¡ä¿¡æ¯çš„å›¾å½¢å¼ºè°ƒç»“æ„å’Œè½®å»“ï¼Œè€ŒçœŸå®æ„Ÿå›¾å½¢åˆ™æ³¨é‡å›¾åƒçš„çœŸå®æ€§å’Œç»†èŠ‚ã€‚</p><p>é—®é¢˜ï¼šè¯·å†™å‡ºå¤šè¾¹å½¢åŒºåŸŸå¡«å……çš„ç®—æ³•è¿‡ç¨‹:</p><p>1.<strong>å¤šè¾¹å½¢è¡¨ç¤º</strong>ï¼š</p><p>ä½¿ç”¨é¡¶ç‚¹åˆ—è¡¨æ¥è¡¨ç¤ºå¤šè¾¹å½¢ï¼Œæ¯ä¸ªé¡¶ç‚¹åŒ…å«å…¶åæ ‡ï¼ˆx, yï¼‰ã€‚</p><p>2.<strong>æ’åºé¡¶ç‚¹</strong>ï¼š</p><p>å°†å¤šè¾¹å½¢çš„é¡¶ç‚¹æŒ‰ç…§yåæ ‡è¿›è¡Œæ’åºï¼Œå¦‚æœyåæ ‡ç›¸åŒï¼Œåˆ™æŒ‰ç…§xåæ ‡æ’åºã€‚</p><p>3.<strong>æ‰«æçº¿å¤„ç†</strong>ï¼š</p><p>ä»yåæ ‡æœ€å°çš„é¡¶ç‚¹å¼€å§‹ï¼Œæ²¿ç€yè½´å‘ä¸Šæ‰«æã€‚</p><p>å¯¹äºæ¯æ¡æ‰«æçº¿ï¼Œæ‰¾åˆ°ä¸è¯¥æ‰«æçº¿ç›¸äº¤çš„æ‰€æœ‰å¤šè¾¹å½¢è¾¹ã€‚</p><p>è¿™äº›è¾¹å°†æ‰«æçº¿åˆ†æˆè‹¥å¹²ä¸ªåŒºé—´ï¼Œæ¯ä¸ªåŒºé—´å¯¹åº”å¤šè¾¹å½¢å†…éƒ¨çš„ä¸€ä¸ªæ°´å¹³çº¿æ®µã€‚</p><p>4.<strong>è¾¹è¡¨ï¼ˆETï¼‰å’Œæ´»åŠ¨è¾¹è¡¨ï¼ˆAETï¼‰</strong>ï¼š</p><p>åˆ›å»ºè¾¹è¡¨ï¼ˆEdge Table, ETï¼‰ï¼Œç”¨äºå­˜å‚¨æ¯æ¡æ‰«æçº¿ä¸å¤šè¾¹å½¢è¾¹ç›¸äº¤çš„ä¿¡æ¯ã€‚</p><p>åˆ›å»ºæ´»åŠ¨è¾¹è¡¨ï¼ˆActive Edge Table, AETï¼‰ï¼Œç”¨äºå­˜å‚¨å½“å‰æ‰«æçº¿ä¸Šçš„æ‰€æœ‰æ´»åŠ¨è¾¹ã€‚</p><p>5.<strong>å¤„ç†äº¤ç‚¹</strong>ï¼š</p><p>å¯¹äºæ¯æ¡æ‰«æçº¿ï¼Œå°†æ‰€æœ‰ä¸æ‰«æçº¿ç›¸äº¤çš„è¾¹çš„äº¤ç‚¹æŒ‰xåæ ‡æ’åºã€‚</p><p>å°†äº¤ç‚¹æ·»åŠ åˆ°AETä¸­ï¼Œå¹¶æ›´æ–°ETä¸­çš„è¾¹ä¿¡æ¯ã€‚</p><p>6.<strong>å¡«å……åƒç´ </strong>ï¼š</p><p>å¯¹äºAETä¸­çš„æ¯ä¸€å¯¹ç›¸é‚»äº¤ç‚¹ï¼Œå¡«å……å®ƒä»¬ä¹‹é—´çš„æ‰€æœ‰åƒç´ ç‚¹ã€‚</p><p>å¦‚æœå¤šè¾¹å½¢æ˜¯é—­åˆçš„ï¼Œåˆ™ä¸éœ€è¦è€ƒè™‘äº¤ç‚¹çš„å¥‡å¶æ€§ï¼›å¦‚æœä¸æ˜¯é—­åˆçš„ï¼Œåˆ™åªå¡«å……äº¤ç‚¹ä¸ºå¥‡æ•°ä¸ªçš„åŒºé—´ã€‚</p><p>7.<strong>æ›´æ–°AET</strong>ï¼š</p><p>åœ¨å¡«å……å®Œä¸€ä¸ªåŒºé—´åï¼Œæ›´æ–°AETï¼Œç§»é™¤å·²ç»ç¦»å¼€æ‰«æçº¿çš„è¾¹ï¼Œå¹¶æ·»åŠ æ–°çš„è¿›å…¥æ‰«æçº¿çš„è¾¹ã€‚</p><p>8.<strong>é‡å¤æ­¥éª¤</strong>ï¼š</p><p>é‡å¤æ­¥éª¤3åˆ°7ï¼Œç›´åˆ°å¤„ç†å®Œæ‰€æœ‰æ‰«æçº¿ã€‚</p><p>9.<strong>ç»“æŸ</strong>ï¼š</p><p>å½“æ‰€æœ‰æ‰«æçº¿éƒ½å¤„ç†å®Œæ¯•åï¼Œå¤šè¾¹å½¢å¡«å……å®Œæˆã€‚</p><p><strong>åœ¨å¦‚ä¸‹å›¾æ‰€ç¤ºçš„åæ ‡ç³»ä¸­ï¼Œæœ‰ä¸€ç©ºé—´ç‚¹Aç»•ç›´çº¿Læ—‹è½¬Î¸è§’ååˆ°ç‚¹Bï¼Œè¯•åˆ†æåˆ©ç”¨åŸºæœ¬çš„å¹³ç§»åŠæ—‹è½¬çŸ©é˜µè§£ç®—Bç‚¹ä½ç½®çš„æ­¥éª¤ã€‚</strong></p><p><img src="image-20240705232433572.png" alt="image-20240705232433572"></p><p><img src="image-20240705232446420.png" alt="image-20240705232446420"></p><p>å†™å‡ºé€ç‚¹æ¯”è¾ƒæ³•ç”»çº¿ç®—æ³•çš„åŸç†,å¹¶ç¼–å†™ä»ç‚¹ï¼ˆ20ï¼Œ10ï¼‰åˆ°ç‚¹ï¼ˆ60ï¼Œ20ï¼‰çš„Cç¨‹åºã€‚</p><p>å†™å‡ºDDAç”»ç›´çº¿ç®—æ³•çš„åŸç†ï¼Œå¹¶å†™å‡ºå®ç°è¯¥ç®—æ³•çš„Cç¨‹åº</p><p><img src="clip_image015-1719382350884-8.png" alt="å±å¹•æˆªå›¾ 2024-06-13 171637"><img src="clip_image017-1719382350884-9.png" alt="å±å¹•æˆªå›¾ 2024-06-13 171714"></p><p>å†™å‡ºæ‰«æçº¿ç§å­å¡«å……ç®—æ³•çš„æ­¥éª¤</p><p>ç­”ï¼š</p><p>1.åˆå§‹åŒ–ç§å­ç‚¹ï¼šé¦–å…ˆï¼Œé€‰æ‹©ä¸€ä¸ªç§å­ç‚¹ä½œä¸ºå¡«å……è¿‡ç¨‹çš„èµ·ç‚¹ã€‚è¿™ä¸ªç§å­ä½äºéœ€è¦å¡«å……çš„åŒºåŸŸå†…éƒ¨ã€‚</p><p>2.å¡«å……ç§å­ç‚¹æ‰€åœ¨çš„æ‰«æçº¿ï¼šä»ç§å­ç‚¹å¼€å§‹ï¼Œå‘å·¦å’Œå‘å³å¡«å……ç§å­ç‚¹æ‰€åœ¨çš„æ‰«æçº¿ä¸Šçš„åƒç´ ï¼Œç›´åˆ°é‡åˆ°è¾¹ç•Œåƒç´ ã€‚</p><p>3.è®°å½•å¡«å……åŒºåŸŸçš„è¾¹ç•Œï¼šåœ¨å¡«å……è¿‡ç¨‹ä¸­ï¼Œè®°å½•ä¸‹å¡«å……åŒºåŸŸçš„å·¦è¾¹ç•Œå’Œå³è¾¹ç•Œï¼Œè¿™äº›è¾¹ç•Œæ˜¯å¡«å……è¿‡ç¨‹ä¸­é‡åˆ°çš„ç¬¬ä¸€ä¸ªéå¡«å……åƒç´ ã€‚</p><p>4.æ£€æŸ¥ç›¸é‚»çš„æ‰«æçº¿ï¼šå¯¹äºå½“å‰æ‰«æçº¿ä¸Šçš„å¡«å……åŒºåŸŸï¼Œæ£€æŸ¥ä¸å®ƒç›¸é‚»çš„ä¸Šä¸€ä¸ªæ‰«æçº¿å’Œä¸‹ä¸€ä¸ªæ‰«æçº¿ã€‚åœ¨ç›¸é‚»çš„æ‰«æçº¿ä¸Šï¼Œä»è®°å½•çš„å·¦è¾¹ç•Œå¼€å§‹å‘å³æœç´¢ï¼Œç›´åˆ°é‡åˆ°è¾¹ç•Œåƒç´ æˆ–å·²å¡«å……çš„åƒç´ ã€‚</p><p>5.æ‰¾åˆ°æ–°çš„ç§å­ç‚¹ï¼šå¦‚æœåœ¨ç›¸é‚»çš„æ‰«æçº¿ä¸Šæ‰¾åˆ°äº†æœªå¡«å……çš„åƒç´ ï¼Œé‚£ä¹ˆè¿™ä¸ªåƒç´ å°†æˆä¸ºæ–°çš„ç§å­ç‚¹ã€‚å°†è¿™ä¸ªç§å­ç‚¹å‹å…¥ä¸€ä¸ªæ ˆä¸­ï¼Œç”¨äºåç»­çš„å¡«å……è¿‡ç¨‹ã€‚</p><p>6.é‡å¤å¡«å……è¿‡ç¨‹ï¼šé‡å¤æ­¥éª¤4å’Œæ­¥éª¤5ï¼Œç›´åˆ°æ ˆä¸ºç©ºï¼Œå³æ‰€æœ‰çš„ç§å­ç‚¹éƒ½å·²ç»å¤„ç†å®Œæ¯•ã€‚</p><p>7.ç»“æŸå¡«å……ï¼šå½“æ ˆä¸ºç©ºæ—¶ï¼Œå¡«å……è¿‡ç¨‹ç»“æŸã€‚</p><p>è¯•æ¨å¯¼åœ¨ç¬›å¡å°”åæ ‡ç³»ä¸­ï¼Œç©ºé—´ç‚¹Aï¼ˆx,y,zï¼‰ç»•Zè½´æ—‹è½¬Î¸è§’çš„æ—‹è½¬çŸ©é˜µ.</p><p>ä»€ä¹ˆæ˜¯æ­£è½´æµ‹æŠ•å½±å˜æ¢ï¼Ÿè¯•æ¨å¯¼æ­£è½´æµ‹æŠ•å½±å˜æ¢çš„å˜æ¢çŸ©é˜µ</p><p>å†™å‡ºè´å¡å°”æ›²é¢çš„å®šä¹‰åŠå…¶çŸ©é˜µè¡¨ç¤ºå½¢å¼</p><p>ç®€è¿°ä¸‰ç»´æŠ•å½±å˜æ¢åˆ†ç±»</p><p>å†™å‡ºZ_Bufferç®—æ³•çš„åŸºæœ¬æ­¥éª¤.</p><p>Phongå…‰ç…§æ˜æ¨¡å‹ä¸­ï¼Œåå°„å…‰æ˜¯ç”±å“ªå‡ éƒ¨åˆ†ç»„æˆçš„ï¼Ÿå†™å‡ºPhongæ¨¡å‹çš„è¡¨è¾¾å½¢å¼.</p><p>ç»„æˆï¼š</p><ol><li>ç¯å¢ƒå…‰åå°„ï¼ˆAmbient Reflectionï¼‰ï¼šè¿™æ˜¯ç”±ç¯å¢ƒå…‰å¼•èµ·çš„å‡åŒ€ç…§æ˜ï¼Œå®ƒæ¨¡æ‹Ÿäº†å…‰çº¿åœ¨åœºæ™¯ä¸­å¤šæ¬¡åå°„åå½¢æˆçš„æŸ”å’Œå…‰çº¿ã€‚ç¯å¢ƒå…‰åå°„ä¸ä¾èµ–äºå…‰æºçš„ä½ç½®å’Œæ–¹å‘ã€‚</li><li>æ¼«åå°„ï¼ˆDiffuse Reflectionï¼‰ï¼šè¿™æ˜¯ç”±å…‰æºç›´æ¥ç…§å°„åœ¨ç‰©ä½“è¡¨é¢åï¼Œç”±äºè¡¨é¢ç²—ç³™ä¸å¹³è€Œå‘å„ä¸ªæ–¹å‘æ•£å°„çš„å…‰çº¿ã€‚æ¼«åå°„å…‰çš„å¼ºåº¦ä¸å…‰æºçš„ä½ç½®å’Œæ–¹å‘æœ‰å…³ï¼Œä½†ä¸è§‚å¯Ÿè€…çš„ä½ç½®æ— å…³ã€‚</li></ol><p>3.é•œé¢åå°„ï¼ˆSpecular Reflectionï¼‰ï¼šè¿™æ˜¯ç”±å…‰æºç›´æ¥ç…§å°„åœ¨ç‰©ä½“è¡¨é¢åï¼Œç”±äºè¡¨é¢å…‰æ»‘è€Œå‘ç‰¹å®šæ–¹å‘åå°„çš„å…‰çº¿ã€‚é•œé¢åå°„å…‰çš„å¼ºåº¦ä¸å…‰æºçš„ä½ç½®ã€è§‚å¯Ÿè€…çš„ä½ç½®ä»¥åŠç‰©ä½“è¡¨é¢çš„å…‰æ»‘ç¨‹åº¦æœ‰å…³ã€‚</p><p>è¡¨è¾¾å½¢å¼ï¼š<img src="clip_image019-1719382350884-10.png" alt="å±å¹•æˆªå›¾ 2024-06-13 172531"></p>]]></content>
    
    
    <categories>
      
      <category>å­¦æ ¡è¯¾ç¨‹</category>
      
      <category>å¤ä¹ é¢˜</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¤ä¹ é¢˜</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç®—æ³•è®¾è®¡å¤ä¹ é¢˜</title>
    <link href="/post/0194fff0752e/"/>
    <url>/post/0194fff0752e/</url>
    
    <content type="html"><![CDATA[<h3 id="ç¬¬1ç« -ç®—æ³•æ¦‚è¿°"><a href="#ç¬¬1ç« -ç®—æ³•æ¦‚è¿°" class="headerlink" title="ç¬¬1ç«  ç®—æ³•æ¦‚è¿°"></a>ç¬¬1ç«  ç®—æ³•æ¦‚è¿°</h3><h4 id="ç®—æ³•çš„æ¦‚å¿µåŠæ€§è´¨"><a href="#ç®—æ³•çš„æ¦‚å¿µåŠæ€§è´¨" class="headerlink" title="ç®—æ³•çš„æ¦‚å¿µåŠæ€§è´¨"></a>ç®—æ³•çš„æ¦‚å¿µåŠæ€§è´¨</h4><p>ç®—æ³•æ˜¯è§£å†³é—®é¢˜çš„ä¸€ç³»åˆ—æ¸…æ™°æŒ‡ä»¤çš„æœ‰é™åºåˆ—ï¼Œå…·æœ‰è¾“å…¥ã€è¾“å‡ºå’Œæ˜ç¡®å®šä¹‰çš„æ“ä½œæ­¥éª¤ã€‚ç®—æ³•åº”å…·å¤‡æ­£ç¡®æ€§ã€å¯è¡Œæ€§ã€ç¡®å®šæ€§å’Œæœ‰ç©·æ€§ç­‰æ€§è´¨ã€‚</p><h4 id="ç¨‹åºçš„æ¦‚å¿µ"><a href="#ç¨‹åºçš„æ¦‚å¿µ" class="headerlink" title="ç¨‹åºçš„æ¦‚å¿µ"></a>ç¨‹åºçš„æ¦‚å¿µ</h4><p>ç¨‹åºæ˜¯ç”±ç¼–ç¨‹è¯­è¨€ç¼–å†™çš„ä¸€ç»„æŒ‡ä»¤ï¼Œç”¨äºå®ç°ç‰¹å®šåŠŸèƒ½æˆ–è§£å†³ç‰¹å®šé—®é¢˜çš„è®¡ç®—æœºè½¯ä»¶ã€‚</p><h4 id="ç®—æ³•ä¸¾ä¾‹"><a href="#ç®—æ³•ä¸¾ä¾‹" class="headerlink" title="ç®—æ³•ä¸¾ä¾‹"></a>ç®—æ³•ä¸¾ä¾‹</h4><ul><li><strong>è°ƒåº¦é—®é¢˜</strong>ï¼šå¦‚ä½œä¸šè°ƒåº¦ã€ä»»åŠ¡åˆ†é…ç­‰é—®é¢˜ã€‚</li><li><strong>æ’åºç®—æ³•</strong>ï¼šå¦‚å†’æ³¡æ’åºã€å¿«é€Ÿæ’åºã€å½’å¹¶æ’åºç­‰ã€‚</li></ul><h4 id="Pç±»é—®é¢˜ã€NPç±»é—®é¢˜æ¦‚å¿µ"><a href="#Pç±»é—®é¢˜ã€NPç±»é—®é¢˜æ¦‚å¿µ" class="headerlink" title="Pç±»é—®é¢˜ã€NPç±»é—®é¢˜æ¦‚å¿µ"></a>Pç±»é—®é¢˜ã€NPç±»é—®é¢˜æ¦‚å¿µ</h4><ul><li><strong>Pç±»é—®é¢˜</strong>ï¼šæŒ‡åœ¨å¤šé¡¹å¼æ—¶é—´å†…å¯è§£å†³çš„é—®é¢˜ã€‚</li><li><strong>NPç±»é—®é¢˜</strong>ï¼šæŒ‡å¯ä»¥åœ¨å¤šé¡¹å¼æ—¶é—´å†…éªŒè¯è§£çš„é—®é¢˜ã€‚NPé—®é¢˜ä¸ä¸€å®šå¯ä»¥åœ¨å¤šé¡¹å¼æ—¶é—´å†…æ±‚è§£ã€‚</li></ul><h4 id="ç®—æ³•å¤æ‚æ€§çš„æ¦‚å¿µ"><a href="#ç®—æ³•å¤æ‚æ€§çš„æ¦‚å¿µ" class="headerlink" title="ç®—æ³•å¤æ‚æ€§çš„æ¦‚å¿µ"></a>ç®—æ³•å¤æ‚æ€§çš„æ¦‚å¿µ</h4><p>ç®—æ³•å¤æ‚æ€§æè¿°äº†ç®—æ³•åœ¨è§£å†³é—®é¢˜æ—¶æ‰€éœ€çš„è®¡ç®—èµ„æºã€‚ä¸»è¦åŒ…æ‹¬æ—¶é—´å¤æ‚æ€§å’Œç©ºé—´å¤æ‚æ€§ä¸¤ä¸ªæ–¹é¢ã€‚</p><h4 id="æ—¶é—´å¤æ‚æ€§çš„åˆ†æ"><a href="#æ—¶é—´å¤æ‚æ€§çš„åˆ†æ" class="headerlink" title="æ—¶é—´å¤æ‚æ€§çš„åˆ†æ"></a>æ—¶é—´å¤æ‚æ€§çš„åˆ†æ</h4><p>æ—¶é—´å¤æ‚æ€§æ˜¯æŒ‡ç®—æ³•è¿è¡Œæ‰€éœ€æ—¶é—´çš„åº¦é‡ï¼Œé€šå¸¸ç”¨å¤§Oè®°å·æ¥è¡¨ç¤ºã€‚å¸¸è§çš„æ—¶é—´å¤æ‚åº¦åŒ…æ‹¬O(1)ã€O(log n)ã€O(n)ã€O(n log n)ã€O(n^2)ç­‰ã€‚</p><h4 id="å¸¸è§çš„ç®—æ³•å¤æ‚åº¦çš„å¤§Oé˜¶"><a href="#å¸¸è§çš„ç®—æ³•å¤æ‚åº¦çš„å¤§Oé˜¶" class="headerlink" title="å¸¸è§çš„ç®—æ³•å¤æ‚åº¦çš„å¤§Oé˜¶"></a>å¸¸è§çš„ç®—æ³•å¤æ‚åº¦çš„å¤§Oé˜¶</h4><ul><li>**O(1)**ï¼šå¸¸æ•°æ—¶é—´å¤æ‚åº¦ï¼Œå¦‚å“ˆå¸Œè¡¨çš„æ’å…¥å’ŒæŸ¥æ‰¾æ“ä½œã€‚</li><li>**O(log n)**ï¼šå¯¹æ•°æ—¶é—´å¤æ‚åº¦ï¼Œå¦‚äºŒåˆ†æŸ¥æ‰¾ã€‚</li><li>**O(n)**ï¼šçº¿æ€§æ—¶é—´å¤æ‚åº¦ï¼Œå¦‚ç®€å•æŸ¥æ‰¾ã€‚</li><li>**O(n log n)**ï¼šå¦‚å¿«é€Ÿæ’åºã€å½’å¹¶æ’åºç­‰ã€‚</li><li>**O(n^2)**ï¼šå¹³æ–¹æ—¶é—´å¤æ‚åº¦ï¼Œå¦‚å†’æ³¡æ’åºã€æ’å…¥æ’åºç­‰ã€‚</li><li><h2 id="O-1-O-logn-O-n-O-nlogn-O-n-2-O-2-n-O-n"><a href="#O-1-O-logn-O-n-O-nlogn-O-n-2-O-2-n-O-n" class="headerlink" title="O(1) &lt; O(logn) &lt; O(n) &lt; O(nlogn) &lt; O(n^2) &lt; O(2^n) &lt; O(n!)"></a><strong><code>O(1) &lt; O(logn) &lt; O(n) &lt; O(nlogn) &lt; O(n^2) &lt; O(2^n) &lt; O(n!)</code></strong></h2></li></ul><h4 id="hå‡½æ•°çš„æ¸è¿›è¡¨è¾¾å¼è®¡ç®—"><a href="#hå‡½æ•°çš„æ¸è¿›è¡¨è¾¾å¼è®¡ç®—" class="headerlink" title="hå‡½æ•°çš„æ¸è¿›è¡¨è¾¾å¼è®¡ç®—"></a>hå‡½æ•°çš„æ¸è¿›è¡¨è¾¾å¼è®¡ç®—</h4><p>å‡½æ•°çš„æ¸è¿›è¡¨è¾¾å¼ç”¨æ¥æè¿°å‡½æ•°åœ¨è‡ªå˜é‡è¶‹å‘äºæ— ç©·å¤§æ—¶çš„å¢é•¿è¶‹åŠ¿ã€‚å¸¸è§çš„æœ‰Oå¤§Oã€Î©å¤§Omegaã€Î˜å¤§Thetaç­‰ã€‚</p><p>å¸Œæœ›è¿™äº›å›ç­”èƒ½å¸®åˆ°ä½ ï¼å¦‚æœ‰å…¶ä»–é—®é¢˜ï¼Œè¯·ç»§ç»­æé—®ã€‚</p><h3 id="ç¬¬2ç« -é€’å½’ä¸åˆ†æ²»"><a href="#ç¬¬2ç« -é€’å½’ä¸åˆ†æ²»" class="headerlink" title="ç¬¬2ç«  é€’å½’ä¸åˆ†æ²»"></a>ç¬¬2ç«  é€’å½’ä¸åˆ†æ²»</h3><h4 id="é€’å½’çš„æ¦‚å¿µ"><a href="#é€’å½’çš„æ¦‚å¿µ" class="headerlink" title="é€’å½’çš„æ¦‚å¿µ"></a>é€’å½’çš„æ¦‚å¿µ</h4><p>é€’å½’æ˜¯æŒ‡ä¸€ä¸ªå‡½æ•°åœ¨å®šä¹‰ä¸­è°ƒç”¨è‡ªèº«çš„è¿‡ç¨‹ã€‚é€’å½’å‡½æ•°é€šå¸¸åŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼šåŸºæœ¬æƒ…å†µï¼ˆé€’å½’çš„ç»“æŸæ¡ä»¶ï¼‰å’Œé€’å½’æƒ…å†µï¼ˆè°ƒç”¨è‡ªèº«ä»¥è§£å†³æ›´å°çš„å­é—®é¢˜ï¼‰ã€‚</p><h4 id="é€’å½’æ–¹ç¨‹æ±‚è§£"><a href="#é€’å½’æ–¹ç¨‹æ±‚è§£" class="headerlink" title="é€’å½’æ–¹ç¨‹æ±‚è§£"></a>é€’å½’æ–¹ç¨‹æ±‚è§£</h4><p>é€’å½’æ–¹ç¨‹ç”¨æ¥æè¿°é€’å½’ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ã€‚é€šå¸¸é€šè¿‡é€’æ¨å…³ç³»å¼æ¥è¡¨ç¤ºï¼Œå¯ä»¥ä½¿ç”¨é€’å½’æ ‘æˆ–ä¸»å®šç†æ¥æ±‚è§£å¤æ‚åº¦ã€‚</p><h4 id="ç»å…¸é€’å½’å®ä¾‹"><a href="#ç»å…¸é€’å½’å®ä¾‹" class="headerlink" title="ç»å…¸é€’å½’å®ä¾‹"></a>ç»å…¸é€’å½’å®ä¾‹</h4><ul><li><strong>æ±‚å’Œ</strong>ï¼šä¾‹å¦‚è®¡ç®—1åˆ°nçš„å’Œã€‚</li><li><strong>æ±‚é˜¶ä¹˜</strong>ï¼šå¦‚è®¡ç®—nçš„é˜¶ä¹˜ï¼Œå³n!ã€‚</li><li><strong>Fibonacciæ•°åˆ—</strong>ï¼šä¾‹å¦‚è®¡ç®—ç¬¬nä¸ªæ–æ³¢é‚£å¥‘æ•°ã€‚</li><li><strong>æ•´æ•°åˆ’åˆ†é—®é¢˜</strong>ï¼šä¾‹å¦‚å°†æ•´æ•°nåˆ’åˆ†æˆè‹¥å¹²ä¸ªæ•´æ•°çš„å’Œã€‚</li><li><strong>æ±‰è¯ºå¡”é—®é¢˜</strong>ï¼šç»å…¸çš„é€’å½’é—®é¢˜ï¼Œå°†åœ†ç›˜ä»ä¸€æ ¹æŸ±å­ç§»åŠ¨åˆ°å¦ä¸€æ ¹æŸ±å­ï¼Œè¦æ±‚å°åœ†ç›˜å¿…é¡»åœ¨å¤§åœ†ç›˜ä¸Šæ–¹ã€‚</li></ul><h4 id="é€’å½’çš„ç‰¹ç‚¹åŠä¼˜ç¼ºç‚¹"><a href="#é€’å½’çš„ç‰¹ç‚¹åŠä¼˜ç¼ºç‚¹" class="headerlink" title="é€’å½’çš„ç‰¹ç‚¹åŠä¼˜ç¼ºç‚¹"></a>é€’å½’çš„ç‰¹ç‚¹åŠä¼˜ç¼ºç‚¹</h4><p><strong>ç‰¹ç‚¹ï¼š</strong></p><ul><li>ç®€æ´ã€ç›´è§‚ï¼Œèƒ½å¤Ÿç®€åŒ–é—®é¢˜çš„è¡¨è¾¾å’Œè§£å†³ã€‚</li><li>é€‚ç”¨äºé—®é¢˜çš„åˆ†è€Œæ²»ä¹‹ï¼Œèƒ½å¤Ÿè‡ªç„¶åœ°æè¿°ä¸€äº›å…·æœ‰é€’å½’ç»“æ„çš„é—®é¢˜ã€‚</li></ul><p><strong>ä¼˜ç‚¹ï¼š</strong></p><ul><li>ç®€åŒ–å¤æ‚é—®é¢˜ï¼Œä½¿é—®é¢˜æ›´æ˜“ç†è§£å’Œå®ç°ã€‚</li><li>æœ‰åŠ©äºå®ç°åˆ†æ²»ç­–ç•¥ï¼Œä½¿é—®é¢˜çš„åˆ†è§£å’Œè§£å†³æ›´åŠ è‡ªç„¶å’Œé«˜æ•ˆã€‚</li></ul><p><strong>ç¼ºç‚¹ï¼š</strong></p><ul><li>å¯èƒ½ä¼šå¯¼è‡´å †æ ˆæº¢å‡ºçš„é—®é¢˜ï¼Œå°¤å…¶æ˜¯åœ¨é€’å½’å±‚æ•°å¾ˆæ·±æ—¶ã€‚</li><li>å¯èƒ½å­˜åœ¨é‡å¤è®¡ç®—ï¼Œæ•ˆç‡è¾ƒä½ã€‚</li></ul><h4 id="åˆ†æ²»æ³•çš„åŸºæœ¬æ€æƒ³"><a href="#åˆ†æ²»æ³•çš„åŸºæœ¬æ€æƒ³" class="headerlink" title="åˆ†æ²»æ³•çš„åŸºæœ¬æ€æƒ³"></a>åˆ†æ²»æ³•çš„åŸºæœ¬æ€æƒ³</h4><p>åˆ†æ²»æ³•å°†åŸé—®é¢˜åˆ†è§£æˆè‹¥å¹²ä¸ªè§„æ¨¡è¾ƒå°ä½†ç»“æ„ä¸åŸé—®é¢˜ç›¸ä¼¼çš„å­é—®é¢˜ï¼Œé€’å½’åœ°æ±‚è§£è¿™äº›å­é—®é¢˜ï¼Œç„¶ååˆå¹¶å­é—®é¢˜çš„è§£æ¥å¾—åˆ°åŸé—®é¢˜çš„è§£ã€‚</p><h4 id="åˆ†æ²»æ³•å®ä¾‹"><a href="#åˆ†æ²»æ³•å®ä¾‹" class="headerlink" title="åˆ†æ²»æ³•å®ä¾‹"></a>åˆ†æ²»æ³•å®ä¾‹</h4><ul><li><strong>äºŒåˆ†æœç´¢ç®—æ³•</strong>ï¼šåœ¨æœ‰åºæ•°ç»„ä¸­æŸ¥æ‰¾ç‰¹å®šå…ƒç´ ã€‚</li><li><strong>åˆå¹¶æ’åºï¼ˆMerge Sortï¼‰</strong>ï¼šå°†æ•°ç»„åˆ†æˆä¸¤åŠï¼Œåˆ†åˆ«æ’åºåå†åˆå¹¶ã€‚</li><li><strong>å¿«é€Ÿæ’åºï¼ˆQuick Sortï¼‰</strong>ï¼šé€‰å–ä¸€ä¸ªåŸºå‡†å…ƒç´ ï¼Œå°†æ•°ç»„åˆ†ä¸ºæ¯”åŸºå‡†å…ƒç´ å°å’Œæ¯”åŸºå‡†å…ƒç´ å¤§çš„ä¸¤éƒ¨åˆ†ï¼Œç„¶åé€’å½’åœ°å¯¹è¿™ä¸¤éƒ¨åˆ†è¿›è¡Œæ’åºã€‚</li></ul><h2 id="ç¬¬3ç« -åŠ¨æ€è§„åˆ’"><a href="#ç¬¬3ç« -åŠ¨æ€è§„åˆ’" class="headerlink" title="ç¬¬3ç«  åŠ¨æ€è§„åˆ’"></a>ç¬¬3ç«  åŠ¨æ€è§„åˆ’</h2><h3 id="åŠ¨æ€è§„åˆ’æ€»ä½“æ€æƒ³"><a href="#åŠ¨æ€è§„åˆ’æ€»ä½“æ€æƒ³" class="headerlink" title="åŠ¨æ€è§„åˆ’æ€»ä½“æ€æƒ³"></a>åŠ¨æ€è§„åˆ’æ€»ä½“æ€æƒ³</h3><p>åŠ¨æ€è§„åˆ’ï¼ˆDynamic Programmingï¼Œç®€ç§°DPï¼‰æ˜¯ä¸€ç§é€šè¿‡å°†å¤æ‚é—®é¢˜æ‹†åˆ†ä¸ºæ›´ç®€å•çš„å­é—®é¢˜ï¼Œå¹¶å­˜å‚¨å…¶å­é—®é¢˜çš„è§£ï¼Œä»¥é¿å…é‡å¤è®¡ç®—ï¼Œä»è€Œæé«˜æ•ˆç‡çš„ç®—æ³•è®¾è®¡æ–¹æ³•ã€‚å®ƒé€šå¸¸ç”¨äºè§£å†³å…·æœ‰é‡å å­é—®é¢˜å’Œæœ€ä¼˜å­ç»“æ„æ€§è´¨çš„é—®é¢˜ã€‚</p><ol><li><strong>é‡å å­é—®é¢˜ï¼ˆOverlapping Subproblemsï¼‰</strong>ï¼šåŸé—®é¢˜å¯ä»¥åˆ†è§£ä¸ºå¤šä¸ªå­é—®é¢˜ï¼Œè¿™äº›å­é—®é¢˜ä¼šé‡å¤å‡ºç°ã€‚</li><li><strong>æœ€ä¼˜å­ç»“æ„ï¼ˆOptimal Substructureï¼‰</strong>ï¼šåŸé—®é¢˜çš„æœ€ä¼˜è§£å¯ä»¥é€šè¿‡å…¶å­é—®é¢˜çš„æœ€ä¼˜è§£æ„é€ å¾—åˆ°ã€‚</li></ol><h3 id="åŠ¨æ€è§„åˆ’åŸºæœ¬æ­¥éª¤"><a href="#åŠ¨æ€è§„åˆ’åŸºæœ¬æ­¥éª¤" class="headerlink" title="åŠ¨æ€è§„åˆ’åŸºæœ¬æ­¥éª¤"></a>åŠ¨æ€è§„åˆ’åŸºæœ¬æ­¥éª¤</h3><ol><li><strong>å®šä¹‰å­é—®é¢˜</strong>ï¼šæ˜ç¡®è¦è§£å†³çš„å­é—®é¢˜æ˜¯ä»€ä¹ˆï¼ŒæŠŠä¸€ä¸ªå¤§é—®é¢˜åˆ†è§£æˆè‹¥å¹²ä¸ªç›¸åŒç±»å‹çš„å°é—®é¢˜ã€‚</li><li><strong>ç¡®å®šçŠ¶æ€ï¼ˆStateï¼‰</strong>ï¼šç”¨ä¸€ä¸ªæ•°ç»„æˆ–è¡¨æ ¼æ¥è¡¨ç¤ºæ¯ä¸ªå­é—®é¢˜çš„è§£ã€‚</li><li><strong>è®¾ç½®è¾¹ç•Œæ¡ä»¶ï¼ˆInitializationï¼‰</strong>ï¼šåˆå§‹åŒ–æœ€ç®€å•çš„å­é—®é¢˜çš„è§£ã€‚</li><li><strong>çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼ˆRecurrence Relationï¼‰</strong>ï¼šæ‰¾åˆ°å­é—®é¢˜å’ŒåŸé—®é¢˜ä¹‹é—´çš„é€’æ¨å…³ç³»ã€‚</li><li><strong>è®¡ç®—ç»“æœ</strong>ï¼šæ ¹æ®çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼Œè¿­ä»£è®¡ç®—æ¯ä¸ªå­é—®é¢˜çš„è§£ï¼Œæœ€ç»ˆå¾—åˆ°åŸé—®é¢˜çš„è§£ã€‚</li></ol><h3 id="åŠ¨æ€è§„åˆ’åŸºæœ¬è¦ç´ "><a href="#åŠ¨æ€è§„åˆ’åŸºæœ¬è¦ç´ " class="headerlink" title="åŠ¨æ€è§„åˆ’åŸºæœ¬è¦ç´ "></a>åŠ¨æ€è§„åˆ’åŸºæœ¬è¦ç´ </h3><ol><li><strong>çŠ¶æ€å®šä¹‰</strong>ï¼šæè¿°ä¸€ä¸ªå­é—®é¢˜çš„è§£ï¼Œä¾‹å¦‚ <code>dp[i]</code> è¡¨ç¤ºå‰ i ä¸ªå…ƒç´ çš„æŸç§çŠ¶æ€ã€‚</li><li><strong>çŠ¶æ€è½¬ç§»æ–¹ç¨‹</strong>ï¼šæè¿°å¦‚ä½•ä»ä¸€ä¸ªçŠ¶æ€è½¬ç§»åˆ°å¦ä¸€ä¸ªçŠ¶æ€ï¼Œä¾‹å¦‚ <code>dp[i] = dp[i-1] + something</code>ã€‚</li><li><strong>åˆå§‹çŠ¶æ€å’Œè¾¹ç•Œæ¡ä»¶</strong>ï¼šä¸ºé€’æ¨æä¾›åŸºç¡€ï¼Œä¾‹å¦‚ <code>dp[0] = 0</code> æˆ–å…¶ä»–åˆå§‹å€¼ã€‚</li><li><strong>è®¡ç®—é¡ºåº</strong>ï¼šæ ¹æ®çŠ¶æ€è½¬ç§»æ–¹ç¨‹çš„ä¾èµ–å…³ç³»ï¼Œé€šå¸¸æ˜¯ä»å°åˆ°å¤§çš„é¡ºåºè®¡ç®—ã€‚</li></ol><h3 id="åŠ¨æ€è§„åˆ’å®ä¾‹"><a href="#åŠ¨æ€è§„åˆ’å®ä¾‹" class="headerlink" title="åŠ¨æ€è§„åˆ’å®ä¾‹"></a>åŠ¨æ€è§„åˆ’å®ä¾‹</h3><h4 id="1-æœ€é•¿å…¬å…±å­åºåˆ—ï¼ˆLongest-Common-Subsequence-LCSï¼‰"><a href="#1-æœ€é•¿å…¬å…±å­åºåˆ—ï¼ˆLongest-Common-Subsequence-LCSï¼‰" class="headerlink" title="1. æœ€é•¿å…¬å…±å­åºåˆ—ï¼ˆLongest Common Subsequence, LCSï¼‰"></a>1. æœ€é•¿å…¬å…±å­åºåˆ—ï¼ˆLongest Common Subsequence, LCSï¼‰</h4><p><strong>é—®é¢˜æè¿°</strong>ï¼šç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œæ‰¾åˆ°å®ƒä»¬çš„æœ€é•¿å…¬å…±å­åºåˆ—çš„é•¿åº¦ã€‚</p><p><strong>çŠ¶æ€å®šä¹‰</strong>ï¼š<code>dp[i][j]</code> è¡¨ç¤ºå­—ç¬¦ä¸² A çš„å‰ i ä¸ªå­—ç¬¦å’Œå­—ç¬¦ä¸² B çš„å‰ j ä¸ªå­—ç¬¦çš„æœ€é•¿å…¬å…±å­åºåˆ—çš„é•¿åº¦ã€‚</p><p><strong>çŠ¶æ€è½¬ç§»æ–¹ç¨‹</strong>ï¼š</p><ul><li>å¦‚æœ <code>A[i-1] == B[j-1]</code>ï¼Œåˆ™ <code>dp[i][j] = dp[i-1][j-1] + 1</code></li><li>å¦åˆ™ï¼Œ<code>dp[i][j] = max(dp[i-1][j], dp[i][j-1])</code></li></ul><p><strong>åˆå§‹åŒ–</strong>ï¼š<code>dp[0][j] = 0</code> å’Œ <code>dp[i][0] = 0</code>ï¼Œå› ä¸ºä»»ä½•å­—ç¬¦ä¸²å’Œç©ºå­—ç¬¦ä¸²çš„æœ€é•¿å…¬å…±å­åºåˆ—é•¿åº¦éƒ½æ˜¯ 0ã€‚</p><h4 id="2-æœ€å¤§å­æ®µå’Œé—®é¢˜ï¼ˆMaximum-Subarray-Sumï¼‰"><a href="#2-æœ€å¤§å­æ®µå’Œé—®é¢˜ï¼ˆMaximum-Subarray-Sumï¼‰" class="headerlink" title="2. æœ€å¤§å­æ®µå’Œé—®é¢˜ï¼ˆMaximum Subarray Sumï¼‰"></a>2. æœ€å¤§å­æ®µå’Œé—®é¢˜ï¼ˆMaximum Subarray Sumï¼‰</h4><p><strong>é—®é¢˜æè¿°</strong>ï¼šç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ï¼Œæ‰¾åˆ°å…·æœ‰æœ€å¤§å’Œçš„è¿ç»­å­æ•°ç»„ï¼Œå¹¶è¿”å›å…¶æœ€å¤§å’Œã€‚</p><p><strong>çŠ¶æ€å®šä¹‰</strong>ï¼š<code>dp[i]</code> è¡¨ç¤ºä»¥ç¬¬ i ä¸ªå…ƒç´ ç»“å°¾çš„æœ€å¤§å­æ•°ç»„å’Œã€‚</p><p><strong>çŠ¶æ€è½¬ç§»æ–¹ç¨‹</strong>ï¼š</p><ul><li><code>dp[i] = max(nums[i], dp[i-1] + nums[i])</code></li></ul><p><strong>åˆå§‹åŒ–</strong>ï¼š<code>dp[0] = nums[0]</code>ï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œæœ€å¤§å­æ•°ç»„å’Œå°±æ˜¯è¯¥å…ƒç´ æœ¬èº«ã€‚</p><h4 id="3-0-1-èƒŒåŒ…é—®é¢˜ï¼ˆ0-1-Knapsack-Problemï¼‰"><a href="#3-0-1-èƒŒåŒ…é—®é¢˜ï¼ˆ0-1-Knapsack-Problemï¼‰" class="headerlink" title="3. 0-1 èƒŒåŒ…é—®é¢˜ï¼ˆ0-1 Knapsack Problemï¼‰"></a>3. 0-1 èƒŒåŒ…é—®é¢˜ï¼ˆ0-1 Knapsack Problemï¼‰</h4><p><strong>é—®é¢˜æè¿°</strong>ï¼šç»™å®šä¸€ä¸ªå®¹é‡ä¸º W çš„èƒŒåŒ…å’Œä¸€ç»„ç‰©å“ï¼Œæ¯ä¸ªç‰©å“æœ‰é‡é‡å’Œä»·å€¼ï¼Œæ±‚è§£å¦‚ä½•é€‰æ‹©ç‰©å“ä½¿å¾—æ€»ä»·å€¼æœ€å¤§ä¸”æ€»é‡é‡ä¸è¶…è¿‡èƒŒåŒ…å®¹é‡ã€‚</p><p><strong>çŠ¶æ€å®šä¹‰</strong>ï¼š<code>dp[i][w]</code> è¡¨ç¤ºå‰ i ä¸ªç‰©å“åœ¨æ€»é‡é‡ä¸è¶…è¿‡ w æ—¶çš„æœ€å¤§ä»·å€¼ã€‚</p><p><strong>çŠ¶æ€è½¬ç§»æ–¹ç¨‹</strong>ï¼š</p><ul><li>å¦‚æœä¸é€‰ç¬¬ i ä¸ªç‰©å“ï¼š<code>dp[i][w] = dp[i-1][w]</code></li><li>å¦‚æœé€‰ç¬¬ i ä¸ªç‰©å“ï¼š<code>dp[i][w] = dp[i-1][w-weight[i]] + value[i]</code></li><li>ç»¼åˆèµ·æ¥ï¼š<code>dp[i][w] = max(dp[i-1][w], dp[i-1][w-weight[i]] + value[i])</code></li></ul><p><strong>åˆå§‹åŒ–</strong>ï¼š<code>dp[0][w] = 0</code> å¯¹æ‰€æœ‰ wï¼Œå› ä¸ºæ²¡æœ‰ç‰©å“æ—¶ï¼Œä»·å€¼ä¸º 0ã€‚</p><p>è¿™äº›å®ä¾‹å±•ç¤ºäº†åŠ¨æ€è§„åˆ’åœ¨ä¸åŒé¢†åŸŸä¸­çš„åº”ç”¨ï¼Œé€šè¿‡å®šä¹‰çŠ¶æ€ã€ç¡®å®šè½¬ç§»æ–¹ç¨‹ä»¥åŠåˆå§‹åŒ–ï¼Œå¯ä»¥æœ‰æ•ˆåœ°è§£å†³è®¸å¤šå¤æ‚é—®é¢˜ã€‚</p><h3 id="ç¬¬4ç« -è´ªå¿ƒç®—æ³•"><a href="#ç¬¬4ç« -è´ªå¿ƒç®—æ³•" class="headerlink" title="ç¬¬4ç«  è´ªå¿ƒç®—æ³•"></a>ç¬¬4ç«  è´ªå¿ƒç®—æ³•</h3><h4 id="è´ªå¿ƒç®—æ³•çš„æ¦‚å¿µ"><a href="#è´ªå¿ƒç®—æ³•çš„æ¦‚å¿µ" class="headerlink" title="è´ªå¿ƒç®—æ³•çš„æ¦‚å¿µ"></a>è´ªå¿ƒç®—æ³•çš„æ¦‚å¿µ</h4><p>è´ªå¿ƒç®—æ³•ï¼ˆGreedy Algorithmï¼‰æ˜¯ä¸€ç§åœ¨æ¯ä¸€æ­¥é€‰æ‹©ä¸­éƒ½é‡‡å–åœ¨å½“å‰çŠ¶æ€ä¸‹æœ€å¥½æˆ–æœ€ä¼˜çš„é€‰æ‹©ï¼Œä»¥æœŸæœ›é€šè¿‡å±€éƒ¨æœ€ä¼˜è§£è¾¾åˆ°å…¨å±€æœ€ä¼˜è§£çš„ç®—æ³•è®¾è®¡æ–¹æ³•ã€‚è´ªå¿ƒç®—æ³•ä¸ä¸€å®šèƒ½ä¿è¯æ±‚å¾—å…¨å±€æœ€ä¼˜è§£ï¼Œä½†å¯¹äºæŸäº›ç‰¹å®šé—®é¢˜ï¼Œå®ƒå¯ä»¥æä¾›é«˜æ•ˆä¸”æ­£ç¡®çš„è§£ã€‚</p><h4 id="ç”¨è´ªå¿ƒç®—æ³•æ±‚è§£çš„é—®é¢˜éœ€å…·å¤‡çš„ä¸¤ä¸ªåŸºæœ¬è¦ç´ "><a href="#ç”¨è´ªå¿ƒç®—æ³•æ±‚è§£çš„é—®é¢˜éœ€å…·å¤‡çš„ä¸¤ä¸ªåŸºæœ¬è¦ç´ " class="headerlink" title="ç”¨è´ªå¿ƒç®—æ³•æ±‚è§£çš„é—®é¢˜éœ€å…·å¤‡çš„ä¸¤ä¸ªåŸºæœ¬è¦ç´ "></a>ç”¨è´ªå¿ƒç®—æ³•æ±‚è§£çš„é—®é¢˜éœ€å…·å¤‡çš„ä¸¤ä¸ªåŸºæœ¬è¦ç´ </h4><ol><li><strong>è´ªå¿ƒé€‰æ‹©æ€§è´¨ï¼ˆGreedy Choice Propertyï¼‰</strong>ï¼šåœ¨å½“å‰æ­¥éª¤ä¸­ï¼Œé€‰æ‹©å±€éƒ¨æœ€ä¼˜è§£ä¸ä¼šå½±å“åˆ°åç»­çš„é€‰æ‹©èƒ½å¤Ÿæ„æˆå…¨å±€æœ€ä¼˜è§£ã€‚è¿™æ„å‘³ç€å¯ä»¥é€šè¿‡å±€éƒ¨æœ€ä¼˜ç­–ç•¥æ¥æ„å»ºå…¨å±€æœ€ä¼˜è§£ã€‚</li><li><strong>æœ€ä¼˜å­ç»“æ„æ€§è´¨ï¼ˆOptimal Substructureï¼‰</strong>ï¼šä¸€ä¸ªé—®é¢˜çš„å…¨å±€æœ€ä¼˜è§£åŒ…å«å…¶å­é—®é¢˜çš„å…¨å±€æœ€ä¼˜è§£ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé—®é¢˜çš„æœ€ä¼˜è§£å¯ä»¥ç”±å…¶å­é—®é¢˜çš„æœ€ä¼˜è§£é€’å½’åœ°æ„å»ºå‡ºæ¥ã€‚</li></ol><h4 id="è´ªå¿ƒç®—æ³•ä¸åŠ¨æ€è§„åˆ’ç®—æ³•çš„å·®å¼‚"><a href="#è´ªå¿ƒç®—æ³•ä¸åŠ¨æ€è§„åˆ’ç®—æ³•çš„å·®å¼‚" class="headerlink" title="è´ªå¿ƒç®—æ³•ä¸åŠ¨æ€è§„åˆ’ç®—æ³•çš„å·®å¼‚"></a>è´ªå¿ƒç®—æ³•ä¸åŠ¨æ€è§„åˆ’ç®—æ³•çš„å·®å¼‚</h4><ul><li><strong>é€‰æ‹©æ ‡å‡†</strong>ï¼š<ul><li><strong>è´ªå¿ƒç®—æ³•</strong>ï¼šåœ¨æ¯ä¸€æ­¥é€‰æ‹©ä¸­åšå‡ºå±€éƒ¨æœ€ä¼˜çš„é€‰æ‹©ï¼Œä¸å›æº¯ã€ä¸è€ƒè™‘åç»­å¯èƒ½çš„é€‰æ‹©ã€‚</li><li><strong>åŠ¨æ€è§„åˆ’</strong>ï¼šè€ƒè™‘æ‰€æœ‰å¯èƒ½çš„é€‰æ‹©ï¼Œé€šè¿‡æ¯”è¾ƒä¸åŒé€‰æ‹©çš„ç»“æœæ¥ç¡®ä¿å…¨å±€æœ€ä¼˜è§£ã€‚</li></ul></li><li><strong>é€‚ç”¨é—®é¢˜ç±»å‹</strong>ï¼š<ul><li><strong>è´ªå¿ƒç®—æ³•</strong>ï¼šé€šå¸¸é€‚ç”¨äºå…·æœ‰è´ªå¿ƒé€‰æ‹©æ€§è´¨å’Œæœ€ä¼˜å­ç»“æ„æ€§è´¨çš„é—®é¢˜ã€‚</li><li><strong>åŠ¨æ€è§„åˆ’</strong>ï¼šé€‚ç”¨äºæ›´å¹¿æ³›çš„é—®é¢˜ç±»å‹ï¼Œç‰¹åˆ«æ˜¯é‚£äº›å…·æœ‰é‡å å­é—®é¢˜å’Œæœ€ä¼˜å­ç»“æ„æ€§è´¨çš„é—®é¢˜ã€‚</li></ul></li><li><strong>è®¡ç®—å¤æ‚åº¦</strong>ï¼š<ul><li><strong>è´ªå¿ƒç®—æ³•</strong>ï¼šé€šå¸¸è¾ƒç®€å•ä¸”é«˜æ•ˆï¼Œé€‚ç”¨äºå¤§å¤šæ•°å®é™…æƒ…å†µã€‚</li><li><strong>åŠ¨æ€è§„åˆ’</strong>ï¼šå¯èƒ½éœ€è¦å­˜å‚¨å­é—®é¢˜çš„è§£ï¼Œç©ºé—´å’Œæ—¶é—´å¤æ‚åº¦ä¸€èˆ¬è¾ƒé«˜ã€‚</li></ul></li></ul><h4 id="è´ªå¿ƒç®—æ³•å®ä¾‹"><a href="#è´ªå¿ƒç®—æ³•å®ä¾‹" class="headerlink" title="è´ªå¿ƒç®—æ³•å®ä¾‹"></a>è´ªå¿ƒç®—æ³•å®ä¾‹</h4><h5 id="1-æ´»åŠ¨å®‰æ’é—®é¢˜ï¼ˆActivity-Selection-Problemï¼‰"><a href="#1-æ´»åŠ¨å®‰æ’é—®é¢˜ï¼ˆActivity-Selection-Problemï¼‰" class="headerlink" title="1. æ´»åŠ¨å®‰æ’é—®é¢˜ï¼ˆActivity Selection Problemï¼‰"></a>1. æ´»åŠ¨å®‰æ’é—®é¢˜ï¼ˆActivity Selection Problemï¼‰</h5><p><strong>é—®é¢˜æè¿°</strong>ï¼šç»™å®šä¸€ç»„æ´»åŠ¨ï¼Œæ¯ä¸ªæ´»åŠ¨æœ‰ä¸€ä¸ªå¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´ã€‚è¦æ±‚é€‰æ‹©å°½å¯èƒ½å¤šçš„äº’ä¸é‡å çš„æ´»åŠ¨ã€‚</p><p><strong>è´ªå¿ƒç­–ç•¥</strong>ï¼šæ¯æ¬¡é€‰æ‹©ç»“æŸæ—¶é—´æœ€æ—©ä¸”ä¸å·²é€‰æ´»åŠ¨ä¸å†²çªçš„æ´»åŠ¨ã€‚</p><p><strong>ç®—æ³•æè¿°</strong>ï¼š</p><ol><li>æŒ‰ç…§æ´»åŠ¨çš„ç»“æŸæ—¶é—´ä»å°åˆ°å¤§æ’åºã€‚</li><li>é€‰æ‹©ç¬¬ä¸€ä¸ªæ´»åŠ¨ã€‚</li><li>ä»å‰©ä½™æ´»åŠ¨ä¸­é€‰æ‹©å¼€å§‹æ—¶é—´ä¸æ—©äºä¸Šä¸€ä¸ªé€‰æ‹©çš„æ´»åŠ¨ç»“æŸæ—¶é—´çš„æ´»åŠ¨ã€‚</li><li>é‡å¤æ­¥éª¤3ç›´åˆ°æ²¡æœ‰å¯é€‰æ´»åŠ¨ã€‚</li></ol><h5 id="2-éƒ¨åˆ†èƒŒåŒ…é—®é¢˜ï¼ˆFractional-Knapsack-Problemï¼‰"><a href="#2-éƒ¨åˆ†èƒŒåŒ…é—®é¢˜ï¼ˆFractional-Knapsack-Problemï¼‰" class="headerlink" title="2. éƒ¨åˆ†èƒŒåŒ…é—®é¢˜ï¼ˆFractional Knapsack Problemï¼‰"></a>2. éƒ¨åˆ†èƒŒåŒ…é—®é¢˜ï¼ˆFractional Knapsack Problemï¼‰</h5><p><strong>é—®é¢˜æè¿°</strong>ï¼šç»™å®šä¸€ç»„ç‰©å“ï¼Œæ¯ä¸ªç‰©å“æœ‰é‡é‡å’Œä»·å€¼ï¼Œåœ¨å…è®¸éƒ¨åˆ†å–ç‰©çš„æƒ…å†µä¸‹ï¼Œé€‰æ‹©è£…å…¥å®¹é‡ä¸º W çš„èƒŒåŒ…ï¼Œä½¿å¾—æ€»ä»·å€¼æœ€å¤§ã€‚</p><p><strong>è´ªå¿ƒç­–ç•¥</strong>ï¼šæŒ‰ç…§å•ä½é‡é‡çš„ä»·å€¼ï¼ˆvalue&#x2F;weightï¼‰ä»å¤§åˆ°å°é€‰æ‹©ç‰©å“ï¼Œå°½å¯èƒ½å¤šåœ°è£…å…¥èƒŒåŒ…ã€‚</p><p><strong>ç®—æ³•æè¿°</strong>ï¼š</p><ol><li>è®¡ç®—æ¯ä¸ªç‰©å“çš„å•ä½é‡é‡ä»·å€¼ï¼Œå¹¶æŒ‰å…¶ä»å¤§åˆ°å°æ’åºã€‚</li><li>ä¾æ¬¡é€‰æ‹©ç‰©å“ï¼Œç›´åˆ°èƒŒåŒ…è£…æ»¡æˆ–æ— æ³•å†è£…å…¥æ›´å¤šç‰©å“ã€‚</li></ol><h5 id="3-æœ€ä¼˜è£…è½½é—®é¢˜ï¼ˆOptimal-Load-Problemï¼‰"><a href="#3-æœ€ä¼˜è£…è½½é—®é¢˜ï¼ˆOptimal-Load-Problemï¼‰" class="headerlink" title="3. æœ€ä¼˜è£…è½½é—®é¢˜ï¼ˆOptimal Load Problemï¼‰"></a>3. æœ€ä¼˜è£…è½½é—®é¢˜ï¼ˆOptimal Load Problemï¼‰</h5><p><strong>é—®é¢˜æè¿°</strong>ï¼šåœ¨ä¸€ä¸ªè´§è¿èˆªç­ä¸­ï¼Œå¦‚ä½•è£…è½½è´§ç‰©ä½¿å¾—æ€»é‡é‡ä¸è¶…è¿‡æœ€å¤§æ‰¿è½½é‡é‡ä¸”è£…è½½çš„è´§ç‰©æ€»ä»·å€¼æœ€å¤§ã€‚</p><p><strong>è´ªå¿ƒç­–ç•¥</strong>ï¼šæŒ‰ç…§å•ä½é‡é‡çš„ä»·å€¼ï¼ˆvalue&#x2F;weightï¼‰ä»å¤§åˆ°å°é€‰æ‹©è´§ç‰©ï¼Œå°½å¯èƒ½å¤šåœ°è£…å…¥èˆªç­ã€‚</p><h5 id="4-å“ˆå¤«æ›¼ç¼–ç ï¼ˆHuffman-Codingï¼‰"><a href="#4-å“ˆå¤«æ›¼ç¼–ç ï¼ˆHuffman-Codingï¼‰" class="headerlink" title="4. å“ˆå¤«æ›¼ç¼–ç ï¼ˆHuffman Codingï¼‰"></a>4. å“ˆå¤«æ›¼ç¼–ç ï¼ˆHuffman Codingï¼‰</h5><p><strong>é—®é¢˜æè¿°</strong>ï¼šç»™å®šä¸€ç»„å­—ç¬¦åŠå…¶å¯¹åº”çš„é¢‘ç‡ï¼Œæ„å»ºä¸€ä¸ªäºŒè¿›åˆ¶å‰ç¼€ç ï¼ˆå“ˆå¤«æ›¼ç ï¼‰ä½¿å¾—ç¼–ç åçš„å­—ç¬¦æ€»é•¿åº¦æœ€çŸ­ã€‚</p><p><strong>è´ªå¿ƒç­–ç•¥</strong>ï¼šæ¯æ¬¡é€‰æ‹©é¢‘ç‡æœ€å°çš„ä¸¤ä¸ªèŠ‚ç‚¹åˆå¹¶ï¼Œç›´åˆ°æ‰€æœ‰èŠ‚ç‚¹åˆå¹¶æˆä¸€æ£µæ ‘ã€‚</p><p><strong>ç®—æ³•æè¿°</strong>ï¼š</p><ol><li>å°†æ‰€æœ‰å­—ç¬¦æ„å»ºæˆå¶å­èŠ‚ç‚¹ï¼Œå¹¶æŒ‰ç…§é¢‘ç‡æ„å»ºä¸€ä¸ªä¼˜å…ˆé˜Ÿåˆ—ã€‚</li><li>æ¯æ¬¡ä»é˜Ÿåˆ—ä¸­å–å‡ºé¢‘ç‡æœ€å°çš„ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œåˆå¹¶æˆä¸€ä¸ªæ–°èŠ‚ç‚¹ï¼Œå¹¶å°†æ–°èŠ‚ç‚¹çš„é¢‘ç‡è®¾ä¸ºä¸¤ä¸ªèŠ‚ç‚¹é¢‘ç‡ä¹‹å’Œã€‚</li><li>å°†æ–°èŠ‚ç‚¹é‡æ–°æ”¾å…¥é˜Ÿåˆ—ã€‚</li><li>é‡å¤æ­¥éª¤2å’Œ3ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­åªå‰©ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¿™ä¸ªèŠ‚ç‚¹å³ä¸ºå“ˆå¤«æ›¼æ ‘çš„æ ¹ã€‚</li></ol><h5 id="5-æœ€å°ç”Ÿæˆæ ‘ï¼ˆMinimum-Spanning-Tree-MSTï¼‰"><a href="#5-æœ€å°ç”Ÿæˆæ ‘ï¼ˆMinimum-Spanning-Tree-MSTï¼‰" class="headerlink" title="5. æœ€å°ç”Ÿæˆæ ‘ï¼ˆMinimum Spanning Tree, MSTï¼‰"></a>5. æœ€å°ç”Ÿæˆæ ‘ï¼ˆMinimum Spanning Tree, MSTï¼‰</h5><p><strong>é—®é¢˜æè¿°</strong>ï¼šç»™å®šä¸€ä¸ªå¸¦æƒæ— å‘å›¾ï¼Œæ‰¾åˆ°ä¸€ä¸ªæ ‘ï¼Œä½¿å¾—æ ‘åŒ…å«æ‰€æœ‰èŠ‚ç‚¹ä¸”è¾¹çš„æƒå€¼å’Œæœ€å°ã€‚</p><p><strong>å¸¸ç”¨è´ªå¿ƒç®—æ³•</strong>ï¼šKruskalç®—æ³•å’ŒPrimç®—æ³•ã€‚</p><p><strong>Kruskalç®—æ³•</strong>ï¼š</p><ol><li>å°†æ‰€æœ‰è¾¹æŒ‰æƒé‡ä»å°åˆ°å¤§æ’åºã€‚</li><li>åˆå§‹åŒ–ä¸€ä¸ªæ£®æ—ï¼ˆæ¯ä¸ªé¡¶ç‚¹å„è‡ªä¸ºæ ‘ï¼‰ã€‚</li><li>ä¾æ¬¡é€‰æ‹©æƒé‡æœ€å°çš„è¾¹ï¼Œè‹¥è¯¥è¾¹è¿æ¥çš„ä¸¤ä¸ªé¡¶ç‚¹å±äºä¸åŒçš„æ ‘ï¼Œåˆ™å°†å…¶åŠ å…¥ç”Ÿæˆæ ‘ï¼Œå¹¶åˆå¹¶è¿™ä¸¤ä¸ªé¡¶ç‚¹æ‰€åœ¨çš„æ ‘ã€‚</li><li>é‡å¤æ­¥éª¤3ï¼Œç›´åˆ°ç”Ÿæˆæ ‘åŒ…å«æ‰€æœ‰é¡¶ç‚¹ã€‚</li></ol><p><strong>Primç®—æ³•</strong>ï¼š</p><ol><li>ä»ä»»æ„ä¸€ä¸ªé¡¶ç‚¹å¼€å§‹ï¼Œå°†å…¶æ ‡è®°ä¸ºå·²è®¿é—®ã€‚</li><li>åœ¨å·²è®¿é—®é¡¶ç‚¹å’Œæœªè®¿é—®é¡¶ç‚¹ä¹‹é—´é€‰æ‹©æƒé‡æœ€å°çš„è¾¹ï¼Œå°†è¯¥è¾¹å’Œå…¶è¿æ¥çš„æœªè®¿é—®é¡¶ç‚¹åŠ å…¥ç”Ÿæˆæ ‘ã€‚</li><li>é‡å¤æ­¥éª¤2ï¼Œç›´åˆ°ç”Ÿæˆæ ‘åŒ…å«æ‰€æœ‰é¡¶ç‚¹ã€‚</li></ol><h5 id="6-å¤šæœºè°ƒåº¦é—®é¢˜ï¼ˆJob-Scheduling-Problemï¼‰"><a href="#6-å¤šæœºè°ƒåº¦é—®é¢˜ï¼ˆJob-Scheduling-Problemï¼‰" class="headerlink" title="6. å¤šæœºè°ƒåº¦é—®é¢˜ï¼ˆJob Scheduling Problemï¼‰"></a>6. å¤šæœºè°ƒåº¦é—®é¢˜ï¼ˆJob Scheduling Problemï¼‰</h5><p><strong>é—®é¢˜æè¿°</strong>ï¼šç»™å®šä¸€ç»„ä½œä¸šå’Œå¤šä¸ªæœºå™¨ï¼Œå®‰æ’ä½œä¸šåˆ°æœºå™¨ä¸Šï¼Œä½¿å¾—æ‰€æœ‰ä½œä¸šå®Œæˆçš„æ€»æ—¶é—´æœ€çŸ­ã€‚</p><p><strong>è´ªå¿ƒç­–ç•¥</strong>ï¼šæ¯æ¬¡é€‰æ‹©æœ€çŸ­ä½œä¸šæ—¶é—´æˆ–å°†ä½œä¸šåˆ†é…åˆ°å½“å‰è´Ÿè½½æœ€è½»çš„æœºå™¨ä¸Šã€‚</p><p><strong>ç®—æ³•æè¿°</strong>ï¼š</p><ol><li>æŒ‰ä½œä¸šæ—¶é—´ä»çŸ­åˆ°é•¿æ’åºã€‚</li><li>ä¾æ¬¡å°†ä½œä¸šåˆ†é…åˆ°å½“å‰è´Ÿè½½æœ€è½»çš„æœºå™¨ä¸Šã€‚</li></ol><p>è´ªå¿ƒç®—æ³•é€šè¿‡ç®€æ´æœ‰æ•ˆçš„ç­–ç•¥è§£å†³äº†è®¸å¤šå®é™…é—®é¢˜ï¼Œä½†å¹¶éé€‚ç”¨äºæ‰€æœ‰æƒ…å†µã€‚åœ¨ä½¿ç”¨è´ªå¿ƒç®—æ³•æ—¶ï¼Œéœ€è¦ç¡®ä¿é—®é¢˜å…·å¤‡è´ªå¿ƒé€‰æ‹©æ€§è´¨å’Œæœ€ä¼˜å­ç»“æ„æ€§è´¨ã€‚</p><h1 id="è¯•å·ç»“æ„"><a href="#è¯•å·ç»“æ„" class="headerlink" title="è¯•å·ç»“æ„"></a><strong>è¯•å·ç»“æ„</strong></h1><p>è¯•å·å…±4é¡µï¼Œ5å¤§é¢˜ï¼Œæ»¡åˆ† 100åˆ†ï¼Œ 120 åˆ†é’Ÿå®Œå·ã€‚</p><h4 id="ä¸€ã€å•é¡¹é€‰æ‹©é¢˜ï¼š-æ¯å°é¢˜2åˆ†ï¼Œå…±30åˆ†"><a href="#ä¸€ã€å•é¡¹é€‰æ‹©é¢˜ï¼š-æ¯å°é¢˜2åˆ†ï¼Œå…±30åˆ†" class="headerlink" title="ä¸€ã€å•é¡¹é€‰æ‹©é¢˜ï¼š(æ¯å°é¢˜2åˆ†ï¼Œå…±30åˆ†)"></a>ä¸€ã€<strong>å•é¡¹é€‰æ‹©é¢˜ï¼š</strong>(æ¯å°é¢˜2åˆ†ï¼Œå…±30åˆ†)</h4><p>åœ¨ä¸‹åˆ—æ¯å°é¢˜çš„å››ä¸ªå¤‡é€‰ç­”æ¡ˆä¸­é€‰å‡ºä¸€ä¸ªæ­£ç¡®çš„ç­”æ¡ˆï¼Œå¹¶å°†å…¶å­—æ¯æ ‡å·å¡«å…¥ä¸‹é¢çš„è¡¨æ ¼ä¸­ï¼Œå¡«å…¥é¢˜å¹²çš„æ‹¬å·å†…æ— æ•ˆã€‚</p><h4 id="äºŒã€åˆ¤æ–­é¢˜ï¼š-æ¯å°é¢˜1åˆ†ï¼Œå…±10åˆ†ï¼‰"><a href="#äºŒã€åˆ¤æ–­é¢˜ï¼š-æ¯å°é¢˜1åˆ†ï¼Œå…±10åˆ†ï¼‰" class="headerlink" title="äºŒã€åˆ¤æ–­é¢˜ï¼š(æ¯å°é¢˜1åˆ†ï¼Œå…±10åˆ†ï¼‰"></a>äºŒã€<strong>åˆ¤æ–­é¢˜ï¼š</strong>(æ¯å°é¢˜1åˆ†ï¼Œå…±10åˆ†ï¼‰</h4><p>ä»¥ä¸‹æè¿°æ­£ç¡®çš„æ‰“â€œâˆšâ€ï¼Œé”™è¯¯çš„æ‰“â€œÃ—â€ï¼Œå¹¶å°†ç­”æ¡ˆå¡«åœ¨ä¸‹é¢çš„è¡¨æ ¼ä¸­ã€‚</p><h4 id="ä¸‰ã€è®¡ç®—é¢˜ï¼š-æ¯å°é¢˜10åˆ†ï¼Œå…±30åˆ†"><a href="#ä¸‰ã€è®¡ç®—é¢˜ï¼š-æ¯å°é¢˜10åˆ†ï¼Œå…±30åˆ†" class="headerlink" title="ä¸‰ã€è®¡ç®—é¢˜ï¼š(æ¯å°é¢˜10åˆ†ï¼Œå…±30åˆ†)"></a><strong>ä¸‰ã€è®¡ç®—é¢˜ï¼š</strong>(æ¯å°é¢˜10åˆ†ï¼Œå…±30åˆ†)</h4><p>å‡½æ•°çš„æ¸è¿›è¡¨è¾¾å¼è®¡ç®—ï¼ˆé€’å½’æ–¹ç¨‹æ±‚è§£ï¼‰ã€è§£ç©ºé—´æ ‘ï¼ˆå­é›†æ ‘æˆ–æ’åˆ—æ ‘ï¼‰ã€å“ˆå¤«æ›¼ç¼–ç ï¼ˆæ„é€ å“ˆå¤«æ›¼æ ‘åŠç¼–ç ï¼‰</p><h4 id="å››ã€ç®€ç­”é¢˜ï¼š-æ¯å°é¢˜5åˆ†ï¼Œå…±10åˆ†"><a href="#å››ã€ç®€ç­”é¢˜ï¼š-æ¯å°é¢˜5åˆ†ï¼Œå…±10åˆ†" class="headerlink" title="å››ã€ç®€ç­”é¢˜ï¼š(æ¯å°é¢˜5åˆ†ï¼Œå…±10åˆ†)"></a>å››ã€<strong>ç®€ç­”é¢˜ï¼š</strong>(æ¯å°é¢˜5åˆ†ï¼Œå…±10åˆ†)</h4><h5 id="åŠ¨æ€è§„åˆ’æ€»ä½“æ€æƒ³ã€åŸºæœ¬æ­¥éª¤ã€åŸºæœ¬è¦ç´ "><a href="#åŠ¨æ€è§„åˆ’æ€»ä½“æ€æƒ³ã€åŸºæœ¬æ­¥éª¤ã€åŸºæœ¬è¦ç´ " class="headerlink" title="åŠ¨æ€è§„åˆ’æ€»ä½“æ€æƒ³ã€åŸºæœ¬æ­¥éª¤ã€åŸºæœ¬è¦ç´ "></a>åŠ¨æ€è§„åˆ’æ€»ä½“æ€æƒ³ã€åŸºæœ¬æ­¥éª¤ã€åŸºæœ¬è¦ç´ </h5><ul><li><p>åŠ¨æ€è§„åˆ’é€šè¿‡å°†åŸé—®é¢˜åˆ†è§£ä¸ºç›¸å¯¹ç®€å•çš„å­é—®é¢˜æ¥è§£å†³å¤æ‚é—®é¢˜ï¼Œé€šè¿‡å­˜å‚¨å­é—®é¢˜çš„è§£ï¼Œé¿å…é‡å¤è®¡ç®—ï¼Œä»è€Œæé«˜æ•ˆç‡ã€‚å…¶å…³é”®åœ¨äºå°†é—®é¢˜åˆ†è§£ä¸ºå­é—®é¢˜ï¼Œå¹¶ç¡®å®šå­é—®é¢˜ä¹‹é—´çš„é€’æ¨å…³ç³»ï¼Œä»¥ä¾¿é€æ­¥æ±‚è§£åŸé—®é¢˜ã€‚</p><h3 id="åŸºæœ¬æ­¥éª¤ï¼š"><a href="#åŸºæœ¬æ­¥éª¤ï¼š" class="headerlink" title="åŸºæœ¬æ­¥éª¤ï¼š"></a>åŸºæœ¬æ­¥éª¤ï¼š</h3><p>ï¼ˆ1ï¼‰</p><p>ï¼ˆ2ï¼‰é€’å½’åœ°å®šä¹‰æœ€ä¼˜å€¼ã€‚ </p><p>ï¼ˆ3ï¼‰ä»¥è‡ªåº•å‘ä¸Šçš„æ–¹å¼æˆ–è‡ªé¡¶å‘ä¸‹çš„è®°å¿†åŒ–æ–¹æ³•ï¼ˆå¤‡å¿˜å½•æ³•ï¼‰è®¡ç®—å‡ºæœ€ä¼˜å€¼ã€‚ </p><p>ï¼ˆ4ï¼‰æ ¹æ®è®¡ç®—æœ€ä¼˜å€¼æ—¶å¾—åˆ°çš„ä¿¡æ¯ï¼Œæ„é€ ä¸€ä¸ªæœ€ä¼˜è§£ã€‚ </p><h3 id="åŸºæœ¬è¦ç´ ï¼š"><a href="#åŸºæœ¬è¦ç´ ï¼š" class="headerlink" title="åŸºæœ¬è¦ç´ ï¼š"></a>åŸºæœ¬è¦ç´ ï¼š</h3><ul><li>æœ€ä¼˜å­ç»“æ„</li><li>çŠ¶æ€è½¬ç§»æ–¹ç¨‹</li><li>è¾¹ç•Œæ¡ä»¶</li><li>çŠ¶æ€å­˜å‚¨</li><li>çŠ¶æ€å‹ç¼©</li></ul></li></ul><h5 id="å›æº¯æ³•çš„æ¦‚å¿µåŠåŸºæœ¬æ€æƒ³ã€åº”ç”¨æ­¥éª¤åŠå‰ªæå‡½æ•°"><a href="#å›æº¯æ³•çš„æ¦‚å¿µåŠåŸºæœ¬æ€æƒ³ã€åº”ç”¨æ­¥éª¤åŠå‰ªæå‡½æ•°" class="headerlink" title="å›æº¯æ³•çš„æ¦‚å¿µåŠåŸºæœ¬æ€æƒ³ã€åº”ç”¨æ­¥éª¤åŠå‰ªæå‡½æ•°"></a>å›æº¯æ³•çš„æ¦‚å¿µåŠåŸºæœ¬æ€æƒ³ã€åº”ç”¨æ­¥éª¤åŠå‰ªæå‡½æ•°</h5><p>æ¦‚å¿µï¼šå›æº¯æ³•ï¼ˆBacktrackingï¼‰æ˜¯ä¸€ç§é€šè¿‡è¯•æ¢æ‰€æœ‰å¯èƒ½çš„è§£æ¥æ±‚è§£é—®é¢˜çš„ç®—æ³•</p><p>åŸºæœ¬æ€æƒ³ï¼šé€æ­¥æ„å»ºé—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼Œå¹¶åœ¨æœç´¢è¿‡ç¨‹ä¸­è¿›è¡Œé€‰æ‹©å’Œå›é€€ï¼Œç›´åˆ°æ‰¾åˆ°è§£æˆ–ç¡®å®šé—®é¢˜æ— è§£ä¸ºæ­¢</p><p>åº”ç”¨æ­¥éª¤ï¼š</p><ul><li>å®šä¹‰é—®é¢˜1</li><li>é€‰æ‹©çŠ¶æ€è¡¨ç¤º</li><li>ç¼–å†™å›æº¯å‡½æ•°<ul><li>é€’å½’å‚æ•°</li><li>é€’å½’ç»ˆæ­¢æ¡ä»¶</li><li>é€’å½’ä¸»ä½“</li></ul></li><li>æ‰§è¡Œå›æº¯æœç´¢</li></ul><h5 id="åˆ†æ”¯é™ç•Œæ³•ä¸å›æº¯æ³•çš„æ¯”è¾ƒ"><a href="#åˆ†æ”¯é™ç•Œæ³•ä¸å›æº¯æ³•çš„æ¯”è¾ƒ" class="headerlink" title="åˆ†æ”¯é™ç•Œæ³•ä¸å›æº¯æ³•çš„æ¯”è¾ƒ"></a>åˆ†æ”¯é™ç•Œæ³•ä¸å›æº¯æ³•çš„æ¯”è¾ƒ</h5><p><strong>åˆ†æ”¯é™ç•Œæ³•ä¸å›æº¯æ³•çš„ç›¸åŒç‚¹æ˜¯ï¼š</strong>éƒ½æ˜¯ä¸€ç§åœ¨é—®é¢˜çš„è§£ç©ºé—´æ ‘Tä¸­æœç´¢é—®é¢˜è§£çš„ç®—æ³•ã€‚</p><p><strong>ä¸åŒç‚¹ï¼š</strong>ï¼ˆ1ï¼‰æ±‚è§£ç›®æ ‡ä¸åŒï¼› </p><p>ï¼ˆ2ï¼‰æœç´¢æ–¹å¼ä¸åŒï¼› </p><p>ï¼ˆ3ï¼‰å¯¹æ‰©å±•ç»“ç‚¹çš„æ‰©å±•æ–¹å¼ä¸åŒï¼› </p><p>ï¼ˆ4ï¼‰å­˜å‚¨ç©ºé—´çš„è¦æ±‚ä¸åŒã€‚</p><h4 id="åˆ†æ”¯é™ç•Œæ³•çš„åŸºæœ¬æ€æƒ³ã€åˆ†æ”¯é™ç•Œæ³•çš„ä¸¤ç§å®ç°æ–¹å¼"><a href="#åˆ†æ”¯é™ç•Œæ³•çš„åŸºæœ¬æ€æƒ³ã€åˆ†æ”¯é™ç•Œæ³•çš„ä¸¤ç§å®ç°æ–¹å¼" class="headerlink" title="åˆ†æ”¯é™ç•Œæ³•çš„åŸºæœ¬æ€æƒ³ã€åˆ†æ”¯é™ç•Œæ³•çš„ä¸¤ç§å®ç°æ–¹å¼"></a>åˆ†æ”¯é™ç•Œæ³•çš„åŸºæœ¬æ€æƒ³ã€åˆ†æ”¯é™ç•Œæ³•çš„ä¸¤ç§å®ç°æ–¹å¼</h4><p>åŸºæœ¬æ€æƒ³ï¼šåˆ†æ”¯é™ç•Œæ³•é€šå¸¸ä»¥å¹¿åº¦ä¼˜å…ˆæˆ–è€…ä»¥æœ€å°è€—è´¹ä¼˜å…ˆçš„æ–¹å¼æœç´¢é—®é¢˜çš„è§£ç©ºé—´æ ‘</p><p>ä¸¤ç§å®ç°æ–¹å¼ï¼š</p><p>é˜Ÿåˆ—å¼åˆ†æ”¯é™ç•Œæ³•ï¼ˆé˜Ÿåˆ—å¼åˆ†æ”¯é™ç•Œæ³•å°†æ´»ç»“ç‚¹è¡¨ç»„ç»‡æˆä¸€ä¸ªé˜Ÿåˆ—ï¼Œå¹¶æŒ‰ç…§é˜Ÿåˆ—å…ˆè¿›å…ˆå‡ºçš„åŸåˆ™é€‰å–ä¸‹ä¸€ä¸ªç»“ç‚¹ä¸ºå½“å‰æ‰©å±•ç»“ç‚¹ï¼‰</p><p>ä¼˜å…ˆé˜Ÿåˆ—å¼åˆ†æ”¯é™ç•Œæ³•ï¼ˆä¼˜å…ˆé˜Ÿåˆ—å¼çš„åˆ†æ”¯é™ç•Œæ³•å°†æ´»ç»“ç‚¹è¡¨ç»„ç»‡æˆä¸€ä¸ªä¼˜å…ˆé˜Ÿåˆ—ï¼Œå¹¶æŒ‰ç…§ä¼˜å…ˆé˜Ÿåˆ—ä¸­è§„å®šçš„ç»“ç‚¹ä¼˜å…ˆçº§é€‰å–ä¼˜å…ˆçº§æœ€é«˜çš„ä¸‹ä¸€ä¸ªç»“ç‚¹æˆä¸ºå½“å‰çš„æ‰©å±•ç»“ç‚¹ï¼‰</p><h3 id="äº”ã€ç®—æ³•è®¾è®¡é¢˜ï¼š-æ¯å°é¢˜10åˆ†ï¼Œå…±20åˆ†"><a href="#äº”ã€ç®—æ³•è®¾è®¡é¢˜ï¼š-æ¯å°é¢˜10åˆ†ï¼Œå…±20åˆ†" class="headerlink" title="äº”ã€ç®—æ³•è®¾è®¡é¢˜ï¼š(æ¯å°é¢˜10åˆ†ï¼Œå…±20åˆ†)"></a><strong>äº”ã€ç®—æ³•è®¾è®¡é¢˜ï¼š</strong>(æ¯å°é¢˜10åˆ†ï¼Œå…±20åˆ†)</h3><p>æœ€å¤§å­æ®µå’Œã€äºŒåˆ†æœç´¢ç®—æ³•</p><h6 id="æœ€å¤§å­æ®µå’Œ"><a href="#æœ€å¤§å­æ®µå’Œ" class="headerlink" title="æœ€å¤§å­æ®µå’Œ"></a>æœ€å¤§å­æ®µå’Œ</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">maxSubArray</span><span class="hljs-params">(<span class="hljs-type">int</span>[] nums)</span> &#123;<br>    <span class="hljs-keyword">if</span> (nums == <span class="hljs-literal">null</span> || nums.length == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>    <br>    <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> nums.length;<br>    <span class="hljs-type">int</span>[] dp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[n];<br>    dp[<span class="hljs-number">0</span>] = nums[<span class="hljs-number">0</span>];<br>    <span class="hljs-type">int</span> <span class="hljs-variable">maxSum</span> <span class="hljs-operator">=</span> dp[<span class="hljs-number">0</span>];<br>    <br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt; n; i++) &#123;<br>        dp[i] = Math.max(dp[i - <span class="hljs-number">1</span>] + nums[i], nums[i]);<br>        maxSum = Math.max(maxSum, dp[i]);<br>    &#125;<br>    <br>    <span class="hljs-keyword">return</span> maxSum;<br>&#125;<br>è§£é‡Šï¼š<br>dp[i] æ•°ç»„ç”¨æ¥å­˜å‚¨ä»¥ç¬¬ i ä¸ªå…ƒç´ ç»“å°¾çš„æœ€å¤§å­æ®µå’Œã€‚<br>maxSum å˜é‡ç”¨æ¥è®°å½• dp æ•°ç»„ä¸­çš„æœ€å¤§å€¼ï¼Œå³ä¸ºæœ€ç»ˆçš„ç»“æœã€‚<br>æ—¶é—´å¤æ‚åº¦ä¸º O(n)ï¼Œç©ºé—´å¤æ‚åº¦ä¸º O(n)ï¼Œå…¶ä¸­ n æ˜¯æ•°ç»„ nums çš„é•¿åº¦ã€‚<br>è¿™ç§åŠ¨æ€è§„åˆ’ç®—æ³•åœ¨å®ç°ä¸Šç®€å•ç›´è§‚ï¼Œå¹¶ä¸”èƒ½å¤Ÿæœ‰æ•ˆåœ°è§£å†³æœ€å¤§å­æ®µå’Œé—®é¢˜ã€‚<br></code></pre></td></tr></table></figure><h6 id="äºŒåˆ†æœç´¢ç®—æ³•"><a href="#äºŒåˆ†æœç´¢ç®—æ³•" class="headerlink" title="äºŒåˆ†æœç´¢ç®—æ³•"></a>äºŒåˆ†æœç´¢ç®—æ³•</h6><p><img src="clip_image002-1718613963237-2.png" alt="img">                                                                 </p>]]></content>
    
    
    <categories>
      
      <category>å­¦æ ¡è¯¾ç¨‹</category>
      
      <category>å¤ä¹ é¢˜</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¤ä¹ é¢˜</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åŸºäºAOPå®ç°ç®€å•æ—¥å¿—è®°å½•</title>
    <link href="/post/9697fbcc0d23/"/>
    <url>/post/9697fbcc0d23/</url>
    
    <content type="html"><![CDATA[<h3 id="åŸºäºAOPå®ç°ç®€å•æ—¥å¿—è®°å½•"><a href="#åŸºäºAOPå®ç°ç®€å•æ—¥å¿—è®°å½•" class="headerlink" title="åŸºäºAOPå®ç°ç®€å•æ—¥å¿—è®°å½•"></a>åŸºäºAOPå®ç°ç®€å•æ—¥å¿—è®°å½•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">package</span> org.example.springaoplog.log;<br><br><span class="hljs-keyword">import</span> com.fasterxml.jackson.core.JsonProcessingException;<br><span class="hljs-keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;<br><span class="hljs-keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Around;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Aspect;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Pointcut;<br><span class="hljs-keyword">import</span> org.aspectj.lang.reflect.MethodSignature;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><span class="hljs-keyword">import</span> org.springframework.util.StopWatch;<br><br><span class="hljs-keyword">import</span> javax.annotation.Resource;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> java.util.Date;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ—¥å¿—åˆ‡é¢</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> 14237</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Aspect</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogAspect</span> &#123;<br>    <span class="hljs-meta">@Pointcut</span> ( <span class="hljs-string">&quot;@annotation(org.example.springaoplog.log.Log)&quot;</span>)<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">pointcut</span><span class="hljs-params">()</span> &#123;&#125;<br><br>    <span class="hljs-meta">@Resource</span><br>    HttpServletRequest request;<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">ObjectMapper</span> <span class="hljs-variable">mapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();<br><br>    <span class="hljs-meta">@Around</span> ( <span class="hljs-string">&quot;pointcut()&quot;</span>)<br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">around</span><span class="hljs-params">(ProceedingJoinPoint pjp)</span> <span class="hljs-keyword">throws</span> JsonProcessingException &#123;<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">MethodSignature</span> <span class="hljs-variable">signature</span> <span class="hljs-operator">=</span> ((MethodSignature) pjp.getSignature());<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">Log</span> <span class="hljs-variable">annotation</span> <span class="hljs-operator">=</span> signature.getMethod().getAnnotation(Log.class);<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">StopWatch</span> <span class="hljs-variable">stopWatch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StopWatch</span>();<br>        stopWatch.start();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">errorMsg</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>;<br>        <span class="hljs-keyword">final</span> Object proceed;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            proceed = pjp.proceed();<br>            result = mapper.writeValueAsString(proceed);<span class="hljs-comment">//è¿”å›ç»“æœ</span><br>            <span class="hljs-keyword">return</span> proceed;<br>        &#125; <span class="hljs-keyword">catch</span>(Throwable e) &#123;<br>            errorMsg = e.getLocalizedMessage();<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            stopWatch.stop();<br><br>            <span class="hljs-keyword">final</span> <span class="hljs-type">SysLog</span> <span class="hljs-variable">sysLog</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SysLog</span>()<br>                    .setId(<span class="hljs-literal">null</span>)<br>                    .setRequestMethod(request.getMethod())<br>                    .setName(annotation.value())<br>                    .setType(annotation.type().getValue())<br>                    .setOperator(<span class="hljs-string">&quot;sessionId: &quot;</span> + request.getSession().getId())<br>                    .setOperatingTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>())<br>                    .setIp(request.getRemoteHost())<br>                    .setUrl(request.getRequestURL().toString())<br>                    .setMethod(signature.toString())<br>                    .setArgs(mapper.writeValueAsString(pjp.getArgs()))<br>                    .setMillisecond(stopWatch.getTotalTimeMillis())<br>                    .setResult(result)<br>                    .setError(errorMsg);<br>            <span class="hljs-comment">//è®°å½•æ—¥å¿—</span><br>            recordLog(sysLog);<br>        &#125;<br><br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è®°å½•æ—¥å¿—</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> log æ—¥å¿—</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">recordLog</span><span class="hljs-params">(SysLog log)</span> &#123;<br>        <span class="hljs-comment">//ä¿å­˜åˆ°æ•°æ®åº“</span><br>        System.err.println(log);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example.springaoplog.log;<br><br><span class="hljs-keyword">import</span> java.lang.annotation.Retention;<br><span class="hljs-keyword">import</span> java.lang.annotation.RetentionPolicy;<br><br><span class="hljs-meta">@Retention</span> ( RetentionPolicy.RUNTIME)<br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> Log &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ—¥å¿—ç±»å‹</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> &#123;<span class="hljs-doctag">@link</span> LogType &#125;</span><br><span class="hljs-comment">     */</span><br>    LogType <span class="hljs-title function_">type</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> LogType.DEFAULT;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ—¥å¿—åç§°</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> &#123;<span class="hljs-doctag">@link</span> String &#125;</span><br><span class="hljs-comment">     */</span><br>    String <span class="hljs-title function_">value</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-string">&quot;&quot;</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example.springaoplog.log;<br><br><span class="hljs-keyword">import</span> lombok.AllArgsConstructor;<br><span class="hljs-keyword">import</span> lombok.Getter;<br><br><span class="hljs-meta">@Getter</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">LogType</span> &#123;<br>    DEFAULT(<span class="hljs-string">&quot;é»˜è®¤&quot;</span>),<br>    SYSTEM(<span class="hljs-string">&quot;ç³»ç»Ÿæ—¥å¿—&quot;</span>),<br>    BUSINESS(<span class="hljs-string">&quot;ä¸šåŠ¡æ—¥å¿—&quot;</span>),<br>    OPERATE(<span class="hljs-string">&quot;æ“ä½œæ—¥å¿—&quot;</span>),<br>    TEST(<span class="hljs-string">&quot;æµ‹è¯•æ—¥å¿—&quot;</span>);<br>    <span class="hljs-keyword">final</span> String value;<br>&#125;<br><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example.springaoplog.log;<br><br><span class="hljs-keyword">import</span> lombok.Data;<br><span class="hljs-keyword">import</span> lombok.experimental.Accessors;<br><br><span class="hljs-keyword">import</span> java.util.Date;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ç³»ç»Ÿæ—¥å¿—</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> inyxin</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@Accessors</span> ( chain = <span class="hljs-literal">true</span>)<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SysLog</span> &#123;<br>    <span class="hljs-comment">/** æ—¥å¿—ID */</span><br>    <span class="hljs-keyword">private</span> Integer id;<br>    <span class="hljs-comment">/** æ—¥å¿—åå­— */</span><br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-comment">/** æ—¥å¿—ç±»å‹ */</span><br>    <span class="hljs-keyword">private</span> String type;<br>    <span class="hljs-comment">/** è¯·æ±‚è·¯å¾„ */</span><br>    <span class="hljs-keyword">private</span> String url;<br>    <span class="hljs-comment">/** è¯·æ±‚æ–¹å¼ */</span><br>    <span class="hljs-keyword">private</span> String requestMethod;<br>    <span class="hljs-comment">/** æ“ä½œè€… */</span><br>    <span class="hljs-keyword">private</span> String operator;<br>    <span class="hljs-comment">/** æ–¹æ³• */</span><br>    <span class="hljs-keyword">private</span> String method;<br>    <span class="hljs-comment">/** å‚æ•° */</span><br>    <span class="hljs-keyword">private</span> String args;<br>    <span class="hljs-comment">/** è¿œç¨‹IP */</span><br>    <span class="hljs-keyword">private</span> String ip;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ“ä½œæ—¶é—´</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Date operatingTime;<br>    <span class="hljs-comment">/** å¼‚å¸¸ä¿¡æ¯ */</span><br>    <span class="hljs-keyword">private</span> String error;<br>    <span class="hljs-comment">/** ç»“æœ */</span><br>    <span class="hljs-keyword">private</span> String result;<br>    <span class="hljs-comment">/** æ–¹æ³•æ‰§è¡Œæ—¶é—´ æ¯«ç§’ */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> millisecond;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><p>æµ‹è¯•:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * Copyright 2013-2018 the original author or authors.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span><br><span class="hljs-comment"> * you may not use this file except in compliance with the License.</span><br><span class="hljs-comment"> * You may obtain a copy of the License at</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> *      https://www.apache.org/licenses/LICENSE-2.0</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * Unless required by applicable law or agreed to in writing, software</span><br><span class="hljs-comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span><br><span class="hljs-comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><br><span class="hljs-comment"> * See the License for the specific language governing permissions and</span><br><span class="hljs-comment"> * limitations under the License.</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-keyword">package</span> org.example.springaoplog.demos.web;<br><br><span class="hljs-keyword">import</span> org.example.springaoplog.log.Log;<br><span class="hljs-keyword">import</span> org.example.springaoplog.log.LogType;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ModelAttribute;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestParam;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> &lt;a href=&quot;mailto:chenxilzx1@gmail.com&quot;&gt;theonefx&lt;/a&gt;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BasicController</span> &#123;<br><br>    <span class="hljs-comment">// http://127.0.0.1:8080/hello?name=lisi</span><br>    <span class="hljs-meta">@RequestMapping</span> ( <span class="hljs-string">&quot;/hello&quot;</span>)<br>    <span class="hljs-meta">@ResponseBody</span><br>    <span class="hljs-meta">@Log</span> (<br>            value = <span class="hljs-string">&quot;Hello&quot;</span>,<br>            type = LogType.TEST<br>    )<br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">hello</span><span class="hljs-params">(</span><br><span class="hljs-params">            <span class="hljs-meta">@RequestParam</span> (</span><br><span class="hljs-params">                    name = <span class="hljs-string">&quot;name&quot;</span>,</span><br><span class="hljs-params">                    defaultValue = <span class="hljs-string">&quot;unknown user&quot;</span></span><br><span class="hljs-params">            )</span> String name) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hello &quot;</span> + name;<br>    &#125;<br><br>    <span class="hljs-comment">// http://127.0.0.1:8080/errortest</span><br>    <span class="hljs-meta">@RequestMapping</span> ( <span class="hljs-string">&quot;/errortest&quot;</span>)<br>    <span class="hljs-meta">@ResponseBody</span><br>    <span class="hljs-meta">@Log</span> (<br>            value = <span class="hljs-string">&quot;å¼‚å¸¸æµ‹è¯•&quot;</span>,<br>            type = LogType.TEST<br>    )<br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">errortest</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-number">1</span> / <span class="hljs-number">0</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;12321&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// http://127.0.0.1:8080/user</span><br>    <span class="hljs-meta">@RequestMapping</span> ( <span class="hljs-string">&quot;/user&quot;</span>)<br>    <span class="hljs-meta">@ResponseBody</span><br>    <span class="hljs-meta">@Log</span> ( value = <span class="hljs-string">&quot;æŸ¥è¯¢ç”¨æˆ·&quot;</span>)<br>    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">user</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>        user.setName(<span class="hljs-string">&quot;theonefx&quot;</span>);<br>        user.setAge(<span class="hljs-number">666</span>);<br>        <span class="hljs-keyword">return</span> user;<br>    &#125;<br><br><br>    <span class="hljs-comment">// http://127.0.0.1:8080/save_user?name=newName&amp;age=11</span><br>    <span class="hljs-meta">@RequestMapping</span> ( <span class="hljs-string">&quot;/save_user&quot;</span>)<br>    <span class="hljs-meta">@ResponseBody</span><br>    <span class="hljs-meta">@Log</span> (<br>            value = <span class="hljs-string">&quot;ä¿å­˜ç”¨æˆ·&quot;</span>,<br>            type = LogType.OPERATE<br>    )<br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">saveUser</span><span class="hljs-params">(User u)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;user will save: name=&quot;</span> + u.getName() + <span class="hljs-string">&quot;, age=&quot;</span> + u.getAge();<br>    &#125;<br><br>    <span class="hljs-comment">// http://127.0.0.1:8080/html</span><br>    <span class="hljs-meta">@RequestMapping</span> ( <span class="hljs-string">&quot;/html&quot;</span>)<br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">html</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;index.html&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@ModelAttribute</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">parseUser</span><span class="hljs-params">(</span><br><span class="hljs-params">            <span class="hljs-meta">@RequestParam</span> (</span><br><span class="hljs-params">                    name = <span class="hljs-string">&quot;name&quot;</span>,</span><br><span class="hljs-params">                    defaultValue = <span class="hljs-string">&quot;unknown user&quot;</span></span><br><span class="hljs-params">            )</span> String name<br>            ,<br>            <span class="hljs-meta">@RequestParam</span> (<br>                    name = <span class="hljs-string">&quot;age&quot;</span>,<br>                    defaultValue = <span class="hljs-string">&quot;12&quot;</span><br>            ) Integer age, User user) &#123;<br>        user.setName(<span class="hljs-string">&quot;zhangsan&quot;</span>);<br>        user.setAge(<span class="hljs-number">18</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>è¾“å‡º:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">SysLog(id=<span class="hljs-literal">null</span>, name=æŸ¥è¯¢ç”¨æˆ·, type=é»˜è®¤, url=http:<span class="hljs-comment">//127.0.0.1:8080/user, requestMethod=GET, operator=sessionId: 2F552A00DA410EEE3047B4AEE36927B1, method=User org.example.springaoplog.demos.web.BasicController.user(), args=[], ip=127.0.0.1, operatingTime=Fri Jun 14 10:02:11 CST 2024, error=, result=&#123;&quot;name&quot;:&quot;theonefx&quot;,&quot;age&quot;:666&#125;, millisecond=7)</span><br>SysLog(id=<span class="hljs-literal">null</span>, name=æŸ¥è¯¢ç”¨æˆ·, type=é»˜è®¤, url=http:<span class="hljs-comment">//10.120.1.193:8080/user, requestMethod=GET, operator=sessionId: 39EA319EFCC022E1973A1C9DA452DAE2, method=User org.example.springaoplog.demos.web.BasicController.user(), args=[], ip=10.120.1.193, operatingTime=Fri Jun 14 10:06:46 CST 2024, error=, result=&#123;&quot;name&quot;:&quot;theonefx&quot;,&quot;age&quot;:666&#125;, millisecond=0)</span><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>Spring</category>
      
    </categories>
    
    
    <tags>
      
      <tag>AOP</tag>
      
      <tag>Log</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MapStruct å¯¹è±¡è½¬æ¢æ¡†æ¶</title>
    <link href="/post/ca7c951ed4e8/"/>
    <url>/post/ca7c951ed4e8/</url>
    
    <content type="html"><![CDATA[<h1 id="MapStruct-å¯¹è±¡è½¬æ¢æ¡†æ¶"><a href="#MapStruct-å¯¹è±¡è½¬æ¢æ¡†æ¶" class="headerlink" title="MapStruct å¯¹è±¡è½¬æ¢æ¡†æ¶"></a>MapStruct å¯¹è±¡è½¬æ¢æ¡†æ¶</h1><h2 id="å¯¼å…¥ä¾èµ–"><a href="#å¯¼å…¥ä¾èµ–" class="headerlink" title="å¯¼å…¥ä¾èµ–"></a>å¯¼å…¥ä¾èµ–</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml">        <span class="hljs-tag">&lt;<span class="hljs-name">mapstruct.version</span>&gt;</span>1.4.1.Final<span class="hljs-tag">&lt;/<span class="hljs-name">mapstruct.version</span>&gt;</span><br><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mapstruct<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mapstruct<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;mapstruct.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mapstruct<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mapstruct-processor<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;mapstruct.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>åŸç†ä¸ <code>lomback</code> ç±»ä¼¼&#96; , éƒ½æ˜¯é€šè¿‡è‡ªåŠ¨ç”Ÿæˆä»£ç ;</p><h2 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h2><h3 id="æ™®é€šä½¿ç”¨"><a href="#æ™®é€šä½¿ç”¨" class="headerlink" title="æ™®é€šä½¿ç”¨"></a>æ™®é€šä½¿ç”¨</h3><h5 id="å®šä¹‰æ˜ å°„æ¥å£"><a href="#å®šä¹‰æ˜ å°„æ¥å£" class="headerlink" title="å®šä¹‰æ˜ å°„æ¥å£"></a>å®šä¹‰æ˜ å°„æ¥å£</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">GoodsInfoMapper</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ— çŠ¶æ€ä¸”çº¿ç¨‹å®‰å…¨</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-type">GoodsInfoMapper</span> <span class="hljs-variable">INSTANCE</span> <span class="hljs-operator">=</span> Mappers.getMapper(GoodsInfoMapper.class);<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">GoodsInfoPO</span> <span class="hljs-variable">goodsInfoPO</span> <span class="hljs-operator">=</span> GoodsInfoMapper.INSTANCE.goodsInfoDtoToPo(goodsInfoDTO);<br></code></pre></td></tr></table></figure><h3 id="åœ¨-Spring-ä¸­ä½¿ç”¨"><a href="#åœ¨-Spring-ä¸­ä½¿ç”¨" class="headerlink" title="åœ¨ Spring ä¸­ä½¿ç”¨"></a>åœ¨ Spring ä¸­ä½¿ç”¨</h3><h5 id="å®šä¹‰æ˜ å°„æ¥å£-1"><a href="#å®šä¹‰æ˜ å°„æ¥å£-1" class="headerlink" title="å®šä¹‰æ˜ å°„æ¥å£"></a>å®šä¹‰æ˜ å°„æ¥å£</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Mapper(componentModel = &quot;spring&quot;)</span> <span class="hljs-comment">// è®¾ç½®ä¸º spring</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">GoodsInfoMapper</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ— çŠ¶æ€ä¸”çº¿ç¨‹å®‰å…¨</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-type">GoodsInfoMapper</span> <span class="hljs-variable">INSTANCE</span> <span class="hljs-operator">=</span> Mappers.getMapper(GoodsInfoMapper.class);<br>&#125;<br></code></pre></td></tr></table></figure><p>æœ‰äº† <code>@Mapper(componentModel = &quot;spring)</code> è¿™ä¸ªå.ç”Ÿæˆçš„å®ç°ç±»ä¸Šä¼šè‡ªåŠ¨åŠ ä¸Š  <code>@Component</code> æ³¨è§£</p><h4 id="Mapping"><a href="#Mapping" class="headerlink" title="@Mapping"></a>@Mapping</h4><p><code>@Mapping</code> æ³¨è§£æ˜¯ MapStruct æ¡†æ¶ä¸­çš„ä¸€ä¸ªå…³é”®æ³¨è§£ï¼Œç”¨äºå®šä¹‰ä¸¤ä¸ª bean ä¹‹é—´çš„å­—æ®µæ˜ å°„å…³ç³»ã€‚å®ƒå¯ä»¥åº”ç”¨åœ¨ Mapper æ¥å£çš„æ–¹æ³•ä¸Šï¼ŒæŒ‡å®šæºï¼ˆsourceï¼‰å­—æ®µåˆ°ç›®æ ‡ï¼ˆtargetï¼‰å­—æ®µçš„æ˜ å°„å…³ç³»ã€‚</p><h3 id="åŸºæœ¬ç”¨æ³•"><a href="#åŸºæœ¬ç”¨æ³•" class="headerlink" title="åŸºæœ¬ç”¨æ³•"></a>åŸºæœ¬ç”¨æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Mapper</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">CarMapper</span> &#123;<br><br>    <span class="hljs-meta">@Mapping(source = &quot;make&quot;, target = &quot;manufacturer&quot;)</span><br>    CarDto <span class="hljs-title function_">carToCarDto</span><span class="hljs-params">(Car car)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œ<code>@Mapping(source = &quot;make&quot;, target = &quot;manufacturer&quot;)</code> è¡¨ç¤ºå°† <code>Car</code> å¯¹è±¡çš„ <code>make</code> å­—æ®µæ˜ å°„åˆ° <code>CarDto</code> å¯¹è±¡çš„ <code>manufacturer</code> å­—æ®µä¸Šã€‚</p><h3 id="å¸¸è§å±æ€§"><a href="#å¸¸è§å±æ€§" class="headerlink" title="å¸¸è§å±æ€§"></a>å¸¸è§å±æ€§</h3><ul><li><p><strong>source</strong>ï¼šæºå¯¹è±¡çš„å­—æ®µåã€‚</p></li><li><p><strong>target</strong>ï¼šç›®æ ‡å¯¹è±¡çš„å­—æ®µåã€‚</p></li><li><p><strong>qualifiedByName</strong>ï¼šé€šè¿‡ä¸€ä¸ªå‘½åè½¬æ¢å™¨æ¥è½¬æ¢å­—æ®µå€¼ã€‚</p></li><li><p><strong>defaultValue</strong>ï¼šæŒ‡å®šç›®æ ‡å­—æ®µçš„é»˜è®¤å€¼ã€‚</p></li><li><p><strong>ignore</strong>ï¼šå¿½ç•¥æŸä¸ªå­—æ®µï¼Œä¸è¿›è¡Œæ˜ å°„ã€‚</p></li><li><p><strong>expression</strong>ï¼šä½¿ç”¨ SpEL è¡¨è¾¾å¼å®šä¹‰æ˜ å°„è§„åˆ™ã€‚</p><p><code>This attribute can not be used together with source(), defaultValue(), defaultExpression() or expression().</code></p></li></ul><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><ol><li><strong>ç®€å•æ˜ å°„</strong></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Mapping(source = &quot;name&quot;, target = &quot;fullName&quot;)</span><br>PersonDto <span class="hljs-title function_">personToPersonDto</span><span class="hljs-params">(Person person)</span>;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªç¤ºä¾‹å°† <code>Person</code> å¯¹è±¡çš„ <code>name</code> å­—æ®µæ˜ å°„åˆ° <code>PersonDto</code> å¯¹è±¡çš„ <code>fullName</code> å­—æ®µã€‚</p><ol><li><strong>ä½¿ç”¨è½¬æ¢å™¨</strong></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs jaVA"><span class="hljs-meta">@Mapping(source = &quot;birthDate&quot;, target = &quot;birthDate&quot;, dateFormat = &quot;dd-MM-yyyy&quot;)</span><br>PersonDto <span class="hljs-title function_">personToPersonDto</span><span class="hljs-params">(Person person)</span>;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>dateFormat</code> å±æ€§æŒ‡å®šäº†æ—¥æœŸæ ¼å¼ï¼ŒMapStruct ä¼šè‡ªåŠ¨å°† <code>Person</code> å¯¹è±¡çš„ <code>birthDate</code> å­—æ®µæŒ‰ç…§æŒ‡å®šçš„æ ¼å¼è½¬æ¢ä¸º <code>PersonDto</code> å¯¹è±¡çš„ <code>birthDate</code> å­—æ®µã€‚</p><ol><li><strong>å¿½ç•¥å­—æ®µ</strong></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-meta">@Mapping(target = &quot;id&quot;, ignore = true)</span><br>PersonDto <span class="hljs-title function_">personToPersonDto</span><span class="hljs-params">(Person person)</span>;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>ignore = true</code> è¡¨ç¤ºå¿½ç•¥ <code>PersonDto</code> å¯¹è±¡çš„ <code>id</code> å­—æ®µï¼Œä¸è¿›è¡Œæ˜ å°„ã€‚</p><h3 id="é«˜çº§ç”¨æ³•"><a href="#é«˜çº§ç”¨æ³•" class="headerlink" title="é«˜çº§ç”¨æ³•"></a>é«˜çº§ç”¨æ³•</h3><ul><li><strong>å¤šå­—æ®µæ˜ å°„</strong>ï¼šå¯ä»¥åŒæ—¶æ˜ å°„å¤šä¸ªå­—æ®µï¼Œé€šè¿‡å¤šä¸ª <code>@Mapping</code> æ³¨è§£å®ç°ã€‚</li><li><strong>å¤æ‚ç±»å‹æ˜ å°„</strong>ï¼šæ”¯æŒå¤æ‚å¯¹è±¡ç±»å‹ï¼Œå¦‚é›†åˆã€åµŒå¥—å¯¹è±¡ç­‰ã€‚</li><li><strong>æ¡ä»¶æ˜ å°„</strong>ï¼šé€šè¿‡ SpEL è¡¨è¾¾å¼åœ¨ <code>@Mapping</code> çš„ <code>expression</code> å±æ€§ä¸­å®šä¹‰æ¡ä»¶ï¼Œæ ¹æ®æ¡ä»¶åŠ¨æ€è¿›è¡Œæ˜ å°„ã€‚</li></ul><p><code>@Mapping</code> æ³¨è§£ä½¿å¾— MapStruct åœ¨ç”Ÿæˆæ˜ å°„ä»£ç æ—¶å…·æœ‰çµæ´»æ€§å’Œå¯é…ç½®æ€§ï¼Œèƒ½å¤Ÿåº”å¯¹å¤šç§å¤æ‚çš„æ˜ å°„éœ€æ±‚ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MapStruct</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ElasticSearch</title>
    <link href="/post/e667cd738d13/"/>
    <url>/post/e667cd738d13/</url>
    
    <content type="html"><![CDATA[<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><h3 id="docker-å®‰è£…"><a href="#docker-å®‰è£…" class="headerlink" title="docker å®‰è£…"></a>docker å®‰è£…</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run -d \<br>        --name es \<br>        -e <span class="hljs-string">&quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;</span> \<br>        -e <span class="hljs-string">&quot;discovery.type=single-node&quot;</span> \<br>        -v es-data:/usr/share/elasticsearch/data \<br>        -v es-plugins:/usr/share/elasticsearch/plugins \<br>        -v es-logs:/usr/share/elasticsearch/logs \<br>        --privileged \ --network es-net \<br>        -p 9200:9200 \<br>        -p 9300:9300 \<br>elasticsearch:7.12.1<br></code></pre></td></tr></table></figure><h3 id="docker-compose-yml"><a href="#docker-compose-yml" class="headerlink" title="docker-compose.yml"></a>docker-compose.yml</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">networks:</span><br>  <span class="hljs-attr">1panel-network:</span><br>    <span class="hljs-attr">external:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">volumes:</span><br>  <span class="hljs-attr">es-volumes:</span><br>    <span class="hljs-attr">external:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">elasticsearch:</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">es</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">elasticsearch:7.12.1</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;discovery.type=single-node&quot;</span> <span class="hljs-comment"># éé›†ç¾¤æ¨¡å—</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;9200:9200&quot;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;9300:9300&quot;</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;es-volumes:/usr/share/elasticsearch&quot;</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">1panel-network</span><br>  <span class="hljs-attr">kibana:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">kibana:7.12.1</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">kibana</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">ELASTICSEARCH_HOSTS=http://es:9200</span> <span class="hljs-comment">#è®¾ç½®è®¿é—®elasticsearchçš„åœ°å€</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">5601</span><span class="hljs-string">:5601</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">1panel-network</span><br></code></pre></td></tr></table></figure><h2 id="å®‰è£…ä¸­æ–‡åˆ†è¯"><a href="#å®‰è£…ä¸­æ–‡åˆ†è¯" class="headerlink" title="å®‰è£…ä¸­æ–‡åˆ†è¯"></a>å®‰è£…ä¸­æ–‡åˆ†è¯</h2><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elixir">root<span class="hljs-variable">@beelink</span><span class="hljs-symbol">:/var/lib/docker/volumes/es-volumes/_data</span><span class="hljs-comment"># bin/elasticsearch-plugin install https://get.infini.cloud/elasticsearch/analysis-ik/7.12.1</span><br></code></pre></td></tr></table></figure><h3 id="éƒ¨ç½²åœ°å€"><a href="#éƒ¨ç½²åœ°å€" class="headerlink" title="éƒ¨ç½²åœ°å€:"></a>éƒ¨ç½²åœ°å€:</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">ES : http:<span class="hljs-regexp">//</span><span class="hljs-number">172.19</span>.<span class="hljs-number">143.22</span>:<span class="hljs-number">9200</span>/<br>Kibanna http:<span class="hljs-regexp">//</span><span class="hljs-number">172.19</span>.<span class="hljs-number">143.22</span>:<span class="hljs-number">5601</span><span class="hljs-regexp">/app/</span>dev_tools<span class="hljs-comment">#/console</span><br></code></pre></td></tr></table></figure><p><a href="http://172.19.143.22:9200/">ES</a></p><p><a href="http://172.19.143.22:5601/app/dev_tools#/console">KibanaDev Tools - Elastic </a></p><h2 id="IK-åˆ†è¯å™¨æ’ä»¶å®‰è£…"><a href="#IK-åˆ†è¯å™¨æ’ä»¶å®‰è£…" class="headerlink" title="IK åˆ†è¯å™¨æ’ä»¶å®‰è£…"></a>IK åˆ†è¯å™¨æ’ä»¶å®‰è£…</h2><h3 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h3><p><a href="https://github.com/infinilabs/analysis-ik/tags?after=v7.12.1">IK åˆ†è¯å™¨æ’ä»¶ Tags Â· infinilabs&#x2F;analysis-ik (github.com)</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">å°†å¯¹äºç‰ˆæœ¬çš„æ’ä»¶ å¦‚ <span class="hljs-number">7.12</span><span class="hljs-number">.1</span> ç‰ˆæœ¬çš„ik <span class="hljs-built_in">zip</span>è§£å‹ æ”¾åœ¨ es çš„pluginsç›®å½•ä¸‹<br></code></pre></td></tr></table></figure><h3 id="åˆ†è¯æµ‹è¯•"><a href="#åˆ†è¯æµ‹è¯•" class="headerlink" title="åˆ†è¯æµ‹è¯•"></a>åˆ†è¯æµ‹è¯•</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs json">POST /_analyze<br><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;analyzer&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;ik_smart&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;text&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;è¿™ä¸ªåˆ°ç§¦å§‹çš‡å°±æ˜¯éå¥½åƒæ˜¯è¢«é‚£ç§é«˜å±‚å§é«˜å±‚æƒ³æ¶ˆç­ä»–ï¼Œç„¶åå°±ç”¨é‚£ä¸ªä»–çš„è½¯è‚‹ï¼Œå°±å› ä¸ºå®ƒå·²ç»å˜æˆæŒæ§äº†æŒæ§ä»–æœ‰ä¸ªè½¯è‚‹æ˜¯ä»–å©†å¨˜ã€‚å¤ç”Ÿè€…ï¼Œå¯¹ï¼Œä½†æ˜¯æŒæ§å¯ä»¥å½±å“å•Šåœ¨å®¾é¦†é‡Œé¢æ˜¯å§ï¼Ÿå—¯ï¼Œå¯¹ï¼Œä½†æ˜¯ã€‚ä¼šå½±å“ä»–çš„é‚£ä¸ªç§¦å§‹çš‡ç„¶ååæ­£ä¹‹åå°±ç›¸å½“äºæ˜¯è‡ªçˆ†æˆ‘é æ™•äº†è‡ªå·±ï¼ŒæŠŠè‡ªå·±ç»™ç­äº†ã€‚ç”¨è…¿ç‹¼ã€‚ä¸ç”¨æ¨å¯¼ä¸ä»–äººã€‚è‡ªå·±æ˜¯ç§¦å§‹çš‡ï¼Œç„¶åä»–æœ¬æ¥æ˜¯æ˜¯å¤©å¤–çš„é‚£ç§ä¿®è¡Œè€…ç„¶ååˆ°åœ°çƒæ¥å¯»æ‰¾çªç ´ä¹‹æ³•ç„¶ååœ°çƒçµæ°”ä¸å¤Ÿï¼Œä»–ä¼ ä¸å›å»äº†ï¼Œç„¶ååæ­£ç§¦å§‹çš‡é‚£äº›ç§¦å§‹çš‡å°±æ˜¯å®ƒå‡ åƒå¹´åä»–è¢«äººæŒ–äº†èµ·æ¥ï¼Œèµ°äº†ã€‚&quot;</span><br><span class="hljs-punctuation">&#125;</span><br><br></code></pre></td></tr></table></figure><h2 id="ç´¢å¼•åº“"><a href="#ç´¢å¼•åº“" class="headerlink" title="ç´¢å¼•åº“"></a>ç´¢å¼•åº“</h2><h3 id="Mapping"><a href="#Mapping" class="headerlink" title="Mapping"></a>Mapping</h3><ul><li>type <ul><li>å­—ç¬¦ä¸² : <code>text</code>(å¯åˆ†è¯)   <code>keyword</code>(ç²¾ç¡®å€¼ , ä¸å¯åˆ†è¯, å¦‚ IP, åœ°å€, å“ç‰Œ)</li><li>æ•°å€¼ : <code>long integer short byte  double float number</code></li><li>å¸ƒå°” : <code>boolean</code></li><li>æ—¥æœŸ : <code>date</code></li><li>å¯¹è±¡ : <code>object</code></li></ul></li><li>index : æ˜¯å¦åˆ›å»ºç´¢å¼• , é»˜è®¤å€¼ <code>true</code></li><li>analyzer : ä½¿ç”¨å“ªç§åˆ†è¯å™¨</li><li>properties : è¯¥å­—æ®µçš„å­å­—æ®µ</li></ul><h3 id="ç´¢å¼•åº“-çš„-CRUD"><a href="#ç´¢å¼•åº“-çš„-CRUD" class="headerlink" title="ç´¢å¼•åº“ çš„ CRUD"></a>ç´¢å¼•åº“ çš„ CRUD</h3><ul><li><p>åˆ›å»ºç´¢å¼•åº“</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs json">PUT /ç´¢å¼•åº“<br><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;mappings&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;field1&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;analyzer&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;ik_smart&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs json">PUT /inyxin<br><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;mappings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;properties&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;keyword&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;age&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;integer&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;address&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;properties&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;city&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><br>                    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;details&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><br>                    <span class="hljs-punctuation">&#125;</span><br>                <span class="hljs-punctuation">&#125;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;description&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;analyzer&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ik_smart&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br><br></code></pre></td></tr></table></figure></li><li><p>æŸ¥è¯¢ç´¢å¼•åº“</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">GET</span> /ç´¢å¼•åº“<br></code></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹ç´¢å¼•åº“ <code>åªæ”¯æŒæ–°å¢å­—æ®µ </code> </p><p>å¦‚æœå­—æ®µå·²ç»å­˜åœ¨ , åˆ™ä¼šæŠ¥é”™</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">PUT <span class="hljs-regexp">/ç´¢å¼•åº“/</span>_mapping<br></code></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs json">PUT /inyxin/_mapping<br><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;properties&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;username&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;keyword&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;index&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;true&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></li><li><p>åˆ é™¤ç´¢å¼•åº“</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gauss"><span class="hljs-keyword">DELETE</span> /ç´¢å¼•åº“<br></code></pre></td></tr></table></figure></li></ul><h2 id="æ–‡æ¡£çš„-CRUD"><a href="#æ–‡æ¡£çš„-CRUD" class="headerlink" title="æ–‡æ¡£çš„ CRUD"></a>æ–‡æ¡£çš„ CRUD</h2><ul><li><p>æ–°å¢</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">PUT <span class="hljs-regexp">/ç´¢å¼•åº“/</span>_doc/æ–‡æ¡£ID<br>&#123;<br>æ–‡æ¡£æ•°æ®<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs json">PUT /inyxin/_doc/<span class="hljs-number">1</span><br><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;inyxin&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;username&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;inyxin&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;age&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;20&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;description&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;ç¡®å®æ˜¯æè¿°&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;address&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;city&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;å››å·Â·è¾¾å·&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;details&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;å››å·æ–‡ç†å­¦é™¢Â·å—åæ ¡åŒº&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>æ·»åŠ æˆåŠŸåå“åº”</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;_index&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;inyxin&quot;</span><span class="hljs-punctuation">,</span>  ç´¢å¼•åº“å<br>  <span class="hljs-attr">&quot;_type&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;_doc&quot;</span><span class="hljs-punctuation">,</span>æ–‡æ¡£å<br>  <span class="hljs-attr">&quot;_id&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1&quot;</span><span class="hljs-punctuation">,</span>æ–‡æ¡£ID<br>  <span class="hljs-attr">&quot;_version&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;result&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;created&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;_shards&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;total&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;successful&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;failed&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;_seq_no&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;_primary_term&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br><span class="hljs-punctuation">&#125;</span><br><br></code></pre></td></tr></table></figure></li><li><p>è¯»å–</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">GET</span> /ç´¢å¼•åº“/_doc/æ–‡æ¡£ID<br></code></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">GET</span> /inyxin/_doc/1<br></code></pre></td></tr></table></figure><p>æŸ¥è¯¢ç»“æœ</p><p><code>_source</code> : åŸå§‹æ–‡æ¡£</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;_index&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;inyxin&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;_type&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;_doc&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;_id&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;_version&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;_seq_no&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;_primary_term&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;found&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;_source&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;name&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;inyxin&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;username&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;inyxin&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;age&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;20&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;description&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ç¡®å®æ˜¯æè¿°&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;address&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;city&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å››å·Â·è¾¾å·&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;details&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å››å·æ–‡ç†å­¦é™¢Â·å—åæ ¡åŒº&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹</p><ul><li><p><code> å…¨é‡ä¿®æ”¹ (è¦†ç›–ä¿®æ”¹)</code> </p><p>è‹¥æ–‡æ¡£ ID å·²å­˜åœ¨ , åˆ™ä¼šå…ˆåˆ é™¤æ—§çš„æ–‡æ¡£, åœ¨è¿›è¡Œæ–°å¢ ,</p><p>å¦åˆ™ å°±æ˜¯æ·»åŠ ä¸€ä¸ªæ–°çš„æ–‡æ¡£</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">PUT <span class="hljs-regexp">/ç´¢å¼•åº“/</span>_doc/æ–‡æ¡£ID  åŒæ–°å¢<br>&#123;&#125;<br></code></pre></td></tr></table></figure></li><li><p><code>å¢é‡ä¿®æ”¹ (å±€éƒ¨ä¿®æ”¹)</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs json">UPDATE  /ç´¢å¼•åº“/_update/æ–‡æ¡£ID<br><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;doc&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;YINIXN&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;age&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">21</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></li></ul></li><li><p>åˆ é™¤</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">DELETE</span> <span class="hljs-regexp">/ç´¢å¼•åº“/</span>_doc/<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure></li></ul><h1 id="DSL"><a href="#DSL" class="headerlink" title="DSL"></a>DSL</h1><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">GET</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>åç«¯</category>
      
      <category>ä¸­é—´ä»¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ElasticSearch</tag>
      
      <tag>æœç´¢å¼•æ“</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linuxå¯åŠ¨è„šæœ¬</title>
    <link href="/post/fe20cd40b669/"/>
    <url>/post/fe20cd40b669/</url>
    
    <content type="html"><![CDATA[<h2 id="å®ç°ç”¨æˆ·ç™»å½•åæ‰§è¡Œç‰¹å®šå¯åŠ¨è„šæœ¬"><a href="#å®ç°ç”¨æˆ·ç™»å½•åæ‰§è¡Œç‰¹å®šå¯åŠ¨è„šæœ¬" class="headerlink" title="å®ç°ç”¨æˆ·ç™»å½•åæ‰§è¡Œç‰¹å®šå¯åŠ¨è„šæœ¬"></a>å®ç°ç”¨æˆ·ç™»å½•åæ‰§è¡Œç‰¹å®šå¯åŠ¨è„šæœ¬</h2><h3 id="1-ä½¿ç”¨-bash-profile-æˆ–-bashrc"><a href="#1-ä½¿ç”¨-bash-profile-æˆ–-bashrc" class="headerlink" title="1. ä½¿ç”¨ .bash_profile æˆ– .bashrc"></a>1. ä½¿ç”¨ <code>.bash_profile</code> æˆ– <code>.bashrc</code></h3><p>å¦‚æœä½¿ç”¨çš„æ˜¯ Bash shellï¼Œå¯ä»¥å°†å¯åŠ¨è„šæœ¬æ·»åŠ åˆ°ç”¨æˆ·ä¸»ç›®å½•ä¸‹çš„ <code>.bash_profile</code> æˆ– <code>.bashrc</code> æ–‡ä»¶ä¸­ã€‚</p><h4 id="bash-profile"><a href="#bash-profile" class="headerlink" title=".bash_profile"></a>.bash_profile</h4><p><code>.bash_profile</code> åœ¨ç”¨æˆ·ç™»å½•æ—¶è¿è¡Œä¸€æ¬¡ã€‚é€‚ç”¨äºç™»å½• shellã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">bashCopy Code# ç¼–è¾‘ç”¨æˆ·ä¸»ç›®å½•ä¸‹çš„ .bash_profile æ–‡ä»¶<br>nano ~/.bash_profile<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ è¦æ‰§è¡Œçš„è„šæœ¬</span><br>/path/to/your/script.sh<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ä¿å­˜å¹¶é€€å‡º</span><br></code></pre></td></tr></table></figure><h4 id="bashrc"><a href="#bashrc" class="headerlink" title=".bashrc"></a>.bashrc</h4><p><code>.bashrc</code> åœ¨æ¯æ¬¡æ‰“å¼€ä¸€ä¸ªæ–°çš„ shell æ—¶è¿è¡Œã€‚é€‚ç”¨äºéç™»å½• shellã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">bashCopy Code# ç¼–è¾‘ç”¨æˆ·ä¸»ç›®å½•ä¸‹çš„ .bashrc æ–‡ä»¶<br>nano ~/.bashrc<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ è¦æ‰§è¡Œçš„è„šæœ¬</span><br>/path/to/your/script.sh<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ä¿å­˜å¹¶é€€å‡º</span><br></code></pre></td></tr></table></figure><h3 id="2-ä½¿ç”¨-profile"><a href="#2-ä½¿ç”¨-profile" class="headerlink" title="2. ä½¿ç”¨ .profile"></a>2. ä½¿ç”¨ <code>.profile</code></h3><p>æŸäº› Linux å‘è¡Œç‰ˆå’Œ shellï¼ˆå¦‚ Dashï¼‰ä½¿ç”¨ <code>.profile</code> æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶åœ¨ç”¨æˆ·ç™»å½•æ—¶è¿è¡Œã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">bashCopy Code<span class="hljs-comment"># ç¼–è¾‘ç”¨æˆ·ä¸»ç›®å½•ä¸‹çš„ .profile æ–‡ä»¶</span><br>nano ~/.profile<br><br><span class="hljs-comment"># åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ è¦æ‰§è¡Œçš„è„šæœ¬</span><br>/path/to/your/script.sh<br><br><span class="hljs-comment"># ä¿å­˜å¹¶é€€å‡º</span><br></code></pre></td></tr></table></figure><h3 id="3-ä½¿ç”¨-etc-profile-å’Œ-etc-profile-d"><a href="#3-ä½¿ç”¨-etc-profile-å’Œ-etc-profile-d" class="headerlink" title="3. ä½¿ç”¨ /etc/profile å’Œ /etc/profile.d"></a>3. ä½¿ç”¨ <code>/etc/profile</code> å’Œ <code>/etc/profile.d</code></h3><p>å¯¹äºå…¨ç³»ç»ŸèŒƒå›´å†…çš„é…ç½®ï¼Œå¯ä»¥ç¼–è¾‘ <code>/etc/profile</code> æ–‡ä»¶ï¼Œæˆ–åœ¨ <code>/etc/profile.d</code> ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–°çš„è„šæœ¬ã€‚</p><h4 id="etc-profile"><a href="#etc-profile" class="headerlink" title="&#x2F;etc&#x2F;profile"></a>&#x2F;etc&#x2F;profile</h4><p>åœ¨æ‰€æœ‰ç”¨æˆ·ç™»å½•æ—¶è¿è¡Œã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">bashCopy Code<span class="hljs-comment"># ç¼–è¾‘ /etc/profile æ–‡ä»¶ï¼ˆéœ€è¦rootæƒé™ï¼‰</span><br>sudo nano /etc/profile<br><br><span class="hljs-comment"># åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ è¦æ‰§è¡Œçš„è„šæœ¬</span><br>/path/to/your/script.sh<br><br><span class="hljs-comment"># ä¿å­˜å¹¶é€€å‡º</span><br></code></pre></td></tr></table></figure><h4 id="etc-profile-d"><a href="#etc-profile-d" class="headerlink" title="&#x2F;etc&#x2F;profile.d"></a>&#x2F;etc&#x2F;profile.d</h4><p>åœ¨ <code>/etc/profile.d</code> ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–°çš„è„šæœ¬æ–‡ä»¶ï¼ˆå¿…é¡»ä»¥ <code>.sh</code> ç»“å°¾ï¼‰ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">bashCopy Code<span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªæ–°çš„è„šæœ¬æ–‡ä»¶ï¼ˆéœ€è¦rootæƒé™ï¼‰</span><br>sudo nano /etc/profile.d/myscript.sh<br><br><span class="hljs-comment"># æ·»åŠ è¦æ‰§è¡Œçš„å†…å®¹</span><br>/path/to/your/script.sh<br><br><span class="hljs-comment"># ä¿å­˜å¹¶é€€å‡º</span><br></code></pre></td></tr></table></figure><h3 id="4-ä½¿ç”¨-xinitrc-æˆ–-xsession"><a href="#4-ä½¿ç”¨-xinitrc-æˆ–-xsession" class="headerlink" title="4. ä½¿ç”¨ .xinitrc æˆ– .xsession"></a>4. ä½¿ç”¨ <code>.xinitrc</code> æˆ– <code>.xsession</code></h3><p>å¦‚æœä½¿ç”¨å›¾å½¢ç•Œé¢å¹¶å¸Œæœ›åœ¨ X ä¼šè¯å¯åŠ¨æ—¶è¿è¡Œè„šæœ¬ï¼Œå¯ä»¥ä½¿ç”¨ <code>.xinitrc</code> æˆ– <code>.xsession</code> æ–‡ä»¶ã€‚</p><h4 id="xinitrc"><a href="#xinitrc" class="headerlink" title=".xinitrc"></a>.xinitrc</h4><p>é€‚ç”¨äºä½¿ç”¨ <code>startx</code> å¯åŠ¨ X ä¼šè¯çš„ç”¨æˆ·ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">bashCopy Code<span class="hljs-comment"># ç¼–è¾‘ç”¨æˆ·ä¸»ç›®å½•ä¸‹çš„ .xinitrc æ–‡ä»¶</span><br>nano ~/.xinitrc<br><br><span class="hljs-comment"># åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ è¦æ‰§è¡Œçš„è„šæœ¬</span><br>/path/to/your/script.sh<br><br><span class="hljs-comment"># ä¿å­˜å¹¶é€€å‡º</span><br></code></pre></td></tr></table></figure><h4 id="xsession"><a href="#xsession" class="headerlink" title=".xsession"></a>.xsession</h4><p>é€‚ç”¨äºä½¿ç”¨æ˜¾ç¤ºç®¡ç†å™¨ï¼ˆå¦‚ GDMã€LightDMï¼‰å¯åŠ¨ X ä¼šè¯çš„ç”¨æˆ·ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh">bashCopy Code<span class="hljs-comment"># ç¼–è¾‘ç”¨æˆ·ä¸»ç›®å½•ä¸‹çš„ .xsession æ–‡ä»¶</span><br>nano ~/.xsession<br><br><span class="hljs-comment"># åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ è¦æ‰§è¡Œçš„è„šæœ¬</span><br>/path/to/your/script.sh<br><br><span class="hljs-comment"># ä¿å­˜å¹¶é€€å‡º</span><br></code></pre></td></tr></table></figure><p>é€‰æ‹©åˆé€‚çš„æ–¹æ³•å–å†³äºå…·ä½“éœ€æ±‚å’Œç³»ç»Ÿç¯å¢ƒã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå¯¹äºå•ä¸ªç”¨æˆ·å’Œå‘½ä»¤è¡Œç¯å¢ƒï¼Œä¿®æ”¹ <code>.bash_profile</code> æˆ– <code>.bashrc</code> æ˜¯æœ€å¸¸ç”¨çš„æ–¹æ³•ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>default</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Docker</title>
    <link href="/post/8a8dcb035543/"/>
    <url>/post/8a8dcb035543/</url>
    
    <content type="html"><![CDATA[<h2 id="é•œåƒ"><a href="#é•œåƒ" class="headerlink" title="é•œåƒ"></a>é•œåƒ</h2><ul><li><p><code>docker version</code> æ˜¾ç¤º docekr çš„è¯¦ç»†ä¿¡æ¯</p></li><li><p><code>docker info</code> æ˜¾ç¤º docker çš„ç³»ç»Ÿä¿¡æ¯</p></li><li><p><code>docker --help</code> docker çš„å‘½ä»¤å¸®åŠ©æ‰‹å†Œ</p></li><li><p><code>docker search &#123;å…³é”®å­—&#125;</code> æœç´¢é•œåƒ</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker search nginx <span class="hljs-comment">#æœç´¢nginxé•œåƒ</span><br>docker search openjdk <span class="hljs-comment">#æœç´¢openjdké•œåƒ</span><br></code></pre></td></tr></table></figure></li><li><p><code>docker pull &#123;é•œåƒå[æ ‡ç­¾]&#125;</code> æ‹‰å–é•œåƒ</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker pull nginx <span class="hljs-comment">#æ‹‰å– nginxé•œåƒ</span><br>docker pull openjdk:latest <span class="hljs-comment">#æ‹‰å– openjdké•œåƒ</span><br></code></pre></td></tr></table></figure></li><li><p><code>docker images</code> æŸ¥çœ‹å·²ç»ä¸‹è½½çš„é•œåƒ</p></li><li><p><code>docker rmi &#123;é•œåƒåæˆ–é•œåƒID&#125;</code> åˆ é™¤é•œåƒ</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker rmi nginx <span class="hljs-comment"># åˆ é™¤é•œåƒåä¸ºnginxçš„é•œåƒ</span><br>docker rmi e235nd <span class="hljs-comment"># æ ¹æ®é•œåƒIDåˆ é™¤</span><br></code></pre></td></tr></table></figure></li><li><p><code>docker tag &#123;åŸæ¥çš„é•œåƒå[:æ ‡ç­¾]&#125; &#123;æ–°çš„é•œåƒå[:æ ‡ç­¾]&#125;</code> å¤åˆ¶é•œåƒå¹¶ä¿®æ”¹åç§°</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker tag SOURCE_IMAGE[:TAG] TARGET_IMAGE[:TAG]<br><span class="hljs-comment">#SOURCE_IMAGE æ˜¯è¦æ ‡è®°çš„ç°æœ‰é•œåƒçš„åç§°æˆ– IDã€‚</span><br><span class="hljs-comment">#TARGET_IMAGE æ˜¯ä¸ºç°æœ‰é•œåƒæŒ‡å®šçš„æ–°æ ‡ç­¾çš„åç§°ã€‚</span><br><span class="hljs-comment">#TAG æ˜¯å¯é€‰çš„æ ‡ç­¾ï¼Œç”¨äºæŒ‡å®šç‰ˆæœ¬æˆ–å…¶ä»–ç‰¹å®šæ ‡è¯†ç¬¦ã€‚</span><br>ä¾‹å¦‚:<br>docker tag nginx inyxin/nginx:beta  <br></code></pre></td></tr></table></figure></li><li><p><code>docker load -i &#123;é•œåƒçš„tar&#125;</code>  å¯¼å…¥é•œåƒ</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker load -i /root/docker-centos-httpd.tar<br></code></pre></td></tr></table></figure></li><li><p><code>docker save -o &#123;é•œåƒçš„tar&#125; &#123;é•œåƒå&#125;</code>  å¯¼å‡ºé•œåƒ</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker save -o xxx.tar é•œåƒå<br>docker save -o my_image.tar my_image <br></code></pre></td></tr></table></figure></li></ul><h2 id="å®¹å™¨"><a href="#å®¹å™¨" class="headerlink" title="å®¹å™¨"></a>å®¹å™¨</h2><ul><li><p><code>docker run [å‚æ•°] &#123;é•œåƒ&#125; [COMMAND] [ARG...]</code> <strong>å¯åŠ¨å®¹å™¨ (é‡ç‚¹)</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#è¯­æ³•</span><br>docker run [OPTIONS] IMAGE [COMMAND] [ARG...]<br><span class="hljs-comment">#[OPTIONS]</span><br>-d, --detachï¼šåœ¨åå°è¿è¡Œå®¹å™¨ã€‚<br>--nameï¼šä¸ºå®¹å™¨æŒ‡å®šä¸€ä¸ªåç§°ã€‚<br>-p, --publishï¼šå°†å®¹å™¨ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœºç«¯å£ã€‚<br>-v, --volumeï¼šæŒ‚è½½å®¿ä¸»æœºç›®å½•åˆ°å®¹å™¨å†…éƒ¨ã€‚<br>-e, --<span class="hljs-built_in">env</span>ï¼šè®¾ç½®ç¯å¢ƒå˜é‡ã€‚<br>--networkï¼šè¿æ¥å®¹å™¨åˆ°æŒ‡å®šçš„ç½‘ç»œã€‚<br>--restartï¼šåœ¨å®¹å™¨é€€å‡ºæ—¶æŒ‡å®šé‡å¯ç­–ç•¥ã€‚<br>--<span class="hljs-built_in">rm</span>ï¼šå®¹å™¨é€€å‡ºæ—¶è‡ªåŠ¨åˆ é™¤ã€‚<br>-itï¼šäº¤äº’å¼æ“ä½œï¼Œé€šå¸¸ä¸ -iï¼ˆæ ‡å‡†è¾“å…¥ï¼‰å’Œ -tï¼ˆç»ˆç«¯ï¼‰ä¸€èµ·ä½¿ç”¨ã€‚<br><span class="hljs-comment"># [COMMAND] [ARG...]</span><br><span class="hljs-comment">#å¯ä»¥è¦†ç›–é»˜è®¤çš„å‘½ä»¤å’Œå‚æ•°ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥è¦†ç›–é»˜è®¤çš„å‘½ä»¤ï¼š</span><br>docker run my_image <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Hello, Docker!&quot;</span><br><span class="hljs-comment">#åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œecho &quot;Hello, Docker!&quot; å°†è¦†ç›–é•œåƒä¸­å®šä¹‰çš„é»˜è®¤å‘½ä»¤ï¼Œå®¹å™¨å°†è¾“å‡º Hello, Docker! è€Œä¸æ˜¯ Hello, World!ã€‚</span><br></code></pre></td></tr></table></figure></li><li><p><code>docker build [OPTIONS]</code> åˆ›å»ºé•œåƒ</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker build [OPTIONS]<br><span class="hljs-comment">#[OPTIONS]</span><br>-f : æŒ‡å®šdockerfileæ–‡ä»¶è·¯å¾„ , é»˜è®¤å°±æ˜¯å½“å‰ç›®å½•çš„ Dockerfile æ–‡ä»¶<br>-t : æ„å»ºåçš„é•œåƒåä»¥åŠæ ‡ç­¾<br><span class="hljs-comment">#[EXAMPLE]</span><br>docker build -t inyxin/openjdk:1.8 <br></code></pre></td></tr></table></figure></li><li><p><code>docker logs &#123;å®¹å™¨ID&#125;</code>  æŸ¥çœ‹å®¹å™¨æ—¥å¿—</p></li><li><p><code>docker rename &#123;æ—§åå­—&#125; &#123;æ–°åå­—&#125;</code> å®¹å™¨é‡å‘½å</p></li><li><p><code>docker ps [-a]</code>  æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨ [ -a æŸ¥çœ‹å…¨éƒ¨å®¹å™¨ ] </p></li><li><p><code>docekr kill &#123;å®¹å™¨å æˆ– å®¹å™¨ID&#125;</code> æ€æ­»ä¸€ä¸ªå®¹å™¨</p></li><li><p><code>docker rm &#123;å®¹å™¨å æˆ– å®¹å™¨ID&#125;</code> åˆ é™¤å®¹å™¨</p></li></ul><p>[^{å®¹å™¨å æˆ– å®¹å™¨ ID}]: ä»¥ä¸‹ç®€ç§° {å®¹å™¨ID}</p><ul><li><p><code>docker history &#123;å®¹å™¨ID&#125;</code>  æŸ¥çœ‹ docker é•œåƒçš„å˜æ›´å†å²</p></li><li><p><code>docker start &#123;å®¹å™¨ID&#125;</code> å¯åŠ¨ä¸€ä¸ªå®¹å™¨</p></li><li><p><code>docker restart &#123;å®¹å™¨ID&#125;</code>  é‡å¯å®¹å™¨</p></li><li><p><code>docker stop</code> åœæ­¢å®¹å™¨</p></li><li><p><code>doceker image inspect &#123;å®¹å™¨ID&#125;</code>  æŸ¥çœ‹å®¹å™¨å†…æºæ•°æ®</p></li><li><p><code>docker cp &#123;å®¹å™¨ID&#125;:è·¯å¾„ ä¸»æœºè·¯å¾„</code> ä»å®¹å™¨å†…æ‹·è´æ–‡ä»¶åˆ°ä¸»æœº</p></li><li><p><code>docker exec -it &#123;å®¹å™¨åID&#125; /bin/bash</code> è¿›å…¥å®¹å™¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker <span class="hljs-built_in">exec</span> -it 1Panel-minio-UuPy /bin/bash<br></code></pre></td></tr></table></figure></li><li><p><code>docker commit -m=&quot;æäº¤çš„æè¿°ä¿¡æ¯&quot;  -a=&quot;ä½œè€…&quot;  &#123;å®¹å™¨id&#125;  &#123;ç›®æ ‡é•œåƒå:[TAG]&#125;</code></p></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run \<br>--name inyxin-minio \ <br>-v <span class="hljs-string">&quot;/opt/1panel/apps/minio/minio/data:/data&quot;</span> \ <br>-v <span class="hljs-string">&quot;/opt/1panel/apps/minio/minio/certs:/root/.minio/certs&quot;</span> \<br>-p <span class="hljs-string">&quot;9001:9001&quot;</span> \ <br>-p <span class="hljs-string">&quot;9000:9000&quot;</span> \<br>--restart always \ <br>-e MINIO_ROOT_PASSWORD=<span class="hljs-string">&quot;1423716216@qq.com&quot;</span> \ <br>-e MINIO_ROOT_USER=<span class="hljs-string">&quot;1423716216@qq.com&quot;</span> \<br>-e MINIO_SERVER_URL=<span class="hljs-string">&quot;http://127.0.0.1:9000&quot;</span> \<br>-e MINIO_BROWSER=on \<br>-e MINIO_BROWSER_LOGIN_ANIMATION=on \<br>-e MINIO_BROWSER_REDIRECT_URL=<span class="hljs-string">&quot;http://127.0.0.1:9001&quot;</span> \<br>-e MINIO_BROWSER_SESSION_DURATION=12h \<br>-e PATH=/opt/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin \<br>-e container=oci \<br>-e MINIO_ACCESS_KEY_FILE=access_key \<br>-e MINIO_SECRET_KEY_FILE=secret_key \<br>-e MINIO_ROOT_USER_FILE=access_key \<br>-e MINIO_ROOT_PASSWORD_FILE=secret_key \<br>-e MINIO_KMS_SECRET_KEY_FILE=kms_master_key \<br>-e MINIO_UPDATE_MINISIGN_PUBKEY=RWTx5Zr1tiHQLwG9keckT0c45M3AGeHD6IvimQHpyRywVWGbP1aVSGav \<br>-e MINIO_CONFIG_ENV_FILE=config.env \<br>minio/minio <br><br></code></pre></td></tr></table></figure><h2 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># æŒ‡å®šåŸºç¡€é•œåƒï¼Œä¾‹å¦‚ node:14ã€‚è¿™æ˜¯ Dockerfile çš„ç¬¬ä¸€æ¡æŒ‡ä»¤ï¼Œå®šä¹‰äº†æ–°é•œåƒæ˜¯åŸºäºå“ªä¸ªå·²æœ‰é•œåƒåˆ›å»ºçš„ã€‚</span><br>FROM &lt;base_image&gt;<br><br><span class="hljs-comment"># è®¾ç½®ä½œè€…ä¿¡æ¯ (å¯é€‰)</span><br>LABEL maintainer=<span class="hljs-string">&quot;&lt;your_name&gt; &lt;your_email&gt;&quot;</span><br><br><span class="hljs-comment"># è®¾ç½®å·¥ä½œç›®å½•ã€‚æ‰€æœ‰åç»­çš„ COPY, ADD, RUN ç­‰æŒ‡ä»¤éƒ½å°†åœ¨è¿™ä¸ªç›®å½•ä¸‹æ‰§è¡Œã€‚ä¾‹å¦‚ WORKDIR /usr/src/app</span><br>WORKDIR /usr/src/app<br><br><span class="hljs-comment"># å¤åˆ¶æ–‡ä»¶åˆ°é•œåƒä¸­</span><br>COPY &lt;<span class="hljs-built_in">source</span>&gt; &lt;destination&gt;<br><br><span class="hljs-comment"># ä¸‹è½½å¹¶å®‰è£…ä¾èµ–åŒ…</span><br>RUN &lt;<span class="hljs-built_in">command</span>&gt;<br><br><span class="hljs-comment"># è®¾ç½®ç¯å¢ƒå˜é‡ (å¯é€‰)</span><br>ENV &lt;key&gt;=&lt;value&gt;<br><br><span class="hljs-comment"># æš´éœ²ç«¯å£ (å¯é€‰)</span><br>EXPOSE &lt;port&gt;<br><br><span class="hljs-comment"># è¿è¡Œå®¹å™¨å¯åŠ¨æ—¶çš„å‘½ä»¤ ,ä¸ CMD ç±»ä¼¼ï¼Œä½† ENTRYPOINT ä¸ä¼šè¢« docker run æä¾›çš„å‚æ•°è¦†ç›–ã€‚ä¾‹å¦‚ï¼š</span><br>ENTRYPOINT [<span class="hljs-string">&quot;&lt;command&gt;&quot;</span>]<br><br><span class="hljs-comment"># æŒ‡å®šé»˜è®¤å‚æ•° (å¯é€‰) æŒ‡å®šå®¹å™¨å¯åŠ¨æ—¶è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚ä¾‹å¦‚ï¼ŒCMD [&quot;npm&quot;, &quot;start&quot;]ã€‚æ³¨æ„ï¼ŒCMD åªä¼šæœ‰ä¸€ä¸ªç”Ÿæ•ˆï¼Œå¦‚æœå­˜åœ¨å¤šä¸ª CMD æŒ‡ä»¤ï¼Œåªæœ‰æœ€åä¸€ä¸ªä¼šè¢«æ‰§è¡Œã€‚</span><br>CMD [<span class="hljs-string">&quot;&lt;args&gt;&quot;</span>]<br></code></pre></td></tr></table></figure><p>é€šè¿‡ &#96;docker build -t {é•œåƒ: æ ‡ç­¾} å³å¯æ„å»º</p><h2 id=""><a href="#" class="headerlink" title=""></a></h2><h2 id="å­˜å‚¨å·"><a href="#å­˜å‚¨å·" class="headerlink" title="å­˜å‚¨å·"></a>å­˜å‚¨å·</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">Usage:</span>  <span class="hljs-string">docker</span> <span class="hljs-string">volume</span> <span class="hljs-string">COMMAND</span><br><br><span class="hljs-string">Manage</span> <span class="hljs-string">volumes</span><br><br><span class="hljs-attr">Commands:</span><br>  <span class="hljs-string">create</span>      <span class="hljs-string">Create</span> <span class="hljs-string">a</span> <span class="hljs-string">volume</span><br>  <span class="hljs-string">inspect</span>     <span class="hljs-string">Display</span> <span class="hljs-string">detailed</span> <span class="hljs-string">information</span> <span class="hljs-string">on</span> <span class="hljs-string">one</span> <span class="hljs-string">or</span> <span class="hljs-string">more</span> <span class="hljs-string">volumes</span><br>  <span class="hljs-string">ls</span>          <span class="hljs-string">List</span> <span class="hljs-string">volumes</span><br>  <span class="hljs-string">prune</span>       <span class="hljs-string">Remove</span> <span class="hljs-string">unused</span> <span class="hljs-string">local</span> <span class="hljs-string">volumes</span><br>  <span class="hljs-string">rm</span>          <span class="hljs-string">Remove</span> <span class="hljs-string">one</span> <span class="hljs-string">or</span> <span class="hljs-string">more</span> <span class="hljs-string">volumes</span><br></code></pre></td></tr></table></figure><h2 id="ç½‘ç»œ"><a href="#ç½‘ç»œ" class="headerlink" title="ç½‘ç»œ"></a>ç½‘ç»œ</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">Usage:</span>  <span class="hljs-string">docker</span> <span class="hljs-string">network</span> <span class="hljs-string">COMMAND</span><br><br><span class="hljs-string">Manage</span> <span class="hljs-string">networks</span><br><br><span class="hljs-attr">Commands:</span><br>  <span class="hljs-string">connect</span>     <span class="hljs-string">Connect</span> <span class="hljs-string">a</span> <span class="hljs-string">container</span> <span class="hljs-string">to</span> <span class="hljs-string">a</span> <span class="hljs-string">network</span><br>  <span class="hljs-string">create</span>      <span class="hljs-string">Create</span> <span class="hljs-string">a</span> <span class="hljs-string">network</span><br>  <span class="hljs-string">disconnect</span>  <span class="hljs-string">Disconnect</span> <span class="hljs-string">a</span> <span class="hljs-string">container</span> <span class="hljs-string">from</span> <span class="hljs-string">a</span> <span class="hljs-string">network</span><br>  <span class="hljs-string">inspect</span>     <span class="hljs-string">Display</span> <span class="hljs-string">detailed</span> <span class="hljs-string">information</span> <span class="hljs-string">on</span> <span class="hljs-string">one</span> <span class="hljs-string">or</span> <span class="hljs-string">more</span> <span class="hljs-string">networks</span><br>  <span class="hljs-string">ls</span>          <span class="hljs-string">List</span> <span class="hljs-string">networks</span><br>  <span class="hljs-string">prune</span>       <span class="hljs-string">Remove</span> <span class="hljs-string">all</span> <span class="hljs-string">unused</span> <span class="hljs-string">networks</span><br>  <span class="hljs-string">rm</span>          <span class="hljs-string">Remove</span> <span class="hljs-string">one</span> <span class="hljs-string">or</span> <span class="hljs-string">more</span> <span class="hljs-string">networks</span><br></code></pre></td></tr></table></figure><h2 id="DockerCompose"><a href="#DockerCompose" class="headerlink" title="DockerCompose"></a>DockerCompose</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">Usage:</span>  <span class="hljs-string">docker</span> <span class="hljs-string">compose</span> [<span class="hljs-string">OPTIONS</span>] <span class="hljs-string">COMMAND</span><br><br><span class="hljs-string">Define</span> <span class="hljs-string">and</span> <span class="hljs-string">run</span> <span class="hljs-string">multi-container</span> <span class="hljs-string">applications</span> <span class="hljs-string">with</span> <span class="hljs-string">Docker</span><br><br><span class="hljs-attr">Options:</span><br>      <span class="hljs-string">--all-resources</span>              <span class="hljs-string">Include</span> <span class="hljs-string">all</span> <span class="hljs-string">resources,</span> <span class="hljs-string">even</span> <span class="hljs-string">those</span> <span class="hljs-string">not</span> <span class="hljs-string">used</span> <span class="hljs-string">by</span> <span class="hljs-string">services</span><br>      <span class="hljs-string">--ansi</span> <span class="hljs-string">string</span>                <span class="hljs-string">Control</span> <span class="hljs-string">when</span> <span class="hljs-string">to</span> <span class="hljs-string">print</span> <span class="hljs-string">ANSI</span> <span class="hljs-string">control</span> <span class="hljs-string">characters</span> <span class="hljs-string">(&quot;never&quot;|&quot;always&quot;|&quot;auto&quot;)</span> <span class="hljs-string">(default</span> <span class="hljs-string">&quot;auto&quot;</span><span class="hljs-string">)</span><br>      <span class="hljs-string">--compatibility</span>              <span class="hljs-string">Run</span> <span class="hljs-string">compose</span> <span class="hljs-string">in</span> <span class="hljs-string">backward</span> <span class="hljs-string">compatibility</span> <span class="hljs-string">mode</span><br>      <span class="hljs-string">--dry-run</span>                    <span class="hljs-string">Execute</span> <span class="hljs-string">command</span> <span class="hljs-string">in</span> <span class="hljs-string">dry</span> <span class="hljs-string">run</span> <span class="hljs-string">mode</span><br>      <span class="hljs-string">--env-file</span> <span class="hljs-string">stringArray</span>       <span class="hljs-string">Specify</span> <span class="hljs-string">an</span> <span class="hljs-string">alternate</span> <span class="hljs-string">environment</span> <span class="hljs-string">file</span><br>  <span class="hljs-string">-f,</span> <span class="hljs-string">--file</span> <span class="hljs-string">stringArray</span>           <span class="hljs-string">Compose</span> <span class="hljs-string">configuration</span> <span class="hljs-string">files</span><br>      <span class="hljs-string">--parallel</span> <span class="hljs-string">int</span>               <span class="hljs-string">Control</span> <span class="hljs-string">max</span> <span class="hljs-string">parallelism,</span> <span class="hljs-number">-1</span> <span class="hljs-string">for</span> <span class="hljs-string">unlimited</span> <span class="hljs-string">(default</span> <span class="hljs-number">-1</span><span class="hljs-string">)</span><br>      <span class="hljs-string">--profile</span> <span class="hljs-string">stringArray</span>        <span class="hljs-string">Specify</span> <span class="hljs-string">a</span> <span class="hljs-string">profile</span> <span class="hljs-string">to</span> <span class="hljs-string">enable</span><br>      <span class="hljs-string">--progress</span> <span class="hljs-string">string</span>            <span class="hljs-string">Set</span> <span class="hljs-string">type</span> <span class="hljs-string">of</span> <span class="hljs-string">progress</span> <span class="hljs-string">output</span> <span class="hljs-string">(auto,</span> <span class="hljs-string">tty,</span> <span class="hljs-string">plain,</span> <span class="hljs-string">quiet)</span> <span class="hljs-string">(default</span> <span class="hljs-string">&quot;auto&quot;</span><span class="hljs-string">)</span><br>      <span class="hljs-string">--project-directory</span> <span class="hljs-string">string</span>   <span class="hljs-string">Specify</span> <span class="hljs-string">an</span> <span class="hljs-string">alternate</span> <span class="hljs-string">working</span> <span class="hljs-string">directory</span><br>                                   <span class="hljs-string">(default:</span> <span class="hljs-string">the</span> <span class="hljs-string">path</span> <span class="hljs-string">of</span> <span class="hljs-string">the,</span> <span class="hljs-string">first</span> <span class="hljs-string">specified,</span> <span class="hljs-string">Compose</span> <span class="hljs-string">file)</span><br>  <span class="hljs-string">-p,</span> <span class="hljs-string">--project-name</span> <span class="hljs-string">string</span>        <span class="hljs-string">Project</span> <span class="hljs-string">name</span><br><br><span class="hljs-attr">Commands:</span><br>  <span class="hljs-string">attach</span>      <span class="hljs-string">Attach</span> <span class="hljs-string">local</span> <span class="hljs-string">standard</span> <span class="hljs-string">input,</span> <span class="hljs-string">output,</span> <span class="hljs-string">and</span> <span class="hljs-string">error</span> <span class="hljs-string">streams</span> <span class="hljs-string">to</span> <span class="hljs-string">a</span> <span class="hljs-string">service&#x27;s</span> <span class="hljs-string">running</span> <span class="hljs-string">container</span><br>  <span class="hljs-string">build</span>       <span class="hljs-string">Build</span> <span class="hljs-string">or</span> <span class="hljs-string">rebuild</span> <span class="hljs-string">services</span><br>  <span class="hljs-string">config</span>      <span class="hljs-string">Parse,</span> <span class="hljs-string">resolve</span> <span class="hljs-string">and</span> <span class="hljs-string">render</span> <span class="hljs-string">compose</span> <span class="hljs-string">file</span> <span class="hljs-string">in</span> <span class="hljs-string">canonical</span> <span class="hljs-string">format</span><br>  <span class="hljs-string">cp</span>          <span class="hljs-string">Copy</span> <span class="hljs-string">files/folders</span> <span class="hljs-string">between</span> <span class="hljs-string">a</span> <span class="hljs-string">service</span> <span class="hljs-string">container</span> <span class="hljs-string">and</span> <span class="hljs-string">the</span> <span class="hljs-string">local</span> <span class="hljs-string">filesystem</span><br>  <span class="hljs-string">create</span>      <span class="hljs-string">Creates</span> <span class="hljs-string">containers</span> <span class="hljs-string">for</span> <span class="hljs-string">a</span> <span class="hljs-string">service</span><br>  <span class="hljs-string">down</span>        <span class="hljs-string">Stop</span> <span class="hljs-string">and</span> <span class="hljs-string">remove</span> <span class="hljs-string">containers,</span> <span class="hljs-string">networks</span><br>  <span class="hljs-string">events</span>      <span class="hljs-string">Receive</span> <span class="hljs-string">real</span> <span class="hljs-string">time</span> <span class="hljs-string">events</span> <span class="hljs-string">from</span> <span class="hljs-string">containers</span><br>  <span class="hljs-string">exec</span>        <span class="hljs-string">Execute</span> <span class="hljs-string">a</span> <span class="hljs-string">command</span> <span class="hljs-string">in</span> <span class="hljs-string">a</span> <span class="hljs-string">running</span> <span class="hljs-string">container</span><br>  <span class="hljs-string">images</span>      <span class="hljs-string">List</span> <span class="hljs-string">images</span> <span class="hljs-string">used</span> <span class="hljs-string">by</span> <span class="hljs-string">the</span> <span class="hljs-string">created</span> <span class="hljs-string">containers</span><br>  <span class="hljs-string">kill</span>        <span class="hljs-string">Force</span> <span class="hljs-string">stop</span> <span class="hljs-string">service</span> <span class="hljs-string">containers</span><br>  <span class="hljs-string">logs</span>        <span class="hljs-string">View</span> <span class="hljs-string">output</span> <span class="hljs-string">from</span> <span class="hljs-string">containers</span><br>  <span class="hljs-string">ls</span>          <span class="hljs-string">List</span> <span class="hljs-string">running</span> <span class="hljs-string">compose</span> <span class="hljs-string">projects</span><br>  <span class="hljs-string">pause</span>       <span class="hljs-string">Pause</span> <span class="hljs-string">services</span><br>  <span class="hljs-string">port</span>        <span class="hljs-string">Print</span> <span class="hljs-string">the</span> <span class="hljs-string">public</span> <span class="hljs-string">port</span> <span class="hljs-string">for</span> <span class="hljs-string">a</span> <span class="hljs-string">port</span> <span class="hljs-string">binding</span><br>  <span class="hljs-string">ps</span>          <span class="hljs-string">List</span> <span class="hljs-string">containers</span><br>  <span class="hljs-string">pull</span>        <span class="hljs-string">Pull</span> <span class="hljs-string">service</span> <span class="hljs-string">images</span><br>  <span class="hljs-string">push</span>        <span class="hljs-string">Push</span> <span class="hljs-string">service</span> <span class="hljs-string">images</span><br>  <span class="hljs-string">restart</span>     <span class="hljs-string">Restart</span> <span class="hljs-string">service</span> <span class="hljs-string">containers</span><br>  <span class="hljs-string">rm</span>          <span class="hljs-string">Removes</span> <span class="hljs-string">stopped</span> <span class="hljs-string">service</span> <span class="hljs-string">containers</span><br>  <span class="hljs-string">run</span>         <span class="hljs-string">Run</span> <span class="hljs-string">a</span> <span class="hljs-string">one-off</span> <span class="hljs-string">command</span> <span class="hljs-string">on</span> <span class="hljs-string">a</span> <span class="hljs-string">service</span><br>  <span class="hljs-string">scale</span>       <span class="hljs-string">Scale</span> <span class="hljs-string">services</span><br>  <span class="hljs-string">start</span>       <span class="hljs-string">Start</span> <span class="hljs-string">services</span><br>  <span class="hljs-string">stats</span>       <span class="hljs-string">Display</span> <span class="hljs-string">a</span> <span class="hljs-string">live</span> <span class="hljs-string">stream</span> <span class="hljs-string">of</span> <span class="hljs-string">container(s)</span> <span class="hljs-string">resource</span> <span class="hljs-string">usage</span> <span class="hljs-string">statistics</span><br>  <span class="hljs-string">stop</span>        <span class="hljs-string">Stop</span> <span class="hljs-string">services</span><br>  <span class="hljs-string">top</span>         <span class="hljs-string">Display</span> <span class="hljs-string">the</span> <span class="hljs-string">running</span> <span class="hljs-string">processes</span><br>  <span class="hljs-string">unpause</span>     <span class="hljs-string">Unpause</span> <span class="hljs-string">services</span><br>  <span class="hljs-string">up</span>          <span class="hljs-string">Create</span> <span class="hljs-string">and</span> <span class="hljs-string">start</span> <span class="hljs-string">containers</span><br>  <span class="hljs-string">version</span>     <span class="hljs-string">Show</span> <span class="hljs-string">the</span> <span class="hljs-string">Docker</span> <span class="hljs-string">Compose</span> <span class="hljs-string">version</span> <span class="hljs-string">information</span><br>  <span class="hljs-string">wait</span>        <span class="hljs-string">Block</span> <span class="hljs-string">until</span> <span class="hljs-string">the</span> <span class="hljs-string">first</span> <span class="hljs-string">service</span> <span class="hljs-string">container</span> <span class="hljs-string">stops</span><br>  <span class="hljs-string">watch</span>       <span class="hljs-string">Watch</span> <span class="hljs-string">build</span> <span class="hljs-string">context</span> <span class="hljs-string">for</span> <span class="hljs-string">service</span> <span class="hljs-string">and</span> <span class="hljs-string">rebuild/refresh</span> <span class="hljs-string">containers</span> <span class="hljs-string">when</span> <span class="hljs-string">files</span> <span class="hljs-string">are</span> <span class="hljs-string">updated</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBootè‡ªå®šä¹‰ Starter</title>
    <link href="/post/d9e19035cbb9/"/>
    <url>/post/d9e19035cbb9/</url>
    
    <content type="html"><![CDATA[<p>é€‚ç”¨äºå°†ç‹¬ç«‹æ¨¡å—,å°è£…æˆspring-boot-stater è‡ªåŠ¨é…ç½®çš„æ¨¡å—</p><h3 id="1-åˆ›å»º-Maven-é¡¹ç›®"><a href="#1-åˆ›å»º-Maven-é¡¹ç›®" class="headerlink" title="1. åˆ›å»º Maven é¡¹ç›®"></a>1. åˆ›å»º Maven é¡¹ç›®</h3><p>åˆ›å»ºä¸€ä¸ªæ™®é€šçš„ Maven é¡¹ç›® <code>custom-example-starter</code>ã€‚</p><h3 id="2-å¯¼å…¥-Spring-Boot-ç›¸å…³ä¾èµ–"><a href="#2-å¯¼å…¥-Spring-Boot-ç›¸å…³ä¾èµ–" class="headerlink" title="2. å¯¼å…¥ Spring Boot ç›¸å…³ä¾èµ–"></a>2. å¯¼å…¥ Spring Boot ç›¸å…³ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>17<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">project.reporting.outputEncoding</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">spring-boot.version</span>&gt;</span>3.0.2<span class="hljs-tag">&lt;/<span class="hljs-name">spring-boot.version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-autoconfigure<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="3-å£°æ˜éœ€è¦é…ç½®çš„å±æ€§å’Œé…ç½®åå‰ç¼€"><a href="#3-å£°æ˜éœ€è¦é…ç½®çš„å±æ€§å’Œé…ç½®åå‰ç¼€" class="headerlink" title="3. å£°æ˜éœ€è¦é…ç½®çš„å±æ€§å’Œé…ç½®åå‰ç¼€"></a>3. å£°æ˜éœ€è¦é…ç½®çš„å±æ€§å’Œé…ç½®åå‰ç¼€</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * admin å±æ€§</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@ConfigurationProperties(prefix = &quot;custom.user.admin&quot;)</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AdminProperties</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Integer</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;admin&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">password</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;password&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="4-åˆ›å»ºè‡ªå®šä¹‰é…ç½®ç±»ï¼Œå¹¶é…ç½®-Bean"><a href="#4-åˆ›å»ºè‡ªå®šä¹‰é…ç½®ç±»ï¼Œå¹¶é…ç½®-Bean" class="headerlink" title="4. åˆ›å»ºè‡ªå®šä¹‰é…ç½®ç±»ï¼Œå¹¶é…ç½® Bean"></a>4. åˆ›å»ºè‡ªå®šä¹‰é…ç½®ç±»ï¼Œå¹¶é…ç½® Bean</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@EnableConfigurationProperties(AdminProperties.class)</span><br><span class="hljs-meta">@ComponentScan(&quot;com.example.utils&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserAutoConfiguration</span> &#123;<br>    <span class="hljs-meta">@Bean</span><br>    User <span class="hljs-title function_">admin</span><span class="hljs-params">(AdminProperties adminProperties)</span> &#123;<br>        System.err.println(<span class="hljs-string">&quot;adminProperties: &quot;</span> + adminProperties);<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>        user.setId(adminProperties.getId());<br>        user.setUsername(adminProperties.getUsername());<br>        user.setPassword(adminProperties.getPassword());<br>        <span class="hljs-keyword">return</span> user;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="5-å¯¼å…¥æŒ‡å®šçš„é…ç½®ç±»"><a href="#5-å¯¼å…¥æŒ‡å®šçš„é…ç½®ç±»" class="headerlink" title="5. å¯¼å…¥æŒ‡å®šçš„é…ç½®ç±»"></a>5. å¯¼å…¥æŒ‡å®šçš„é…ç½®ç±»</h3><p>åˆ›å»ºæ–‡ä»¶ï¼š<code>resources/META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code>ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">com<span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.utils</span>.UserAutoConfiguration<br></code></pre></td></tr></table></figure><p>SpringBoot 2.7å‰åé…ç½®æœ‰æ‰€å·®å¼‚</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs stylus">ç¤ºä¾‹ <br>åŸspring.factoriesæ–‡ä»¶<br>org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.boot</span><span class="hljs-selector-class">.autoconfigure</span>.EnableAutoConfiguration=\<br>com<span class="hljs-selector-class">.xxx</span><span class="hljs-selector-class">.iot</span><span class="hljs-selector-class">.common</span><span class="hljs-selector-class">.config</span><span class="hljs-selector-class">.SaTokenConfigure</span>,\<br>com<span class="hljs-selector-class">.xxx</span><span class="hljs-selector-class">.iot</span><span class="hljs-selector-class">.common</span><span class="hljs-selector-class">.config</span><span class="hljs-selector-class">.SecurityProperties</span><br><br>åœ¨resource/META-INFç›®å½•ä¸‹æ–°å»ºspringç›®å½•ï¼Œå¹¶æ·»åŠ org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.boot</span><span class="hljs-selector-class">.autoconfigure</span><span class="hljs-selector-class">.AutoConfiguration</span>.importsæ–‡ä»¶<br>com<span class="hljs-selector-class">.xxx</span><span class="hljs-selector-class">.iot</span><span class="hljs-selector-class">.common</span><span class="hljs-selector-class">.config</span><span class="hljs-selector-class">.SaTokenConfigure</span><br>com<span class="hljs-selector-class">.xxx</span><span class="hljs-selector-class">.iot</span><span class="hljs-selector-class">.common</span><span class="hljs-selector-class">.config</span>.SecurityProperties<br></code></pre></td></tr></table></figure><h3 id="6-åœ¨å…¶ä»–-Spring-Boot-é¡¹ç›®ä¸­å¼•ç”¨æ­¤æ¨¡å—ç›´æ¥ä½¿ç”¨-Bean"><a href="#6-åœ¨å…¶ä»–-Spring-Boot-é¡¹ç›®ä¸­å¼•ç”¨æ­¤æ¨¡å—ç›´æ¥ä½¿ç”¨-Bean" class="headerlink" title="6. åœ¨å…¶ä»– Spring Boot é¡¹ç›®ä¸­å¼•ç”¨æ­¤æ¨¡å—ç›´æ¥ä½¿ç”¨ Bean"></a>6. åœ¨å…¶ä»– Spring Boot é¡¹ç›®ä¸­å¼•ç”¨æ­¤æ¨¡å—ç›´æ¥ä½¿ç”¨ Bean</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">ConfigurableApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> SpringApplication.run(Main.class, args);<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> context.getBean(User.class);<br>        System.out.println(<span class="hljs-string">&quot;user = &quot;</span> + user);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="7-åœ¨-YAML-æ–‡ä»¶ä¸­ä¿®æ”¹é»˜è®¤å€¼"><a href="#7-åœ¨-YAML-æ–‡ä»¶ä¸­ä¿®æ”¹é»˜è®¤å€¼" class="headerlink" title="7. åœ¨ YAML æ–‡ä»¶ä¸­ä¿®æ”¹é»˜è®¤å€¼"></a>7. åœ¨ YAML æ–‡ä»¶ä¸­ä¿®æ”¹é»˜è®¤å€¼</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">custom:</span><br><span class="hljs-attr">user:</span><br><span class="hljs-attr">admin:</span><br><span class="hljs-attr">id:</span> <span class="hljs-number">22</span><br><span class="hljs-attr">username:</span> <span class="hljs-string">inyxin</span><br></code></pre></td></tr></table></figure><p>é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œä½ å°±åˆ›å»ºäº†ä¸€ä¸ªè‡ªå®šä¹‰çš„ Spring Boot Starterï¼Œå¹¶èƒ½åœ¨å…¶ä»–é¡¹ç›®ä¸­ç›´æ¥ä½¿ç”¨å¯¹åº”çš„ Beanã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>Spring</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>Spring</tag>
      
      <tag>SpringBoot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç”µåŠ›å·¡æ£€å®è®­é¡¹ç›®</title>
    <link href="/post/d595de9ca8b1/"/>
    <url>/post/d595de9ca8b1/</url>
    
    <content type="html"><![CDATA[<h2 id="è§’è‰²"><a href="#è§’è‰²" class="headerlink" title="è§’è‰²"></a>è§’è‰²</h2><ul><li><p>è¶…çº§ç®¡ç†å‘˜</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">ç»´æŠ¤æ•´ä¸ªç³»ç»Ÿçš„æ­£å¸¸è¿è¡Œ,ä¸å‚ä¸ä»»ä½•ç”¨æˆ·çš„ä¸šåŠ¡<br></code></pre></td></tr></table></figure></li><li><p>çº¿è·¯ç®¡ç†å‘˜</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">å¯¹äºçº¿è·¯è¿›è¡Œç®¡ç†, å·¡æ£€ä»»åŠ¡çš„æŒ‡å®š, åˆ†é…, å®¡æ ¸ä»¥åŠæ¶ˆç¼ºä»»åŠ¡çš„æŒ‡å®š, åˆ†é…å’Œå®¡æ ¸<br></code></pre></td></tr></table></figure></li><li><p>å·¡æ£€å‘˜ </p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">æ‰§è¡Œå·¡æ£€ä»»åŠ¡å¹¶è¿”å›å›æ‰§ä¿¡æ¯ <span class="hljs-comment">(å·¡æ£€å›æ‰§)</span><br></code></pre></td></tr></table></figure></li><li><p>æ¶ˆç¼ºå‘˜</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">æ‰§è¡Œæ¶ˆç¼ºä»»åŠ¡ , æ¶ˆé™¤çº¿è·¯ä¸­çš„ç¼ºé™·, å¹¶åé¦ˆå›æ‰§ä¿¡æ¯ <span class="hljs-comment">(æ¶ˆç¼ºå›æ‰§)</span><br></code></pre></td></tr></table></figure></li></ul><h2 id="RBAC"><a href="#RBAC" class="headerlink" title="RBAC"></a>RBAC</h2><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs diff">ç”µåŠ›å·¡æ£€ç³»ç»Ÿåº”è¯¥è®¾è®¡ä¸€ä¸ªRBACæƒé™æ¨¡å‹, æ¥æ§åˆ¶è§’è‰²çš„æ“ä½œ<br><span class="hljs-deletion">-ç”¨æˆ·è¡¨(user)</span><br><span class="hljs-deletion">-ç”¨æˆ·è§’è‰²è¡¨(user_role)</span><br><span class="hljs-deletion">-è§’è‰²è¡¨(role)</span><br><span class="hljs-deletion">-è§’è‰²èµ„æºè¡¨(role_resource)  </span><br><span class="hljs-deletion">-èµ„æºè¡¨(reource)</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥åŸºäº <code>Spring MVC</code> ä¸­çš„ <code>æ‹¦æˆªå™¨</code> æˆ–è€…ä½¿ç”¨ <code>AOP</code> å®ç°ç®€å•çš„æƒé™æ§åˆ¶æ•ˆæœ</p>]]></content>
    
    
    <categories>
      
      <category>default</category>
      
    </categories>
    
    
    <tags>
      
      <tag>default</tag>
      
    </tags>
    
  </entry>
  
  
  
  
  
  
  <entry>
    <title>categories</title>
    <link href="/"/>
    <url>/</url>
    
    <content type="html"><![CDATA[]]></content>
    
  </entry>
  
  
  
  <entry>
    <title>friends</title>
    <link href="/"/>
    <url>/</url>
    
    <content type="html"><![CDATA[]]></content>
    
  </entry>
  
  
  
  <entry>
    <title>about</title>
    <link href="/"/>
    <url>/</url>
    
    <content type="html"><![CDATA[<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">è¿™é‡Œå†™å…³äºé¡µçš„æ­£æ–‡ï¼Œæ”¯æŒ Markdown, <span class="hljs-selector-tag">HTML</span><br></code></pre></td></tr></table></figure>]]></content>
    
  </entry>
  
  
  
  <entry>
    <title>tags</title>
    <link href="/"/>
    <url>/</url>
    
    <content type="html"><![CDATA[]]></content>
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/"/>
    <url>/</url>
    
    <content type="html"><![CDATA[!(function() {  /** è®¡æ—¶èµ·å§‹æ—¶é—´ï¼Œè‡ªè¡Œä¿®æ”¹ **/  var start = new Date("2024/07/04 00:00:00");  function update() {    var now = new Date();    now.setTime(now.getTime()+250);    days = (now - start) / 1000 / 60 / 60 / 24;    dnum = Math.floor(days);    hours = (now - start) / 1000 / 60 / 60 - (24 * dnum);    hnum = Math.floor(hours);    if(String(hnum).length === 1 ){      hnum = "0" + hnum;    }    minutes = (now - start) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);    mnum = Math.floor(minutes);    if(String(mnum).length === 1 ){      mnum = "0" + mnum;    }    seconds = (now - start) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);    snum = Math.round(seconds);    if(String(snum).length === 1 ){      snum = "0" + snum;    }    document.getElementById("timeDate").innerHTML = "æœ¬ç«™å®‰å…¨è¿è¡Œ&nbsp"+dnum+"&nbspå¤©";    document.getElementById("times").innerHTML = hnum + "&nbspå°æ—¶&nbsp" + mnum + "&nbspåˆ†&nbsp" + snum + "&nbspç§’";  }  update();  setInterval(update, 1000);})();]]></content>
    
  </entry>
  
  
  
</search>
